     1                                  ; ****************************************************************************
     2                                  ; MP3PLAY.PRG - MP3 DECODER/PLAYER 1.0 for TRDOS 386 Operating System
     3                                  ; ----------------------------------------------------------------------------
     4                                  ; Based on 
     5                                  ; NOCASH MP3PLAY.EXE 1.4 (Windows) ASM source code (Martin Korth, 20/09/2024)
     6                                  ;
     7                                  ; FASM Source Code: Erdogan Tan - 19/10/2024 - 22/10/2024
     8                                  ; NASM Source Code: Erdogan Tan - 09/01/2025
     9                                  ;
    10                                  ; [ Last Modification: 13/01/2025 ]
    11                                  ;
    12                                  ; ----------------------------------------------------------------------------
    13                                  ; Modified from on MP3PLAY.ASM (for Windows console) source code - 17/10/2024
    14                                  ; ****************************************************************************
    15                                  ; Modified from Martin Korth's 'mp3play.asm' (TASM32) source code... (v1.4)
    16                                  ; Applied development method:
    17                                  ;         Disassembling 'mp3play.exe' v1.4 by using HEX-RAYS disassembler;
    18                                  ;         then... converting disassembled code to FASM syntax,
    19                                  ;                 adding '.idata' code (by help of FASM examples) to the raw
    20                                  ;                        asm file. Converting 'proc' procedures to labels.
    21                                  ;               and Finally: assembling mp3play.asm (single) file by using
    22                                  ;                           'fasm mp3play.asm' command.
    23                                  ;
    24                                  ; NOTE:
    25                                  ; Martin Korth's MP3PLAY.EXE (v1.4, 20/09/2024) file size is 45056 bytes.
    26                                  ; (This) modified MP3PLAY.EXE (v1.4.0, 17/10/2024) is 37888 bytes.
    27                                  ;
    28                                  ; ---------------------------------------------------------------------------
    29                                  ; nasm mp3play.s -l mp3play.txt -o MP3PLAY.PRG -Z error.txt
    30                                  
    31                                  ; ===========================================================================
    32                                  ;  TRDOS 386 Operating System Specific Procedures - Erdogan Tan - 20/10/2024
    33                                  ; ===========================================================================
    34                                  
    35                                  ; 20/10/2024
    36                                  ; 20/08/2024 ; TRDOS 386 v2.0.9
    37                                  ; TRDOS 386 system calls
    38                                  _ver 	equ 0
    39                                  _exit 	equ 1
    40                                  _fork 	equ 2
    41                                  _read 	equ 3
    42                                  _write	equ 4
    43                                  _open	equ 5
    44                                  _close 	equ 6
    45                                  _wait 	equ 7
    46                                  _creat 	equ 8
    47                                  _rename equ 9
    48                                  _delete equ 10
    49                                  _exec	equ 11
    50                                  _chdir	equ 12
    51                                  _time 	equ 13
    52                                  _mkdir 	equ 14
    53                                  _chmod	equ 15
    54                                  _rmdir	equ 16
    55                                  _break	equ 17
    56                                  _drive	equ 18
    57                                  _seek	equ 19
    58                                  _tell 	equ 20
    59                                  _mem	equ 21
    60                                  _prompt	equ 22
    61                                  _path	equ 23
    62                                  _env	equ 24
    63                                  _stime	equ 25
    64                                  _quit	equ 26
    65                                  _intr	equ 27
    66                                  _dir	equ 28
    67                                  _emt 	equ 29
    68                                  _ldvrt 	equ 30
    69                                  _video 	equ 31
    70                                  _audio	equ 32
    71                                  _timer	equ 33
    72                                  _sleep	equ 34
    73                                  _msg    equ 35
    74                                  _geterr	equ 36
    75                                  _fpsave	equ 37
    76                                  _pri	equ 38
    77                                  _rele	equ 39
    78                                  _fff	equ 40
    79                                  _fnf	equ 41
    80                                  _alloc	equ 42
    81                                  _dalloc equ 43
    82                                  _calbac equ 44
    83                                  _dma	equ 45
    84                                  _stdio  equ 46	;  TRDOS 386 v2.0.9
    85                                  
    86                                  ; ---------------------------------------------------------------------------
    87                                  ; 'sys' macro in FASM format
    88                                  ; ---------------------------------------------------------------------------
    89                                  
    90                                  %if 0
    91                                  macro sys op1,op2,op3,op4
    92                                  {
    93                                      if op4 eq 
    94                                      else
    95                                          mov edx, op4
    96                                      end if
    97                                      if op3 eq
    98                                      else
    99                                          mov ecx, op3
   100                                      end if
   101                                      if op2 eq
   102                                      else
   103                                          mov ebx, op2
   104                                      end if
   105                                      mov eax, op1
   106                                      int 40h
   107                                  }
   108                                  %endif
   109                                  
   110                                  ; ---------------------------------------------------------------------------
   111                                  ; 'sys' macro in NASM format
   112                                  ; ---------------------------------------------------------------------------
   113                                  ; 09/01/2025
   114                                  
   115                                  %macro sys 1-4
   116                                      ; 29/04/2016 - TRDOS 386 (TRDOS v2.0)
   117                                      ; 03/09/2015
   118                                      ; 13/04/2015
   119                                      ; Retro UNIX 386 v1 system call.
   120                                      %if %0 >= 2
   121                                          mov ebx, %2
   122                                          %if %0 >= 3
   123                                              mov ecx, %3
   124                                              %if %0 = 4
   125                                                 mov edx, %4
   126                                              %endif
   127                                          %endif
   128                                      %endif
   129                                      mov eax, %1
   130                                      ;int 30h
   131                                      int 40h ; TRDOS 386 (TRDOS v2.0)
   132                                  %endmacro
   133                                  
   134                                  ; ===========================================================================
   135                                  ; CODE
   136                                  ; ===========================================================================
   137                                  
   138                                  		[BITS 32] ; 32-bit intructions
   139                                  
   140                                  		[ORG 0]
   141                                  
   142                                  ; ===========================================================================
   143                                  
   144                                  		; 20/10/2024
   145                                  start:
   146                                  		; 21/10/2024
   147 00000000 E8ED6A0000              		call	set_break	; set and clear bss section
   148                                  					; also set stream_start position
   149                                  
   150                                                  ;mov    edx, txt_hello  ; "nocash mp3 decoder v1.4, 2024" ...
   151                                                  ;call   wrstr_edx
   152 00000005 BB[CA880000]            		mov	ebx, txt_hello
   153 0000000A E88A6B0000              		call	print_msg
   154                                  
   155 0000000F E8B9690000                              call    get_commandline
   156 00000014 0F823C010000                            jc      .exit
   157                                  
   158                                  		;;;
   159                                  		; 11/01/2025
   160 0000001A E8706C0000              		call	detect_enable_audio_device
   161 0000001F 0F8231010000            		jc	.exit
   162                                  		;;;
   163                                  
   164                                  		;;;
   165                                  		; 10/01/2025 (Video memory access for buffer change indicator)
   166                                  		; DIRECT CGA (TEXT MODE) MEMORY ACCESS
   167                                  		; bl = 0, bh = 4
   168                                  		; Direct access/map to CGA (Text) memory (0B8000h)
   169                                  		sys	_video, 0400h
   116                              <1> 
   117                              <1> 
   118                              <1> 
   119                              <1> 
   120                              <1>  %if %0 >= 2
   121 00000025 BB00040000          <1>  mov ebx, %2
   122                              <1>  %if %0 >= 3
   123                              <1>  mov ecx, %3
   124                              <1>  %if %0 = 4
   125                              <1>  mov edx, %4
   126                              <1>  %endif
   127                              <1>  %endif
   128                              <1>  %endif
   129 0000002A B81F000000          <1>  mov eax, %1
   130                              <1> 
   131 0000002F CD40                <1>  int 40h
   170                                  		;cmp	eax, 0B8000h
   171                                  		;jne	short error_exit
   172                                  		;;;
   173                                  
   174 00000031 31ED                                    xor     ebp, ebp
   175 00000033 E8D2630000                              call    mp3_init
   176 00000038 E8CC6A0000                              call    open_and_mmap_the_file
   177 0000003D 0F8213010000                            jc      .exit
   178 00000043 E813010000                              call    detect_cpu_386_and_up
   179 00000048 E85E6B0000                              call    GetTickCount
   180 0000004D F7D8                                    neg     eax
   181 0000004F A3[E8730000]                            mov     [millisecond_count], eax
   182 00000054 E84B640000                              call    mp3_check_1st_frame
   183 00000059 0F82F7000000                            jc      .exit
   184 0000005F 803D[D6730000]00                        cmp     byte [option_test], 0
   185 00000066 7407                                    jz      short .no_benchmark_test
   186 00000068 E801660000                              call    mp3_plain_test_without_output
   187 0000006D EB33                                    jmp     short .decode_done
   188                                  
   189                                  .no_benchmark_test:
   190 0000006F 833D[88820000]00                        cmp     dword [mp3_pcm_fname], 0
   191 00000076 740A                                    jz      short .no_pcm_verify
   192 00000078 E819670000                              call    mp3_verify_pcm_file
   193 0000007D E9D4000000                              jmp     .exit
   194                                  
   195                                  .no_pcm_verify:
   196 00000082 833D[84820000]00                        cmp     dword [mp3_dst_fname], 0
   197 00000089 7407                                    jz      short .no_wav_output
   198 0000008B E813660000                              call    mp3_cast_to_wav_file
   199 00000090 EB10                                    jmp     short .decode_done
   200                                  
   201                                  .no_wav_output:
   202                                  		;;; 
   203                                  		; 20/10/2024
   204                                  		;call	detect_enable_audio_device
   205                                  		;jc	.exit
   206 00000092 E8E56C0000              		call	audio_system_init
   207 00000097 0F82B9000000            		jc	.exit
   208                                  		;;;
   209                                  
   210 0000009D E8986D0000                              call    mp3_cast_to_speaker
   211                                  
   212                                  .decode_done:
   213 000000A2 E8046B0000                              call    GetTickCount
   214 000000A7 0105[E8730000]                          add     [millisecond_count], eax
   215 000000AD BA[BD820000]                            mov     edx, txt_decode_timing1 ; "audio duration "
   216 000000B2 E8F7640000                              call    wrstr_edx
   217 000000B7 A1[0CF20000]                            mov     eax, [mp3_total_output_size]
   218 000000BC BAE8030000                              mov     edx, 1000
   219 000000C1 F7E2                                    mul     edx
   220 000000C3 F735[509B0000]                          div     dword [mp3_output_sample_rate]
   221 000000C9 31D2                                    xor     edx, edx
   222 000000CB F735[4C9B0000]                          div     dword [mp3_output_num_channels]
   223 000000D1 31D2                                    xor     edx, edx
   224 000000D3 F735[549B0000]                          div     dword [mp3_bytes_per_sample]
   225 000000D9 A3[E4730000]                            mov     [mp3_output_milliseconds], eax
   226 000000DE E801650000                              call    wr_decimal_eax_with_thousands_seperator
   227 000000E3 BA[CD820000]                            mov     edx, txt_decode_timing2 ; " milliseconds, decoded in "
   228 000000E8 E8C1640000                              call    wrstr_edx
   229 000000ED A1[E8730000]                            mov     eax, [millisecond_count]
   230 000000F2 E8ED640000                              call    wr_decimal_eax_with_thousands_seperator
   231 000000F7 BA[E8820000]                            mov     edx, txt_decode_timing3 ; " milliseconds\r\n"
   232 000000FC E8AD640000                              call    wrstr_edx
   233 00000101 BA[F8820000]                            mov     edx, txt_clks_per_second ; " clock cycles per second:\r\n"
   234 00000106 E8A3640000                              call    wrstr_edx
   235 0000010B BE[EC730000]                            mov     esi, ttt ; rdtsc_list_start
   236                                  
   237                                  .timelog_lop:
   238 00000110 E8BB640000                              call    wrspc
   239 00000115 8D5608                                  lea     edx, [esi+8]
   240 00000118 E891640000                              call    wrstr_edx
   241 0000011D E8AE640000                              call    wrspc
   242 00000122 8B06                                    mov     eax, [esi]
   243 00000124 8B5E04                                  mov     ebx, [esi+4]
   244 00000127 BAE8030000                              mov     edx, 1000
   245 0000012C 0FAFDA                                  imul    ebx, edx
   246 0000012F F7E2                                    mul     edx
   247 00000131 01DA                                    add     edx, ebx
   248 00000133 3B15[E4730000]                          cmp     edx, [mp3_output_milliseconds]
   249 00000139 730B                                    jnb     short .timelog_oops
   250 0000013B F735[E4730000]                          div     dword [mp3_output_milliseconds]
   251 00000141 E89E640000                              call    wr_decimal_eax_with_thousands_seperator
   252                                  
   253                                  .timelog_oops:
   254 00000146 E874640000                              call    wrcrlf
   255 0000014B 83C618                                  add     esi, 24
   256 0000014E 81FE[B4750000]                          cmp     esi, mp3_bitrate_tab
   257 00000154 75BA                                    jnz     short .timelog_lop
   258                                  
   259                                  .exit:
   260                                  		;push   0               ; uExitCode
   261                                                  ;call   ExitProcess
   262 00000156 E9746A0000              		jmp	ExitProcess
   263                                  
   264                                  
   265                                  ; =============== S U B R O U T I N E =======================================
   266                                  
   267                                  
   268                                  detect_cpu_386_and_up:
   269 0000015B C605[E1730000]03                        mov     byte [detected_cpu], 3
   270 00000162 89E3                                    mov     ebx, esp
   271 00000164 83E4FC                                  and     esp, ~ 3 ; not 3
   272 00000167 9C                                      pushf
   273 00000168 58                                      pop     eax
   274 00000169 89C1                                    mov     ecx, eax
   275 0000016B 3500000400                              xor     eax, 40000h
   276 00000170 50                                      push    eax
   277 00000171 9D                                      popf
   278 00000172 9C                                      pushf
   279 00000173 58                                      pop     eax
   280 00000174 31C8                                    xor     eax, ecx
   281 00000176 51                                      push    ecx
   282 00000177 9D                                      popf
   283 00000178 89DC                                    mov     esp, ebx
   284 0000017A A900000400                              test    eax, 40000h
   285 0000017F 7431                                    jz      short .no_id
   286 00000181 FE05[E1730000]                          inc	byte [detected_cpu]
   287 00000187 E827000000                              call    @@get_id_flag
   288 0000018C 7507                                    jnz     short .yep_id
   289 0000018E E820000000                              call    @@get_id_flag
   290 00000193 741D                                    jz      short .no_id
   291                                  
   292                                  .yep_id:
   293 00000195 B801000000                              mov     eax, 1
   294 0000019A 0FA2                                    cpuid
   295 0000019C 80E40F                                  and     ah, 0Fh
   296 0000019F 8825[E1730000]                          mov     [detected_cpu], ah
   297 000001A5 C605[E0730000]01                        mov	byte [cpuid_exists], 1
   298 000001AC 8915[DC730000]                          mov     [cpuid_flags], edx
   299                                  
   300                                  .no_id:
   301 000001B2 C3                                      retn
   302                                  
   303                                  ; =============== S U B R O U T I N E =======================================
   304                                  
   305                                  
   306                                  @@get_id_flag:
   307 000001B3 9C                                      pushf
   308 000001B4 58                                      pop     eax
   309 000001B5 0D00002000                              or      eax, 200000h
   310 000001BA 50                                      push    eax
   311 000001BB 9D                                      popf
   312 000001BC 9C                                      pushf
   313 000001BD 58                                      pop     eax
   314 000001BE A900002000                              test    eax, 200000h
   315 000001C3 C3                                      retn
   316                                  
   317                                  ; =============== S U B R O U T I N E =======================================
   318                                  
   319                                  bswap_eax:
   320 000001C4 86E0                                    xchg    al, ah
   321 000001C6 C1C810                                  ror     eax, 10h
   322 000001C9 86E0                                    xchg    al, ah
   323 000001CB C3                                      retn
   324                                  
   325                                  ; =============== S U B R O U T I N E =======================================
   326                                  
   327                                  mp3_recollect_bits:
   328 000001CC F7C601000000                            test    esi, 1
   329 000001D2 7510                                    jnz     short .odd
   330 000001D4 668B2E                                  mov     bp, [esi]
   331 000001D7 83C602                                  add     esi, 2
   332 000001DA 66C1CD08                                ror     bp, 8
   333 000001DE C1E510                                  shl     ebp, 16
   334 000001E1 B500                                    mov     ch, 0
   335 000001E3 C3                                      retn
   336                                  
   337                                  .odd:
   338 000001E4 0FB62E                                  movzx   ebp, byte [esi]
   339 000001E7 46                                      inc     esi
   340 000001E8 C1E510                                  shl     ebp, 16
   341 000001EB 668B2E                                  mov     bp, [esi]
   342 000001EE 83C602                                  add     esi, 2
   343 000001F1 66C1CD08                                ror     bp, 8
   344 000001F5 C1E508                                  shl     ebp, 8
   345 000001F8 B508                                    mov     ch, 8
   346 000001FA C3                                      retn
   347                                  
   348                                  ; =============== S U B R O U T I N E =======================================
   349                                  
   350                                  
   351                                  mp3_get_bits:
   352 000001FB 89E8                                    mov     eax, ebp
   353 000001FD D3E5                                    shl     ebp, cl
   354 000001FF D3C0                                    rol     eax, cl
   355 00000201 31E8                                    xor     eax, ebp
   356 00000203 28CD                                    sub     ch, cl
   357 00000205 7801                                    js      short mp3_collect_more
   358 00000207 C3                                      retn
   359                                  
   360                                  mp3_collect_more:
   361 00000208 88E9                                    mov     cl, ch
   362 0000020A 80C510                                  add     ch, 10h
   363 0000020D D3C5                                    rol     ebp, cl
   364 0000020F 668B2E                                  mov     bp, [esi]
   365 00000212 83C602                                  add     esi, 2
   366 00000215 66C1CD08                                ror     bp, 8
   367 00000219 D3CD                                    ror     ebp, cl
   368 0000021B C3                                      retn
   369                                  
   370                                  ; =============== S U B R O U T I N E =======================================
   371                                  
   372                                  
   373                                  mp3_uncollect_bits:
   374 0000021C 83EE02                                  sub     esi, 2
   375 0000021F C0ED03                                  shr     ch, 3
   376 00000222 0FB6CD                                  movzx   ecx, ch
   377 00000225 29CE                                    sub     esi, ecx
   378 00000227 C3                                      retn
   379                                  
   380                                  ; =============== S U B R O U T I N E =======================================
   381                                  
   382                                  
   383                                  mp3_search_get_header:
   384 00000228 F605[DC730000]10                        test    byte [cpuid_flags], 10h
   385 0000022F 740E                                    jz      short .no_rdtsc_supported
   386 00000231 0F31                                    rdtsc
   387 00000233 2905[EC730000]                          sub     [ttt], eax
   388 00000239 1915[F0730000]                          sbb     [ttt+4], edx
   389                                  
   390                                  .no_rdtsc_supported:
   391 0000023F C705[30F20000]0000-                     mov	dword [mp3_extra_bytes], 0
   391 00000247 0000               
   392                                  
   393                                  .retry_header:
   394 00000249 833D[2CF20000]04                        cmp	dword [mp3_src_remain], 4
   395 00000250 0F82B5010000                            jb      .fail_no_header
   396 00000256 803EFF                                  cmp     byte [esi], 0FFh
   397 00000259 7516                                    jnz     short .bad_header
   398 0000025B 8A4601                                  mov     al, [esi+1]
   399 0000025E 24E6                                    and     al, 0E6h
   400 00000260 3CE2                                    cmp     al, 0E2h
   401 00000262 750D                                    jnz     short .bad_header
   402 00000264 8A4602                                  mov     al, [esi+2]
   403 00000267 3CF0                                    cmp     al, 0F0h
   404 00000269 7306                                    jnb     short .bad_header
   405 0000026B 240C                                    and     al, 0Ch
   406 0000026D 3C0C                                    cmp     al, 0Ch
   407 0000026F 7519                                    jnz     short .good_header
   408                                  
   409                                  .bad_header:
   410 00000271 46                                      inc	esi
   411 00000272 FF0D[2CF20000]                          dec	dword [mp3_src_remain]
   412 00000278 FF05[30F20000]                          inc	dword [mp3_extra_bytes]
   413 0000027E C705[1C9B0000]-                         mov	dword [main_data_pool_wr_ptr], main_data_pool_start
   413 00000284 [1C8B0000]         
   414 00000288 EBBF                                    jmp	short .retry_header
   415                                  
   416                                  .good_header:
   417 0000028A 8B06                                    mov	eax, [esi]
   418 0000028C E833FFFFFF                              call	bswap_eax
   419 00000291 A3[2C9B0000]                            mov	[mp3_hdr_32bit_header], eax
   420 00000296 C705[6C9B0000]0000-                     mov	dword [mp3_hdr_flag_lsf], 0
   420 0000029E 0000               
   421 000002A0 C705[349B0000]0000-                     mov	dword [mp3_hdr_flag_mpeg25], 0
   421 000002A8 0000               
   422 000002AA C705[3CF20000]0200-                     mov	dword [mp3_nb_granules], 2
   422 000002B2 0000               
   423 000002B4 A900000800                              test	eax, 80000h
   424 000002B9 7525                                    jnz	short .lsf_this
   425 000002BB C705[6C9B0000]0100-                     mov	dword [mp3_hdr_flag_lsf], 1
   425 000002C3 0000               
   426 000002C5 C705[3CF20000]0100-                     mov	dword [mp3_nb_granules], 1
   426 000002CD 0000               
   427 000002CF A900001000                              test	eax, 100000h
   428 000002D4 750A                                    jnz	short .lsf_this
   429 000002D6 C705[349B0000]0100-                     mov	dword [mp3_hdr_flag_mpeg25], 1
   429 000002DE 0000               
   430                                  
   431                                  .lsf_this:
   432 000002E0 C1E80A                                  shr     eax, 10
   433 000002E3 83E003                                  and     eax, 3
   434 000002E6 8B0D[6C9B0000]                          mov     ecx, [mp3_hdr_flag_lsf]
   435 000002EC 030D[349B0000]                          add     ecx, [mp3_hdr_flag_mpeg25]
   436 000002F2 0FB79400[F4750000]                      movzx   edx, word [mp3_freq_tab+eax*2]
   437 000002FA D3EA                                    shr     edx, cl
   438 000002FC 8D0C49                                  lea     ecx, [ecx+ecx*2]
   439 000002FF 01C8                                    add     eax, ecx
   440 00000301 A3[409B0000]                            mov     [mp3_hdr_sample_rate_index], eax
   441 00000306 8915[3C9B0000]                          mov     [mp3_sample_rate], edx
   442                                  
   443 0000030C 8A0D[D9730000]                          mov     cl, [option_rate_shift]
   444 00000312 D3EA                                    shr     edx, cl
   445                                  
   446 00000314 8915[509B0000]                          mov     [mp3_output_sample_rate], edx
   447 0000031A A1[2C9B0000]                            mov     eax, [mp3_hdr_32bit_header]
   448 0000031F C1E810                                  shr     eax, 10h
   449 00000322 F7D0                                    not     eax
   450 00000324 83E001                                  and     eax, 1
   451 00000327 A3[309B0000]                            mov     [mp3_hdr_flag_crc], eax
   452 0000032C A1[2C9B0000]                            mov     eax, [mp3_hdr_32bit_header]
   453 00000331 C1E809                                  shr     eax, 9
   454 00000334 83E001                                  and     eax, 1
   455 00000337 A3[389B0000]                            mov     [mp3_hdr_flag_padding], eax
   456 0000033C A1[2C9B0000]                            mov     eax, [mp3_hdr_32bit_header]
   457 00000341 C1E80C                                  shr     eax, 12
   458 00000344 83E00F                                  and     eax, 0Fh
   459 00000347 7512                                    jnz     short .not_free_format
   460 00000349 E85F5D0000                              call    mp3_detect_free_format_block_size
   461 0000034E 0F821DFFFFFF                            jb      .bad_header
   462 00000354 A1[7CF10000]                            mov     eax, [mp3_free_format_frame_size]
   463 00000359 EB34                                    jmp     short .this_frame_size_plus_padding
   464                                  
   465                                  .not_free_format:
   466 0000035B 8B15[6C9B0000]                          mov     edx, [mp3_hdr_flag_lsf]
   467 00000361 C1E204                                  shl     edx, 4
   468 00000364 01D0                                    add     eax, edx
   469 00000366 0FB78400[B4750000]                      movzx   eax, word [mp3_bitrate_tab+eax*2] ; kbit/s
   470 0000036E 69C0E8030000                            imul    eax, 1000       ; bit/s
   471 00000374 A3[449B0000]                            mov     [mp3_bit_rate], eax
   472 00000379 69C090000000                            imul    eax, 144        ; 144=90h=8*18
   473 0000037F 31D2                                    xor     edx, edx
   474 00000381 F735[3C9B0000]                          div     dword [mp3_sample_rate]
   475 00000387 8B0D[6C9B0000]                          mov     ecx, [mp3_hdr_flag_lsf]
   476 0000038D D3E8                                    shr     eax, cl
   477                                  
   478                                  .this_frame_size_plus_padding:
   479 0000038F 0305[389B0000]                          add     eax, [mp3_hdr_flag_padding]
   480 00000395 A3[249B0000]                            mov     [mp3_src_frame_size], eax
   481 0000039A 01F0                                    add     eax, esi
   482 0000039C A3[289B0000]                            mov     [mp3_src_frame_end], eax
   483 000003A1 A1[2C9B0000]                            mov     eax, [mp3_hdr_32bit_header]
   484 000003A6 C1E806                                  shr     eax, 6
   485 000003A9 83E003                                  and     eax, 3
   486 000003AC A3[649B0000]                            mov     [mp3_hdr_mode_val], eax
   487 000003B1 BA01000000                              mov     edx, 1
   488                                  
   489 000003B6 3C03                    		cmp     al, 3
   490 000003B8 7401                                    jz      short .this_channels
   491                                  
   492                                                  ;mov    edx, 2
   493                                  		; 10/01/2025
   494 000003BA 42                      		inc	edx
   495                                  .this_channels:
   496 000003BB 8915[489B0000]                          mov	[mp3_src_num_channels], edx
   497 000003C1 803D[D7730000]00                        cmp	byte [option_mono], 0
   498 000003C8 7405                                    jz	short .allow_stereo
   499 000003CA BA01000000                              mov	edx, 1
   500                                  .allow_stereo:
   501 000003CF 8915[4C9B0000]                          mov     [mp3_output_num_channels], edx
   502 000003D5 0FAF15[549B0000]                        imul    edx, [mp3_bytes_per_sample]
   503 000003DC 8915[18F20000]                          mov     [mp3_samples_dst_step], edx
   504 000003E2 A1[2C9B0000]                            mov     eax, [mp3_hdr_32bit_header]
   505 000003E7 C1E804                                  shr     eax, 4
   506 000003EA 83E003                                  and     eax, 3
   507 000003ED A3[689B0000]                            mov     [mp3_hdr_mode_ext], eax
   508 000003F2 F605[DC730000]10                        test    byte [cpuid_flags], 10h
   509 000003F9 740E                                    jz      short .no_rdtsc_supported@
   510 000003FB 0F31                                    rdtsc
   511 000003FD 0105[EC730000]                          add     [ttt], eax
   512 00000403 1115[F0730000]                          adc     [ttt+4], edx
   513                                  
   514                                  .no_rdtsc_supported@:
   515 00000409 F8                                      clc
   516 0000040A C3                                      retn
   517                                  
   518                                  .fail_no_header:
   519 0000040B F605[DC730000]10                        test    byte [cpuid_flags], 10h
   520 00000412 740E                                    jz      short .no_rdtsc_supported@@
   521 00000414 0F31                                    rdtsc
   522 00000416 0105[EC730000]                          add     [ttt], eax
   523 0000041C 1115[F0730000]                          adc     [ttt+4], edx
   524                                  
   525                                  .no_rdtsc_supported@@:
   526 00000422 C705[249B0000]0000-                     mov     dword [mp3_src_frame_size], 0
   526 0000042A 0000               
   527 0000042C F9                                      stc
   528 0000042D C3                                      retn
   529                                  
   530                                  
   531                                  ; =============== S U B R O U T I N E =======================================
   532                                  
   533                                  
   534                                  mp3_bitstream_read_header_extra:
   535 0000042E F605[DC730000]10                        test    byte [cpuid_flags], 10h
   536 00000435 740E                                    jz      short .no_rdtsc_supported
   537 00000437 0F31                                    rdtsc
   538 00000439 2905[04740000]                          sub     [rdtsc_read_header_extra], eax
   539 0000043F 1915[08740000]                          sbb     [rdtsc_read_header_extra+4], edx
   540                                  
   541                                  .no_rdtsc_supported:
   542 00000445 833D[309B0000]00                        cmp     dword [mp3_hdr_flag_crc], 0
   543 0000044C 7422                                    jz      short .without_crc
   544 0000044E 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 16
   545 00000450 C1E510                                  shl     ebp, 10h
   546 00000453 C1C010                                  rol     eax, 10h
   547 00000456 31E8                                    xor     eax, ebp
   548 00000458 80ED10                                  sub     ch, 10h
   549 0000045B 7913                                    jns     short .without_crc
   550 0000045D 88E9                                    mov     cl, ch          ; mp3mac_collect_more
   551 0000045F 80C510                                  add     ch, 10h
   552 00000462 D3C5                                    rol     ebp, cl
   553 00000464 668B2E                                  mov     bp, [esi]
   554 00000467 83C602                                  add     esi, 2
   555 0000046A 66C1CD08                                ror     bp, 8
   556 0000046E D3CD                                    ror     ebp, cl
   557                                  
   558                                  .without_crc:
   559 00000470 833D[6C9B0000]00                        cmp     dword [mp3_hdr_flag_lsf], 0
   560 00000477 745B                                    jz      short .pre_lsf_zero
   561 00000479 C705[38F20000]0900-                     mov     dword [mp3_num_compress_bits], 9
   561 00000481 0000               
   562 00000483 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 8
   563 00000485 C1E508                                  shl     ebp, 8
   564 00000488 C1C008                                  rol     eax, 8
   565 0000048B 31E8                                    xor     eax, ebp
   566 0000048D 80ED08                                  sub     ch, 8
   567 00000490 7913                                    jns     short .without_crc@
   568 00000492 88E9                                    mov     cl, ch
   569 00000494 80C510                                  add     ch, 10h
   570 00000497 D3C5                                    rol     ebp, cl
   571 00000499 668B2E                                  mov     bp, [esi]
   572 0000049C 83C602                                  add     esi, 2
   573 0000049F 66C1CD08                                ror     bp, 8
   574 000004A3 D3CD                                    ror     ebp, cl
   575                                  
   576                                  .without_crc@:
   577 000004A5 A3[34F20000]                            mov     [mp3_main_data_begin], eax
   578 000004AA 8A0D[489B0000]                          mov     cl, byte [mp3_src_num_channels]
   579 000004B0 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits cl
   580 000004B2 D3E5                                    shl     ebp, cl
   581 000004B4 D3C0                                    rol     eax, cl
   582 000004B6 31E8                                    xor     eax, ebp
   583 000004B8 28CD                                    sub     ch, cl
   584 000004BA 7913                                    jns     short .without_crc@@
   585 000004BC 88E9                                    mov     cl, ch
   586 000004BE 80C510                                  add     ch, 10h
   587 000004C1 D3C5                                    rol     ebp, cl
   588 000004C3 668B2E                                  mov     bp, [esi]
   589 000004C6 83C602                                  add     esi, 2
   590 000004C9 66C1CD08                                ror     bp, 8
   591 000004CD D3CD                                    ror     ebp, cl
   592                                  
   593                                  .without_crc@@:
   594 000004CF E9A1000000                              jmp     .pre_lsf_done
   595                                  
   596                                  .pre_lsf_zero:
   597 000004D4 C705[38F20000]0400-                     mov     dword [mp3_num_compress_bits], 4
   597 000004DC 0000               
   598 000004DE 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 9
   599 000004E0 C1E509                                  shl     ebp, 9
   600 000004E3 C1C009                                  rol     eax, 9
   601 000004E6 31E8                                    xor     eax, ebp
   602 000004E8 80ED09                                  sub     ch, 9
   603 000004EB 7913                                    jns     short .without_crc@@@
   604 000004ED 88E9                                    mov     cl, ch
   605 000004EF 80C510                                  add     ch, 10h
   606 000004F2 D3C5                                    rol     ebp, cl
   607 000004F4 668B2E                                  mov     bp, [esi]
   608 000004F7 83C602                                  add     esi, 2
   609 000004FA 66C1CD08                                ror     bp, 8
   610 000004FE D3CD                                    ror     ebp, cl
   611                                  
   612                                  .without_crc@@@:
   613 00000500 A3[34F20000]                            mov     [mp3_main_data_begin], eax
   614 00000505 8A0D[489B0000]                          mov     cl, byte [mp3_src_num_channels]
   615 0000050B D0E1                                    shl     cl, 1           ; 1,2 --> 2,4
   616 0000050D 80F107                                  xor     cl, 7           ;     --> 5,3
   617 00000510 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits cl
   618 00000512 D3E5                                    shl     ebp, cl
   619 00000514 D3C0                                    rol     eax, cl
   620 00000516 31E8                                    xor     eax, ebp
   621 00000518 28CD                                    sub     ch, cl
   622 0000051A 7913                                    jns     short .without_crc@@@@
   623 0000051C 88E9                                    mov     cl, ch
   624 0000051E 80C510                                  add     ch, 10h
   625 00000521 D3C5                                    rol     ebp, cl
   626 00000523 668B2E                                  mov     bp, [esi]
   627 00000526 83C602                                  add     esi, 2
   628 00000529 66C1CD08                                ror     bp, 8
   629 0000052D D3CD                                    ror     ebp, cl
   630                                  
   631                                  .without_crc@@@@:
   632 0000052F 8B15[489B0000]                          mov     edx, [mp3_src_num_channels]
   633 00000535 BB[40F20000]                            mov     ebx, mp3_granules
   634                                  
   635                                  .pre_channel_lop:
   636 0000053A C7432800000000                          mov     dword [ebx+40], 0 ; [ebx+$mp3gr_scfsi]
   637 00000541 81C3A0090000                            add     ebx, 2464       ; $mp3gr_entrysiz
   638 00000547 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 4
   639 00000549 C1E504                                  shl     ebp, 4
   640 0000054C C1C004                                  rol     eax, 4
   641 0000054F 31E8                                    xor     eax, ebp
   642 00000551 80ED04                                  sub     ch, 4
   643 00000554 7913                                    jns     short .without_crc@@@@@
   644 00000556 88E9                                    mov     cl, ch
   645 00000558 80C510                                  add     ch, 10h
   646 0000055B D3C5                                    rol     ebp, cl
   647 0000055D 668B2E                                  mov     bp, [esi]
   648 00000560 83C602                                  add     esi, 2
   649 00000563 66C1CD08                                ror     bp, 8
   650 00000567 D3CD                                    ror     ebp, cl
   651                                  
   652                                  .without_crc@@@@@:
   653 00000569 894328                                  mov     [ebx+28h], eax  ; [ebx+$mp3gr_scfsi]
   654 0000056C 81C3A0090000                            add     ebx, 2464       ; $mp3gr_entrysiz
   655 00000572 4A                                      dec     edx
   656 00000573 75C5                                    jnz     short .pre_channel_lop
   657                                  
   658                                  .pre_lsf_done:
   659 00000575 A1[3CF20000]                            mov     eax, [mp3_nb_granules]
   660 0000057A 6BC012                                  imul    eax, 12h
   661 0000057D A3[609B0000]                            mov     [mp3_nb_frames], eax
   662 00000582 A1[609B0000]                            mov     eax, [mp3_nb_frames]
   663 00000587 0FAF05[4C9B0000]                        imul    eax, [mp3_output_num_channels]
   664 0000058E 0FAF05[549B0000]                        imul    eax, [mp3_bytes_per_sample]
   665 00000595 C1E005                                  shl     eax, 5
   666 00000598 8A0D[D9730000]                          mov     cl, [option_rate_shift]
   667 0000059E D3E8                                    shr     eax, cl
   668 000005A0 A3[14F20000]                            mov     [mp3_samples_output_size], eax
   669 000005A5 F605[DC730000]10                        test    byte [cpuid_flags], 10h ; timelog_end rdtsc_read_header_extra
   670 000005AC 740E                                    jz      short .no_rdtsc_supported@
   671 000005AE 0F31                                    rdtsc
   672 000005B0 0105[04740000]                          add     [rdtsc_read_header_extra], eax
   673 000005B6 1115[08740000]                          adc     [rdtsc_read_header_extra+4], edx
   674                                  
   675                                  .no_rdtsc_supported@:
   676 000005BC C3                                      retn
   677                                  
   678                                  
   679                                  ; =============== S U B R O U T I N E =======================================
   680                                  
   681                                  
   682                                  mp3_bitstream_read_granules:
   683 000005BD F605[DC730000]10                        test    byte [cpuid_flags], 10h ; timelog_start rdtsc_read_granule
   684 000005C4 740E                                    jz      short .no_rdtsc_supported
   685 000005C6 0F31                                    rdtsc
   686 000005C8 2905[1C740000]                          sub     [rdtsc_read_granule], eax
   687 000005CE 1915[20740000]                          sbb     [rdtsc_read_granule+4], edx
   688                                  
   689                                  .no_rdtsc_supported:
   690 000005D4 8925[341D0500]                          mov	[_@@saved_sp], esp
   691 000005DA C705[381D0500]0000-                     mov	dword [mp3_main_data_siz], 0
   691 000005E2 0000               
   692 000005E4 C705[20F20000]0000-                     mov	dword [mp3_curr_granule], 0
   692 000005EC 0000               
   693 000005EE BB[40F20000]                            mov	ebx, mp3_granules
   694                                  
   695                                  .hdr_granule_lop:
   696 000005F3 53                                      push    ebx
   697 000005F4 C705[1CF20000]0000-                     mov     dword [mp3_curr_channel], 0
   697 000005FC 0000               
   698                                  
   699                                  .hdr_channel_lop:
   700 000005FE 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 12
   701 00000600 C1E50C                                  shl     ebp, 12
   702 00000603 C1C00C                                  rol     eax, 12
   703 00000606 31E8                                    xor     eax, ebp
   704 00000608 80ED0C                                  sub     ch, 12
   705 0000060B 7913                                    jns     short .without_crc
   706 0000060D 88E9                                    mov     cl, ch
   707 0000060F 80C510                                  add     ch, 16
   708 00000612 D3C5                                    rol     ebp, cl
   709 00000614 668B2E                                  mov     bp, [esi]
   710 00000617 83C602                                  add     esi, 2
   711 0000061A 66C1CD08                                ror     bp, 8
   712 0000061E D3CD                                    ror     ebp, cl
   713                                  
   714                                  .without_crc:
   715 00000620 8B15[381D0500]                          mov     edx, [mp3_main_data_siz]
   716 00000626 8903                                    mov     [ebx], eax
   717 00000628 895304                                  mov     [ebx+4], edx
   718 0000062B 01D0                                    add     eax, edx
   719 0000062D 894308                                  mov     [ebx+8], eax
   720 00000630 A3[381D0500]                            mov     [mp3_main_data_siz], eax
   721 00000635 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 9
   722 00000637 C1E509                                  shl     ebp, 9
   723 0000063A C1C009                                  rol     eax, 9
   724 0000063D 31E8                                    xor     eax, ebp
   725 0000063F 80ED09                                  sub     ch, 9
   726 00000642 7913                                    jns     short .without_crc@
   727 00000644 88E9                                    mov     cl, ch
   728 00000646 80C510                                  add     ch, 10h
   729 00000649 D3C5                                    rol     ebp, cl
   730 0000064B 668B2E                                  mov     bp, [esi]
   731 0000064E 83C602                                  add     esi, 2
   732 00000651 66C1CD08                                ror     bp, 8
   733 00000655 D3CD                                    ror     ebp, cl
   734                                  
   735                                  .without_crc@:
   736 00000657 89430C                                  mov     [ebx+12], eax   ; [ebx+$mp3gr_big_values]
   737 0000065A 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 8
   738 0000065C C1E508                                  shl     ebp, 8
   739 0000065F C1C008                                  rol     eax, 8
   740 00000662 31E8                                    xor     eax, ebp
   741 00000664 80ED08                                  sub     ch, 8
   742 00000667 7913                                    jns     short .without_crc@@
   743 00000669 88E9                                    mov     cl, ch
   744 0000066B 80C510                                  add     ch, 10h
   745 0000066E D3C5                                    rol     ebp, cl
   746 00000670 668B2E                                  mov     bp, [esi]
   747 00000673 83C602                                  add     esi, 2
   748 00000676 66C1CD08                                ror     bp, 8
   749 0000067A D3CD                                    ror     ebp, cl
   750                                  
   751                                  .without_crc@@:
   752 0000067C 05BE000000                              add	eax, 190        ; 400-210
   753 00000681 833D[649B0000]01                        cmp	dword [mp3_hdr_mode_val], 1
   754 00000688 750F                                    jnz	short .not_ms_stereo
   755 0000068A F705[689B0000]0200-                     test	dword [mp3_hdr_mode_ext], 2
   755 00000692 0000               
   756 00000694 7403                                    jz	short .not_ms_stereo
   757 00000696 83E802                                  sub	eax, 2
   758                                  
   759                                  .not_ms_stereo:
   760 00000699 894310                                  mov     [ebx+16], eax   ; [ebx+$mp3gr_global_gain]
   761 0000069C 8A0D[38F20000]                          mov     cl, byte [mp3_num_compress_bits]
   762 000006A2 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits cl
   763 000006A4 D3E5                                    shl     ebp, cl
   764 000006A6 D3C0                                    rol     eax, cl
   765 000006A8 31E8                                    xor     eax, ebp
   766 000006AA 28CD                                    sub     ch, cl
   767 000006AC 7913                                    jns     short .without_crc@@@
   768 000006AE 88E9                                    mov     cl, ch
   769 000006B0 80C510                                  add     ch, 10h
   770 000006B3 D3C5                                    rol     ebp, cl
   771 000006B5 668B2E                                  mov     bp, [esi]
   772 000006B8 83C602                                  add     esi, 2
   773 000006BB 66C1CD08                                ror     bp, 8
   774 000006BF D3CD                                    ror     ebp, cl
   775                                  
   776                                  .without_crc@@@:
   777 000006C1 894314                                  mov     [ebx+20], eax   ; [ebx+$mp3gr_scalefac_compress]
   778 000006C4 FECD                                    dec     ch              ; mp3mac_get_bit_to_cy
   779                                                                          ; dec mp3_colNN
   780 000006C6 D1E5                                    shl     ebp, 1          ; shl mp3_col32,1 ; cy=data
   781 000006C8 0F834F010000                            jnb     .no_blocksplit
   782 000006CE 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 2
   783 000006D0 C1E502                                  shl     ebp, 2
   784 000006D3 C1C002                                  rol     eax, 2
   785 000006D6 31E8                                    xor     eax, ebp
   786 000006D8 80ED02                                  sub     ch, 2
   787 000006DB 7913                                    jns     short .without_crc@@@@
   788 000006DD 88E9                                    mov     cl, ch
   789 000006DF 80C510                                  add     ch, 10h
   790 000006E2 D3C5                                    rol     ebp, cl
   791 000006E4 668B2E                                  mov     bp, [esi]
   792 000006E7 83C602                                  add     esi, 2
   793 000006EA 66C1CD08                                ror     bp, 8
   794 000006EE D3CD                                    ror     ebp, cl
   795                                  
   796                                  .without_crc@@@@:
   797 000006F0 83F800                                  cmp     eax, 0
   798 000006F3 0F847B030000                            jz      .error
   799 000006F9 89432C                                  mov     [ebx+44], eax   ; [ebx+$mp3gr_block_type]
   800 000006FC 83F802                                  cmp     eax, 2
   801 000006FF B812000000                              mov     eax, 18         ; 36/2 ; region_size (default)
   802 00000704 741C                                    jz      short .this_region_size
   803 00000706 833D[409B0000]02                        cmp     dword [mp3_hdr_sample_rate_index], 2
   804 0000070D 7613                                    jbe     short .this_region_size
   805 0000070F B81B000000                              mov     eax, 27         ; 54/2 ; region_size
   806 00000714 833D[409B0000]08                        cmp     dword [mp3_hdr_sample_rate_index], 8
   807 0000071B 7505                                    jnz     short .this_region_size
   808 0000071D B836000000                              mov     eax, 54         ; 108/2 ; region_size (for rate=8)
   809                                  
   810                                  .this_region_size:
   811 00000722 894350                                  mov     [ebx+80], eax   ; [ebx+$mp3gr_region_size+0*4]
   812 00000725 C7435420010000                          mov     dword [ebx+84], 288 ; [ebx+$mp3gr_region_size+1*4],576/2
   813 0000072C C7435820010000                          mov     dword [ebx+88], 288 ; [ebx+$mp3gr_region_size+2*4],576/2
   814 00000733 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 1
   815 00000735 D1E5                                    shl     ebp, 1
   816 00000737 D1C0                                    rol     eax, 1
   817 00000739 31E8                                    xor     eax, ebp
   818 0000073B 80ED01                                  sub     ch, 1
   819 0000073E 7913                                    jns     short .without_crc@@@@@
   820 00000740 88E9                                    mov     cl, ch
   821 00000742 80C510                                  add     ch, 10h
   822 00000745 D3C5                                    rol     ebp, cl
   823 00000747 668B2E                                  mov     bp, [esi]
   824 0000074A 83C602                                  add     esi, 2
   825 0000074D 66C1CD08                                ror     bp, 8
   826 00000751 D3CD                                    ror     ebp, cl
   827                                  
   828                                  .without_crc@@@@@:
   829 00000753 894330                                  mov     [ebx+48], eax   ; [ebx+$mp3gr_switch_point]
   830 00000756 89E8                                    mov     eax, ebp        ; IRP nn,0,1 ; only 0..1 for blocksplit
   831 00000758 C1E505                                  shl     ebp, 5          ; mp3mac_get_n_bits 5
   832 0000075B C1C005                                  rol     eax, 5
   833 0000075E 31E8                                    xor     eax, ebp
   834 00000760 80ED05                                  sub     ch, 5
   835 00000763 7913                                    jns     short .without_crc@@@@@@
   836 00000765 88E9                                    mov     cl, ch
   837 00000767 80C510                                  add     ch, 10h
   838 0000076A D3C5                                    rol     ebp, cl
   839 0000076C 668B2E                                  mov     bp, [esi]
   840 0000076F 83C602                                  add     esi, 2
   841 00000772 66C1CD08                                ror     bp, 8
   842 00000776 D3CD                                    ror     ebp, cl
   843                                  
   844                                  .without_crc@@@@@@:
   845 00000778 894338                                  mov     [ebx+56], eax   ; [ebx+$mp3gr_table_select+nn*4] ; nn=0
   846 0000077B 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 5
   847 0000077D C1E505                                  shl     ebp, 5
   848 00000780 C1C005                                  rol     eax, 5
   849 00000783 31E8                                    xor     eax, ebp
   850 00000785 80ED05                                  sub     ch, 5
   851 00000788 7913                                    jns     short .without_crc_@@@@
   852 0000078A 88E9                                    mov     cl, ch
   853 0000078C 80C510                                  add     ch, 10h
   854 0000078F D3C5                                    rol     ebp, cl
   855 00000791 668B2E                                  mov     bp, [esi]
   856 00000794 83C602                                  add     esi, 2
   857 00000797 66C1CD08                                ror     bp, 8
   858 0000079B D3CD                                    ror     ebp, cl
   859                                  
   860                                  .without_crc_@@@@:
   861 0000079D 89433C                                  mov     [ebx+60], eax   ; [ebx+$mp3gr_table_select+nn*4] ; nn=1
   862 000007A0 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 5
   863 000007A2 C1E503                                  shl     ebp, 3          ; IRP nn,0,1,2
   864 000007A5 C1C003                                  rol     eax, 3          ; mp3mac_get_n_bits 3
   865 000007A8 31E8                                    xor     eax, ebp
   866 000007AA 80ED03                                  sub     ch, 3
   867 000007AD 7913                                    jns     short .without_crc_@@@@@
   868 000007AF 88E9                                    mov     cl, ch
   869 000007B1 80C510                                  add     ch, 10h
   870 000007B4 D3C5                                    rol     ebp, cl
   871 000007B6 668B2E                                  mov     bp, [esi]
   872 000007B9 83C602                                  add     esi, 2
   873 000007BC 66C1CD08                                ror     bp, 8
   874 000007C0 D3CD                                    ror     ebp, cl
   875                                  
   876                                  .without_crc_@@@@@:
   877 000007C2 C1E003                                  shl     eax, 3
   878 000007C5 894344                                  mov     [ebx+68], eax   ; [ebx+$mp3gr_subblock_gain+nn*4] ; nn=0
   879 000007C8 89E8                                    mov     eax, ebp
   880 000007CA C1E503                                  shl     ebp, 3
   881 000007CD C1C003                                  rol     eax, 3
   882 000007D0 31E8                                    xor     eax, ebp
   883 000007D2 80ED03                                  sub     ch, 3
   884 000007D5 7913                                    jns     short .without_crc_@@@@@@
   885 000007D7 88E9                                    mov     cl, ch
   886 000007D9 80C510                                  add     ch, 10h
   887 000007DC D3C5                                    rol     ebp, cl
   888 000007DE 668B2E                                  mov     bp, [esi]
   889 000007E1 83C602                                  add     esi, 2
   890 000007E4 66C1CD08                                ror     bp, 8
   891 000007E8 D3CD                                    ror     ebp, cl
   892                                  
   893                                  .without_crc_@@@@@@:
   894 000007EA C1E003                                  shl     eax, 3
   895 000007ED 894348                                  mov     [ebx+72], eax   ; [ebx+$mp3gr_subblock_gain+nn*4] ; nn=1
   896 000007F0 89E8                                    mov     eax, ebp
   897 000007F2 C1E503                                  shl     ebp, 3
   898 000007F5 C1C003                                  rol     eax, 3
   899 000007F8 31E8                                    xor     eax, ebp
   900 000007FA 80ED03                                  sub     ch, 3
   901 000007FD 7913                                    jns     short .without_crc_@@@@@@@
   902 000007FF 88E9                                    mov     cl, ch
   903 00000801 80C510                                  add     ch, 10h
   904 00000804 D3C5                                    rol     ebp, cl
   905 00000806 668B2E                                  mov     bp, [esi]
   906 00000809 83C602                                  add     esi, 2
   907 0000080C 66C1CD08                                ror     bp, 8
   908 00000810 D3CD                                    ror     ebp, cl
   909                                  
   910                                  .without_crc_@@@@@@@:
   911 00000812 C1E003                                  shl     eax, 3
   912 00000815 89434C                                  mov     [ebx+76], eax   ; [ebx+$mp3gr_subblock_gain+nn*4] ; nn=2
   913 00000818 E910010000                              jmp     .blocksplit_done
   914                                  
   915                                  .no_blocksplit:                       
   916 0000081D C7432C00000000                          mov     dword [ebx+44], 0 ; [ebx+$mp3gr_block_type]
   917 00000824 C7433000000000                          mov     dword [ebx+48], 0 ; [ebx+$mp3gr_switch_point]
   918 0000082B 89E8                                    mov     eax, ebp        ; IRP nn,0,1,2 ; range 0..2 when non-blocksplit
   919 0000082D C1E505                                  shl     ebp, 5          ; mp3mac_get_n_bits 5
   920 00000830 C1C005                                  rol     eax, 5
   921 00000833 31E8                                    xor     eax, ebp
   922 00000835 80ED05                                  sub     ch, 5
   923 00000838 7913                                    jns     short .@_without_crc
   924 0000083A 88E9                                    mov     cl, ch
   925 0000083C 80C510                                  add     ch, 10h
   926 0000083F D3C5                                    rol     ebp, cl
   927 00000841 668B2E                                  mov     bp, [esi]
   928 00000844 83C602                                  add     esi, 2
   929 00000847 66C1CD08                                ror     bp, 8
   930 0000084B D3CD                                    ror     ebp, cl
   931                                  
   932                                  .@_without_crc:
   933 0000084D 894338                                  mov     [ebx+56], eax   ; [ebx+$mp3gr_table_select+nn*4] ; nn=0
   934 00000850 89E8                                    mov     eax, ebp
   935 00000852 C1E505                                  shl     ebp, 5
   936 00000855 C1C005                                  rol     eax, 5
   937 00000858 31E8                                    xor     eax, ebp
   938 0000085A 80ED05                                  sub     ch, 5
   939 0000085D 7913                                    jns     short .@_without_crc_@
   940 0000085F 88E9                                    mov     cl, ch
   941 00000861 80C510                                  add     ch, 10h
   942 00000864 D3C5                                    rol     ebp, cl
   943 00000866 668B2E                                  mov     bp, [esi]
   944 00000869 83C602                                  add     esi, 2
   945 0000086C 66C1CD08                                ror     bp, 8
   946 00000870 D3CD                                    ror     ebp, cl
   947                                  
   948                                  .@_without_crc_@:
   949 00000872 89433C                                  mov     [ebx+60], eax   ; [ebx+$mp3gr_table_select+nn*4] ; nn=1
   950 00000875 89E8                                    mov     eax, ebp
   951 00000877 C1E505                                  shl     ebp, 5
   952 0000087A C1C005                                  rol     eax, 5
   953 0000087D 31E8                                    xor     eax, ebp
   954 0000087F 80ED05                                  sub     ch, 5
   955 00000882 7913                                    jns     short .@_without_crc_@@
   956 00000884 88E9                                    mov     cl, ch
   957 00000886 80C510                                  add     ch, 10h
   958 00000889 D3C5                                    rol     ebp, cl
   959 0000088B 668B2E                                  mov     bp, [esi]
   960 0000088E 83C602                                  add     esi, 2
   961 00000891 66C1CD08                                ror     bp, 8
   962 00000895 D3CD                                    ror     ebp, cl
   963                                  
   964                                  .@_without_crc_@@:
   965 00000897 894340                                  mov     [ebx+64], eax   ; [ebx+$mp3gr_table_select+nn*4] ; nn=2
   966 0000089A 89E8                                    mov     eax, ebp
   967 0000089C C1E504                                  shl     ebp, 4
   968 0000089F C1C004                                  rol     eax, 4
   969 000008A2 31E8                                    xor     eax, ebp
   970 000008A4 80ED04                                  sub     ch, 4
   971 000008A7 7913                                    jns     short .@_without_crc@@@
   972 000008A9 88E9                                    mov     cl, ch
   973 000008AB 80C510                                  add     ch, 10h
   974 000008AE D3C5                                    rol     ebp, cl
   975 000008B0 668B2E                                  mov     bp, [esi]
   976 000008B3 83C602                                  add     esi, 2
   977 000008B6 66C1CD08                                ror     bp, 8
   978 000008BA D3CD                                    ror     ebp, cl
   979                                  
   980                                  .@_without_crc@@@:
   981 000008BC 40                                      inc     eax
   982 000008BD A3[2C1D0500]                            mov     [_@@region_address0], eax
   983 000008C2 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 3
   984 000008C4 C1E503                                  shl     ebp, 3
   985 000008C7 C1C003                                  rol     eax, 3
   986 000008CA 31E8                                    xor     eax, ebp
   987 000008CC 80ED03                                  sub     ch, 3
   988 000008CF 7913                                    jns     short .@_without_crc@@@@
   989 000008D1 88E9                                    mov     cl, ch
   990 000008D3 80C510                                  add     ch, 10h
   991 000008D6 D3C5                                    rol     ebp, cl
   992 000008D8 668B2E                                  mov     bp, [esi]
   993 000008DB 83C602                                  add     esi, 2
   994 000008DE 66C1CD08                                ror     bp, 8
   995 000008E2 D3CD                                    ror     ebp, cl
   996                                  
   997                                  .@_without_crc@@@@:
   998 000008E4 40                                      inc     eax
   999 000008E5 0305[2C1D0500]                          add     eax, [_@@region_address0]
  1000 000008EB A3[301D0500]                            mov     [_@@region_address1], eax
  1001 000008F0 A1[409B0000]                            mov     eax, [mp3_hdr_sample_rate_index]
  1002 000008F5 C1E005                                  shl     eax, 5
  1003 000008F8 0305[2C1D0500]                          add     eax, [_@@region_address0]
  1004 000008FE 0FB78400[40D50100]                      movzx   eax, word [mp3_band_index_long+eax*2]
  1005 00000906 D1E8                                    shr     eax, 1
  1006 00000908 894350                                  mov     [ebx+80], eax   ; [ebx+$mp3gr_region_size+0*4]
  1007 0000090B A1[409B0000]                            mov     eax, [mp3_hdr_sample_rate_index]
  1008 00000910 C1E005                                  shl     eax, 5
  1009 00000913 0305[301D0500]                          add     eax, [_@@region_address1]
  1010 00000919 0FB78400[40D50100]                      movzx   eax, word [mp3_band_index_long+eax*2]
  1011 00000921 D1E8                                    shr     eax, 1
  1012 00000923 894354                                  mov     [ebx+84], eax   ; [ebx+$mp3gr_region_size+1*4]
  1013 00000926 C7435820010000                          mov     dword [ebx+88], 288 ; [ebx+$mp3gr_region_size+2*4],576/2
  1014                                  
  1015                                  .blocksplit_done:
  1016 0000092D 8D7B50                                  lea     edi, [ebx+80]   ; [ebx+$mp3gr_region_size+0]
  1017 00000930 31D2                                    xor     edx, edx
  1018 00000932 B103                                    mov     cl, 3
  1019                                  
  1020                                  .trunc_region_size_lop:
  1021 00000934 8B07                                    mov     eax, [edi]
  1022 00000936 3B430C                                  cmp     eax, [ebx+12]   ; [ebx+$mp3gr_big_values]
  1023 00000939 7603                                    jbe     short .trunc_region_size_this
  1024 0000093B 8B430C                                  mov     eax, [ebx+12]
  1025                                  
  1026                                  .trunc_region_size_this:
  1027 0000093E 29D0                                    sub     eax, edx
  1028 00000940 8907                                    mov     [edi], eax
  1029 00000942 01C2                                    add     edx, eax
  1030 00000944 83C704                                  add     edi, 4
  1031 00000947 FEC9                                    dec     cl
  1032 00000949 75E9                                    jnz     short .trunc_region_size_lop
  1033 0000094B C7431C0D000000                          mov     dword [ebx+28], 13 ; [ebx+$mp3gr_short_start]
  1034 00000952 C7432016000000                          mov     dword [ebx+32], 22 ; [ebx+$mp3gr_long_end]
  1035 00000959 837B2C02                                cmp     dword [ebx+44], 2 ; [ebx+$mp3gr_block_type]
  1036 0000095D 7549                                    jnz     short .these_band_indices
  1037 0000095F C7431C00000000                          mov     dword [ebx+28], 0 ; [ebx+$mp3gr_short_start]
  1038 00000966 C7432000000000                          mov     dword [ebx+32], 0 ; [ebx+$mp3gr_long_end]
  1039 0000096D 837B3000                                cmp     dword [ebx+48], 0 ; [ebx+$mp3gr_switch_point]
  1040 00000971 7435                                    jz      short .these_band_indices
  1041 00000973 C7431C02000000                          mov     dword [ebx+28], 2 ; [ebx+$mp3gr_short_start]
  1042 0000097A C7432004000000                          mov     dword [ebx+32], 4 ; [ebx+$mp3gr_long_end]
  1043 00000981 833D[409B0000]08                        cmp     dword [mp3_hdr_sample_rate_index], 8
  1044 00000988 741E                                    jz      short .these_band_indices
  1045 0000098A 833D[409B0000]02                        cmp     dword [mp3_hdr_sample_rate_index], 2
  1046 00000991 C7431C03000000                          mov     dword [ebx+28], 3 ; [ebx+$mp3gr_short_start]
  1047 00000998 C7432008000000                          mov     dword [ebx+32], 8 ; [ebx+$mp3gr_long_end]
  1048 0000099F 7607                                    jbe     short .these_band_indices
  1049 000009A1 C7432006000000                          mov     dword [ebx+32], 6 ; [ebx+$mp3gr_long_end]
  1050                                  
  1051                                  .these_band_indices:
  1052 000009A8 31C0                                    xor     eax, eax
  1053 000009AA 833D[6C9B0000]00                        cmp     dword [mp3_hdr_flag_lsf], 0
  1054 000009B1 7520                                    jnz     short .no_preflag
  1055 000009B3 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 1
  1056 000009B5 D1E5                                    shl     ebp, 1
  1057 000009B7 D1C0                                    rol     eax, 1
  1058 000009B9 31E8                                    xor     eax, ebp
  1059 000009BB 80ED01                                  sub     ch, 1
  1060 000009BE 7913                                    jns     short .no_preflag
  1061 000009C0 88E9                                    mov     cl, ch
  1062 000009C2 80C510                                  add     ch, 10h
  1063 000009C5 D3C5                                    rol     ebp, cl
  1064 000009C7 668B2E                                  mov     bp, [esi]
  1065 000009CA 83C602                                  add     esi, 2
  1066 000009CD 66C1CD08                                ror     bp, 8
  1067 000009D1 D3CD                                    ror     ebp, cl
  1068                                  
  1069                                  .no_preflag:
  1070 000009D3 894318                                  mov     [ebx+24], eax   ; [ebx+$mp3gr_preflag]
  1071 000009D6 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 1
  1072 000009D8 D1E5                                    shl     ebp, 1
  1073 000009DA D1C0                                    rol     eax, 1
  1074 000009DC 31E8                                    xor     eax, ebp
  1075 000009DE 80ED01                                  sub     ch, 1
  1076 000009E1 7913                                    jns     short .@_without_crc@@@@@
  1077 000009E3 88E9                                    mov     cl, ch
  1078 000009E5 80C510                                  add     ch, 10h
  1079 000009E8 D3C5                                    rol     ebp, cl
  1080 000009EA 668B2E                                  mov     bp, [esi]
  1081 000009ED 83C602                                  add     esi, 2
  1082 000009F0 66C1CD08                                ror     bp, 8
  1083 000009F4 D3CD                                    ror     ebp, cl
  1084                                  
  1085                                  .@_without_crc@@@@@:
  1086 000009F6 40                                      inc     eax
  1087 000009F7 894334                                  mov     [ebx+52], eax   ; [ebx+$mp3gr_scalefac_scale]
  1088 000009FA 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 1
  1089 000009FC D1E5                                    shl     ebp, 1
  1090 000009FE D1C0                                    rol     eax, 1
  1091 00000A00 31E8                                    xor     eax, ebp
  1092 00000A02 80ED01                                  sub     ch, 1
  1093 00000A05 7913                                    jns     short .@_without_crc@@@@@@
  1094 00000A07 88E9                                    mov     cl, ch
  1095 00000A09 80C510                                  add     ch, 10h
  1096 00000A0C D3C5                                    rol     ebp, cl
  1097 00000A0E 668B2E                                  mov     bp, [esi]
  1098 00000A11 83C602                                  add     esi, 2
  1099 00000A14 66C1CD08                                ror     bp, 8
  1100 00000A18 D3CD                                    ror     ebp, cl
  1101                                  
  1102                                  .@_without_crc@@@@@@: 
  1103 00000A1A 83C010                                  add     eax, 10h        ; table 10h..11h (quad_vlc)
  1104 00000A1D 894324                                  mov     [ebx+36], eax   ; [ebx+$mp3gr_count1table_select]
  1105 00000A20 81C340130000                            add     ebx, 4928       ; $mp3gr_entrysiz*2
  1106 00000A26 FF05[1CF20000]                          inc     dword [mp3_curr_channel]
  1107 00000A2C A1[1CF20000]                            mov     eax, [mp3_curr_channel]
  1108 00000A31 3B05[489B0000]                          cmp     eax, [mp3_src_num_channels]
  1109 00000A37 0F82C1FBFFFF                            jb      .hdr_channel_lop
  1110 00000A3D 5B                                      pop     ebx
  1111 00000A3E 81C3A0090000                            add     ebx, 2464       ; $mp3gr_entrysiz
  1112 00000A44 FF05[20F20000]                          inc     dword [mp3_curr_granule]
  1113 00000A4A A1[20F20000]                            mov     eax, [mp3_curr_granule]
  1114 00000A4F 3B05[3CF20000]                          cmp     eax, [mp3_nb_granules]
  1115 00000A55 0F8298FBFFFF                            jb      .hdr_granule_lop
  1116 00000A5B F605[DC730000]10                        test    byte [cpuid_flags], 10h ; timelog_end rdtsc_read_granule
  1117 00000A62 740E                                    jz      short .no_rdtsc_supported@
  1118 00000A64 0F31                                    rdtsc
  1119 00000A66 0105[1C740000]                          add     [rdtsc_read_granule], eax
  1120 00000A6C 1115[20740000]                          adc     [rdtsc_read_granule+4], edx
  1121                                  
  1122                                  .no_rdtsc_supported@:
  1123 00000A72 F8                                      clc
  1124 00000A73 C3                                      retn
  1125                                  
  1126                                  .error:
  1127 00000A74 F605[DC730000]10                        test    byte [cpuid_flags], 10h ; timelog_end rdtsc_read_granule
  1128 00000A7B 740E                                    jz      short .no_rdtsc_supported@@
  1129 00000A7D 0F31                                    rdtsc
  1130 00000A7F 0105[1C740000]                          add     [rdtsc_read_granule], eax
  1131 00000A85 1115[20740000]                          adc     [rdtsc_read_granule+4], edx
  1132                                  
  1133                                  .no_rdtsc_supported@@:
  1134 00000A8B 8B25[341D0500]                          mov     esp, [_@@saved_sp]
  1135 00000A91 F9                                      stc
  1136 00000A92 C3                                      retn
  1137                                  
  1138                                  
  1139                                  ; =============== S U B R O U T I N E =======================================
  1140                                  
  1141                                  
  1142                                  mp3_bitstream_append_to_main_data_pool:
  1143 00000A93 F605[DC730000]10                        test    byte [cpuid_flags], 10h ; timelog_start rdtsc_append_main
  1144 00000A9A 740E                                    jz      short .no_rdtsc_supported
  1145 00000A9C 0F31                                    rdtsc
  1146 00000A9E 2905[34740000]                          sub     [rdtsc_append_main], eax
  1147 00000AA4 1915[38740000]                          sbb     [rdtsc_append_main+4], edx
  1148                                  
  1149                                  .no_rdtsc_supported:
  1150 00000AAA 8B0D[289B0000]                          mov     ecx, [mp3_src_frame_end]
  1151 00000AB0 29F1                                    sub     ecx, esi
  1152 00000AB2 0F8266020000                            jb      fatalunexpected
  1153 00000AB8 8B3D[1C9B0000]                          mov     edi, [main_data_pool_wr_ptr]
  1154 00000ABE 8D040F                                  lea     eax, [edi+ecx]
  1155 00000AC1 3D[1C9B0000]                            cmp     eax, main_data_pool_wr_ptr
  1156 00000AC6 7616                                    jbe     short .pool_inrange
  1157 00000AC8 51                                      push    ecx
  1158 00000AC9 56                                      push    esi
  1159 00000ACA 8DB700FEFFFF                            lea     esi, [edi-200h]
  1160 00000AD0 BF[1C8B0000]                            mov     edi, main_data_pool_start
  1161 00000AD5 B980000000                              mov     ecx, 128
  1162 00000ADA F3A5                                    rep movsd
  1163 00000ADC 5E                                      pop     esi
  1164 00000ADD 59                                      pop     ecx
  1165                                  
  1166                                  .pool_inrange:
  1167 00000ADE 89F8                                    mov     eax, edi
  1168 00000AE0 2B05[34F20000]                          sub     eax, [mp3_main_data_begin]
  1169 00000AE6 F3A4                                    rep movsb
  1170 00000AE8 893D[1C9B0000]                          mov     [main_data_pool_wr_ptr], edi
  1171 00000AEE 3D[1C8B0000]                            cmp     eax, main_data_pool_start
  1172 00000AF3 7828                                    js      short .below_pool_start
  1173 00000AF5 A3[28F20000]                            mov     [mp3_bitstream_start], eax
  1174                                                  ; 22/10/2024
  1175                                  		;mov    eax, 0
  1176 00000AFA 8B35[28F20000]                          mov     esi, [mp3_bitstream_start] ; mp3mac_bitstream_set_position
  1177                                                  ;mov    cl, al
  1178                                                  ;shr    eax, 3
  1179                                                  ;and    cl, 7
  1180                                                  ;add    esi, eax
  1181 00000B00 E8C7F6FFFF                              call    mp3_recollect_bits
  1182                                                  ;mov    eax, ebp        ; mp3mac_get_n_bits cl
  1183                                                  ;shl    ebp, cl
  1184                                                  ;rol    eax, cl
  1185                                                  ;xor    eax, ebp
  1186                                                  ;sub    ch, cl
  1187                                                  ;jns    short .cont
  1188                                                  ;mov    cl, ch          ; mp3mac_collect_more
  1189                                                  ;add    ch, 10h
  1190                                                  ;rol    ebp, cl
  1191                                                  ;mov    bp, [esi]
  1192                                                  ;add    esi, 2
  1193                                                  ;ror    bp, 8
  1194                                                  ;ror    ebp, cl
  1195                                  
  1196                                  .cont:
  1197 00000B05 F605[DC730000]10                        test    byte [cpuid_flags], 10h ; timelog_end rdtsc_append_main
  1198 00000B0C 740E                                    jz      short .no_rdtsc_supported@
  1199 00000B0E 0F31                                    rdtsc
  1200 00000B10 0105[34740000]                          add     [rdtsc_append_main], eax
  1201 00000B16 1115[38740000]                          adc     [rdtsc_append_main+4], edx
  1202                                  
  1203                                  .no_rdtsc_supported@:
  1204 00000B1C C3                                      retn
  1205                                  
  1206                                  .below_pool_start:
  1207 00000B1D C705[14F20000]0000-                     mov     dword [mp3_samples_output_size], 0
  1207 00000B25 0000               
  1208 00000B27 EBDC                                    jmp     short .cont
  1209                                  
  1210                                  
  1211                                  ; =============== S U B R O U T I N E =======================================
  1212                                  
  1213                                  
  1214                                  mp3_bitstream_read_scalefacs:
  1215 00000B29 F605[DC730000]10                        test    byte [cpuid_flags], 10h ; timelog_start rdtsc_read_scalefac
  1216 00000B30 740E                                    jz      short .no_rdtsc_supported
  1217 00000B32 0F31                                    rdtsc
  1218 00000B34 2905[4C740000]                          sub     [rdtsc_read_scalefac], eax
  1219 00000B3A 1915[50740000]                          sbb     [rdtsc_read_scalefac+4], edx
  1220                                  
  1221                                  .no_rdtsc_supported:
  1222 00000B40 8D7B70                                  lea     edi, [ebx+112]  ; [ebx+$mp3gr_scale_factors]
  1223 00000B43 833D[6C9B0000]00                        cmp     dword [mp3_hdr_flag_lsf], 0
  1224 00000B4A 0F850D010000                            jnz     .body_lsf_nonzero
  1225 00000B50 8B4314                                  mov     eax, [ebx+20]   ; [ebx+$mp3gr_scalefac_compress]
  1226 00000B53 668B9400[2C780000]                      mov     dx, [mp3_slen_table+eax*2] ; slen[0,1]
  1227 00000B5B 837B2C02                                cmp     dword [ebx+44], 2 ; [ebx+$mp3gr_block_type]
  1228 00000B5F 757F                                    jnz     short .body_lsf_zero_non_type2
  1229 00000B61 53                                      push    ebx
  1230 00000B62 B012                                    mov     al, 18
  1231 00000B64 2A4330                                  sub     al, [ebx+48]    ; [ebx+$mp3gr_switch_point]
  1232 00000B67 88C3                                    mov     bl, al          ; @@get_bl_scalefacs_with_dl_bits 0
  1233 00000B69 80FA00                                  cmp     dl, 0
  1234 00000B6C 7428                                    jz      short .quickfill
  1235                                  
  1236                                  .scalefac_get_lop:
  1237 00000B6E 88D1                                    mov     cl, dl          ; LSB of edx, slen[i]
  1238 00000B70 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits cl
  1239 00000B72 D3E5                                    shl     ebp, cl
  1240 00000B74 D3C0                                    rol     eax, cl
  1241 00000B76 31E8                                    xor     eax, ebp
  1242 00000B78 28CD                                    sub     ch, cl
  1243 00000B7A 7913                                    jns     short .cont@
  1244 00000B7C 88E9                                    mov     cl, ch          ; mp3mac_collect_more
  1245 00000B7E 80C510                                  add     ch, 10h
  1246 00000B81 D3C5                                    rol     ebp, cl
  1247 00000B83 668B2E                                  mov     bp, [esi]
  1248 00000B86 83C602                                  add     esi, 2
  1249 00000B89 66C1CD08                                ror     bp, 8
  1250 00000B8D D3CD                                    ror     ebp, cl
  1251                                  
  1252                                  .cont@:
  1253 00000B8F AA                                      stosb
  1254 00000B90 FECB                                    dec     bl
  1255 00000B92 75DA                                    jnz     short .scalefac_get_lop
  1256 00000B94 EB09                                    jmp     short .skip_quickfill
  1257                                  
  1258                                  .quickfill:
  1259 00000B96 51                                      push    ecx
  1260 00000B97 0FB6CB                                  movzx   ecx, bl
  1261 00000B9A B000                                    mov     al, 0           ; NO_INTENSITY_FLAG
  1262 00000B9C F3AA                                    rep stosb
  1263 00000B9E 59                                      pop     ecx
  1264                                  
  1265                                  .skip_quickfill:
  1266 00000B9F C1EA08                                  shr     edx, 8
  1267 00000BA2 B312                                    mov     bl, 18
  1268 00000BA4 80FA00                                  cmp     dl, 0           ; @@get_bl_scalefacs_with_dl_bits 0
  1269 00000BA7 7428                                    jz      short .quickfill@
  1270                                  
  1271                                  .scalefac_get_lop@:
  1272 00000BA9 88D1                                    mov     cl, dl
  1273 00000BAB 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits cl
  1274 00000BAD D3E5                                    shl     ebp, cl
  1275 00000BAF D3C0                                    rol     eax, cl
  1276 00000BB1 31E8                                    xor     eax, ebp
  1277 00000BB3 28CD                                    sub     ch, cl
  1278 00000BB5 7913                                    jns     short .cont@@
  1279 00000BB7 88E9                                    mov     cl, ch          ; mp3mac_collect_more
  1280 00000BB9 80C510                                  add     ch, 10h
  1281 00000BBC D3C5                                    rol     ebp, cl
  1282 00000BBE 668B2E                                  mov     bp, [esi]
  1283 00000BC1 83C602                                  add     esi, 2
  1284 00000BC4 66C1CD08                                ror     bp, 8
  1285 00000BC8 D3CD                                    ror     ebp, cl
  1286                                  
  1287                                  .cont@@:
  1288 00000BCA AA                                      stosb
  1289 00000BCB FECB                                    dec     bl
  1290 00000BCD 75DA                                    jnz     short .scalefac_get_lop@
  1291 00000BCF EB09                                    jmp     short .skip_quickfill@
  1292                                  
  1293                                  .quickfill@:
  1294 00000BD1 51                                      push    ecx
  1295 00000BD2 0FB6CB                                  movzx   ecx, bl
  1296 00000BD5 B000                                    mov     al, 0
  1297 00000BD7 F3AA                                    rep stosb
  1298 00000BD9 59                                      pop     ecx
  1299                                  
  1300                                  .skip_quickfill@:
  1301 00000BDA 5B                                      pop     ebx
  1302 00000BDB E914010000                              jmp     .body_lsf_zeropad
  1303                                  
  1304                                  .body_lsf_zero_non_type2:
  1305 00000BE0 53                                      push    ebx
  1306 00000BE1 C1CA08                                  ror     edx, 8
  1307 00000BE4 88D6                                    mov     dh, dl          ; slen[0,1,2,3] = slen[0,0,1,1]
  1308 00000BE6 C1C210                                  rol     edx, 16
  1309 00000BE9 88F2                                    mov     dl, dh
  1310 00000BEB 8A4328                                  mov     al, [ebx+40]    ; [ebx+$mp3gr_scfsi]
  1311 00000BEE C0E004                                  shl     al, 4           ; move to upper 4bit
  1312 00000BF1 A2[3C1D0500]                            mov     byte [_@@scfsi], al
  1313 00000BF6 BB06050505                              mov     ebx, 5050506h   ; num[0..3]
  1314                                  
  1315                                  .body_lsf_zero_non_type2_lop:
  1316 00000BFB D025[3C1D0500]                          shl     byte [_@@scfsi], 1
  1317 00000C01 7238                                    jb      short .body_lsf_zero_non_type2_copy
  1318 00000C03 80FA00                                  cmp     dl, 0           ; @@get_bl_scalefacs_with_dl_bits 0
  1319 00000C06 7428                                    jz      short .quickfill@@
  1320                                  
  1321                                  .scalefac_get_lop@@:
  1322 00000C08 88D1                                    mov     cl, dl
  1323 00000C0A 89E8                                    mov     eax, ebp
  1324 00000C0C D3E5                                    shl     ebp, cl
  1325 00000C0E D3C0                                    rol     eax, cl
  1326 00000C10 31E8                                    xor     eax, ebp
  1327 00000C12 28CD                                    sub     ch, cl
  1328 00000C14 7913                                    jns     short .cont@@@
  1329 00000C16 88E9                                    mov     cl, ch
  1330 00000C18 80C510                                  add     ch, 10h
  1331 00000C1B D3C5                                    rol     ebp, cl
  1332 00000C1D 668B2E                                  mov     bp, [esi]
  1333 00000C20 83C602                                  add     esi, 2
  1334 00000C23 66C1CD08                                ror     bp, 8
  1335 00000C27 D3CD                                    ror     ebp, cl
  1336                                  
  1337                                  .cont@@@:
  1338 00000C29 AA                                      stosb
  1339 00000C2A FECB                                    dec     bl
  1340 00000C2C 75DA                                    jnz     short .scalefac_get_lop@@
  1341 00000C2E EB09                                    jmp     short .skip_quickfill@@
  1342                                  
  1343                                  .quickfill@@:
  1344 00000C30 51                                      push    ecx
  1345 00000C31 0FB6CB                                  movzx   ecx, bl
  1346 00000C34 B000                                    mov     al, 0
  1347 00000C36 F3AA                                    rep stosb
  1348 00000C38 59                                      pop     ecx
  1349                                  
  1350                                  .skip_quickfill@@:
  1351 00000C39 EB11                                    jmp     short .body_lsf_zero_non_type2_next
  1352                                  
  1353                                  .body_lsf_zero_non_type2_copy:
  1354 00000C3B 51                                      push    ecx
  1355 00000C3C 89F0                                    mov     eax, esi
  1356 00000C3E 0FB6CB                                  movzx   ecx, bl         ; copy
  1357 00000C41 8DB760F6FFFF                            lea     esi, [edi-2464] ; [edi-$mp3gr_entrysiz] ; src=granule[0] ; from
  1358 00000C47 F3A4                                    rep movsb               ; prev
  1359 00000C49 89C6                                    mov     esi, eax
  1360 00000C4B 59                                      pop     ecx
  1361                                  
  1362                                  .body_lsf_zero_non_type2_next:
  1363 00000C4C C1EA08                                  shr     edx, 8          ; dl=next slen
  1364 00000C4F C1EB08                                  shr     ebx, 8          ; bl=next numfacs
  1365 00000C52 75A7                                    jnz     short .body_lsf_zero_non_type2_lop
  1366 00000C54 5B                                      pop     ebx
  1367 00000C55 B000                                    mov     al, 0
  1368 00000C57 AA                                      stosb
  1369 00000C58 E9A9000000                              jmp     .body_lsf_done
  1370                                  
  1371                                  .body_lsf_nonzero:
  1372 00000C5D 8B5314                                  mov     edx, [ebx+14h]  ; [ebx+$mp3gr_scalefac_compress]
  1373 00000C60 F705[689B0000]0100-                     test    dword [mp3_hdr_mode_ext], 1 ; MODE_EXT_I_STEREO
  1373 00000C68 0000               
  1374 00000C6A 740F                                    jz      short .normal_scalefac
  1375 00000C6C 833D[1CF20000]00                        cmp     dword [mp3_curr_channel], 0
  1376 00000C73 7406                                    jz      short .normal_scalefac
  1377 00000C75 81C200020000                            add     edx, 512        ; for 2nd channel of intensity_stereo
  1378                                  
  1379                                  .normal_scalefac:
  1380 00000C7B 8A04D5[31FD0400]                        mov     al, [(mp3_lsf_sf_expand_exploded_table+5)+edx*8]
  1381 00000C82 084318                                  or      [ebx+24], al    ; [ebx+$mp3gr_preflag]
  1382 00000C85 53                                      push    ebx
  1383 00000C86 0FB604D5[30FD0400]                      movzx   eax, byte [(mp3_lsf_sf_expand_exploded_table+4)+edx*8]
  1384 00000C8E 837B2C02                                cmp     dword [ebx+44], 2 ;  [ebx+$mp3gr_block_type]
  1385 00000C92 7507                                    jnz     short .this_tindex1
  1386 00000C94 8B5B30                                  mov     ebx, [ebx+48]   ; [ebx+$mp3gr_switch_point]
  1387 00000C97 8D449804                                lea     eax, [eax+ebx*4+4]
  1388                                  
  1389                                  .this_tindex1:
  1390 00000C9B 8B98[4C780000]                          mov     ebx, [mp3_lsf_nsf_table+eax]
  1391 00000CA1 8B14D5[2CFD0400]                        mov     edx, dword [mp3_lsf_sf_expand_exploded_table+edx*8]
  1392                                  
  1393                                  .scalefax_outer_lop:
  1394 00000CA8 80FA00                                  cmp     dl, 0           ; @@get_bl_scalefacs_with_dl_bits 1
  1395 00000CAB 7435                                    jz      short .@quickfil
  1396                                  
  1397                                  .@scalefac_get_lop:
  1398 00000CAD 88D1                                    mov     cl, dl
  1399 00000CAF 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits cl
  1400 00000CB1 D3E5                                    shl     ebp, cl
  1401 00000CB3 D3C0                                    rol     eax, cl
  1402 00000CB5 31E8                                    xor     eax, ebp
  1403 00000CB7 28CD                                    sub     ch, cl
  1404 00000CB9 7913                                    jns     short .cont
  1405 00000CBB 88E9                                    mov     cl, ch
  1406 00000CBD 80C510                                  add     ch, 10h
  1407 00000CC0 D3C5                                    rol     ebp, cl
  1408 00000CC2 668B2E                                  mov     bp, [esi]
  1409 00000CC5 83C602                                  add     esi, 2
  1410 00000CC8 66C1CD08                                ror     bp, 8
  1411 00000CCC D3CD                                    ror     ebp, cl
  1412                                  
  1413                                  .cont:
  1414 00000CCE 88D1                                    mov     cl, dl          ; numbits
  1415 00000CD0 88C4                                    mov     ah, al
  1416 00000CD2 FEC4                                    inc     ah              ; val+1
  1417 00000CD4 D2EC                                    shr     ah, cl          ; bit0=is.max.value
  1418 00000CD6 C0E407                                  shl     ah, 7           ; bit7=is.max.value
  1419 00000CD9 08E0                                    or      al, ah          ; apply NO_INTENSITY_FLAG
  1420 00000CDB AA                                      stosb
  1421 00000CDC FECB                                    dec     bl
  1422 00000CDE 75CD                                    jnz     short .@scalefac_get_lop
  1423 00000CE0 EB09                                    jmp     short .@skip_quickfill
  1424                                  
  1425                                  .@quickfil:
  1426 00000CE2 51                                      push    ecx
  1427 00000CE3 0FB6CB                                  movzx   ecx, bl
  1428 00000CE6 B080                                    mov     al, 80h
  1429 00000CE8 F3AA                                    rep stosb
  1430 00000CEA 59                                      pop     ecx
  1431                                  
  1432                                  .@skip_quickfill:
  1433 00000CEB C1EA08                                  shr     edx, 8
  1434 00000CEE C1EB08                                  shr     ebx, 8
  1435 00000CF1 75B5                                    jnz     short .scalefax_outer_lop
  1436 00000CF3 5B                                      pop     ebx
  1437                                  
  1438                                  .body_lsf_zeropad:
  1439 00000CF4 89CA                                    mov     edx, ecx
  1440 00000CF6 8D8B98000000                            lea     ecx, [ebx+152]  ; [ebx+$mp3gr_scale_factors+40]
  1441 00000CFC 29F9                                    sub     ecx, edi
  1442                                                  ;jb     short fatal_scalefactors
  1443                                  		; 21/10/2024
  1444 00000CFE 721E                    		jb	short fatalunexpected
  1445 00000D00 B000                                    mov     al, 0
  1446 00000D02 F3AA                                    rep stosb
  1447 00000D04 89D1                                    mov     ecx, edx
  1448                                  
  1449                                  .body_lsf_done:
  1450 00000D06 F605[DC730000]10                        test    byte [cpuid_flags], 10h ; timelog_end rdtsc_read_scalefac
  1451 00000D0D 740E                                    jz      short .no_rdtsc_supported@@@
  1452 00000D0F 0F31                                    rdtsc
  1453 00000D11 0105[4C740000]                          add     [rdtsc_read_scalefac], eax
  1454 00000D17 1115[50740000]                          adc     [rdtsc_read_scalefac+4], edx
  1455                                  
  1456                                  .no_rdtsc_supported@@@:
  1457 00000D1D C3                                      retn
  1458                                  
  1459                                  		; 21/10/2024
  1460                                  ;fatal_scalefactors:
  1461                                                  ;jmp    fatalunexpected
  1462                                  
  1463                                  ; ---------------------------------------------------------------------------
  1464                                  
  1465                                  		; 21/10/2024
  1466                                  fatalunexpected:                       
  1467 00000D1E F735[B8820000]                          div	dword [zero]
  1468                                  hang:
  1469 00000D24 EBFE                                    jmp     short hang
  1470                                  
  1471                                  
  1472                                  ; =============== S U B R O U T I N E =======================================
  1473                                  
  1474                                  
  1475                                  mp3_get_exponents_from_scale_factors:
  1476 00000D26 F605[DC730000]10                        test    byte [cpuid_flags], 10h ; timelog_start rdtsc_xlat_scalefac
  1477 00000D2D 740E                                    jz      short .no_rdtsc_supported
  1478 00000D2F 0F31                                    rdtsc
  1479 00000D31 2905[64740000]                          sub     [rdtsc_xlat_scalefac], eax
  1480 00000D37 1915[68740000]                          sbb     [rdtsc_xlat_scalefac+4], edx
  1481                                  
  1482                                  .no_rdtsc_supported:
  1483 00000D3D 51                                      push    ecx             ; mp3mac_push_bitstream
  1484 00000D3E 55                                      push    ebp
  1485 00000D3F 56                                      push    esi
  1486 00000D40 C705[4C1D0500]0000-                     mov     dword [_@@rle_point], 0
  1486 00000D48 0000               
  1487 00000D4A 8A4B34                                  mov     cl, [ebx+52]    ; [ebx+$mp3gr_scalefac_scale]
  1488 00000D4D BF[C0180100]                            mov     edi, mp3_exponents
  1489 00000D52 31D2                                    xor     edx, edx
  1490 00000D54 3B5320                                  cmp     edx, [ebx+32]   ; [ebx+$mp3gr_long_end]
  1491 00000D57 7345                                    jnb     short .long_done
  1492 00000D59 A1[409B0000]                            mov     eax, [mp3_hdr_sample_rate_index]
  1493 00000D5E 6BC016                                  imul    eax, 22
  1494 00000D61 8DA8[5C7E0000]                          lea     ebp, [mp3_band_size_long+eax]
  1495 00000D67 8B4318                                  mov     eax, [ebx+24]   ; [ebx+$mp3gr_preflag]
  1496 00000D6A 6BC016                                  imul    eax, 22
  1497 00000D6D 8DB0[AC7F0000]                          lea     esi, [mp3_pretab+eax]
  1498                                  
  1499                                  .long_lop:
  1500 00000D73 0FB6441370                              movzx   eax, byte [ebx+edx+112] ; [ebx+$mp3gr_scale_factors+edx]
  1501 00000D78 247F                                    and     al, 7Fh         ; strip NO_INTENSITY_FLAG
  1502 00000D7A 020416                                  add     al, [esi+edx]
  1503 00000D7D D3E0                                    shl     eax, cl
  1504 00000D7F F7D8                                    neg     eax
  1505 00000D81 034310                                  add     eax, [ebx+16]   ; [ebx+$mp3gr_global_gain]
  1506 00000D84 C1E010                                  shl     eax, 16
  1507 00000D87 8A441500                                mov     al, [ebp+edx+0]
  1508 00000D8B 0305[4C1D0500]                          add     eax, [_@@rle_point]
  1509 00000D91 66A3[4C1D0500]                          mov     word [_@@rle_point], ax
  1510 00000D97 AB                                      stosd
  1511 00000D98 42                                      inc     edx
  1512 00000D99 3B5320                                  cmp     edx, [ebx+32]   ; [ebx+$mp3gr_long_end]
  1513 00000D9C 72D5                                    jb      short .long_lop
  1514                                  
  1515                                  .long_done:
  1516 00000D9E 8B531C                                  mov     edx, [ebx+28]   ; [ebx+$mp3gr_short_start]
  1517 00000DA1 83FA0D                                  cmp     edx, 13
  1518 00000DA4 0F83AA000000                            jnb     .skip_shorts
  1519 00000DAA A1[409B0000]                            mov     eax, [mp3_hdr_sample_rate_index]
  1520 00000DAF 6BC00D                                  imul    eax, 13
  1521 00000DB2 8DA8[2C7F0000]                          lea     ebp, [mp3_band_size_short+eax]
  1522 00000DB8 8B7320                                  mov     esi, [ebx+32]   ; [ebx+$mp3gr_long_end]
  1523 00000DBB 8B4310                                  mov     eax, [ebx+16]   ; [ebx+$mp3gr_global_gain]
  1524                                                                          ; IRP nn,0,1,2
  1525 00000DBE 2B4344                                  sub     eax, [ebx+68]   ; [ebx+$mp3gr_subblock_gain+nn*4]
  1526 00000DC1 A3[401D0500]                            mov     [_@@gains], eax ; [@@gains+nn*4]
  1527 00000DC6 8B4310                                  mov     eax, [ebx+16]
  1528 00000DC9 2B4348                                  sub     eax, [ebx+72]
  1529 00000DCC A3[441D0500]                            mov     [_@@gains+4], eax ; [@@gains+nn*4]
  1530 00000DD1 8B4310                                  mov     eax, [ebx+16]
  1531 00000DD4 2B434C                                  sub     eax, [ebx+76]   ; [ebx+$mp3gr_subblock_gain+nn*4]
  1532 00000DD7 A3[481D0500]                            mov     [_@@gains+8], eax ; [@@gains+nn*4]
  1533                                  
  1534                                  .short_lop:
  1535 00000DDC 0FB6443370                              movzx   eax, byte [ebx+esi+112] ; [ebx+$mp3gr_scale_factors+esi]
  1536                                                                          ; IRP nn,0,1,2
  1537 00000DE1 247F                                    and     al, 7Fh         ; strip NO_INTENSITY_FLAG
  1538 00000DE3 46                                      inc     esi
  1539 00000DE4 D3E0                                    shl     eax, cl
  1540 00000DE6 F7D8                                    neg     eax
  1541 00000DE8 0305[401D0500]                          add     eax, [_@@gains] ; [@@gains+nn*4] ; nn=0
  1542 00000DEE C1E010                                  shl     eax, 16
  1543 00000DF1 8A441500                                mov     al, [ebp+edx+0] ; bstab[edx]
  1544 00000DF5 0305[4C1D0500]                          add     eax, [_@@rle_point]
  1545 00000DFB 66A3[4C1D0500]                          mov     word [_@@rle_point], ax
  1546 00000E01 AB                                      stosd                   ; msw=val, lsw=point
  1547 00000E02 0FB6443370                              movzx   eax, byte [ebx+esi+112] ; [ebx+$mp3gr_scalefac_scale]
  1548 00000E07 247F                                    and     al, 7Fh
  1549 00000E09 46                                      inc     esi
  1550 00000E0A D3E0                                    shl     eax, cl
  1551 00000E0C F7D8                                    neg     eax
  1552 00000E0E 0305[441D0500]                          add     eax, [_@@gains+4] ; [@@gains+nn*4] ; nn = 1
  1553 00000E14 C1E010                                  shl     eax, 16
  1554 00000E17 8A441500                                mov     al, [ebp+edx+0]
  1555 00000E1B 0305[4C1D0500]                          add     eax, [_@@rle_point]
  1556 00000E21 66A3[4C1D0500]                          mov     word [_@@rle_point], ax
  1557 00000E27 AB                                      stosd
  1558 00000E28 0FB6443370                              movzx   eax, byte [ebx+esi+70h]
  1559 00000E2D 247F                                    and     al, 7Fh
  1560 00000E2F 46                                      inc     esi
  1561 00000E30 D3E0                                    shl     eax, cl
  1562 00000E32 F7D8                                    neg     eax
  1563 00000E34 0305[481D0500]                          add     eax, [_@@gains+8] ; [@@gains+nn*4] ; nn=2
  1564 00000E3A C1E010                                  shl     eax, 10h
  1565 00000E3D 8A441500                                mov     al, [ebp+edx+0]
  1566 00000E41 0305[4C1D0500]                          add     eax, [_@@rle_point]
  1567 00000E47 66A3[4C1D0500]                          mov     word [_@@rle_point], ax
  1568 00000E4D AB                                      stosd
  1569 00000E4E 42                                      inc     edx
  1570 00000E4F 83FA0D                                  cmp     edx, 13
  1571 00000E52 7288                                    jb      short .short_lop
  1572                                  
  1573                                  .skip_shorts:
  1574 00000E54 5E                                      pop     esi             ; mp3mac_pop_bitstream
  1575 00000E55 5D                                      pop     ebp
  1576 00000E56 59                                      pop     ecx
  1577 00000E57 F605[DC730000]10                        test    byte [cpuid_flags], 10h ; timelog_end rdtsc_xlat_scalefac
  1578 00000E5E 740E                                    jz      short .no_rdtsc_supported@
  1579 00000E60 0F31                                    rdtsc
  1580 00000E62 0105[64740000]                          add     [rdtsc_xlat_scalefac], eax
  1581 00000E68 1115[68740000]                          adc     [rdtsc_xlat_scalefac+4], edx
  1582                                  
  1583                                  .no_rdtsc_supported@:
  1584 00000E6E C3                                      retn
  1585                                  
  1586                                  
  1587                                  ; =============== S U B R O U T I N E =======================================
  1588                                  
  1589                                  
  1590                                  mp3_huffman_decode:
  1591 00000E6F F605[DC730000]10                        test    byte [cpuid_flags], 10h ; in: ebx=granule, out: [sb_hybrid..]
  1592                                                                          ; timelog_start rdtsc_read_huffman
  1593 00000E76 740E                                    jz      short .no_rdtsc_supported
  1594 00000E78 0F31                                    rdtsc
  1595 00000E7A 2905[7C740000]                          sub     [rdtsc_read_huffman], eax
  1596 00000E80 1915[80740000]                          sbb     [rdtsc_read_huffman+4], edx
  1597                                  
  1598                                  .no_rdtsc_supported:
  1599 00000E86 8B4308                                  mov	eax, [ebx+8]    ; [ebx+$mp3gr_part2_3_end]
  1600 00000E89 C1E803                                  shr	eax, 3
  1601 00000E8C 0305[28F20000]                          add	eax, [mp3_bitstream_start]
  1602 00000E92 A3[601D0500]                            mov	[_@@coarse_end], eax
  1603 00000E97 31FF                                    xor	edi, edi
  1604 00000E99 C705[681D0500]-                         mov	dword [_@@rle_ptr], mp3_exponents
  1604 00000E9F [C0180100]         
  1605 00000EA3 C705[641D0500]0000-                     mov	dword [_@rle_point], 0
  1605 00000EAB 0000               
  1606 00000EAD C705[501D0500]0000-                     mov	dword [_@@III], 0  ; i=0
  1606 00000EB5 0000               
  1607                                  
  1608                                  .low_freq_lop_i:
  1609 00000EB7 8B15[501D0500]                          mov     edx, [_@@III] ; for i=0 to 2
  1610                                                                          ; low frequencies (called big_values)...
  1611 00000EBD 8B449350                                mov     eax, [ebx+edx*4+80] ; [ebx+$mp3gr_region_size+edx*4]
  1612 00000EC1 83F800                                  cmp     eax, 0
  1613 00000EC4 0F84D9020000                            jz      .low_freq_next_i
  1614 00000ECA A3[541D0500]                            mov     [_@@JJJ], eax
  1615 00000ECF 8B549338                                mov     edx, [ebx+edx*4+56] ; [ebx+$mp3gr_table_select+edx*4]
  1616                                                                          ; select vlc table
  1617 00000ED3 0FB68412[1C7E0000]                      movzx   eax, byte [mp3_huff_data+edx*2] ; get huff.table number
  1618 00000EDB 83F800                                  cmp     eax, 0          ; huff.table
  1619 00000EDE 7528                                    jnz     short .low_freq_nonzero
  1620 00000EE0 51                                      push    ecx
  1621 00000EE1 57                                      push    edi
  1622 00000EE2 8DBCBBA0000000                          lea     edi, [ebx+edi*4+160] ; [ebx+$mp3gr_sb_hybrid+edi*4]
  1623 00000EE9 8B0D[541D0500]                          mov     ecx, [_@@JJJ]
  1624 00000EEF D1E1                                    shl     ecx, 1
  1625 00000EF1 31C0                                    xor     eax, eax        ; when huff.table=0,
  1626                                                                          ; simply set NUM*2 entries to zero
  1627 00000EF3 F3AB                                    rep stosd
  1628 00000EF5 5F                                      pop     edi
  1629 00000EF6 59                                      pop     ecx
  1630 00000EF7 033D[541D0500]                          add     edi, [_@@JJJ] ; raise index accordingly (by num*2)
  1631 00000EFD 033D[541D0500]                          add     edi, [_@@JJJ]
  1632 00000F03 E99B020000                              jmp     .low_freq_next_i
  1633                                  
  1634                                  .low_freq_nonzero:
  1635 00000F08 A3[5C1D0500]                            mov     [_@@vlc_table], eax ; =1..15
  1636 00000F0D 83F80E                                  cmp     eax, 14         ; only table 14..15 have linbits
  1637 00000F10 0F83FA000000                            jnb     .with_linbits  ; so table 0..13 can use faster code...
  1638                                  
  1639                                  .low_freq_lop_j_small:
  1640 00000F16 3B35[601D0500]                          cmp     esi, [_@@coarse_end] ; loop @@JJJ times..
  1641 00000F1C 0F87CF000000                            ja      .small_near_end
  1642                                  
  1643                                  .small_not_end:
  1644 00000F22 3B3D[641D0500]                          cmp     edi, [_@rle_point] ; @@get_runlength small
  1645 00000F28 0F839E030000                            jnb     .rle_fetch_next_small
  1646                                  
  1647                                  .rle_back_small:
  1648 00000F2E 8B15[5C1D0500]                          mov     edx, [_@@vlc_table] ; get huffcode
  1649                                  
  1650                                  .get_child_lop:
  1651 00000F34 8A0C95[421D0100]                        mov     cl, [(huff_tree_buf+2)+edx*4] ; mp3mac_get_huffcode
  1652                                                                          ; in: edx=table, out: eax=data
  1653                                                                          ; bits (table size) (-7..-1)
  1654 00000F3B 668B1495[401D0100]                      mov     dx, word [huff_tree_buf+edx*4] ; code (child table)
  1655 00000F43 89E8                                    mov     eax, ebp        ; mov eax,mp3_col32 ; peek bitstream
  1656 00000F45 D3E8                                    shr     eax, cl
  1657 00000F47 01C2                                    add     edx, eax
  1658 00000F49 8A0C95[421D0100]                        mov     cl, [(huff_tree_buf+2)+edx*4] ; bits (of entry)
  1659 00000F50 80F900                                  cmp     cl, 0
  1660 00000F53 7823                                    js      short .got_child
  1661 00000F55 0FB70495[401D0100]                      movzx   eax, word [huff_tree_buf+edx*4] ; return data value
  1662 00000F5D D3E5                                    shl     ebp, cl         ; shl mp3_col32,cl ; discard cl bits
  1663 00000F5F 28CD                                    sub     ch, cl          ; sub mp3_colNN,cl
  1664 00000F61 7932                                    jns     short .got_done
  1665 00000F63 88E9                                    mov     cl, ch          ; mp3mac_collect_more
  1666                                                                          ; mov cl,mp3_colNN ; byte ptr [mp3_numbits_collected]
  1667 00000F65 80C510                                  add     ch, 16          ; byte ptr [mp3_numbits_collected]
  1668 00000F68 D3C5                                    rol     ebp, cl         ; dword ptr [mp3_collected_data]
  1669 00000F6A 668B2E                                  mov     bp, [esi]
  1670 00000F6D 83C602                                  add     esi, 2
  1671 00000F70 66C1CD08                                ror     bp, 8           ; ror mp3_col16,8 ; endianess
  1672 00000F74 D3CD                                    ror     ebp, cl         ; ror mp3_col32,cl ; dword ptr [mp3_collected_data]
  1673 00000F76 EB1D                                    jmp     short .got_done
  1674                                  
  1675                                  .got_child:
  1676 00000F78 C1E509                                  shl     ebp, 9          ; shl mp3_col32,CHILD_BITS
  1677                                                                          ; discard 7 bits
  1678                                                                          ; (assuming that parents are always 7bit wide)
  1679 00000F7B 80ED09                                  sub     ch, 9
  1680 00000F7E 79B4                                    jns     short .get_child_lop
  1681 00000F80 88E9                                    mov     cl, ch          ; mp3mac_collect_more
  1682 00000F82 80C510                                  add     ch, 10h
  1683 00000F85 D3C5                                    rol     ebp, cl
  1684 00000F87 668B2E                                  mov     bp, [esi]
  1685 00000F8A 83C602                                  add     esi, 2
  1686 00000F8D 66C1CD08                                ror     bp, 8
  1687 00000F91 D3CD                                    ror     ebp, cl
  1688 00000F93 EB9F                                    jmp     short .get_child_lop
  1689                                  
  1690                                  .got_done:
  1691 00000F95 50                                      push    eax
  1692 00000F96 C1E804                                  shr     eax, 4          ; x
  1693 00000F99 7417                                    jz      short .this_sign ; @@getexpval 0 ; @@getexpval macro has_linbits
  1694                                                                          ; eax=0 (without sign) ; when x=0
  1695 00000F9B 8B15[701D0500]                          mov     edx, [_@@rle_val_x_40h]
  1696 00000FA1 8B8482[AC600400]                        mov     eax, [mp3_expval_table+edx+eax*4]
  1697 00000FA8 FECD                                    dec     ch              ; mp3mac_get_bit_to_cy
  1698                                                                          ; ;jnc short @@this_sign
  1699                                                                          ; ;neg  eax
  1700 00000FAA D1E5                                    shl     ebp, 1          ; dec mp3_colNN ; shl mp3_col32,1 ; cy=data
  1701 00000FAC 19D2                                    sbb     edx, edx        ; cy=0,1 --> 0,FFFFFFFF
  1702 00000FAE 31D0                                    xor     eax, edx        ; invert if cy was 1 ; get sign (negate if sign=1)
  1703 00000FB0 29D0                                    sub     eax, edx        ; add 1 if cy was 1
  1704                                  
  1705                                  .this_sign:
  1706 00000FB2 8984BBA0000000                          mov     [ebx+edi*4+160], eax ; [ebx+$mp3gr_sb_hybrid+edi*4+0]
  1707 00000FB9 58                                      pop     eax
  1708 00000FBA 83E00F                                  and     eax, 0Fh        ; y
  1709 00000FBD 7417                                    jz      short .this_sign@ ; @@getexpval 0
  1710 00000FBF 8B15[701D0500]                          mov     edx, [_@@rle_val_x_40h]
  1711 00000FC5 8B8482[AC600400]                        mov     eax, [mp3_expval_table+edx+eax*4]
  1712 00000FCC FECD                                    dec     ch
  1713 00000FCE D1E5                                    shl     ebp, 1
  1714 00000FD0 19D2                                    sbb     edx, edx
  1715 00000FD2 31D0                                    xor     eax, edx
  1716 00000FD4 29D0                                    sub     eax, edx
  1717                                  
  1718                                  .this_sign@:
  1719 00000FD6 8984BBA4000000                          mov     [ebx+edi*4+164], eax ; [ebx+$mp3gr_sb_hybrid+edi*4+4]
  1720 00000FDD 83C702                                  add     edi, 2
  1721 00000FE0 FF0D[541D0500]                          dec     dword [_@@JJJ]
  1722 00000FE6 0F852AFFFFFF                            jnz     .low_freq_lop_j_small
  1723 00000FEC E9B2010000                              jmp     .low_freq_next_i
  1724                                  
  1725                                  .small_near_end:
  1726 00000FF1 89F0                                    mov     eax, esi        ; mp3mac_bitstream_get_position
  1727 00000FF3 2B05[28F20000]                          sub     eax, [mp3_bitstream_start]
  1728 00000FF9 0FBED5                                  movsx   edx, ch         ; mp3_colNN
  1729 00000FFC F7DA                                    neg     edx
  1730 00000FFE 8D44C2F0                                lea     eax, [edx+eax*8-16]
  1731 00001002 3B4308                                  cmp     eax, [ebx+8]    ; [ebx+$mp3gr_part2_3_end]
  1732 00001005 0F8217FFFFFF                            jb      .small_not_end
  1733 0000100B E993010000                              jmp     .low_freq_next_i
  1734                                  
  1735                                  .with_linbits:
  1736 00001010 0FB68412[1D7E0000]                      movzx   eax, byte [(mp3_huff_data+1)+edx*2]
  1737 00001018 A3[581D0500]                            mov     [_@@linbits], eax
  1738                                  
  1739                                  .low_freq_lop_j:
  1740 0000101D 3B35[601D0500]                          cmp     esi, [_@@coarse_end] ; mp3mac_bitstream_get_position
  1741                                                                          ; loop @@JJJ times...
  1742 00001023 0F8725030000                            ja      .lop_j_near_end
  1743                                  
  1744                                  .small_not_end@:
  1745 00001029 3B3D[641D0500]                          cmp     edi, [_@rle_point] ; @@get_runlength small
  1746 0000102F 0F83C5020000                            jnb     .rle_fetch_next_full
  1747                                  
  1748                                  .rle_back_full:
  1749 00001035 8B15[5C1D0500]                          mov     edx, [_@@vlc_table] ; get huffcode
  1750                                  
  1751                                  .get_child_lop@:
  1752 0000103B 8A0C95[421D0100]                        mov     cl, [(huff_tree_buf+2)+edx*4] ; mp3mac_get_huffcode
  1753                                                                          ; in: edx=table, out: eax=data
  1754                                                                          ; bits (table size) (-7..-1)
  1755 00001042 668B1495[401D0100]                      mov     dx, word [huff_tree_buf+edx*4] ; code (child table)
  1756 0000104A 89E8                                    mov     eax, ebp
  1757 0000104C D3E8                                    shr     eax, cl
  1758 0000104E 01C2                                    add     edx, eax
  1759 00001050 8A0C95[421D0100]                        mov     cl, [(huff_tree_buf+2)+edx*4] ; bits (of entry)
  1760 00001057 80F900                                  cmp     cl, 0
  1761 0000105A 7823                                    js      short .got_child@
  1762 0000105C 0FB70495[401D0100]                      movzx   eax, word [huff_tree_buf+edx*4] ; return data value
  1763 00001064 D3E5                                    shl     ebp, cl         ; discard cl bits
  1764 00001066 28CD                                    sub     ch, cl
  1765 00001068 7932                                    jns     short .got_done@
  1766 0000106A 88E9                                    mov     cl, ch          ; mp3mac_collect_more
  1767 0000106C 80C510                                  add     ch, 10h
  1768 0000106F D3C5                                    rol     ebp, cl
  1769 00001071 668B2E                                  mov     bp, [esi]
  1770 00001074 83C602                                  add     esi, 2
  1771 00001077 66C1CD08                                ror     bp, 8
  1772 0000107B D3CD                                    ror     ebp, cl
  1773 0000107D EB1D                                    jmp     short .got_done@
  1774                                  
  1775                                  .got_child@:
  1776 0000107F C1E509                                  shl     ebp, 9
  1777 00001082 80ED09                                  sub     ch, 9
  1778 00001085 79B4                                    jns     short .get_child_lop@
  1779 00001087 88E9                                    mov     cl, ch
  1780 00001089 80C510                                  add     ch, 10h
  1781 0000108C D3C5                                    rol     ebp, cl
  1782 0000108E 668B2E                                  mov     bp, [esi]
  1783 00001091 83C602                                  add     esi, 2
  1784 00001094 66C1CD08                                ror     bp, 8
  1785 00001098 D3CD                                    ror     ebp, cl
  1786 0000109A EB9F                                    jmp     short .get_child_lop@
  1787                                  
  1788                                  .got_done@:
  1789 0000109C 50                                      push    eax
  1790 0000109D C1E804                                  shr     eax, 4          ; x
  1791 000010A0 746F                                    jz      short .@this_sign ; @@getexpval 1
  1792 000010A2 8B15[6C1D0500]                          mov     edx, [_@@rle_val]
  1793 000010A8 83F80F                                  cmp     eax, 15
  1794 000010AB 7250                                    jb      short .small    ; when x=1..14
  1795 000010AD 8A0D[581D0500]                          mov     cl, byte [_@@linbits] ; =0..13 ; when x=15, with linbits
  1796 000010B3 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits cl ; value = 0..1FFFh
  1797 000010B5 D3E5                                    shl     ebp, cl         ; mp3mac_collect_more
  1798 000010B7 D3C0                                    rol     eax, cl
  1799 000010B9 31E8                                    xor     eax, ebp
  1800 000010BB 28CD                                    sub     ch, cl
  1801 000010BD 7913                                    jns     short .cont
  1802 000010BF 88E9                                    mov     cl, ch          ; mp3mac_collect_more
  1803 000010C1 80C510                                  add     ch, 16
  1804 000010C4 D3C5                                    rol     ebp, cl
  1805 000010C6 668B2E                                  mov     bp, [esi]
  1806 000010C9 83C602                                  add     esi, 2
  1807 000010CC 66C1CD08                                ror     bp, 8
  1808 000010D0 D3CD                                    ror     ebp, cl
  1809                                  
  1810                                  .cont:
  1811 000010D2 88D1                                    mov     cl, dl          ; exponent.lsb
  1812 000010D4 80E103                                  and     cl, 3           ; exponent.lsb
  1813 000010D7 C1EA02                                  shr     edx, 2          ; exponent.msb
  1814 000010DA 8D04853C000000                          lea     eax, [eax*4+60] ; (value+15)*4
  1815 000010E1 08C8                                    or      al, cl          ; exponent.lsb+(value+15)*4
  1816 000010E3 8A88[80D70100]                          mov     cl, [mp3_table_4_3_exp+eax]
  1817 000010E9 8B0485[BC570200]                        mov     eax, [mp3_table_4_3_value+eax*4]
  1818 000010F0 28D1                                    sub     cl, dl          ; sub exponent.msb
  1819 000010F2 D3E8                                    shr     eax, cl
  1820 000010F4 80F91F                                  cmp     cl, 31
  1821 000010F7 760E                                    jbe     short .get_sign
  1822 000010F9 31C0                                    xor     eax, eax
  1823 000010FB EB0A                                    jmp     short .get_sign
  1824                                  
  1825                                  .small:
  1826 000010FD C1E206                                  shl     edx, 6          ; shl edx,4+2 ; mul16*4 ; when x<15 aka x=1..14
  1827 00001100 8B8482[AC600400]                        mov     eax, [mp3_expval_table+edx+eax*4]
  1828                                  
  1829                                  .get_sign:
  1830 00001107 FECD                                    dec     ch              ; mp3mac_get_bit_to_cy
  1831 00001109 D1E5                                    shl     ebp, 1
  1832 0000110B 19D2                                    sbb     edx, edx        ; get sign (negate if sign=1)
  1833 0000110D 31D0                                    xor     eax, edx
  1834 0000110F 29D0                                    sub     eax, edx
  1835                                  
  1836                                  .@this_sign:
  1837 00001111 8984BBA0000000                          mov     [ebx+edi*4+160], eax ; [ebx+$mp3gr_sb_hybrid+edi*4+0]
  1838 00001118 58                                      pop     eax
  1839 00001119 83E00F                                  and     eax, 0Fh        ; y
  1840 0000111C 746F                                    jz      short .@this_sign@ ; @@getexpval 1
  1841 0000111E 8B15[6C1D0500]                          mov     edx, [_@@rle_val]
  1842 00001124 83F80F                                  cmp     eax, 0Fh
  1843 00001127 7250                                    jb      short .small@
  1844 00001129 8A0D[581D0500]                          mov     cl, byte [_@@linbits]
  1845 0000112F 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits cl
  1846 00001131 D3E5                                    shl     ebp, cl
  1847 00001133 D3C0                                    rol     eax, cl
  1848 00001135 31E8                                    xor     eax, ebp
  1849 00001137 28CD                                    sub     ch, cl
  1850 00001139 7913                                    jns     short .cont@
  1851 0000113B 88E9                                    mov     cl, ch          ; mp3mac_collect_more
  1852 0000113D 80C510                                  add     ch, 10h
  1853 00001140 D3C5                                    rol     ebp, cl
  1854 00001142 668B2E                                  mov     bp, [esi]
  1855 00001145 83C602                                  add     esi, 2
  1856 00001148 66C1CD08                                ror     bp, 8
  1857 0000114C D3CD                                    ror     ebp, cl
  1858                                  
  1859                                  .cont@:
  1860 0000114E 88D1                                    mov     cl, dl
  1861 00001150 80E103                                  and     cl, 3
  1862 00001153 C1EA02                                  shr     edx, 2
  1863 00001156 8D04853C000000                          lea     eax, [eax*4+60]
  1864 0000115D 08C8                                    or      al, cl
  1865 0000115F 8A88[80D70100]                          mov     cl, [mp3_table_4_3_exp+eax]
  1866 00001165 8B0485[BC570200]                        mov     eax, [mp3_table_4_3_value+eax*4]
  1867 0000116C 28D1                                    sub     cl, dl
  1868 0000116E D3E8                                    shr     eax, cl
  1869 00001170 80F91F                                  cmp     cl, 31
  1870 00001173 760E                                    jbe     short .get_sign@
  1871 00001175 31C0                                    xor     eax, eax
  1872 00001177 EB0A                                    jmp     short .get_sign@
  1873                                  
  1874                                  .small@:
  1875 00001179 C1E206                                  shl     edx, 6
  1876 0000117C 8B8482[AC600400]                        mov     eax, [mp3_expval_table+edx+eax*4]
  1877                                  
  1878                                  .get_sign@:                           
  1879 00001183 FECD                                    dec     ch              ; dec mp3_colNN
  1880 00001185 D1E5                                    shl     ebp, 1          ; shl mp3_col32,1 ; cy=data
  1881 00001187 19D2                                    sbb     edx, edx        ; cy=0,1 --> 0,FFFFFFFF
  1882 00001189 31D0                                    xor     eax, edx        ; invert if cy was 1
  1883 0000118B 29D0                                    sub     eax, edx        ; add 1 if cy was 1
  1884                                  
  1885                                  .@this_sign@:
  1886 0000118D 8984BBA4000000                          mov	[ebx+edi*4+164], eax ; [ebx+$mp3gr_sb_hybrid+edi*4+4]
  1887 00001194 83C702                                  add	edi, 2          ; next j
  1888 00001197 FF0D[541D0500]                          dec	dword [_@@JJJ]
  1889 0000119D 0F857AFEFFFF                            jnz	.low_freq_lop_j
  1890                                  
  1891                                  .low_freq_next_i:
  1892 000011A3 FF05[501D0500]                          inc	dword [_@@III]	; next i
  1893 000011A9 833D[501D0500]03                        cmp	dword [_@@III], 3
  1894 000011B0 0F8201FDFFFF                            jb	.low_freq_lop_i
  1895 000011B6 81FF3C020000                            cmp	edi, 572	; aka 576-4 ; skip if less than 4 entries left
  1896 000011BC 0F87DA000000                            ja	.high_freq_done
  1897                                  
  1898                                  .high_freq_lop:
  1899 000011C2 3B35[601D0500]                          cmp     esi, [_@@coarse_end]
  1900 000011C8 7629                                    jbe     short .high_freq_inrange
  1901 000011CA 89F0                                    mov     eax, esi        ; mp3mac_bitstream_get_position
  1902 000011CC 2B05[28F20000]                          sub     eax, [mp3_bitstream_start]
  1903 000011D2 0FBED5                                  movsx   edx, ch         ; mp3_colNN
  1904 000011D5 F7DA                                    neg     edx
  1905 000011D7 8D44C2F0                                lea     eax, [edx+eax*8-16]
  1906 000011DB 3B4308                                  cmp     eax, [ebx+8]    ; [ebx+$mp3gr_part2_3_end] ; check end
  1907 000011DE 7213                                    jb      short .high_freq_inrange ; not yet end
  1908 000011E0 0F84B6000000                            jz      .high_freq_done ; okay, exact end
  1909 000011E6 83FF04                                  cmp     edi, 4
  1910 000011E9 7203                                    jb      short .high_freq_cannot_stepback
  1911 000011EB 83EF04                                  sub     edi, 4          ; stepback, s_index-4 ; dst stepback
  1912                                  
  1913                                  .high_freq_cannot_stepback:
  1914 000011EE E9A9000000                              jmp     .high_freq_done
  1915                                  
  1916                                  .high_freq_inrange:
  1917 000011F3 8B5324                                  mov     edx, [ebx+24h]  ; [ebx+$mp3gr_count1table_select]
  1918                                                                          ; get huffcode (quad_vlc)
  1919                                  
  1920                                  .get_child_lop@@:
  1921 000011F6 8A0C95[421D0100]                        mov     cl, [(huff_tree_buf+2)+edx*4] ; mp3mac_get_huffcode
  1922 000011FD 668B1495[401D0100]                      mov     dx, word [huff_tree_buf+edx*4]
  1923 00001205 89E8                                    mov     eax, ebp
  1924 00001207 D3E8                                    shr     eax, cl
  1925 00001209 01C2                                    add     edx, eax
  1926 0000120B 8A0C95[421D0100]                        mov     cl, [(huff_tree_buf+2)+edx*4]
  1927 00001212 80F900                                  cmp     cl, 0
  1928 00001215 7823                                    js      short .got_child@@
  1929 00001217 0FB70495[401D0100]                      movzx   eax, word [huff_tree_buf+edx*4]
  1930 0000121F D3E5                                    shl     ebp, cl
  1931 00001221 28CD                                    sub     ch, cl
  1932 00001223 7932                                    jns     short .got_done@@
  1933 00001225 88E9                                    mov     cl, ch
  1934 00001227 80C510                                  add     ch, 10h
  1935 0000122A D3C5                                    rol     ebp, cl
  1936 0000122C 668B2E                                  mov     bp, [esi]
  1937 0000122F 83C602                                  add     esi, 2
  1938 00001232 66C1CD08                                ror     bp, 8
  1939 00001236 D3CD                                    ror     ebp, cl
  1940 00001238 EB1D                                    jmp     short .got_done@@
  1941                                  
  1942                                  .got_child@@:
  1943 0000123A C1E509                                  shl     ebp, 9
  1944 0000123D 80ED09                                  sub     ch, 9
  1945 00001240 79B4                                    jns     short .get_child_lop@@
  1946 00001242 88E9                                    mov     cl, ch
  1947 00001244 80C510                                  add     ch, 10h
  1948 00001247 D3C5                                    rol     ebp, cl
  1949 00001249 668B2E                                  mov     bp, [esi]
  1950 0000124C 83C602                                  add     esi, 2
  1951 0000124F 66C1CD08                                ror     bp, 8
  1952 00001253 D3CD                                    ror     ebp, cl
  1953 00001255 EB9F                                    jmp     short .get_child_lop@@
  1954                                  
  1955                                  .got_done@@:
  1956 00001257 88C2                                    mov     dl, al          ; flags
  1957 00001259 C0E204                                  shl     dl, 4           ; flags, to upper 4bit
  1958 0000125C B604                                    mov     dh, 4           ; lopcount
  1959                                  
  1960                                  .high_freq_flag_lop:
  1961 0000125E 31C0                                    xor     eax, eax
  1962 00001260 D0E2                                    shl     dl, 1           ; flag
  1963 00001262 7320                                    jnb     short .high_freq_flag_this
  1964 00001264 3B3D[641D0500]                          cmp     edi, [_@rle_point] ; @@get_runlength quads
  1965 0000126A 0F83B8000000                            jnb     .rle_fetch_next_quads
  1966                                  
  1967                                  .rle_back_quads:
  1968 00001270 A1[6C1D0500]                            mov     eax, [_@@rle_val]
  1969 00001275 8B0485[AC580400]                        mov     eax, [mp3_exp_table+eax*4] ; xlat and get sign
  1970 0000127C FECD                                    dec     ch              ; mp3mac_get_bit_to_cy
  1971 0000127E D1E5                                    shl     ebp, 1
  1972 00001280 7302                                    jnb     short .high_freq_flag_this ;
  1973                                                                          ; sbb edx, edx ; cy=0,1 --> 0,FFFFFFFF
  1974                                                                          ; xor eax, edx ; invert if cy was 1
  1975                                                                          ; sub eax, edx ; add 1 if cy was 1
  1976 00001282 F7D8                                    neg     eax
  1977                                  
  1978                                  .high_freq_flag_this:
  1979 00001284 8984BBA0000000                          mov     [ebx+edi*4+160], eax ; [ebx+$mp3gr_sb_hybrid+edi*4+0]
  1980 0000128B 47                                      inc     edi
  1981 0000128C FECE                                    dec     dh
  1982 0000128E 75CE                                    jnz     short .high_freq_flag_lop
  1983 00001290 81FF3C020000                            cmp     edi, 572        ; aka 576-4 ; loop while space for another 4 values
  1984 00001296 0F8626FFFFFF                            jbe     .high_freq_lop
  1985                                  
  1986                                  .high_freq_done:
  1987 0000129C 897B5C                                  mov     [ebx+92], edi   ; [ebx+$mp3gr_num_nonzero_hybrids]
  1988 0000129F 51                                      push    ecx
  1989 000012A0 B940020000                              mov     ecx, 576        ; end
  1990 000012A5 29F9                                    sub     ecx, edi        ; remain = end-curr
  1991                                                                          ; zeropad remaining entries (can be 0 or 2 dwords,
  1992                                                                          ; or more. If above loop was aborted)
  1993 000012A7 8DBCBBA0000000                          lea     edi, [ebx+edi*4+160] ; [ebx+$mp3gr_sb_hybrid+edi*4]
  1994 000012AE 31C0                                    xor     eax, eax
  1995 000012B0 F3AB                                    rep stosd
  1996 000012B2 59                                      pop     ecx
  1997 000012B3 F605[DC730000]10                        test    byte [cpuid_flags], 10h ; timelog_end rdtsc_read_huffman
  1998 000012BA 740E                                    jz      short .no_rdtsc_supported@
  1999 000012BC 0F31                                    rdtsc
  2000 000012BE 0105[7C740000]                          add     [rdtsc_read_huffman], eax
  2001 000012C4 1115[80740000]                          adc     [rdtsc_read_huffman+4], edx
  2002                                  
  2003                                  .no_rdtsc_supported@:
  2004 000012CA F8                                      clc                     ; out: cy=0=okay
  2005 000012CB C3                                      retn
  2006                                  
  2007                                  .rle_fetch_next_small:
  2008 000012CC A1[681D0500]                            mov     eax, [_@@rle_ptr] ; @@next_runlength small
  2009 000012D1 8305[681D0500]04                        add     dword [_@@rle_ptr], 4
  2010 000012D8 8B00                                    mov     eax, [eax]
  2011 000012DA 6639C7                                  cmp     di, ax
  2012 000012DD 73ED                                    jnb     short .rle_fetch_next_small
  2013 000012DF 66A3[641D0500]                          mov     word [_@rle_point], ax
  2014 000012E5 C1E810                                  shr     eax, 16
  2015 000012E8 A3[6C1D0500]                            mov     [_@@rle_val], eax
  2016 000012ED C1E006                                  shl     eax, 6
  2017 000012F0 A3[701D0500]                            mov     [_@@rle_val_x_40h], eax
  2018 000012F5 E934FCFFFF                              jmp     .rle_back_small
  2019                                  
  2020                                  .rle_fetch_next_full:
  2021 000012FA A1[681D0500]                            mov     eax, [_@@rle_ptr] ; @@next_runlength full
  2022 000012FF 8305[681D0500]04                        add	dword [_@@rle_ptr], 4
  2023 00001306 8B00                                    mov     eax, [eax]
  2024 00001308 6639C7                                  cmp     di, ax
  2025 0000130B 73ED                                    jnb     short .rle_fetch_next_full
  2026 0000130D 66A3[641D0500]                          mov     word [_@rle_point], ax
  2027 00001313 C1E810                                  shr     eax, 16
  2028 00001316 A3[6C1D0500]                            mov     [_@@rle_val], eax
  2029 0000131B C1E006                                  shl     eax, 6
  2030 0000131E A3[701D0500]                            mov     [_@@rle_val_x_40h], eax
  2031 00001323 E90DFDFFFF                              jmp     .rle_back_full
  2032                                  
  2033                                  .rle_fetch_next_quads:
  2034 00001328 A1[681D0500]                            mov	eax, [_@@rle_ptr] ; msw=val, lsw=point
  2035 0000132D 8305[681D0500]04                        add	dword [_@@rle_ptr], 4 ; 2+2
  2036 00001334 8B00                                    mov	eax, [eax]
  2037 00001336 6639C7                                  cmp	di, ax          ; needed if rle fetching was skipped
  2038 00001339 73ED                                    jnb	short .rle_fetch_next_quads
  2039 0000133B 66A3[641D0500]                          mov	word [_@rle_point], ax
  2040 00001341 C1E810                                  shr	eax, 16
  2041 00001344 A3[6C1D0500]                            mov	[_@@rle_val], eax
  2042 00001349 E922FFFFFF                              jmp	.rle_back_quads
  2043                                  
  2044                                  .lop_j_near_end:
  2045 0000134E 89F0                                    mov     eax, esi
  2046 00001350 2B05[28F20000]                          sub     eax, [mp3_bitstream_start]
  2047 00001356 0FBED5                                  movsx   edx, ch
  2048 00001359 F7DA                                    neg     edx
  2049 0000135B 8D44C2F0                                lea     eax, [edx+eax*8-16]
  2050 0000135F 3B4308                                  cmp     eax, [ebx+8]
  2051 00001362 0F82C1FCFFFF                            jb      .small_not_end@
  2052 00001368 E936FEFFFF                              jmp     .low_freq_next_i
  2053                                  
  2054                                  
  2055                                  ; =============== S U B R O U T I N E =======================================
  2056                                  
  2057                                  
  2058                                  mp3_compute_stereo:
  2059 0000136D 833D[4C9B0000]02                        cmp	dword [mp3_output_num_channels], 2 ; in: ebx=granule(s)
  2060 00001374 7515                                    jnz	short .no_stereo
  2061 00001376 833D[689B0000]02                        cmp	dword [mp3_hdr_mode_ext], 2 ; MODE_EXT_MS_STEREO
  2062                                                                          ; only MS stereo
  2063 0000137D 740D                                    jz	short mp3_compute_ms_stereo
  2064 0000137F F705[689B0000]0100-                     test	dword [mp3_hdr_mode_ext], 1 ; MODE_EXT_I_STEREO
  2064 00001387 0000               
  2065                                                                          ; intensity stereo (optionally with MS stereo)
  2066 00001389 7567                                    jnz	short mp3_compute_i_stereo
  2067                                  
  2068                                  .no_stereo:
  2069 0000138B C3                                      retn
  2070                                  
  2071                                  mp3_compute_ms_stereo:
  2072 0000138C F605[DC730000]10                        test    byte [cpuid_flags], 10h ; ms_stereo is most commonly used
  2073                                                                          ; the 1/sqrt(2) normalization factor is included
  2074                                                                          ; in the global gain
  2075 00001393 740E                                    jz      short .no_rdtsc_supported ; timelog_start rdtsc_ms_stereo
  2076 00001395 0F31                                    rdtsc
  2077 00001397 2905[94740000]                          sub     [rdtsc_ms_stereo], eax
  2078 0000139D 1915[98740000]                          sbb     [rdtsc_ms_stereo+4], edx
  2079                                  
  2080                                  .no_rdtsc_supported:
  2081 000013A3 8DBBE0130000                            lea     edi, [ebx+5088] ; [ebx+$mp3gr_sb_hybrid+$mp3gr_entrysiz*2]
  2082                                                                          ; for ch1 (2nd channel)
  2083 000013A9 8B4B5C                                  mov     ecx, [ebx+92]   ; [ebx+$mp3gr_num_nonzero_hybrids] ; ch0
  2084 000013AC 8B839C130000                            mov     eax, [ebx+5020] ; [ebx+$mp3gr_num_nonzero_hybrids+($mp3gr_entrysiz*2)] ; ch1
  2085 000013B2 39C1                                    cmp     ecx, eax
  2086 000013B4 7702                                    ja      short .this_len
  2087 000013B6 89C1                                    mov     ecx, eax
  2088                                  
  2089                                  .this_len:
  2090 000013B8 E320                                    jecxz   .ms_stereo_done
  2091 000013BA 894B5C                                  mov     [ebx+92], ecx   ; [ebx+$mp3gr_num_nonzero_hybrids] ; ch0
  2092 000013BD 898B9C130000                            mov     [ebx+5020], ecx ; [ebx+$mp3gr_num_nonzero_hybrids+($mp3gr_entrysiz*2)] ; ch1
  2093                                  
  2094                                  .ms_stereo_lop:
  2095 000013C3 8B87C0ECFFFF                            mov     eax, [edi-4928] ; for i=0 to 576-1
  2096                                                                          ; [edi+@@ch0]
  2097                                                                          ; @@ch0 equ (-$mp3gr_entrysiz*2) ; granule for channel=0
  2098                                                                          ; tmp0 = granule.ch0.sb_hybrid[i]
  2099 000013C9 8B17                                    mov     edx, [edi]      ; @@ch1 equ 0 ; granule for channel=1
  2100                                                                          ; [edi+@@ch1]
  2101                                                                          ; tmp1 = granule.ch1.sb_hybrid[i]
  2102 000013CB 29D0                                    sub     eax, edx        ; tmp0 - tmp1
  2103 000013CD 8D1450                                  lea     edx, [eax+edx*2] ; tmp0 + tmp1
  2104 000013D0 8997C0ECFFFF                            mov     [edi-4928], edx ; [edi+@@ch0]
  2105                                                                          ; granule.ch0.sb_hybrid[i] = tmp0 + tmp1
  2106 000013D6 AB                                      stosd                   ; [edi+@@ch1]
  2107                                                                          ; granule.ch1.sb_hybrid[i] = tmp0 - tmp1
  2108 000013D7 49                                      dec     ecx
  2109 000013D8 75E9                                    jnz     short .ms_stereo_lop
  2110                                  
  2111                                  .ms_stereo_done:
  2112 000013DA F605[DC730000]10                        test    byte [cpuid_flags], 10h ; timelog_end rdtsc_ms_stereo
  2113 000013E1 740E                                    jz      short .no_rdtsc_supported@
  2114 000013E3 0F31                                    rdtsc
  2115 000013E5 0105[94740000]                          add     [rdtsc_ms_stereo], eax
  2116 000013EB 1115[98740000]                          adc     [rdtsc_ms_stereo+4], edx
  2117                                  
  2118                                  .no_rdtsc_supported@:
  2119 000013F1 C3                                      retn
  2120                                  
  2121                                  mp3_compute_i_stereo:
  2122 000013F2 F605[DC730000]10                        test    byte [cpuid_flags], 10h ; timelog_start rdtsc_i_stereo
  2123 000013F9 740E                                    jz      short .no_rdtsc_supported@@@
  2124 000013FB 0F31                                    rdtsc
  2125 000013FD 2905[AC740000]                          sub     [rdtsc_i_stereo], eax
  2126 00001403 1915[B0740000]                          sbb     [rdtsc_i_stereo+4], edx
  2127                                  
  2128                                  .no_rdtsc_supported@@@:
  2129 00001409 C7435C40020000                          mov     dword [ebx+92], 576 ; ch0
  2130                                                                          ; [ebx+$mp3gr_num_nonzero_hybrids]
  2131 00001410 C7839C130000400200-                     mov     dword [ebx+5020], 576 ; ch1
  2131 00001419 00                 
  2132                                                                          ; [ebx+$mp3gr_num_nonzero_hybrids+($mp3gr_entrysiz*2)]
  2133 0000141A 8B4320                                  mov     eax, [ebx+32]   ; [ebx+$mp3gr_long_end]
  2134 0000141D A3[AC1D0500]                            mov     [_@@n_long_sfb], eax
  2135 00001422 B80D000000                              mov     eax, 13         ; 39/3
  2136 00001427 2B431C                                  sub     eax, [ebx+28]   ; [ebx+$mp3gr_short_start]
  2137 0000142A 8D0440                                  lea     eax, [eax+eax*2] ; mul3
  2138 0000142D A3[B01D0500]                            mov     [_@@n_short_sfb], eax
  2139 00001432 0305[AC1D0500]                          add     eax, [_@@n_long_sfb]
  2140 00001438 A3[B41D0500]                            mov     [_@@n_sfb], eax ;
  2141                                                                          ; n_sfb = gr->n_long_sfb + gr->n_short_sfb;
  2142 0000143D 803D[B01D0500]00                        cmp     byte [_@@n_short_sfb], 0
  2143 00001444 B801000000                              mov     eax, 1
  2144 00001449 7405                                    jz      short .without_short
  2145 0000144B B803000000                              mov     eax, 3          ; max_blocks = gr->n_short_sfb ? 3 : 1;
  2146                                  
  2147                                  .without_short:
  2148 00001450 A3[781D0500]                            mov     [_@@max_blocks], eax
  2149 00001455 BF[801D0500]                            mov     edi, _@@sfb_array
  2150 0000145A A1[409B0000]                            mov     eax, [mp3_hdr_sample_rate_index] ; bstab
  2151 0000145F 6BC016                                  imul    eax, 22
  2152 00001462 8DB0[5C7E0000]                          lea     esi, [mp3_band_size_long+eax]
  2153 00001468 8B0D[AC1D0500]                          mov     ecx, [_@@n_long_sfb]
  2154 0000146E F3A4                                    rep movsb
  2155 00001470 A1[409B0000]                            mov     eax, [mp3_hdr_sample_rate_index]
  2156 00001475 6BC00D                                  imul    eax, 13
  2157 00001478 8DB0[2C7F0000]                          lea     esi, [mp3_band_size_short+eax] ; merge lieff-style
  2158 0000147E 8B0D[B01D0500]                          mov     ecx, [_@@n_short_sfb]
  2159 00001484 E30C                                    jecxz   .make_sfb_done ; doing that here is a bit slow,
  2160                                                                          ; it would be better to pre-compute
  2161                                                                          ; all merged-combinations
  2162 00001486 03731C                                  add     esi, [ebx+28]   ; [ebx+$mp3gr_short_start]
  2163                                  
  2164                                  .make_sfb_lop:
  2165 00001489 AC                                      lodsb
  2166 0000148A AA                                      stosb
  2167 0000148B AA                                      stosb
  2168 0000148C AA                                      stosb
  2169 0000148D 83E903                                  sub     ecx, 3
  2170 00001490 75F7                                    jnz     short .make_sfb_lop
  2171                                  
  2172                                  .make_sfb_done:
  2173 00001492 E888000000                              call    _@@find_top_bands ;
  2174                                                                          ; L3_stereo_top_band(left+576,gr->sfbtab,n_sfb,max_band);
  2175 00001497 803D[AC1D0500]00                        cmp     byte [_@@n_long_sfb], 0
  2176 0000149E 7420                                    jz      short .without_long
  2177 000014A0 A1[741D0500]                            mov     eax, dword [_@@max_bands]
  2178 000014A5 38C4                                    cmp     ah, al          ; if (gr->n_long_sfb)
  2179 000014A7 7F02                                    jg      short .not_max1 ; max_band[0] = max_band[1] = max_band[2] = MINIMP3_MAX
  2180                                                                          ; (MINIMP3_MAX(max_band[0], max_band[1]), max_band[2]);
  2181 000014A9 88C4                                    mov     ah, al
  2182                                  
  2183                                  .not_max1:
  2184 000014AB C1E808                                  shr     eax, 8
  2185 000014AE 38C4                                    cmp     ah, al
  2186 000014B0 7F02                                    jg      short .not_max2
  2187 000014B2 88C4                                    mov     ah, al
  2188                                  
  2189                                  .not_max2:
  2190 000014B4 88E0                                    mov     al, ah
  2191 000014B6 C1E008                                  shl     eax, 8
  2192 000014B9 88E0                                    mov     al, ah
  2193 000014BB A3[741D0500]                            mov     dword [_@@max_bands], eax
  2194                                  
  2195                                  .without_long:
  2196 000014C0 31ED                                    xor     ebp, ebp        ; blk
  2197                                  
  2198                                  .adjust_last_prev_lop:
  2199 000014C2 8B15[B41D0500]                          mov     edx, [_@@n_sfb]
  2200 000014C8 2B15[781D0500]                          sub     edx, [_@@max_blocks] ; itop = n_sfb - max_blocks + blk
  2201 000014CE 01EA                                    add     edx, ebp
  2202 000014D0 89D1                                    mov     ecx, edx
  2203 000014D2 2B0D[781D0500]                          sub     ecx, [_@@max_blocks] ; prev = itop - max_blocks;
  2204 000014D8 A1[6C9B0000]                            mov     eax, [mp3_hdr_flag_lsf]
  2205 000014DD 8D0440                                  lea     eax, [eax+eax*2] ; 0,1 --> 0,3
  2206                                                                          ; default_pos = HDR_TEST_MPEG1(hdr) ? 3
  2207 000014E0 3403                                    xor     al, 3           ; 0,3 --> 3,0
  2208 000014E2 363A8D[741D0500]                        cmp     cl, [ss:_@@max_bands+ebp]
  2209 000014E9 7E07                                    jle     short .use_default_pos ; ist_pos[itop] = max_band[blk] >=
  2210                                                                          ; prev ? default_pos : ist_pos[prev]
  2211 000014EB 8A840BB0130000                          mov     al, [ebx+ecx+5040] ; [ebx+@@right+$mp3gr_scale_factors+ecx]
  2212                                  
  2213                                  .use_default_pos:
  2214 000014F2 888413B0130000                          mov     [ebx+edx+5040], al ; [ebx+@@right+$mp3gr_scale_factors+edx]
  2215 000014F9 45                                      inc     ebp             ; blk
  2216 000014FA 3B2D[781D0500]                          cmp     ebp, [_@@max_blocks]
  2217 00001500 72C0                                    jb      short .adjust_last_prev_lop
  2218 00001502 E867000000                              call    _@@apply_i_stereo
  2219 00001507 F605[DC730000]10                        test    byte [cpuid_flags], 10h ; timelog_end rdtsc_i_stereo
  2220 0000150E 740E                                    jz      short .no_rdtsc_supported@@@@
  2221 00001510 0F31                                    rdtsc
  2222 00001512 0105[AC740000]                          add     [rdtsc_i_stereo], eax
  2223 00001518 1115[B0740000]                          adc     [rdtsc_i_stereo+4], edx
  2224                                  
  2225                                  .no_rdtsc_supported@@@@:
  2226 0000151E C3                                      retn
  2227                                  
  2228                                  
  2229                                  ; =============== S U B R O U T I N E =======================================
  2230                                  
  2231                                  
  2232                                  _@@find_top_bands:
  2233 0000151F C705[741D0500]FFFF-                     mov     dword [_@@max_bands], 0FFFFFFh ; set maxband[0..2]=(-1)
  2233 00001527 FF00               
  2234 00001529 8DB3E0130000                            lea     esi, [ebx+5088] ; [ebx+@@right+$mp3gr_sb_hybrid]
  2235 0000152F 31D2                                    xor     edx, edx
  2236                                  
  2237                                  .find_top_lop_iii:                    
  2238 00001531 31C9                                    xor     ecx, ecx        ; for (i = 0; i < nbands; i++)
  2239                                  
  2240                                  .find_top_lop_kkk:                    
  2241 00001533 8B048E                                  mov     eax, [esi+ecx*4] ; for (k = 0; k < sfb[i]; k += 2)
  2242 00001536 0B448E04                                or      eax, [esi+ecx*4+4]
  2243 0000153A 750D                                    jnz     short .found_nonzero
  2244 0000153C 83C102                                  add     ecx, 2
  2245 0000153F 3A8A[801D0500]                          cmp     cl, [_@@sfb_array+edx]
  2246 00001545 72EC                                    jb      short .find_top_lop_kkk
  2247 00001547 EB11                                    jmp     short .find_top_next
  2248                                  
  2249                                  .found_nonzero:
  2250 00001549 89D0                                    mov     eax, edx
  2251 0000154B F635[96880000]                          div     byte [_@@const_3]
  2252 00001551 0FB6C4                                  movzx   eax, ah         ; remainder (mod 3)
  2253 00001554 8890[741D0500]                          mov     [_@@max_bands+eax], dl ; max_bands[0..2]=i
  2254                                  
  2255                                  .find_top_next:
  2256 0000155A 0FB682[801D0500]                        movzx   eax, byte [_@@sfb_array+edx]
  2257 00001561 8D3486                                  lea     esi, [esi+eax*4]
  2258 00001564 42                                      inc     edx             ; next
  2259 00001565 3B15[B41D0500]                          cmp     edx, [_@@n_sfb]
  2260 0000156B 72C4                                    jb      short .find_top_lop_iii
  2261 0000156D C3                                      retn
  2262                                  
  2263                                  ; =============== S U B R O U T I N E =======================================
  2264                                  
  2265                                  
  2266                                  _@@apply_i_stereo:
  2267 0000156E B8[1C820000]                            mov     eax, mp3_is_table_normal
  2268 00001573 B907000000                              mov     ecx, 7
  2269 00001578 833D[6C9B0000]00                        cmp     dword [mp3_hdr_flag_lsf], 0
  2270 0000157F 7425                                    jz      short .this_lsf
  2271 00001581 8B8354130000                            mov     eax, [ebx+4948] ; [ebx+@@right+$mp3gr_scalefac_compress]
  2272 00001587 83E001                                  and     eax, 1          ; bit0
  2273 0000158A F705[689B0000]0200-                     test    dword [mp3_hdr_mode_ext], 2 ; MODE_EXT_MS_STEREO
  2273 00001592 0000               
  2274 00001594 7403                                    jz      short .no_ms
  2275 00001596 83C802                                  or      eax, 2          ; bit1=mul_1.414
  2276                                  
  2277                                  .no_ms:
  2278 00001599 C1E009                                  shl     eax, 9          ; N*40h*2*4
  2279 0000159C 05[2CE50400]                            add     eax, mp3_is_table_lsf
  2280 000015A1 B940000000                              mov     ecx, 64         ; max (must be below NO_INTENSITY_FLAG)
  2281                                  
  2282                                  .this_lsf:
  2283 000015A6 890D[7C1D0500]                          mov     [_@@max_pos], ecx ; 7 or 64
  2284 000015AC A3[A81D0500]                            mov     [_@@is_tab], eax ; table
  2285 000015B1 8DB3A0000000                            lea     esi, [ebx+160]  ; [ebx+$mp3gr_sb_hybrid]
  2286 000015B7 31C9                                    xor     ecx, ecx        ; iii ; for (i = 0; sfb[i]; i++)
  2287                                  
  2288                                  .apply_lop_i:
  2289 000015B9 0FB6A9[801D0500]                        movzx   ebp, byte [_@@sfb_array+ecx] ; if ((int)i > max_band[i % 3]
  2290                                                                          ; && ipos < max_pos)
  2291 000015C0 89C8                                    mov     eax, ecx
  2292 000015C2 F635[96880000]                          div     byte [_@@const_3] ; max_band[i % 3]
  2293 000015C8 0FB6C4                                  movzx   eax, ah         ; remainder (mod 3)
  2294 000015CB 3A88[741D0500]                          cmp     cl, [_@@max_bands+eax] ; iii,max_bands[0..2];
  2295 000015D1 7E38                                    jle     short .apply_ms_stereo
  2296 000015D3 0FB6BC0BB0130000                        movzx   edi, byte [ebx+ecx+5040] ; [ebx+@@right+$mp3gr_scale_factors+ecx]
  2297                                                                          ; @@right = $mp3gr_entrysiz*2 = 4928
  2298                                                                          ; $mp3gr_scale_factors = 112
  2299 000015DB 3B3D[7C1D0500]                          cmp     edi, [_@@max_pos] ; check ipos
  2300 000015E1 7328                                    jnb     short .apply_ms_stereo
  2301 000015E3 C1E703                                  shl     edi, 3          ; mul 2*4
  2302 000015E6 033D[A81D0500]                          add     edi, [_@@is_tab]
  2303                                  
  2304                                  .apply_pan_lop:
  2305 000015EC 8B06                                    mov     eax, [esi]      ; tmp = granule.ch0.sb_hybrid
  2306 000015EE C1E002                                  shl     eax, 2
  2307 000015F1 F76F04                                  imul    dword [edi+4] ; v1
  2308 000015F4 899640130000                            mov     [esi+4928], edx ; [esi+@@right]
  2309                                                                          ; granule.ch1.sb_hybrid = tmp*v1
  2310 000015FA 8B06                                    mov     eax, [esi]      ; tmp = granule.ch0.sb_hybrid
  2311 000015FC C1E002                                  shl     eax, 2
  2312 000015FF F72F                                    imul    dword [edi] ; v0
  2313 00001601 8916                                    mov     [esi], edx      ; granule.ch0.sb_hybrid = tmp*v0
  2314 00001603 83C604                                  add     esi, 4
  2315 00001606 4D                                      dec     ebp
  2316 00001607 75E3                                    jnz     short .apply_pan_lop
  2317 00001609 EB2C                                    jmp     short .apply_next
  2318                                  
  2319                                  .apply_ms_stereo:
  2320 0000160B F705[689B0000]0200-                     test	dword [mp3_hdr_mode_ext], 2 ; MODE_EXT_MS_STEREO
  2320 00001613 0000               
  2321 00001615 741D                                    jz	short .apply_none
  2322                                  
  2323                                  .ms_stereo_lop:
  2324 00001617 8B06                                    mov     eax, [esi]      ; tmp0 = granule.ch0.sb_hybrid[i]
  2325 00001619 8B9640130000                            mov     edx, [esi+4928] ; [esi+@@right]
  2326                                                                          ; tmp1 = granule.ch1.sb_hybrid[i]
  2327 0000161F 29D0                                    sub     eax, edx        ; tmp0 - tmp1
  2328 00001621 8D1450                                  lea     edx, [eax+edx*2] ; tmp0 + tmp1
  2329 00001624 8916                                    mov     [esi], edx      ; granule.ch0.sb_hybrid[i] = tmp0 + tmp1
  2330 00001626 898640130000                            mov     [esi+4928], eax ; [esi+@@right]
  2331                                                                          ; granule.ch1.sb_hybrid[i] = tmp0 - tmp1
  2332 0000162C 83C604                                  add     esi, 4
  2333 0000162F 4D                                      dec     ebp
  2334 00001630 75E5                                    jnz     short .ms_stereo_lop
  2335 00001632 EB03                                    jmp     short .apply_next
  2336                                  
  2337                                  .apply_none:
  2338 00001634 8D34AE                                  lea     esi, [esi+ebp*4] ; skip, keep unchanged
  2339                                  
  2340                                  .apply_next:
  2341 00001637 41                                      inc     ecx             ; iii
  2342 00001638 3B0D[B41D0500]                          cmp     ecx, [_@@n_sfb]
  2343 0000163E 0F8275FFFFFF                            jb      .apply_lop_i   ; next
  2344 00001644 C3                                      retn
  2345                                  
  2346                                  ; =============== S U B R O U T I N E =======================================
  2347                                  
  2348                                  
  2349                                  mp3_reorder_block:
  2350 00001645 F605[DC730000]10                        test    byte [cpuid_flags], 10h ; timelog_start rdtsc_reorder
  2351 0000164C 740E                                    jz      short .no_rdtsc_supported
  2352 0000164E 0F31                                    rdtsc
  2353 00001650 2905[C4740000]                          sub     [rdtsc_reorder], eax
  2354 00001656 1915[C8740000]                          sbb     [rdtsc_reorder+4], edx
  2355                                  
  2356                                  .no_rdtsc_supported:
  2357 0000165C 807B2C02                                cmp	byte [ebx+44], 2 ; ebx+$mp3gr_block_type] ; only for type 2
  2358 00001660 7565                                    jnz	short .no_reorder
  2359 00001662 8DB3A0000000                            lea	esi, [ebx+160]  ; [ebx+$mp3gr_sb_hybrid] ; ptr+0
  2360 00001668 807B3000                                cmp	byte [ebx+48], 0 ; [ebx+$mp3gr_switch_point]
  2361 0000166C 7412                                    jz	short .this_src
  2362 0000166E 81C690000000                            add	esi, 144        ; 36*4 ; ptr+36*4
  2363 00001674 833D[409B0000]08                        cmp	dword [mp3_hdr_sample_rate_index], 8
  2364 0000167B 7503                                    jnz	short .this_src
  2365 0000167D 83C630                                  add	esi, 48         ; 12*4 ; additionally to above 36*4 ; ptr+48*4
  2366                                  
  2367                                  .this_src:
  2368 00001680 8B531C                                  mov     edx, [ebx+28]   ; [ebx+$mp3gr_short_start] ; can be 13
  2369 00001683 83FA0D                                  cmp     edx, 13
  2370 00001686 733F                                    jnb     short .no_reorder
  2371 00001688 C7435C40020000                          mov     dword [ebx+92], 576 ; [ebx+$mp3gr_num_nonzero_hybrids]
  2372                                  
  2373                                  .outer_lop:
  2374 0000168F A1[409B0000]                            mov     eax, [mp3_hdr_sample_rate_index]
  2375 00001694 6BC00D                                  imul    eax, 13         ; X*13
  2376 00001697 0FB68C10[2C7F0000]                      movzx   ecx, byte [mp3_band_size_short+eax+edx] ; [X*13+Y]
  2377 0000169F BF[B81D0500]                            mov     edi, _@@tmp
  2378 000016A4 60                                      pusha
  2379 000016A5 89CA                                    mov     edx, ecx        ; step=len (4..44) ; copy LEN*3 dwords to tmp
  2380                                  
  2381                                  .inner_lop:
  2382 000016A7 8B06                                    mov     eax, [esi]
  2383 000016A9 AB                                      stosd
  2384 000016AA 8B0496                                  mov     eax, [esi+edx*4] ; copy 3 dwords
  2385 000016AD AB                                      stosd
  2386 000016AE 8B04D6                                  mov     eax, [esi+edx*8]
  2387 000016B1 AB                                      stosd
  2388 000016B2 83C604                                  add     esi, 4
  2389 000016B5 E2F0                                    loop    .inner_lop
  2390 000016B7 61                                      popa
  2391 000016B8 8D0C49                                  lea     ecx, [ecx+ecx*2] ; len*3
  2392 000016BB 87FE                                    xchg    esi, edi        ; copy LEN*3 dwords back from tmp
  2393 000016BD F3A5                                    rep movsd
  2394 000016BF 87FE                                    xchg    esi, edi
  2395 000016C1 42                                      inc     edx
  2396 000016C2 83FA0D                                  cmp     edx, 13
  2397 000016C5 72C8                                    jb      short .outer_lop ; next
  2398                                  
  2399                                  .no_reorder:
  2400 000016C7 F605[DC730000]10                        test    byte [cpuid_flags], 10h
  2401 000016CE 740E                                    jz      short .no_rdtsc_supported@ ; timelog_end rdtsc_reorder
  2402 000016D0 0F31                                    rdtsc
  2403 000016D2 0105[C4740000]                          add     [rdtsc_reorder], eax
  2404 000016D8 1115[C8740000]                          adc     [rdtsc_reorder+4], edx
  2405                                  
  2406                                  .no_rdtsc_supported@:
  2407 000016DE C3                                      retn
  2408                                  
  2409                                  
  2410                                  ; =============== S U B R O U T I N E =======================================
  2411                                  
  2412                                  
  2413                                  mp3_compute_antialias:
  2414 000016DF F605[DC730000]10                        test    byte [cpuid_flags], 10h ; in: ebx=granule
  2415 000016E6 740E                                    jz      short .no_rdtsc_supported ; timelog_start rdtsc_antialias
  2416 000016E8 0F31                                    rdtsc
  2417 000016EA 2905[DC740000]                          sub     [rdtsc_antialias], eax
  2418 000016F0 1915[E0740000]                          sbb     [rdtsc_antialias+4], edx
  2419                                  
  2420                                  .no_rdtsc_supported:
  2421 000016F6 8B435C                                  mov     eax, [ebx+92]   ; [ebx+$mp3gr_num_nonzero_hybrids]
  2422 000016F9 83C008                                  add     eax, 8          ; 9-1 ; 0..576+8
  2423 000016FC 31D2                                    xor     edx, edx
  2424 000016FE B909000000                              mov     ecx, 9
  2425 00001703 F7F1                                    div     ecx             ; (num/9) ; 0..64
  2426 00001705 894360                                  mov     [ebx+60h], eax
  2427 00001708 D1E8                                    shr     eax, 1          ; (num/18) ; 0..32
  2428 0000170A 0F84B8010000                            jz      .no_antialias  ; 0 (when num/9 = 0..1)
  2429 00001710 89C1                                    mov     ecx, eax        ; 1..32
  2430 00001712 C1E805                                  shr     eax, 5          ; 0..1
  2431 00001715 29C1                                    sub     ecx, eax        ; 1..31 ; len excluding zeropadding
  2432 00001717 807B2C02                                cmp     byte [ebx+44], 2 ; [ebx+$mp3gr_block_type]
  2433 0000171B 750F                                    jnz     short .this_len ; antialias only "long" bands
  2434 0000171D 807B3000                                cmp     byte [ebx+48], 0 ; [ebx+$mp3gr_switch_point]
  2435 00001721 0F84A1010000                            jz      .no_antialias
  2436 00001727 B901000000                              mov     ecx, 1          ; check this for 8000Hz case
  2437                                  
  2438                                  .this_len:
  2439 0000172C 8D440901                                lea     eax, [1+ecx*2]
  2440 00001730 394360                                  cmp     [ebx+96], eax   ; [ebx+$mp3gr_num_nonzero_hybrids_div9]
  2441 00001733 7703                                    ja      short .is_bigger
  2442 00001735 894360                                  mov     [ebx+96], eax   ; opdate highest
  2443                                                                          ; (nonzero required for l3-si_huff.bit)
  2444                                  
  2445                                  .is_bigger:
  2446 00001738 53                                      push    ebx
  2447 00001739 8D9BA0000000                            lea     ebx, [ebx+160]  ; [ebx+$mp3gr_sb_hybrid]
  2448                                  
  2449                                  .lop:
  2450 0000173F 83C348                                  add     ebx, 72         ; 18*4
  2451 00001742 8B73FC                                  mov     esi, [ebx-4]    ; IRP nn,0,1,2,3,4,5,6,7 ; INT_AA(nn=0..7)
  2452 00001745 8B3B                                    mov     edi, [ebx]      ; @@def_csa macro nn,cs,ca
  2453                                                                          ;   mp3_csa_&nn&_cs equ cs
  2454                                                                          ;   mp3_csa_&nn&_ca equ ca
  2455                                                                          ;  endm
  2456                                                                          ; constants for mp3_csa_table
  2457 00001747 C1E602                                  shl     esi, 2          ; tmp0 = ptr[-nn-1]*4
  2458 0000174A C1E702                                  shl     edi, 2          ; tmp1 = ptr[+nn]*4
  2459 0000174D 8D043E                                  lea     eax, [esi+edi]  ; tmp2 = tmp0+tmp1
  2460 00001750 BD032AE136                              mov     ebp, 36E12A03h  ; @@def_csa 0,36E12A03h,-20ED7F9Ah  ;-0.6
  2461                                                                          ; mp3_csa_&nn&_cs
  2462 00001755 F7ED                                    imul    ebp             ; tmp2 = (tmp2*csa[0])
  2463 00001757 89D5                                    mov     ebp, edx
  2464 00001759 B8635631A8                              mov     eax, -57CEA99Dh ; mp3_csa_&nn&_ca-mp3_csa_&nn&_cs
  2465 0000175E F7EE                                    imul    esi             ; tmp0 = (tmp2+(tmp0*csa[3]))
  2466 00001760 01EA                                    add     edx, ebp
  2467 00001762 8913                                    mov     [ebx], edx      ; [ebx+(nn)*4]
  2468 00001764 B869AAF315                              mov     eax, 15F3AA69h  ; mp3_csa_&nn&_ca+mp3_csa_&nn&_cs
  2469 00001769 F7EF                                    imul    edi             ; tmp1 = (tmp2-(tmp1*csa[2]))
  2470 0000176B 29D5                                    sub     ebp, edx
  2471 0000176D 896BFC                                  mov     [ebx-4], ebp    ; [ebx-(nn+1)*4]
  2472 00001770 8B73F8                                  mov     esi, [ebx-8]
  2473 00001773 8B7B04                                  mov     edi, [ebx+4]
  2474 00001776 C1E602                                  shl     esi, 2
  2475 00001779 C1E702                                  shl     edi, 2
  2476 0000177C 8D043E                                  lea     eax, [esi+edi]
  2477 0000177F BDFD756E38                              mov     ebp, 386E75FDh  ; @@def_csa 1,386E75FDh,-1E30DB48h  ;-0.535
  2478 00001784 F7ED                                    imul    ebp
  2479 00001786 89D5                                    mov     ebp, edx
  2480 00001788 B8BBAE60A9                              mov     eax, -569F5145h
  2481 0000178D F7EE                                    imul    esi
  2482 0000178F 01EA                                    add     edx, ebp
  2483 00001791 895304                                  mov     [ebx+4], edx    ; [ebx+(nn)*4]
  2484 00001794 B8B59A3D1A                              mov     eax, 1A3D9AB5h
  2485 00001799 F7EF                                    imul    edi
  2486 0000179B 29D5                                    sub     ebp, edx
  2487 0000179D 896BF8                                  mov     [ebx-8], ebp    ; [ebx-(nn+1)*4]
  2488 000017A0 8B73F4                                  mov     esi, [ebx-12]
  2489 000017A3 8B7B08                                  mov     edi, [ebx+8]
  2490 000017A6 C1E602                                  shl     esi, 2
  2491 000017A9 C1E702                                  shl     edi, 2
  2492 000017AC 8D043E                                  lea     eax, [esi+edi]
  2493 000017AF BD3EB7C63C                              mov     ebp, 3CC6B73Eh  ;  @@def_csa 2,3CC6B73Eh,-140E604Fh  ;-0.33
  2494 000017B4 F7ED                                    imul    ebp
  2495 000017B6 89D5                                    mov     ebp, edx
  2496 000017B8 B873E82AAF                              mov     eax, -50D5178Dh
  2497 000017BD F7EE                                    imul    esi
  2498 000017BF 01EA                                    add     edx, ebp
  2499 000017C1 895308                                  mov     [ebx+8], edx    ; [ebx+(nn)*4]
  2500 000017C4 B8EF56B828                              mov     eax, 28B856EFh
  2501 000017C9 F7EF                                    imul    edi
  2502 000017CB 29D5                                    sub     ebp, edx
  2503 000017CD 896BF4                                  mov     [ebx-12], ebp   ; [ebx-(nn+1)*4]
  2504 000017D0 8B73F0                                  mov     esi, [ebx-16]
  2505 000017D3 8B7B0C                                  mov     edi, [ebx+12]
  2506 000017D6 C1E602                                  shl     esi, 2
  2507 000017D9 C1E702                                  shl     edi, 2
  2508 000017DC 8D043E                                  lea     eax, [esi+edi]
  2509 000017DF BD55A0EE3E                              mov     ebp, 3EEEA055h  ; @@def_csa 3,3EEEA055h,-0BA47742h  ;-0.185
  2510 000017E4 F7ED                                    imul    ebp
  2511 000017E6 89D5                                    mov     ebp, edx
  2512 000017E8 B869E86CB5                              mov     eax, -4A931797h
  2513 000017ED F7EE                                    imul    esi
  2514 000017EF 01EA                                    add     edx, ebp
  2515 000017F1 89530C                                  mov     [ebx+12], edx   ; [ebx+(nn)*4]
  2516 000017F4 B813294A33                              mov     eax, 334A2913h
  2517 000017F9 F7EF                                    imul    edi
  2518 000017FB 29D5                                    sub     ebp, edx
  2519 000017FD 896BF0                                  mov     [ebx-16], ebp   ; [ebx-(nn+1)*4]
  2520 00001800 8B73EC                                  mov     esi, [ebx-20]   ; ebx-(nn+1)*4] ; tmp0 = ptr[-nn-1]
  2521 00001803 8B7B10                                  mov     edi, [ebx+16]   ; [ebx+(nn)*4] ; tmp1 = ptr[+nn]
  2522 00001806 C1E602                                  shl     esi, 2
  2523 00001809 C1E702                                  shl     edi, 2
  2524 0000180C 8D043E                                  lea     eax, [esi+edi]  ; tmp2 = tmp0+tmp1
  2525 0000180F BD5C90B63F                              mov     ebp, 3FB6905Ch  ; @@def_csa 4,3FB6905Ch,-060D80E9h  ;-0.095
  2526 00001814 F7ED                                    imul    ebp             ; tmp2 = (tmp2*csa[0])
  2527 00001816 89D5                                    mov     ebp, edx
  2528 00001818 B8BBEE3BBA                              mov     eax, -45C41145h
  2529 0000181D F7EE                                    imul    esi             ; tmp0 = (tmp2+(tmp0*csa[3]))
  2530 0000181F 01EA                                    add     edx, ebp
  2531 00001821 895310                                  mov     [ebx+16], edx   ; [ebx+(nn)*4]
  2532 00001824 B8730FA939                              mov     eax, 39A90F73h
  2533 00001829 F7EF                                    imul    edi             ; tmp1 = (tmp2-(tmp1*csa[2]))
  2534 0000182B 29D5                                    sub     ebp, edx
  2535 0000182D 896BEC                                  mov     [ebx-20], ebp   ; [ebx-(nn+1)*4]
  2536 00001830 8B73E8                                  mov     esi, [ebx-24]
  2537 00001833 8B7B14                                  mov     edi, [ebx+20]
  2538 00001836 C1E602                                  shl     esi, 2
  2539 00001839 C1E702                                  shl     edi, 2
  2540 0000183C 8D043E                                  lea     eax, [esi+edi]
  2541 0000183F BD213FF23F                              mov     ebp, 3FF23F21h  ; @@def_csa 5,3FF23F21h,-029F2E1Bh  ;-0.041
  2542 00001844 F7ED                                    imul    ebp
  2543 00001846 89D5                                    mov     ebp, edx
  2544 00001848 B8C4926EBD                              mov     eax, -42916D3Ch
  2545 0000184D F7EE                                    imul    esi
  2546 0000184F 01EA                                    add     edx, ebp
  2547 00001851 895314                                  mov     [ebx+20], edx   ; [ebx+(nn)*4]
  2548 00001854 B80611533D                              mov     eax, 3D531106h
  2549 00001859 F7EF                                    imul    edi
  2550 0000185B 29D5                                    sub     ebp, edx
  2551 0000185D 896BE8                                  mov     [ebx-24], ebp   ; [ebx-(nn+1)*4]
  2552 00001860 8B73E4                                  mov     esi, [ebx-28]
  2553 00001863 8B7B18                                  mov     edi, [ebx+24]
  2554 00001866 C1E602                                  shl     esi, 2
  2555 00001869 C1E702                                  shl     edi, 2
  2556 0000186C 8D043E                                  lea     eax, [esi+edi]
  2557 0000186F BD3259FE3F                              mov     ebp, 3FFE5932h  ; @@def_csa 6,3FFE5932h,-00E8A11Ch  ;-0.0142
  2558 00001874 F7ED                                    imul    ebp
  2559 00001876 89D5                                    mov     ebp, edx
  2560 00001878 B8B20519BF                              mov     eax, -40E6FA4Eh
  2561 0000187D F7EE                                    imul    esi
  2562 0000187F 01EA                                    add     edx, ebp
  2563 00001881 895318                                  mov     [ebx+24], edx   ; [ebx+(nn)*4]
  2564 00001884 B816B8153F                              mov     eax, 3F15B816h
  2565 00001889 F7EF                                    imul    edi
  2566 0000188B 29D5                                    sub     ebp, edx
  2567 0000188D 896BE4                                  mov     [ebx-28], ebp   ; [ebx-(nn+1)*4]
  2568 00001890 8B73E0                                  mov     esi, [ebx-32]
  2569 00001893 8B7B1C                                  mov     edi, [ebx+28]
  2570 00001896 C1E602                                  shl     esi, 2
  2571 00001899 C1E702                                  shl     edi, 2
  2572 0000189C 8D043E                                  lea     eax, [esi+edi]
  2573 0000189F BD4BE3FF3F                              mov     ebp, 3FFFE34Bh  ; @@def_csa 7,3FFFE34Bh,-003C9ED1h  ;-0.0037
  2574 000018A4 F7ED                                    imul    ebp
  2575 000018A6 89D5                                    mov     ebp, edx
  2576 000018A8 B8E47DC3BF                              mov     eax, -403C821Ch
  2577 000018AD F7EE                                    imul    esi
  2578 000018AF 01EA                                    add     edx, ebp
  2579 000018B1 89531C                                  mov     [ebx+28], edx   ; [ebx+(nn)*4]
  2580 000018B4 B87A44C33F                              mov     eax, 3FC3447Ah
  2581 000018B9 F7EF                                    imul    edi
  2582 000018BB 29D5                                    sub     ebp, edx
  2583 000018BD 896BE0                                  mov     [ebx-32], ebp   ; [ebx-(nn+1)*4]
  2584 000018C0 49                                      dec     ecx
  2585 000018C1 0F8578FEFFFF                            jnz     .lop
  2586 000018C7 5B                                      pop     ebx
  2587                                  
  2588                                  .no_antialias:
  2589 000018C8 F605[DC730000]10                        test    byte [cpuid_flags], 10h
  2590 000018CF 740E                                    jz      short .no_rdtsc_supported@
  2591 000018D1 0F31                                    rdtsc
  2592 000018D3 0105[DC740000]                          add     [rdtsc_antialias], eax
  2593 000018D9 1115[E0740000]                          adc     [rdtsc_antialias+4], edx
  2594                                  
  2595                                  .no_rdtsc_supported@:
  2596 000018DF C3                                      retn
  2597                                  
  2598                                  
  2599                                  ; =============== S U B R O U T I N E =======================================
  2600                                  
  2601                                  
  2602                                  mp3_imdct36:
  2603 000018E0 8B06                                    mov     eax, [esi]      ; in: esi=src (sb_hybrid)
  2604                                                                          ; in: edi=dst (sb_samples)
  2605                                                                          ; in: ebx=buf (mdct_buf)
  2606                                                                          ; in: ebp=win (mdct_win)
  2607                                                                          ;
  2608                                                                          ; [esi+0*4]
  2609 000018E2 8B5604                                  mov     edx, [esi+4]    ; IRP i,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17
  2610 000018E5 01D0                                    add     eax, edx        ; IF i AND 1 (*) ; mov edx,[esi+i*4] ; val[i]
  2611                                                                          ;  add val[i-1]
  2612 000018E7 894604                                  mov     [esi+4], eax    ;  IF i GT 1
  2613                                                                          ;   add  ecx,eax ; add val[i-2]
  2614                                                                          ;   mov  [esi+(i)*4],ecx
  2615                                                                          ;  ELSE
  2616                                                                          ;   mov  [esi+(i)*4],eax
  2617 000018EA 89C1                                    mov     ecx, eax        ;  memorize as val[i-2]
  2618 000018EC 8B4608                                  mov     eax, [esi+8]    ; ELSE (*) ; [esi+i*4] ; val[i]
  2619 000018EF 01C2                                    add     edx, eax        ;  add val[i-1]
  2620 000018F1 895608                                  mov     [esi+8], edx    ; [esi+(i)*4
  2621 000018F4 8B560C                                  mov     edx, [esi+12]
  2622 000018F7 01D0                                    add     eax, edx
  2623 000018F9 01C1                                    add     ecx, eax
  2624 000018FB 894E0C                                  mov     [esi+12], ecx
  2625 000018FE 89C1                                    mov     ecx, eax
  2626 00001900 8B4610                                  mov     eax, [esi+16]
  2627 00001903 01C2                                    add     edx, eax
  2628 00001905 895610                                  mov     [esi+16], edx
  2629 00001908 8B5614                                  mov     edx, [esi+20]
  2630 0000190B 01D0                                    add     eax, edx
  2631 0000190D 01C1                                    add     ecx, eax
  2632 0000190F 894E14                                  mov     [esi+20], ecx
  2633 00001912 89C1                                    mov     ecx, eax
  2634 00001914 8B4618                                  mov     eax, [esi+24]
  2635 00001917 01C2                                    add     edx, eax
  2636 00001919 895618                                  mov     [esi+24], edx
  2637 0000191C 8B561C                                  mov     edx, [esi+28]
  2638 0000191F 01D0                                    add     eax, edx
  2639 00001921 01C1                                    add     ecx, eax
  2640 00001923 894E1C                                  mov     [esi+28], ecx
  2641 00001926 89C1                                    mov     ecx, eax
  2642 00001928 8B4620                                  mov     eax, [esi+32]
  2643 0000192B 01C2                                    add     edx, eax
  2644 0000192D 895620                                  mov     [esi+32], edx
  2645 00001930 8B5624                                  mov     edx, [esi+36]
  2646 00001933 01D0                                    add     eax, edx
  2647 00001935 01C1                                    add     ecx, eax
  2648 00001937 894E24                                  mov     [esi+36], ecx
  2649 0000193A 89C1                                    mov     ecx, eax
  2650 0000193C 8B4628                                  mov     eax, [esi+40]
  2651 0000193F 01C2                                    add     edx, eax
  2652 00001941 895628                                  mov     [esi+40], edx
  2653 00001944 8B562C                                  mov     edx, [esi+44]
  2654 00001947 01D0                                    add     eax, edx
  2655 00001949 01C1                                    add     ecx, eax
  2656 0000194B 894E2C                                  mov     [esi+44], ecx
  2657 0000194E 89C1                                    mov     ecx, eax
  2658 00001950 8B4630                                  mov     eax, [esi+48]
  2659 00001953 01C2                                    add     edx, eax
  2660 00001955 895630                                  mov     [esi+48], edx
  2661 00001958 8B5634                                  mov     edx, [esi+52]
  2662 0000195B 01D0                                    add     eax, edx
  2663 0000195D 01C1                                    add     ecx, eax
  2664 0000195F 894E34                                  mov     [esi+52], ecx
  2665 00001962 89C1                                    mov     ecx, eax
  2666 00001964 8B4638                                  mov     eax, [esi+56]
  2667 00001967 01C2                                    add     edx, eax
  2668 00001969 895638                                  mov     [esi+56], edx
  2669 0000196C 8B563C                                  mov     edx, [esi+60]
  2670 0000196F 01D0                                    add     eax, edx
  2671 00001971 01C1                                    add     ecx, eax
  2672 00001973 894E3C                                  mov     [esi+60], ecx
  2673 00001976 89C1                                    mov     ecx, eax
  2674 00001978 8B4640                                  mov     eax, [esi+64]
  2675 0000197B 01C2                                    add     edx, eax
  2676 0000197D 895640                                  mov     [esi+64], edx
  2677 00001980 8B5644                                  mov     edx, [esi+68]
  2678 00001983 01D0                                    add     eax, edx
  2679 00001985 01C1                                    add     ecx, eax
  2680 00001987 894E44                                  mov     [esi+68], ecx
  2681 0000198A 89C1                                    mov     ecx, eax
  2682 0000198C 53                                      push    ebx
  2683 0000198D 55                                      push    ebp
  2684 0000198E 57                                      push    edi
  2685 0000198F 8B0E                                    mov     ecx, [esi]      ; IRP j,0,1
  2686 00001991 8B5E30                                  mov     ebx, [esi+48]   ; t1 = [esi+(0*2+j)*4], t0 = [esi+(6*2+j)*4]
  2687 00001994 8B7E20                                  mov     edi, [esi+32]   ; t2 = [esi+(4*2+j)*4]
  2688 00001997 037E40                                  add     edi, [esi+64]   ; + [esi+(8*2+j)*4]
  2689 0000199A 2B7E10                                  sub     edi, [esi+16]   ; - [esi+(2*2+j)*4]
  2690 0000199D 8D2C4B                                  lea     ebp, [ebx+ecx*2] ; t2 = src[4*2+j] + src[8*2+j] - src[2*2+j]
  2691                                                                          ; t3 = [t1*2+t0]
  2692 000019A0 D1FD                                    sar     ebp, 1          ; sar @@t3,1
  2693 000019A2 29D9                                    sub     ecx, ebx        ; sub @@t1,@@t0
  2694 000019A4 89C8                                    mov     eax, ecx        ; @@SUM [@@tmp+(16+j)*4],@@t1,add,@@t2
  2695 000019A6 01F8                                    add     eax, edi
  2696 000019A8 A3[04270500]                            mov     [_@@@tmp+40h], eax ; [@@tmp+(16+j)*4]
  2697 000019AD D1FF                                    sar     edi, 1          ; sar @@t2,1
  2698 000019AF 89C8                                    mov     eax, ecx        ; @@SUM [@@tmp+(6+j)*4],@@t1,sub,@@t2
  2699 000019B1 29F8                                    sub     eax, edi
  2700 000019B3 A3[DC260500]                            mov     [_@@@tmp+18h], eax ; [@@tmp+(6+j)*4]
  2701 000019B8 8B4610                                  mov     eax, [esi+16]   ; [esi+(4*2+j)*4]
  2702 000019BB 034620                                  add     eax, [esi+32]   ; [esi+(2*2+j)*4]
  2703 000019BE D1E0                                    shl     eax, 1
  2704 000019C0 BA0AD94778                              mov     edx, 7847D90Ah  ; C2
  2705 000019C5 F7EA                                    imul    edx
  2706 000019C7 89D3                                    mov     ebx, edx
  2707 000019C9 8B4620                                  mov     eax, [esi+32]
  2708 000019CC 2B4640                                  sub     eax, [esi+64]
  2709 000019CF BA04CB8BD3                              mov     edx, 0D38BCB04h ; negC8
  2710 000019D4 F7EA                                    imul    edx
  2711 000019D6 89D1                                    mov     ecx, edx
  2712 000019D8 8B4610                                  mov     eax, [esi+16]
  2713 000019DB 034640                                  add     eax, [esi+64]
  2714 000019DE D1E0                                    shl     eax, 1
  2715 000019E0 BA7541F29D                              mov     edx, 9DF24175h  ; negC4
  2716 000019E5 F7EA                                    imul    edx
  2717 000019E7 89E8                                    mov     eax, ebp
  2718 000019E9 01D8                                    add     eax, ebx
  2719 000019EB 01C8                                    add     eax, ecx
  2720 000019ED A3[CC260500]                            mov     [_@@@tmp+8], eax
  2721 000019F2 89E8                                    mov     eax, ebp
  2722 000019F4 29D8                                    sub     eax, ebx
  2723 000019F6 29D0                                    sub     eax, edx
  2724 000019F8 A3[EC260500]                            mov     [_@@@tmp+28h], eax
  2725 000019FD 89E8                                    mov     eax, ebp
  2726 000019FF 01D0                                    add     eax, edx
  2727 00001A01 29C8                                    sub     eax, ecx
  2728 00001A03 A3[FC260500]                            mov     [_@@@tmp+38h], eax
  2729 00001A08 8B4628                                  mov     eax, [esi+40]
  2730 00001A0B 034638                                  add     eax, [esi+56]
  2731 00001A0E 2B4608                                  sub     eax, [esi+8]
  2732 00001A11 D1E0                                    shl     eax, 1
  2733 00001A13 BA5F142691                              mov     edx, 9126145Fh  ; negC3
  2734 00001A18 F7EA                                    imul    edx
  2735 00001A1A 8915[D4260500]                          mov     [_@@@tmp+10h], edx
  2736 00001A20 8B4608                                  mov     eax, [esi+8]
  2737 00001A23 034628                                  add     eax, [esi+40]
  2738 00001A26 D1E0                                    shl     eax, 1
  2739 00001A28 BA332E0E7E                              mov     edx, 7E0E2E33h  ; C1
  2740 00001A2D F7EA                                    imul    edx
  2741 00001A2F 89D7                                    mov     edi, edx
  2742 00001A31 8B4628                                  mov     eax, [esi+40]
  2743 00001A34 2B4638                                  sub     eax, [esi+56]
  2744 00001A37 BA2E5E71A8                              mov     edx, 0A8715E2Eh ; negC7
  2745 00001A3C F7EA                                    imul    edx
  2746 00001A3E 89D5                                    mov     ebp, edx
  2747 00001A40 8B4608                                  mov     eax, [esi+8]
  2748 00001A43 034638                                  add     eax, [esi+56]
  2749 00001A46 D1E0                                    shl     eax, 1
  2750 00001A48 BAB822B9AD                              mov     edx, 0ADB922B8h ; negC5
  2751 00001A4D F7EA                                    imul    edx
  2752 00001A4F 89D1                                    mov     ecx, edx
  2753 00001A51 8B4618                                  mov     eax, [esi+24]
  2754 00001A54 D1E0                                    shl     eax, 1
  2755 00001A56 BAA2EBD96E                              mov     edx, 6ED9EBA2h  ; C3
  2756 00001A5B F7EA                                    imul    edx
  2757 00001A5D 89E8                                    mov     eax, ebp
  2758 00001A5F 01F8                                    add     eax, edi
  2759 00001A61 01D0                                    add     eax, edx
  2760 00001A63 A3[C4260500]                            mov     [_@@@tmp], eax
  2761 00001A68 89E8                                    mov     eax, ebp
  2762 00001A6A 29C8                                    sub     eax, ecx
  2763 00001A6C 29D0                                    sub     eax, edx
  2764 00001A6E A3[E4260500]                            mov     [_@@@tmp+20h], eax
  2765 00001A73 89F8                                    mov     eax, edi
  2766 00001A75 01C8                                    add     eax, ecx
  2767 00001A77 29D0                                    sub     eax, edx
  2768 00001A79 A3[F4260500]                            mov     [_@@@tmp+30h], eax
  2769 00001A7E 8B4E04                                  mov     ecx, [esi+4]
  2770 00001A81 8B5E34                                  mov     ebx, [esi+52]
  2771 00001A84 8B7E24                                  mov     edi, [esi+36]
  2772 00001A87 037E44                                  add     edi, [esi+68]
  2773 00001A8A 2B7E14                                  sub     edi, [esi+20]
  2774 00001A8D 8D2C4B                                  lea     ebp, [ebx+ecx*2]
  2775 00001A90 D1FD                                    sar     ebp, 1
  2776 00001A92 29D9                                    sub     ecx, ebx
  2777 00001A94 89C8                                    mov     eax, ecx
  2778 00001A96 01F8                                    add     eax, edi
  2779 00001A98 A3[08270500]                            mov     [_@@@tmp+44h], eax
  2780 00001A9D D1FF                                    sar     edi, 1
  2781 00001A9F 89C8                                    mov     eax, ecx
  2782 00001AA1 29F8                                    sub     eax, edi
  2783 00001AA3 A3[E0260500]                            mov     [_@@@tmp+1Ch], eax
  2784 00001AA8 8B4614                                  mov     eax, [esi+20]   ; t0 = MULH(2*(src[2*2+j]+src[4*2+j]),C2)
  2785 00001AAB 034624                                  add     eax, [esi+36]
  2786 00001AAE D1E0                                    shl     eax, 1
  2787 00001AB0 BA0AD94778                              mov     edx, 7847D90Ah  ; C2
  2788 00001AB5 F7EA                                    imul    edx
  2789 00001AB7 89D3                                    mov     ebx, edx
  2790 00001AB9 8B4624                                  mov     eax, [esi+36]   ; t1 = MULH(src[4*2+j]-src[8*2+j],negC8)
  2791 00001ABC 2B4644                                  sub     eax, [esi+68]
  2792 00001ABF BA04CB8BD3                              mov     edx, 0D38BCB04h ; negC8
  2793 00001AC4 F7EA                                    imul    edx
  2794 00001AC6 89D1                                    mov     ecx, edx
  2795 00001AC8 8B4614                                  mov     eax, [esi+20]   ; t2 = MULH(2*(src[2*2+j]+src[8*2+j]),negC4)
  2796 00001ACB 034644                                  add     eax, [esi+68]
  2797 00001ACE D1E0                                    shl     eax, 1
  2798 00001AD0 BA7541F29D                              mov     edx, 9DF24175h  ; negC4
  2799 00001AD5 F7EA                                    imul    edx
  2800 00001AD7 89E8                                    mov     eax, ebp        ; tmp[2+j] = t3+t0+t1
  2801 00001AD9 01D8                                    add     eax, ebx
  2802 00001ADB 01C8                                    add     eax, ecx
  2803 00001ADD A3[D0260500]                            mov     [_@@@tmp+0Ch], eax
  2804 00001AE2 89E8                                    mov     eax, ebp        ; tmp[10+j] = t3-t0-t2
  2805 00001AE4 29D8                                    sub     eax, ebx
  2806 00001AE6 29D0                                    sub     eax, edx
  2807 00001AE8 A3[F0260500]                            mov     [_@@@tmp+2Ch], eax
  2808 00001AED 89E8                                    mov     eax, ebp        ; tmp[14+j] = t3+t2-t1
  2809 00001AEF 01D0                                    add     eax, edx
  2810 00001AF1 29C8                                    sub     eax, ecx
  2811 00001AF3 A3[00270500]                            mov     [_@@@tmp+3Ch], eax
  2812 00001AF8 8B462C                                  mov     eax, [esi+44]   ; tmp[4+j] = MULH(2*(src[5*2+j]+src[7*2+j]-src[1*2+j]),negC3)
  2813 00001AFB 03463C                                  add     eax, [esi+60]
  2814 00001AFE 2B460C                                  sub     eax, [esi+12]
  2815 00001B01 D1E0                                    shl     eax, 1
  2816 00001B03 BA5F142691                              mov     edx, 9126145Fh  ; negC3
  2817 00001B08 F7EA                                    imul    edx
  2818 00001B0A 8915[D8260500]                          mov     [_@@@tmp+14h], edx
  2819 00001B10 8B460C                                  mov     eax, [esi+12]   ; @@MULH @@t2,[esi+(1*2+j)*4],add,[esi+(5*2+j)*4],-,-              ,1,C1,-
  2820                                                                          ; t2 = MULH(2*(src[1*2+j],add,src[5*2+j]),-,-,1,C1)
  2821 00001B13 03462C                                  add     eax, [esi+44]
  2822 00001B16 D1E0                                    shl     eax, 1
  2823 00001B18 BA332E0E7E                              mov     edx, 7E0E2E33h  ; C1
  2824 00001B1D F7EA                                    imul    edx
  2825 00001B1F 89D7                                    mov     edi, edx
  2826 00001B21 8B462C                                  mov     eax, [esi+44]   ; @@MULH @@t3,[esi+(5*2+j)*4],sub,[esi+(7*2+j)*4],-,-,
  2827                                                                          ; ,0,negC7,-
  2828                                                                          ;
  2829                                                                          ; t3 = MULH( src[5*2+j],sub,src[7*2+j],-,-,0,negC7)
  2830 00001B24 2B463C                                  sub     eax, [esi+60]
  2831 00001B27 BA2E5E71A8                              mov     edx, 0A8715E2Eh ; negC7
  2832 00001B2C F7EA                                    imul    edx
  2833 00001B2E 89D5                                    mov     ebp, edx
  2834 00001B30 8B460C                                  mov     eax, [esi+12]   ; t1 = MULH(2*(src[1*2+j],add,src[7*2+j]),-,-,1,negC5)
  2835 00001B33 03463C                                  add     eax, [esi+60]
  2836 00001B36 D1E0                                    shl     eax, 1          ; shift = 1
  2837 00001B38 BAB822B9AD                              mov     edx, 0ADB922B8h ; negC5
  2838 00001B3D F7EA                                    imul    edx
  2839 00001B3F 89D1                                    mov     ecx, edx
  2840 00001B41 8B461C                                  mov     eax, [esi+28]   ; t0 = MULH(2*src[3*2+j],-,-,-,-,1,C3)
  2841 00001B44 D1E0                                    shl     eax, 1
  2842 00001B46 BAA2EBD96E                              mov     edx, 6ED9EBA2h  ; C3
  2843 00001B4B F7EA                                    imul    edx
  2844 00001B4D 89E8                                    mov     eax, ebp
  2845 00001B4F 01F8                                    add     eax, edi
  2846 00001B51 01D0                                    add     eax, edx
  2847 00001B53 A3[C8260500]                            mov     [_@@@tmp+4], eax
  2848 00001B58 89E8                                    mov     eax, ebp
  2849 00001B5A 29C8                                    sub     eax, ecx
  2850 00001B5C 29D0                                    sub     eax, edx
  2851 00001B5E A3[E8260500]                            mov     [_@@@tmp+24h], eax
  2852 00001B63 89F8                                    mov     eax, edi        ; @@SUM [@@tmp+(12+j)*4],@@t2,add,@@t1,sub,edx
  2853 00001B65 01C8                                    add     eax, ecx
  2854 00001B67 29D0                                    sub     eax, edx
  2855 00001B69 A3[F8260500]                            mov     [_@@@tmp+34h], eax
  2856 00001B6E 5F                                      pop     edi
  2857 00001B6F 5D                                      pop     ebp
  2858 00001B70 5B                                      pop     ebx
  2859 00001B71 56                                      push    esi             ; IRP j,0,1,2,3 ; j = 0
  2860 00001B72 8B15[C4260500]                          mov     edx, [_@@@tmp] ; t0 = [@@tmp+(j*4+0)*4]
  2861 00001B78 8B35[C8260500]                          mov     esi, [_@@@tmp+4] ; t1 = [@@tmp+(j*4+1)*4]
  2862 00001B7E A1[CC260500]                            mov     eax, [_@@@tmp+8] ; t2 = [@@tmp+(j*4+2)*4]
  2863 00001B83 8B0D[D0260500]                          mov     ecx, [_@@@tmp+0Ch] ; t2 = [@@tmp+(j*4+3)*4]
  2864 00001B89 29D0                                    sub     eax, edx        ; s2 = t2 - t0
  2865 00001B8B 8D1450                                  lea     edx, [eax+edx*2] ; s0 = t2 + t0
  2866 00001B8E A3[BC260500]                            mov     [_@@s2], eax ; @@MULH esi,eax ,-,-,-,-,1,icos36h_&j,-
  2867                                                                          ; s2 = MULH(s2*2, icos36h[j])
  2868 00001B93 8915[B8260500]                          mov     [_@@s0], edx
  2869 00001B99 29F1                                    sub     ecx, esi
  2870 00001B9B 8D0471                                  lea     eax, [ecx+esi*2]
  2871 00001B9E D1E0                                    shl     eax, 1
  2872 00001BA0 BA90953E40                              mov     edx, 403E9590h  ; icos36h_0
  2873 00001BA5 F7EA                                    imul    edx
  2874 00001BA7 89D6                                    mov     esi, edx
  2875 00001BA9 89C8                                    mov     eax, ecx        ; @@MULH @@s3,ecx,-,-,-,-,shift_for_8minus&j,icos36h_8minus&j,-
  2876                                                                          ; s3 = MULL(s3,icos36[8-j]) ; <-- "MULL" with "icos36"
  2877 00001BAB C1E004                                  shl     eax, 4
  2878 00001BAE BA2C2ACA5B                              mov     edx, 5BCA2A2Ch  ; icos36h_8 (8-0)
  2879 00001BB3 F7EA                                    imul    edx
  2880 00001BB5 8915[C0260500]                          mov     [_@@s3], edx
  2881 00001BBB 8B0D[B8260500]                          mov     ecx, [_@@s0]
  2882 00001BC1 29F1                                    sub     ecx, esi
  2883 00001BC3 8D3471                                  lea     esi, [ecx+esi*2]
  2884 00001BC6 8B4524                                  mov     eax, [ebp+36]   ; @@MULH [edi+(9+j)*SBLIMIT*4],[ebp+(9+j)*4],
  2885                                                                          ; -,-,-,-,0,ecx,[ebx+(9+j)*4]
  2886                                                                          ; out[(9+j)*SBLIMIT] = MULH(t0, win[9+j])+buf[9+j]
  2887 00001BC9 F7E9                                    imul    ecx
  2888 00001BCB 035324                                  add     edx, [ebx+36]   ; [ebx+(9+j)*4]
  2889 00001BCE 899780040000                            mov     [edi+1152], edx ; SBLIMIT=32 ; 9*SBLIMIT*4 = 1152
  2890 00001BD4 8B4520                                  mov     eax, [ebp+32]   ; @@MULH [edi+(8-j)*SBLIMIT*4],[ebp+(8-j)*4]
  2891                                                                          ; ,-,-,-,-,0,ecx,[ebx+(8-j)*4]
  2892 00001BD7 F7E9                                    imul    ecx
  2893 00001BD9 035320                                  add     edx, [ebx+32]
  2894 00001BDC 899700040000                            mov     [edi+1024], edx ; SBLIMIT=32 ; 8*SBLIMIT*4 = 1024
  2895 00001BE2 8B456C                                  mov     eax, [ebp+108]
  2896 00001BE5 F7EE                                    imul    esi
  2897 00001BE7 895324                                  mov     [ebx+36], edx
  2898 00001BEA 8B4568                                  mov     eax, [ebp+104]  ; @@MULH [ebx+(8-j)*4],[ebp+(8-j+18)*4],-,-,-,-,0,esi,-
  2899 00001BED F7EE                                    imul    esi
  2900 00001BEF 895320                                  mov     [ebx+32], edx
  2901 00001BF2 8B0D[BC260500]                          mov     ecx, [_@@s2]
  2902 00001BF8 8B35[C0260500]                          mov     esi, [_@@s3]
  2903 00001BFE 29F1                                    sub     ecx, esi        ; t2 = s2 - s3
  2904 00001C00 8D3471                                  lea     esi, [ecx+esi*2] ; t3 = s2 + s3
  2905 00001C03 8B4500                                  mov     eax, [ebp+0]    ; @@MULH [edi+(0+j)*SBLIMIT*4],[ebp+(0+j)*4],
  2906                                                                          ; -,-,-,-,0,ecx,[ebx+(0+j)*4]
  2907 00001C06 F7E9                                    imul    ecx
  2908 00001C08 0313                                    add     edx, [ebx]
  2909 00001C0A 8917                                    mov     [edi], edx
  2910 00001C0C 8B4544                                  mov     eax, [ebp+68]   ; @@MULH [edi+(17-j)*SBLIMIT*4],[ebp+(17-j)*4]
  2911                                                                          ; ,-,-,-,-,0,ecx,[ebx+(17-j)*4]
  2912 00001C0F F7E9                                    imul    ecx
  2913 00001C11 035344                                  add     edx, [ebx+68]
  2914 00001C14 899780080000                            mov     [edi+2176], edx ; 17*SBLIMIT*4 = 2176
  2915 00001C1A 8B4548                                  mov     eax, [ebp+72]   ; @@MULH [ebx+(0+j)*4],[ebp+(0+j+18)*4],-,-,-,-,0,esi,-
  2916 00001C1D F7EE                                    imul    esi
  2917 00001C1F 8913                                    mov     [ebx], edx
  2918 00001C21 8B858C000000                            mov     eax, [ebp+140]  ; @@MULH [ebx+(17-j)*4],[ebp+(17-j+18)*4],-,-,-,-,0,esi,-
  2919 00001C27 F7EE                                    imul    esi
  2920 00001C29 895344                                  mov     [ebx+68], edx
  2921 00001C2C 8B15[D4260500]                          mov     edx, [_@@@tmp+10h] ; IRP j,0,1,2,3 ; j = 1
  2922 00001C32 8B35[D8260500]                          mov     esi, [_@@@tmp+14h]
  2923 00001C38 A1[DC260500]                            mov     eax, [_@@@tmp+18h]
  2924 00001C3D 8B0D[E0260500]                          mov     ecx, [_@@@tmp+1Ch]
  2925 00001C43 29D0                                    sub     eax, edx
  2926 00001C45 8D1450                                  lea     edx, [eax+edx*2]
  2927 00001C48 A3[BC260500]                            mov     [_@@s2], eax
  2928 00001C4D 8915[B8260500]                          mov     [_@@s0], edx
  2929 00001C53 29F1                                    sub     ecx, esi
  2930 00001C55 8D0471                                  lea     eax, [ecx+esi*2]
  2931 00001C58 D1E0                                    shl     eax, 1
  2932 00001C5A BA07F74142                              mov     edx, 4241F707h  ; icos36h_1
  2933 00001C5F F7EA                                    imul    edx
  2934 00001C61 89D6                                    mov     esi, edx
  2935 00001C63 89C8                                    mov     eax, ecx
  2936 00001C65 C1E002                                  shl     eax, 2
  2937 00001C68 BA1E75A37B                              mov     edx, 7BA3751Eh  ; icos36h_7 (8-1)
  2938 00001C6D F7EA                                    imul    edx
  2939 00001C6F 8915[C0260500]                          mov     [_@@s3], edx
  2940 00001C75 8B0D[B8260500]                          mov     ecx, [_@@s0]
  2941 00001C7B 29F1                                    sub     ecx, esi
  2942 00001C7D 8D3471                                  lea     esi, [ecx+esi*2]
  2943 00001C80 8B4528                                  mov     eax, [ebp+40]
  2944 00001C83 F7E9                                    imul    ecx
  2945 00001C85 035328                                  add     edx, [ebx+40]
  2946 00001C88 899700050000                            mov     [edi+1280], edx
  2947 00001C8E 8B451C                                  mov     eax, [ebp+28]
  2948 00001C91 F7E9                                    imul    ecx
  2949 00001C93 03531C                                  add     edx, [ebx+28]
  2950 00001C96 899780030000                            mov     [edi+896], edx
  2951 00001C9C 8B4570                                  mov     eax, [ebp+112]
  2952 00001C9F F7EE                                    imul    esi
  2953 00001CA1 895328                                  mov     [ebx+40], edx
  2954 00001CA4 8B4564                                  mov     eax, [ebp+100]
  2955 00001CA7 F7EE                                    imul    esi
  2956 00001CA9 89531C                                  mov     [ebx+28], edx
  2957 00001CAC 8B0D[BC260500]                          mov     ecx, [_@@s2]
  2958 00001CB2 8B35[C0260500]                          mov     esi, [_@@s3]
  2959 00001CB8 29F1                                    sub     ecx, esi
  2960 00001CBA 8D3471                                  lea     esi, [ecx+esi*2]
  2961 00001CBD 8B4504                                  mov     eax, [ebp+4]
  2962 00001CC0 F7E9                                    imul    ecx
  2963 00001CC2 035304                                  add     edx, [ebx+4]
  2964 00001CC5 899780000000                            mov     [edi+128], edx
  2965 00001CCB 8B4540                                  mov     eax, [ebp+64]
  2966 00001CCE F7E9                                    imul    ecx
  2967 00001CD0 035340                                  add     edx, [ebx+64]
  2968 00001CD3 899700080000                            mov     [edi+2048], edx
  2969 00001CD9 8B454C                                  mov     eax, [ebp+76]
  2970 00001CDC F7EE                                    imul    esi
  2971 00001CDE 895304                                  mov     [ebx+4], edx
  2972 00001CE1 8B8588000000                            mov     eax, [ebp+136]
  2973 00001CE7 F7EE                                    imul    esi
  2974 00001CE9 895340                                  mov     [ebx+64], edx
  2975 00001CEC 8B15[E4260500]                          mov     edx, [_@@@tmp+20h] ; IRP j,0,1,2,3 ; j = 2
  2976 00001CF2 8B35[E8260500]                          mov     esi, [_@@@tmp+24h]
  2977 00001CF8 A1[EC260500]                            mov     eax, [_@@@tmp+28h]
  2978 00001CFD 8B0D[F0260500]                          mov     ecx, [_@@@tmp+2Ch]
  2979 00001D03 29D0                                    sub     eax, edx
  2980 00001D05 8D1450                                  lea     edx, [eax+edx*2]
  2981 00001D08 A3[BC260500]                            mov     [_@@s2], eax
  2982 00001D0D 8915[B8260500]                          mov     [_@@s0], edx
  2983 00001D13 29F1                                    sub     ecx, esi
  2984 00001D15 8D0471                                  lea     eax, [ecx+esi*2]
  2985 00001D18 D1E0                                    shl     eax, 1
  2986 00001D1A BA6CBE9D46                              mov     edx, 469DBE6Ch  ; icos36h_2
  2987 00001D1F F7EA                                    imul    edx
  2988 00001D21 89D6                                    mov     esi, edx
  2989 00001D23 89C8                                    mov     eax, ecx
  2990 00001D25 C1E002                                  shl     eax, 2
  2991 00001D28 BA62ECB74B                              mov     edx, 4BB7EC62h  ; icos36h_6 (8-2)
  2992 00001D2D F7EA                                    imul    edx
  2993 00001D2F 8915[C0260500]                          mov     [_@@s3], edx
  2994 00001D35 8B0D[B8260500]                          mov     ecx, [_@@s0]
  2995 00001D3B 29F1                                    sub     ecx, esi
  2996 00001D3D 8D3471                                  lea     esi, [ecx+esi*2]
  2997 00001D40 8B452C                                  mov     eax, [ebp+44]
  2998 00001D43 F7E9                                    imul    ecx
  2999 00001D45 03532C                                  add     edx, [ebx+44]
  3000 00001D48 899780050000                            mov     [edi+1408], edx
  3001 00001D4E 8B4518                                  mov     eax, [ebp+24]
  3002 00001D51 F7E9                                    imul    ecx
  3003 00001D53 035318                                  add     edx, [ebx+24]
  3004 00001D56 899700030000                            mov     [edi+768], edx
  3005 00001D5C 8B4574                                  mov     eax, [ebp+116]
  3006 00001D5F F7EE                                    imul    esi
  3007 00001D61 89532C                                  mov     [ebx+44], edx
  3008 00001D64 8B4560                                  mov     eax, [ebp+96]
  3009 00001D67 F7EE                                    imul    esi
  3010 00001D69 895318                                  mov     [ebx+24], edx
  3011 00001D6C 8B0D[BC260500]                          mov     ecx, [_@@s2]
  3012 00001D72 8B35[C0260500]                          mov     esi, [_@@s3]
  3013 00001D78 29F1                                    sub     ecx, esi
  3014 00001D7A 8D3471                                  lea     esi, [ecx+esi*2]
  3015 00001D7D 8B4508                                  mov     eax, [ebp+8]
  3016 00001D80 F7E9                                    imul    ecx
  3017 00001D82 035308                                  add     edx, [ebx+8]
  3018 00001D85 899700010000                            mov     [edi+256], edx
  3019 00001D8B 8B453C                                  mov     eax, [ebp+60]
  3020 00001D8E F7E9                                    imul    ecx
  3021 00001D90 03533C                                  add     edx, [ebx+60]
  3022 00001D93 899780070000                            mov     [edi+1920], edx
  3023 00001D99 8B4550                                  mov     eax, [ebp+80]
  3024 00001D9C F7EE                                    imul    esi
  3025 00001D9E 895308                                  mov     [ebx+8], edx
  3026 00001DA1 8B8584000000                            mov     eax, [ebp+132]
  3027 00001DA7 F7EE                                    imul    esi
  3028 00001DA9 89533C                                  mov     [ebx+60], edx
  3029 00001DAC 8B15[F4260500]                          mov     edx, [_@@@tmp+30h] ; IRP j,0,1,2,3 ; j = 3
  3030 00001DB2 8B35[F8260500]                          mov     esi, [_@@@tmp+34h]
  3031 00001DB8 A1[FC260500]                            mov     eax, [_@@@tmp+38h]
  3032 00001DBD 8B0D[00270500]                          mov     ecx, [_@@@tmp+3Ch]
  3033 00001DC3 29D0                                    sub     eax, edx
  3034 00001DC5 8D1450                                  lea     edx, [eax+edx*2]
  3035 00001DC8 A3[BC260500]                            mov     [_@@s2], eax
  3036 00001DCD 8915[B8260500]                          mov     [_@@s0], edx
  3037 00001DD3 29F1                                    sub     ecx, esi
  3038 00001DD5 8D0471                                  lea     eax, [ecx+esi*2]
  3039 00001DD8 D1E0                                    shl     eax, 1
  3040 00001DDA BABE2B214E                              mov     edx, 4E212BBEh  ; icos36h_3
  3041 00001DDF F7EA                                    imul    edx
  3042 00001DE1 89D6                                    mov     esi, edx
  3043 00001DE3 89C8                                    mov     eax, ecx
  3044 00001DE5 D1E0                                    shl     eax, 1
  3045 00001DE7 BADFA1946F                              mov     edx, 6F94A1DFh  ; icos36h_5 (8-3)
  3046 00001DEC F7EA                                    imul    edx
  3047 00001DEE 8915[C0260500]                          mov     [_@@s3], edx
  3048 00001DF4 8B0D[B8260500]                          mov     ecx, [_@@s0]
  3049 00001DFA 29F1                                    sub     ecx, esi
  3050 00001DFC 8D3471                                  lea     esi, [ecx+esi*2]
  3051 00001DFF 8B4530                                  mov     eax, [ebp+48]
  3052 00001E02 F7E9                                    imul    ecx
  3053 00001E04 035330                                  add     edx, [ebx+48]
  3054 00001E07 899700060000                            mov     [edi+1536], edx
  3055 00001E0D 8B4514                                  mov     eax, [ebp+20]
  3056 00001E10 F7E9                                    imul    ecx
  3057 00001E12 035314                                  add     edx, [ebx+20]
  3058 00001E15 899780020000                            mov     [edi+640], edx
  3059 00001E1B 8B4578                                  mov     eax, [ebp+120]
  3060 00001E1E F7EE                                    imul    esi
  3061 00001E20 895330                                  mov     [ebx+30h], edx
  3062 00001E23 8B455C                                  mov     eax, [ebp+92]
  3063 00001E26 F7EE                                    imul    esi
  3064 00001E28 895314                                  mov     [ebx+20], edx
  3065 00001E2B 8B0D[BC260500]                          mov     ecx, [_@@s2]
  3066 00001E31 8B35[C0260500]                          mov     esi, [_@@s3]
  3067 00001E37 29F1                                    sub     ecx, esi
  3068 00001E39 8D3471                                  lea     esi, [ecx+esi*2]
  3069 00001E3C 8B450C                                  mov     eax, [ebp+12]
  3070 00001E3F F7E9                                    imul    ecx
  3071 00001E41 03530C                                  add     edx, [ebx+12]
  3072 00001E44 899780010000                            mov     [edi+384], edx
  3073 00001E4A 8B4538                                  mov     eax, [ebp+56]
  3074 00001E4D F7E9                                    imul    ecx
  3075 00001E4F 035338                                  add     edx, [ebx+56]
  3076 00001E52 899700070000                            mov     [edi+1792], edx
  3077 00001E58 8B4554                                  mov     eax, [ebp+84]
  3078 00001E5B F7EE                                    imul    esi
  3079 00001E5D 89530C                                  mov     [ebx+12], edx
  3080 00001E60 8B8580000000                            mov     eax, [ebp+128]
  3081 00001E66 F7EE                                    imul    esi
  3082 00001E68 895338                                  mov     [ebx+56], edx
  3083 00001E6B 8B0D[04270500]                          mov     ecx, [_@@@tmp+40h] ; IRP j,4
  3084                                                                          ; [@@tmp+(j*4+0)*4]
  3085 00001E71 A1[08270500]                            mov     eax, [_@@@tmp+44h] ; [@@tmp+(j*4+1)*4]
  3086 00001E76 D1E0                                    shl     eax, 1
  3087 00001E78 BA9A79825A                              mov     edx, 5A82799Ah  ; icos36h_4 (8-4)
  3088 00001E7D F7EA                                    imul    edx
  3089 00001E7F 29D1                                    sub     ecx, edx
  3090 00001E81 8D3451                                  lea     esi, [ecx+edx*2]
  3091 00001E84 8B4534                                  mov     eax, [ebp+52]   ; @@MULH [edi+(9+j)*SBLIMIT*4],[ebp+(9+j)*4],
  3092                                                                          ; -,-,-,-,0,ecx,[ebx+(9+j)*4]
  3093                                                                          ; out[(9+4)*SBLIMIT] = MULH(t0,win[9+4])+buf[9+4]
  3094 00001E87 F7E9                                    imul    ecx
  3095 00001E89 035334                                  add     edx, [ebx+52]
  3096 00001E8C 899780060000                            mov     [edi+1664], edx ; 13*SBLIMIT*4 = 1664
  3097 00001E92 8B4510                                  mov     eax, [ebp+16]   ; @MULH [edi+(8-j)*SBLIMIT*4],[ebp+(8-j)*4],
  3098                                                                          ; -,-,-,-,0,ecx,[ebx+(8-j)*4]
  3099 00001E95 F7E9                                    imul    ecx
  3100 00001E97 035310                                  add     edx, [ebx+16]
  3101 00001E9A 899700020000                            mov     [edi+512], edx
  3102 00001EA0 8B457C                                  mov     eax, [ebp+124]  ; @@MULH [ebx+(9+j)*4],[ebp+(9+j+18)*4] ,-,-,-,-,0,esi,-
  3103 00001EA3 F7EE                                    imul    esi
  3104 00001EA5 895334                                  mov     [ebx+52], edx
  3105 00001EA8 8B4558                                  mov     eax, [ebp+88]   ; @@MULH [ebx+(8-j)*4],[ebp+(8-j+18)*4],-,-,-,-,0,esi,-
  3106 00001EAB F7EE                                    imul    esi
  3107 00001EAD 895310                                  mov     [ebx+16], edx
  3108 00001EB0 5E                                      pop     esi
  3109 00001EB1 C3                                      retn
  3110                                  
  3111                                  
  3112                                  ; =============== S U B R O U T I N E =======================================
  3113                                  
  3114                                  
  3115                                  mp3_imdct12:
  3116 00001EB2 8B06                                    mov     eax, [esi]      ; in: esi=src - out: [out2_...]
  3117 00001EB4 A3[0C270500]                            mov     [_@@tmp0], eax  ; IRP nn,0,1,2,3,4,5
  3118                                                                          ;  @@tmp&nn rd 1
  3119                                                                          ; ENDM
  3120                                                                          ; mov  eax,[esi+0*3*4] ; = src[0*3]
  3121 00001EB9 8B560C                                  mov     edx, [esi+12]   ; [esi+1*3*4] ; = src[1*3]
  3122 00001EBC 01D0                                    add     eax, edx        ; = src[0*3]+src[1*3]
  3123 00001EBE A3[10270500]                            mov     [_@@tmp1], eax
  3124 00001EC3 8B4618                                  mov     eax, [esi+24]
  3125 00001EC6 01C2                                    add     edx, eax
  3126 00001EC8 8915[14270500]                          mov     [_@@tmp2], edx
  3127 00001ECE 8B5624                                  mov     edx, [esi+36]   ; [esi+3*3*4]
  3128 00001ED1 01D0                                    add     eax, edx
  3129 00001ED3 A3[18270500]                            mov     [_@@tmp3], eax
  3130 00001ED8 8B4630                                  mov     eax, [esi+48]
  3131 00001EDB 01C2                                    add     edx, eax
  3132 00001EDD 8915[1C270500]                          mov     [_@@tmp4], edx
  3133 00001EE3 8B563C                                  mov     edx, [esi+60]   ; [esi+5*3*4]
  3134 00001EE6 01D0                                    add     eax, edx        ; = src[4*3]+src[5*3]
  3135 00001EE8 0305[18270500]                          add     eax, [_@@tmp3]
  3136 00001EEE A3[20270500]                            mov     [_@@tmp5], eax  ; tmp5 = src[4*3]+src[5*3]+tmp3
  3137 00001EF3 8B15[10270500]                          mov     edx, [_@@tmp1]
  3138 00001EF9 0115[18270500]                          add     [_@@tmp3], edx
  3139 00001EFF A1[14270500]                            mov     eax, [_@@tmp2]  ; @@MULH @@tmp2,@@tmp2,-,-,-,-,1,C3,-
  3140                                                                          ; tmp2 = MULH(2*tmp2,C3)
  3141 00001F04 D1E0                                    shl     eax, 1
  3142 00001F06 BAA2EBD96E                              mov     edx, 6ED9EBA2h  ; C3
  3143 00001F0B F7EA                                    imul    edx
  3144 00001F0D 8915[14270500]                          mov     [_@@tmp2], edx
  3145 00001F13 A1[18270500]                            mov     eax, [_@@tmp3]  ; @@MULH @@tmp3,@@tmp3,-,-,-,-,2,C3,-
  3146                                                                          ; tmp3 = MULH(4*tmp3,C3)
  3147 00001F18 C1E002                                  shl     eax, 2
  3148 00001F1B BAA2EBD96E                              mov     edx, 6ED9EBA2h  ; C3
  3149 00001F20 F7EA                                    imul    edx
  3150 00001F22 8915[18270500]                          mov     [_@@tmp3], edx
  3151 00001F28 A1[10270500]                            mov     eax, [_@@tmp1]  ; @@MULH edx,@@tmp1,sub,@@tmp5,-,-,1,icos36h_4,-
  3152 00001F2D 2B05[20270500]                          sub     eax, [_@@tmp5]  ; t2 = MULH(2*(tmp1-tmp5),icos36h_4)
  3153 00001F33 D1E0                                    shl     eax, 1
  3154 00001F35 BA9A79825A                              mov     edx, 5A82799Ah  ; icos36h_4
  3155 00001F3A F7EA                                    imul    edx
  3156 00001F3C A1[0C270500]                            mov     eax, [_@@tmp0]  ; @@SUM eax,@@tmp0,sub,@@tmp4,-,-
  3157 00001F41 2B05[1C270500]                          sub     eax, [_@@tmp4]  ; t1 = tmp0 - tmp4
  3158 00001F47 29D0                                    sub     eax, edx        ; @@CAST macro t1,t2,dst0,dst1,dst2,dst3
  3159                                                                          ;   sub  t1,t2                           ;t1-t2
  3160                                                                          ;   lea  t2,[t1+t2*2]                    ;t1+t2
  3161                                                                          ;   mov  dword ptr [mp3_out2_a&dst0],t1  ;t1-t2
  3162                                                                          ;   mov  dword ptr [mp3_out2_b&dst0],t2  ;t1+t2
  3163                                                                          ; endm
  3164 00001F49 8D1450                                  lea     edx, [eax+edx*2] ; @@CAST eax,edx,1,4,7,10
  3165                                                                          ; out2[1,4,7,10]=t1-t2,t1-t2,t1+t2,t1+t2
  3166 00001F4C A3[28270500]                            mov     [mp3_out2_a1], eax
  3167 00001F51 8915[34270500]                          mov     [mp3_out2_b1], edx
  3168 00001F57 A1[1C270500]                            mov     eax, [_@@tmp4]
  3169 00001F5C 8B15[10270500]                          mov     edx, [_@@tmp1]
  3170 00001F62 D1F8                                    sar     eax, 1
  3171 00001F64 D1E2                                    shl     edx, 1
  3172 00001F66 0105[0C270500]                          add     [_@@tmp0], eax  ; tmp0 = tmp0 + tmp4/2
  3173 00001F6C 0115[20270500]                          add     [_@@tmp5], edx  ; tmp5 = tmp5 + tmp1*2
  3174 00001F72 A1[20270500]                            mov     eax, [_@@tmp5]  ; @@MULH edx,@@tmp5,add,@@tmp3,-,-,0,icos36h_1,-
  3175 00001F77 0305[18270500]                          add     eax, [_@@tmp3]
  3176 00001F7D BA07F74142                              mov     edx, 4241F707h  ; icos36h_1
  3177 00001F82 F7EA                                    imul    edx
  3178 00001F84 A1[0C270500]                            mov     eax, [_@@tmp0]  ; @@SUM eax,@@tmp0,add,@@tmp2,-,-
  3179 00001F89 0305[14270500]                          add     eax, [_@@tmp2]
  3180 00001F8F 29D0                                    sub     eax, edx        ; @@CAST eax,edx,2,3,8,9
  3181 00001F91 8D1450                                  lea     edx, [eax+edx*2]
  3182 00001F94 A3[2C270500]                            mov     [mp3_out2_a2], eax
  3183 00001F99 8915[38270500]                          mov     [mp3_out2_b2], edx
  3184 00001F9F A1[20270500]                            mov     eax, [_@@tmp5]  ; @@MULH edx,@@tmp5,sub,@@tmp3,-,-,1,icos36h_7,-
  3185 00001FA4 2B05[18270500]                          sub     eax, [_@@tmp3]
  3186 00001FAA D1E0                                    shl     eax, 1
  3187 00001FAC BA1E75A37B                              mov     edx, 7BA3751Eh  ; icos36h_7
  3188 00001FB1 F7EA                                    imul    edx
  3189 00001FB3 A1[0C270500]                            mov     eax, [_@@tmp0]  ; @@SUM eax,@@tmp0,sub,@@tmp2,-,-
  3190 00001FB8 2B05[14270500]                          sub     eax, [_@@tmp2]
  3191 00001FBE 29D0                                    sub     eax, edx        ; @@CAST eax,edx,0,5,6,11
  3192 00001FC0 8D1450                                  lea     edx, [eax+edx*2]
  3193 00001FC3 A3[24270500]                            mov     [mp3_out2_a0], eax
  3194 00001FC8 8915[30270500]                          mov     [mp3_out2_b0], edx
  3195 00001FCE C3                                      retn
  3196                                  
  3197                                  
  3198                                  ; =============== S U B R O U T I N E =======================================
  3199                                  
  3200                                  
  3201                                  mp3_compute_imdct:
  3202 00001FCF F605[DC730000]10                        test    byte [cpuid_flags], 10h ; in: ebx=granule
  3203 00001FD6 740E                                    jz      short .no_rdtsc_supported ; timelog_start rdtsc_imdct
  3204 00001FD8 0F31                                    rdtsc
  3205 00001FDA 2905[F4740000]                          sub     [rdtsc_imdct], eax
  3206 00001FE0 1915[F8740000]                          sbb     [rdtsc_imdct+4], edx
  3207                                  
  3208                                  .no_rdtsc_supported:
  3209 00001FE6 53                                      push    ebx
  3210 00001FE7 8B4B60                                  mov     ecx, [ebx+96]   ; [ebx+$mp3gr_num_nonzero_hybrids_div9]
  3211 00001FEA 6BC109                                  imul    eax, ecx, 9
  3212 00001FED 8DBC83A0000000                          lea     edi, [ebx+eax*4+160] ; [ebx+$mp3gr_sb_hybrid+eax*4]
  3213 00001FF4 E322                                    jecxz   .breakout
  3214                                  
  3215                                  .scan_zero_lop:
  3216 00001FF6 83EF24                                  sub     edi, 36         ; index-9
  3217 00001FF9 8B07                                    mov     eax, [edi]      ; [edi+0*4]
  3218 00001FFB 0B4704                                  or      eax, [edi+4]
  3219 00001FFE 0B4708                                  or      eax, [edi+8]
  3220 00002001 0B470C                                  or      eax, [edi+12]
  3221 00002004 0B4710                                  or      eax, [edi+16]
  3222 00002007 0B4714                                  or      eax, [edi+20]
  3223 0000200A 0B4718                                  or      eax, [edi+24]
  3224 0000200D 0B471C                                  or      eax, [edi+28]
  3225 00002010 0B4720                                  or      eax, [edi+32]   ; [edi+8*4]
  3226 00002013 7503                                    jnz     short .breakout
  3227 00002015 49                                      dec     ecx
  3228 00002016 75DE                                    jnz     short .scan_zero_lop
  3229                                  
  3230                                  .breakout:
  3231 00002018 41                                      inc     ecx             ; div9+1
  3232 00002019 D1E9                                    shr     ecx, 1          ; div18
  3233 0000201B 890D[50270500]                          mov     [_@@sblimit], ecx
  3234 00002021 837B2C02                                cmp     dword [ebx+44], 2 ; [ebx+$mp3gr_block_type]
  3235 00002025 7505                                    jnz     short .this_long_end
  3236 00002027 8B4B30                                  mov     ecx, [ebx+48]   ; [ebx+$mp3gr_switch_point]
  3237 0000202A D1E1                                    shl     ecx, 1          ; 0,1 --> 0,2
  3238                                  
  3239                                  .this_long_end:
  3240 0000202C 890D[4C270500]                          mov     [_@@mdct_long_end], ecx
  3241 00002032 8B4330                                  mov     eax, [ebx+48]   ; [ebx+$mp3gr_switch_point]
  3242 00002035 A3[54270500]                            mov     [_@@switch_point], eax
  3243 0000203A 8B432C                                  mov     eax, [ebx+44]   ; [ebx+$mp3gr_block_type]
  3244 0000203D 69C090000000                            imul    eax, 144        ; 1*36*4
  3245 00002043 A3[48270500]                            mov     [_@@www], eax
  3246 00002048 8B0D[1CF20000]                          mov     ecx, [mp3_curr_channel]
  3247 0000204E A1[20F20000]                            mov     eax, [mp3_curr_granule]
  3248 00002053 69C900120000                            imul    ecx, 4608       ; 36*SBLIMIT*4 ; channel ; sb_samples[ch][gr*18]
  3249 00002059 69C000090000                            imul    eax, 2304       ; 18*SBLIMIT*4 ; frame=granule*18
  3250 0000205F 8DBC01[7CBB0000]                        lea     edi, [mp3_sb_samples+ecx+eax]
  3251 00002066 8DB3A0000000                            lea     esi, [ebx+160]  ; [ebx+$mp3gr_sb_hybrid]
  3252 0000206C A1[1CF20000]                            mov     eax, [mp3_curr_channel]
  3253 00002071 69C000090000                            imul    eax, 2304       ; SBLIMIT*18*4
  3254 00002077 8D98[7CDF0000]                          lea     ebx, [mp3_mdct_buf+eax]
  3255 0000207D F605[DC730000]10                        test    byte [cpuid_flags], 10h
  3256 00002084 740E                                    jz      short .no_rdtsc_supported@ ; timelog_start rdtsc_imdct36
  3257 00002086 0F31                                    rdtsc
  3258 00002088 2905[0C750000]                          sub     [rdtsc_imdct36], eax
  3259 0000208E 1915[10750000]                          sbb     [rdtsc_imdct36+4], edx
  3260                                  
  3261                                  .no_rdtsc_supported@:
  3262 00002094 C705[44270500]0000-                     mov	dword [_@@@JJJ], 0
  3262 0000209C 0000               
  3263 0000209E 833D[4C270500]00                        cmp	dword [_@@mdct_long_end], 0
  3264 000020A5 744D                                    jz      short .imdct36_done
  3265                                  
  3266                                  .imdct36_lop:
  3267 000020A7 BD[ACE00400]                            mov	ebp, mp3_mdct_win ; for j=0 to mdct_long_end-1
  3268 000020AC 833D[44270500]02                        cmp	dword [_@@@JJJ], 2
  3269 000020B3 19C0                                    sbb	eax, eax
  3270 000020B5 2305[54270500]                          and	eax, [_@@switch_point]
  3271 000020BB 7506                                    jnz	short .this_window ; force window 0
  3272 000020BD 032D[48270500]                          add	ebp, [_@@www] ; mdct_win
  3273                                  
  3274                                  .this_window:
  3275 000020C3 A1[44270500]                            mov	eax, [_@@@JJJ]
  3276 000020C8 D1E8                                    shr	eax, 1          ; cy=0,1
  3277 000020CA 19C0                                    sbb	eax, eax        ; eax=0,FFFFFFFFh
  3278 000020CC 2540020000                              and	eax, 576        ; 4*36*4
  3279 000020D1 01C5                                    add	ebp, eax
  3280 000020D3 E808F8FFFF                              call	mp3_imdct36
  3281 000020D8 83C704                                  add	edi, 4          ; 1*4 ; dst
  3282 000020DB 83C648                                  add	esi, 72         ; 18*4 ; sb_hybrid
  3283 000020DE 83C348                                  add	ebx, 72         ; mdct_buf ; next
  3284 000020E1 FF05[44270500]                          inc	dword [_@@@JJJ]
  3285 000020E7 A1[44270500]                            mov	eax, [_@@@JJJ]
  3286 000020EC 3B05[4C270500]                          cmp	eax, [_@@mdct_long_end]
  3287 000020F2 72B3                                    jb	short .imdct36_lop
  3288                                  
  3289                                  .imdct36_done:
  3290 000020F4 F605[DC730000]10                        test    byte [cpuid_flags], 10h
  3291 000020FB 740E                                    jz      short .no_rdtsc_supported@@ ; timelog_end rdtsc_imdct36
  3292 000020FD 0F31                                    rdtsc
  3293 000020FF 0105[0C750000]                          add     [rdtsc_imdct36], eax
  3294 00002105 1115[10750000]                          adc     [rdtsc_imdct36+4], edx
  3295                                  
  3296                                  .no_rdtsc_supported@@:
  3297 0000210B F605[DC730000]10                        test    byte [cpuid_flags], 10h ; timelog_start rdtsc_imdct12
  3298 00002112 740E                                    jz      short .no_rdtsc_supported@@@
  3299 00002114 0F31                                    rdtsc
  3300 00002116 2905[24750000]                          sub     [rdtsc_imdct12], eax
  3301 0000211C 1915[28750000]                          sbb     [rdtsc_imdct12+4], edx
  3302                                  
  3303                                  .no_rdtsc_supported@@@:
  3304 00002122 A1[44270500]                            mov     eax, [_@@@JJJ]
  3305 00002127 3B05[50270500]                          cmp     eax, [_@@sblimit]
  3306 0000212D 0F83D7020000                            jnb     .imdct12_done
  3307                                  
  3308                                  .imdct12_lop:
  3309 00002133 BD[CCE10400]                            mov     ebp, (mp3_mdct_win+120h) ; for j=mdct_long_end to sblimit-1
  3310 00002138 A1[44270500]                            mov     eax, [_@@@JJJ]
  3311 0000213D D1E8                                    shr     eax, 1          ; cy=0,1
  3312 0000213F 19C0                                    sbb     eax, eax        ; eax=0,FFFFFFFFh
  3313 00002141 2540020000                              and     eax, 576        ; 4*36*4
  3314 00002146 01C5                                    add     ebp, eax        ; mdct_win
  3315 00002148 8B03                                    mov     eax, [ebx]      ; IRP i,0,1,2,3,4,5
  3316 0000214A 8907                                    mov     [edi], eax      ; @@SUM [edi+i*SBLIMIT*4],[ebx+(i+0)*4],-,-,-,-
  3317 0000214C 8B4304                                  mov     eax, [ebx+4]
  3318 0000214F 898780000000                            mov     [edi+128], eax
  3319 00002155 8B4308                                  mov     eax, [ebx+8]
  3320 00002158 898700010000                            mov     [edi+256], eax
  3321 0000215E 8B430C                                  mov     eax, [ebx+12]
  3322 00002161 898780010000                            mov     [edi+384], eax
  3323 00002167 8B4310                                  mov     eax, [ebx+16]
  3324 0000216A 898700020000                            mov     [edi+512], eax
  3325 00002170 8B4314                                  mov     eax, [ebx+20]
  3326 00002173 898780020000                            mov     [edi+640], eax  ; ENDM
  3327 00002179 81C700030000                            add     edi, 768        ; 6*SBLIMIT*4
  3328 0000217F E82EFDFFFF                              call    mp3_imdct12
  3329 00002184 A1[24270500]                            mov     eax, [mp3_out2_a0] ; IRP i,0,1,2,3,4,5
  3330 00002189 8B5500                                  mov     edx, [ebp+0]    ; @@MULH [edi+i*SBLIMIT*4],[mp3_out2_a&i],
  3331                                                                          ; -,-,-,-,0,[ebp+(i+0)*4],[ebx+(1*6+i)*4]
  3332 0000218C F7EA                                    imul    edx
  3333 0000218E 035318                                  add     edx, [ebx+24]
  3334 00002191 8917                                    mov     [edi], edx
  3335 00002193 A1[30270500]                            mov     eax, [mp3_out2_b0] ; @@MULH [ebx+(2*6+i)*4],[mp3_out2_b&i],
  3336                                                                          ; -,-,-,-,0,[ebp+(i+6)*4],-
  3337 00002198 8B5518                                  mov     edx, [ebp+24]
  3338 0000219B F7EA                                    imul    edx
  3339 0000219D 895330                                  mov     [ebx+48], edx
  3340 000021A0 A1[28270500]                            mov     eax, [mp3_out2_a1] ; i = 1
  3341 000021A5 8B5504                                  mov     edx, [ebp+4]
  3342 000021A8 F7EA                                    imul    edx
  3343 000021AA 03531C                                  add     edx, [ebx+28]
  3344 000021AD 899780000000                            mov     [edi+128], edx
  3345 000021B3 A1[34270500]                            mov     eax, [mp3_out2_b1]
  3346 000021B8 8B551C                                  mov     edx, [ebp+28]
  3347 000021BB F7EA                                    imul    edx
  3348 000021BD 895334                                  mov     [ebx+52], edx
  3349 000021C0 A1[2C270500]                            mov     eax, [mp3_out2_a2] ; i = 2
  3350 000021C5 8B5508                                  mov     edx, [ebp+8]
  3351 000021C8 F7EA                                    imul    edx
  3352 000021CA 035320                                  add     edx, [ebx+32]
  3353 000021CD 899700010000                            mov     [edi+256], edx
  3354 000021D3 A1[38270500]                            mov     eax, [mp3_out2_b2]
  3355 000021D8 8B5520                                  mov     edx, [ebp+32]
  3356 000021DB F7EA                                    imul    edx
  3357 000021DD 895338                                  mov     [ebx+56], edx
  3358 000021E0 A1[2C270500]                            mov     eax, [mp3_out2_a2] ; i = 3 ; mp3_out2_a3 equ mp3_out2_a2
  3359 000021E5 8B550C                                  mov     edx, [ebp+12]
  3360 000021E8 F7EA                                    imul    edx
  3361 000021EA 035324                                  add     edx, [ebx+36]
  3362 000021ED 899780010000                            mov     [edi+384], edx
  3363 000021F3 A1[38270500]                            mov     eax, [mp3_out2_b2] ; mp3_out2_b3 equ mp3_out2_b2
  3364 000021F8 8B5524                                  mov     edx, [ebp+36]
  3365 000021FB F7EA                                    imul    edx
  3366 000021FD 89533C                                  mov     [ebx+60], edx
  3367 00002200 A1[28270500]                            mov     eax, [mp3_out2_a1] ; i = 4 ; mp3_out2_a4 equ mp3_out2_a1
  3368 00002205 8B5510                                  mov     edx, [ebp+16]
  3369 00002208 F7EA                                    imul    edx
  3370 0000220A 035328                                  add     edx, [ebx+40]
  3371 0000220D 899700020000                            mov     [edi+512], edx
  3372 00002213 A1[34270500]                            mov     eax, [mp3_out2_b1] ; mp3_out2_b4 equ mp3_out2_b1
  3373 00002218 8B5528                                  mov     edx, [ebp+40]
  3374 0000221B F7EA                                    imul    edx
  3375 0000221D 895340                                  mov     [ebx+64], edx
  3376 00002220 A1[24270500]                            mov     eax, [mp3_out2_a0] ; i = 5 ; mp3_out2_a5 equ mp3_out2_a0
  3377 00002225 8B5514                                  mov     edx, [ebp+20]
  3378 00002228 F7EA                                    imul    edx
  3379 0000222A 03532C                                  add     edx, [ebx+44]
  3380 0000222D 899780020000                            mov     [edi+640], edx
  3381 00002233 A1[30270500]                            mov     eax, [mp3_out2_b0] ; mp3_out2_b5 equ mp3_out2_b0
  3382 00002238 8B552C                                  mov     edx, [ebp+44]
  3383 0000223B F7EA                                    imul    edx
  3384 0000223D 895344                                  mov     [ebx+68], edx   ; ENDM
  3385 00002240 81C700030000                            add     edi, 768        ; 6*SBLIMIT*4
  3386 00002246 83C604                                  add     esi, 4          ; sb_hybrid
  3387 00002249 E864FCFFFF                              call    mp3_imdct12
  3388 0000224E A1[24270500]                            mov     eax, [mp3_out2_a0] ; IRP i,0,1,2,3,4,5
  3389 00002253 8B5500                                  mov     edx, [ebp+0]    ; @@MULH [edi+i*SBLIMIT*4],[mp3_out2_a&i],
  3390                                                                          ; -,-,-,-,0,[ebp+(i+0)*4],[ebx+(2*6+i)*4]
  3391 00002256 F7EA                                    imul    edx             ; @@MULH [ebx+(0*6+i)*4],[mp3_out2_b&i],
  3392                                                                          ; -,-,-,-,0,[ebp+(i+6)*4],-
  3393 00002258 035330                                  add     edx, [ebx+48]
  3394 0000225B 8917                                    mov     [edi], edx
  3395 0000225D A1[30270500]                            mov     eax, [mp3_out2_b0]
  3396 00002262 8B5518                                  mov     edx, [ebp+18h]
  3397 00002265 F7EA                                    imul    edx
  3398 00002267 8913                                    mov     [ebx], edx
  3399 00002269 A1[28270500]                            mov     eax, [mp3_out2_a1] ; i = 1
  3400 0000226E 8B5504                                  mov     edx, [ebp+4]
  3401 00002271 F7EA                                    imul    edx
  3402 00002273 035334                                  add     edx, [ebx+52]
  3403 00002276 899780000000                            mov     [edi+128], edx
  3404 0000227C A1[34270500]                            mov     eax, [mp3_out2_b1]
  3405 00002281 8B551C                                  mov     edx, [ebp+28]
  3406 00002284 F7EA                                    imul    edx
  3407 00002286 895304                                  mov     [ebx+4], edx
  3408 00002289 A1[2C270500]                            mov     eax, [mp3_out2_a2] ; i = 2
  3409 0000228E 8B5508                                  mov     edx, [ebp+8]
  3410 00002291 F7EA                                    imul    edx
  3411 00002293 035338                                  add     edx, [ebx+56]
  3412 00002296 899700010000                            mov     [edi+256], edx
  3413 0000229C A1[38270500]                            mov     eax, [mp3_out2_b2]
  3414 000022A1 8B5520                                  mov     edx, [ebp+32]
  3415 000022A4 F7EA                                    imul    edx
  3416 000022A6 895308                                  mov     [ebx+8], edx
  3417 000022A9 A1[2C270500]                            mov     eax, [mp3_out2_a2] ; i = 3
  3418 000022AE 8B550C                                  mov     edx, [ebp+12]
  3419 000022B1 F7EA                                    imul    edx
  3420 000022B3 03533C                                  add     edx, [ebx+60]
  3421 000022B6 899780010000                            mov     [edi+384], edx
  3422 000022BC A1[38270500]                            mov     eax, [mp3_out2_b2]
  3423 000022C1 8B5524                                  mov     edx, [ebp+36]
  3424 000022C4 F7EA                                    imul    edx
  3425 000022C6 89530C                                  mov     [ebx+12], edx
  3426 000022C9 A1[28270500]                            mov     eax, [mp3_out2_a1] ; i = 4
  3427 000022CE 8B5510                                  mov     edx, [ebp+16]
  3428 000022D1 F7EA                                    imul    edx
  3429 000022D3 035340                                  add     edx, [ebx+64]
  3430 000022D6 899700020000                            mov     [edi+512], edx
  3431 000022DC A1[34270500]                            mov     eax, [mp3_out2_b1]
  3432 000022E1 8B5528                                  mov     edx, [ebp+40]
  3433 000022E4 F7EA                                    imul    edx
  3434 000022E6 895310                                  mov     [ebx+16], edx
  3435 000022E9 A1[24270500]                            mov     eax, [mp3_out2_a0] ; i = 5
  3436 000022EE 8B5514                                  mov     edx, [ebp+20]
  3437 000022F1 F7EA                                    imul    edx
  3438 000022F3 035344                                  add     edx, [ebx+68]
  3439 000022F6 899780020000                            mov     [edi+640], edx
  3440 000022FC A1[30270500]                            mov     eax, [mp3_out2_b0]
  3441 00002301 8B552C                                  mov     edx, [ebp+44]
  3442 00002304 F7EA                                    imul    edx
  3443 00002306 895314                                  mov     [ebx+20], edx   ; ENDM
  3444 00002309 83C604                                  add     esi, 4
  3445 0000230C E8A1FBFFFF                              call    mp3_imdct12
  3446 00002311 A1[24270500]                            mov     eax, [mp3_out2_a0] ; IRP i,0,1,2,3,4,5
  3447 00002316 8B5500                                  mov     edx, [ebp+0]    ; @@MULH [ebx+(0*6+i)*4],[mp3_out2_a&i],
  3448                                                                          ; -,-,-,-,0,[ebp+(i+0)*4],[ebx+(0*6+i)*4]
  3449 00002319 F7EA                                    imul    edx
  3450 0000231B 0313                                    add     edx, [ebx]
  3451 0000231D 8913                                    mov     [ebx], edx
  3452 0000231F A1[30270500]                            mov     eax, [mp3_out2_b0] ; @@MULH [ebx+(1*6+i)*4],[mp3_out2_b&i],
  3453                                                                          ; -,-,-,-,0,[ebp+(i+6)*4],-
  3454 00002324 8B5518                                  mov     edx, [ebp+24]
  3455 00002327 F7EA                                    imul    edx
  3456 00002329 895318                                  mov     [ebx+24], edx
  3457 0000232C C7433000000000                          mov     dword [ebx+48], 0 ; [ebx+(2*6+i)*4]
  3458 00002333 A1[28270500]                            mov     eax, [mp3_out2_a1] ; i = 1
  3459 00002338 8B5504                                  mov     edx, [ebp+4]
  3460 0000233B F7EA                                    imul    edx
  3461 0000233D 035304                                  add     edx, [ebx+4]
  3462 00002340 895304                                  mov     [ebx+4], edx
  3463 00002343 A1[34270500]                            mov     eax, [mp3_out2_b1]
  3464 00002348 8B551C                                  mov     edx, [ebp+28]
  3465 0000234B F7EA                                    imul    edx
  3466 0000234D 89531C                                  mov     [ebx+28], edx
  3467 00002350 C7433400000000                          mov     dword [ebx+52], 0 ; [ebx+(2*6+i)*4]
  3468 00002357 A1[2C270500]                            mov     eax, [mp3_out2_a2] ; i = 2
  3469 0000235C 8B5508                                  mov     edx, [ebp+8]
  3470 0000235F F7EA                                    imul    edx
  3471 00002361 035308                                  add     edx, [ebx+8]
  3472 00002364 895308                                  mov     [ebx+8], edx
  3473 00002367 A1[38270500]                            mov     eax, [mp3_out2_b2]
  3474 0000236C 8B5520                                  mov     edx, [ebp+32]
  3475 0000236F F7EA                                    imul    edx
  3476 00002371 895320                                  mov     [ebx+32], edx
  3477 00002374 C7433800000000                          mov     dword [ebx+56], 0
  3478 0000237B A1[2C270500]                            mov     eax, [mp3_out2_a2] ; i = 3
  3479 00002380 8B550C                                  mov     edx, [ebp+12]
  3480 00002383 F7EA                                    imul    edx
  3481 00002385 03530C                                  add     edx, [ebx+0Ch]
  3482 00002388 89530C                                  mov     [ebx+12], edx
  3483 0000238B A1[38270500]                            mov     eax, [mp3_out2_b2]
  3484 00002390 8B5524                                  mov     edx, [ebp+36]
  3485 00002393 F7EA                                    imul    edx
  3486 00002395 895324                                  mov     [ebx+36], edx
  3487 00002398 C7433C00000000                          mov     dword [ebx+60], 0 ; [ebx+(2*6+i)*4]
  3488 0000239F A1[28270500]                            mov     eax, [mp3_out2_a1] ; i = 4
  3489 000023A4 8B5510                                  mov     edx, [ebp+16]
  3490 000023A7 F7EA                                    imul    edx
  3491 000023A9 035310                                  add     edx, [ebx+16]
  3492 000023AC 895310                                  mov     [ebx+16], edx
  3493 000023AF A1[34270500]                            mov     eax, [mp3_out2_b1]
  3494 000023B4 8B5528                                  mov     edx, [ebp+40]
  3495 000023B7 F7EA                                    imul    edx
  3496 000023B9 895328                                  mov     [ebx+40], edx
  3497 000023BC C7434000000000                          mov     dword [ebx+64], 0
  3498 000023C3 A1[24270500]                            mov     eax, [mp3_out2_a0] ; i = 5
  3499 000023C8 8B5514                                  mov     edx, [ebp+20]
  3500 000023CB F7EA                                    imul    edx
  3501 000023CD 035314                                  add     edx, [ebx+20]
  3502 000023D0 895314                                  mov     [ebx+20], edx
  3503 000023D3 A1[30270500]                            mov     eax, [mp3_out2_b0]
  3504 000023D8 8B552C                                  mov     edx, [ebp+44]
  3505 000023DB F7EA                                    imul    edx
  3506 000023DD 89532C                                  mov     [ebx+44], edx
  3507 000023E0 C7434400000000                          mov     dword [ebx+68], 0 ; [ebx+(2*6+i)*4]
  3508 000023E7 81C704FAFFFF                            add     edi, -1532      ; (1*4) - (2*6*SBLIMIT*4) ; dst
  3509 000023ED 83C640                                  add     esi, 64         ; 18*4 - (2*4) ; sb_hybrid
  3510 000023F0 83C348                                  add     ebx, 72         ; 18*4 ; mdct_buf
  3511 000023F3 FF05[44270500]                          inc     dword [_@@@JJJ]	; next
  3512 000023F9 A1[44270500]                            mov     eax, [_@@@JJJ]
  3513 000023FE 3B05[50270500]                          cmp     eax, [_@@sblimit]
  3514 00002404 0F8229FDFFFF                            jb      .imdct12_lop
  3515                                  
  3516                                  .imdct12_done:
  3517 0000240A F605[DC730000]10                        test    byte [cpuid_flags], 10h
  3518 00002411 740E                                    jz      short .no_rdtsc_supported@@@@ ; timelog_end rdtsc_imdct12
  3519 00002413 0F31                                    rdtsc
  3520 00002415 0105[24750000]                          add     [rdtsc_imdct12], eax
  3521 0000241B 1115[28750000]                          adc     [rdtsc_imdct12+4], edx
  3522                                  
  3523                                  .no_rdtsc_supported@@@@:
  3524 00002421 F605[DC730000]10                        test    byte [cpuid_flags], 10h ; timelog_start rdtsc_imdct0
  3525 00002428 740E                                    jz      short .no_rdtsc_supported@@@@@
  3526 0000242A 0F31                                    rdtsc
  3527 0000242C 2905[3C750000]                          sub     [rdtsc_imdct0], eax
  3528 00002432 1915[40750000]                          sbb     [rdtsc_imdct0+4], edx
  3529                                  
  3530                                  .no_rdtsc_supported@@@@@:
  3531 00002438 833D[44270500]20                        cmp     dword [_@@@JJJ], 32 ; SBLIMIT
  3532 0000243F 0F8333010000                            jnb     .zero_outer_done
  3533                                  
  3534                                  .zero_outer_lop:
  3535 00002445 8B03                                    mov     eax, [ebx]      ; zero bands
  3536                                                                          ; IRP nn,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17
  3537                                                                          ;  mov  eax,dword ptr [ebx+nn*4]
  3538                                                                          ;  mov  dword ptr [ebx+nn*4],0
  3539                                                                          ;  mov  dword ptr [edi+nn*SBLIMIT*4],eax ; [dst]
  3540                                                                          ; ENDM
  3541 00002447 C70300000000                            mov     dword [ebx], 0 ; nn = 0
  3542 0000244D 8907                                    mov     [edi], eax
  3543 0000244F 8B4304                                  mov     eax, [ebx+4]    ; nn = 1
  3544 00002452 C7430400000000                          mov     dword [ebx+4], 0
  3545 00002459 898780000000                            mov     [edi+128], eax
  3546 0000245F 8B4308                                  mov     eax, [ebx+8]
  3547 00002462 C7430800000000                          mov     dword [ebx+8], 0
  3548 00002469 898700010000                            mov     [edi+256], eax
  3549 0000246F 8B430C                                  mov     eax, [ebx+12]
  3550 00002472 C7430C00000000                          mov     dword [ebx+12], 0
  3551 00002479 898780010000                            mov     [edi+384], eax
  3552 0000247F 8B4310                                  mov     eax, [ebx+16]   ; nn = 4
  3553 00002482 C7431000000000                          mov     dword [ebx+16], 0
  3554 00002489 898700020000                            mov     [edi+512], eax
  3555 0000248F 8B4314                                  mov     eax, [ebx+20]
  3556 00002492 C7431400000000                          mov     dword [ebx+20], 0
  3557 00002499 898780020000                            mov     [edi+640], eax  ; [edi+5*SBLIMIT*4]
  3558 0000249F 8B4318                                  mov     eax, [ebx+24]
  3559 000024A2 C7431800000000                          mov     dword [ebx+24], 0
  3560 000024A9 898700030000                            mov     [edi+768], eax
  3561 000024AF 8B431C                                  mov     eax, [ebx+28]   ; nn = 7
  3562 000024B2 C7431C00000000                          mov     dword [ebx+28], 0
  3563 000024B9 898780030000                            mov     [edi+896], eax
  3564 000024BF 8B4320                                  mov     eax, [ebx+32]
  3565 000024C2 C7432000000000                          mov     dword [ebx+32], 0
  3566 000024C9 898700040000                            mov     [edi+1024], eax ; [edi+8*SBLIMIT*4]
  3567 000024CF 8B4324                                  mov     eax, [ebx+36]
  3568 000024D2 C7432400000000                          mov     dword [ebx+36], 0
  3569 000024D9 898780040000                            mov     [edi+1152], eax
  3570 000024DF 8B4328                                  mov     eax, [ebx+40]
  3571 000024E2 C7432800000000                          mov     dword [ebx+40], 0
  3572 000024E9 898700050000                            mov     [edi+1280], eax
  3573 000024EF 8B432C                                  mov     eax, [ebx+44]
  3574 000024F2 C7432C00000000                          mov     dword [ebx+44], 0
  3575 000024F9 898780050000                            mov     [edi+1408], eax
  3576 000024FF 8B4330                                  mov     eax, [ebx+48]
  3577 00002502 C7433000000000                          mov     dword [ebx+48], 0
  3578 00002509 898700060000                            mov     [edi+1536], eax
  3579 0000250F 8B4334                                  mov     eax, [ebx+52]
  3580 00002512 C7433400000000                          mov     dword [ebx+52], 0
  3581 00002519 898780060000                            mov     [edi+1664], eax
  3582 0000251F 8B4338                                  mov     eax, [ebx+56]
  3583 00002522 C7433800000000                          mov     dword [ebx+56], 0
  3584 00002529 898700070000                            mov     [edi+1792], eax
  3585 0000252F 8B433C                                  mov     eax, [ebx+60]
  3586 00002532 C7433C00000000                          mov     dword [ebx+60], 0
  3587 00002539 898780070000                            mov     [edi+1920], eax
  3588 0000253F 8B4340                                  mov     eax, [ebx+64]
  3589 00002542 C7434000000000                          mov     dword [ebx+64], 0 ; [edi+16*SBLIMIT*4]
  3590 00002549 898700080000                            mov     [edi+2048], eax
  3591 0000254F 8B4344                                  mov     eax, [ebx+68]   ; nn = 17
  3592 00002552 C7434400000000                          mov     dword [ebx+68], 0
  3593 00002559 898780080000                            mov     [edi+2176], eax ; ENDM
  3594 0000255F 83C348                                  add     ebx, 72         ; 18*4
  3595 00002562 83C704                                  add     edi, 4
  3596 00002565 FF05[44270500]                          inc     dword [_@@@JJJ]
  3597 0000256B 833D[44270500]20                        cmp     dword [_@@@JJJ], 32
  3598 00002572 0F82CDFEFFFF                            jb      .zero_outer_lop
  3599                                  
  3600                                  .zero_outer_done:
  3601 00002578 F605[DC730000]10                        test    byte [cpuid_flags], 10h ; timelog_end rdtsc_imdct0
  3602 0000257F 740E                                    jz      short .no_rdtsc_supported@@@@@@
  3603 00002581 0F31                                    rdtsc
  3604 00002583 0105[3C750000]                          add     [rdtsc_imdct0], eax
  3605 00002589 1115[40750000]                          adc     [rdtsc_imdct0+4], edx
  3606                                  
  3607                                  .no_rdtsc_supported@@@@@@:
  3608 0000258F 5B                                      pop     ebx
  3609 00002590 F605[DC730000]10                        test    byte [cpuid_flags], 10h ; timelog_end rdtsc_imdct
  3610 00002597 740E                                    jz      short .no_rdtsc_supported@@@@@@@
  3611 00002599 0F31                                    rdtsc
  3612 0000259B 0105[F4740000]                          add     [rdtsc_imdct], eax
  3613 000025A1 1115[F8740000]                          adc     [rdtsc_imdct+4], edx
  3614                                  
  3615                                  .no_rdtsc_supported@@@@@@@:
  3616 000025A7 C3                                      retn
  3617                                  
  3618                                  
  3619                                  ; =============== S U B R O U T I N E =======================================
  3620                                  
  3621                                  
  3622                                  mp3_dct32_shift_0:
  3623 000025A8 8B06                                    mov     eax, [esi]      ; mp3_dct32_macro macro rate_shift ; rate_shift = 0
  3624 000025AA 8B567C                                  mov     edx, [esi+124]  ; @@BF macro a,b,sign,cos,shift
  3625                                                                          ; @@BF 0,31,+,COS0_0,1
  3626                                                                          ; @@need_a equ (rate_shift EQ 0) or (a LT 16) ; a = 0
  3627                                                                          ; @@need_b equ (rate_shift EQ 0) or (b LT 16) ; b = 31
  3628                                                                          ; IF @@need_a AND @@need_b ; rate_shift = 0
  3629                                                                          ;    mov eax,dword ptr [esi+a*4]
  3630                                                                          ;    mov edx,dword ptr [esi+b*4]
  3631                                                                          ;    add dword ptr [esi+a*4],edx
  3632 000025AD 0116                                    add     [esi], edx
  3633 000025AF 29D0                                    sub     eax, edx
  3634 000025B1 D1E0                                    shl     eax, 1          ; shl  eax,shift
  3635                                                                          ; (needed when COS.fraction is less than 32bit)
  3636 000025B3 BA51C21340                              mov     edx, 4013C251h  ; sign&&cos ; +COS0_0 = 4013C251h
  3637 000025B8 F7EA                                    imul    edx
  3638 000025BA 89567C                                  mov     [esi+124], edx  ; [esi+b*4] ; upper 32bit of multiply result
  3639 000025BD 8B463C                                  mov     eax, [esi+60]   ; @@BF 15,16,+,COS0_15,5
  3640                                                                          ; [esi+a*4]
  3641 000025C0 8B5640                                  mov     edx, [esi+64]   ; [esi+b*4]
  3642 000025C3 01563C                                  add     [esi+60], edx   ; [esi+a*4]
  3643 000025C6 29D0                                    sub     eax, edx
  3644 000025C8 C1E005                                  shl     eax, 5          ; shl eax,shift
  3645 000025CB BAFB228551                              mov     edx, 518522FBh  ; sign&&cos ; +COS0_15 = 518522FBh
  3646 000025D0 F7EA                                    imul    edx
  3647 000025D2 895640                                  mov     [esi+64], edx   ; [esi+b*4]
  3648 000025D5 8B06                                    mov     eax, [esi]      ; @@BF 0,15,+,COS1_0,1
  3649 000025D7 8B563C                                  mov     edx, [esi+60]
  3650 000025DA 0116                                    add     [esi], edx
  3651 000025DC 29D0                                    sub     eax, edx
  3652 000025DE D1E0                                    shl     eax, 1
  3653 000025E0 BA72464F40                              mov     edx, 404F4672h  ; +COS1_0
  3654 000025E5 F7EA                                    imul    edx
  3655 000025E7 89563C                                  mov     [esi+60], edx
  3656 000025EA 8B4640                                  mov     eax, [esi+64]   ; @@BF 16,31,-,COS1_0,1
  3657 000025ED 8B567C                                  mov     edx, [esi+124]
  3658 000025F0 015640                                  add     [esi+64], edx
  3659 000025F3 29D0                                    sub     eax, edx
  3660 000025F5 D1E0                                    shl     eax, 1
  3661 000025F7 BA8EB9B0BF                              mov     edx, 0BFB0B98Eh ; -COS1_0
  3662 000025FC F7EA                                    imul    edx
  3663 000025FE 89567C                                  mov     [esi+124], edx
  3664 00002601 8B461C                                  mov     eax, [esi+28]   ; @@BF 7,24,+,COS0_7,1
  3665 00002604 8B5660                                  mov     edx, [esi+96]
  3666 00002607 01561C                                  add     [esi+28], edx
  3667 0000260A 29D0                                    sub     eax, edx
  3668 0000260C D1E0                                    shl     eax, 1
  3669 0000260E BAA71E6056                              mov     edx, 56601EA7h
  3670 00002613 F7EA                                    imul    edx
  3671 00002615 895660                                  mov     [esi+96], edx
  3672 00002618 8B4620                                  mov     eax, [esi+32]   ; @@BF 8,23,+,COS0_8,1
  3673 0000261B 8B565C                                  mov     edx, [esi+92]
  3674 0000261E 015620                                  add     [esi+32], edx
  3675 00002621 29D0                                    sub     eax, edx
  3676 00002623 D1E0                                    shl     eax, 1
  3677 00002625 BAECF64C5F                              mov     edx, 5F4CF6ECh
  3678 0000262A F7EA                                    imul    edx
  3679 0000262C 89565C                                  mov     [esi+92], edx
  3680 0000262F 8B461C                                  mov     eax, [esi+28]   ; @@BF 7,8,+,COS1_7,4
  3681 00002632 8B5620                                  mov     edx, [esi+32]
  3682 00002635 01561C                                  add     [esi+28], edx
  3683 00002638 29D0                                    sub     eax, edx
  3684 0000263A C1E004                                  shl     eax, 4
  3685 0000263D BA044E9E51                              mov     edx, 519E4E04h
  3686 00002642 F7EA                                    imul    edx
  3687 00002644 895620                                  mov     [esi+32], edx
  3688 00002647 8B465C                                  mov     eax, [esi+92]   ; @@BF 23,24,-,COS1_7,4
  3689 0000264A 8B5660                                  mov     edx, [esi+96]
  3690 0000264D 01565C                                  add     [esi+92], edx
  3691 00002650 29D0                                    sub     eax, edx
  3692 00002652 C1E004                                  shl     eax, 4
  3693 00002655 BAFCB161AE                              mov     edx, 0AE61B1FCh
  3694 0000265A F7EA                                    imul    edx
  3695 0000265C 895660                                  mov     [esi+96], edx
  3696 0000265F 8B06                                    mov     eax, [esi]      ; @@BF 0,7,+,COS2_0,1
  3697 00002661 8B561C                                  mov     edx, [esi+28]
  3698 00002664 0116                                    add     [esi], edx
  3699 00002666 29D0                                    sub     eax, edx
  3700 00002668 D1E0                                    shl     eax, 1
  3701 0000266A BA46FB4041                              mov     edx, 4140FB46h
  3702 0000266F F7EA                                    imul    edx
  3703 00002671 89561C                                  mov     [esi+28], edx
  3704 00002674 8B4620                                  mov     eax, [esi+32]   ; @@BF 8,15,-,COS2_0,1
  3705 00002677 8B563C                                  mov     edx, [esi+60]
  3706 0000267A 015620                                  add     [esi+32], edx
  3707 0000267D 29D0                                    sub     eax, edx
  3708 0000267F D1E0                                    shl     eax, 1
  3709 00002681 BABA04BFBE                              mov     edx, 0BEBF04BAh
  3710 00002686 F7EA                                    imul    edx
  3711 00002688 89563C                                  mov     [esi+60], edx
  3712 0000268B 8B4640                                  mov     eax, [esi+64]   ; @@BF 16,23,+,COS2_0,1
  3713 0000268E 8B565C                                  mov     edx, [esi+92]
  3714 00002691 015640                                  add     [esi+40h], edx
  3715 00002694 29D0                                    sub     eax, edx
  3716 00002696 D1E0                                    shl     eax, 1
  3717 00002698 BA46FB4041                              mov     edx, 4140FB46h
  3718 0000269D F7EA                                    imul    edx
  3719 0000269F 89565C                                  mov     [esi+92], edx
  3720 000026A2 8B4660                                  mov     eax, [esi+96]   ; @@BF 24,31,-,COS2_0,1
  3721 000026A5 8B567C                                  mov     edx, [esi+124]
  3722 000026A8 015660                                  add     [esi+96], edx
  3723 000026AB 29D0                                    sub     eax, edx
  3724 000026AD D1E0                                    shl     eax, 1
  3725 000026AF BABA04BFBE                              mov     edx, 0BEBF04BAh
  3726 000026B4 F7EA                                    imul    edx
  3727 000026B6 89567C                                  mov     [esi+124], edx
  3728 000026B9 8B460C                                  mov     eax, [esi+12]   ; @@BF 3,28,+,COS0_3,1
  3729 000026BC 8B5670                                  mov     edx, [esi+112]
  3730 000026BF 01560C                                  add     [esi+12], edx
  3731 000026C2 29D0                                    sub     eax, edx
  3732 000026C4 D1E0                                    shl     eax, 1
  3733 000026C6 BA2134F943                              mov     edx, 43F93421h
  3734 000026CB F7EA                                    imul    edx
  3735 000026CD 895670                                  mov     [esi+112], edx
  3736 000026D0 8B4630                                  mov     eax, [esi+48]   ; @@BF 12,19,+,COS0_12,2
  3737 000026D3 8B564C                                  mov     edx, [esi+76]
  3738 000026D6 015630                                  add     [esi+48], edx
  3739 000026D9 29D0                                    sub     eax, edx
  3740 000026DB C1E002                                  shl     eax, 2
  3741 000026DE BA978DFC5E                              mov     edx, 5EFC8D97h
  3742 000026E3 F7EA                                    imul    edx
  3743 000026E5 89564C                                  mov     [esi+76], edx
  3744 000026E8 8B460C                                  mov     eax, [esi+12]   ; @@BF 3,12,+,COS1_3,1
  3745 000026EB 8B5630                                  mov     edx, [esi+48]
  3746 000026EE 01560C                                  add     [esi+12], edx
  3747 000026F1 29D0                                    sub     eax, edx
  3748 000026F3 D1E0                                    shl     eax, 1
  3749 000026F5 BA630ECB52                              mov     edx, 52CB0E63h
  3750 000026FA F7EA                                    imul    edx
  3751 000026FC 895630                                  mov     [esi+48], edx
  3752 000026FF 8B464C                                  mov     eax, [esi+76]   ; @@BF 19,28,-,COS1_3,1
  3753 00002702 8B5670                                  mov     edx, [esi+112]
  3754 00002705 01564C                                  add     [esi+76], edx
  3755 00002708 29D0                                    sub     eax, edx
  3756 0000270A D1E0                                    shl     eax, 1
  3757 0000270C BA9DF134AD                              mov     edx, 0AD34F19Dh
  3758 00002711 F7EA                                    imul    edx
  3759 00002713 895670                                  mov     [esi+112], edx
  3760 00002716 8B4610                                  mov     eax, [esi+16]   ; @@BF 4,27,+,COS0_4,1
  3761 00002719 8B566C                                  mov     edx, [esi+108]
  3762 0000271C 015610                                  add     [esi+16], edx
  3763 0000271F 29D0                                    sub     eax, edx
  3764 00002721 D1E0                                    shl     eax, 1
  3765 00002723 BAC51BCC46                              mov     edx, 46CC1BC5h
  3766 00002728 F7EA                                    imul    edx
  3767 0000272A 89566C                                  mov     [esi+108], edx
  3768 0000272D 8B462C                                  mov     eax, [esi+44]   ; @@BF 11,20,+,COS0_11,2
  3769 00002730 8B5650                                  mov     edx, [esi+80]
  3770 00002733 01562C                                  add     [esi+44], edx
  3771 00002736 29D0                                    sub     eax, edx
  3772 00002738 C1E002                                  shl     eax, 2
  3773 0000273B BA981AD84A                              mov     edx, 4AD81A98h
  3774 00002740 F7EA                                    imul    edx
  3775 00002742 895650                                  mov     [esi+80], edx
  3776 00002745 8B4610                                  mov     eax, [esi+16]   ; @@BF 4,11,+,COS1_4,1
  3777 00002748 8B562C                                  mov     edx, [esi+44]
  3778 0000274B 015610                                  add     [esi+16], edx
  3779 0000274E 29D0                                    sub     eax, edx
  3780 00002750 D1E0                                    shl     eax, 1
  3781 00002752 BA2E40E264                              mov     edx, 64E2402Eh
  3782 00002757 F7EA                                    imul    edx
  3783 00002759 89562C                                  mov     [esi+44], edx
  3784 0000275C 8B4650                                  mov     eax, [esi+80]   ; @@BF 20,27,-,COS1_4,1
  3785 0000275F 8B566C                                  mov     edx, [esi+108]
  3786 00002762 015650                                  add     [esi+80], edx
  3787 00002765 29D0                                    sub     eax, edx
  3788 00002767 D1E0                                    shl     eax, 1
  3789 00002769 BAD2BF1D9B                              mov     edx, 9B1DBFD2h
  3790 0000276E F7EA                                    imul    edx
  3791 00002770 89566C                                  mov     [esi+108], edx
  3792 00002773 8B460C                                  mov     eax, [esi+12]   ; @@BF 3,4,+,COS2_3,3
  3793 00002776 8B5610                                  mov     edx, [esi+16]
  3794 00002779 01560C                                  add     [esi+12], edx
  3795 0000277C 29D0                                    sub     eax, edx
  3796 0000277E C1E003                                  shl     eax, 3
  3797 00002781 BA42670352                              mov     edx, 52036742h
  3798 00002786 F7EA                                    imul    edx
  3799 00002788 895610                                  mov     [esi+16], edx
  3800 0000278B 8B462C                                  mov     eax, [esi+44]   ; @@BF 11,12,-,COS2_3,3
  3801 0000278E 8B5630                                  mov     edx, [esi+48]
  3802 00002791 01562C                                  add     [esi+44], edx
  3803 00002794 29D0                                    sub     eax, edx
  3804 00002796 C1E003                                  shl     eax, 3
  3805 00002799 BABE98FCAD                              mov     edx, 0ADFC98BEh ; -COS2_3
  3806 0000279E F7EA                                    imul    edx
  3807 000027A0 895630                                  mov     [esi+48], edx
  3808 000027A3 8B464C                                  mov     eax, [esi+76]   ; @@BF 19,20,+,COS2_3,3
  3809 000027A6 8B5650                                  mov     edx, [esi+80]
  3810 000027A9 01564C                                  add     [esi+4Ch], edx
  3811 000027AC 29D0                                    sub     eax, edx
  3812 000027AE C1E003                                  shl     eax, 3
  3813 000027B1 BA42670352                              mov     edx, 52036742h  ; +COS2_3
  3814 000027B6 F7EA                                    imul    edx
  3815 000027B8 895650                                  mov     [esi+80], edx
  3816 000027BB 8B466C                                  mov     eax, [esi+108]  ; @@BF 27,28,-,COS2_3,3
  3817 000027BE 8B5670                                  mov     edx, [esi+112]
  3818 000027C1 01566C                                  add     [esi+108], edx
  3819 000027C4 29D0                                    sub     eax, edx
  3820 000027C6 C1E003                                  shl     eax, 3
  3821 000027C9 BABE98FCAD                              mov     edx, 0ADFC98BEh
  3822 000027CE F7EA                                    imul    edx
  3823 000027D0 895670                                  mov     [esi+112], edx
  3824 000027D3 8B06                                    mov     eax, [esi]      ; @@BF 0,3,+,COS3_0,1
  3825 000027D5 8B560C                                  mov     edx, [esi+12]
  3826 000027D8 0116                                    add     [esi], edx
  3827 000027DA 29D0                                    sub     eax, edx
  3828 000027DC D1E0                                    shl     eax, 1
  3829 000027DE BAF0E94545                              mov     edx, 4545E9F0h
  3830 000027E3 F7EA                                    imul    edx
  3831 000027E5 89560C                                  mov     [esi+12], edx
  3832 000027E8 8B4610                                  mov     eax, [esi+16]   ; @@BF 4,7,-,COS3_0,1
  3833 000027EB 8B561C                                  mov     edx, [esi+28]
  3834 000027EE 015610                                  add     [esi+16], edx
  3835 000027F1 29D0                                    sub     eax, edx
  3836 000027F3 D1E0                                    shl     eax, 1
  3837 000027F5 BA1016BABA                              mov     edx, 0BABA1610h
  3838 000027FA F7EA                                    imul    edx
  3839 000027FC 89561C                                  mov     [esi+28], edx
  3840 000027FF 8B4620                                  mov     eax, [esi+32]   ; @@BF 8,11,+,COS3_0,1
  3841 00002802 8B562C                                  mov     edx, [esi+44]
  3842 00002805 015620                                  add     [esi+32], edx
  3843 00002808 29D0                                    sub     eax, edx
  3844 0000280A D1E0                                    shl     eax, 1
  3845 0000280C BAF0E94545                              mov     edx, 4545E9F0h
  3846 00002811 F7EA                                    imul    edx
  3847 00002813 89562C                                  mov     [esi+44], edx
  3848 00002816 8B4630                                  mov     eax, [esi+48]   ; @@BF 12,15,-,COS3_0,1
  3849 00002819 8B563C                                  mov     edx, [esi+60]
  3850 0000281C 015630                                  add     [esi+48], edx
  3851 0000281F 29D0                                    sub     eax, edx
  3852 00002821 D1E0                                    shl     eax, 1
  3853 00002823 BA1016BABA                              mov     edx, 0BABA1610h
  3854 00002828 F7EA                                    imul    edx
  3855 0000282A 89563C                                  mov     [esi+60], edx
  3856 0000282D 8B4640                                  mov     eax, [esi+64]   ; @@BF 16,19,+,COS3_0,1
  3857 00002830 8B564C                                  mov     edx, [esi+76]
  3858 00002833 015640                                  add     [esi+64], edx
  3859 00002836 29D0                                    sub     eax, edx
  3860 00002838 D1E0                                    shl     eax, 1
  3861 0000283A BAF0E94545                              mov     edx, 4545E9F0h
  3862 0000283F F7EA                                    imul    edx
  3863 00002841 89564C                                  mov     [esi+76], edx
  3864 00002844 8B4650                                  mov     eax, [esi+80]   ; @@BF 20,23,-,COS3_0,1
  3865 00002847 8B565C                                  mov     edx, [esi+92]
  3866 0000284A 015650                                  add     [esi+80], edx
  3867 0000284D 29D0                                    sub     eax, edx
  3868 0000284F D1E0                                    shl     eax, 1
  3869 00002851 BA1016BABA                              mov     edx, 0BABA1610h ; -COS3_0
  3870 00002856 F7EA                                    imul    edx
  3871 00002858 89565C                                  mov     [esi+92], edx
  3872 0000285B 8B4660                                  mov     eax, [esi+96]   ; @@BF 24,27,+,COS3_0,1
  3873 0000285E 8B566C                                  mov     edx, [esi+108]
  3874 00002861 015660                                  add     [esi+96], edx
  3875 00002864 29D0                                    sub     eax, edx
  3876 00002866 D1E0                                    shl     eax, 1
  3877 00002868 BAF0E94545                              mov     edx, 4545E9F0h  ; +COS3_0
  3878 0000286D F7EA                                    imul    edx
  3879 0000286F 89566C                                  mov     [esi+108], edx
  3880 00002872 8B4670                                  mov     eax, [esi+112]  ; @@BF 28,31,-,COS3_0,1
  3881 00002875 8B567C                                  mov     edx, [esi+124]
  3882 00002878 015670                                  add     [esi+112], edx
  3883 0000287B 29D0                                    sub     eax, edx
  3884 0000287D D1E0                                    shl     eax, 1
  3885 0000287F BA1016BABA                              mov     edx, 0BABA1610h
  3886 00002884 F7EA                                    imul    edx
  3887 00002886 89567C                                  mov     [esi+124], edx
  3888 00002889 8B4604                                  mov     eax, [esi+4]    ; @@BF 1,30,+,COS0_1,1
  3889 0000288C 8B5678                                  mov     edx, [esi+120]
  3890 0000288F 015604                                  add     [esi+4], edx
  3891 00002892 29D0                                    sub     eax, edx
  3892 00002894 D1E0                                    shl     eax, 1
  3893 00002896 BABD45B340                              mov     edx, 40B345BDh
  3894 0000289B F7EA                                    imul    edx
  3895 0000289D 895678                                  mov     [esi+120], edx
  3896 000028A0 8B4638                                  mov     eax, [esi+56]   ; @@BF 14,17,+,COS0_14,3
  3897 000028A3 8B5644                                  mov     edx, [esi+68]
  3898 000028A6 015638                                  add     [esi+56], edx
  3899 000028A9 29D0                                    sub     eax, edx
  3900 000028AB C1E003                                  shl     eax, 3
  3901 000028AE BAD0200B6D                              mov     edx, 6D0B20D0h
  3902 000028B3 F7EA                                    imul    edx
  3903 000028B5 895644                                  mov     [esi+68], edx
  3904 000028B8 8B4604                                  mov     eax, [esi+4]    ; @@BF 1,14,+,COS1_1,1
  3905 000028BB 8B5638                                  mov     edx, [esi+56]
  3906 000028BE 015604                                  add     [esi+4], edx
  3907 000028C1 29D0                                    sub     eax, edx
  3908 000028C3 D1E0                                    shl     eax, 1
  3909 000028C5 BA103CE142                              mov     edx, 42E13C10h
  3910 000028CA F7EA                                    imul    edx
  3911 000028CC 895638                                  mov     [esi+56], edx
  3912 000028CF 8B4644                                  mov     eax, [esi+68]   ; @@BF 17,30,-,COS1_1,1
  3913 000028D2 8B5678                                  mov     edx, [esi+120]
  3914 000028D5 015644                                  add     [esi+68], edx
  3915 000028D8 29D0                                    sub     eax, edx
  3916 000028DA D1E0                                    shl     eax, 1
  3917 000028DC BAF0C31EBD                              mov     edx, 0BD1EC3F0h
  3918 000028E1 F7EA                                    imul    edx
  3919 000028E3 895678                                  mov     [esi+120], edx
  3920 000028E6 8B4618                                  mov     eax, [esi+24]   ; @@BF 6,25,+,COS0_6,1
  3921 000028E9 8B5664                                  mov     edx, [esi+100]
  3922 000028EC 015618                                  add     [esi+24], edx
  3923 000028EF 29D0                                    sub     eax, edx
  3924 000028F1 D1E0                                    shl     eax, 1
  3925 000028F3 BA1237AE4F                              mov     edx, 4FAE3712h
  3926 000028F8 F7EA                                    imul    edx
  3927 000028FA 895664                                  mov     [esi+100], edx
  3928 000028FD 8B4624                                  mov     eax, [esi+36]   ; @@BF 9,22,+,COS0_9,1
  3929 00002900 8B5658                                  mov     edx, [esi+88]
  3930 00002903 015624                                  add     [esi+36], edx
  3931 00002906 29D0                                    sub     eax, edx
  3932 00002908 D1E0                                    shl     eax, 1
  3933 0000290A BA27CF6F6B                              mov     edx, 6B6FCF27h
  3934 0000290F F7EA                                    imul    edx
  3935 00002911 895658                                  mov     [esi+88], edx
  3936 00002914 8B4618                                  mov     eax, [esi+24]   ; @@BF 6, 9,+,COS1_6,2
  3937 00002917 8B5624                                  mov     edx, [esi+36]
  3938 0000291A 015618                                  add     [esi+24], edx
  3939 0000291D 29D0                                    sub     eax, edx
  3940 0000291F C1E002                                  shl     eax, 2
  3941 00002922 BAC2923C6E                              mov     edx, 6E3C92C2h
  3942 00002927 F7EA                                    imul    edx
  3943 00002929 895624                                  mov     [esi+36], edx
  3944 0000292C 8B4658                                  mov     eax, [esi+88]   ; @@BF 22,25,-,COS1_6,2
  3945 0000292F 8B5664                                  mov     edx, [esi+100]
  3946 00002932 015658                                  add     [esi+88], edx
  3947 00002935 29D0                                    sub     eax, edx
  3948 00002937 C1E002                                  shl     eax, 2
  3949 0000293A BA3E6DC391                              mov     edx, 91C36D3Eh
  3950 0000293F F7EA                                    imul    edx
  3951 00002941 895664                                  mov     [esi+100], edx
  3952 00002944 8B4604                                  mov     eax, [esi+4]    ; @@BF 1, 6,+,COS2_1,1
  3953 00002947 8B5618                                  mov     edx, [esi+24]
  3954 0000294A 015604                                  add     [esi+4], edx
  3955 0000294D 29D0                                    sub     eax, edx
  3956 0000294F D1E0                                    shl     eax, 1
  3957 00002951 BA88DEF84C                              mov     edx, 4CF8DE88h
  3958 00002956 F7EA                                    imul    edx
  3959 00002958 895618                                  mov     [esi+24], edx
  3960 0000295B 8B4624                                  mov     eax, [esi+36]   ; @@BF 9,14,-,COS2_1,1
  3961 0000295E 8B5638                                  mov     edx, [esi+56]
  3962 00002961 015624                                  add     [esi+36], edx
  3963 00002964 29D0                                    sub     eax, edx
  3964 00002966 D1E0                                    shl     eax, 1
  3965 00002968 BA782107B3                              mov     edx, 0B3072178h
  3966 0000296D F7EA                                    imul    edx
  3967 0000296F 895638                                  mov     [esi+56], edx
  3968 00002972 8B4644                                  mov     eax, [esi+68]   ; @@BF 17,22,+,COS2_1,1
  3969 00002975 8B5658                                  mov     edx, [esi+88]
  3970 00002978 015644                                  add     [esi+68], edx
  3971 0000297B 29D0                                    sub     eax, edx
  3972 0000297D D1E0                                    shl     eax, 1
  3973 0000297F BA88DEF84C                              mov     edx, 4CF8DE88h
  3974 00002984 F7EA                                    imul    edx
  3975 00002986 895658                                  mov     [esi+88], edx
  3976 00002989 8B4664                                  mov     eax, [esi+100]  ; @@BF 25,30,-,COS2_1,1
  3977 0000298C 8B5678                                  mov     edx, [esi+120]
  3978 0000298F 015664                                  add     [esi+100], edx
  3979 00002992 29D0                                    sub     eax, edx
  3980 00002994 D1E0                                    shl     eax, 1
  3981 00002996 BA782107B3                              mov     edx, 0B3072178h
  3982 0000299B F7EA                                    imul    edx
  3983 0000299D 895678                                  mov     [esi+120], edx
  3984 000029A0 8B4608                                  mov     eax, [esi+8]    ; @@BF 2,29,+,COS0_2,1
  3985 000029A3 8B5674                                  mov     edx, [esi+116]
  3986 000029A6 015608                                  add     [esi+8], edx
  3987 000029A9 29D0                                    sub     eax, edx
  3988 000029AB D1E0                                    shl     eax, 1
  3989 000029AD BA6E2DFA41                              mov     edx, 41FA2D6Eh
  3990 000029B2 F7EA                                    imul    edx
  3991 000029B4 895674                                  mov     [esi+116], edx
  3992 000029B7 8B4634                                  mov     eax, [esi+52]   ; @@BF 13,18,+,COS0_13,3
  3993 000029BA 8B5648                                  mov     edx, [esi+72]
  3994 000029BD 015634                                  add     [esi+52], edx
  3995 000029C0 29D0                                    sub     eax, edx
  3996 000029C2 C1E003                                  shl     eax, 3
  3997 000029C5 BA9057D941                              mov     edx, 41D95790h
  3998 000029CA F7EA                                    imul    edx
  3999 000029CC 895648                                  mov     [esi+72], edx
  4000 000029CF 8B4608                                  mov     eax, [esi+8]    ; @@BF 2,13,+,COS1_2,1
  4001 000029D2 8B5634                                  mov     edx, [esi+52]
  4002 000029D5 015608                                  add     [esi+8], edx
  4003 000029D8 29D0                                    sub     eax, edx
  4004 000029DA D1E0                                    shl     eax, 1
  4005 000029DC BA459F9148                              mov     edx, 48919F45h
  4006 000029E1 F7EA                                    imul    edx
  4007 000029E3 895634                                  mov     [esi+52], edx
  4008 000029E6 8B4648                                  mov     eax, [esi+72]   ; @@BF 18,29,-,COS1_2,1
  4009 000029E9 8B5674                                  mov     edx, [esi+116]
  4010 000029EC 015648                                  add     [esi+72], edx
  4011 000029EF 29D0                                    sub     eax, edx
  4012 000029F1 D1E0                                    shl     eax, 1
  4013 000029F3 BABB606EB7                              mov     edx, 0B76E60BBh
  4014 000029F8 F7EA                                    imul    edx
  4015 000029FA 895674                                  mov     [esi+116], edx
  4016 000029FD 8B4614                                  mov     eax, [esi+20]   ; @@BF 5,26,+,COS0_5,1
  4017 00002A00 8B5668                                  mov     edx, [esi+104]
  4018 00002A03 015614                                  add     [esi+20], edx
  4019 00002A06 29D0                                    sub     eax, edx
  4020 00002A08 D1E0                                    shl     eax, 1
  4021 00002A0A BAF19C9D4A                              mov     edx, 4A9D9CF1h
  4022 00002A0F F7EA                                    imul    edx
  4023 00002A11 895668                                  mov     [esi+104], edx
  4024 00002A14 8B4628                                  mov     eax, [esi+40]   ; @@BF 10,21,+,COS0_10,1
  4025 00002A17 8B5654                                  mov     edx, [esi+84]
  4026 00002A1A 015628                                  add     [esi+40], edx
  4027 00002A1D 29D0                                    sub     eax, edx
  4028 00002A1F D1E0                                    shl     eax, 1
  4029 00002A21 BAB41D7D7C                              mov     edx, 7C7D1DB4h
  4030 00002A26 F7EA                                    imul    edx
  4031 00002A28 895654                                  mov     [esi+84], edx
  4032 00002A2B 8B4614                                  mov     eax, [esi+20]   ; @@BF 5,10,+,COS1_5,2
  4033 00002A2E 8B5628                                  mov     edx, [esi+40]
  4034 00002A31 015614                                  add     [esi+20], edx
  4035 00002A34 29D0                                    sub     eax, edx
  4036 00002A36 C1E002                                  shl     eax, 2
  4037 00002A39 BAAA24E243                              mov     edx, 43E224AAh
  4038 00002A3E F7EA                                    imul    edx
  4039 00002A40 895628                                  mov     [esi+40], edx
  4040 00002A43 8B4654                                  mov     eax, [esi+84]   ; @@BF 21,26,-,COS1_5,2
  4041 00002A46 8B5668                                  mov     edx, [esi+104]
  4042 00002A49 015654                                  add     [esi+84], edx
  4043 00002A4C 29D0                                    sub     eax, edx
  4044 00002A4E C1E002                                  shl     eax, 2
  4045 00002A51 BA56DB1DBC                              mov     edx, 0BC1DDB56h
  4046 00002A56 F7EA                                    imul    edx
  4047 00002A58 895668                                  mov     [esi+104], edx
  4048 00002A5B 8B4608                                  mov     eax, [esi+8]    ; @@BF 2,5,+,COS2_2,1
  4049 00002A5E 8B5614                                  mov     edx, [esi+20]
  4050 00002A61 015608                                  add     [esi+8], edx
  4051 00002A64 29D0                                    sub     eax, edx
  4052 00002A66 D1E0                                    shl     eax, 1
  4053 00002A68 BABF6B3273                              mov     edx, 73326BBFh  ; +COS2_2
  4054 00002A6D F7EA                                    imul    edx
  4055 00002A6F 895614                                  mov     [esi+20], edx
  4056 00002A72 8B4628                                  mov     eax, [esi+40]   ; @@BF 10,13,-,COS2_2,1
  4057 00002A75 8B5634                                  mov     edx, [esi+52]
  4058 00002A78 015628                                  add     [esi+40], edx
  4059 00002A7B 29D0                                    sub     eax, edx
  4060 00002A7D D1E0                                    shl     eax, 1
  4061 00002A7F BA4194CD8C                              mov     edx, 8CCD9441h  ; -COS2_2
  4062 00002A84 F7EA                                    imul    edx
  4063 00002A86 895634                                  mov     [esi+52], edx
  4064 00002A89 8B4648                                  mov     eax, [esi+72]   ; @@BF 18,21,+,COS2_2,1
  4065 00002A8C 8B5654                                  mov     edx, [esi+84]
  4066 00002A8F 015648                                  add     [esi+72], edx
  4067 00002A92 29D0                                    sub     eax, edx
  4068 00002A94 D1E0                                    shl     eax, 1
  4069 00002A96 BABF6B3273                              mov     edx, 73326BBFh
  4070 00002A9B F7EA                                    imul    edx
  4071 00002A9D 895654                                  mov     [esi+84], edx
  4072 00002AA0 8B4668                                  mov     eax, [esi+104]  ; @@BF 26,29,-,COS2_2,1
  4073 00002AA3 8B5674                                  mov     edx, [esi+116]
  4074 00002AA6 015668                                  add     [esi+104], edx
  4075 00002AA9 29D0                                    sub     eax, edx
  4076 00002AAB D1E0                                    shl     eax, 1
  4077 00002AAD BA4194CD8C                              mov     edx, 8CCD9441h
  4078 00002AB2 F7EA                                    imul    edx
  4079 00002AB4 895674                                  mov     [esi+116], edx
  4080 00002AB7 8B4604                                  mov     eax, [esi+4]    ; @@BF 1,2,+,COS3_1,2
  4081 00002ABA 8B5608                                  mov     edx, [esi+8]
  4082 00002ABD 015604                                  add     [esi+4], edx
  4083 00002AC0 29D0                                    sub     eax, edx
  4084 00002AC2 C1E002                                  shl     eax, 2
  4085 00002AC5 BA46BA9E53                              mov     edx, 539EBA46h
  4086 00002ACA F7EA                                    imul    edx
  4087 00002ACC 895608                                  mov     [esi+8], edx
  4088 00002ACF 8B4614                                  mov     eax, [esi+20]   ; @@BF 5,6,-,COS3_1,2
  4089 00002AD2 8B5618                                  mov     edx, [esi+24]
  4090 00002AD5 015614                                  add     [esi+20], edx
  4091 00002AD8 29D0                                    sub     eax, edx
  4092 00002ADA C1E002                                  shl     eax, 2
  4093 00002ADD BABA4561AC                              mov     edx, 0AC6145BAh
  4094 00002AE2 F7EA                                    imul    edx
  4095 00002AE4 895618                                  mov     [esi+24], edx
  4096 00002AE7 8B4624                                  mov     eax, [esi+36]   ; IF rate_shift LT 2
  4097                                                                          ; @@BF 9,10,+,COS3_1,2
  4098 00002AEA 8B5628                                  mov     edx, [esi+40]
  4099 00002AED 015624                                  add     [esi+36], edx
  4100 00002AF0 29D0                                    sub     eax, edx
  4101 00002AF2 C1E002                                  shl     eax, 2
  4102 00002AF5 BA46BA9E53                              mov     edx, 539EBA46h
  4103 00002AFA F7EA                                    imul    edx
  4104 00002AFC 895628                                  mov     [esi+40], edx
  4105 00002AFF 8B4634                                  mov     eax, [esi+52]   ; @@BF 13,14,-,COS3_1,2
  4106 00002B02 8B5638                                  mov     edx, [esi+56]
  4107 00002B05 015634                                  add     [esi+52], edx
  4108 00002B08 29D0                                    sub     eax, edx
  4109 00002B0A C1E002                                  shl     eax, 2
  4110 00002B0D BABA4561AC                              mov     edx, 0AC6145BAh
  4111 00002B12 F7EA                                    imul    edx
  4112 00002B14 895638                                  mov     [esi+56], edx   ; ENDIF
  4113 00002B17 8B4644                                  mov     eax, [esi+68]   ; @@BF 17,18,+,COS3_1,2
  4114 00002B1A 8B5648                                  mov     edx, [esi+72]
  4115 00002B1D 015644                                  add     [esi+68], edx
  4116 00002B20 29D0                                    sub     eax, edx
  4117 00002B22 C1E002                                  shl     eax, 2
  4118 00002B25 BA46BA9E53                              mov     edx, 539EBA46h
  4119 00002B2A F7EA                                    imul    edx
  4120 00002B2C 895648                                  mov     [esi+72], edx
  4121 00002B2F 8B4654                                  mov     eax, [esi+84]   ; @@BF 21,22,-,COS3_1,2
  4122 00002B32 8B5658                                  mov     edx, [esi+88]
  4123 00002B35 015654                                  add     [esi+84], edx
  4124 00002B38 29D0                                    sub     eax, edx
  4125 00002B3A C1E002                                  shl     eax, 2
  4126 00002B3D BABA4561AC                              mov     edx, 0AC6145BAh
  4127 00002B42 F7EA                                    imul    edx
  4128 00002B44 895658                                  mov     [esi+88], edx
  4129 00002B47 8B4664                                  mov     eax, [esi+100]  ; @@BF 25,26,+,COS3_1,2
  4130 00002B4A 8B5668                                  mov     edx, [esi+104]
  4131 00002B4D 015664                                  add     [esi+100], edx
  4132 00002B50 29D0                                    sub     eax, edx
  4133 00002B52 C1E002                                  shl     eax, 2
  4134 00002B55 BA46BA9E53                              mov     edx, 539EBA46h
  4135 00002B5A F7EA                                    imul    edx
  4136 00002B5C 895668                                  mov     [esi+104], edx
  4137 00002B5F 8B4674                                  mov     eax, [esi+116]  ; @@BF 29,30,-,COS3_1,2
  4138 00002B62 8B5678                                  mov     edx, [esi+120]
  4139 00002B65 015674                                  add     [esi+116], edx
  4140 00002B68 29D0                                    sub     eax, edx
  4141 00002B6A C1E002                                  shl     eax, 2
  4142 00002B6D BABA4561AC                              mov     edx, 0AC6145BAh
  4143 00002B72 F7EA                                    imul    edx
  4144 00002B74 895678                                  mov     [esi+120], edx
  4145 00002B77 8B06                                    mov     eax, [esi]      ; @@BF1 macro a, b, c, d
  4146                                                                          ;   @@BF  a, b,+,COS4_0, 1
  4147                                                                          ;   @@BF  c, d,-,COS4_0, 1
  4148                                                                          ;   @@ADD c, d
  4149                                                                          ;  endm
  4150                                                                          ; @@BF1 0,1,2,3
  4151 00002B79 8B5604                                  mov     edx, [esi+4]    ; @@BF 0,1,+,COS4_0,1
  4152 00002B7C 0116                                    add     [esi], edx
  4153 00002B7E 29D0                                    sub     eax, edx
  4154 00002B80 D1E0                                    shl     eax, 1
  4155 00002B82 BA9A79825A                              mov     edx, 5A82799Ah  ; +COS4_0
  4156 00002B87 F7EA                                    imul    edx
  4157 00002B89 895604                                  mov     [esi+4], edx
  4158 00002B8C 8B4608                                  mov     eax, [esi+8]    ; @@BF 2,3,-,COS4_0,1
  4159 00002B8F 8B560C                                  mov     edx, [esi+12]
  4160 00002B92 015608                                  add     [esi+8], edx
  4161 00002B95 29D0                                    sub     eax, edx
  4162 00002B97 D1E0                                    shl     eax, 1
  4163 00002B99 BA66867DA5                              mov     edx, 0A57D8666h ; -COS4_0
  4164 00002B9E F7EA                                    imul    edx
  4165 00002BA0 89560C                                  mov     [esi+12], edx
  4166 00002BA3 8B460C                                  mov     eax, [esi+12]   ; @@ADD 2,3
  4167 00002BA6 014608                                  add     [esi+8], eax
  4168 00002BA9 8B4610                                  mov     eax, [esi+16]   ; @@BF2 macro a, b, c, d
  4169                                                                          ;   @@BF  a, b,+,COS4_0, 1
  4170                                                                          ;   @@BF  c, d,-,COS4_0, 1
  4171                                                                          ;   @@ADD c, d
  4172                                                                          ;   @@ADD a, c
  4173                                                                          ;   @@ADD c, b
  4174                                                                          ;   @@ADD b, d
  4175                                                                          ;  endm
  4176                                                                          ; @@BF2 4,5,6,7
  4177 00002BAC 8B5614                                  mov     edx, [esi+20]   ; @@BF 4,5,+,COS4_0,1
  4178 00002BAF 015610                                  add     [esi+16], edx
  4179 00002BB2 29D0                                    sub     eax, edx
  4180 00002BB4 D1E0                                    shl     eax, 1
  4181 00002BB6 BA9A79825A                              mov     edx, 5A82799Ah
  4182 00002BBB F7EA                                    imul    edx
  4183 00002BBD 895614                                  mov     [esi+20], edx
  4184 00002BC0 8B4618                                  mov     eax, [esi+24]   ; @@BF 6,7,-,COS4_0,1
  4185 00002BC3 8B561C                                  mov     edx, [esi+28]
  4186 00002BC6 015618                                  add     [esi+24], edx
  4187 00002BC9 29D0                                    sub     eax, edx
  4188 00002BCB D1E0                                    shl     eax, 1
  4189 00002BCD BA66867DA5                              mov     edx, 0A57D8666h
  4190 00002BD2 F7EA                                    imul    edx
  4191 00002BD4 89561C                                  mov     [esi+28], edx
  4192 00002BD7 8B461C                                  mov     eax, [esi+28]   ; @@ADD macro dst,src
  4193                                                                          ;   IF (rate_shift EQ 0) or (dst LT 16)
  4194                                                                          ;    ;tab[a] += tab[b]
  4195                                                                          ;    mov  eax,dword ptr [esi+src*4]
  4196                                                                          ;    add  dword ptr [esi+dst*4],eax
  4197                                                                          ;   ENDIF
  4198                                                                          ;  endm
  4199                                                                          ; @@ADD 6,7
  4200 00002BDA 014618                                  add     [esi+24], eax
  4201 00002BDD 8B4618                                  mov     eax, [esi+24]   ; @@ADD 4,6
  4202 00002BE0 014610                                  add     [esi+16], eax
  4203 00002BE3 8B4614                                  mov     eax, [esi+20]   ; @@ADD 6,5
  4204 00002BE6 014618                                  add     [esi+24], eax
  4205 00002BE9 8B461C                                  mov     eax, [esi+28]   ; @@ADD 5,7
  4206 00002BEC 014614                                  add     [esi+20], eax
  4207 00002BEF 8B4620                                  mov     eax, [esi+32]   ; IF rate_shift LT 2
  4208                                                                          ; @@BF1 8,9,10,11
  4209 00002BF2 8B5624                                  mov     edx, [esi+36]   ; @@BF 8,9,+,COS4_0,1
  4210 00002BF5 015620                                  add     [esi+32], edx
  4211 00002BF8 29D0                                    sub     eax, edx
  4212 00002BFA D1E0                                    shl     eax, 1
  4213 00002BFC BA9A79825A                              mov     edx, 5A82799Ah
  4214 00002C01 F7EA                                    imul    edx
  4215 00002C03 895624                                  mov     [esi+36], edx
  4216 00002C06 8B4628                                  mov     eax, [esi+40]   ; @@BF 10,11,-,COS4_0,1
  4217 00002C09 8B562C                                  mov     edx, [esi+44]
  4218 00002C0C 015628                                  add     [esi+40], edx
  4219 00002C0F 29D0                                    sub     eax, edx
  4220 00002C11 D1E0                                    shl     eax, 1
  4221 00002C13 BA66867DA5                              mov     edx, 0A57D8666h
  4222 00002C18 F7EA                                    imul    edx
  4223 00002C1A 89562C                                  mov     [esi+44], edx
  4224 00002C1D 8B462C                                  mov     eax, [esi+44]   ; @@ADD 10,11
  4225 00002C20 014628                                  add     [esi+40], eax
  4226 00002C23 8B4630                                  mov     eax, [esi+48]   ; @@BF2 12,13,14,15
  4227 00002C26 8B5634                                  mov     edx, [esi+52]   ; @@BF 12,13,+,COS4_0,1
  4228 00002C29 015630                                  add     [esi+48], edx
  4229 00002C2C 29D0                                    sub     eax, edx
  4230 00002C2E D1E0                                    shl     eax, 1
  4231 00002C30 BA9A79825A                              mov     edx, 5A82799Ah
  4232 00002C35 F7EA                                    imul    edx
  4233 00002C37 895634                                  mov     [esi+52], edx
  4234 00002C3A 8B4638                                  mov     eax, [esi+56]   ; @@BF 14,15,-,COS4_0,1
  4235 00002C3D 8B563C                                  mov     edx, [esi+60]
  4236 00002C40 015638                                  add     [esi+56], edx
  4237 00002C43 29D0                                    sub     eax, edx
  4238 00002C45 D1E0                                    shl     eax, 1
  4239 00002C47 BA66867DA5                              mov     edx, 0A57D8666h
  4240 00002C4C F7EA                                    imul    edx
  4241 00002C4E 89563C                                  mov     [esi+60], edx
  4242 00002C51 8B463C                                  mov     eax, [esi+60]   ; @@ADD 14,15
  4243 00002C54 014638                                  add     [esi+56], eax
  4244 00002C57 8B4638                                  mov     eax, [esi+56]   ; @@ADD 12,14
  4245 00002C5A 014630                                  add     [esi+48], eax
  4246 00002C5D 8B4634                                  mov     eax, [esi+52]   ; @@ADD 14,13
  4247 00002C60 014638                                  add     [esi+56], eax
  4248 00002C63 8B463C                                  mov     eax, [esi+60]   ; @@ADD 13,15
  4249 00002C66 014634                                  add     [esi+52], eax   ; ENDIF
  4250 00002C69 8B4640                                  mov     eax, [esi+64]   ; @@BF1 16,17,18,19
  4251 00002C6C 8B5644                                  mov     edx, [esi+68]
  4252 00002C6F 015640                                  add     [esi+64], edx
  4253 00002C72 29D0                                    sub     eax, edx
  4254 00002C74 D1E0                                    shl     eax, 1
  4255 00002C76 BA9A79825A                              mov     edx, 5A82799Ah  ; +COS4_0
  4256 00002C7B F7EA                                    imul    edx
  4257 00002C7D 895644                                  mov     [esi+68], edx
  4258 00002C80 8B4648                                  mov     eax, [esi+72]
  4259 00002C83 8B564C                                  mov     edx, [esi+76]
  4260 00002C86 015648                                  add     [esi+72], edx
  4261 00002C89 29D0                                    sub     eax, edx
  4262 00002C8B D1E0                                    shl     eax, 1
  4263 00002C8D BA66867DA5                              mov     edx, 0A57D8666h ; -COS4_0
  4264 00002C92 F7EA                                    imul    edx
  4265 00002C94 89564C                                  mov     [esi+76], edx
  4266 00002C97 8B464C                                  mov     eax, [esi+76]   ; @@ADD 18,19
  4267 00002C9A 014648                                  add     [esi+72], eax
  4268 00002C9D 8B4650                                  mov     eax, [esi+80]   ; @@BF2 20,21,22,23
  4269 00002CA0 8B5654                                  mov     edx, [esi+84]
  4270 00002CA3 015650                                  add     [esi+80], edx
  4271 00002CA6 29D0                                    sub     eax, edx
  4272 00002CA8 D1E0                                    shl     eax, 1
  4273 00002CAA BA9A79825A                              mov     edx, 5A82799Ah
  4274 00002CAF F7EA                                    imul    edx
  4275 00002CB1 895654                                  mov     [esi+84], edx
  4276 00002CB4 8B4658                                  mov     eax, [esi+88]
  4277 00002CB7 8B565C                                  mov     edx, [esi+92]
  4278 00002CBA 015658                                  add     [esi+88], edx
  4279 00002CBD 29D0                                    sub     eax, edx
  4280 00002CBF D1E0                                    shl     eax, 1
  4281 00002CC1 BA66867DA5                              mov     edx, 0A57D8666h
  4282 00002CC6 F7EA                                    imul    edx
  4283 00002CC8 89565C                                  mov     [esi+92], edx
  4284 00002CCB 8B465C                                  mov     eax, [esi+92]   ; @@ADD 22,23
  4285 00002CCE 014658                                  add     [esi+88], eax
  4286 00002CD1 8B4658                                  mov     eax, [esi+88]   ; @@ADD 20,22
  4287 00002CD4 014650                                  add     [esi+80], eax
  4288 00002CD7 8B4654                                  mov     eax, [esi+84]
  4289 00002CDA 014658                                  add     [esi+88], eax
  4290 00002CDD 8B465C                                  mov     eax, [esi+92]
  4291 00002CE0 014654                                  add     [esi+84], eax
  4292 00002CE3 8B4660                                  mov     eax, [esi+96]   ; @@BF1 24,25,26,27
  4293 00002CE6 8B5664                                  mov     edx, [esi+100]
  4294 00002CE9 015660                                  add     [esi+96], edx
  4295 00002CEC 29D0                                    sub     eax, edx
  4296 00002CEE D1E0                                    shl     eax, 1
  4297 00002CF0 BA9A79825A                              mov     edx, 5A82799Ah
  4298 00002CF5 F7EA                                    imul    edx
  4299 00002CF7 895664                                  mov     [esi+100], edx
  4300 00002CFA 8B4668                                  mov     eax, [esi+104]
  4301 00002CFD 8B566C                                  mov     edx, [esi+108]
  4302 00002D00 015668                                  add     [esi+104], edx
  4303 00002D03 29D0                                    sub     eax, edx
  4304 00002D05 D1E0                                    shl     eax, 1
  4305 00002D07 BA66867DA5                              mov     edx, 0A57D8666h
  4306 00002D0C F7EA                                    imul    edx
  4307 00002D0E 89566C                                  mov     [esi+108], edx
  4308 00002D11 8B466C                                  mov     eax, [esi+108]
  4309 00002D14 014668                                  add     [esi+104], eax
  4310 00002D17 8B4670                                  mov     eax, [esi+112]  ; @@BF2 28,29,30,31
  4311 00002D1A 8B5674                                  mov     edx, [esi+116]
  4312 00002D1D 015670                                  add     [esi+112], edx
  4313 00002D20 29D0                                    sub     eax, edx
  4314 00002D22 D1E0                                    shl     eax, 1
  4315 00002D24 BA9A79825A                              mov     edx, 5A82799Ah
  4316 00002D29 F7EA                                    imul    edx
  4317 00002D2B 895674                                  mov     [esi+116], edx
  4318 00002D2E 8B4678                                  mov     eax, [esi+120]
  4319 00002D31 8B567C                                  mov     edx, [esi+124]
  4320 00002D34 015678                                  add     [esi+120], edx
  4321 00002D37 29D0                                    sub     eax, edx
  4322 00002D39 D1E0                                    shl     eax, 1
  4323 00002D3B BA66867DA5                              mov     edx, 0A57D8666h
  4324 00002D40 F7EA                                    imul    edx
  4325 00002D42 89567C                                  mov     [esi+124], edx
  4326 00002D45 8B467C                                  mov     eax, [esi+124]
  4327 00002D48 014678                                  add     [esi+120], eax
  4328 00002D4B 8B4678                                  mov     eax, [esi+120]
  4329 00002D4E 014670                                  add     [esi+112], eax
  4330 00002D51 8B4674                                  mov     eax, [esi+116]
  4331 00002D54 014678                                  add     [esi+120], eax
  4332 00002D57 8B467C                                  mov     eax, [esi+124]
  4333 00002D5A 014674                                  add     [esi+116], eax
  4334 00002D5D 8B06                                    mov     eax, [esi]      ; @@OUT macro dst,src1,src2
  4335                                                                          ; IF ((dst AND ((1 SHL rate_shift)-1)) EQ 0)
  4336                                                                          ;    mov eax,dword ptr [esi+src1*4]
  4337                                                                          ;    IFDIFI <src2>,<->
  4338                                                                          ;      add eax,dword ptr [esi+src2*4]
  4339                                                                          ;    ENDIF
  4340                                                                          ;    IF SYNTH32
  4341                                                                          ;       mov dword ptr [edi+dst*4],eax
  4342                                                                          ;       IF (LONG_WINDOW EQ 0)
  4343                                                                          ;          mov dword ptr [edi+dst*4+512*4],eax
  4344                                                                          ;       ENDIF
  4345                                                                          ;    ELSE
  4346                                                                          ;        ......
  4347                                                                          ;    ENDIF
  4348                                                                          ; @@OUT 0,0,-
  4349 00002D5F 8907                                    mov     [edi], eax      ; mov dword ptr [edi+dst*4],eax
  4350 00002D61 8B4604                                  mov     eax, [esi+4]    ; @@OUT 16,1, -
  4351                                                                          ; mov eax,dword ptr [esi+src1*4]
  4352 00002D64 894740                                  mov     [edi+64], eax   ; mov dword ptr [edi+dst*4],eax
  4353 00002D67 8B4608                                  mov     eax, [esi+8]    ; @@OUT 8,2,-
  4354 00002D6A 894720                                  mov     [edi+32], eax
  4355 00002D6D 8B460C                                  mov     eax, [esi+12]   ; @@OUT 24,3,-
  4356 00002D70 894760                                  mov     [edi+96], eax
  4357 00002D73 8B4610                                  mov     eax, [esi+16]   ; @@OUT 4,4,-
  4358 00002D76 894710                                  mov     [edi+16], eax
  4359 00002D79 8B4614                                  mov     eax, [esi+20]   ; @@OUT 20,5,-
  4360 00002D7C 894750                                  mov     [edi+80], eax
  4361 00002D7F 8B4618                                  mov     eax, [esi+24]   ; @@OUT 12,6,-
  4362 00002D82 894730                                  mov     [edi+48], eax
  4363 00002D85 8B461C                                  mov     eax, [esi+28]   ; @@OUT 28,7,-
  4364 00002D88 894770                                  mov     [edi+112], eax
  4365 00002D8B 8B4620                                  mov     eax, [esi+32]   ; @@OUT 2,8,12
  4366 00002D8E 034630                                  add     eax, [esi+48]   ; add eax,dword ptr [esi+src2*4]
  4367 00002D91 894708                                  mov     [edi+8], eax
  4368 00002D94 8B4624                                  mov     eax, [esi+36]   ; @@OUT 18,9,13
  4369 00002D97 034634                                  add     eax, [esi+52]   ; add eax,dword ptr [esi+src2*4]
  4370 00002D9A 894748                                  mov     [edi+72], eax
  4371 00002D9D 8B4628                                  mov     eax, [esi+40]   ; @@OUT 10,10,14
  4372 00002DA0 034638                                  add     eax, [esi+56]
  4373 00002DA3 894728                                  mov     [edi+40], eax
  4374 00002DA6 8B462C                                  mov     eax, [esi+44]   ; @@OUT 26,11,15
  4375 00002DA9 03463C                                  add     eax, [esi+60]
  4376 00002DAC 894768                                  mov     [edi+104], eax
  4377 00002DAF 8B4630                                  mov     eax, [esi+48]   ; @@OUT 6,12,10
  4378 00002DB2 034628                                  add     eax, [esi+40]
  4379 00002DB5 894718                                  mov     [edi+24], eax
  4380 00002DB8 8B4634                                  mov     eax, [esi+52]   ; @@OUT 22,13,11
  4381 00002DBB 03462C                                  add     eax, [esi+44]
  4382 00002DBE 894758                                  mov     [edi+88], eax
  4383 00002DC1 8B4638                                  mov     eax, [esi+56]   ; @@OUT 14,14,9
  4384 00002DC4 034624                                  add     eax, [esi+36]
  4385 00002DC7 894738                                  mov     [edi+56], eax
  4386 00002DCA 8B463C                                  mov     eax, [esi+60]   ; @@OUT 30,15,-
  4387 00002DCD 894778                                  mov     [edi+120], eax
  4388 00002DD0 8B4670                                  mov     eax, [esi+112]  ; @@ADD 24,28
  4389 00002DD3 014660                                  add     [esi+96], eax
  4390 00002DD6 8B4668                                  mov     eax, [esi+104]  ; @@ADD 28,26
  4391 00002DD9 014670                                  add     [esi+112], eax
  4392 00002DDC 8B4678                                  mov     eax, [esi+120]  ; @@ADD 26,30
  4393 00002DDF 014668                                  add     [esi+104], eax
  4394 00002DE2 8B4664                                  mov     eax, [esi+100]  ; @@ADD 30,25
  4395 00002DE5 014678                                  add     [esi+120], eax
  4396 00002DE8 8B4674                                  mov     eax, [esi+116]  ; @@ADD 25,29
  4397 00002DEB 014664                                  add     [esi+100], eax
  4398 00002DEE 8B466C                                  mov     eax, [esi+108]  ; @@ADD 29,27
  4399 00002DF1 014674                                  add     [esi+116], eax
  4400 00002DF4 8B467C                                  mov     eax, [esi+124]  ; @@ADD 27,31
  4401 00002DF7 01466C                                  add     [esi+108], eax
  4402 00002DFA 8B4640                                  mov     eax, [esi+64]   ; @@OUT 1,16,24
  4403 00002DFD 034660                                  add     eax, [esi+96]
  4404 00002E00 894704                                  mov     [edi+4], eax
  4405 00002E03 8B4644                                  mov     eax, [esi+68]   ; @@OUT 17,17,25
  4406 00002E06 034664                                  add     eax, [esi+100]
  4407 00002E09 894744                                  mov     [edi+68], eax
  4408 00002E0C 8B4648                                  mov     eax, [esi+72]   ; @@OUT 9,18,26
  4409 00002E0F 034668                                  add     eax, [esi+104]
  4410 00002E12 894724                                  mov     [edi+36], eax
  4411 00002E15 8B464C                                  mov     eax, [esi+76]   ; @@OUT 25,19,27
  4412 00002E18 03466C                                  add     eax, [esi+108]
  4413 00002E1B 894764                                  mov     [edi+100], eax
  4414 00002E1E 8B4650                                  mov     eax, [esi+80]   ; @@OUT 5,20,28
  4415 00002E21 034670                                  add     eax, [esi+112]
  4416 00002E24 894714                                  mov     [edi+20], eax
  4417 00002E27 8B4654                                  mov     eax, [esi+84]   ; @@OUT 21,21,29
  4418 00002E2A 034674                                  add     eax, [esi+116]
  4419 00002E2D 894754                                  mov     [edi+84], eax
  4420 00002E30 8B4658                                  mov     eax, [esi+88]   ; @@OUT 13,22,30
  4421 00002E33 034678                                  add     eax, [esi+120]
  4422 00002E36 894734                                  mov     [edi+52], eax
  4423 00002E39 8B465C                                  mov     eax, [esi+92]   ; @@OUT 29,23,31
  4424 00002E3C 03467C                                  add     eax, [esi+124]
  4425 00002E3F 894774                                  mov     [edi+116], eax
  4426 00002E42 8B4660                                  mov     eax, [esi+96]   ; @@OUT 3,24,20
  4427 00002E45 034650                                  add     eax, [esi+80]
  4428 00002E48 89470C                                  mov     [edi+12], eax
  4429 00002E4B 8B4664                                  mov     eax, [esi+100]  ; @@OUT 19,25,21
  4430 00002E4E 034654                                  add     eax, [esi+84]
  4431 00002E51 89474C                                  mov     [edi+76], eax
  4432 00002E54 8B4668                                  mov     eax, [esi+104]  ; @@OUT 11,26,22
  4433 00002E57 034658                                  add     eax, [esi+88]
  4434 00002E5A 89472C                                  mov     [edi+44], eax
  4435 00002E5D 8B466C                                  mov     eax, [esi+108]  ; @@OUT 27,27,23
  4436 00002E60 03465C                                  add     eax, [esi+92]
  4437 00002E63 89476C                                  mov     [edi+108], eax
  4438 00002E66 8B4670                                  mov     eax, [esi+112]  ; @@OUT 7,28,18
  4439 00002E69 034648                                  add     eax, [esi+72]
  4440 00002E6C 89471C                                  mov     [edi+28], eax
  4441 00002E6F 8B4674                                  mov     eax, [esi+116]  ; @@OUT 23,29,19
  4442 00002E72 03464C                                  add     eax, [esi+76]
  4443 00002E75 89475C                                  mov     [edi+92], eax
  4444 00002E78 8B4678                                  mov     eax, [esi+120]  ; @@OUT 15,30,17
  4445 00002E7B 034644                                  add     eax, [esi+68]
  4446 00002E7E 89473C                                  mov     [edi+60], eax
  4447 00002E81 8B467C                                  mov     eax, [esi+124]  ; @@OUT 31,31,-
  4448 00002E84 89477C                                  mov     [edi+124], eax
  4449 00002E87 C3                                      retn
  4450                                  
  4451                                  
  4452                                  ; =============== S U B R O U T I N E =======================================
  4453                                  
  4454                                  
  4455                                  mp3_dct32_shift_1:
  4456 00002E88 8B467C                                  mov     eax, [esi+124]  ; mp3_dct32_macro macro rate_shift ; rate_shift = 1
  4457 00002E8B 0106                                    add     [esi], eax      ; @@BF macro a,b,sign,cos,shift
  4458                                                                          ; @@need_a equ (rate_shift EQ 0) or (a LT 16) ; a = 0
  4459                                                                          ; @@need_b equ (rate_shift EQ 0) or (b LT 16) ; b = 31
  4460                                                                          ; IF @@need_a AND @@need_b ; rate_shift = 0
  4461                                                                          ;    mov eax,dword ptr [esi+a*4]
  4462                                                                          ;    mov edx,dword ptr [esi+b*4]
  4463                                                                          ;    add dword ptr [esi+a*4],edx
  4464                                                                          ; ELSEIF @@need_a
  4465                                                                          ;    mov eax,dword ptr [esi+b*4]
  4466                                                                          ;    add dword ptr [esi+a*4],eax
  4467                                                                          ;
  4468                                                                          ; @@BF 0,31,+,COS0_0,1
  4469 00002E8D 8B4640                                  mov     eax, [esi+64]   ; @@BF 15,16,+,COS0_15,5
  4470 00002E90 01463C                                  add     [esi+60], eax
  4471 00002E93 8B06                                    mov     eax, [esi]      ; @@BF 0,15,+,COS1_0,1
  4472 00002E95 8B563C                                  mov     edx, [esi+60]
  4473 00002E98 0116                                    add     [esi], edx
  4474 00002E9A 29D0                                    sub     eax, edx
  4475 00002E9C D1E0                                    shl     eax, 1
  4476 00002E9E BA72464F40                              mov     edx, 404F4672h  ; COS1_0
  4477 00002EA3 F7EA                                    imul    edx
  4478 00002EA5 89563C                                  mov     [esi+60], edx
  4479 00002EA8 8B4660                                  mov     eax, [esi+96]   ; skip @@BF 16,31,-,COS1_0,1
  4480                                                                          ; @@BF 7,24,+,COS0_7,1
  4481 00002EAB 01461C                                  add     [esi+28], eax
  4482 00002EAE 8B465C                                  mov     eax, [esi+92]   ; @@BF 8,23,+,COS0_8,1
  4483 00002EB1 014620                                  add     [esi+32], eax
  4484 00002EB4 8B461C                                  mov     eax, [esi+28]   ; @@BF 7,8,+,COS1_7,4
  4485 00002EB7 8B5620                                  mov     edx, [esi+32]
  4486 00002EBA 01561C                                  add     [esi+28], edx
  4487 00002EBD 29D0                                    sub     eax, edx
  4488 00002EBF C1E004                                  shl     eax, 4
  4489 00002EC2 BA044E9E51                              mov     edx, 519E4E04h  ; COS1_7
  4490 00002EC7 F7EA                                    imul    edx
  4491 00002EC9 895620                                  mov     [esi+32], edx
  4492 00002ECC 8B06                                    mov     eax, [esi]      ; skip @@BF 23,24,-,COS1_7,4
  4493                                                                          ; @@BF 0,7,+,COS2_0,1
  4494 00002ECE 8B561C                                  mov     edx, [esi+28]
  4495 00002ED1 0116                                    add     [esi], edx
  4496 00002ED3 29D0                                    sub     eax, edx
  4497 00002ED5 D1E0                                    shl     eax, 1
  4498 00002ED7 BA46FB4041                              mov     edx, 4140FB46h  ; COS2_0
  4499 00002EDC F7EA                                    imul    edx
  4500 00002EDE 89561C                                  mov     [esi+28], edx
  4501 00002EE1 8B4620                                  mov     eax, [esi+32]   ; @@BF 8,15,-,COS2_0,1
  4502 00002EE4 8B563C                                  mov     edx, [esi+60]
  4503 00002EE7 015620                                  add     [esi+32], edx
  4504 00002EEA 29D0                                    sub     eax, edx
  4505 00002EEC D1E0                                    shl     eax, 1
  4506 00002EEE BABA04BFBE                              mov     edx, 0BEBF04BAh ; -COS2_0
  4507 00002EF3 F7EA                                    imul    edx
  4508 00002EF5 89563C                                  mov     [esi+60], edx
  4509 00002EF8 8B4670                                  mov     eax, [esi+112]  ; skip @@BF 16,23,+,COS2_0,1
  4510                                                                          ;      @@BF 24,31,-,COS2_0,1
  4511                                                                          ; @@BF 3,28,+,COS0_3,1
  4512 00002EFB 01460C                                  add     [esi+12], eax
  4513 00002EFE 8B464C                                  mov     eax, [esi+76]   ; @@BF 12,19,+,COS0_12,2
  4514 00002F01 014630                                  add     [esi+48], eax
  4515 00002F04 8B460C                                  mov     eax, [esi+12]   ; @@BF 3,12,+,COS1_3,1
  4516 00002F07 8B5630                                  mov     edx, [esi+48]
  4517 00002F0A 01560C                                  add     [esi+12], edx
  4518 00002F0D 29D0                                    sub     eax, edx
  4519 00002F0F D1E0                                    shl     eax, 1
  4520 00002F11 BA630ECB52                              mov     edx, 52CB0E63h
  4521 00002F16 F7EA                                    imul    edx
  4522 00002F18 895630                                  mov     [esi+48], edx
  4523 00002F1B 8B466C                                  mov     eax, [esi+108]  ; @@BF 4,27,+,COS0_4,1
  4524 00002F1E 014610                                  add     [esi+16], eax
  4525 00002F21 8B4650                                  mov     eax, [esi+80]   ; @@BF 11,20,+,COS0_11,2
  4526 00002F24 01462C                                  add     [esi+44], eax
  4527 00002F27 8B4610                                  mov     eax, [esi+16]   ; @@BF 4,11,+,COS1_4,1
  4528 00002F2A 8B562C                                  mov     edx, [esi+44]
  4529 00002F2D 015610                                  add     [esi+16], edx
  4530 00002F30 29D0                                    sub     eax, edx
  4531 00002F32 D1E0                                    shl     eax, 1
  4532 00002F34 BA2E40E264                              mov     edx, 64E2402Eh  ; COS1_4
  4533 00002F39 F7EA                                    imul    edx
  4534 00002F3B 89562C                                  mov     [esi+44], edx
  4535 00002F3E 8B460C                                  mov     eax, [esi+12]   ; @@BF 3,4,+,COS2_3,3
  4536 00002F41 8B5610                                  mov     edx, [esi+16]
  4537 00002F44 01560C                                  add     [esi+12], edx
  4538 00002F47 29D0                                    sub     eax, edx
  4539 00002F49 C1E003                                  shl     eax, 3
  4540 00002F4C BA42670352                              mov     edx, 52036742h
  4541 00002F51 F7EA                                    imul    edx
  4542 00002F53 895610                                  mov     [esi+16], edx
  4543 00002F56 8B462C                                  mov     eax, [esi+44]   ; @@BF 11,12,-,COS2_3,3
  4544 00002F59 8B5630                                  mov     edx, [esi+48]
  4545 00002F5C 01562C                                  add     [esi+44], edx
  4546 00002F5F 29D0                                    sub     eax, edx
  4547 00002F61 C1E003                                  shl     eax, 3
  4548 00002F64 BABE98FCAD                              mov     edx, 0ADFC98BEh ; -COS2_3
  4549 00002F69 F7EA                                    imul    edx
  4550 00002F6B 895630                                  mov     [esi+48], edx
  4551 00002F6E 8B06                                    mov     eax, [esi]      ; @@BF 0,3,+,COS3_0,1
  4552 00002F70 8B560C                                  mov     edx, [esi+12]
  4553 00002F73 0116                                    add     [esi], edx
  4554 00002F75 29D0                                    sub     eax, edx
  4555 00002F77 D1E0                                    shl     eax, 1
  4556 00002F79 BAF0E94545                              mov     edx, 4545E9F0h
  4557 00002F7E F7EA                                    imul    edx
  4558 00002F80 89560C                                  mov     [esi+12], edx
  4559 00002F83 8B4610                                  mov     eax, [esi+16]   ; @@BF 4,7,-,COS3_0,1
  4560 00002F86 8B561C                                  mov     edx, [esi+28]
  4561 00002F89 015610                                  add     [esi+16], edx
  4562 00002F8C 29D0                                    sub     eax, edx
  4563 00002F8E D1E0                                    shl     eax, 1
  4564 00002F90 BA1016BABA                              mov     edx, 0BABA1610h
  4565 00002F95 F7EA                                    imul    edx
  4566 00002F97 89561C                                  mov     [esi+28], edx
  4567 00002F9A 8B4620                                  mov     eax, [esi+32]   ; @@BF 8,11,+,COS3_0,1
  4568 00002F9D 8B562C                                  mov     edx, [esi+44]
  4569 00002FA0 015620                                  add     [esi+32], edx
  4570 00002FA3 29D0                                    sub     eax, edx
  4571 00002FA5 D1E0                                    shl     eax, 1
  4572 00002FA7 BAF0E94545                              mov     edx, 4545E9F0h
  4573 00002FAC F7EA                                    imul    edx
  4574 00002FAE 89562C                                  mov     [esi+44], edx
  4575 00002FB1 8B4630                                  mov     eax, [esi+48]   ; @@BF 12,15,-,COS3_0,1
  4576 00002FB4 8B563C                                  mov     edx, [esi+60]
  4577 00002FB7 015630                                  add     [esi+48], edx
  4578 00002FBA 29D0                                    sub     eax, edx
  4579 00002FBC D1E0                                    shl     eax, 1
  4580 00002FBE BA1016BABA                              mov     edx, 0BABA1610h ; -COS3_0
  4581 00002FC3 F7EA                                    imul    edx
  4582 00002FC5 89563C                                  mov     [esi+60], edx
  4583 00002FC8 8B4678                                  mov     eax, [esi+120]  ; @@BF 1,30,+,COS0_1,1
  4584 00002FCB 014604                                  add     [esi+4], eax
  4585 00002FCE 8B4644                                  mov     eax, [esi+68]   ; @@BF 14,17,+,COS0_14,3
  4586 00002FD1 014638                                  add     [esi+56], eax
  4587 00002FD4 8B4604                                  mov     eax, [esi+4]    ; @@BF 1,14,+,COS1_1,1
  4588 00002FD7 8B5638                                  mov     edx, [esi+56]
  4589 00002FDA 015604                                  add     [esi+4], edx
  4590 00002FDD 29D0                                    sub     eax, edx
  4591 00002FDF D1E0                                    shl     eax, 1
  4592 00002FE1 BA103CE142                              mov     edx, 42E13C10h
  4593 00002FE6 F7EA                                    imul    edx
  4594 00002FE8 895638                                  mov     [esi+56], edx
  4595 00002FEB 8B4664                                  mov     eax, [esi+100]  ; @@BF 6,25,+,COS0_6,1
  4596 00002FEE 014618                                  add     [esi+24], eax
  4597 00002FF1 8B4658                                  mov     eax, [esi+88]   ; @@BF 9,22,+,COS0_9,1
  4598 00002FF4 014624                                  add     [esi+36], eax
  4599 00002FF7 8B4618                                  mov     eax, [esi+24]   ; @@BF 6,9,+,COS1_6,2
  4600 00002FFA 8B5624                                  mov     edx, [esi+36]
  4601 00002FFD 015618                                  add     [esi+24], edx
  4602 00003000 29D0                                    sub     eax, edx
  4603 00003002 C1E002                                  shl     eax, 2
  4604 00003005 BAC2923C6E                              mov     edx, 6E3C92C2h  ; +COS1_6
  4605 0000300A F7EA                                    imul    edx
  4606 0000300C 895624                                  mov     [esi+36], edx
  4607 0000300F 8B4604                                  mov     eax, [esi+4]    ; @@BF 1,6,+,COS2_1,1
  4608 00003012 8B5618                                  mov     edx, [esi+24]
  4609 00003015 015604                                  add     [esi+4], edx
  4610 00003018 29D0                                    sub     eax, edx
  4611 0000301A D1E0                                    shl     eax, 1
  4612 0000301C BA88DEF84C                              mov     edx, 4CF8DE88h
  4613 00003021 F7EA                                    imul    edx
  4614 00003023 895618                                  mov     [esi+24], edx
  4615 00003026 8B4624                                  mov     eax, [esi+36]   ; @@BF 9,14,-,COS2_1,1
  4616 00003029 8B5638                                  mov     edx, [esi+56]
  4617 0000302C 015624                                  add     [esi+36], edx
  4618 0000302F 29D0                                    sub     eax, edx
  4619 00003031 D1E0                                    shl     eax, 1
  4620 00003033 BA782107B3                              mov     edx, 0B3072178h ; -COS2_1
  4621 00003038 F7EA                                    imul    edx
  4622 0000303A 895638                                  mov     [esi+56], edx
  4623 0000303D 8B4674                                  mov     eax, [esi+116]  ; @@BF 2,29,+,COS0_2,1
  4624 00003040 014608                                  add     [esi+8], eax
  4625 00003043 8B4648                                  mov     eax, [esi+72]   ; @@BF 13,18,+,COS0_13,3
  4626 00003046 014634                                  add     [esi+52], eax
  4627 00003049 8B4608                                  mov     eax, [esi+8]    ; @@BF 2,13,+,COS1_2,1
  4628 0000304C 8B5634                                  mov     edx, [esi+52]
  4629 0000304F 015608                                  add     [esi+8], edx
  4630 00003052 29D0                                    sub     eax, edx
  4631 00003054 D1E0                                    shl     eax, 1
  4632 00003056 BA459F9148                              mov     edx, 48919F45h
  4633 0000305B F7EA                                    imul    edx
  4634 0000305D 895634                                  mov     [esi+52], edx
  4635 00003060 8B4668                                  mov     eax, [esi+104]  ; @@BF 5,26,+,COS0_5,1
  4636 00003063 014614                                  add     [esi+20], eax
  4637 00003066 8B4654                                  mov     eax, [esi+84]   ; @@BF 10,21,+,COS0_10,1
  4638 00003069 014628                                  add     [esi+40], eax
  4639 0000306C 8B4614                                  mov     eax, [esi+20]   ; @@BF 5,10,+,COS1_5,2
  4640 0000306F 8B5628                                  mov     edx, [esi+40]
  4641 00003072 015614                                  add     [esi+20], edx
  4642 00003075 29D0                                    sub     eax, edx
  4643 00003077 C1E002                                  shl     eax, 2
  4644 0000307A BAAA24E243                              mov     edx, 43E224AAh
  4645 0000307F F7EA                                    imul    edx
  4646 00003081 895628                                  mov     [esi+40], edx
  4647 00003084 8B4608                                  mov     eax, [esi+8]    ; @@BF 2,5,+,COS2_2,1
  4648 00003087 8B5614                                  mov     edx, [esi+20]
  4649 0000308A 015608                                  add     [esi+8], edx
  4650 0000308D 29D0                                    sub     eax, edx
  4651 0000308F D1E0                                    shl     eax, 1
  4652 00003091 BABF6B3273                              mov     edx, 73326BBFh  ; COS2_2
  4653 00003096 F7EA                                    imul    edx
  4654 00003098 895614                                  mov     [esi+20], edx
  4655 0000309B 8B4628                                  mov     eax, [esi+40]   ; @@BF 10,13,-,COS2_2,1
  4656 0000309E 8B5634                                  mov     edx, [esi+52]
  4657 000030A1 015628                                  add     [esi+40], edx
  4658 000030A4 29D0                                    sub     eax, edx
  4659 000030A6 D1E0                                    shl     eax, 1
  4660 000030A8 BA4194CD8C                              mov     edx, 8CCD9441h  ; -COS2_2
  4661 000030AD F7EA                                    imul    edx
  4662 000030AF 895634                                  mov     [esi+52], edx
  4663 000030B2 8B4604                                  mov     eax, [esi+4]    ; @@BF 1,2,+,COS3_1,2
  4664 000030B5 8B5608                                  mov     edx, [esi+8]
  4665 000030B8 015604                                  add     [esi+4], edx
  4666 000030BB 29D0                                    sub     eax, edx
  4667 000030BD C1E002                                  shl     eax, 2
  4668 000030C0 BA46BA9E53                              mov     edx, 539EBA46h
  4669 000030C5 F7EA                                    imul    edx
  4670 000030C7 895608                                  mov     [esi+8], edx
  4671 000030CA 8B4614                                  mov     eax, [esi+20]   ; @@BF 5,6,-,COS3_1,2
  4672 000030CD 8B5618                                  mov     edx, [esi+24]
  4673 000030D0 015614                                  add     [esi+20], edx
  4674 000030D3 29D0                                    sub     eax, edx
  4675 000030D5 C1E002                                  shl     eax, 2
  4676 000030D8 BABA4561AC                              mov     edx, 0AC6145BAh
  4677 000030DD F7EA                                    imul    edx
  4678 000030DF 895618                                  mov     [esi+24], edx
  4679 000030E2 8B4624                                  mov     eax, [esi+36]   ; IF rate_shift LT 2
  4680                                                                          ; @@BF 9,10,+,COS3_1,2
  4681 000030E5 8B5628                                  mov     edx, [esi+40]
  4682 000030E8 015624                                  add     [esi+36], edx
  4683 000030EB 29D0                                    sub     eax, edx
  4684 000030ED C1E002                                  shl     eax, 2
  4685 000030F0 BA46BA9E53                              mov     edx, 539EBA46h  ; +COS3_1
  4686 000030F5 F7EA                                    imul    edx
  4687 000030F7 895628                                  mov     [esi+40], edx
  4688 000030FA 8B4634                                  mov     eax, [esi+52]   ; @@BF 13,14,-,COS3_1,2
  4689 000030FD 8B5638                                  mov     edx, [esi+56]
  4690 00003100 015634                                  add     [esi+52], edx
  4691 00003103 29D0                                    sub     eax, edx
  4692 00003105 C1E002                                  shl     eax, 2
  4693 00003108 BABA4561AC                              mov     edx, 0AC6145BAh ; -COS3_1
  4694 0000310D F7EA                                    imul    edx
  4695 0000310F 895638                                  mov     [esi+56], edx   ; ENDIF
  4696 00003112 8B06                                    mov     eax, [esi]      ; @@BF1 macro a, b, c, d
  4697                                                                          ;   @@BF  a, b,+,COS4_0, 1
  4698                                                                          ;   @@BF  c, d,-,COS4_0, 1
  4699                                                                          ;   @@ADD c, d
  4700                                                                          ;  endm
  4701                                                                          ; @@BF1 0,1,2,3
  4702 00003114 8B5604                                  mov     edx, [esi+4]    ; @@BF 0,1,+,COS4_0,1
  4703 00003117 0116                                    add     [esi], edx
  4704 00003119 29D0                                    sub     eax, edx
  4705 0000311B D1E0                                    shl     eax, 1
  4706 0000311D BA9A79825A                              mov     edx, 5A82799Ah
  4707 00003122 F7EA                                    imul    edx
  4708 00003124 895604                                  mov     [esi+4], edx
  4709 00003127 8B4608                                  mov     eax, [esi+8]    ; @@BF 2,3,+,COS4_0,1
  4710 0000312A 8B560C                                  mov     edx, [esi+12]
  4711 0000312D 015608                                  add     [esi+8], edx
  4712 00003130 29D0                                    sub     eax, edx
  4713 00003132 D1E0                                    shl     eax, 1
  4714 00003134 BA66867DA5                              mov     edx, 0A57D8666h
  4715 00003139 F7EA                                    imul    edx
  4716 0000313B 89560C                                  mov     [esi+12], edx
  4717 0000313E 8B460C                                  mov     eax, [esi+12]   ; @@ADD 2,3
  4718 00003141 014608                                  add     [esi+8], eax
  4719 00003144 8B4610                                  mov     eax, [esi+16]   ; @@BF2 macro a, b, c, d
  4720                                                                          ;   @@BF  a, b,+,COS4_0, 1
  4721                                                                          ;   @@BF  c, d,-,COS4_0, 1
  4722                                                                          ;   @@ADD c, d
  4723                                                                          ;   @@ADD a, c
  4724                                                                          ;   @@ADD c, b
  4725                                                                          ;   @@ADD b, d
  4726                                                                          ;  endm
  4727                                                                          ; @@BF2 4,5,6,7
  4728 00003147 8B5614                                  mov     edx, [esi+20]   ; @@BF 4,5,+,COS4_0,1
  4729 0000314A 015610                                  add     [esi+16], edx
  4730 0000314D 29D0                                    sub     eax, edx
  4731 0000314F D1E0                                    shl     eax, 1
  4732 00003151 BA9A79825A                              mov     edx, 5A82799Ah  ; +COS4_0
  4733 00003156 F7EA                                    imul    edx
  4734 00003158 895614                                  mov     [esi+20], edx
  4735 0000315B 8B4618                                  mov     eax, [esi+24]   ; @@BF 6,7,-,COS4_0,1
  4736 0000315E 8B561C                                  mov     edx, [esi+28]
  4737 00003161 015618                                  add     [esi+24], edx
  4738 00003164 29D0                                    sub     eax, edx
  4739 00003166 D1E0                                    shl     eax, 1
  4740 00003168 BA66867DA5                              mov     edx, 0A57D8666h ; -COS4_0
  4741 0000316D F7EA                                    imul    edx
  4742 0000316F 89561C                                  mov     [esi+28], edx
  4743 00003172 8B461C                                  mov     eax, [esi+28]   ; @@ADD macro dst,src
  4744                                                                          ;   IF (rate_shift EQ 0) or (dst LT 16)
  4745                                                                          ;    ;tab[a] += tab[b]
  4746                                                                          ;    mov  eax,dword ptr [esi+src*4]
  4747                                                                          ;    add  dword ptr [esi+dst*4],eax
  4748                                                                          ;   ENDIF
  4749                                                                          ;  endm
  4750                                                                          ; @@ADD 6,7
  4751 00003175 014618                                  add     [esi+24], eax
  4752 00003178 8B4618                                  mov     eax, [esi+24]   ; @@ADD 4,6
  4753 0000317B 014610                                  add     [esi+16], eax
  4754 0000317E 8B4614                                  mov     eax, [esi+20]   ; @@ADD 6,5
  4755 00003181 014618                                  add     [esi+24], eax
  4756 00003184 8B461C                                  mov     eax, [esi+28]   ; @@ADD 5,7
  4757 00003187 014614                                  add     [esi+20], eax
  4758 0000318A 8B4620                                  mov     eax, [esi+32]   ; IF rate_shift LT 2
  4759                                                                          ; @@BF1 8,9,10,11
  4760 0000318D 8B5624                                  mov     edx, [esi+36]
  4761 00003190 015620                                  add     [esi+32], edx
  4762 00003193 29D0                                    sub     eax, edx
  4763 00003195 D1E0                                    shl     eax, 1
  4764 00003197 BA9A79825A                              mov     edx, 5A82799Ah
  4765 0000319C F7EA                                    imul    edx
  4766 0000319E 895624                                  mov     [esi+36], edx
  4767 000031A1 8B4628                                  mov     eax, [esi+40]
  4768 000031A4 8B562C                                  mov     edx, [esi+44]
  4769 000031A7 015628                                  add     [esi+40], edx
  4770 000031AA 29D0                                    sub     eax, edx
  4771 000031AC D1E0                                    shl     eax, 1
  4772 000031AE BA66867DA5                              mov     edx, 0A57D8666h
  4773 000031B3 F7EA                                    imul    edx
  4774 000031B5 89562C                                  mov     [esi+44], edx
  4775 000031B8 8B462C                                  mov     eax, [esi+44]
  4776 000031BB 014628                                  add     [esi+40], eax
  4777 000031BE 8B4630                                  mov     eax, [esi+48]   ; @@BF2 12,13,14,15
  4778 000031C1 8B5634                                  mov     edx, [esi+52]
  4779 000031C4 015630                                  add     [esi+48], edx
  4780 000031C7 29D0                                    sub     eax, edx
  4781 000031C9 D1E0                                    shl     eax, 1
  4782 000031CB BA9A79825A                              mov     edx, 5A82799Ah
  4783 000031D0 F7EA                                    imul    edx
  4784 000031D2 895634                                  mov     [esi+52], edx
  4785 000031D5 8B4638                                  mov     eax, [esi+56]
  4786 000031D8 8B563C                                  mov     edx, [esi+60]
  4787 000031DB 015638                                  add     [esi+56], edx
  4788 000031DE 29D0                                    sub     eax, edx
  4789 000031E0 D1E0                                    shl     eax, 1
  4790 000031E2 BA66867DA5                              mov     edx, 0A57D8666h
  4791 000031E7 F7EA                                    imul    edx
  4792 000031E9 89563C                                  mov     [esi+60], edx
  4793 000031EC 8B463C                                  mov     eax, [esi+60]
  4794 000031EF 014638                                  add     [esi+56], eax
  4795 000031F2 8B4638                                  mov     eax, [esi+56]
  4796 000031F5 014630                                  add     [esi+48], eax
  4797 000031F8 8B4634                                  mov     eax, [esi+52]
  4798 000031FB 014638                                  add     [esi+56], eax
  4799 000031FE 8B463C                                  mov     eax, [esi+60]
  4800 00003201 014634                                  add     [esi+52], eax
  4801 00003204 8B06                                    mov     eax, [esi]      ; @@OUT macro dst,src1,src2
  4802                                                                          ; IF ((dst AND ((1 SHL rate_shift)-1)) EQ 0)
  4803                                                                          ;    mov eax,dword ptr [esi+src1*4]
  4804                                                                          ;    IFDIFI <src2>,<->
  4805                                                                          ;      add eax,dword ptr [esi+src2*4]
  4806                                                                          ;    ENDIF
  4807                                                                          ;    IF SYNTH32
  4808                                                                          ;       mov dword ptr [edi+dst*4],eax
  4809                                                                          ;       IF (LONG_WINDOW EQ 0)
  4810                                                                          ;          mov dword ptr [edi+dst*4+512*4],eax
  4811                                                                          ;       ENDIF
  4812                                                                          ;    ELSE
  4813                                                                          ;        ......
  4814                                                                          ;    ENDIF
  4815                                                                          ; @@OUT 0,0,-
  4816 00003206 8907                                    mov     [edi], eax
  4817 00003208 8B4604                                  mov     eax, [esi+4]    ; @@OUT 16,1,-
  4818 0000320B 894740                                  mov     [edi+64], eax
  4819 0000320E 8B4608                                  mov     eax, [esi+8]    ; @@OUT 8,2,-
  4820 00003211 894720                                  mov     [edi+32], eax
  4821 00003214 8B460C                                  mov     eax, [esi+12]   ; @@OUT 24,3,-
  4822 00003217 894760                                  mov     [edi+96], eax
  4823 0000321A 8B4610                                  mov     eax, [esi+16]   ; @@OUT 4,4,-
  4824 0000321D 894710                                  mov     [edi+16], eax
  4825 00003220 8B4614                                  mov     eax, [esi+20]   ; @@OUT 20,5,-
  4826 00003223 894750                                  mov     [edi+80], eax
  4827 00003226 8B4618                                  mov     eax, [esi+24]   ; @@OUT 12,6,-
  4828 00003229 894730                                  mov     [edi+48], eax
  4829 0000322C 8B461C                                  mov     eax, [esi+28]   ; @@OUT 28,7,-
  4830 0000322F 894770                                  mov     [edi+112], eax
  4831 00003232 8B4620                                  mov     eax, [esi+32]   ; @@OUT 2,8,12
  4832 00003235 034630                                  add     eax, [esi+48]
  4833 00003238 894708                                  mov     [edi+8], eax
  4834 0000323B 8B4624                                  mov     eax, [esi+36]   ; @@OUT 18,9,13
  4835 0000323E 034634                                  add     eax, [esi+52]
  4836 00003241 894748                                  mov     [edi+72], eax
  4837 00003244 8B4628                                  mov     eax, [esi+40]   ; @@OUT 10,10,14
  4838 00003247 034638                                  add     eax, [esi+56]
  4839 0000324A 894728                                  mov     [edi+40], eax
  4840 0000324D 8B462C                                  mov     eax, [esi+44]   ; @@OUT 26,11,15
  4841 00003250 03463C                                  add     eax, [esi+60]
  4842 00003253 894768                                  mov     [edi+104], eax
  4843 00003256 8B4630                                  mov     eax, [esi+48]   ; @@OUT 6,12,10
  4844 00003259 034628                                  add     eax, [esi+40]
  4845 0000325C 894718                                  mov     [edi+24], eax
  4846 0000325F 8B4634                                  mov     eax, [esi+52]   ; @@OUT 22,13,11
  4847 00003262 03462C                                  add     eax, [esi+44]
  4848 00003265 894758                                  mov     [edi+88], eax
  4849 00003268 8B4638                                  mov     eax, [esi+56]   ; @@OUT 14,14,9
  4850 0000326B 034624                                  add     eax, [esi+36]
  4851 0000326E 894738                                  mov     [edi+56], eax
  4852 00003271 8B463C                                  mov     eax, [esi+60]   ; @@OUT 30,15,-
  4853 00003274 894778                                  mov     [edi+120], eax
  4854 00003277 C3                                      retn
  4855                                  
  4856                                  
  4857                                  ; =============== S U B R O U T I N E =======================================
  4858                                  
  4859                                  
  4860                                  mp3_dct32_shift_2:
  4861 00003278 8B467C                                  mov     eax, [esi+124]  ; mp3_dct32_macro macro rate_shift ; rate_shift = 2
  4862 0000327B 0106                                    add     [esi], eax      ; @@BF macro a,b,sign,cos,shift
  4863                                                                          ; @@need_a equ (rate_shift EQ 0) or (a LT 16) ; a = 0
  4864                                                                          ; @@need_b equ (rate_shift EQ 0) or (b LT 16) ; b = 31
  4865                                                                          ; IF @@need_a AND @@need_b ; rate_shift = 0
  4866                                                                          ;    mov eax,dword ptr [esi+a*4]
  4867                                                                          ;    mov edx,dword ptr [esi+b*4]
  4868                                                                          ;    add dword ptr [esi+a*4],edx
  4869                                                                          ; ELSEIF @@need_a
  4870                                                                          ;    mov eax,dword ptr [esi+b*4]
  4871                                                                          ;    add dword ptr [esi+a*4],eax
  4872                                                                          ;
  4873                                                                          ; @@BF 0,31,+,COS0_0,1
  4874 0000327D 8B4640                                  mov     eax, [esi+64]   ; @@BF 15,16,+,COS0_15,5
  4875 00003280 01463C                                  add     [esi+60], eax
  4876 00003283 8B06                                    mov     eax, [esi]      ; @@BF 0,15,+,COS1_0,1
  4877 00003285 8B563C                                  mov     edx, [esi+60]
  4878 00003288 0116                                    add     [esi], edx
  4879 0000328A 29D0                                    sub     eax, edx
  4880 0000328C D1E0                                    shl     eax, 1
  4881 0000328E BA72464F40                              mov     edx, 404F4672h  ; COS1_0
  4882 00003293 F7EA                                    imul    edx
  4883 00003295 89563C                                  mov     [esi+60], edx
  4884 00003298 8B4660                                  mov     eax, [esi+96]   ; @@BF 7,24,+,COS0_7,1
  4885 0000329B 01461C                                  add     [esi+28], eax
  4886 0000329E 8B465C                                  mov     eax, [esi+92]   ; @@BF 8,23,+,COS0_8,1
  4887 000032A1 014620                                  add     [esi+32], eax
  4888 000032A4 8B461C                                  mov     eax, [esi+28]   ; @@BF 7,8,+,COS1_7,4
  4889 000032A7 8B5620                                  mov     edx, [esi+32]
  4890 000032AA 01561C                                  add     [esi+28], edx
  4891 000032AD 29D0                                    sub     eax, edx
  4892 000032AF C1E004                                  shl     eax, 4
  4893 000032B2 BA044E9E51                              mov     edx, 519E4E04h  ; COS1_7
  4894 000032B7 F7EA                                    imul    edx
  4895 000032B9 895620                                  mov     [esi+32], edx
  4896 000032BC 8B06                                    mov     eax, [esi]      ; @@BF 0,7,+,COS2_0,1
  4897 000032BE 8B561C                                  mov     edx, [esi+28]
  4898 000032C1 0116                                    add     [esi], edx
  4899 000032C3 29D0                                    sub     eax, edx
  4900 000032C5 D1E0                                    shl     eax, 1
  4901 000032C7 BA46FB4041                              mov     edx, 4140FB46h  ; COS2_0
  4902 000032CC F7EA                                    imul    edx
  4903 000032CE 89561C                                  mov     [esi+28], edx
  4904 000032D1 8B4620                                  mov     eax, [esi+32]   ; @@BF 8,15,-,COS2_0,1
  4905 000032D4 8B563C                                  mov     edx, [esi+60]
  4906 000032D7 015620                                  add     [esi+32], edx
  4907 000032DA 29D0                                    sub     eax, edx
  4908 000032DC D1E0                                    shl     eax, 1
  4909 000032DE BABA04BFBE                              mov     edx, 0BEBF04BAh
  4910 000032E3 F7EA                                    imul    edx
  4911 000032E5 89563C                                  mov     [esi+60], edx
  4912 000032E8 8B4670                                  mov     eax, [esi+112]  ; @@BF 3,28,+,COS0_3,1
  4913 000032EB 01460C                                  add     [esi+12], eax
  4914 000032EE 8B464C                                  mov     eax, [esi+76]   ; @@BF 12,19,+,COS0_12,2
  4915 000032F1 014630                                  add     [esi+48], eax
  4916 000032F4 8B460C                                  mov     eax, [esi+12]   ; @@BF 3,12,+,COS1_3,1
  4917 000032F7 8B5630                                  mov     edx, [esi+48]
  4918 000032FA 01560C                                  add     [esi+12], edx
  4919 000032FD 29D0                                    sub     eax, edx
  4920 000032FF D1E0                                    shl     eax, 1
  4921 00003301 BA630ECB52                              mov     edx, 52CB0E63h  ; COS1_3
  4922 00003306 F7EA                                    imul    edx
  4923 00003308 895630                                  mov     [esi+48], edx
  4924 0000330B 8B466C                                  mov     eax, [esi+108]  ; @@BF 4,27,+,COS0_4,1
  4925 0000330E 014610                                  add     [esi+16], eax
  4926 00003311 8B4650                                  mov     eax, [esi+80]   ; @@BF 11,20,+,COS0_11,2
  4927 00003314 01462C                                  add     [esi+44], eax
  4928 00003317 8B4610                                  mov     eax, [esi+16]   ; @@BF 4,11,+,COS1_4,1
  4929 0000331A 8B562C                                  mov     edx, [esi+44]
  4930 0000331D 015610                                  add     [esi+16], edx
  4931 00003320 29D0                                    sub     eax, edx
  4932 00003322 D1E0                                    shl     eax, 1
  4933 00003324 BA2E40E264                              mov     edx, 64E2402Eh
  4934 00003329 F7EA                                    imul    edx
  4935 0000332B 89562C                                  mov     [esi+44], edx
  4936 0000332E 8B460C                                  mov     eax, [esi+12]   ; @@BF 3,4,+,COS2_3,3
  4937 00003331 8B5610                                  mov     edx, [esi+16]
  4938 00003334 01560C                                  add     [esi+12], edx
  4939 00003337 29D0                                    sub     eax, edx
  4940 00003339 C1E003                                  shl     eax, 3
  4941 0000333C BA42670352                              mov     edx, 52036742h
  4942 00003341 F7EA                                    imul    edx
  4943 00003343 895610                                  mov     [esi+16], edx
  4944 00003346 8B462C                                  mov     eax, [esi+44]   ; @@BF 11,12,-,COS2_3,3
  4945 00003349 8B5630                                  mov     edx, [esi+48]
  4946 0000334C 01562C                                  add     [esi+44], edx
  4947 0000334F 29D0                                    sub     eax, edx
  4948 00003351 C1E003                                  shl     eax, 3
  4949 00003354 BABE98FCAD                              mov     edx, 0ADFC98BEh ; -COS2_3
  4950 00003359 F7EA                                    imul    edx
  4951 0000335B 895630                                  mov     [esi+48], edx
  4952 0000335E 8B06                                    mov     eax, [esi]      ; @@BF 0,3,+,COS3_0,1
  4953 00003360 8B560C                                  mov     edx, [esi+12]
  4954 00003363 0116                                    add     [esi], edx
  4955 00003365 29D0                                    sub     eax, edx
  4956 00003367 D1E0                                    shl     eax, 1
  4957 00003369 BAF0E94545                              mov     edx, 4545E9F0h
  4958 0000336E F7EA                                    imul    edx
  4959 00003370 89560C                                  mov     [esi+12], edx
  4960 00003373 8B4610                                  mov     eax, [esi+16]   ; @@BF 4,7,-,COS3_0,1
  4961 00003376 8B561C                                  mov     edx, [esi+28]
  4962 00003379 015610                                  add     [esi+16], edx
  4963 0000337C 29D0                                    sub     eax, edx
  4964 0000337E D1E0                                    shl     eax, 1
  4965 00003380 BA1016BABA                              mov     edx, 0BABA1610h
  4966 00003385 F7EA                                    imul    edx
  4967 00003387 89561C                                  mov     [esi+28], edx
  4968 0000338A 8B4620                                  mov     eax, [esi+32]   ; @@BF 8,11,+,COS3_0,1
  4969 0000338D 8B562C                                  mov     edx, [esi+44]
  4970 00003390 015620                                  add     [esi+32], edx
  4971 00003393 29D0                                    sub     eax, edx
  4972 00003395 D1E0                                    shl     eax, 1
  4973 00003397 BAF0E94545                              mov     edx, 4545E9F0h
  4974 0000339C F7EA                                    imul    edx
  4975 0000339E 89562C                                  mov     [esi+44], edx
  4976 000033A1 8B4630                                  mov     eax, [esi+48]   ; @@BF 12,15,-,COS3_0,1
  4977 000033A4 8B563C                                  mov     edx, [esi+60]
  4978 000033A7 015630                                  add     [esi+48], edx
  4979 000033AA 29D0                                    sub     eax, edx
  4980 000033AC D1E0                                    shl     eax, 1
  4981 000033AE BA1016BABA                              mov     edx, 0BABA1610h
  4982 000033B3 F7EA                                    imul    edx
  4983 000033B5 89563C                                  mov     [esi+60], edx
  4984 000033B8 8B4678                                  mov     eax, [esi+120]  ; @@BF 1,30,+,COS0_1,1
  4985 000033BB 014604                                  add     [esi+4], eax
  4986 000033BE 8B4644                                  mov     eax, [esi+68]   ; @@BF 14,17,+,COS0_14,3
  4987 000033C1 014638                                  add     [esi+56], eax
  4988 000033C4 8B4604                                  mov     eax, [esi+4]    ; @@BF 1,14,+,COS1_1,1
  4989 000033C7 8B5638                                  mov     edx, [esi+56]
  4990 000033CA 015604                                  add     [esi+4], edx
  4991 000033CD 29D0                                    sub     eax, edx
  4992 000033CF D1E0                                    shl     eax, 1
  4993 000033D1 BA103CE142                              mov     edx, 42E13C10h  ; COS1_1
  4994 000033D6 F7EA                                    imul    edx
  4995 000033D8 895638                                  mov     [esi+56], edx
  4996 000033DB 8B4664                                  mov     eax, [esi+100]  ; @@BF 6,25,+,COS0_6,1
  4997 000033DE 014618                                  add     [esi+24], eax
  4998 000033E1 8B4658                                  mov     eax, [esi+88]   ; @@BF 9,22,+,COS0_9,1
  4999 000033E4 014624                                  add     [esi+36], eax
  5000 000033E7 8B4618                                  mov     eax, [esi+24]   ; @@BF 6,9,+,COS1_6,2
  5001 000033EA 8B5624                                  mov     edx, [esi+36]
  5002 000033ED 015618                                  add     [esi+24], edx
  5003 000033F0 29D0                                    sub     eax, edx
  5004 000033F2 C1E002                                  shl     eax, 2
  5005 000033F5 BAC2923C6E                              mov     edx, 6E3C92C2h
  5006 000033FA F7EA                                    imul    edx
  5007 000033FC 895624                                  mov     [esi+36], edx
  5008 000033FF 8B4604                                  mov     eax, [esi+4]    ; @@BF 1,6,+,COS2_1,1
  5009 00003402 8B5618                                  mov     edx, [esi+24]
  5010 00003405 015604                                  add     [esi+4], edx
  5011 00003408 29D0                                    sub     eax, edx
  5012 0000340A D1E0                                    shl     eax, 1
  5013 0000340C BA88DEF84C                              mov     edx, 4CF8DE88h  ; COS2_1
  5014 00003411 F7EA                                    imul    edx
  5015 00003413 895618                                  mov     [esi+24], edx
  5016 00003416 8B4624                                  mov     eax, [esi+36]   ; @@BF 9,14,-,COS2_1,1
  5017 00003419 8B5638                                  mov     edx, [esi+56]
  5018 0000341C 015624                                  add     [esi+36], edx
  5019 0000341F 29D0                                    sub     eax, edx
  5020 00003421 D1E0                                    shl     eax, 1
  5021 00003423 BA782107B3                              mov     edx, 0B3072178h ; -COS2_1
  5022 00003428 F7EA                                    imul    edx
  5023 0000342A 895638                                  mov     [esi+56], edx
  5024 0000342D 8B4674                                  mov     eax, [esi+116]  ; @@BF 2,29,+,COS0_2,1
  5025 00003430 014608                                  add     [esi+8], eax
  5026 00003433 8B4648                                  mov     eax, [esi+72]   ; @@BF 13,18,+,COS0_13,3
  5027 00003436 014634                                  add     [esi+52], eax
  5028 00003439 8B4608                                  mov     eax, [esi+8]    ; @@BF 2,13,+,COS1_2,1
  5029 0000343C 8B5634                                  mov     edx, [esi+52]
  5030 0000343F 015608                                  add     [esi+8], edx
  5031 00003442 29D0                                    sub     eax, edx
  5032 00003444 D1E0                                    shl     eax, 1
  5033 00003446 BA459F9148                              mov     edx, 48919F45h
  5034 0000344B F7EA                                    imul    edx
  5035 0000344D 895634                                  mov     [esi+52], edx
  5036 00003450 8B4668                                  mov     eax, [esi+104]  ; @@BF 5,26,+,COS0_5,1
  5037 00003453 014614                                  add     [esi+20], eax
  5038 00003456 8B4654                                  mov     eax, [esi+84]   ; @@BF 10,21,+,COS0_10,1
  5039 00003459 014628                                  add     [esi+40], eax
  5040 0000345C 8B4614                                  mov     eax, [esi+20]   ; @@BF 5,10,+,COS1_5,2
  5041 0000345F 8B5628                                  mov     edx, [esi+40]
  5042 00003462 015614                                  add     [esi+20], edx
  5043 00003465 29D0                                    sub     eax, edx
  5044 00003467 C1E002                                  shl     eax, 2
  5045 0000346A BAAA24E243                              mov     edx, 43E224AAh
  5046 0000346F F7EA                                    imul    edx
  5047 00003471 895628                                  mov     [esi+40], edx
  5048 00003474 8B4608                                  mov     eax, [esi+8]    ; @@BF 2,5,+,COS2_2,1
  5049 00003477 8B5614                                  mov     edx, [esi+20]
  5050 0000347A 015608                                  add     [esi+8], edx
  5051 0000347D 29D0                                    sub     eax, edx
  5052 0000347F D1E0                                    shl     eax, 1
  5053 00003481 BABF6B3273                              mov     edx, 73326BBFh  ; COS2_2
  5054 00003486 F7EA                                    imul    edx
  5055 00003488 895614                                  mov     [esi+20], edx
  5056 0000348B 8B4628                                  mov     eax, [esi+40]   ; @@BF 10,13,-,COS2_2,1
  5057 0000348E 8B5634                                  mov     edx, [esi+52]
  5058 00003491 015628                                  add     [esi+40], edx
  5059 00003494 29D0                                    sub     eax, edx
  5060 00003496 D1E0                                    shl     eax, 1
  5061 00003498 BA4194CD8C                              mov     edx, 8CCD9441h  ; -COS2_2
  5062 0000349D F7EA                                    imul    edx
  5063 0000349F 895634                                  mov     [esi+52], edx
  5064 000034A2 8B4604                                  mov     eax, [esi+4]    ; @@BF 1,2,+,COS3_1,2
  5065 000034A5 8B5608                                  mov     edx, [esi+8]
  5066 000034A8 015604                                  add     [esi+4], edx
  5067 000034AB 29D0                                    sub     eax, edx
  5068 000034AD C1E002                                  shl     eax, 2
  5069 000034B0 BA46BA9E53                              mov     edx, 539EBA46h  ; COS3_1
  5070 000034B5 F7EA                                    imul    edx
  5071 000034B7 895608                                  mov     [esi+8], edx
  5072 000034BA 8B4614                                  mov     eax, [esi+20]   ; @@BF 5,6,-,COS3_1,2
  5073 000034BD 8B5618                                  mov     edx, [esi+24]
  5074 000034C0 015614                                  add     [esi+14h], edx
  5075 000034C3 29D0                                    sub     eax, edx
  5076 000034C5 C1E002                                  shl     eax, 2
  5077 000034C8 BABA4561AC                              mov     edx, 0AC6145BAh ; -COS3_1
  5078 000034CD F7EA                                    imul    edx
  5079 000034CF 895618                                  mov     [esi+24], edx
  5080 000034D2 8B06                                    mov     eax, [esi]      ; @@BF1 macro a, b, c, d
  5081                                                                          ;   @@BF  a, b,+,COS4_0, 1
  5082                                                                          ;   @@BF  c, d,-,COS4_0, 1
  5083                                                                          ;   @@ADD c, d
  5084                                                                          ;  endm
  5085                                                                          ; @@BF1 0,1,2,3
  5086 000034D4 8B5604                                  mov     edx, [esi+4]    ; @@BF 0,1,+,COS4_0,1
  5087 000034D7 0116                                    add     [esi], edx
  5088 000034D9 29D0                                    sub     eax, edx
  5089 000034DB D1E0                                    shl     eax, 1
  5090 000034DD BA9A79825A                              mov     edx, 5A82799Ah
  5091 000034E2 F7EA                                    imul    edx
  5092 000034E4 895604                                  mov     [esi+4], edx
  5093 000034E7 8B4608                                  mov     eax, [esi+8]    ; @@BF 2,3,-,COS4_0,1
  5094 000034EA 8B560C                                  mov     edx, [esi+12]
  5095 000034ED 015608                                  add     [esi+8], edx
  5096 000034F0 29D0                                    sub     eax, edx
  5097 000034F2 D1E0                                    shl     eax, 1
  5098 000034F4 BA66867DA5                              mov     edx, 0A57D8666h
  5099 000034F9 F7EA                                    imul    edx
  5100 000034FB 89560C                                  mov     [esi+12], edx
  5101 000034FE 8B460C                                  mov     eax, [esi+12]   ; @@ADD 2,3
  5102 00003501 014608                                  add     [esi+8], eax
  5103 00003504 8B4610                                  mov     eax, [esi+16]   ; @@BF2 macro a, b, c, d
  5104                                                                          ;   @@BF  a, b,+,COS4_0, 1
  5105                                                                          ;   @@BF  c, d,-,COS4_0, 1
  5106                                                                          ;   @@ADD c, d
  5107                                                                          ;   @@ADD a, c
  5108                                                                          ;   @@ADD c, b
  5109                                                                          ;   @@ADD b, d
  5110                                                                          ;  endm
  5111                                                                          ; @@BF2 4,5,6,7
  5112 00003507 8B5614                                  mov     edx, [esi+20]   ; @@BF 4,5,+,COS4_0,1
  5113 0000350A 015610                                  add     [esi+16], edx
  5114 0000350D 29D0                                    sub     eax, edx
  5115 0000350F D1E0                                    shl     eax, 1
  5116 00003511 BA9A79825A                              mov     edx, 5A82799Ah  ; COS4_0
  5117 00003516 F7EA                                    imul    edx
  5118 00003518 895614                                  mov     [esi+20], edx
  5119 0000351B 8B4618                                  mov     eax, [esi+24]   ; @@BF 6,7,-,COS4_0,1
  5120 0000351E 8B561C                                  mov     edx, [esi+28]
  5121 00003521 015618                                  add     [esi+18h], edx
  5122 00003524 29D0                                    sub     eax, edx
  5123 00003526 D1E0                                    shl     eax, 1
  5124 00003528 BA66867DA5                              mov     edx, 0A57D8666h ; -COS4_0
  5125 0000352D F7EA                                    imul    edx
  5126 0000352F 89561C                                  mov     [esi+28], edx
  5127 00003532 8B461C                                  mov     eax, [esi+28]   ; @@ADD 6,7
  5128 00003535 014618                                  add     [esi+24], eax
  5129 00003538 8B4618                                  mov     eax, [esi+24]   ; @@ADD 4,6
  5130 0000353B 014610                                  add     [esi+16], eax
  5131 0000353E 8B4614                                  mov     eax, [esi+20]   ; @@ADD 6,5
  5132 00003541 014618                                  add     [esi+24], eax
  5133 00003544 8B461C                                  mov     eax, [esi+28]   ; @@ADD 5,7
  5134 00003547 014614                                  add     [esi+20], eax
  5135 0000354A 8B06                                    mov     eax, [esi]      ; @@OUT macro dst,src1,src2
  5136                                                                          ; IF ((dst AND ((1 SHL rate_shift)-1)) EQ 0)
  5137                                                                          ;    mov eax,dword ptr [esi+src1*4]
  5138                                                                          ;    IFDIFI <src2>,<->
  5139                                                                          ;      add eax,dword ptr [esi+src2*4]
  5140                                                                          ;    ENDIF
  5141                                                                          ;    IF SYNTH32
  5142                                                                          ;       mov dword ptr [edi+dst*4],eax
  5143                                                                          ;       IF (LONG_WINDOW EQ 0)
  5144                                                                          ;          mov dword ptr [edi+dst*4+512*4],eax
  5145                                                                          ;       ENDIF
  5146                                                                          ;    ELSE
  5147                                                                          ;        ......
  5148                                                                          ;    ENDIF
  5149                                                                          ; @@OUT 0,0,-
  5150 0000354C 8907                                    mov     [edi], eax
  5151 0000354E 8B4604                                  mov     eax, [esi+4]    ; @@OUT 16,1,-
  5152 00003551 894740                                  mov     [edi+64], eax
  5153 00003554 8B4608                                  mov     eax, [esi+8]    ; @@OUT 8,2,-
  5154 00003557 894720                                  mov     [edi+32], eax
  5155 0000355A 8B460C                                  mov     eax, [esi+12]   ; @@OUT 24,3,-
  5156 0000355D 894760                                  mov     [edi+96], eax
  5157 00003560 8B4610                                  mov     eax, [esi+16]   ; @@OUT 4,4,-
  5158 00003563 894710                                  mov     [edi+16], eax
  5159 00003566 8B4614                                  mov     eax, [esi+20]   ; @@OUT 20,5,-
  5160 00003569 894750                                  mov     [edi+80], eax
  5161 0000356C 8B4618                                  mov     eax, [esi+24]   ; @@OUT 12,6,-
  5162 0000356F 894730                                  mov     [edi+48], eax
  5163 00003572 8B461C                                  mov     eax, [esi+28]   ; @@OUT 28,7,-
  5164 00003575 894770                                  mov     [edi+112], eax
  5165 00003578 C3                                      retn
  5166                                  
  5167                                  
  5168                                  ; =============== S U B R O U T I N E =======================================
  5169                                  
  5170                                  
  5171                                  synth_16bit_shift_0_fast:
  5172 00003579 F605[DC730000]10                        test    byte [cpuid_flags], 10h ; SYNTH_MACRO 0,0,1
  5173 00003580 740E                                    jz      short .no_rdtsc_supported
  5174 00003582 0F31                                    rdtsc
  5175 00003584 2905[54750000]                          sub     [rdtsc_synth_dct], eax
  5176 0000358A 1915[58750000]                          sbb     [rdtsc_synth_dct+4], edx
  5177                                  
  5178                                  .no_rdtsc_supported:
  5179 00003590 BE[7CBB0000]                            mov	esi, mp3_sb_samples
  5180 00003595 8B3D[10F20000]                          mov	edi, [mp3_samples_dst]
  5181 0000359B C705[1CF20000]0000-                     mov	dword [mp3_curr_channel], 0
  5181 000035A3 0000               
  5182                                  
  5183                                  .synth_channel_lop:
  5184 000035A5 56                                      push	esi
  5185 000035A6 57                                      push	edi
  5186 000035A7 893D[5C9B0000]                          mov	[mp3_curr_syn_dst], edi
  5187 000035AD C705[24F20000]0000-                     mov	dword [mp3_curr_frame], 0
  5187 000035B5 0000               
  5188                                  
  5189                                  .synth_frame_lop:
  5190 000035B7 56                                      push    esi
  5191 000035B8 F605[DC730000]10                        test    byte [cpuid_flags], 10h
  5192 000035BF 740E                                    jz      short .no_rdtsc_supported@
  5193 000035C1 0F31                                    rdtsc
  5194 000035C3 2905[6C750000]                          sub     [rdtsc_dct32], eax
  5195 000035C9 1915[70750000]                          sbb     [rdtsc_dct32+4], edx
  5196                                  
  5197                                  .no_rdtsc_supported@:
  5198 000035CF 8B15[1CF20000]                          mov     edx, [mp3_curr_channel]
  5199 000035D5 8B0495[74BB0000]                        mov     eax, [mp3_synth_index+edx*4]
  5200 000035DC 832C95[74BB0000]20                      sub     dword [mp3_synth_index+edx*4], 32
  5201 000035E4 C1E20A                                  shl     edx, 10
  5202 000035E7 25E0010000                              and     eax, 1E0h       ; 1FFh-1Fh
  5203 000035EC 09D0                                    or      eax, edx
  5204 000035EE A3[589B0000]                            mov     [mp3_curr_syn_index], eax
  5205 000035F3 8B3D[589B0000]                          mov     edi, [mp3_curr_syn_index]
  5206 000035F9 8D3CBD[749B0000]                        lea     edi, [mp3_synth_buf+edi*4]
  5207 00003600 E8A3EFFFFF                              call    mp3_dct32_shift_0
  5208 00003605 F605[DC730000]10                        test    byte [cpuid_flags], 10h
  5209 0000360C 740E                                    jz      short .no_rdtsc_supported@@
  5210 0000360E 0F31                                    rdtsc
  5211 00003610 0105[6C750000]                          add     [rdtsc_dct32], eax
  5212 00003616 1115[70750000]                          adc     [rdtsc_dct32+4], edx
  5213                                  
  5214                                  .no_rdtsc_supported@@:
  5215 0000361C F605[DC730000]10                        test    byte [cpuid_flags], 10h
  5216 00003623 740E                                    jz      short .no_rdtsc_supported@@@
  5217 00003625 0F31                                    rdtsc
  5218 00003627 2905[84750000]                          sub     [rdtsc_synth], eax
  5219 0000362D 1915[88750000]                          sbb     [rdtsc_synth+4], edx
  5220                                  
  5221                                  .no_rdtsc_supported@@@:
  5222 00003633 E888000000                              call    mp3_synth_filter_this_16bit_shift_0_fast ;
  5223                                                                          ; mp3_synth_filter_this_&force_8bit&_&rate_shift&_&force_fast
  5224 00003638 F605[DC730000]10                        test    byte [cpuid_flags], 10h
  5225 0000363F 740E                                    jz      short .no_rdtsc_supported@@@@
  5226 00003641 0F31                                    rdtsc
  5227 00003643 0105[84750000]                          add     [rdtsc_synth], eax
  5228 00003649 1115[88750000]                          adc     [rdtsc_synth+4], edx
  5229                                  
  5230                                  .no_rdtsc_supported@@@@:
  5231 0000364F 5E                                      pop     esi
  5232 00003650 A1[18F20000]                            mov     eax, [mp3_samples_dst_step]
  5233 00003655 C1E005                                  shl     eax, 5
  5234 00003658 8A0D[D9730000]                          mov     cl, [option_rate_shift]
  5235 0000365E D3E8                                    shr     eax, cl
  5236 00003660 0105[5C9B0000]                          add     [mp3_curr_syn_dst], eax
  5237 00003666 81C680000000                            add     esi, 128        ; SBLIMIT*4
  5238 0000366C FF05[24F20000]                          inc     dword [mp3_curr_frame]
  5239 00003672 A1[24F20000]                            mov     eax, [mp3_curr_frame]
  5240 00003677 3B05[609B0000]                          cmp     eax, [mp3_nb_frames]
  5241 0000367D 0F8234FFFFFF                            jb      .synth_frame_lop
  5242 00003683 5F                                      pop     edi
  5243 00003684 5E                                      pop     esi
  5244 00003685 033D[549B0000]                          add     edi, [mp3_bytes_per_sample]
  5245 0000368B 81C600120000                            add     esi, 4608       ; 36*SBLIMIT*4
  5246 00003691 FF05[1CF20000]                          inc     dword [mp3_curr_channel]
  5247 00003697 A1[1CF20000]                            mov     eax, [mp3_curr_channel]
  5248 0000369C 3B05[4C9B0000]                          cmp     eax, [mp3_output_num_channels]
  5249 000036A2 0F82FDFEFFFF                            jb      .synth_channel_lop
  5250 000036A8 F605[DC730000]10                        test    byte [cpuid_flags], 10h
  5251 000036AF 740E                                    jz      short .no_rdtsc_supported@@@@@
  5252 000036B1 0F31                                    rdtsc
  5253 000036B3 0105[54750000]                          add     [rdtsc_synth_dct], eax
  5254 000036B9 1115[58750000]                          adc     [rdtsc_synth_dct+4], edx
  5255                                  
  5256                                  .no_rdtsc_supported@@@@@:
  5257 000036BF C3                                      retn
  5258                                  
  5259                                  
  5260                                  ; =============== S U B R O U T I N E =======================================
  5261                                  
  5262                                  
  5263                                  mp3_synth_filter_this_16bit_shift_0_fast:
  5264 000036C0 A1[589B0000]                            mov     eax, [mp3_curr_syn_index]
  5265 000036C5 A9E0010000                              test    eax, 1E0h       ; 1FFh-1Fh
  5266 000036CA 0F849C010000                            jz      .append_copy_to_window
  5267 000036D0 90                                      nop
  5268                                  
  5269                                  .append_copy_to_window_back:
  5270 000036D1 89C5                                    mov     ebp, eax
  5271 000036D3 81E5C0010000                            and     ebp, 1C0h       ; @win1,1FFh-1Fh-20h
  5272 000036D9 2520040000                              and     eax, 420h       ; and eax,20h+(1 shl 10) ; bit5 and channel
  5273 000036DE 8D7010                                  lea     esi, [eax+10h]  ; @@syn1,[eax+10h]
  5274 000036E1 8D7830                                  lea     edi, [eax+30h]  ; @@syn2,[eax+30h]
  5275 000036E4 F7DD                                    neg     ebp
  5276 000036E6 81E5C0010000                            and     ebp, 1C0h       ; @win1,1FFh-1Fh-20h
  5277 000036EC 8B0D[5C9B0000]                          mov     ecx, [mp3_curr_syn_dst] ; @@dst,dword ptr [mp3_curr_syn_dst]
  5278                                  
  5279                                  .samples_lop:
  5280 000036F2 BB00200020                              mov     ebx, 20002000h  ; mov @@sum,(8000h SHL (@@out_shift))+(1 SHL (@@out_shift-1))
  5281                                                                          ; @@out_shift equ (OUT_SHIFT_fast+(8*force_8bit))
  5282                                                                          ; out_shift = 14
  5283 000036F7 8B14B5[749B0000]                        mov     edx, [mp3_synth_buf+esi*4] ; @@SUM8 macro sum,win,ww,syn
  5284                                                                          ; @@SUM8 @@sum,@@win1,0,@@syn1
  5285                                                                          ; IRP nn,0,1,2,3,4,5,6,7
  5286                                                                          ; mov edx,dword ptr [mp3_synth_buf+syn*4+(nn*64*4)]
  5287                                                                          ; movsx eax,word ptr [mp3_synth_win+win*2+(nn*64*2)+ww*2]
  5288                                                                          ; imul eax,edx
  5289                                                                          ; add sum,eax
  5290 000036FE 0FBF842D[2CED0400]                      movsx   eax, word [mp3_synth_win+ebp*2] ; nn=0, ww=0
  5291 00003706 0FAFC2                                  imul    eax, edx
  5292 00003709 01C3                                    add     ebx, eax
  5293 0000370B 8B14B5[749C0000]                        mov     edx, [(mp3_synth_buf+100h)+esi*4]
  5294 00003712 0FBF842D[ACED0400]                      movsx   eax, word [(mp3_synth_win+80h)+ebp*2] ; nn=1, ww=0
  5295 0000371A 0FAFC2                                  imul    eax, edx
  5296 0000371D 01C3                                    add     ebx, eax
  5297 0000371F 8B14B5[749D0000]                        mov     edx, [(mp3_synth_buf+200h)+esi*4]
  5298 00003726 0FBF842D[2CEE0400]                      movsx   eax, word [(mp3_synth_win+100h)+ebp*2] ; nn=2
  5299 0000372E 0FAFC2                                  imul    eax, edx
  5300 00003731 01C3                                    add     ebx, eax
  5301 00003733 8B14B5[749E0000]                        mov     edx, [(mp3_synth_buf+300h)+esi*4]
  5302 0000373A 0FBF842D[ACEE0400]                      movsx   eax, word [(mp3_synth_win+180h)+ebp*2] ; nn=3
  5303 00003742 0FAFC2                                  imul    eax, edx
  5304 00003745 01C3                                    add     ebx, eax
  5305 00003747 8B14B5[749F0000]                        mov     edx, [(mp3_synth_buf+400h)+esi*4]
  5306 0000374E 0FBF842D[2CEF0400]                      movsx   eax, word [(mp3_synth_win+200h)+ebp*2] ; nn=4
  5307 00003756 0FAFC2                                  imul    eax, edx
  5308 00003759 01C3                                    add     ebx, eax
  5309 0000375B 8B14B5[74A00000]                        mov     edx, [(mp3_synth_buf+500h)+esi*4]
  5310 00003762 0FBF842D[ACEF0400]                      movsx   eax, word [(mp3_synth_win+280h)+ebp*2] ; nn=5
  5311 0000376A 0FAFC2                                  imul    eax, edx
  5312 0000376D 01C3                                    add     ebx, eax
  5313 0000376F 8B14B5[74A10000]                        mov     edx, [(mp3_synth_buf+600h)+esi*4]
  5314 00003776 0FBF842D[2CF00400]                      movsx   eax, word [(mp3_synth_win+300h)+ebp*2] ; nn=6
  5315 0000377E 0FAFC2                                  imul    eax, edx
  5316 00003781 01C3                                    add     ebx, eax
  5317 00003783 8B14B5[74A20000]                        mov     edx, [(mp3_synth_buf+700h)+esi*4]
  5318 0000378A 0FBF842D[ACF00400]                      movsx   eax, word [(mp3_synth_win+380h)+ebp*2] ; nn=7
  5319 00003792 0FAFC2                                  imul    eax, edx
  5320 00003795 01C3                                    add     ebx, eax
  5321 00003797 8B14BD[749B0000]                        mov     edx, [mp3_synth_buf+edi*4] ; @@SUM8 @@sum,@@win1,32, @@syn2
  5322 0000379E 0FBF842D[6CED0400]                      movsx   eax, word [(mp3_synth_win+40h)+ebp*2] ; nn=0, ww=32
  5323 000037A6 0FAFC2                                  imul    eax, edx
  5324 000037A9 01C3                                    add     ebx, eax
  5325 000037AB 8B14BD[749C0000]                        mov     edx, [(mp3_synth_buf+100h)+edi*4]
  5326 000037B2 0FBF842D[ECED0400]                      movsx   eax, word [(mp3_synth_win+0C0h)+ebp*2] ; nn=1, ww=32
  5327 000037BA 0FAFC2                                  imul    eax, edx
  5328 000037BD 01C3                                    add     ebx, eax
  5329 000037BF 8B14BD[749D0000]                        mov     edx, [(mp3_synth_buf+200h)+edi*4]
  5330 000037C6 0FBF842D[6CEE0400]                      movsx   eax, word [(mp3_synth_win+140h)+ebp*2] ; nn=2
  5331 000037CE 0FAFC2                                  imul    eax, edx
  5332 000037D1 01C3                                    add     ebx, eax
  5333 000037D3 8B14BD[749E0000]                        mov     edx, [(mp3_synth_buf+300h)+edi*4]
  5334 000037DA 0FBF842D[ECEE0400]                      movsx   eax, word [(mp3_synth_win+1C0h)+ebp*2] ; nn=3
  5335 000037E2 0FAFC2                                  imul    eax, edx
  5336 000037E5 01C3                                    add     ebx, eax
  5337 000037E7 8B14BD[749F0000]                        mov     edx, [(mp3_synth_buf+400h)+edi*4]
  5338 000037EE 0FBF842D[6CEF0400]                      movsx   eax, word [(mp3_synth_win+240h)+ebp*2] ; nn=4
  5339 000037F6 0FAFC2                                  imul    eax, edx
  5340 000037F9 01C3                                    add     ebx, eax
  5341 000037FB 8B14BD[74A00000]                        mov     edx, [(mp3_synth_buf+500h)+edi*4]
  5342 00003802 0FBF842D[ECEF0400]                      movsx   eax, word [(mp3_synth_win+2C0h)+ebp*2] ; nn=5
  5343 0000380A 0FAFC2                                  imul    eax, edx
  5344 0000380D 01C3                                    add     ebx, eax
  5345 0000380F 8B14BD[74A10000]                        mov     edx, [(mp3_synth_buf+600h)+edi*4]
  5346 00003816 0FBF842D[6CF00400]                      movsx   eax, word [(mp3_synth_win+340h)+ebp*2] ; nn=6
  5347 0000381E 0FAFC2                                  imul    eax, edx
  5348 00003821 01C3                                    add     ebx, eax
  5349 00003823 8B14BD[74A20000]                        mov     edx, [(mp3_synth_buf+700h)+edi*4]
  5350 0000382A 0FBF842D[ECF00400]                      movsx   eax, word [(mp3_synth_win+3C0h)+ebp*2] ; nn=7
  5351 00003832 0FAFC2                                  imul    eax, edx
  5352 00003835 01C3                                    add     ebx, eax
  5353 00003837 81FB00000040                            cmp     ebx, 40000000h  ; cmp @@sum,10000h SHL (@@out_shift) ; out_shift = 14
  5354 0000383D 7322                                    jnb     short .sat
  5355 0000383F C1FB0E                                  sar     ebx, 14         ; sar @@sum,(@@out_shift)
  5356 00003842 81EB00800000                            sub     ebx, 8000h      ; sub @@sum,8000h ; make 16bit signed
  5357                                  
  5358                                  .sat_back:
  5359 00003848 668919                                  mov     [ecx], bx       ; mov word ptr [@@dst],@@sum_16bit
  5360 0000384B 030D[18F20000]                          add     ecx, [mp3_samples_dst_step]
  5361 00003851 46                                      inc     esi             ; inc @@syn1
  5362 00003852 4F                                      dec     edi             ; dec @@syn2
  5363 00003853 45                                      inc     ebp             ; inc @@win1
  5364 00003854 F7C51F000000                            test    ebp, 1Fh        ; IF LONG_WINDOW
  5365 0000385A 0F8592FEFFFF                            jnz     .samples_lop   ; test @@win1,1Fh
  5366 00003860 C3                                      retn
  5367                                  
  5368                                  .sat:
  5369 00003861 C1FB1F                                  sar     ebx, 31         ; sar @@sum,31 ; FFFFFFFFh,00000000h
  5370 00003864 81F3FF7F0000                            xor     ebx, 7FFFh      ; xor @@sum,7fffh ; FFFF8000h,00007FFFh (signed 16bit)
  5371 0000386A EBDC                                    jmp     short .sat_back
  5372                                  
  5373                                  .append_copy_to_window:
  5374 0000386C 8D3485[749B0000]                        lea     esi, [mp3_synth_buf+eax*4] ; IF SYNTH32
  5375 00003873 8DBE00080000                            lea     edi, [esi+2048] ; [esi+512*4]
  5376 00003879 B912000000                              mov     ecx, 18         ; (12h*4)/4
  5377 0000387E F3A5                                    rep movsd
  5378 00003880 E94CFEFFFF                              jmp     .append_copy_to_window_back
  5379                                  
  5380                                  
  5381                                  ; =============== S U B R O U T I N E =======================================
  5382                                  
  5383                                  
  5384                                  synth_16bit_shift_1_fast:
  5385 00003885 F605[DC730000]10                        test    byte [cpuid_flags], 10h ; SYNTH_MACRO 0,1,1
  5386 0000388C 740E                                    jz      short .no_rdtsc_supported
  5387 0000388E 0F31                                    rdtsc
  5388 00003890 2905[54750000]                          sub     [rdtsc_synth_dct], eax
  5389 00003896 1915[58750000]                          sbb     [rdtsc_synth_dct+4], edx
  5390                                  
  5391                                  .no_rdtsc_supported:
  5392 0000389C BE[7CBB0000]                            mov	esi, mp3_sb_samples
  5393 000038A1 8B3D[10F20000]                          mov	edi, [mp3_samples_dst]
  5394 000038A7 C705[1CF20000]0000-                     mov	dword [mp3_curr_channel], 0
  5394 000038AF 0000               
  5395                                  
  5396                                  .synth_channel_lop:
  5397 000038B1 56                                      push	esi
  5398 000038B2 57                                      push	edi
  5399 000038B3 893D[5C9B0000]                          mov	[mp3_curr_syn_dst], edi
  5400 000038B9 C705[24F20000]0000-                     mov	dword [mp3_curr_frame], 0
  5400 000038C1 0000               
  5401                                  
  5402                                  .synth_frame_lop:
  5403 000038C3 56                                      push    esi
  5404 000038C4 F605[DC730000]10                        test    byte [cpuid_flags], 10h
  5405 000038CB 740E                                    jz      short .no_rdtsc_supported@
  5406 000038CD 0F31                                    rdtsc
  5407 000038CF 2905[6C750000]                          sub     [rdtsc_dct32], eax
  5408 000038D5 1915[70750000]                          sbb     [rdtsc_dct32+4], edx
  5409                                  
  5410                                  .no_rdtsc_supported@:
  5411 000038DB 8B15[1CF20000]                          mov     edx, [mp3_curr_channel]
  5412 000038E1 8B0495[74BB0000]                        mov     eax, [mp3_synth_index+edx*4]
  5413 000038E8 832C95[74BB0000]20                      sub	dword [mp3_synth_index+edx*4], 32
  5414 000038F0 C1E20A                                  shl     edx, 10
  5415 000038F3 25E0010000                              and     eax, 1E0h       ; 1FFh-1Fh
  5416 000038F8 09D0                                    or      eax, edx
  5417 000038FA A3[589B0000]                            mov     [mp3_curr_syn_index], eax
  5418 000038FF 8B3D[589B0000]                          mov     edi, [mp3_curr_syn_index]
  5419 00003905 8D3CBD[749B0000]                        lea     edi, [mp3_synth_buf+edi*4]
  5420 0000390C E877F5FFFF                              call    mp3_dct32_shift_1 ; mp3_dct32_shift_&rate_shift
  5421 00003911 F605[DC730000]10                        test    byte [cpuid_flags], 10h
  5422 00003918 740E                                    jz      short .no_rdtsc_supported@@
  5423 0000391A 0F31                                    rdtsc
  5424 0000391C 0105[6C750000]                          add     [rdtsc_dct32], eax
  5425 00003922 1115[70750000]                          adc     [rdtsc_dct32+4], edx
  5426                                  
  5427                                  .no_rdtsc_supported@@:
  5428 00003928 F605[DC730000]10                        test    byte [cpuid_flags], 10h
  5429 0000392F 740E                                    jz      short .no_rdtsc_supported@@@
  5430 00003931 0F31                                    rdtsc
  5431 00003933 2905[84750000]                          sub     [rdtsc_synth], eax
  5432 00003939 1915[88750000]                          sbb     [rdtsc_synth+4], edx
  5433                                  
  5434                                  .no_rdtsc_supported@@@:
  5435 0000393F E888000000                              call    mp3_synth_filter_this_16bit_shift_1_fast ;
  5436                                                                          ; mp3_synth_filter_this_&force_8bit&_&rate_shift&_&force_fast
  5437 00003944 F605[DC730000]10                        test    byte [cpuid_flags], 10h
  5438 0000394B 740E                                    jz      short .no_rdtsc_supported@@@@
  5439 0000394D 0F31                                    rdtsc
  5440 0000394F 0105[84750000]                          add     [rdtsc_synth], eax
  5441 00003955 1115[88750000]                          adc     [rdtsc_synth+4], edx
  5442                                  
  5443                                  .no_rdtsc_supported@@@@:
  5444 0000395B 5E                                      pop     esi
  5445 0000395C A1[18F20000]                            mov     eax, [mp3_samples_dst_step]
  5446 00003961 C1E005                                  shl     eax, 5
  5447 00003964 8A0D[D9730000]                          mov     cl, [option_rate_shift]
  5448 0000396A D3E8                                    shr     eax, cl
  5449 0000396C 0105[5C9B0000]                          add     [mp3_curr_syn_dst], eax
  5450 00003972 81C680000000                            add     esi, 128        ; SBLIMIT*4
  5451 00003978 FF05[24F20000]                          inc     dword [mp3_curr_frame]
  5452 0000397E A1[24F20000]                            mov     eax, [mp3_curr_frame]
  5453 00003983 3B05[609B0000]                          cmp     eax, [mp3_nb_frames]
  5454 00003989 0F8234FFFFFF                            jb      .synth_frame_lop
  5455 0000398F 5F                                      pop     edi
  5456 00003990 5E                                      pop     esi
  5457 00003991 033D[549B0000]                          add     edi, [mp3_bytes_per_sample]
  5458 00003997 81C600120000                            add     esi, 4608       ; 36*SBLIMIT*4
  5459 0000399D FF05[1CF20000]                          inc     dword [mp3_curr_channel]
  5460 000039A3 A1[1CF20000]                            mov     eax, [mp3_curr_channel]
  5461 000039A8 3B05[4C9B0000]                          cmp     eax, [mp3_output_num_channels]
  5462 000039AE 0F82FDFEFFFF                            jb      .synth_channel_lop
  5463 000039B4 F605[DC730000]10                        test    byte [cpuid_flags], 10h
  5464 000039BB 740E                                    jz      short .no_rdtsc_supported@@@@@
  5465 000039BD 0F31                                    rdtsc
  5466 000039BF 0105[54750000]                          add     [rdtsc_synth_dct], eax
  5467 000039C5 1115[58750000]                          adc     [rdtsc_synth_dct+4], edx
  5468                                  
  5469                                  .no_rdtsc_supported@@@@@:
  5470 000039CB C3                                      retn
  5471                                  
  5472                                  
  5473                                  ; =============== S U B R O U T I N E =======================================
  5474                                  
  5475                                  
  5476                                  mp3_synth_filter_this_16bit_shift_1_fast:
  5477 000039CC A1[589B0000]                            mov     eax, [mp3_curr_syn_index]
  5478 000039D1 A9E0010000                              test    eax, 1E0h       ; 1FFh-1Fh
  5479 000039D6 0F84A2010000                            jz      .append_copy_to_window
  5480 000039DC 90                                      nop
  5481                                  
  5482                                  .append_copy_to_window_back:
  5483 000039DD 89C5                                    mov     ebp, eax
  5484 000039DF 81E5C0010000                            and     ebp, 1C0h
  5485 000039E5 2520040000                              and     eax, 420h
  5486 000039EA 8D7010                                  lea     esi, [eax+10h]
  5487 000039ED 8D7830                                  lea     edi, [eax+30h]
  5488 000039F0 F7DD                                    neg     ebp
  5489 000039F2 81E5C0010000                            and     ebp, 1C0h
  5490 000039F8 8B0D[5C9B0000]                          mov     ecx, [mp3_curr_syn_dst]
  5491                                  
  5492                                  .samples_lop:
  5493 000039FE BB00200020                              mov     ebx, 20002000h  ; mov @@sum,(8000h SHL (@@out_shift))+(1 SHL (@@out_shift-1))
  5494                                                                          ; @@out_shift equ (OUT_SHIFT_fast+(8*force_8bit))
  5495                                                                          ; out_shift = 14
  5496 00003A03 8B14B5[749B0000]                        mov     edx, [mp3_synth_buf+esi*4] ; @@SUM8 macro sum,win,ww,syn
  5497                                                                          ; @@SUM8 @@sum,@@win1,0,@@syn1
  5498                                                                          ; IRP nn,0,1,2,3,4,5,6,7
  5499                                                                          ; mov edx,dword ptr [mp3_synth_buf+syn*4+(nn*64*4)]
  5500                                                                          ; movsx eax,word ptr [mp3_synth_win+win*2+(nn*64*2)+ww*2]
  5501                                                                          ; imul eax,edx
  5502                                                                          ; add sum,eax
  5503 00003A0A 0FBF842D[2CED0400]                      movsx   eax, word [mp3_synth_win+ebp*2]
  5504 00003A12 0FAFC2                                  imul    eax, edx
  5505 00003A15 01C3                                    add     ebx, eax
  5506 00003A17 8B14B5[749C0000]                        mov     edx, [(mp3_synth_buf+100h)+esi*4] ; nn=1
  5507 00003A1E 0FBF842D[ACED0400]                      movsx   eax, word [(mp3_synth_win+80h)+ebp*2] ; ww=0
  5508 00003A26 0FAFC2                                  imul    eax, edx
  5509 00003A29 01C3                                    add     ebx, eax
  5510 00003A2B 8B14B5[749D0000]                        mov     edx, [(mp3_synth_buf+200h)+esi*4]
  5511 00003A32 0FBF842D[2CEE0400]                      movsx   eax, word [(mp3_synth_win+100h)+ebp*2]
  5512 00003A3A 0FAFC2                                  imul    eax, edx
  5513 00003A3D 01C3                                    add     ebx, eax
  5514 00003A3F 8B14B5[749E0000]                        mov     edx, [(mp3_synth_buf+300h)+esi*4]
  5515 00003A46 0FBF842D[ACEE0400]                      movsx   eax, word [(mp3_synth_win+180h)+ebp*2]
  5516 00003A4E 0FAFC2                                  imul    eax, edx
  5517 00003A51 01C3                                    add     ebx, eax
  5518 00003A53 8B14B5[749F0000]                        mov     edx, [(mp3_synth_buf+400h)+esi*4] ; nn=4
  5519 00003A5A 0FBF842D[2CEF0400]                      movsx   eax, word [(mp3_synth_win+200h)+ebp*2]
  5520 00003A62 0FAFC2                                  imul    eax, edx
  5521 00003A65 01C3                                    add     ebx, eax
  5522 00003A67 8B14B5[74A00000]                        mov     edx, [(mp3_synth_buf+500h)+esi*4]
  5523 00003A6E 0FBF842D[ACEF0400]                      movsx   eax, word [(mp3_synth_win+280h)+ebp*2]
  5524 00003A76 0FAFC2                                  imul    eax, edx
  5525 00003A79 01C3                                    add     ebx, eax
  5526 00003A7B 8B14B5[74A10000]                        mov     edx, [(mp3_synth_buf+600h)+esi*4]
  5527 00003A82 0FBF842D[2CF00400]                      movsx   eax, word [(mp3_synth_win+300h)+ebp*2]
  5528 00003A8A 0FAFC2                                  imul    eax, edx
  5529 00003A8D 01C3                                    add     ebx, eax
  5530 00003A8F 8B14B5[74A20000]                        mov     edx, [(mp3_synth_buf+700h)+esi*4] ; nn=7
  5531 00003A96 0FBF842D[ACF00400]                      movsx   eax, word [(mp3_synth_win+380h)+ebp*2] ; ww=0
  5532 00003A9E 0FAFC2                                  imul    eax, edx
  5533 00003AA1 01C3                                    add     ebx, eax
  5534 00003AA3 8B14BD[749B0000]                        mov     edx, [mp3_synth_buf+edi*4]
  5535 00003AAA 0FBF842D[6CED0400]                      movsx   eax, word [(mp3_synth_win+40h)+ebp*2]
  5536 00003AB2 0FAFC2                                  imul    eax, edx
  5537 00003AB5 01C3                                    add     ebx, eax
  5538 00003AB7 8B14BD[749C0000]                        mov     edx, [(mp3_synth_buf+100h)+edi*4]
  5539 00003ABE 0FBF842D[ECED0400]                      movsx   eax, word [(mp3_synth_win+0C0h)+ebp*2]
  5540 00003AC6 0FAFC2                                  imul    eax, edx
  5541 00003AC9 01C3                                    add     ebx, eax
  5542 00003ACB 8B14BD[749D0000]                        mov     edx, [(mp3_synth_buf+200h)+edi*4] ; nn=2, ww=32
  5543 00003AD2 0FBF842D[6CEE0400]                      movsx   eax, word [(mp3_synth_win+140h)+ebp*2]
  5544 00003ADA 0FAFC2                                  imul    eax, edx
  5545 00003ADD 01C3                                    add     ebx, eax
  5546 00003ADF 8B14BD[749E0000]                        mov     edx, [(mp3_synth_buf+300h)+edi*4]
  5547 00003AE6 0FBF842D[ECEE0400]                      movsx   eax, word [(mp3_synth_win+1C0h)+ebp*2]
  5548 00003AEE 0FAFC2                                  imul    eax, edx
  5549 00003AF1 01C3                                    add     ebx, eax
  5550 00003AF3 8B14BD[749F0000]                        mov     edx, [(mp3_synth_buf+400h)+edi*4]
  5551 00003AFA 0FBF842D[6CEF0400]                      movsx   eax, word [(mp3_synth_win+240h)+ebp*2]
  5552 00003B02 0FAFC2                                  imul    eax, edx
  5553 00003B05 01C3                                    add     ebx, eax
  5554 00003B07 8B14BD[74A00000]                        mov     edx, [(mp3_synth_buf+500h)+edi*4]
  5555 00003B0E 0FBF842D[ECEF0400]                      movsx   eax, word [(mp3_synth_win+2C0h)+ebp*2]
  5556 00003B16 0FAFC2                                  imul    eax, edx
  5557 00003B19 01C3                                    add     ebx, eax
  5558 00003B1B 8B14BD[74A10000]                        mov     edx, [(mp3_synth_buf+600h)+edi*4] ; nn=6, ww=32
  5559 00003B22 0FBF842D[6CF00400]                      movsx   eax, word [(mp3_synth_win+340h)+ebp*2]
  5560 00003B2A 0FAFC2                                  imul    eax, edx
  5561 00003B2D 01C3                                    add     ebx, eax
  5562 00003B2F 8B14BD[74A20000]                        mov     edx, [(mp3_synth_buf+700h)+edi*4]
  5563 00003B36 0FBF842D[ECF00400]                      movsx   eax, word [(mp3_synth_win+3C0h)+ebp*2]
  5564 00003B3E 0FAFC2                                  imul    eax, edx
  5565 00003B41 01C3                                    add     ebx, eax
  5566 00003B43 81FB00000040                            cmp     ebx, 40000000h  ; cmp  @@sum,10000h SHL (@@out_shift)
  5567 00003B49 7328                                    jnb     short .sat
  5568 00003B4B C1FB0E                                  sar     ebx, 14         ; sar @@sum,(@@out_shift)
  5569 00003B4E 81EB00800000                            sub     ebx, 8000h      ; make 16bit signed
  5570                                  
  5571                                  .sat_back:
  5572 00003B54 668919                                  mov     [ecx], bx
  5573 00003B57 030D[18F20000]                          add     ecx, [mp3_samples_dst_step]
  5574 00003B5D 83C602                                  add     esi, 2          ; IF rate_shift
  5575                                                                          ; add  @@syn1,1 shl rate_shift
  5576 00003B60 83EF02                                  sub     edi, 2          ; sub @@syn2,1 shl rate_shift
  5577 00003B63 83C502                                  add     ebp, 2          ; add @@win1,1 shl rate_shift
  5578 00003B66 F7C51F000000                            test    ebp, 1Fh        ; IF LONG_WINDOW
  5579 00003B6C 0F858CFEFFFF                            jnz     .samples_lop   ; test @@win1,1fh
  5580 00003B72 C3                                      retn
  5581                                  
  5582                                  .sat:
  5583 00003B73 C1FB1F                                  sar     ebx, 31         ; sar @@sum,31 ; FFFFFFFFh,00000000h
  5584 00003B76 81F3FF7F0000                            xor     ebx, 7FFFh      ; xor @@sum,7fffh ; FFFF8000h,00007FFFh (signed 16bit)
  5585 00003B7C EBD6                                    jmp     short .sat_back
  5586                                  
  5587                                  .append_copy_to_window:
  5588 00003B7E 8D3485[749B0000]                        lea     esi, [mp3_synth_buf+eax*4]
  5589 00003B85 8DBE00080000                            lea     edi, [esi+2048] ; [esi+512*4]
  5590 00003B8B B912000000                              mov     ecx, 18         ; (12h*4)/4
  5591 00003B90 F3A5                                    rep movsd
  5592 00003B92 E946FEFFFF                              jmp     .append_copy_to_window_back
  5593                                  
  5594                                  
  5595                                  ; =============== S U B R O U T I N E =======================================
  5596                                  
  5597                                  
  5598                                  synth_16bit_shift_2_fast:
  5599 00003B97 F605[DC730000]10                        test    byte [cpuid_flags], 10h ; SYNTH_MACRO 0,2,1
  5600 00003B9E 740E                                    jz      short .no_rdtsc_supported
  5601 00003BA0 0F31                                    rdtsc
  5602 00003BA2 2905[54750000]                          sub     [rdtsc_synth_dct], eax
  5603 00003BA8 1915[58750000]                          sbb     [rdtsc_synth_dct+4], edx
  5604                                  
  5605                                  .no_rdtsc_supported:
  5606 00003BAE BE[7CBB0000]                            mov	esi, mp3_sb_samples
  5607 00003BB3 8B3D[10F20000]                          mov	edi, [mp3_samples_dst]
  5608 00003BB9 C705[1CF20000]0000-                     mov	dword [mp3_curr_channel], 0
  5608 00003BC1 0000               
  5609                                  
  5610                                  .synth_channel_lop:
  5611 00003BC3 56                                      push	esi
  5612 00003BC4 57                                      push	edi
  5613 00003BC5 893D[5C9B0000]                          mov	[mp3_curr_syn_dst], edi
  5614 00003BCB C705[24F20000]0000-                     mov	dword [mp3_curr_frame], 0
  5614 00003BD3 0000               
  5615                                  
  5616                                  .synth_frame_lop:
  5617 00003BD5 56                                      push    esi
  5618 00003BD6 F605[DC730000]10                        test    byte [cpuid_flags], 10h
  5619 00003BDD 740E                                    jz      short .no_rdtsc_supported@
  5620 00003BDF 0F31                                    rdtsc
  5621 00003BE1 2905[6C750000]                          sub     [rdtsc_dct32], eax
  5622 00003BE7 1915[70750000]                          sbb     [rdtsc_dct32+4], edx
  5623                                  
  5624                                  .no_rdtsc_supported@:
  5625 00003BED 8B15[1CF20000]                          mov     edx, [mp3_curr_channel]
  5626 00003BF3 8B0495[74BB0000]                        mov     eax, [mp3_synth_index+edx*4]
  5627 00003BFA 832C95[74BB0000]20                      sub     dword [mp3_synth_index+edx*4], 32
  5628 00003C02 C1E20A                                  shl     edx, 10
  5629 00003C05 25E0010000                              and     eax, 1E0h       ; 1FFh-1Fh
  5630 00003C0A 09D0                                    or      eax, edx
  5631 00003C0C A3[589B0000]                            mov     [mp3_curr_syn_index], eax
  5632 00003C11 8B3D[589B0000]                          mov     edi, [mp3_curr_syn_index]
  5633 00003C17 8D3CBD[749B0000]                        lea     edi, [mp3_synth_buf+edi*4]
  5634 00003C1E E855F6FFFF                              call    mp3_dct32_shift_2 ; mp3_dct32_shift_&rate_shift
  5635 00003C23 F605[DC730000]10                        test    byte [cpuid_flags], 10h
  5636 00003C2A 740E                                    jz      short .no_rdtsc_supported@@
  5637 00003C2C 0F31                                    rdtsc
  5638 00003C2E 0105[6C750000]                          add     [rdtsc_dct32], eax
  5639 00003C34 1115[70750000]                          adc     [rdtsc_dct32+4], edx
  5640                                  
  5641                                  .no_rdtsc_supported@@:
  5642 00003C3A F605[DC730000]10                        test    byte [cpuid_flags], 10h
  5643 00003C41 740E                                    jz      short .no_rdtsc_supported@@@
  5644 00003C43 0F31                                    rdtsc
  5645 00003C45 2905[84750000]                          sub     [rdtsc_synth], eax
  5646 00003C4B 1915[88750000]                          sbb     [rdtsc_synth+4], edx
  5647                                  
  5648                                  .no_rdtsc_supported@@@:
  5649 00003C51 E888000000                              call    mp3_synth_filter_this_16bit_shift_2_fast ;
  5650                                                                          ; mp3_synth_filter_this_&force_8bit&_&rate_shift&_&force_fas
  5651 00003C56 F605[DC730000]10                        test    byte [cpuid_flags], 10h
  5652 00003C5D 740E                                    jz      short .no_rdtsc_supported@@@@
  5653 00003C5F 0F31                                    rdtsc
  5654 00003C61 0105[84750000]                          add     [rdtsc_synth], eax
  5655 00003C67 1115[88750000]                          adc     [rdtsc_synth+4], edx
  5656                                  
  5657                                  .no_rdtsc_supported@@@@:
  5658 00003C6D 5E                                      pop     esi
  5659 00003C6E A1[18F20000]                            mov     eax, [mp3_samples_dst_step]
  5660 00003C73 C1E005                                  shl     eax, 5
  5661 00003C76 8A0D[D9730000]                          mov     cl, [option_rate_shift]
  5662 00003C7C D3E8                                    shr     eax, cl
  5663 00003C7E 0105[5C9B0000]                          add     [mp3_curr_syn_dst], eax
  5664 00003C84 81C680000000                            add     esi, 128        ; SBLIMIT*4
  5665 00003C8A FF05[24F20000]                          inc     dword [mp3_curr_frame]
  5666 00003C90 A1[24F20000]                            mov     eax, [mp3_curr_frame]
  5667 00003C95 3B05[609B0000]                          cmp     eax, [mp3_nb_frames]
  5668 00003C9B 0F8234FFFFFF                            jb      .synth_frame_lop
  5669 00003CA1 5F                                      pop     edi
  5670 00003CA2 5E                                      pop     esi
  5671 00003CA3 033D[549B0000]                          add     edi, [mp3_bytes_per_sample]
  5672 00003CA9 81C600120000                            add     esi, 4608       ; 36*SBLIMIT*4
  5673 00003CAF FF05[1CF20000]                          inc     dword [mp3_curr_channel]
  5674 00003CB5 A1[1CF20000]                            mov     eax, [mp3_curr_channel]
  5675 00003CBA 3B05[4C9B0000]                          cmp     eax, [mp3_output_num_channels]
  5676 00003CC0 0F82FDFEFFFF                            jb      .synth_channel_lop
  5677 00003CC6 F605[DC730000]10                        test    byte [cpuid_flags], 10h
  5678 00003CCD 740E                                    jz      short .no_rdtsc_supported@@@@@
  5679 00003CCF 0F31                                    rdtsc
  5680 00003CD1 0105[54750000]                          add     [rdtsc_synth_dct], eax
  5681 00003CD7 1115[58750000]                          adc     [rdtsc_synth_dct+4], edx
  5682                                  
  5683                                  .no_rdtsc_supported@@@@@:
  5684 00003CDD C3                                      retn
  5685                                  
  5686                                  
  5687                                  ; =============== S U B R O U T I N E =======================================
  5688                                  
  5689                                  
  5690                                  mp3_synth_filter_this_16bit_shift_2_fast:
  5691 00003CDE A1[589B0000]                            mov     eax, [mp3_curr_syn_index]
  5692 00003CE3 A9E0010000                              test    eax, 1E0h       ; 1FFh-1Fh
  5693 00003CE8 0F84A2010000                            jz      .append_copy_to_window
  5694 00003CEE 90                                      nop
  5695                                  
  5696                                  .append_copy_to_window_back:
  5697 00003CEF 89C5                                    mov     ebp, eax
  5698 00003CF1 81E5C0010000                            and     ebp, 1C0h       ; 1FFh-1Fh-20h
  5699 00003CF7 2520040000                              and     eax, 420h       ; 20h+(1 shl 10)
  5700 00003CFC 8D7010                                  lea     esi, [eax+10h]
  5701 00003CFF 8D7830                                  lea     edi, [eax+30h]
  5702 00003D02 F7DD                                    neg     ebp
  5703 00003D04 81E5C0010000                            and     ebp, 1C0h
  5704 00003D0A 8B0D[5C9B0000]                          mov     ecx, [mp3_curr_syn_dst]
  5705                                  
  5706                                  .samples_lop:
  5707 00003D10 BB00200020                              mov     ebx, 20002000h  ; mov @@sum,(8000h SHL (@@out_shift))+(1 SHL (@@out_shift-1))
  5708                                                                          ; @@out_shift equ (OUT_SHIFT_fast+(8*force_8bit))
  5709                                                                          ; out_shift = 14
  5710 00003D15 8B14B5[749B0000]                        mov     edx, [mp3_synth_buf+esi*4]
  5711 00003D1C 0FBF842D[2CED0400]                      movsx   eax, word [mp3_synth_win+ebp*2]
  5712 00003D24 0FAFC2                                  imul    eax, edx
  5713 00003D27 01C3                                    add     ebx, eax
  5714 00003D29 8B14B5[749C0000]                        mov     edx, [(mp3_synth_buf+100h)+esi*4]
  5715 00003D30 0FBF842D[ACED0400]                      movsx   eax, word [(mp3_synth_win+80h)+ebp*2]
  5716 00003D38 0FAFC2                                  imul    eax, edx
  5717 00003D3B 01C3                                    add     ebx, eax
  5718 00003D3D 8B14B5[749D0000]                        mov     edx, [(mp3_synth_buf+200h)+esi*4]
  5719 00003D44 0FBF842D[2CEE0400]                      movsx   eax, word [(mp3_synth_win+100h)+ebp*2]
  5720 00003D4C 0FAFC2                                  imul    eax, edx
  5721 00003D4F 01C3                                    add     ebx, eax
  5722 00003D51 8B14B5[749E0000]                        mov     edx, [(mp3_synth_buf+300h)+esi*4]
  5723 00003D58 0FBF842D[ACEE0400]                      movsx   eax, word [(mp3_synth_win+180h)+ebp*2]
  5724 00003D60 0FAFC2                                  imul    eax, edx
  5725 00003D63 01C3                                    add     ebx, eax
  5726 00003D65 8B14B5[749F0000]                        mov     edx, [(mp3_synth_buf+400h)+esi*4]
  5727 00003D6C 0FBF842D[2CEF0400]                      movsx   eax, word [(mp3_synth_win+200h)+ebp*2]
  5728 00003D74 0FAFC2                                  imul    eax, edx
  5729 00003D77 01C3                                    add     ebx, eax
  5730 00003D79 8B14B5[74A00000]                        mov     edx, [(mp3_synth_buf+500h)+esi*4]
  5731 00003D80 0FBF842D[ACEF0400]                      movsx   eax, word [(mp3_synth_win+280h)+ebp*2]
  5732 00003D88 0FAFC2                                  imul    eax, edx
  5733 00003D8B 01C3                                    add     ebx, eax
  5734 00003D8D 8B14B5[74A10000]                        mov     edx, [(mp3_synth_buf+600h)+esi*4]
  5735 00003D94 0FBF842D[2CF00400]                      movsx   eax, word [(mp3_synth_win+300h)+ebp*2]
  5736 00003D9C 0FAFC2                                  imul    eax, edx
  5737 00003D9F 01C3                                    add     ebx, eax
  5738 00003DA1 8B14B5[74A20000]                        mov     edx, [(mp3_synth_buf+700h)+esi*4]
  5739 00003DA8 0FBF842D[ACF00400]                      movsx   eax, word [(mp3_synth_win+380h)+ebp*2]
  5740 00003DB0 0FAFC2                                  imul    eax, edx
  5741 00003DB3 01C3                                    add     ebx, eax
  5742 00003DB5 8B14BD[749B0000]                        mov     edx, [mp3_synth_buf+edi*4]
  5743 00003DBC 0FBF842D[6CED0400]                      movsx   eax, word [(mp3_synth_win+40h)+ebp*2]
  5744 00003DC4 0FAFC2                                  imul    eax, edx
  5745 00003DC7 01C3                                    add     ebx, eax
  5746 00003DC9 8B14BD[749C0000]                        mov     edx, [(mp3_synth_buf+100h)+edi*4]
  5747 00003DD0 0FBF842D[ECED0400]                      movsx   eax, word [(mp3_synth_win+0C0h)+ebp*2]
  5748 00003DD8 0FAFC2                                  imul    eax, edx
  5749 00003DDB 01C3                                    add     ebx, eax
  5750 00003DDD 8B14BD[749D0000]                        mov     edx, [(mp3_synth_buf+200h)+edi*4]
  5751 00003DE4 0FBF842D[6CEE0400]                      movsx   eax, word [(mp3_synth_win+140h)+ebp*2]
  5752 00003DEC 0FAFC2                                  imul    eax, edx
  5753 00003DEF 01C3                                    add     ebx, eax
  5754 00003DF1 8B14BD[749E0000]                        mov     edx, [(mp3_synth_buf+300h)+edi*4]
  5755 00003DF8 0FBF842D[ECEE0400]                      movsx   eax, word [(mp3_synth_win+1C0h)+ebp*2]
  5756 00003E00 0FAFC2                                  imul    eax, edx
  5757 00003E03 01C3                                    add     ebx, eax
  5758 00003E05 8B14BD[749F0000]                        mov     edx, [(mp3_synth_buf+400h)+edi*4]
  5759 00003E0C 0FBF842D[6CEF0400]                      movsx   eax, word [(mp3_synth_win+240h)+ebp*2]
  5760 00003E14 0FAFC2                                  imul    eax, edx
  5761 00003E17 01C3                                    add     ebx, eax
  5762 00003E19 8B14BD[74A00000]                        mov     edx, [(mp3_synth_buf+500h)+edi*4]
  5763 00003E20 0FBF842D[ECEF0400]                      movsx   eax, word [(mp3_synth_win+2C0h)+ebp*2]
  5764 00003E28 0FAFC2                                  imul    eax, edx
  5765 00003E2B 01C3                                    add     ebx, eax
  5766 00003E2D 8B14BD[74A10000]                        mov     edx, [(mp3_synth_buf+600h)+edi*4]
  5767 00003E34 0FBF842D[6CF00400]                      movsx   eax, word [(mp3_synth_win+340h)+ebp*2]
  5768 00003E3C 0FAFC2                                  imul    eax, edx
  5769 00003E3F 01C3                                    add     ebx, eax
  5770 00003E41 8B14BD[74A20000]                        mov     edx, [(mp3_synth_buf+700h)+edi*4]
  5771 00003E48 0FBF842D[ECF00400]                      movsx   eax, word [(mp3_synth_win+3C0h)+ebp*2]
  5772 00003E50 0FAFC2                                  imul    eax, edx
  5773 00003E53 01C3                                    add     ebx, eax
  5774 00003E55 81FB00000040                            cmp     ebx, 40000000h
  5775 00003E5B 7328                                    jnb     short .sat
  5776 00003E5D C1FB0E                                  sar     ebx, 14
  5777 00003E60 81EB00800000                            sub     ebx, 8000h      ; make 16bit signed
  5778                                  
  5779                                  .sat_back:
  5780 00003E66 668919                                  mov     [ecx], bx
  5781 00003E69 030D[18F20000]                          add     ecx, [mp3_samples_dst_step]
  5782 00003E6F 83C604                                  add     esi, 4
  5783 00003E72 83EF04                                  sub     edi, 4
  5784 00003E75 83C504                                  add     ebp, 4
  5785 00003E78 F7C51F000000                            test    ebp, 1Fh
  5786 00003E7E 0F858CFEFFFF                            jnz     .samples_lop
  5787 00003E84 C3                                      retn
  5788                                  
  5789                                  .sat:
  5790 00003E85 C1FB1F                                  sar     ebx, 31
  5791 00003E88 81F3FF7F0000                            xor     ebx, 7FFFh
  5792 00003E8E EBD6                                    jmp     short .sat_back
  5793                                  
  5794                                  .append_copy_to_window:
  5795 00003E90 8D3485[749B0000]                        lea     esi, [mp3_synth_buf+eax*4]
  5796 00003E97 8DBE00080000                            lea     edi, [esi+2048]
  5797 00003E9D B912000000                              mov     ecx, 18
  5798 00003EA2 F3A5                                    rep movsd
  5799 00003EA4 E946FEFFFF                              jmp     .append_copy_to_window_back
  5800                                  
  5801                                  
  5802                                  ; =============== S U B R O U T I N E =======================================
  5803                                  
  5804                                  
  5805                                  synth_8bit_shift_0_fast:
  5806 00003EA9 F605[DC730000]10                        test    byte [cpuid_flags], 10h ; SYNTH_MACRO 1,0,1
  5807 00003EB0 740E                                    jz      short .no_rdtsc_supported
  5808 00003EB2 0F31                                    rdtsc
  5809 00003EB4 2905[54750000]                          sub     [rdtsc_synth_dct], eax
  5810 00003EBA 1915[58750000]                          sbb     [rdtsc_synth_dct+4], edx
  5811                                  
  5812                                  .no_rdtsc_supported:
  5813 00003EC0 BE[7CBB0000]                            mov	esi, mp3_sb_samples
  5814 00003EC5 8B3D[10F20000]                          mov	edi, [mp3_samples_dst]
  5815 00003ECB C705[1CF20000]0000-                     mov	dword [mp3_curr_channel], 0
  5815 00003ED3 0000               
  5816                                  
  5817                                  .synth_channel_lop:
  5818 00003ED5 56                                      push	esi
  5819 00003ED6 57                                      push	edi
  5820 00003ED7 893D[5C9B0000]                          mov	[mp3_curr_syn_dst], edi
  5821 00003EDD C705[24F20000]0000-                     mov	dword [mp3_curr_frame], 0
  5821 00003EE5 0000               
  5822                                  
  5823                                  .synth_frame_lop:
  5824 00003EE7 56                                      push    esi
  5825 00003EE8 F605[DC730000]10                        test    byte [cpuid_flags], 10h
  5826 00003EEF 740E                                    jz      short .no_rdtsc_supported@
  5827 00003EF1 0F31                                    rdtsc
  5828 00003EF3 2905[6C750000]                          sub     [rdtsc_dct32], eax
  5829 00003EF9 1915[70750000]                          sbb     [rdtsc_dct32+4], edx
  5830                                  
  5831                                  .no_rdtsc_supported@:
  5832 00003EFF 8B15[1CF20000]                          mov     edx, [mp3_curr_channel]
  5833 00003F05 8B0495[74BB0000]                        mov     eax, [mp3_synth_index+edx*4]
  5834 00003F0C 832C95[74BB0000]20                      sub     dword [mp3_synth_index+edx*4], 32
  5835 00003F14 C1E20A                                  shl     edx, 10
  5836 00003F17 25E0010000                              and     eax, 1E0h       ; 1FFh-1Fh
  5837 00003F1C 09D0                                    or      eax, edx
  5838 00003F1E A3[589B0000]                            mov     [mp3_curr_syn_index], eax
  5839 00003F23 8B3D[589B0000]                          mov     edi, [mp3_curr_syn_index]
  5840 00003F29 8D3CBD[749B0000]                        lea     edi, [mp3_synth_buf+edi*4]
  5841 00003F30 E873E6FFFF                              call    mp3_dct32_shift_0 ; mp3_dct32_shift_&rate_shift
  5842 00003F35 F605[DC730000]10                        test    byte [cpuid_flags], 10h
  5843 00003F3C 740E                                    jz      short .no_rdtsc_supported@@
  5844 00003F3E 0F31                                    rdtsc
  5845 00003F40 0105[6C750000]                          add     [rdtsc_dct32], eax
  5846 00003F46 1115[70750000]                          adc     [rdtsc_dct32+4], edx
  5847                                  
  5848                                  .no_rdtsc_supported@@:
  5849 00003F4C F605[DC730000]10                        test    byte [cpuid_flags], 10h
  5850 00003F53 740E                                    jz      short .no_rdtsc_supported@@@
  5851 00003F55 0F31                                    rdtsc
  5852 00003F57 2905[84750000]                          sub     [rdtsc_synth], eax
  5853 00003F5D 1915[88750000]                          sbb     [rdtsc_synth+4], edx
  5854                                  
  5855                                  .no_rdtsc_supported@@@:
  5856 00003F63 E888000000                              call    mp3_synth_filter_this_8bit_shift_0_fast ;
  5857                                                                          ; mp3_synth_filter_this_&force_8bit&_&rate_shift&_&force_fast
  5858 00003F68 F605[DC730000]10                        test    byte [cpuid_flags], 10h
  5859 00003F6F 740E                                    jz      short .no_rdtsc_supported@@@@
  5860 00003F71 0F31                                    rdtsc
  5861 00003F73 0105[84750000]                          add     [rdtsc_synth], eax
  5862 00003F79 1115[88750000]                          adc     [rdtsc_synth+4], edx
  5863                                  
  5864                                  .no_rdtsc_supported@@@@:
  5865 00003F7F 5E                                      pop     esi
  5866 00003F80 A1[18F20000]                            mov     eax, [mp3_samples_dst_step]
  5867 00003F85 C1E005                                  shl     eax, 5
  5868 00003F88 8A0D[D9730000]                          mov     cl, [option_rate_shift]
  5869 00003F8E D3E8                                    shr     eax, cl
  5870 00003F90 0105[5C9B0000]                          add     [mp3_curr_syn_dst], eax
  5871 00003F96 81C680000000                            add     esi, 128        ; SBLIMIT*4
  5872 00003F9C FF05[24F20000]                          inc     dword [mp3_curr_frame]
  5873 00003FA2 A1[24F20000]                            mov     eax, [mp3_curr_frame]
  5874 00003FA7 3B05[609B0000]                          cmp     eax, [mp3_nb_frames]
  5875 00003FAD 0F8234FFFFFF                            jb      .synth_frame_lop
  5876 00003FB3 5F                                      pop     edi
  5877 00003FB4 5E                                      pop     esi
  5878 00003FB5 033D[549B0000]                          add     edi, [mp3_bytes_per_sample]
  5879 00003FBB 81C600120000                            add     esi, 4608       ; 36*SBLIMIT*4
  5880 00003FC1 FF05[1CF20000]                          inc     dword [mp3_curr_channel]
  5881 00003FC7 A1[1CF20000]                            mov     eax, [mp3_curr_channel]
  5882 00003FCC 3B05[4C9B0000]                          cmp     eax, [mp3_output_num_channels]
  5883 00003FD2 0F82FDFEFFFF                            jb      .synth_channel_lop
  5884 00003FD8 F605[DC730000]10                        test    byte [cpuid_flags], 10h
  5885 00003FDF 740E                                    jz      short .no_rdtsc_supported@@@@@
  5886 00003FE1 0F31                                    rdtsc
  5887 00003FE3 0105[54750000]                          add     [rdtsc_synth_dct], eax
  5888 00003FE9 1115[58750000]                          adc     [rdtsc_synth_dct+4], edx
  5889                                  
  5890                                  .no_rdtsc_supported@@@@@:
  5891 00003FEF C3                                      retn
  5892                                  
  5893                                  
  5894                                  ; =============== S U B R O U T I N E =======================================
  5895                                  
  5896                                  
  5897                                  mp3_synth_filter_this_8bit_shift_0_fast:
  5898 00003FF0 A1[589B0000]                            mov     eax, [mp3_curr_syn_index]
  5899 00003FF5 A9E0010000                              test    eax, 1E0h       ; 1FFh-1Fh
  5900 00003FFA 0F8491010000                            jz      .append_copy_to_window
  5901 00004000 90                                      nop
  5902                                  
  5903                                  .append_copy_to_window_back:
  5904 00004001 89C5                                    mov     ebp, eax
  5905 00004003 81E5C0010000                            and     ebp, 1C0h       ; 1FFh-1Fh-20h
  5906 00004009 2520040000                              and     eax, 420h       ; 20h+(1 shl 10)
  5907 0000400E 8D7010                                  lea     esi, [eax+10h]
  5908 00004011 8D7830                                  lea     edi, [eax+30h]
  5909 00004014 F7DD                                    neg     ebp
  5910 00004016 81E5C0010000                            and     ebp, 1C0h
  5911 0000401C 8B0D[5C9B0000]                          mov     ecx, [mp3_curr_syn_dst]
  5912                                  
  5913                                  .samples_lop:
  5914 00004022 BB00002020                              mov     ebx, 20200000h  ; mov @@sum,(80h SHL (@@out_shift))+(1 SHL (@@out_shift-1))
  5915                                                                          ; @@out_shift equ (OUT_SHIFT_fast(8*force_8bit))
  5916                                                                          ; @@out_shift = 22
  5917 00004027 8B14B5[749B0000]                        mov     edx, [mp3_synth_buf+esi*4] ; @@SUM8 macro sum,win,ww,syn
  5918                                                                          ; @@SUM8 @@sum,@@win1,0,@@syn1
  5919                                                                          ; IRP nn,0,1,2,3,4,5,6,7
  5920                                                                          ; mov edx,dword ptr [mp3_synth_buf+syn*4+(nn*64*4)]
  5921                                                                          ; movsx eax,word ptr [mp3_synth_win+win*2+(nn*64*2)+ww*2]
  5922                                                                          ; imul eax,edx
  5923                                                                          ; add sum,eax
  5924 0000402E 0FBF842D[2CED0400]                      movsx   eax, word [mp3_synth_win+ebp*2]
  5925 00004036 0FAFC2                                  imul    eax, edx
  5926 00004039 01C3                                    add     ebx, eax
  5927 0000403B 8B14B5[749C0000]                        mov     edx, [(mp3_synth_buf+100h)+esi*4] ; nn=1
  5928 00004042 0FBF842D[ACED0400]                      movsx   eax, word [(mp3_synth_win+80h)+ebp*2] ; ww=0
  5929 0000404A 0FAFC2                                  imul    eax, edx
  5930 0000404D 01C3                                    add     ebx, eax
  5931 0000404F 8B14B5[749D0000]                        mov     edx, [(mp3_synth_buf+200h)+esi*4]
  5932 00004056 0FBF842D[2CEE0400]                      movsx   eax, word [(mp3_synth_win+100h)+ebp*2]
  5933 0000405E 0FAFC2                                  imul    eax, edx
  5934 00004061 01C3                                    add     ebx, eax
  5935 00004063 8B14B5[749E0000]                        mov     edx, [(mp3_synth_buf+300h)+esi*4]
  5936 0000406A 0FBF842D[ACEE0400]                      movsx   eax, word [(mp3_synth_win+180h)+ebp*2]
  5937 00004072 0FAFC2                                  imul    eax, edx
  5938 00004075 01C3                                    add     ebx, eax
  5939 00004077 8B14B5[749F0000]                        mov     edx, [(mp3_synth_buf+400h)+esi*4]
  5940 0000407E 0FBF842D[2CEF0400]                      movsx   eax, word [(mp3_synth_win+200h)+ebp*2]
  5941 00004086 0FAFC2                                  imul    eax, edx
  5942 00004089 01C3                                    add     ebx, eax
  5943 0000408B 8B14B5[74A00000]                        mov     edx, [(mp3_synth_buf+500h)+esi*4]
  5944 00004092 0FBF842D[ACEF0400]                      movsx   eax, word [(mp3_synth_win+280h)+ebp*2]
  5945 0000409A 0FAFC2                                  imul    eax, edx
  5946 0000409D 01C3                                    add     ebx, eax
  5947 0000409F 8B14B5[74A10000]                        mov     edx, [(mp3_synth_buf+600h)+esi*4]
  5948 000040A6 0FBF842D[2CF00400]                      movsx   eax, word [(mp3_synth_win+300h)+ebp*2]
  5949 000040AE 0FAFC2                                  imul    eax, edx
  5950 000040B1 01C3                                    add     ebx, eax
  5951 000040B3 8B14B5[74A20000]                        mov     edx, [(mp3_synth_buf+700h)+esi*4]
  5952 000040BA 0FBF842D[ACF00400]                      movsx   eax, word [(mp3_synth_win+380h)+ebp*2]
  5953 000040C2 0FAFC2                                  imul    eax, edx
  5954 000040C5 01C3                                    add     ebx, eax
  5955 000040C7 8B14BD[749B0000]                        mov     edx, [mp3_synth_buf+edi*4]
  5956 000040CE 0FBF842D[6CED0400]                      movsx   eax, word [(mp3_synth_win+40h)+ebp*2]
  5957 000040D6 0FAFC2                                  imul    eax, edx
  5958 000040D9 01C3                                    add     ebx, eax
  5959 000040DB 8B14BD[749C0000]                        mov     edx, [(mp3_synth_buf+100h)+edi*4]
  5960 000040E2 0FBF842D[ECED0400]                      movsx   eax, word [(mp3_synth_win+0C0h)+ebp*2]
  5961 000040EA 0FAFC2                                  imul    eax, edx
  5962 000040ED 01C3                                    add     ebx, eax
  5963 000040EF 8B14BD[749D0000]                        mov     edx, [(mp3_synth_buf+200h)+edi*4] ; nn=2
  5964 000040F6 0FBF842D[6CEE0400]                      movsx   eax, word [(mp3_synth_win+140h)+ebp*2] ; ww=32
  5965 000040FE 0FAFC2                                  imul    eax, edx
  5966 00004101 01C3                                    add     ebx, eax
  5967 00004103 8B14BD[749E0000]                        mov     edx, [(mp3_synth_buf+300h)+edi*4]
  5968 0000410A 0FBF842D[ECEE0400]                      movsx   eax, word [(mp3_synth_win+1C0h)+ebp*2]
  5969 00004112 0FAFC2                                  imul    eax, edx
  5970 00004115 01C3                                    add     ebx, eax
  5971 00004117 8B14BD[749F0000]                        mov     edx, [(mp3_synth_buf+400h)+edi*4]
  5972 0000411E 0FBF842D[6CEF0400]                      movsx   eax, word [(mp3_synth_win+240h)+ebp*2]
  5973 00004126 0FAFC2                                  imul    eax, edx
  5974 00004129 01C3                                    add     ebx, eax
  5975 0000412B 8B14BD[74A00000]                        mov     edx, [(mp3_synth_buf+500h)+edi*4]
  5976 00004132 0FBF842D[ECEF0400]                      movsx   eax, word [(mp3_synth_win+2C0h)+ebp*2]
  5977 0000413A 0FAFC2                                  imul    eax, edx
  5978 0000413D 01C3                                    add     ebx, eax
  5979 0000413F 8B14BD[74A10000]                        mov     edx, [(mp3_synth_buf+600h)+edi*4]
  5980 00004146 0FBF842D[6CF00400]                      movsx   eax, word [(mp3_synth_win+340h)+ebp*2]
  5981 0000414E 0FAFC2                                  imul    eax, edx
  5982 00004151 01C3                                    add     ebx, eax
  5983 00004153 8B14BD[74A20000]                        mov     edx, [(mp3_synth_buf+700h)+edi*4]
  5984 0000415A 0FBF842D[ECF00400]                      movsx   eax, word [(mp3_synth_win+3C0h)+ebp*2]
  5985 00004162 0FAFC2                                  imul    eax, edx
  5986 00004165 01C3                                    add     ebx, eax
  5987 00004167 81FB00000040                            cmp     ebx, 40000000h  ; cmp  @@sum,100h SHL (@@out_shift)
  5988 0000416D 731B                                    jnb     short .sat
  5989 0000416F C1FB16                                  sar     ebx, 22         ; sar @@sum,(@@out_shift)
  5990                                  
  5991                                  .sat_back:
  5992 00004172 8819                                    mov     [ecx], bl       ; mov byte ptr [@@dst],@@sum_8bit
  5993 00004174 030D[18F20000]                          add     ecx, [mp3_samples_dst_step]
  5994 0000417A 46                                      inc     esi             ; inc @@syn1
  5995 0000417B 4F                                      dec     edi             ; dec @@syn2
  5996 0000417C 45                                      inc     ebp             ; inc @@win1
  5997 0000417D F7C51F000000                            test    ebp, 1Fh        ; IF LONG_WINDOW
  5998                                                                          ; test @@win1,1fh
  5999 00004183 0F8599FEFFFF                            jnz     .samples_lop
  6000 00004189 C3                                      retn
  6001                                  
  6002                                  .sat:                                 
  6003 0000418A C1FB1F                                  sar     ebx, 31         ; sar @@sum,31 ; FFFFFFFFh,00000000h
  6004 0000418D F7D3                                    not     ebx             ; IF force_8bit
  6005                                                                          ; not @@sum ; 00000000h,FFFFFFFFh (unsigned 8bit)
  6006 0000418F EBE1                                    jmp     short .sat_back
  6007                                  
  6008                                  .append_copy_to_window:
  6009 00004191 8D3485[749B0000]                        lea     esi, [mp3_synth_buf+eax*4]
  6010 00004198 8DBE00080000                            lea     edi, [esi+2048] ; [esi+512*4]
  6011 0000419E B912000000                              mov     ecx, 18         ; (12h*4)/4
  6012 000041A3 F3A5                                    rep movsd
  6013 000041A5 E957FEFFFF                              jmp     .append_copy_to_window_back
  6014                                  
  6015                                  
  6016                                  ; =============== S U B R O U T I N E =======================================
  6017                                  
  6018                                  
  6019                                  synth_8bit_shift_1_fast:
  6020 000041AA F605[DC730000]10                        test    byte [cpuid_flags], 10h ; SYNTH_MACRO 1,1,1
  6021 000041B1 740E                                    jz      short .no_rdtsc_supported
  6022 000041B3 0F31                                    rdtsc
  6023 000041B5 2905[54750000]                          sub     [rdtsc_synth_dct], eax
  6024 000041BB 1915[58750000]                          sbb     [rdtsc_synth_dct+4], edx
  6025                                  
  6026                                  .no_rdtsc_supported:
  6027 000041C1 BE[7CBB0000]                            mov	esi, mp3_sb_samples
  6028 000041C6 8B3D[10F20000]                          mov	edi, [mp3_samples_dst]
  6029 000041CC C705[1CF20000]0000-                     mov	dword [mp3_curr_channel], 0
  6029 000041D4 0000               
  6030                                  
  6031                                  .synth_channel_lop:
  6032 000041D6 56                                      push	esi
  6033 000041D7 57                                      push	edi
  6034 000041D8 893D[5C9B0000]                          mov	[mp3_curr_syn_dst], edi
  6035 000041DE C705[24F20000]0000-                     mov	dword [mp3_curr_frame], 0
  6035 000041E6 0000               
  6036                                  
  6037                                  .synth_frame_lop:
  6038 000041E8 56                                      push    esi
  6039 000041E9 F605[DC730000]10                        test    byte [cpuid_flags], 10h
  6040 000041F0 740E                                    jz      short .no_rdtsc_supported@
  6041 000041F2 0F31                                    rdtsc
  6042 000041F4 2905[6C750000]                          sub     [rdtsc_dct32], eax
  6043 000041FA 1915[70750000]                          sbb     [rdtsc_dct32+4], edx
  6044                                  
  6045                                  .no_rdtsc_supported@:
  6046 00004200 8B15[1CF20000]                          mov     edx, [mp3_curr_channel]
  6047 00004206 8B0495[74BB0000]                        mov     eax, [mp3_synth_index+edx*4]
  6048 0000420D 832C95[74BB0000]20                      sub     dword [mp3_synth_index+edx*4], 32
  6049 00004215 C1E20A                                  shl     edx, 10
  6050 00004218 25E0010000                              and     eax, 1E0h       ; 1FFh-1Fh
  6051 0000421D 09D0                                    or      eax, edx
  6052 0000421F A3[589B0000]                            mov     [mp3_curr_syn_index], eax
  6053 00004224 8B3D[589B0000]                          mov     edi, [mp3_curr_syn_index]
  6054 0000422A 8D3CBD[749B0000]                        lea     edi, [mp3_synth_buf+edi*4]
  6055 00004231 E852ECFFFF                              call    mp3_dct32_shift_1 ; mp3_dct32_shift_&rate_shift
  6056 00004236 F605[DC730000]10                        test    byte [cpuid_flags], 10h
  6057 0000423D 740E                                    jz      short .no_rdtsc_supported@@
  6058 0000423F 0F31                                    rdtsc
  6059 00004241 0105[6C750000]                          add     [rdtsc_dct32], eax
  6060 00004247 1115[70750000]                          adc     [rdtsc_dct32+4], edx
  6061                                  
  6062                                  .no_rdtsc_supported@@:
  6063 0000424D F605[DC730000]10                        test    byte [cpuid_flags], 10h
  6064 00004254 740E                                    jz      short .no_rdtsc_supported@@@
  6065 00004256 0F31                                    rdtsc
  6066 00004258 2905[84750000]                          sub     [rdtsc_synth], eax
  6067 0000425E 1915[88750000]                          sbb     [rdtsc_synth+4], edx
  6068                                  
  6069                                  .no_rdtsc_supported@@@:
  6070 00004264 E888000000                              call    mp3_synth_filter_this_8bit_shift_1_fast ;
  6071                                                                          ; mp3_synth_filter_this_&force_8bit&_&rate_shift&_&force_fast
  6072 00004269 F605[DC730000]10                        test    byte [cpuid_flags], 10h
  6073 00004270 740E                                    jz      short .no_rdtsc_supported@@@@
  6074 00004272 0F31                                    rdtsc
  6075 00004274 0105[84750000]                          add     [rdtsc_synth], eax
  6076 0000427A 1115[88750000]                          adc     [rdtsc_synth+4], edx
  6077                                  
  6078                                  .no_rdtsc_supported@@@@:
  6079 00004280 5E                                      pop     esi
  6080 00004281 A1[18F20000]                            mov     eax, [mp3_samples_dst_step]
  6081 00004286 C1E005                                  shl     eax, 5
  6082 00004289 8A0D[D9730000]                          mov     cl, [option_rate_shift]
  6083 0000428F D3E8                                    shr     eax, cl
  6084 00004291 0105[5C9B0000]                          add     [mp3_curr_syn_dst], eax
  6085 00004297 81C680000000                            add     esi, 128        ; SBLIMIT*4
  6086 0000429D FF05[24F20000]                          inc     dword [mp3_curr_frame]
  6087 000042A3 A1[24F20000]                            mov     eax, [mp3_curr_frame]
  6088 000042A8 3B05[609B0000]                          cmp     eax, [mp3_nb_frames]
  6089 000042AE 0F8234FFFFFF                            jb      .synth_frame_lop
  6090 000042B4 5F                                      pop     edi
  6091 000042B5 5E                                      pop     esi
  6092 000042B6 033D[549B0000]                          add     edi, [mp3_bytes_per_sample]
  6093 000042BC 81C600120000                            add     esi, 4608       ; 36*SBLIMIT*4
  6094 000042C2 FF05[1CF20000]                          inc     dword [mp3_curr_channel]
  6095 000042C8 A1[1CF20000]                            mov     eax, [mp3_curr_channel]
  6096 000042CD 3B05[4C9B0000]                          cmp     eax, [mp3_output_num_channels]
  6097 000042D3 0F82FDFEFFFF                            jb      .synth_channel_lop
  6098 000042D9 F605[DC730000]10                        test    byte [cpuid_flags], 10h
  6099 000042E0 740E                                    jz      short .no_rdtsc_supported@@@@@
  6100 000042E2 0F31                                    rdtsc
  6101 000042E4 0105[54750000]                          add     [rdtsc_synth_dct], eax
  6102 000042EA 1115[58750000]                          adc     [rdtsc_synth_dct+4], edx
  6103                                  
  6104                                  .no_rdtsc_supported@@@@@:
  6105 000042F0 C3                                      retn
  6106                                  
  6107                                  
  6108                                  ; =============== S U B R O U T I N E =======================================
  6109                                  
  6110                                  
  6111                                  mp3_synth_filter_this_8bit_shift_1_fast:
  6112 000042F1 A1[589B0000]                            mov     eax, [mp3_curr_syn_index]
  6113 000042F6 A9E0010000                              test    eax, 1E0h
  6114 000042FB 0F8497010000                            jz      .append_copy_to_window
  6115 00004301 90                                      nop
  6116                                  
  6117                                  .append_copy_to_window_back:
  6118 00004302 89C5                                    mov     ebp, eax
  6119 00004304 81E5C0010000                            and     ebp, 1C0h
  6120 0000430A 2520040000                              and     eax, 420h
  6121 0000430F 8D7010                                  lea     esi, [eax+10h]
  6122 00004312 8D7830                                  lea     edi, [eax+30h]
  6123 00004315 F7DD                                    neg     ebp
  6124 00004317 81E5C0010000                            and     ebp, 1C0h
  6125 0000431D 8B0D[5C9B0000]                          mov     ecx, [mp3_curr_syn_dst]
  6126                                  
  6127                                  .samples_lop:
  6128 00004323 BB00002020                              mov     ebx, 20200000h
  6129 00004328 8B14B5[749B0000]                        mov     edx, [mp3_synth_buf+esi*4]
  6130 0000432F 0FBF842D[2CED0400]                      movsx   eax, word [mp3_synth_win+ebp*2]
  6131 00004337 0FAFC2                                  imul    eax, edx
  6132 0000433A 01C3                                    add     ebx, eax
  6133 0000433C 8B14B5[749C0000]                        mov     edx, [(mp3_synth_buf+100h)+esi*4]
  6134 00004343 0FBF842D[ACED0400]                      movsx   eax, word [(mp3_synth_win+80h)+ebp*2]
  6135 0000434B 0FAFC2                                  imul    eax, edx
  6136 0000434E 01C3                                    add     ebx, eax
  6137 00004350 8B14B5[749D0000]                        mov     edx, [(mp3_synth_buf+200h)+esi*4]
  6138 00004357 0FBF842D[2CEE0400]                      movsx   eax, word [(mp3_synth_win+100h)+ebp*2]
  6139 0000435F 0FAFC2                                  imul    eax, edx
  6140 00004362 01C3                                    add     ebx, eax
  6141 00004364 8B14B5[749E0000]                        mov     edx, [(mp3_synth_buf+300h)+esi*4]
  6142 0000436B 0FBF842D[ACEE0400]                      movsx   eax, word [(mp3_synth_win+180h)+ebp*2]
  6143 00004373 0FAFC2                                  imul    eax, edx
  6144 00004376 01C3                                    add     ebx, eax
  6145 00004378 8B14B5[749F0000]                        mov     edx, [(mp3_synth_buf+400h)+esi*4]
  6146 0000437F 0FBF842D[2CEF0400]                      movsx   eax, word [(mp3_synth_win+200h)+ebp*2]
  6147 00004387 0FAFC2                                  imul    eax, edx
  6148 0000438A 01C3                                    add     ebx, eax
  6149 0000438C 8B14B5[74A00000]                        mov     edx, [(mp3_synth_buf+500h)+esi*4]
  6150 00004393 0FBF842D[ACEF0400]                      movsx   eax, word [(mp3_synth_win+280h)+ebp*2]
  6151 0000439B 0FAFC2                                  imul    eax, edx
  6152 0000439E 01C3                                    add     ebx, eax
  6153 000043A0 8B14B5[74A10000]                        mov     edx, [(mp3_synth_buf+600h)+esi*4]
  6154 000043A7 0FBF842D[2CF00400]                      movsx   eax, word [(mp3_synth_win+300h)+ebp*2]
  6155 000043AF 0FAFC2                                  imul    eax, edx
  6156 000043B2 01C3                                    add     ebx, eax
  6157 000043B4 8B14B5[74A20000]                        mov     edx, [(mp3_synth_buf+700h)+esi*4]
  6158 000043BB 0FBF842D[ACF00400]                      movsx   eax, word [(mp3_synth_win+380h)+ebp*2]
  6159 000043C3 0FAFC2                                  imul    eax, edx
  6160 000043C6 01C3                                    add     ebx, eax
  6161 000043C8 8B14BD[749B0000]                        mov     edx, [mp3_synth_buf+edi*4]
  6162 000043CF 0FBF842D[6CED0400]                      movsx   eax, word [(mp3_synth_win+40h)+ebp*2]
  6163 000043D7 0FAFC2                                  imul    eax, edx
  6164 000043DA 01C3                                    add     ebx, eax
  6165 000043DC 8B14BD[749C0000]                        mov     edx, [(mp3_synth_buf+100h)+edi*4]
  6166 000043E3 0FBF842D[ECED0400]                      movsx   eax, word [(mp3_synth_win+0C0h)+ebp*2]
  6167 000043EB 0FAFC2                                  imul    eax, edx
  6168 000043EE 01C3                                    add     ebx, eax
  6169 000043F0 8B14BD[749D0000]                        mov     edx, [(mp3_synth_buf+200h)+edi*4]
  6170 000043F7 0FBF842D[6CEE0400]                      movsx   eax, word [(mp3_synth_win+140h)+ebp*2]
  6171 000043FF 0FAFC2                                  imul    eax, edx
  6172 00004402 01C3                                    add     ebx, eax
  6173 00004404 8B14BD[749E0000]                        mov     edx, [(mp3_synth_buf+300h)+edi*4]
  6174 0000440B 0FBF842D[ECEE0400]                      movsx   eax, word [(mp3_synth_win+1C0h)+ebp*2]
  6175 00004413 0FAFC2                                  imul    eax, edx
  6176 00004416 01C3                                    add     ebx, eax
  6177 00004418 8B14BD[749F0000]                        mov     edx, [(mp3_synth_buf+400h)+edi*4]
  6178 0000441F 0FBF842D[6CEF0400]                      movsx   eax, word [(mp3_synth_win+240h)+ebp*2]
  6179 00004427 0FAFC2                                  imul    eax, edx
  6180 0000442A 01C3                                    add     ebx, eax
  6181 0000442C 8B14BD[74A00000]                        mov     edx, [(mp3_synth_buf+500h)+edi*4]
  6182 00004433 0FBF842D[ECEF0400]                      movsx   eax, word [(mp3_synth_win+2C0h)+ebp*2]
  6183 0000443B 0FAFC2                                  imul    eax, edx
  6184 0000443E 01C3                                    add     ebx, eax
  6185 00004440 8B14BD[74A10000]                        mov     edx, [(mp3_synth_buf+600h)+edi*4]
  6186 00004447 0FBF842D[6CF00400]                      movsx   eax, word [(mp3_synth_win+340h)+ebp*2]
  6187 0000444F 0FAFC2                                  imul    eax, edx
  6188 00004452 01C3                                    add     ebx, eax
  6189 00004454 8B14BD[74A20000]                        mov     edx, [(mp3_synth_buf+700h)+edi*4]
  6190 0000445B 0FBF842D[ECF00400]                      movsx   eax, word [(mp3_synth_win+3C0h)+ebp*2]
  6191 00004463 0FAFC2                                  imul    eax, edx
  6192 00004466 01C3                                    add     ebx, eax
  6193 00004468 81FB00000040                            cmp     ebx, 40000000h
  6194 0000446E 7321                                    jnb     short .sat
  6195 00004470 C1FB16                                  sar     ebx, 22
  6196                                  
  6197                                  .sat_back:
  6198 00004473 8819                                    mov     [ecx], bl
  6199 00004475 030D[18F20000]                          add     ecx, [mp3_samples_dst_step]
  6200 0000447B 83C602                                  add     esi, 2
  6201 0000447E 83EF02                                  sub     edi, 2
  6202 00004481 83C502                                  add     ebp, 2
  6203 00004484 F7C51F000000                            test    ebp, 1Fh
  6204 0000448A 0F8593FEFFFF                            jnz     .samples_lop
  6205 00004490 C3                                      retn
  6206                                  
  6207                                  .sat:
  6208 00004491 C1FB1F                                  sar     ebx, 31
  6209 00004494 F7D3                                    not     ebx
  6210 00004496 EBDB                                    jmp     short .sat_back
  6211                                  
  6212                                  .append_copy_to_window:
  6213 00004498 8D3485[749B0000]                        lea     esi, [mp3_synth_buf+eax*4]
  6214 0000449F 8DBE00080000                            lea     edi, [esi+2048]
  6215 000044A5 B912000000                              mov     ecx, 18
  6216 000044AA F3A5                                    rep movsd
  6217 000044AC E951FEFFFF                              jmp     .append_copy_to_window_back
  6218                                  
  6219                                  
  6220                                  ; =============== S U B R O U T I N E =======================================
  6221                                  
  6222                                  
  6223                                  synth_8bit_shift_2_fast:
  6224 000044B1 F605[DC730000]10                        test    byte [cpuid_flags], 10h ; SYNTH_MACRO 1,2,1
  6225 000044B8 740E                                    jz      short .no_rdtsc_supported
  6226 000044BA 0F31                                    rdtsc
  6227 000044BC 2905[54750000]                          sub     [rdtsc_synth_dct], eax
  6228 000044C2 1915[58750000]                          sbb     [rdtsc_synth_dct+4], edx
  6229                                  
  6230                                  .no_rdtsc_supported:
  6231 000044C8 BE[7CBB0000]                            mov	esi, mp3_sb_samples
  6232 000044CD 8B3D[10F20000]                          mov	edi, [mp3_samples_dst]
  6233 000044D3 C705[1CF20000]0000-                     mov	dword [mp3_curr_channel], 0
  6233 000044DB 0000               
  6234                                  
  6235                                  .synth_channel_lop:
  6236 000044DD 56                                      push	esi
  6237 000044DE 57                                      push	edi
  6238 000044DF 893D[5C9B0000]                          mov	[mp3_curr_syn_dst], edi
  6239 000044E5 C705[24F20000]0000-                     mov	dword [mp3_curr_frame], 0
  6239 000044ED 0000               
  6240                                  
  6241                                  .synth_frame_lop:
  6242 000044EF 56                                      push    esi
  6243 000044F0 F605[DC730000]10                        test    byte [cpuid_flags], 10h
  6244 000044F7 740E                                    jz      short .no_rdtsc_supported@
  6245 000044F9 0F31                                    rdtsc
  6246 000044FB 2905[6C750000]                          sub     [rdtsc_dct32], eax
  6247 00004501 1915[70750000]                          sbb     [rdtsc_dct32+4], edx
  6248                                  
  6249                                  .no_rdtsc_supported@:
  6250 00004507 8B15[1CF20000]                          mov     edx, [mp3_curr_channel]
  6251 0000450D 8B0495[74BB0000]                        mov     eax, [mp3_synth_index+edx*4]
  6252 00004514 832C95[74BB0000]20                      sub     dword [mp3_synth_index+edx*4], 32
  6253 0000451C C1E20A                                  shl     edx, 10
  6254 0000451F 25E0010000                              and     eax, 1E0h       ; 1FFh-1Fh
  6255 00004524 09D0                                    or      eax, edx
  6256 00004526 A3[589B0000]                            mov     [mp3_curr_syn_index], eax
  6257 0000452B 8B3D[589B0000]                          mov     edi, [mp3_curr_syn_index]
  6258 00004531 8D3CBD[749B0000]                        lea     edi, [mp3_synth_buf+edi*4]
  6259 00004538 E83BEDFFFF                              call    mp3_dct32_shift_2 ; mp3_dct32_shift_&rate_shift
  6260 0000453D F605[DC730000]10                        test    byte [cpuid_flags], 10h
  6261 00004544 740E                                    jz      short .no_rdtsc_supported@@
  6262 00004546 0F31                                    rdtsc
  6263 00004548 0105[6C750000]                          add     [rdtsc_dct32], eax
  6264 0000454E 1115[70750000]                          adc     [rdtsc_dct32+4], edx
  6265                                  
  6266                                  .no_rdtsc_supported@@:
  6267 00004554 F605[DC730000]10                        test    byte [cpuid_flags], 10h
  6268 0000455B 740E                                    jz      short .no_rdtsc_supported@@@
  6269 0000455D 0F31                                    rdtsc
  6270 0000455F 2905[84750000]                          sub     [rdtsc_synth], eax
  6271 00004565 1915[88750000]                          sbb     [rdtsc_synth+4], edx
  6272                                  
  6273                                  .no_rdtsc_supported@@@:
  6274 0000456B E888000000                              call    mp3_synth_filter_this_8bit_shift_2_fast ;
  6275                                                                          ; mp3_synth_filter_this_&force_8bit&_&rate_shift&_&force_fast
  6276 00004570 F605[DC730000]10                        test    byte [cpuid_flags], 10h
  6277 00004577 740E                                    jz      short .no_rdtsc_supported@@@@
  6278 00004579 0F31                                    rdtsc
  6279 0000457B 0105[84750000]                          add     [rdtsc_synth], eax
  6280 00004581 1115[88750000]                          adc     [rdtsc_synth+4], edx
  6281                                  
  6282                                  .no_rdtsc_supported@@@@:
  6283 00004587 5E                                      pop     esi
  6284 00004588 A1[18F20000]                            mov     eax, [mp3_samples_dst_step]
  6285 0000458D C1E005                                  shl     eax, 5
  6286 00004590 8A0D[D9730000]                          mov     cl, [option_rate_shift]
  6287 00004596 D3E8                                    shr     eax, cl
  6288 00004598 0105[5C9B0000]                          add     [mp3_curr_syn_dst], eax
  6289 0000459E 81C680000000                            add     esi, 128        ; SBLIMIT*4
  6290 000045A4 FF05[24F20000]                          inc     dword [mp3_curr_frame]
  6291 000045AA A1[24F20000]                            mov     eax, [mp3_curr_frame]
  6292 000045AF 3B05[609B0000]                          cmp     eax, [mp3_nb_frames]
  6293 000045B5 0F8234FFFFFF                            jb      .synth_frame_lop
  6294 000045BB 5F                                      pop     edi
  6295 000045BC 5E                                      pop     esi
  6296 000045BD 033D[549B0000]                          add     edi, [mp3_bytes_per_sample]
  6297 000045C3 81C600120000                            add     esi, 4608       ; 36*SBLIMIT*4
  6298 000045C9 FF05[1CF20000]                          inc     dword [mp3_curr_channel]
  6299 000045CF A1[1CF20000]                            mov     eax, [mp3_curr_channel]
  6300 000045D4 3B05[4C9B0000]                          cmp     eax, [mp3_output_num_channels]
  6301 000045DA 0F82FDFEFFFF                            jb      .synth_channel_lop
  6302 000045E0 F605[DC730000]10                        test    byte [cpuid_flags], 10h
  6303 000045E7 740E                                    jz      short .no_rdtsc_supported@@@@@
  6304 000045E9 0F31                                    rdtsc
  6305 000045EB 0105[54750000]                          add     [rdtsc_synth_dct], eax
  6306 000045F1 1115[58750000]                          adc     [rdtsc_synth_dct+4], edx
  6307                                  
  6308                                  .no_rdtsc_supported@@@@@:
  6309 000045F7 C3                                      retn
  6310                                  
  6311                                  
  6312                                  ; =============== S U B R O U T I N E =======================================
  6313                                  
  6314                                  
  6315                                  mp3_synth_filter_this_8bit_shift_2_fast:
  6316 000045F8 A1[589B0000]                            mov     eax, [mp3_curr_syn_index]
  6317 000045FD A9E0010000                              test    eax, 1E0h
  6318 00004602 0F8497010000                            jz      .append_copy_to_window
  6319 00004608 90                                      nop
  6320                                  
  6321                                  .append_copy_to_window_back:
  6322 00004609 89C5                                    mov     ebp, eax
  6323 0000460B 81E5C0010000                            and     ebp, 1C0h
  6324 00004611 2520040000                              and     eax, 420h
  6325 00004616 8D7010                                  lea     esi, [eax+10h]
  6326 00004619 8D7830                                  lea     edi, [eax+30h]
  6327 0000461C F7DD                                    neg     ebp
  6328 0000461E 81E5C0010000                            and     ebp, 1C0h
  6329 00004624 8B0D[5C9B0000]                          mov     ecx, [mp3_curr_syn_dst]
  6330                                  
  6331                                  .samples_lop:
  6332 0000462A BB00002020                              mov     ebx, 20200000h
  6333 0000462F 8B14B5[749B0000]                        mov     edx, [mp3_synth_buf+esi*4]
  6334 00004636 0FBF842D[2CED0400]                      movsx   eax, word [mp3_synth_win+ebp*2]
  6335 0000463E 0FAFC2                                  imul    eax, edx
  6336 00004641 01C3                                    add     ebx, eax
  6337 00004643 8B14B5[749C0000]                        mov     edx, [(mp3_synth_buf+100h)+esi*4]
  6338 0000464A 0FBF842D[ACED0400]                      movsx   eax, word [(mp3_synth_win+80h)+ebp*2]
  6339 00004652 0FAFC2                                  imul    eax, edx
  6340 00004655 01C3                                    add     ebx, eax
  6341 00004657 8B14B5[749D0000]                        mov     edx, [(mp3_synth_buf+200h)+esi*4]
  6342 0000465E 0FBF842D[2CEE0400]                      movsx   eax, word [(mp3_synth_win+100h)+ebp*2]
  6343 00004666 0FAFC2                                  imul    eax, edx
  6344 00004669 01C3                                    add     ebx, eax
  6345 0000466B 8B14B5[749E0000]                        mov     edx, [(mp3_synth_buf+300h)+esi*4]
  6346 00004672 0FBF842D[ACEE0400]                      movsx   eax, word [(mp3_synth_win+180h)+ebp*2]
  6347 0000467A 0FAFC2                                  imul    eax, edx
  6348 0000467D 01C3                                    add     ebx, eax
  6349 0000467F 8B14B5[749F0000]                        mov     edx, [(mp3_synth_buf+400h)+esi*4]
  6350 00004686 0FBF842D[2CEF0400]                      movsx   eax, word [(mp3_synth_win+200h)+ebp*2]
  6351 0000468E 0FAFC2                                  imul    eax, edx
  6352 00004691 01C3                                    add     ebx, eax
  6353 00004693 8B14B5[74A00000]                        mov     edx, [(mp3_synth_buf+500h)+esi*4]
  6354 0000469A 0FBF842D[ACEF0400]                      movsx   eax, word [(mp3_synth_win+280h)+ebp*2]
  6355 000046A2 0FAFC2                                  imul    eax, edx
  6356 000046A5 01C3                                    add     ebx, eax
  6357 000046A7 8B14B5[74A10000]                        mov     edx, [(mp3_synth_buf+600h)+esi*4]
  6358 000046AE 0FBF842D[2CF00400]                      movsx   eax, word [(mp3_synth_win+300h)+ebp*2]
  6359 000046B6 0FAFC2                                  imul    eax, edx
  6360 000046B9 01C3                                    add     ebx, eax
  6361 000046BB 8B14B5[74A20000]                        mov     edx, [(mp3_synth_buf+700h)+esi*4]
  6362 000046C2 0FBF842D[ACF00400]                      movsx   eax, word [(mp3_synth_win+380h)+ebp*2]
  6363 000046CA 0FAFC2                                  imul    eax, edx
  6364 000046CD 01C3                                    add     ebx, eax
  6365 000046CF 8B14BD[749B0000]                        mov     edx, [mp3_synth_buf+edi*4]
  6366 000046D6 0FBF842D[6CED0400]                      movsx   eax, word [(mp3_synth_win+40h)+ebp*2]
  6367 000046DE 0FAFC2                                  imul    eax, edx
  6368 000046E1 01C3                                    add     ebx, eax
  6369 000046E3 8B14BD[749C0000]                        mov     edx, [(mp3_synth_buf+100h)+edi*4]
  6370 000046EA 0FBF842D[ECED0400]                      movsx   eax, word [(mp3_synth_win+0C0h)+ebp*2]
  6371 000046F2 0FAFC2                                  imul    eax, edx
  6372 000046F5 01C3                                    add     ebx, eax
  6373 000046F7 8B14BD[749D0000]                        mov     edx, [(mp3_synth_buf+200h)+edi*4]
  6374 000046FE 0FBF842D[6CEE0400]                      movsx   eax, word [(mp3_synth_win+140h)+ebp*2]
  6375 00004706 0FAFC2                                  imul    eax, edx
  6376 00004709 01C3                                    add     ebx, eax
  6377 0000470B 8B14BD[749E0000]                        mov     edx, [(mp3_synth_buf+300h)+edi*4]
  6378 00004712 0FBF842D[ECEE0400]                      movsx   eax, word [(mp3_synth_win+1C0h)+ebp*2]
  6379 0000471A 0FAFC2                                  imul    eax, edx
  6380 0000471D 01C3                                    add     ebx, eax
  6381 0000471F 8B14BD[749F0000]                        mov     edx, [(mp3_synth_buf+400h)+edi*4]
  6382 00004726 0FBF842D[6CEF0400]                      movsx   eax, word [(mp3_synth_win+240h)+ebp*2]
  6383 0000472E 0FAFC2                                  imul    eax, edx
  6384 00004731 01C3                                    add     ebx, eax
  6385 00004733 8B14BD[74A00000]                        mov     edx, [(mp3_synth_buf+500h)+edi*4]
  6386 0000473A 0FBF842D[ECEF0400]                      movsx   eax, word [(mp3_synth_win+2C0h)+ebp*2]
  6387 00004742 0FAFC2                                  imul    eax, edx
  6388 00004745 01C3                                    add     ebx, eax
  6389 00004747 8B14BD[74A10000]                        mov     edx, [(mp3_synth_buf+600h)+edi*4]
  6390 0000474E 0FBF842D[6CF00400]                      movsx   eax, word [(mp3_synth_win+340h)+ebp*2]
  6391 00004756 0FAFC2                                  imul    eax, edx
  6392 00004759 01C3                                    add     ebx, eax
  6393 0000475B 8B14BD[74A20000]                        mov     edx, [(mp3_synth_buf+700h)+edi*4]
  6394 00004762 0FBF842D[ECF00400]                      movsx   eax, word [(mp3_synth_win+3C0h)+ebp*2]
  6395 0000476A 0FAFC2                                  imul    eax, edx
  6396 0000476D 01C3                                    add     ebx, eax
  6397 0000476F 81FB00000040                            cmp     ebx, 40000000h
  6398 00004775 7321                                    jnb     short .sat
  6399 00004777 C1FB16                                  sar     ebx, 22
  6400                                  
  6401                                  .sat_back:
  6402 0000477A 8819                                    mov     [ecx], bl
  6403 0000477C 030D[18F20000]                          add     ecx, [mp3_samples_dst_step]
  6404 00004782 83C604                                  add     esi, 4
  6405 00004785 83EF04                                  sub     edi, 4
  6406 00004788 83C504                                  add     ebp, 4
  6407 0000478B F7C51F000000                            test    ebp, 1Fh
  6408 00004791 0F8593FEFFFF                            jnz     .samples_lop
  6409 00004797 C3                                      retn
  6410                                  
  6411                                  .sat:
  6412 00004798 C1FB1F                                  sar     ebx, 31
  6413 0000479B F7D3                                    not     ebx
  6414 0000479D EBDB                                    jmp     short .sat_back
  6415                                  
  6416                                  .append_copy_to_window:
  6417 0000479F 8D3485[749B0000]                        lea     esi, [mp3_synth_buf+eax*4]
  6418 000047A6 8DBE00080000                            lea     edi, [esi+2048]
  6419 000047AC B912000000                              mov     ecx, 18
  6420 000047B1 F3A5                                    rep movsd
  6421 000047B3 E951FEFFFF                              jmp     .append_copy_to_window_back
  6422                                  
  6423                                  
  6424                                  ; =============== S U B R O U T I N E =======================================
  6425                                  
  6426                                  
  6427                                  synth_16bit_shift_0_slow:
  6428 000047B8 F605[DC730000]10                        test    byte [cpuid_flags], 10h
  6429 000047BF 740E                                    jz      short .no_rdtsc_supported
  6430 000047C1 0F31                                    rdtsc
  6431 000047C3 2905[54750000]                          sub     [rdtsc_synth_dct], eax
  6432 000047C9 1915[58750000]                          sbb     [rdtsc_synth_dct+4], edx
  6433                                  
  6434                                  .no_rdtsc_supported:
  6435 000047CF BE[7CBB0000]                            mov	esi, mp3_sb_samples
  6436 000047D4 8B3D[10F20000]                          mov	edi, [mp3_samples_dst]
  6437 000047DA C705[1CF20000]0000-                     mov	dword [mp3_curr_channel], 0
  6437 000047E2 0000               
  6438                                  
  6439                                  .synth_channel_lop:
  6440 000047E4 56                                      push	esi
  6441 000047E5 57                                      push	edi
  6442 000047E6 893D[5C9B0000]                          mov	[mp3_curr_syn_dst], edi
  6443 000047EC C705[24F20000]0000-                     mov	dword [mp3_curr_frame], 0
  6443 000047F4 0000               
  6444                                  
  6445                                  .synth_frame_lop:
  6446 000047F6 56                                      push    esi
  6447 000047F7 F605[DC730000]10                        test    byte [cpuid_flags], 10h
  6448 000047FE 740E                                    jz      short .no_rdtsc_supported@
  6449 00004800 0F31                                    rdtsc
  6450 00004802 2905[6C750000]                          sub     [rdtsc_dct32], eax
  6451 00004808 1915[70750000]                          sbb     [rdtsc_dct32+4], edx
  6452                                  
  6453                                  .no_rdtsc_supported@:
  6454 0000480E 8B15[1CF20000]                          mov     edx, [mp3_curr_channel]
  6455 00004814 8B0495[74BB0000]                        mov     eax, [mp3_synth_index+edx*4]
  6456 0000481B 832C95[74BB0000]20                      sub     dword [mp3_synth_index+edx*4], 32
  6457 00004823 C1E20A                                  shl     edx, 10         ; channel*1024
  6458 00004826 25E0010000                              and     eax, 1E0h       ; 1FFh-1Fh
  6459 0000482B 09D0                                    or      eax, edx
  6460 0000482D A3[589B0000]                            mov     [mp3_curr_syn_index], eax
  6461 00004832 8B3D[589B0000]                          mov     edi, [mp3_curr_syn_index]
  6462 00004838 8D3CBD[749B0000]                        lea     edi, [mp3_synth_buf+edi*4]
  6463 0000483F E864DDFFFF                              call    mp3_dct32_shift_0 ; mp3_dct32_shift_&rate_shift
  6464 00004844 F605[DC730000]10                        test    byte [cpuid_flags], 10h ; timelog_end rdtsc_dct32
  6465 0000484B 740E                                    jz      short .no_rdtsc_supported@@
  6466 0000484D 0F31                                    rdtsc
  6467 0000484F 0105[6C750000]                          add     [rdtsc_dct32], eax
  6468 00004855 1115[70750000]                          adc     [rdtsc_dct32+4], edx
  6469                                  
  6470                                  .no_rdtsc_supported@@:
  6471 0000485B F605[DC730000]10                        test    byte [cpuid_flags], 10h ; timelog_start rdtsc_synth
  6472 00004862 740E                                    jz      short .no_rdtsc_supported@@@
  6473 00004864 0F31                                    rdtsc
  6474 00004866 2905[84750000]                          sub     [rdtsc_synth], eax
  6475 0000486C 1915[88750000]                          sbb     [rdtsc_synth+4], edx
  6476                                  
  6477                                  .no_rdtsc_supported@@@:
  6478 00004872 E888000000                              call    mp3_synth_filter_this_16bit_shift_0_slow
  6479 00004877 F605[DC730000]10                        test    byte [cpuid_flags], 10h ; timelog_end rdtsc_synth
  6480 0000487E 740E                                    jz      short .no_rdtsc_supported@@@@
  6481 00004880 0F31                                    rdtsc
  6482 00004882 0105[84750000]                          add     [rdtsc_synth], eax
  6483 00004888 1115[88750000]                          adc     [rdtsc_synth+4], edx
  6484                                  
  6485                                  .no_rdtsc_supported@@@@:
  6486 0000488E 5E                                      pop     esi
  6487 0000488F A1[18F20000]                            mov     eax, [mp3_samples_dst_step]
  6488 00004894 C1E005                                  shl     eax, 5
  6489 00004897 8A0D[D9730000]                          mov     cl, [option_rate_shift]
  6490 0000489D D3E8                                    shr     eax, cl
  6491 0000489F 0105[5C9B0000]                          add     [mp3_curr_syn_dst], eax
  6492 000048A5 81C680000000                            add     esi, 128        ; SBLIMIT*4
  6493 000048AB FF05[24F20000]                          inc     dword [mp3_curr_frame]
  6494 000048B1 A1[24F20000]                            mov     eax, [mp3_curr_frame]
  6495 000048B6 3B05[609B0000]                          cmp     eax, [mp3_nb_frames]
  6496 000048BC 0F8234FFFFFF                            jb      .synth_frame_lop
  6497 000048C2 5F                                      pop     edi
  6498 000048C3 5E                                      pop     esi
  6499 000048C4 033D[549B0000]                          add     edi, [mp3_bytes_per_sample]
  6500 000048CA 81C600120000                            add     esi, 4608       ; 36*SBLIMIT*4
  6501 000048D0 FF05[1CF20000]                          inc     dword [mp3_curr_channel]
  6502 000048D6 A1[1CF20000]                            mov     eax, [mp3_curr_channel]
  6503 000048DB 3B05[4C9B0000]                          cmp     eax, [mp3_output_num_channels]
  6504 000048E1 0F82FDFEFFFF                            jb      .synth_channel_lop
  6505 000048E7 F605[DC730000]10                        test    byte [cpuid_flags], 10h ; timelog_end rdtsc_synth_dct
  6506 000048EE 740E                                    jz      short .no_rdtsc_supported@@@@@
  6507 000048F0 0F31                                    rdtsc
  6508 000048F2 0105[54750000]                          add     [rdtsc_synth_dct], eax
  6509 000048F8 1115[58750000]                          adc     [rdtsc_synth_dct+4], edx
  6510                                  
  6511                                  .no_rdtsc_supported@@@@@:
  6512 000048FE C3                                      retn
  6513                                  
  6514                                  
  6515                                  ; =============== S U B R O U T I N E =======================================
  6516                                  
  6517                                  
  6518                                  mp3_synth_filter_this_16bit_shift_0_slow:
  6519 000048FF A1[589B0000]                            mov     eax, [mp3_curr_syn_index]
  6520 00004904 A9E0010000                              test    eax, 1E0h       ; 1FFh-1Fh
  6521 00004909 0F847C010000                            jz      .append_copy_to_window
  6522 0000490F 90                                      nop
  6523                                  
  6524                                  .append_copy_to_window_back:
  6525 00004910 89C5                                    mov     ebp, eax        ; mov @@win1,eax
  6526 00004912 81E5C0010000                            and     ebp, 1C0h       ; and @@win1,1FFh-1Fh-20h
  6527 00004918 2520040000                              and     eax, 420h       ; and eax,20h+(1 shl 10) ; bit5, and channel
  6528 0000491D 8D7010                                  lea     esi, [eax+10h]  ; lea @@syn1,[eax+10h]
  6529 00004920 8D7830                                  lea     edi, [eax+30h]  ; lea @@syn2,[eax+30h]
  6530 00004923 F7DD                                    neg     ebp
  6531 00004925 81E5C0010000                            and     ebp, 1C0h       ; and @@win1,1FFh-1Fh-20h
  6532 0000492B 8B0D[5C9B0000]                          mov     ecx, [mp3_curr_syn_dst]
  6533                                  
  6534                                  .samples_lop:
  6535 00004931 BB10001000                              mov     ebx, 100010h    ; mov @@sum,(8000h SHL (@@out_shift))+(1 SHL (@@out_shift-1))
  6536                                                                          ; @@out_shift = 5
  6537                                  
  6538                                  .SUM8_@:                                ; @@SUM8 macro sum,win,ww,syn
  6539 00004936 8B14B5[749B0000]                        mov     edx, [mp3_synth_buf+esi*4] ; IRP nn,0,1,2,3,4,5,6,7
  6540                                                                          ; @@SUM8 @@sum,@@win1,0, @@syn1
  6541 0000493D 8B04AD[2CED0400]                        mov     eax, [mp3_synth_win+ebp*4] ; [mp3_synth_buf+syn*4+(nn*64*4)]
  6542 00004944 F7EA                                    imul    edx             ; [mp3_synth_win+win*4+(nn*64*4)+ww*4]
  6543 00004946 01D3                                    add     ebx, edx
  6544 00004948 8B14B5[749C0000]                        mov     edx, [(mp3_synth_buf+100h)+esi*4]
  6545 0000494F 8B04AD[2CEE0400]                        mov     eax, [(mp3_synth_win+100h)+ebp*4]
  6546 00004956 F7EA                                    imul    edx
  6547 00004958 01D3                                    add     ebx, edx        ; add sum,edx
  6548 0000495A 8B14B5[749D0000]                        mov     edx, [(mp3_synth_buf+200h)+esi*4]
  6549 00004961 8B04AD[2CEF0400]                        mov     eax, [(mp3_synth_win+200h)+ebp*4] ; [mp3_synth_win+win*4+(nn*64*4)+ww*4]
  6550 00004968 F7EA                                    imul    edx             ; 64bit = 32bit * 32bit
  6551 0000496A 01D3                                    add     ebx, edx
  6552 0000496C 8B14B5[749E0000]                        mov     edx, [(mp3_synth_buf+300h)+esi*4]
  6553 00004973 8B04AD[2CF00400]                        mov     eax, [(mp3_synth_win+300h)+ebp*4]
  6554 0000497A F7EA                                    imul    edx
  6555 0000497C 01D3                                    add     ebx, edx
  6556 0000497E 8B14B5[749F0000]                        mov     edx, [(mp3_synth_buf+400h)+esi*4]
  6557 00004985 8B04AD[2CF10400]                        mov     eax, [(mp3_synth_win+400h)+ebp*4]
  6558 0000498C F7EA                                    imul    edx
  6559 0000498E 01D3                                    add     ebx, edx
  6560 00004990 8B14B5[74A00000]                        mov     edx, [(mp3_synth_buf+500h)+esi*4]
  6561 00004997 8B04AD[2CF20400]                        mov     eax, [(mp3_synth_win+500h)+ebp*4]
  6562 0000499E F7EA                                    imul    edx
  6563 000049A0 01D3                                    add     ebx, edx
  6564 000049A2 8B14B5[74A10000]                        mov     edx, [(mp3_synth_buf+600h)+esi*4]
  6565 000049A9 8B04AD[2CF30400]                        mov     eax, [(mp3_synth_win+600h)+ebp*4]
  6566 000049B0 F7EA                                    imul    edx
  6567 000049B2 01D3                                    add     ebx, edx
  6568 000049B4 8B14B5[74A20000]                        mov     edx, [(mp3_synth_buf+700h)+esi*4]
  6569 000049BB 8B04AD[2CF40400]                        mov     eax, [(mp3_synth_win+700h)+ebp*4]
  6570 000049C2 F7EA                                    imul    edx
  6571 000049C4 01D3                                    add     ebx, edx
  6572                                  
  6573                                  .skippp:                               ; @@SUM8 macro sum,win,ww,syn
  6574 000049C6 8B14BD[749B0000]                        mov     edx, [mp3_synth_buf+edi*4] ; @@SUM8 @@sum,@@win1,32,@@syn2
  6575                                                                          ; [mp3_synth_buf+syn*4+(nn*64*4)]
  6576 000049CD 8B04AD[ACED0400]                        mov     eax, [(mp3_synth_win+80h)+ebp*4] ; [mp3_synth_win+win*4+(nn*64*4)+ww*4]
  6577 000049D4 F7EA                                    imul    edx
  6578 000049D6 01D3                                    add     ebx, edx
  6579 000049D8 8B14BD[749C0000]                        mov     edx, [(mp3_synth_buf+100h)+edi*4]
  6580 000049DF 8B04AD[ACEE0400]                        mov     eax, [(mp3_synth_win+180h)+ebp*4]
  6581 000049E6 F7EA                                    imul    edx
  6582 000049E8 01D3                                    add     ebx, edx
  6583 000049EA 8B14BD[749D0000]                        mov     edx, [(mp3_synth_buf+200h)+edi*4]
  6584 000049F1 8B04AD[ACEF0400]                        mov     eax, [(mp3_synth_win+280h)+ebp*4]
  6585 000049F8 F7EA                                    imul    edx
  6586 000049FA 01D3                                    add     ebx, edx
  6587 000049FC 8B14BD[749E0000]                        mov     edx, [(mp3_synth_buf+300h)+edi*4]
  6588 00004A03 8B04AD[ACF00400]                        mov     eax, [(mp3_synth_win+380h)+ebp*4]
  6589 00004A0A F7EA                                    imul    edx
  6590 00004A0C 01D3                                    add     ebx, edx
  6591 00004A0E 8B14BD[749F0000]                        mov     edx, [(mp3_synth_buf+400h)+edi*4]
  6592 00004A15 8B04AD[ACF10400]                        mov     eax, [(mp3_synth_win+480h)+ebp*4]
  6593 00004A1C F7EA                                    imul    edx
  6594 00004A1E 01D3                                    add     ebx, edx
  6595 00004A20 8B14BD[74A00000]                        mov     edx, [(mp3_synth_buf+500h)+edi*4]
  6596 00004A27 8B04AD[ACF20400]                        mov     eax, [(mp3_synth_win+580h)+ebp*4]
  6597 00004A2E F7EA                                    imul    edx
  6598 00004A30 01D3                                    add     ebx, edx
  6599 00004A32 8B14BD[74A10000]                        mov     edx, [(mp3_synth_buf+600h)+edi*4]
  6600 00004A39 8B04AD[ACF30400]                        mov     eax, [(mp3_synth_win+680h)+ebp*4]
  6601 00004A40 F7EA                                    imul    edx
  6602 00004A42 01D3                                    add     ebx, edx
  6603 00004A44 8B14BD[74A20000]                        mov     edx, [(mp3_synth_buf+700h)+edi*4]
  6604 00004A4B 8B04AD[ACF40400]                        mov     eax, [(mp3_synth_win+780h)+ebp*4]
  6605 00004A52 F7EA                                    imul    edx
  6606 00004A54 01D3                                    add     ebx, edx
  6607 00004A56 81FB00002000                            cmp     ebx, 200000h    ; cmp @@sum,10000h SHL (@@out_shift)
  6608 00004A5C 7322                                    jnb     short .sat
  6609 00004A5E C1FB05                                  sar     ebx, 5          ; sar @@sum,(@@out_shift)
  6610 00004A61 81EB00800000                            sub     ebx, 8000h      ; make 16bit signed
  6611                                  
  6612                                  .sat_back:
  6613 00004A67 668919                                  mov     [ecx], bx
  6614 00004A6A 030D[18F20000]                          add     ecx, [mp3_samples_dst_step]
  6615 00004A70 46                                      inc     esi             ; inc @@syn1
  6616 00004A71 4F                                      dec     edi             ; dec @@syn2
  6617 00004A72 45                                      inc     ebp             ; inc @@win1
  6618 00004A73 F7C51F000000                            test    ebp, 1Fh        ; test @@win1,1Fh
  6619 00004A79 0F85B2FEFFFF                            jnz     .samples_lop
  6620 00004A7F C3                                      retn
  6621                                  
  6622                                  .sat:
  6623 00004A80 C1FB1F                                  sar     ebx, 31         ; FFFFFFFFh,00000000h
  6624 00004A83 81F3FF7F0000                            xor     ebx, 7FFFh      ; FFFF8000h,00007FFFh (signed 16bit)
  6625 00004A89 EBDC                                    jmp     short .sat_back
  6626                                  
  6627                                  .append_copy_to_window:
  6628 00004A8B 8D3485[749B0000]                        lea     esi, [mp3_synth_buf+eax*4]
  6629 00004A92 8DBE00080000                            lea     edi, [esi+2048] ; [esi+512*4]
  6630 00004A98 B912000000                              mov     ecx, 18         ; (12h*4)/4
  6631 00004A9D F3A5                                    rep movsd
  6632 00004A9F E96CFEFFFF                              jmp     .append_copy_to_window_back
  6633                                  
  6634                                  
  6635                                  ; =============== S U B R O U T I N E =======================================
  6636                                  
  6637                                  
  6638                                  synth_16bit_shift_1_slow:
  6639 00004AA4 F605[DC730000]10                        test    byte [cpuid_flags], 10h ; SYNTH_MACRO 0,1,0
  6640 00004AAB 740E                                    jz      short .no_rdtsc_supported
  6641 00004AAD 0F31                                    rdtsc
  6642 00004AAF 2905[54750000]                          sub     [rdtsc_synth_dct], eax
  6643 00004AB5 1915[58750000]                          sbb     [rdtsc_synth_dct+4], edx
  6644                                  
  6645                                  .no_rdtsc_supported:
  6646 00004ABB BE[7CBB0000]                            mov	esi, mp3_sb_samples
  6647 00004AC0 8B3D[10F20000]                          mov	edi, [mp3_samples_dst]
  6648 00004AC6 C705[1CF20000]0000-                     mov	dword [mp3_curr_channel], 0
  6648 00004ACE 0000               
  6649                                  
  6650                                  .synth_channel_lop:
  6651 00004AD0 56                                      push	esi
  6652 00004AD1 57                                      push	edi
  6653 00004AD2 893D[5C9B0000]                          mov	[mp3_curr_syn_dst], edi
  6654 00004AD8 C705[24F20000]0000-                     mov	dword [mp3_curr_frame], 0
  6654 00004AE0 0000               
  6655                                  
  6656                                  .synth_frame_lop:
  6657 00004AE2 56                                      push    esi
  6658 00004AE3 F605[DC730000]10                        test    byte [cpuid_flags], 10h
  6659 00004AEA 740E                                    jz      short .no_rdtsc_supported@
  6660 00004AEC 0F31                                    rdtsc
  6661 00004AEE 2905[6C750000]                          sub     [rdtsc_dct32], eax
  6662 00004AF4 1915[70750000]                          sbb     [rdtsc_dct32+4], edx
  6663                                  
  6664                                  .no_rdtsc_supported@:
  6665 00004AFA 8B15[1CF20000]                          mov     edx, [mp3_curr_channel]
  6666 00004B00 8B0495[74BB0000]                        mov     eax, [mp3_synth_index+edx*4]
  6667 00004B07 832C95[74BB0000]20                      sub     dword [mp3_synth_index+edx*4], 32
  6668 00004B0F C1E20A                                  shl     edx, 10         ; channel*1024
  6669 00004B12 25E0010000                              and     eax, 1E0h       ; 1FFh-1Fh ; index(0..511), align 32
  6670 00004B17 09D0                                    or      eax, edx
  6671 00004B19 A3[589B0000]                            mov     [mp3_curr_syn_index], eax
  6672 00004B1E 8B3D[589B0000]                          mov     edi, [mp3_curr_syn_index]
  6673 00004B24 8D3CBD[749B0000]                        lea     edi, [mp3_synth_buf+edi*4]
  6674 00004B2B E858E3FFFF                              call    mp3_dct32_shift_1 ; call mp3_dct32_shift_&rate_shift
  6675 00004B30 F605[DC730000]10                        test    byte [cpuid_flags], 10h
  6676 00004B37 740E                                    jz      short .no_rdtsc_supported@@
  6677 00004B39 0F31                                    rdtsc
  6678 00004B3B 0105[6C750000]                          add     [rdtsc_dct32], eax
  6679 00004B41 1115[70750000]                          adc     [rdtsc_dct32+4], edx
  6680                                  
  6681                                  .no_rdtsc_supported@@:
  6682 00004B47 F605[DC730000]10                        test    byte [cpuid_flags], 10h
  6683 00004B4E 740E                                    jz      short .no_rdtsc_supported@@@
  6684 00004B50 0F31                                    rdtsc
  6685 00004B52 2905[84750000]                          sub     [rdtsc_synth], eax
  6686 00004B58 1915[88750000]                          sbb     [rdtsc_synth+4], edx
  6687                                  
  6688                                  .no_rdtsc_supported@@@:
  6689 00004B5E E888000000                              call    mp3_synth_filter_this_16bit_shift_1_slow ;
  6690                                                                          ; mp3_synth_filter_this_&force_8bit&_&rate_shift&_&force_fast
  6691 00004B63 F605[DC730000]10                        test    byte [cpuid_flags], 10h
  6692 00004B6A 740E                                    jz      short .no_rdtsc_supported@@@@
  6693 00004B6C 0F31                                    rdtsc
  6694 00004B6E 0105[84750000]                          add     [rdtsc_synth], eax
  6695 00004B74 1115[88750000]                          adc     [rdtsc_synth+4], edx
  6696                                  
  6697                                  .no_rdtsc_supported@@@@:
  6698 00004B7A 5E                                      pop     esi
  6699 00004B7B A1[18F20000]                            mov     eax, [mp3_samples_dst_step]
  6700 00004B80 C1E005                                  shl     eax, 5
  6701 00004B83 8A0D[D9730000]                          mov     cl, [option_rate_shift] ; IF with_rate_shift
  6702 00004B89 D3E8                                    shr     eax, cl
  6703 00004B8B 0105[5C9B0000]                          add     [mp3_curr_syn_dst], eax
  6704 00004B91 81C680000000                            add     esi, 128        ; SBLIMIT*4  ; src+32*4
  6705 00004B97 FF05[24F20000]                          inc	dword [mp3_curr_frame]
  6706 00004B9D A1[24F20000]                            mov     eax, [mp3_curr_frame]
  6707 00004BA2 3B05[609B0000]                          cmp     eax, [mp3_nb_frames]
  6708 00004BA8 0F8234FFFFFF                            jb      .synth_frame_lop
  6709 00004BAE 5F                                      pop     edi
  6710 00004BAF 5E                                      pop     esi
  6711 00004BB0 033D[549B0000]                          add     edi, [mp3_bytes_per_sample]
  6712 00004BB6 81C600120000                            add     esi, 4608       ; 36*SBLIMIT*4 ; src
  6713 00004BBC FF05[1CF20000]                          inc	dword [mp3_curr_channel]
  6714 00004BC2 A1[1CF20000]                            mov     eax, [mp3_curr_channel]
  6715 00004BC7 3B05[4C9B0000]                          cmp     eax, [mp3_output_num_channels]
  6716 00004BCD 0F82FDFEFFFF                            jb      .synth_channel_lop
  6717 00004BD3 F605[DC730000]10                        test    byte [cpuid_flags], 10h
  6718 00004BDA 740E                                    jz      short .no_rdtsc_supported@@@@@
  6719 00004BDC 0F31                                    rdtsc
  6720 00004BDE 0105[54750000]                          add     [rdtsc_synth_dct], eax
  6721 00004BE4 1115[58750000]                          adc     [rdtsc_synth_dct+4], edx
  6722                                  
  6723                                  .no_rdtsc_supported@@@@@:
  6724 00004BEA C3                                      retn
  6725                                  
  6726                                  
  6727                                  ; =============== S U B R O U T I N E =======================================
  6728                                  
  6729                                  
  6730                                  mp3_synth_filter_this_16bit_shift_1_slow:
  6731 00004BEB A1[589B0000]                            mov     eax, [mp3_curr_syn_index]
  6732 00004BF0 A9E0010000                              test    eax, 1E0h
  6733 00004BF5 0F8482010000                            jz      .append_copy_to_window
  6734 00004BFB 90                                      nop
  6735                                  
  6736                                  .append_copy_to_window_back:
  6737 00004BFC 89C5                                    mov     ebp, eax
  6738 00004BFE 81E5C0010000                            and     ebp, 1C0h
  6739 00004C04 2520040000                              and     eax, 420h
  6740 00004C09 8D7010                                  lea     esi, [eax+10h]
  6741 00004C0C 8D7830                                  lea     edi, [eax+30h]
  6742 00004C0F F7DD                                    neg     ebp
  6743 00004C11 81E5C0010000                            and     ebp, 1C0h
  6744 00004C17 8B0D[5C9B0000]                          mov     ecx, [mp3_curr_syn_dst]
  6745                                  
  6746                                  .samples_lop:
  6747 00004C1D BB10001000                              mov     ebx, 100010h
  6748 00004C22 8B14B5[749B0000]                        mov     edx, [mp3_synth_buf+esi*4]
  6749 00004C29 8B04AD[2CED0400]                        mov     eax, [mp3_synth_win+ebp*4]
  6750 00004C30 F7EA                                    imul    edx
  6751 00004C32 01D3                                    add     ebx, edx
  6752 00004C34 8B14B5[749C0000]                        mov     edx, [(mp3_synth_buf+100h)+esi*4]
  6753 00004C3B 8B04AD[2CEE0400]                        mov     eax, [(mp3_synth_win+100h)+ebp*4]
  6754 00004C42 F7EA                                    imul    edx
  6755 00004C44 01D3                                    add     ebx, edx
  6756 00004C46 8B14B5[749D0000]                        mov     edx, [(mp3_synth_buf+200h)+esi*4]
  6757 00004C4D 8B04AD[2CEF0400]                        mov     eax, [(mp3_synth_win+200h)+ebp*4]
  6758 00004C54 F7EA                                    imul    edx
  6759 00004C56 01D3                                    add     ebx, edx
  6760 00004C58 8B14B5[749E0000]                        mov     edx, [(mp3_synth_buf+300h)+esi*4]
  6761 00004C5F 8B04AD[2CF00400]                        mov     eax, [(mp3_synth_win+300h)+ebp*4]
  6762 00004C66 F7EA                                    imul    edx
  6763 00004C68 01D3                                    add     ebx, edx
  6764 00004C6A 8B14B5[749F0000]                        mov     edx, [(mp3_synth_buf+400h)+esi*4]
  6765 00004C71 8B04AD[2CF10400]                        mov     eax, [(mp3_synth_win+400h)+ebp*4]
  6766 00004C78 F7EA                                    imul    edx
  6767 00004C7A 01D3                                    add     ebx, edx
  6768 00004C7C 8B14B5[74A00000]                        mov     edx, [(mp3_synth_buf+500h)+esi*4]
  6769 00004C83 8B04AD[2CF20400]                        mov     eax, [(mp3_synth_win+500h)+ebp*4]
  6770 00004C8A F7EA                                    imul    edx
  6771 00004C8C 01D3                                    add     ebx, edx
  6772 00004C8E 8B14B5[74A10000]                        mov     edx, [(mp3_synth_buf+600h)+esi*4]
  6773 00004C95 8B04AD[2CF30400]                        mov     eax, [(mp3_synth_win+600h)+ebp*4]
  6774 00004C9C F7EA                                    imul    edx
  6775 00004C9E 01D3                                    add     ebx, edx
  6776 00004CA0 8B14B5[74A20000]                        mov     edx, [(mp3_synth_buf+700h)+esi*4]
  6777 00004CA7 8B04AD[2CF40400]                        mov     eax, [(mp3_synth_win+700h)+ebp*4]
  6778 00004CAE F7EA                                    imul    edx
  6779 00004CB0 01D3                                    add     ebx, edx
  6780 00004CB2 8B14BD[749B0000]                        mov     edx, [mp3_synth_buf+edi*4]
  6781 00004CB9 8B04AD[ACED0400]                        mov     eax, [(mp3_synth_win+80h)+ebp*4]
  6782 00004CC0 F7EA                                    imul    edx
  6783 00004CC2 01D3                                    add     ebx, edx
  6784 00004CC4 8B14BD[749C0000]                        mov     edx, [(mp3_synth_buf+100h)+edi*4]
  6785 00004CCB 8B04AD[ACEE0400]                        mov     eax, [(mp3_synth_win+180h)+ebp*4]
  6786 00004CD2 F7EA                                    imul    edx
  6787 00004CD4 01D3                                    add     ebx, edx
  6788 00004CD6 8B14BD[749D0000]                        mov     edx, [(mp3_synth_buf+200h)+edi*4]
  6789 00004CDD 8B04AD[ACEF0400]                        mov     eax, [(mp3_synth_win+280h)+ebp*4]
  6790 00004CE4 F7EA                                    imul    edx
  6791 00004CE6 01D3                                    add     ebx, edx
  6792 00004CE8 8B14BD[749E0000]                        mov     edx, [(mp3_synth_buf+300h)+edi*4]
  6793 00004CEF 8B04AD[ACF00400]                        mov     eax, [(mp3_synth_win+380h)+ebp*4]
  6794 00004CF6 F7EA                                    imul    edx
  6795 00004CF8 01D3                                    add     ebx, edx
  6796 00004CFA 8B14BD[749F0000]                        mov     edx, [(mp3_synth_buf+400h)+edi*4]
  6797 00004D01 8B04AD[ACF10400]                        mov     eax, [(mp3_synth_win+480h)+ebp*4]
  6798 00004D08 F7EA                                    imul    edx
  6799 00004D0A 01D3                                    add     ebx, edx
  6800 00004D0C 8B14BD[74A00000]                        mov     edx, [(mp3_synth_buf+500h)+edi*4]
  6801 00004D13 8B04AD[ACF20400]                        mov     eax, [(mp3_synth_win+580h)+ebp*4]
  6802 00004D1A F7EA                                    imul    edx
  6803 00004D1C 01D3                                    add     ebx, edx
  6804 00004D1E 8B14BD[74A10000]                        mov     edx, [(mp3_synth_buf+600h)+edi*4]
  6805 00004D25 8B04AD[ACF30400]                        mov     eax, [(mp3_synth_win+680h)+ebp*4]
  6806 00004D2C F7EA                                    imul    edx
  6807 00004D2E 01D3                                    add     ebx, edx
  6808 00004D30 8B14BD[74A20000]                        mov     edx, [(mp3_synth_buf+700h)+edi*4]
  6809 00004D37 8B04AD[ACF40400]                        mov     eax, [(mp3_synth_win+780h)+ebp*4]
  6810 00004D3E F7EA                                    imul    edx
  6811 00004D40 01D3                                    add     ebx, edx
  6812 00004D42 81FB00002000                            cmp     ebx, 200000h
  6813 00004D48 7328                                    jnb     short .sat
  6814 00004D4A C1FB05                                  sar     ebx, 5
  6815 00004D4D 81EB00800000                            sub     ebx, 8000h
  6816                                  
  6817                                  .sat_back:
  6818 00004D53 668919                                  mov     [ecx], bx
  6819 00004D56 030D[18F20000]                          add     ecx, [mp3_samples_dst_step]
  6820 00004D5C 83C602                                  add     esi, 2
  6821 00004D5F 83EF02                                  sub     edi, 2
  6822 00004D62 83C502                                  add     ebp, 2
  6823 00004D65 F7C51F000000                            test    ebp, 1Fh
  6824 00004D6B 0F85ACFEFFFF                            jnz     .samples_lop
  6825 00004D71 C3                                      retn
  6826                                  
  6827                                  .sat:
  6828 00004D72 C1FB1F                                  sar     ebx, 31
  6829 00004D75 81F3FF7F0000                            xor     ebx, 7FFFh
  6830 00004D7B EBD6                                    jmp     short .sat_back
  6831                                  
  6832                                  .append_copy_to_window:
  6833 00004D7D 8D3485[749B0000]                        lea     esi, [mp3_synth_buf+eax*4]
  6834 00004D84 8DBE00080000                            lea     edi, [esi+2048]
  6835 00004D8A B912000000                              mov     ecx, 18
  6836 00004D8F F3A5                                    rep movsd
  6837 00004D91 E966FEFFFF                              jmp     .append_copy_to_window_back
  6838                                  
  6839                                  
  6840                                  ; =============== S U B R O U T I N E =======================================
  6841                                  
  6842                                  
  6843                                  synth_16bit_shift_2_slow:
  6844 00004D96 F605[DC730000]10                        test    byte [cpuid_flags], 10h ; SYNTH_MACRO 0,2,0
  6845 00004D9D 740E                                    jz      short .no_rdtsc_supported
  6846 00004D9F 0F31                                    rdtsc
  6847 00004DA1 2905[54750000]                          sub     [rdtsc_synth_dct], eax
  6848 00004DA7 1915[58750000]                          sbb     [rdtsc_synth_dct+4], edx
  6849                                  
  6850                                  .no_rdtsc_supported:
  6851 00004DAD BE[7CBB0000]                            mov	esi, mp3_sb_samples
  6852 00004DB2 8B3D[10F20000]                          mov	edi, [mp3_samples_dst]
  6853 00004DB8 C705[1CF20000]0000-                     mov	dword [mp3_curr_channel], 0
  6853 00004DC0 0000               
  6854                                  
  6855                                  .synth_channel_lop:
  6856 00004DC2 56                                      push	esi
  6857 00004DC3 57                                      push	edi
  6858 00004DC4 893D[5C9B0000]                          mov	[mp3_curr_syn_dst], edi
  6859 00004DCA C705[24F20000]0000-                     mov	dword [mp3_curr_frame], 0
  6859 00004DD2 0000               
  6860                                  
  6861                                  .synth_frame_lop:
  6862 00004DD4 56                                      push    esi
  6863 00004DD5 F605[DC730000]10                        test    byte [cpuid_flags], 10h
  6864 00004DDC 740E                                    jz      short .no_rdtsc_supported@
  6865 00004DDE 0F31                                    rdtsc
  6866 00004DE0 2905[6C750000]                          sub     [rdtsc_dct32], eax
  6867 00004DE6 1915[70750000]                          sbb     [rdtsc_dct32+4], edx
  6868                                  
  6869                                  .no_rdtsc_supported@:
  6870 00004DEC 8B15[1CF20000]                          mov     edx, [mp3_curr_channel]
  6871 00004DF2 8B0495[74BB0000]                        mov     eax, [mp3_synth_index+edx*4]
  6872 00004DF9 832C95[74BB0000]20                      sub     dword [mp3_synth_index+edx*4], 32
  6873 00004E01 C1E20A                                  shl     edx, 10
  6874 00004E04 25E0010000                              and     eax, 1E0h       ; 1FFh-1Fh
  6875 00004E09 09D0                                    or      eax, edx
  6876 00004E0B A3[589B0000]                            mov     [mp3_curr_syn_index], eax
  6877 00004E10 8B3D[589B0000]                          mov     edi, [mp3_curr_syn_index]
  6878 00004E16 8D3CBD[749B0000]                        lea     edi, [mp3_synth_buf+edi*4]
  6879 00004E1D E856E4FFFF                              call    mp3_dct32_shift_2 ; call mp3_dct32_shift_&rate_shift
  6880 00004E22 F605[DC730000]10                        test    byte [cpuid_flags], 10h
  6881 00004E29 740E                                    jz      short .no_rdtsc_supported@@
  6882 00004E2B 0F31                                    rdtsc
  6883 00004E2D 0105[6C750000]                          add     [rdtsc_dct32], eax
  6884 00004E33 1115[70750000]                          adc     [rdtsc_dct32+4], edx
  6885                                  
  6886                                  .no_rdtsc_supported@@:
  6887 00004E39 F605[DC730000]10                        test    byte [cpuid_flags], 10h
  6888 00004E40 740E                                    jz      short .no_rdtsc_supported@@@
  6889 00004E42 0F31                                    rdtsc
  6890 00004E44 2905[84750000]                          sub     [rdtsc_synth], eax
  6891 00004E4A 1915[88750000]                          sbb     [rdtsc_synth+4], edx
  6892                                  
  6893                                  .no_rdtsc_supported@@@:
  6894 00004E50 E888000000                              call    mp3_synth_filter_this_16bit_shift_2_slow ;
  6895                                                                          ; mp3_synth_filter_this_&force_8bit&_&rate_shift&_&force_fast
  6896 00004E55 F605[DC730000]10                        test    byte [cpuid_flags], 10h
  6897 00004E5C 740E                                    jz      short .no_rdtsc_supported@@@@
  6898 00004E5E 0F31                                    rdtsc
  6899 00004E60 0105[84750000]                          add     [rdtsc_synth], eax
  6900 00004E66 1115[88750000]                          adc     [rdtsc_synth+4], edx
  6901                                  
  6902                                  .no_rdtsc_supported@@@@:
  6903 00004E6C 5E                                      pop     esi
  6904 00004E6D A1[18F20000]                            mov     eax, [mp3_samples_dst_step]
  6905 00004E72 C1E005                                  shl     eax, 5
  6906 00004E75 8A0D[D9730000]                          mov     cl, [option_rate_shift]
  6907 00004E7B D3E8                                    shr     eax, cl
  6908 00004E7D 0105[5C9B0000]                          add     [mp3_curr_syn_dst], eax
  6909 00004E83 81C680000000                            add     esi, 128        ; SBLIMIT*4
  6910 00004E89 FF05[24F20000]                          inc     dword [mp3_curr_frame]
  6911 00004E8F A1[24F20000]                            mov     eax, [mp3_curr_frame]
  6912 00004E94 3B05[609B0000]                          cmp     eax, [mp3_nb_frames]
  6913 00004E9A 0F8234FFFFFF                            jb      .synth_frame_lop
  6914 00004EA0 5F                                      pop     edi
  6915 00004EA1 5E                                      pop     esi
  6916 00004EA2 033D[549B0000]                          add     edi, [mp3_bytes_per_sample]
  6917 00004EA8 81C600120000                            add     esi, 4608       ; 36*SBLIMIT*4
  6918 00004EAE FF05[1CF20000]                          inc     dword [mp3_curr_channel]
  6919 00004EB4 A1[1CF20000]                            mov     eax, [mp3_curr_channel]
  6920 00004EB9 3B05[4C9B0000]                          cmp     eax, [mp3_output_num_channels]
  6921 00004EBF 0F82FDFEFFFF                            jb      .synth_channel_lop
  6922 00004EC5 F605[DC730000]10                        test    byte [cpuid_flags], 10h
  6923 00004ECC 740E                                    jz      short .no_rdtsc_supported@@@@@
  6924 00004ECE 0F31                                    rdtsc
  6925 00004ED0 0105[54750000]                          add     [rdtsc_synth_dct], eax
  6926 00004ED6 1115[58750000]                          adc     [rdtsc_synth_dct+4], edx
  6927                                  
  6928                                  .no_rdtsc_supported@@@@@:
  6929 00004EDC C3                                      retn
  6930                                  
  6931                                  
  6932                                  ; =============== S U B R O U T I N E =======================================
  6933                                  
  6934                                  
  6935                                  mp3_synth_filter_this_16bit_shift_2_slow:
  6936 00004EDD A1[589B0000]                            mov     eax, [mp3_curr_syn_index]
  6937 00004EE2 A9E0010000                              test    eax, 1E0h
  6938 00004EE7 0F8482010000                            jz      .append_copy_to_window
  6939 00004EED 90                                      nop
  6940                                  
  6941                                  .append_copy_to_window_back:
  6942 00004EEE 89C5                                    mov     ebp, eax
  6943 00004EF0 81E5C0010000                            and     ebp, 1C0h
  6944 00004EF6 2520040000                              and     eax, 420h
  6945 00004EFB 8D7010                                  lea     esi, [eax+10h]
  6946 00004EFE 8D7830                                  lea     edi, [eax+30h]
  6947 00004F01 F7DD                                    neg     ebp
  6948 00004F03 81E5C0010000                            and     ebp, 1C0h
  6949 00004F09 8B0D[5C9B0000]                          mov     ecx, [mp3_curr_syn_dst]
  6950                                  
  6951                                  .samples_lop:
  6952 00004F0F BB10001000                              mov     ebx, 100010h
  6953 00004F14 8B14B5[749B0000]                        mov     edx, [mp3_synth_buf+esi*4]
  6954 00004F1B 8B04AD[2CED0400]                        mov     eax, [mp3_synth_win+ebp*4]
  6955 00004F22 F7EA                                    imul    edx
  6956 00004F24 01D3                                    add     ebx, edx
  6957 00004F26 8B14B5[749C0000]                        mov     edx, [(mp3_synth_buf+100h)+esi*4]
  6958 00004F2D 8B04AD[2CEE0400]                        mov     eax, [(mp3_synth_win+100h)+ebp*4]
  6959 00004F34 F7EA                                    imul    edx
  6960 00004F36 01D3                                    add     ebx, edx
  6961 00004F38 8B14B5[749D0000]                        mov     edx, [(mp3_synth_buf+200h)+esi*4]
  6962 00004F3F 8B04AD[2CEF0400]                        mov     eax, [(mp3_synth_win+200h)+ebp*4]
  6963 00004F46 F7EA                                    imul    edx
  6964 00004F48 01D3                                    add     ebx, edx
  6965 00004F4A 8B14B5[749E0000]                        mov     edx, [(mp3_synth_buf+300h)+esi*4]
  6966 00004F51 8B04AD[2CF00400]                        mov     eax, [(mp3_synth_win+300h)+ebp*4]
  6967 00004F58 F7EA                                    imul    edx
  6968 00004F5A 01D3                                    add     ebx, edx
  6969 00004F5C 8B14B5[749F0000]                        mov     edx, [(mp3_synth_buf+400h)+esi*4]
  6970 00004F63 8B04AD[2CF10400]                        mov     eax, [(mp3_synth_win+400h)+ebp*4]
  6971 00004F6A F7EA                                    imul    edx
  6972 00004F6C 01D3                                    add     ebx, edx
  6973 00004F6E 8B14B5[74A00000]                        mov     edx, [(mp3_synth_buf+500h)+esi*4]
  6974 00004F75 8B04AD[2CF20400]                        mov     eax, [(mp3_synth_win+500h)+ebp*4]
  6975 00004F7C F7EA                                    imul    edx
  6976 00004F7E 01D3                                    add     ebx, edx
  6977 00004F80 8B14B5[74A10000]                        mov     edx, [(mp3_synth_buf+600h)+esi*4]
  6978 00004F87 8B04AD[2CF30400]                        mov     eax, [(mp3_synth_win+600h)+ebp*4]
  6979 00004F8E F7EA                                    imul    edx
  6980 00004F90 01D3                                    add     ebx, edx
  6981 00004F92 8B14B5[74A20000]                        mov     edx, [(mp3_synth_buf+700h)+esi*4]
  6982 00004F99 8B04AD[2CF40400]                        mov     eax, [(mp3_synth_win+700h)+ebp*4]
  6983 00004FA0 F7EA                                    imul    edx
  6984 00004FA2 01D3                                    add     ebx, edx
  6985 00004FA4 8B14BD[749B0000]                        mov     edx, [mp3_synth_buf+edi*4]
  6986 00004FAB 8B04AD[ACED0400]                        mov     eax, [(mp3_synth_win+80h)+ebp*4]
  6987 00004FB2 F7EA                                    imul    edx
  6988 00004FB4 01D3                                    add     ebx, edx
  6989 00004FB6 8B14BD[749C0000]                        mov     edx, [(mp3_synth_buf+100h)+edi*4]
  6990 00004FBD 8B04AD[ACEE0400]                        mov     eax, [(mp3_synth_win+180h)+ebp*4]
  6991 00004FC4 F7EA                                    imul    edx
  6992 00004FC6 01D3                                    add     ebx, edx
  6993 00004FC8 8B14BD[749D0000]                        mov     edx, [(mp3_synth_buf+200h)+edi*4]
  6994 00004FCF 8B04AD[ACEF0400]                        mov     eax, [(mp3_synth_win+280h)+ebp*4]
  6995 00004FD6 F7EA                                    imul    edx
  6996 00004FD8 01D3                                    add     ebx, edx
  6997 00004FDA 8B14BD[749E0000]                        mov     edx, [(mp3_synth_buf+300h)+edi*4]
  6998 00004FE1 8B04AD[ACF00400]                        mov     eax, [(mp3_synth_win+380h)+ebp*4]
  6999 00004FE8 F7EA                                    imul    edx
  7000 00004FEA 01D3                                    add     ebx, edx
  7001 00004FEC 8B14BD[749F0000]                        mov     edx, [(mp3_synth_buf+400h)+edi*4]
  7002 00004FF3 8B04AD[ACF10400]                        mov     eax, [(mp3_synth_win+480h)+ebp*4]
  7003 00004FFA F7EA                                    imul    edx
  7004 00004FFC 01D3                                    add     ebx, edx
  7005 00004FFE 8B14BD[74A00000]                        mov     edx, [(mp3_synth_buf+500h)+edi*4]
  7006 00005005 8B04AD[ACF20400]                        mov     eax, [(mp3_synth_win+580h)+ebp*4]
  7007 0000500C F7EA                                    imul    edx
  7008 0000500E 01D3                                    add     ebx, edx
  7009 00005010 8B14BD[74A10000]                        mov     edx, [(mp3_synth_buf+600h)+edi*4]
  7010 00005017 8B04AD[ACF30400]                        mov     eax, [(mp3_synth_win+680h)+ebp*4]
  7011 0000501E F7EA                                    imul    edx
  7012 00005020 01D3                                    add     ebx, edx
  7013 00005022 8B14BD[74A20000]                        mov     edx, [(mp3_synth_buf+700h)+edi*4]
  7014 00005029 8B04AD[ACF40400]                        mov     eax, [(mp3_synth_win+780h)+ebp*4]
  7015 00005030 F7EA                                    imul    edx
  7016 00005032 01D3                                    add     ebx, edx
  7017 00005034 81FB00002000                            cmp     ebx, 200000h
  7018 0000503A 7328                                    jnb     short .sat
  7019 0000503C C1FB05                                  sar     ebx, 5
  7020 0000503F 81EB00800000                            sub     ebx, 8000h
  7021                                  
  7022                                  .sat_back:
  7023 00005045 668919                                  mov     [ecx], bx
  7024 00005048 030D[18F20000]                          add     ecx, [mp3_samples_dst_step]
  7025 0000504E 83C604                                  add     esi, 4
  7026 00005051 83EF04                                  sub     edi, 4
  7027 00005054 83C504                                  add     ebp, 4
  7028 00005057 F7C51F000000                            test    ebp, 1Fh
  7029 0000505D 0F85ACFEFFFF                            jnz     .samples_lop
  7030 00005063 C3                                      retn
  7031                                  
  7032                                  .sat:
  7033 00005064 C1FB1F                                  sar     ebx, 31
  7034 00005067 81F3FF7F0000                            xor     ebx, 7FFFh
  7035 0000506D EBD6                                    jmp     short .sat_back
  7036                                  
  7037                                  .append_copy_to_window:
  7038 0000506F 8D3485[749B0000]                        lea     esi, [mp3_synth_buf+eax*4]
  7039 00005076 8DBE00080000                            lea     edi, [esi+2048]
  7040 0000507C B912000000                              mov     ecx, 18
  7041 00005081 F3A5                                    rep movsd
  7042 00005083 E966FEFFFF                              jmp     .append_copy_to_window_back
  7043                                  
  7044                                  
  7045                                  ; =============== S U B R O U T I N E =======================================
  7046                                  
  7047                                  
  7048                                  synth_8bit_shift_0_slow:
  7049 00005088 F605[DC730000]10                        test    byte [cpuid_flags], 10h ; SYNTH_MACRO 1,0,0
  7050 0000508F 740E                                    jz      short .no_rdtsc_supported
  7051 00005091 0F31                                    rdtsc
  7052 00005093 2905[54750000]                          sub     [rdtsc_synth_dct], eax
  7053 00005099 1915[58750000]                          sbb     [rdtsc_synth_dct+4], edx
  7054                                  
  7055                                  .no_rdtsc_supported:
  7056 0000509F BE[7CBB0000]                            mov	esi, mp3_sb_samples
  7057 000050A4 8B3D[10F20000]                          mov	edi, [mp3_samples_dst]
  7058 000050AA C705[1CF20000]0000-                     mov	dword [mp3_curr_channel], 0
  7058 000050B2 0000               
  7059                                  
  7060                                  .synth_channel_lop:
  7061 000050B4 56                                      push	esi
  7062 000050B5 57                                      push	edi
  7063 000050B6 893D[5C9B0000]                          mov	[mp3_curr_syn_dst], edi
  7064 000050BC C705[24F20000]0000-                     mov	dword [mp3_curr_frame], 0
  7064 000050C4 0000               
  7065                                  
  7066                                  .synth_frame_lop:
  7067 000050C6 56                                      push    esi
  7068 000050C7 F605[DC730000]10                        test    byte [cpuid_flags], 10h
  7069 000050CE 740E                                    jz      short .no_rdtsc_supported@
  7070 000050D0 0F31                                    rdtsc
  7071 000050D2 2905[6C750000]                          sub     [rdtsc_dct32], eax
  7072 000050D8 1915[70750000]                          sbb     [rdtsc_dct32+4], edx
  7073                                  
  7074                                  .no_rdtsc_supported@:
  7075 000050DE 8B15[1CF20000]                          mov     edx, [mp3_curr_channel]
  7076 000050E4 8B0495[74BB0000]                        mov     eax, [mp3_synth_index+edx*4]
  7077 000050EB 832C95[74BB0000]20                      sub     dword [mp3_synth_index+edx*4], 32
  7078 000050F3 C1E20A                                  shl     edx, 10
  7079 000050F6 25E0010000                              and     eax, 1E0h       ; 1FFh-1Fh
  7080 000050FB 09D0                                    or      eax, edx
  7081 000050FD A3[589B0000]                            mov     [mp3_curr_syn_index], eax
  7082 00005102 8B3D[589B0000]                          mov     edi, [mp3_curr_syn_index]
  7083 00005108 8D3CBD[749B0000]                        lea     edi, [mp3_synth_buf+edi*4]
  7084 0000510F E894D4FFFF                              call    mp3_dct32_shift_0
  7085 00005114 F605[DC730000]10                        test    byte [cpuid_flags], 10h
  7086 0000511B 740E                                    jz      short .no_rdtsc_supported@@
  7087 0000511D 0F31                                    rdtsc
  7088 0000511F 0105[6C750000]                          add     [rdtsc_dct32], eax
  7089 00005125 1115[70750000]                          adc     [rdtsc_dct32+4], edx
  7090                                  
  7091                                  .no_rdtsc_supported@@:
  7092 0000512B F605[DC730000]10                        test    byte [cpuid_flags], 10h
  7093 00005132 740E                                    jz      short .no_rdtsc_supported@@@
  7094 00005134 0F31                                    rdtsc
  7095 00005136 2905[84750000]                          sub     [rdtsc_synth], eax
  7096 0000513C 1915[88750000]                          sbb     [rdtsc_synth+4], edx
  7097                                  
  7098                                  .no_rdtsc_supported@@@:
  7099 00005142 E888000000                              call    mp3_synth_filter_this_8bit_shift_0_slow ;
  7100                                                                          ; mp3_synth_filter_this_&force_8bit&_&rate_shift&_&force_fast
  7101 00005147 F605[DC730000]10                        test    byte [cpuid_flags], 10h
  7102 0000514E 740E                                    jz      short .no_rdtsc_supported@@@@
  7103 00005150 0F31                                    rdtsc
  7104 00005152 0105[84750000]                          add     [rdtsc_synth], eax
  7105 00005158 1115[88750000]                          adc     [rdtsc_synth+4], edx
  7106                                  
  7107                                  .no_rdtsc_supported@@@@:
  7108 0000515E 5E                                      pop     esi
  7109 0000515F A1[18F20000]                            mov     eax, [mp3_samples_dst_step]
  7110 00005164 C1E005                                  shl     eax, 5
  7111 00005167 8A0D[D9730000]                          mov     cl, [option_rate_shift]
  7112 0000516D D3E8                                    shr     eax, cl
  7113 0000516F 0105[5C9B0000]                          add     [mp3_curr_syn_dst], eax
  7114 00005175 81C680000000                            add     esi, 128        ; SBLIMIT*4
  7115 0000517B FF05[24F20000]                          inc     dword [mp3_curr_frame]
  7116 00005181 A1[24F20000]                            mov     eax, [mp3_curr_frame]
  7117 00005186 3B05[609B0000]                          cmp     eax, [mp3_nb_frames]
  7118 0000518C 0F8234FFFFFF                            jb      .synth_frame_lop
  7119 00005192 5F                                      pop     edi
  7120 00005193 5E                                      pop     esi
  7121 00005194 033D[549B0000]                          add     edi, [mp3_bytes_per_sample]
  7122 0000519A 81C600120000                            add     esi, 4608       ; 36*SBLIMIT*4
  7123 000051A0 FF05[1CF20000]                          inc     dword [mp3_curr_channel]
  7124 000051A6 A1[1CF20000]                            mov     eax, [mp3_curr_channel]
  7125 000051AB 3B05[4C9B0000]                          cmp     eax, [mp3_output_num_channels]
  7126 000051B1 0F82FDFEFFFF                            jb      .synth_channel_lop
  7127 000051B7 F605[DC730000]10                        test    byte [cpuid_flags], 10h
  7128 000051BE 740E                                    jz      short .no_rdtsc_supported@@@@@
  7129 000051C0 0F31                                    rdtsc
  7130 000051C2 0105[54750000]                          add     [rdtsc_synth_dct], eax
  7131 000051C8 1115[58750000]                          adc     [rdtsc_synth_dct+4], edx
  7132                                  
  7133                                  .no_rdtsc_supported@@@@@:
  7134 000051CE C3                                      retn
  7135                                  
  7136                                  
  7137                                  ; =============== S U B R O U T I N E =======================================
  7138                                  
  7139                                  
  7140                                  mp3_synth_filter_this_8bit_shift_0_slow:
  7141 000051CF A1[589B0000]                            mov     eax, [mp3_curr_syn_index]
  7142 000051D4 A9E0010000                              test    eax, 1E0h
  7143 000051D9 0F8471010000                            jz      .append_copy_to_window
  7144 000051DF 90                                      nop
  7145                                  
  7146                                  .append_copy_to_window_back:
  7147 000051E0 89C5                                    mov     ebp, eax
  7148 000051E2 81E5C0010000                            and     ebp, 1C0h
  7149 000051E8 2520040000                              and     eax, 420h
  7150 000051ED 8D7010                                  lea     esi, [eax+10h]
  7151 000051F0 8D7830                                  lea     edi, [eax+30h]
  7152 000051F3 F7DD                                    neg     ebp
  7153 000051F5 81E5C0010000                            and     ebp, 1C0h
  7154 000051FB 8B0D[5C9B0000]                          mov     ecx, [mp3_curr_syn_dst]
  7155                                  
  7156                                  .samples_lop:
  7157 00005201 BB00101000                              mov     ebx, 101000h
  7158 00005206 8B14B5[749B0000]                        mov     edx, [mp3_synth_buf+esi*4]
  7159 0000520D 8B04AD[2CED0400]                        mov     eax, [mp3_synth_win+ebp*4]
  7160 00005214 F7EA                                    imul    edx
  7161 00005216 01D3                                    add     ebx, edx
  7162 00005218 8B14B5[749C0000]                        mov     edx, [(mp3_synth_buf+100h)+esi*4]
  7163 0000521F 8B04AD[2CEE0400]                        mov     eax, [(mp3_synth_win+100h)+ebp*4]
  7164 00005226 F7EA                                    imul    edx
  7165 00005228 01D3                                    add     ebx, edx
  7166 0000522A 8B14B5[749D0000]                        mov     edx, [(mp3_synth_buf+200h)+esi*4]
  7167 00005231 8B04AD[2CEF0400]                        mov     eax, [(mp3_synth_win+200h)+ebp*4]
  7168 00005238 F7EA                                    imul    edx
  7169 0000523A 01D3                                    add     ebx, edx
  7170 0000523C 8B14B5[749E0000]                        mov     edx, [(mp3_synth_buf+300h)+esi*4]
  7171 00005243 8B04AD[2CF00400]                        mov     eax, [(mp3_synth_win+300h)+ebp*4]
  7172 0000524A F7EA                                    imul    edx
  7173 0000524C 01D3                                    add     ebx, edx
  7174 0000524E 8B14B5[749F0000]                        mov     edx, [(mp3_synth_buf+400h)+esi*4]
  7175 00005255 8B04AD[2CF10400]                        mov     eax, [(mp3_synth_win+400h)+ebp*4]
  7176 0000525C F7EA                                    imul    edx
  7177 0000525E 01D3                                    add     ebx, edx
  7178 00005260 8B14B5[74A00000]                        mov     edx, [(mp3_synth_buf+500h)+esi*4]
  7179 00005267 8B04AD[2CF20400]                        mov     eax, [(mp3_synth_win+500h)+ebp*4]
  7180 0000526E F7EA                                    imul    edx
  7181 00005270 01D3                                    add     ebx, edx
  7182 00005272 8B14B5[74A10000]                        mov     edx, [(mp3_synth_buf+600h)+esi*4]
  7183 00005279 8B04AD[2CF30400]                        mov     eax, [(mp3_synth_win+600h)+ebp*4]
  7184 00005280 F7EA                                    imul    edx
  7185 00005282 01D3                                    add     ebx, edx
  7186 00005284 8B14B5[74A20000]                        mov     edx, [(mp3_synth_buf+700h)+esi*4]
  7187 0000528B 8B04AD[2CF40400]                        mov     eax, [(mp3_synth_win+700h)+ebp*4]
  7188 00005292 F7EA                                    imul    edx
  7189 00005294 01D3                                    add     ebx, edx
  7190 00005296 8B14BD[749B0000]                        mov     edx, [mp3_synth_buf+edi*4]
  7191 0000529D 8B04AD[ACED0400]                        mov     eax, [(mp3_synth_win+80h)+ebp*4]
  7192 000052A4 F7EA                                    imul    edx
  7193 000052A6 01D3                                    add     ebx, edx
  7194 000052A8 8B14BD[749C0000]                        mov     edx, [(mp3_synth_buf+100h)+edi*4]
  7195 000052AF 8B04AD[ACEE0400]                        mov     eax, [(mp3_synth_win+180h)+ebp*4]
  7196 000052B6 F7EA                                    imul    edx
  7197 000052B8 01D3                                    add     ebx, edx
  7198 000052BA 8B14BD[749D0000]                        mov     edx, [(mp3_synth_buf+200h)+edi*4]
  7199 000052C1 8B04AD[ACEF0400]                        mov     eax, [(mp3_synth_win+280h)+ebp*4]
  7200 000052C8 F7EA                                    imul    edx
  7201 000052CA 01D3                                    add     ebx, edx
  7202 000052CC 8B14BD[749E0000]                        mov     edx, [(mp3_synth_buf+300h)+edi*4]
  7203 000052D3 8B04AD[ACF00400]                        mov     eax, [(mp3_synth_win+380h)+ebp*4]
  7204 000052DA F7EA                                    imul    edx
  7205 000052DC 01D3                                    add     ebx, edx
  7206 000052DE 8B14BD[749F0000]                        mov     edx, [(mp3_synth_buf+400h)+edi*4]
  7207 000052E5 8B04AD[ACF10400]                        mov     eax, [(mp3_synth_win+480h)+ebp*4]
  7208 000052EC F7EA                                    imul    edx
  7209 000052EE 01D3                                    add     ebx, edx
  7210 000052F0 8B14BD[74A00000]                        mov     edx, [(mp3_synth_buf+500h)+edi*4]
  7211 000052F7 8B04AD[ACF20400]                        mov     eax, [(mp3_synth_win+580h)+ebp*4]
  7212 000052FE F7EA                                    imul    edx
  7213 00005300 01D3                                    add     ebx, edx
  7214 00005302 8B14BD[74A10000]                        mov     edx, [(mp3_synth_buf+600h)+edi*4]
  7215 00005309 8B04AD[ACF30400]                        mov     eax, [(mp3_synth_win+680h)+ebp*4]
  7216 00005310 F7EA                                    imul    edx
  7217 00005312 01D3                                    add     ebx, edx
  7218 00005314 8B14BD[74A20000]                        mov     edx, [(mp3_synth_buf+700h)+edi*4]
  7219 0000531B 8B04AD[ACF40400]                        mov     eax, [(mp3_synth_win+780h)+ebp*4]
  7220 00005322 F7EA                                    imul    edx
  7221 00005324 01D3                                    add     ebx, edx
  7222 00005326 81FB00002000                            cmp     ebx, 200000h
  7223 0000532C 731B                                    jnb     short .sat
  7224 0000532E C1FB0D                                  sar     ebx, 13
  7225                                  
  7226                                  .sat_back:
  7227 00005331 8819                                    mov     [ecx], bl
  7228 00005333 030D[18F20000]                          add     ecx, [mp3_samples_dst_step]
  7229 00005339 46                                      inc     esi
  7230 0000533A 4F                                      dec     edi
  7231 0000533B 45                                      inc     ebp
  7232 0000533C F7C51F000000                            test    ebp, 1Fh
  7233 00005342 0F85B9FEFFFF                            jnz     .samples_lop
  7234 00005348 C3                                      retn
  7235                                  
  7236                                  .sat:
  7237 00005349 C1FB1F                                  sar     ebx, 31
  7238 0000534C F7D3                                    not     ebx
  7239 0000534E EBE1                                    jmp     short .sat_back
  7240                                  
  7241                                  .append_copy_to_window:
  7242 00005350 8D3485[749B0000]                        lea     esi, [mp3_synth_buf+eax*4]
  7243 00005357 8DBE00080000                            lea     edi, [esi+2048]
  7244 0000535D B912000000                              mov     ecx, 18
  7245 00005362 F3A5                                    rep movsd
  7246 00005364 E977FEFFFF                              jmp     .append_copy_to_window_back
  7247                                  
  7248                                  
  7249                                  ; =============== S U B R O U T I N E =======================================
  7250                                  
  7251                                  
  7252                                  synth_8bit_shift_1_slow:
  7253 00005369 F605[DC730000]10                        test    byte [cpuid_flags], 10h ; SYNTH_MACRO 1,1,0
  7254                                                                          ; force_8bit, rate_shift=1, force_fast=0
  7255 00005370 740E                                    jz      short .no_rdtsc_supported
  7256 00005372 0F31                                    rdtsc
  7257 00005374 2905[54750000]                          sub     [rdtsc_synth_dct], eax
  7258 0000537A 1915[58750000]                          sbb     [rdtsc_synth_dct+4], edx
  7259                                  
  7260                                  .no_rdtsc_supported:
  7261 00005380 BE[7CBB0000]                            mov	esi, mp3_sb_samples
  7262 00005385 8B3D[10F20000]                          mov	edi, [mp3_samples_dst]
  7263 0000538B C705[1CF20000]0000-                     mov	dword [mp3_curr_channel], 0
  7263 00005393 0000               
  7264                                  
  7265                                  .synth_channel_lop:
  7266 00005395 56                                      push	esi
  7267 00005396 57                                      push	edi
  7268 00005397 893D[5C9B0000]                          mov	[mp3_curr_syn_dst], edi
  7269 0000539D C705[24F20000]0000-                     mov	dword [mp3_curr_frame], 0
  7269 000053A5 0000               
  7270                                  
  7271                                  .synth_frame_lop:
  7272 000053A7 56                                      push    esi
  7273 000053A8 F605[DC730000]10                        test    byte [cpuid_flags], 10h
  7274 000053AF 740E                                    jz      short .no_rdtsc_supported@
  7275 000053B1 0F31                                    rdtsc
  7276 000053B3 2905[6C750000]                          sub     [rdtsc_dct32], eax
  7277 000053B9 1915[70750000]                          sbb     [rdtsc_dct32+4], edx
  7278                                  
  7279                                  .no_rdtsc_supported@:
  7280 000053BF 8B15[1CF20000]                          mov     edx, [mp3_curr_channel]
  7281 000053C5 8B0495[74BB0000]                        mov     eax, [mp3_synth_index+edx*4]
  7282 000053CC 832C95[74BB0000]20                      sub     dword [mp3_synth_index+edx*4], 32
  7283 000053D4 C1E20A                                  shl     edx, 10
  7284 000053D7 25E0010000                              and     eax, 1E0h       ; 1FFh-1Fh
  7285 000053DC 09D0                                    or      eax, edx
  7286 000053DE A3[589B0000]                            mov     [mp3_curr_syn_index], eax
  7287 000053E3 8B3D[589B0000]                          mov     edi, [mp3_curr_syn_index]
  7288 000053E9 8D3CBD[749B0000]                        lea     edi, [mp3_synth_buf+edi*4]
  7289 000053F0 E893DAFFFF                              call    mp3_dct32_shift_1 ; mp3_dct32_shift_&rate_shift ; rate_shift = 1
  7290 000053F5 F605[DC730000]10                        test    byte [cpuid_flags], 10h
  7291 000053FC 740E                                    jz      short .no_rdtsc_supported@@
  7292 000053FE 0F31                                    rdtsc
  7293 00005400 0105[6C750000]                          add     [rdtsc_dct32], eax
  7294 00005406 1115[70750000]                          adc     [rdtsc_dct32+4], edx
  7295                                  
  7296                                  .no_rdtsc_supported@@:
  7297 0000540C F605[DC730000]10                        test    byte [cpuid_flags], 10h
  7298 00005413 740E                                    jz      short .no_rdtsc_supported@@@
  7299 00005415 0F31                                    rdtsc
  7300 00005417 2905[84750000]                          sub     [rdtsc_synth], eax
  7301 0000541D 1915[88750000]                          sbb     [rdtsc_synth+4], edx
  7302                                  
  7303                                  .no_rdtsc_supported@@@:
  7304 00005423 E888000000                              call    mp3_synth_filter_this_8bit_shift_1_slow ;
  7305                                                                          ; mp3_synth_filter_this_&force_8bit&_&rate_shift&_&force_fast
  7306 00005428 F605[DC730000]10                        test    byte [cpuid_flags], 10h
  7307 0000542F 740E                                    jz      short .no_rdtsc_supported@@@@
  7308 00005431 0F31                                    rdtsc
  7309 00005433 0105[84750000]                          add     [rdtsc_synth], eax
  7310 00005439 1115[88750000]                          adc     [rdtsc_synth+4], edx
  7311                                  
  7312                                  .no_rdtsc_supported@@@@:
  7313 0000543F 5E                                      pop     esi
  7314 00005440 A1[18F20000]                            mov     eax, [mp3_samples_dst_step]
  7315 00005445 C1E005                                  shl     eax, 5          ; mul32
  7316 00005448 8A0D[D9730000]                          mov     cl, [option_rate_shift]
  7317 0000544E D3E8                                    shr     eax, cl
  7318 00005450 0105[5C9B0000]                          add     [mp3_curr_syn_dst], eax
  7319 00005456 81C680000000                            add     esi, 128        ; SBLIMIT*4
  7320 0000545C FF05[24F20000]                          inc	dword [mp3_curr_frame]
  7321 00005462 A1[24F20000]                            mov     eax, [mp3_curr_frame]
  7322 00005467 3B05[609B0000]                          cmp     eax, [mp3_nb_frames]
  7323 0000546D 0F8234FFFFFF                            jb      .synth_frame_lop
  7324 00005473 5F                                      pop     edi
  7325 00005474 5E                                      pop     esi
  7326 00005475 033D[549B0000]                          add     edi, [mp3_bytes_per_sample]
  7327 0000547B 81C600120000                            add     esi, 4608       ; 36*SBLIMIT*4
  7328 00005481 FF05[1CF20000]                          inc	dword [mp3_curr_channel]
  7329 00005487 A1[1CF20000]                            mov     eax, [mp3_curr_channel]
  7330 0000548C 3B05[4C9B0000]                          cmp     eax, [mp3_output_num_channels]
  7331 00005492 0F82FDFEFFFF                            jb      .synth_channel_lop
  7332 00005498 F605[DC730000]10                        test    byte [cpuid_flags], 10h
  7333 0000549F 740E                                    jz      short .no_rdtsc_supported@@@@@
  7334 000054A1 0F31                                    rdtsc
  7335 000054A3 0105[54750000]                          add     [rdtsc_synth_dct], eax
  7336 000054A9 1115[58750000]                          adc     [rdtsc_synth_dct+4], edx
  7337                                  
  7338                                  .no_rdtsc_supported@@@@@:
  7339 000054AF C3                                      retn
  7340                                  
  7341                                  
  7342                                  ; =============== S U B R O U T I N E =======================================
  7343                                  
  7344                                  
  7345                                  mp3_synth_filter_this_8bit_shift_1_slow:
  7346 000054B0 A1[589B0000]                            mov     eax, [mp3_curr_syn_index] ; IF LONG_WINDOW
  7347 000054B5 A9E0010000                              test    eax, 1E0h       ; 1FFh-1Fh
  7348 000054BA 0F8477010000                            jz      .append_copy_to_window
  7349 000054C0 90                                      nop
  7350                                  
  7351                                  .append_copy_to_window_back:
  7352 000054C1 89C5                                    mov     ebp, eax
  7353 000054C3 81E5C0010000                            and     ebp, 1C0h       ; 1FFh-1Fh-20h
  7354 000054C9 2520040000                              and     eax, 420h       ; 20h+(1 shl 10)
  7355 000054CE 8D7010                                  lea     esi, [eax+10h]
  7356 000054D1 8D7830                                  lea     edi, [eax+30h]
  7357 000054D4 F7DD                                    neg     ebp
  7358 000054D6 81E5C0010000                            and     ebp, 1C0h
  7359 000054DC 8B0D[5C9B0000]                          mov     ecx, [mp3_curr_syn_dst]
  7360                                  
  7361                                  .samples_lop:
  7362 000054E2 BB00101000                              mov     ebx, 101000h    ; mov @@sum,(8000h SHL (@@out_shift))+(1 SHL (@@out_shift-1))
  7363                                                                          ; @@out_shift equ (OUT_SHIFT_slow+(8*force_8bit))
  7364                                                                          ; OUT_SHIFT_slow = 5 ; @@out_shift = 13
  7365 000054E7 8B14B5[749B0000]                        mov     edx, [mp3_synth_buf+esi*4] ; @@SUM8 @@sum,@@win1,0,@@syn1
  7366                                                                          ; @@SUM8 macro sum,win,ww,syn
  7367                                                                          ;   IRP nn,0,1,2,3,4,5,6,7
  7368 000054EE 8B04AD[2CED0400]                        mov     eax, [mp3_synth_win+ebp*4]
  7369 000054F5 F7EA                                    imul    edx
  7370 000054F7 01D3                                    add     ebx, edx
  7371 000054F9 8B14B5[749C0000]                        mov     edx, [(mp3_synth_buf+100h)+esi*4] ; @@syn1 equ esi
  7372 00005500 8B04AD[2CEE0400]                        mov     eax, [(mp3_synth_win+100h)+ebp*4] ; @@win1 equ ebp
  7373 00005507 F7EA                                    imul    edx
  7374 00005509 01D3                                    add     ebx, edx
  7375 0000550B 8B14B5[749D0000]                        mov     edx, [(mp3_synth_buf+200h)+esi*4]
  7376 00005512 8B04AD[2CEF0400]                        mov     eax, [(mp3_synth_win+200h)+ebp*4]
  7377 00005519 F7EA                                    imul    edx
  7378 0000551B 01D3                                    add     ebx, edx
  7379 0000551D 8B14B5[749E0000]                        mov     edx, [(mp3_synth_buf+300h)+esi*4]
  7380 00005524 8B04AD[2CF00400]                        mov     eax, [(mp3_synth_win+300h)+ebp*4]
  7381 0000552B F7EA                                    imul    edx
  7382 0000552D 01D3                                    add     ebx, edx
  7383 0000552F 8B14B5[749F0000]                        mov     edx, [(mp3_synth_buf+400h)+esi*4]
  7384 00005536 8B04AD[2CF10400]                        mov     eax, [(mp3_synth_win+400h)+ebp*4]
  7385 0000553D F7EA                                    imul    edx
  7386 0000553F 01D3                                    add     ebx, edx
  7387 00005541 8B14B5[74A00000]                        mov     edx, [(mp3_synth_buf+500h)+esi*4]
  7388 00005548 8B04AD[2CF20400]                        mov     eax, [(mp3_synth_win+500h)+ebp*4]
  7389 0000554F F7EA                                    imul    edx
  7390 00005551 01D3                                    add     ebx, edx
  7391 00005553 8B14B5[74A10000]                        mov     edx, [(mp3_synth_buf+600h)+esi*4]
  7392 0000555A 8B04AD[2CF30400]                        mov     eax, [(mp3_synth_win+600h)+ebp*4]
  7393 00005561 F7EA                                    imul    edx
  7394 00005563 01D3                                    add     ebx, edx
  7395 00005565 8B14B5[74A20000]                        mov     edx, [(mp3_synth_buf+700h)+esi*4]
  7396 0000556C 8B04AD[2CF40400]                        mov     eax, [(mp3_synth_win+700h)+ebp*4]
  7397 00005573 F7EA                                    imul    edx
  7398 00005575 01D3                                    add     ebx, edx
  7399 00005577 8B14BD[749B0000]                        mov     edx, [mp3_synth_buf+edi*4]
  7400 0000557E 8B04AD[ACED0400]                        mov     eax, [(mp3_synth_win+80h)+ebp*4]
  7401 00005585 F7EA                                    imul    edx
  7402 00005587 01D3                                    add     ebx, edx
  7403 00005589 8B14BD[749C0000]                        mov     edx, [(mp3_synth_buf+100h)+edi*4] ; @@SUM8 @@sum,@@win1,32,@@syn2
  7404                                                                          ; @@syn2 equ edi
  7405                                                                          ; @@win1 equ ebp
  7406 00005590 8B04AD[ACEE0400]                        mov     eax, [(mp3_synth_win+180h)+ebp*4]
  7407 00005597 F7EA                                    imul    edx
  7408 00005599 01D3                                    add     ebx, edx
  7409 0000559B 8B14BD[749D0000]                        mov     edx, [(mp3_synth_buf+200h)+edi*4]
  7410 000055A2 8B04AD[ACEF0400]                        mov     eax, [(mp3_synth_win+280h)+ebp*4]
  7411 000055A9 F7EA                                    imul    edx
  7412 000055AB 01D3                                    add     ebx, edx
  7413 000055AD 8B14BD[749E0000]                        mov     edx, [(mp3_synth_buf+300h)+edi*4]
  7414 000055B4 8B04AD[ACF00400]                        mov     eax, [(mp3_synth_win+380h)+ebp*4]
  7415 000055BB F7EA                                    imul    edx
  7416 000055BD 01D3                                    add     ebx, edx
  7417 000055BF 8B14BD[749F0000]                        mov     edx, [(mp3_synth_buf+400h)+edi*4]
  7418 000055C6 8B04AD[ACF10400]                        mov     eax, [(mp3_synth_win+480h)+ebp*4]
  7419 000055CD F7EA                                    imul    edx
  7420 000055CF 01D3                                    add     ebx, edx
  7421 000055D1 8B14BD[74A00000]                        mov     edx, [(mp3_synth_buf+500h)+edi*4]
  7422 000055D8 8B04AD[ACF20400]                        mov     eax, [(mp3_synth_win+580h)+ebp*4]
  7423 000055DF F7EA                                    imul    edx
  7424 000055E1 01D3                                    add     ebx, edx
  7425 000055E3 8B14BD[74A10000]                        mov     edx, [(mp3_synth_buf+600h)+edi*4]
  7426 000055EA 8B04AD[ACF30400]                        mov     eax, [(mp3_synth_win+680h)+ebp*4]
  7427 000055F1 F7EA                                    imul    edx
  7428 000055F3 01D3                                    add     ebx, edx
  7429 000055F5 8B14BD[74A20000]                        mov     edx, [(mp3_synth_buf+700h)+edi*4]
  7430 000055FC 8B04AD[ACF40400]                        mov     eax, [(mp3_synth_win+780h)+ebp*4]
  7431 00005603 F7EA                                    imul    edx
  7432 00005605 01D3                                    add     ebx, edx
  7433 00005607 81FB00002000                            cmp     ebx, 200000h    ; cmp @@sum,100h SHL (@@out_shift)
  7434 0000560D 7321                                    jnb     short .sat
  7435 0000560F C1FB0D                                  sar     ebx, 13         ; sar @@sum,(@@out_shift)
  7436                                  
  7437                                  .sat_back:
  7438 00005612 8819                                    mov     [ecx], bl
  7439 00005614 030D[18F20000]                          add     ecx, [mp3_samples_dst_step]
  7440 0000561A 83C602                                  add     esi, 2
  7441 0000561D 83EF02                                  sub     edi, 2
  7442 00005620 83C502                                  add     ebp, 2
  7443 00005623 F7C51F000000                            test    ebp, 1Fh
  7444 00005629 0F85B3FEFFFF                            jnz     .samples_lop
  7445 0000562F C3                                      retn
  7446                                  
  7447                                  .sat:
  7448 00005630 C1FB1F                                  sar     ebx, 31         ; sar @@sum,31 ; FFFFFFFFh,00000000h
  7449 00005633 F7D3                                    not     ebx
  7450 00005635 EBDB                                    jmp     short .sat_back
  7451                                  
  7452                                  .append_copy_to_window:
  7453 00005637 8D3485[749B0000]                        lea     esi, [mp3_synth_buf+eax*4]
  7454 0000563E 8DBE00080000                            lea     edi, [esi+2048]
  7455 00005644 B912000000                              mov     ecx, 18
  7456 00005649 F3A5                                    rep movsd
  7457 0000564B E971FEFFFF                              jmp     .append_copy_to_window_back
  7458                                  
  7459                                  
  7460                                  ; =============== S U B R O U T I N E =======================================
  7461                                  
  7462                                  
  7463                                  synth_8bit_shift_2_slow:
  7464 00005650 F605[DC730000]10                        test    byte [cpuid_flags], 10h ; SYNTH_MACRO 1,2,0 ; 8bit, quarter rate
  7465                                                                          ; force_8bit, rate_shift=2, force_fast=0
  7466 00005657 740E                                    jz      short .no_rdtsc_supported ; timelog_start rdtsc_synth_dct
  7467 00005659 0F31                                    rdtsc
  7468 0000565B 2905[54750000]                          sub     [rdtsc_synth_dct], eax
  7469 00005661 1915[58750000]                          sbb     [rdtsc_synth_dct+4], edx
  7470                                  
  7471                                  .no_rdtsc_supported:
  7472 00005667 BE[7CBB0000]                            mov	esi, mp3_sb_samples
  7473 0000566C 8B3D[10F20000]                          mov	edi, [mp3_samples_dst]
  7474 00005672 C705[1CF20000]0000-                     mov	dword [mp3_curr_channel], 0
  7474 0000567A 0000               
  7475                                  
  7476                                  .synth_channel_lop:
  7477 0000567C 56                                      push	esi
  7478 0000567D 57                                      push	edi
  7479 0000567E 893D[5C9B0000]                          mov	[mp3_curr_syn_dst], edi
  7480 00005684 C705[24F20000]0000-                     mov	dword [mp3_curr_frame], 0
  7480 0000568C 0000               
  7481                                  
  7482                                  .synth_frame_lop:
  7483 0000568E 56                                      push    esi             ; sb_samples[ch][i]
  7484 0000568F F605[DC730000]10                        test    byte [cpuid_flags], 10h ; timelog_start rdtsc_dct32
  7485 00005696 740E                                    jz      short .no_rdtsc_supported@
  7486 00005698 0F31                                    rdtsc
  7487 0000569A 2905[6C750000]                          sub     [rdtsc_dct32], eax
  7488 000056A0 1915[70750000]                          sbb     [rdtsc_dct32+4], edx
  7489                                  
  7490                                  .no_rdtsc_supported@:
  7491 000056A6 8B15[1CF20000]                          mov     edx, [mp3_curr_channel]
  7492 000056AC 8B0495[74BB0000]                        mov     eax, [mp3_synth_index+edx*4]
  7493 000056B3 832C95[74BB0000]20                      sub     dword [mp3_synth_index+edx*4], 32
  7494 000056BB C1E20A                                  shl     edx, 10         ; channel*1024
  7495 000056BE 25E0010000                              and     eax, 1E0h       ; 1FFh-1Fh ; index(0..511), align 32
  7496 000056C3 09D0                                    or      eax, edx
  7497 000056C5 A3[589B0000]                            mov     [mp3_curr_syn_index], eax
  7498 000056CA 8B3D[589B0000]                          mov     edi, [mp3_curr_syn_index]
  7499 000056D0 8D3CBD[749B0000]                        lea     edi, [mp3_synth_buf+edi*4] ; IF SYNTH32
  7500 000056D7 E89CDBFFFF                              call    mp3_dct32_shift_2 ; mp3_dct32_shift_&rate_shift ; rate_shift=2
  7501 000056DC F605[DC730000]10                        test    byte [cpuid_flags], 10h
  7502 000056E3 740E                                    jz      short .no_rdtsc_supported@@ ; timelog_end rdtsc_dct32
  7503 000056E5 0F31                                    rdtsc
  7504 000056E7 0105[6C750000]                          add     [rdtsc_dct32], eax
  7505 000056ED 1115[70750000]                          adc     [rdtsc_dct32+4], edx
  7506                                  
  7507                                  .no_rdtsc_supported@@:
  7508 000056F3 F605[DC730000]10                        test    byte [cpuid_flags], 10h
  7509 000056FA 740E                                    jz      short .no_rdtsc_supported@@@ ; timelog_start rdtsc_synth
  7510 000056FC 0F31                                    rdtsc
  7511 000056FE 2905[84750000]                          sub     [rdtsc_synth], eax
  7512 00005704 1915[88750000]                          sbb     [rdtsc_synth+4], edx
  7513                                  
  7514                                  .no_rdtsc_supported@@@:
  7515 0000570A E888000000                              call    mp3_synth_filter_this_8bit_shift_2_slow ;
  7516                                                                          ; mp3_synth_filter_this_&force_8bit&_&rate_shift&_&force_fast
  7517 0000570F F605[DC730000]10                        test    byte [cpuid_flags], 10h ; timelog_end rdtsc_synth
  7518 00005716 740E                                    jz      short .no_rdtsc_supported@@@@
  7519 00005718 0F31                                    rdtsc
  7520 0000571A 0105[84750000]                          add     [rdtsc_synth], eax
  7521 00005720 1115[88750000]                          adc     [rdtsc_synth+4], edx
  7522                                  
  7523                                  .no_rdtsc_supported@@@@:
  7524 00005726 5E                                      pop     esi             ; src
  7525 00005727 A1[18F20000]                            mov     eax, [mp3_samples_dst_step]
  7526 0000572C C1E005                                  shl     eax, 5          ; mul32
  7527 0000572F 8A0D[D9730000]                          mov     cl, [option_rate_shift] ; IF with_rate_shift
  7528 00005735 D3E8                                    shr     eax, cl
  7529 00005737 0105[5C9B0000]                          add     [mp3_curr_syn_dst], eax
  7530 0000573D 81C680000000                            add     esi, 128        ; SBLIMIT*4 ; src+32*4
  7531 00005743 FF05[24F20000]                          inc     dword [mp3_curr_frame]
  7532 00005749 A1[24F20000]                            mov     eax, [mp3_curr_frame]
  7533 0000574E 3B05[609B0000]                          cmp     eax, [mp3_nb_frames]
  7534 00005754 0F8234FFFFFF                            jb      .synth_frame_lop
  7535 0000575A 5F                                      pop     edi
  7536 0000575B 5E                                      pop     esi
  7537 0000575C 033D[549B0000]                          add     edi, [mp3_bytes_per_sample]
  7538 00005762 81C600120000                            add     esi, 4608       ; 36*SBLIMIT*4 ; src
  7539 00005768 FF05[1CF20000]                          inc     dword [mp3_curr_channel]
  7540 0000576E A1[1CF20000]                            mov     eax, [mp3_curr_channel]
  7541 00005773 3B05[4C9B0000]                          cmp     eax, [mp3_output_num_channels]
  7542 00005779 0F82FDFEFFFF                            jb      .synth_channel_lop
  7543 0000577F F605[DC730000]10                        test    byte [cpuid_flags], 10h ; timelog_end rdtsc_synth_dct
  7544 00005786 740E                                    jz      short .no_rdtsc_supported@@@@@
  7545 00005788 0F31                                    rdtsc
  7546 0000578A 0105[54750000]                          add     [rdtsc_synth_dct], eax
  7547 00005790 1115[58750000]                          adc     [rdtsc_synth_dct+4], edx
  7548                                  
  7549                                  .no_rdtsc_supported@@@@@:
  7550 00005796 C3                                      retn
  7551                                  
  7552                                  ; =============== S U B R O U T I N E =======================================
  7553                                  
  7554                                  
  7555                                  mp3_synth_filter_this_8bit_shift_2_slow:
  7556 00005797 A1[589B0000]                            mov     eax, [mp3_curr_syn_index]
  7557 0000579C A9E0010000                              test    eax, 1E0h       ; 1FFh-1Fh ; offset
  7558 000057A1 0F8477010000                            jz      .append_copy_to_window
  7559 000057A7 90                                      nop
  7560                                  
  7561                                  .append_copy_to_window_back:
  7562 000057A8 89C5                                    mov     ebp, eax        ; @@win1
  7563 000057AA 81E5C0010000                            and     ebp, 1C0h       ; 1FFh-1Fh-20h
  7564 000057B0 2520040000                              and     eax, 420h       ; 20h+(1 shl 10) ; bit5 and channel
  7565 000057B5 8D7010                                  lea     esi, [eax+10h]  ; @@syn1
  7566 000057B8 8D7830                                  lea     edi, [eax+30h]  ; @@syn2
  7567 000057BB F7DD                                    neg     ebp
  7568 000057BD 81E5C0010000                            and     ebp, 1C0h       ; 1FFh-1Fh-20h
  7569 000057C3 8B0D[5C9B0000]                          mov     ecx, [mp3_curr_syn_dst] ; @@dst
  7570                                  
  7571                                  .samples_lop:
  7572 000057C9 BB00101000                              mov     ebx, 101000h    ; mov @@sum,(80h SHL (@@out_shift))+(1 SHL (@@out_shift-1))
  7573                                                                          ; @@out_shift equ (OUT_SHIFT_slow+(8*force_8bit))
  7574                                                                          ; @@out_shift = 13 ; OUT_SHIFT_slow = 5
  7575 000057CE 8B14B5[749B0000]                        mov     edx, [mp3_synth_buf+esi*4] ; @@SUM8 @@sum,@@win1,0,@@syn1
  7576                                                                          ; @@SUM8 macro sum,win,ww, syn
  7577                                                                          ; IRP nn,0,1,2,3,4,5,6,7
  7578                                                                          ; [mp3_synth_buf+syn*4+(nn*64*4)]
  7579 000057D5 8B04AD[2CED0400]                        mov     eax, [mp3_synth_win+ebp*4] ; [mp3_synth_win+win*4+(nn*64*4)+ww*4]
  7580 000057DC F7EA                                    imul    edx             ; 64bit = 32bit * 32bit
  7581 000057DE 01D3                                    add     ebx, edx        ; add sum,edx ; sum from MSW of result
  7582 000057E0 8B14B5[749C0000]                        mov     edx, [(mp3_synth_buf+100h)+esi*4] ;
  7583                                                                          ; [mp3_synth_buf+syn*4+(nn*64*4)] ; nn=1
  7584 000057E7 8B04AD[2CEE0400]                        mov     eax, [(mp3_synth_win+100h)+ebp*4] ;
  7585                                                                          ; [mp3_synth_win+win*4+(nn*64*4)+ww*4] ; nn=1
  7586 000057EE F7EA                                    imul    edx
  7587 000057F0 01D3                                    add     ebx, edx
  7588 000057F2 8B14B5[749D0000]                        mov     edx, [(mp3_synth_buf+200h)+esi*4]
  7589 000057F9 8B04AD[2CEF0400]                        mov     eax, [(mp3_synth_win+200h)+ebp*4]
  7590 00005800 F7EA                                    imul    edx
  7591 00005802 01D3                                    add     ebx, edx
  7592 00005804 8B14B5[749E0000]                        mov     edx, [(mp3_synth_buf+300h)+esi*4]
  7593 0000580B 8B04AD[2CF00400]                        mov     eax, [(mp3_synth_win+300h)+ebp*4]
  7594 00005812 F7EA                                    imul    edx
  7595 00005814 01D3                                    add     ebx, edx
  7596 00005816 8B14B5[749F0000]                        mov     edx, [(mp3_synth_buf+400h)+esi*4] ;
  7597                                                                          ; [mp3_synth_buf+syn*4+(nn*64*4)] ; nn=4
  7598 0000581D 8B04AD[2CF10400]                        mov     eax, [(mp3_synth_win+400h)+ebp*4] ;
  7599                                                                          ; [mp3_synth_win+win*4+(nn*64*4)+ww*4] ; nn=4
  7600 00005824 F7EA                                    imul    edx
  7601 00005826 01D3                                    add     ebx, edx
  7602 00005828 8B14B5[74A00000]                        mov     edx, [(mp3_synth_buf+500h)+esi*4]
  7603 0000582F 8B04AD[2CF20400]                        mov     eax, [(mp3_synth_win+500h)+ebp*4]
  7604 00005836 F7EA                                    imul    edx
  7605 00005838 01D3                                    add     ebx, edx
  7606 0000583A 8B14B5[74A10000]                        mov     edx, [(mp3_synth_buf+600h)+esi*4]
  7607 00005841 8B04AD[2CF30400]                        mov     eax, [(mp3_synth_win+600h)+ebp*4]
  7608 00005848 F7EA                                    imul    edx
  7609 0000584A 01D3                                    add     ebx, edx
  7610 0000584C 8B14B5[74A20000]                        mov     edx, [(mp3_synth_buf+700h)+esi*4]
  7611 00005853 8B04AD[2CF40400]                        mov     eax, [(mp3_synth_win+700h)+ebp*4]
  7612 0000585A F7EA                                    imul    edx
  7613 0000585C 01D3                                    add     ebx, edx
  7614 0000585E 8B14BD[749B0000]                        mov     edx, [mp3_synth_buf+edi*4] ; @@SUM8 @@sum,@@win1,32,@@syn2
  7615 00005865 8B04AD[ACED0400]                        mov     eax, [(mp3_synth_win+80h)+ebp*4]
  7616 0000586C F7EA                                    imul    edx
  7617 0000586E 01D3                                    add     ebx, edx
  7618 00005870 8B14BD[749C0000]                        mov     edx, [(mp3_synth_buf+100h)+edi*4]
  7619 00005877 8B04AD[ACEE0400]                        mov     eax, [(mp3_synth_win+180h)+ebp*4]
  7620 0000587E F7EA                                    imul    edx
  7621 00005880 01D3                                    add     ebx, edx
  7622 00005882 8B14BD[749D0000]                        mov     edx, [(mp3_synth_buf+200h)+edi*4]
  7623 00005889 8B04AD[ACEF0400]                        mov     eax, [(mp3_synth_win+280h)+ebp*4]
  7624 00005890 F7EA                                    imul    edx
  7625 00005892 01D3                                    add     ebx, edx
  7626 00005894 8B14BD[749E0000]                        mov     edx, [(mp3_synth_buf+300h)+edi*4]
  7627 0000589B 8B04AD[ACF00400]                        mov     eax, [(mp3_synth_win+380h)+ebp*4]
  7628 000058A2 F7EA                                    imul    edx
  7629 000058A4 01D3                                    add     ebx, edx
  7630 000058A6 8B14BD[749F0000]                        mov     edx, [(mp3_synth_buf+400h)+edi*4]
  7631 000058AD 8B04AD[ACF10400]                        mov     eax, [(mp3_synth_win+480h)+ebp*4]
  7632 000058B4 F7EA                                    imul    edx
  7633 000058B6 01D3                                    add     ebx, edx
  7634 000058B8 8B14BD[74A00000]                        mov     edx, [(mp3_synth_buf+500h)+edi*4]
  7635 000058BF 8B04AD[ACF20400]                        mov     eax, [(mp3_synth_win+580h)+ebp*4]
  7636 000058C6 F7EA                                    imul    edx
  7637 000058C8 01D3                                    add     ebx, edx
  7638 000058CA 8B14BD[74A10000]                        mov     edx, [(mp3_synth_buf+600h)+edi*4]
  7639 000058D1 8B04AD[ACF30400]                        mov     eax, [(mp3_synth_win+680h)+ebp*4]
  7640 000058D8 F7EA                                    imul    edx
  7641 000058DA 01D3                                    add     ebx, edx
  7642 000058DC 8B14BD[74A20000]                        mov     edx, [(mp3_synth_buf+700h)+edi*4]
  7643                                                                          ; [mp3_synth_buf+syn*4+(nn*64*4)] ; nn=7
  7644 000058E3 8B04AD[ACF40400]                        mov     eax, [(mp3_synth_win+780h)+ebp*4]
  7645                                                                          ; [mp3_synth_win+win*4+(nn*64*4)+ww*4] ; nn=7
  7646 000058EA F7EA                                    imul    edx
  7647 000058EC 01D3                                    add     ebx, edx
  7648 000058EE 81FB00002000                            cmp     ebx, 200000h    ; cmp @@sum,100h SHL (@@out_shift) ; out_shift=13
  7649 000058F4 7321                                    jnb     short .sat
  7650 000058F6 C1FB0D                                  sar     ebx, 13         ; sar @@sum,(@@out_shift)
  7651                                  
  7652                                  .sat_back:
  7653 000058F9 8819                                    mov     [ecx], bl       ; mov byte ptr [@@dst],@@sum_8bit
  7654 000058FB 030D[18F20000]                          add     ecx, [mp3_samples_dst_step]
  7655 00005901 83C604                                  add     esi, 4          ; add @@syn1,1 shl rate_shift ; rate_shift=2
  7656 00005904 83EF04                                  sub     edi, 4          ; add @@syn2,1 shl rate_shift
  7657 00005907 83C504                                  add     ebp, 4          ; add @@win1,1 shl rate_shift
  7658 0000590A F7C51F000000                            test    ebp, 1Fh        ; test @@win1,1Fh
  7659 00005910 0F85B3FEFFFF                            jnz     .samples_lop
  7660 00005916 C3                                      retn
  7661                                  
  7662                                  .sat:
  7663 00005917 C1FB1F                                  sar     ebx, 31         ; sar  @@sum,31 ; FFFFFFFFh,00000000h
  7664 0000591A F7D3                                    not     ebx
  7665 0000591C EBDB                                    jmp     short .sat_back
  7666                                  
  7667                                  .append_copy_to_window:
  7668 0000591E 8D3485[749B0000]                        lea     esi, [mp3_synth_buf+eax*4] ; IF SYNTH32
  7669 00005925 8DBE00080000                            lea     edi, [esi+2048] ; [esi+512*4]
  7670 0000592B B912000000                              mov     ecx, 18         ; (12h*4)/4
  7671 00005930 F3A5                                    rep movsd
  7672 00005932 E971FEFFFF                              jmp     .append_copy_to_window_back
  7673                                  
  7674                                  
  7675                                  ; =============== S U B R O U T I N E =======================================
  7676                                  
  7677                                  
  7678                                  mp3_any_init_synth_window:
  7679 00005937 31D2                                    xor     edx, edx        ; index (0..100h)
  7680 00005939 31C9                                    xor     ecx, ecx        ; delta.val
  7681 0000593B 898C12[2CED0400]                        mov     [mp3_synth_win+edx*2], ecx
  7682                                  
  7683                                  .synth_lop:
  7684 00005942 0FBF9C12[2A760000]                      movsx   ebx, word [mp3_synth_win_src+edx*2]
  7685 0000594A 01D9                                    add     ecx, ebx
  7686 0000594C 89C8                                    mov     eax, ecx
  7687 0000594E 803D[DA730000]00                        cmp     byte [option_fast], 0
  7688 00005955 7403                                    jz      short .not_fast
  7689 00005957 C1F805                                  sar     eax, 5
  7690                                  
  7691                                  .not_fast:
  7692 0000595A 803D[DA730000]00                        cmp	byte [option_fast], 0
  7693 00005961 7503                                    jnz	short .not_slow
  7694 00005963 C1E00E                                  shl	eax, 14         ; (WFRAC_BITS_slow-WFRAC_BITS_default)
  7695                                  
  7696                                  .not_slow:
  7697 00005966 42                                      inc     edx             ; index (1..100h)
  7698 00005967 BB00020000                              mov     ebx, 200h
  7699 0000596C 29D3                                    sub     ebx, edx        ; 1FFh..100h
  7700 0000596E 89049D[2CED0400]                        mov     [mp3_synth_win+ebx*4], eax
  7701 00005975 F7C23F000000                            test    edx, 3Fh
  7702 0000597B 7402                                    jz      short .synth_keep_sign
  7703 0000597D F7D8                                    neg     eax
  7704                                  
  7705                                  .synth_keep_sign:
  7706 0000597F 890495[2CED0400]                        mov     [mp3_synth_win+edx*4], eax
  7707 00005986 81FA00010000                            cmp     edx, 100h
  7708 0000598C 72B4                                    jb      short .synth_lop
  7709 0000598E 31D2                                    xor     edx, edx
  7710                                  
  7711                                  .synth_neg_lop:
  7712 00005990 F7C230000000                            test    edx, 30h        ; skip 0..0Fh (only negate 10h..3Fh)
  7713 00005996 7407                                    jz      short .synth_neg_next
  7714 00005998 F71C95[2CED0400]                        neg     dword [mp3_synth_win+edx*4]
  7715                                  
  7716                                  .synth_neg_next:
  7717 0000599F 42                                      inc     edx
  7718 000059A0 81FA00020000                            cmp     edx, 200h
  7719 000059A6 72E8                                    jb      short .synth_neg_lop
  7720 000059A8 31D2                                    xor     edx, edx
  7721                                  
  7722                                  .synth_swap_lop:
  7723 000059AA 89D0                                    mov     eax, edx
  7724 000059AC 83E03F                                  and     eax, 3Fh
  7725 000059AF 83E811                                  sub     eax, 17         ; swap win [(17..31)] with win[(17..31)+32)
  7726 000059B2 83F80E                                  cmp     eax, 14         ; 31-17
  7727 000059B5 7715                                    ja      short .synth_swap_next
  7728 000059B7 8B0495[2CED0400]                        mov     eax, [mp3_synth_win+edx*4]
  7729 000059BE 870495[ACED0400]                        xchg    eax, [(mp3_synth_win+80h)+edx*4]
  7730 000059C5 890495[2CED0400]                        mov     [mp3_synth_win+edx*4], eax
  7731                                  
  7732                                  .synth_swap_next:
  7733 000059CC 42                                      inc     edx
  7734 000059CD 81FA00020000                            cmp     edx, 200h
  7735 000059D3 72D5                                    jb      short .synth_swap_lop
  7736 000059D5 31D2                                    xor     edx, edx
  7737                                  
  7738                                  .synth_zero_lop:
  7739 000059D7 C70495[6CED0400]00-                     mov	dword [(mp3_synth_win+40h)+edx*4], 0
  7739 000059DF 000000             
  7740 000059E2 83C240                                  add	edx, 40h
  7741 000059E5 81FA00020000                            cmp	edx, 200h
  7742 000059EB 72EA                                    jb	short .synth_zero_lop
  7743 000059ED BE[2CED0400]                            mov	esi, mp3_synth_win
  7744 000059F2 8DBE00080000                            lea	edi, [esi+2048] ; [esi+512*4]
  7745 000059F8 B900020000                              mov	ecx, 512        ; append another copy
  7746 000059FD F3A5                                    rep movsd
  7747 000059FF C3                                      retn
  7748                                  
  7749                                  
  7750                                  ; =============== S U B R O U T I N E =======================================
  7751                                  
  7752                                  
  7753                                  mp3_init_post_collapse:
  7754 00005A00 803D[DA730000]00                        cmp	byte [option_fast], 0
  7755 00005A07 7411                                    jz	short .not_fast
  7756 00005A09 BE[2CED0400]                            mov	esi, mp3_synth_win
  7757 00005A0E 89F7                                    mov	edi, esi
  7758 00005A10 B900040000                              mov	ecx, 1024       ; 512*(1+LONG_WINDOW)
  7759                                  
  7760                                  .collapse_lop:
  7761 00005A15 AD                                      lodsd                   ; collapse 32bit to 16bit
  7762                                                                          ; (that's slightly faster due to better caching)
  7763 00005A16 66AB                                    stosw
  7764 00005A18 E2FB                                    loop    .collapse_lop
  7765                                  
  7766                                  .not_fast:
  7767 00005A1A C3                                      retn
  7768                                  
  7769                                  
  7770                                  ; =============== S U B R O U T I N E =======================================
  7771                                  
  7772                                  
  7773                                  mp3_any_init_band_indices:
  7774 00005A1B BE[5C7E0000]                            mov     esi, mp3_band_size_long
  7775 00005A20 BF[40D50100]                            mov     edi, mp3_band_index_long
  7776 00005A25 BB09000000                              mov     ebx, 9
  7777                                  
  7778                                  .band_index_lop_i:
  7779 00005A2A 31C0                                    xor     eax, eax
  7780 00005A2C B916000000                              mov     ecx, 22
  7781                                  
  7782                                  .band_index_lop_j:
  7783 00005A31 66AB                                    stosw
  7784 00005A33 0FB616                                  movzx   edx, byte [esi]
  7785 00005A36 01D0                                    add     eax, edx
  7786 00005A38 46                                      inc     esi
  7787 00005A39 E2F6                                    loop    .band_index_lop_j
  7788 00005A3B 83C10A                                  add     ecx, 10
  7789 00005A3E F366AB                                  rep stosw
  7790 00005A41 4B                                      dec     ebx
  7791 00005A42 75E6                                    jnz     short .band_index_lop_i
  7792 00005A44 C3                                      retn
  7793                                  
  7794                                  
  7795                                  ; =============== S U B R O U T I N E =======================================
  7796                                  
  7797                                  
  7798                                  mp3_any_init_lsf_sf_expand:
  7799 00005A45 BE[FA750000]                            mov     esi, mp3_lsf_sf_expand_init_table
  7800 00005A4A BF[2CFD0400]                            mov     edi, mp3_lsf_sf_expand_exploded_table
  7801 00005A4F 31D2                                    xor     edx, edx        ; curr.index
  7802 00005A51 31DB                                    xor     ebx, ebx        ; curr.base
  7803                                  
  7804                                  .lop:
  7805 00005A53 663B5606                                cmp     dx, [esi+6]     ; nextbase
  7806 00005A57 7207                                    jb      short .inrange
  7807 00005A59 668B5E06                                mov     bx, [esi+6]
  7808 00005A5D 83C608                                  add     esi, 8          ; next entry
  7809                                  
  7810                                  .inrange:
  7811 00005A60 89D0                                    mov     eax, edx
  7812 00005A62 29D8                                    sub     eax, ebx
  7813 00005A64 8A0E                                    mov     cl, [esi]
  7814 00005A66 D3E8                                    shr     eax, cl         ; div2
  7815 00005A68 F67603                                  div     byte [esi+3] ; mod3 ; [2]=slen[3]
  7816 00005A6B 886703                                  mov     [edi+3], ah
  7817 00005A6E B400                                    mov     ah, 0           ; eax=div.result
  7818 00005A70 F67602                                  div     byte [esi+2] ; mod2 ; [2]=slen[2]
  7819 00005A73 886702                                  mov     [edi+2], ah     ; remainder
  7820 00005A76 B400                                    mov     ah, 0
  7821 00005A78 F67601                                  div     byte [esi+1] ; mod1 ; [1]=slen[1]
  7822 00005A7B 668907                                  mov     [edi], ax       ; [0]=slen[0]
  7823 00005A7E 668B4604                                mov     ax, [esi+4]     ; [4]=tindex2
  7824 00005A82 66894704                                mov     [edi+4], ax     ; [5]=force_preflag
  7825 00005A86 83C708                                  add     edi, 8
  7826 00005A89 42                                      inc     edx             ; curr.index ; next
  7827 00005A8A 81FA00040000                            cmp     edx, 1024       ; 512+512
  7828 00005A90 72C1                                    jb      short .lop
  7829 00005A92 C3                                      retn
  7830                                  
  7831                                  
  7832                                  ; =============== S U B R O U T I N E =======================================
  7833                                  
  7834                                  
  7835                                  mp3_any_init_huff_tables:
  7836 00005A93 BD[94780000]                            mov     ebp, huff_tree_list_data
  7837 00005A98 BE[14830000]                            mov     esi, huff_tree_list_numbits
  7838 00005A9D BA01000000                              mov     edx, 1          ; idx (table 01h..11h)
  7839                                  
  7840                                  .huffman_table_lop:
  7841 00005AA2 31C0                                    xor     eax, eax
  7842 00005AA4 BF[58270500]                            mov     edi, mp3_huff_tmp_bits
  7843 00005AA9 B940000000                              mov     ecx, 40h        ; 100h/4 ; 100h x 8bit
  7844 00005AAE F3AB                                    rep stosd
  7845 00005AB0 BF[58280500]                            mov     edi, mp3_huff_tmp_codes
  7846 00005AB5 B980000000                              mov     ecx, 80h        ; 100h/2 ; 100h x 16bit
  7847 00005ABA F3AB                                    rep stosd
  7848 00005ABC 31DB                                    xor     ebx, ebx
  7849                                  
  7850                                  .huff_entry_lop:
  7851 00005ABE 0FB67D00                                movzx   edi, byte [ebp+0]
  7852 00005AC2 45                                      inc     ebp             ; dst=data
  7853 00005AC3 AC                                      lodsb                   ; numbits
  7854 00005AC4 8887[58270500]                          mov     [mp3_huff_tmp_bits+edi], al
  7855 00005ACA B120                                    mov     cl, 32
  7856 00005ACC 28C1                                    sub     cl, al          ; 32-numbits
  7857 00005ACE D3EB                                    shr     ebx, cl
  7858 00005AD0 66899C3F[58280500]                      mov     word [mp3_huff_tmp_codes+edi*2], bx
  7859 00005AD8 43                                      inc     ebx             ; next.code
  7860 00005AD9 D3E3                                    shl     ebx, cl         ; shift back to MSBs
  7861 00005ADB 75E1                                    jnz     short .huff_entry_lop
  7862 00005ADD 60                                      pusha
  7863 00005ADE B800010000                              mov     eax, 100h       ; nb_codes
  7864 00005AE3 BB[58270500]                            mov     ebx, mp3_huff_tmp_bits ; bits
  7865 00005AE8 BE[58280500]                            mov     esi, mp3_huff_tmp_codes ; codes
  7866 00005AED E837020000                              call    mp3_build_huff_table_root ; make table
  7867 00005AF2 61                                      popa
  7868 00005AF3 42                                      inc     edx             ; idx
  7869 00005AF4 83FA12                                  cmp     edx, 12h
  7870 00005AF7 75A9                                    jnz     short .huffman_table_lop ; next table
  7871 00005AF9 C3                                      retn
  7872                                  
  7873                                  
  7874                                  ; =============== S U B R O U T I N E =======================================
  7875                                  
  7876                                  
  7877                                  mp3_integer_init_is_stereo_lsf:
  7878 00005AFA 31FF                                    xor     edi, edi
  7879                                  
  7880                                  .lsf_lop:
  7881 00005AFC 89FE                                    mov     esi, edi
  7882 00005AFE 83E63F                                  and     esi, 3Fh
  7883 00005B01 46                                      inc     esi
  7884 00005B02 D1EE                                    shr     esi, 1
  7885 00005B04 F7C740000000                            test    edi, 40h
  7886 00005B0A 7402                                    jz      short .lsf_no_shift
  7887 00005B0C D1E6                                    shl     esi, 1
  7888                                  
  7889                                  .lsf_no_shift:
  7890 00005B0E BA00000040                              mov     edx, 40000000h  ; aka mul 1.000
  7891 00005B13 83C604                                  add     esi, 4
  7892 00005B16 F7C780000000                            test    edi, 80h        ; 2*40h
  7893 00005B1C 7408                                    jz      short .no_ms_stereo
  7894 00005B1E BA9A79825A                              mov     edx, 5A82799Ah  ; 2D413CCDh*2 ; aka mul 1.414
  7895 00005B23 83EE02                                  sub     esi, 2
  7896                                  
  7897                                  .no_ms_stereo:
  7898 00005B26 89F1                                    mov     ecx, esi
  7899 00005B28 C1E902                                  shr     ecx, 2          ; msbs
  7900 00005B2B 83E603                                  and     esi, 3          ; lsbs
  7901 00005B2E 8B04B5[54820000]                        mov     eax, [mp3_is_table_lsf_src+esi*4]
  7902 00005B35 D3E8                                    shr     eax, cl
  7903 00005B37 F7C701000000                            test    edi, 1
  7904 00005B3D 7501                                    jnz     short .lsf_no_swap
  7905 00005B3F 92                                      xchg    eax, edx
  7906                                  
  7907                                  .lsf_no_swap:
  7908 00005B40 8904FD[2CE50400]                        mov     [mp3_is_table_lsf+edi*8], eax
  7909 00005B47 8914FD[30E50400]                        mov     [(mp3_is_table_lsf+4)+edi*8], edx
  7910 00005B4E 47                                      inc     edi
  7911 00005B4F 81FF00010000                            cmp     edi, 100h
  7912 00005B55 72A5                                    jb      short .lsf_lop
  7913 00005B57 C3                                      retn
  7914                                  
  7915                                  
  7916                                  ; =============== S U B R O U T I N E =======================================
  7917                                  
  7918                                  
  7919                                  mp3_integer_init_mdct_windows:
  7920 00005B58 BF[ACE00400]                            mov     edi, mp3_mdct_win
  7921 00005B5D BE[DC7F0000]                            mov     esi, mp3_mdct_win_src
  7922 00005B62 B990000000                              mov     ecx, 144        ; 36*4
  7923 00005B67 F3A5                                    rep movsd
  7924 00005B69 BE[ACE00400]                            mov     esi, mp3_mdct_win
  7925 00005B6E BF[ECE20400]                            mov     edi, (mp3_mdct_win+240h)
  7926 00005B73 B948000000                              mov     ecx, 72         ; 4*36/2 ; that is, 4*36 entry pairs
  7927                                  
  7928                                  .mdct_lop_dupe:                       
  7929 00005B78 A5                                      movsd                   ; copy normal, [4..7][even] = +[0..3][even
  7930 00005B79 AD                                      lodsd
  7931 00005B7A F7D8                                    neg     eax             ; copy negated, [4..7][odd] = -[0..3][odd]
  7932 00005B7C AB                                      stosd
  7933 00005B7D E2F9                                    loop    .mdct_lop_dupe
  7934 00005B7F C3                                      retn
  7935                                  
  7936                                  
  7937                                  ; =============== S U B R O U T I N E =======================================
  7938                                  
  7939                                  
  7940                                  mp3_integer_init_table_4_3:
  7941 00005B80 803D[DA730000]00                        cmp	byte [option_fast], 0
  7942 00005B87 B048                                    mov	al, 72          ; 100-6-VFRAC_BITS_slow
  7943 00005B89 7402                                    jz	short .this_vfrac
  7944 00005B8B B04C                                    mov	al, 76          ; 100-6-VFRAC_BITS_fast
  7945                                  
  7946                                  .this_vfrac:
  7947 00005B8D A2[80F10000]                            mov     [mp3_curr_vfrac_bits], al
  7948 00005B92 31FF                                    xor     edi, edi
  7949                                  
  7950                                  .table_4_3_lop:
  7951 00005B94 57                                      push    edi             ; for i=1 to TABLE_4_3_SIZE-1
  7952 00005B95 89F8                                    mov     eax, edi
  7953 00005B97 C1E802                                  shr     eax, 2
  7954 00005B9A F7E0                                    mul     eax
  7955 00005B9C F7E0                                    mul     eax
  7956 00005B9E 31DB                                    xor     ebx, ebx
  7957 00005BA0 E8A2000000                              call    cbrt96
  7958 00005BA5 020D[80F10000]                          add     cl, [mp3_curr_vfrac_bits]
  7959 00005BAB 5F                                      pop     edi
  7960                                  
  7961                                  .inner_lop:
  7962 00005BAC 89F8                                    mov     eax, edi
  7963 00005BAE 83E003                                  and     eax, 3
  7964 00005BB1 8B0485[64820000]                        mov     eax, [mp3_pow2_quarters+eax*4]
  7965 00005BB8 F7E3                                    mul     ebx
  7966 00005BBA 88CD                                    mov     ch, cl
  7967 00005BBC 09D2                                    or      edx, edx
  7968 00005BBE 7904                                    jns     short .this
  7969 00005BC0 D1EA                                    shr     edx, 1
  7970 00005BC2 FECD                                    dec     ch
  7971                                  
  7972                                  .this:
  7973 00005BC4 8914BD[BC570200]                        mov     [mp3_table_4_3_value+edi*4], edx
  7974 00005BCB 88AF[80D70100]                          mov     [mp3_table_4_3_exp+edi], ch
  7975 00005BD1 47                                      inc     edi
  7976 00005BD2 F7C703000000                            test    edi, 3
  7977 00005BD8 75D2                                    jnz     short .inner_lop
  7978 00005BDA 81FF3C800000                            cmp     edi, 803Ch
  7979 00005BE0 72B2                                    jb      short .table_4_3_lop
  7980 00005BE2 C3                                      retn
  7981                                  
  7982                                  
  7983                                  ; =============== S U B R O U T I N E =======================================
  7984                                  
  7985                                  
  7986                                  mp3_integer_init_exponent:
  7987 00005BE3 BF[AC600400]                            mov     edi, mp3_expval_table
  7988 00005BE8 31D2                                    xor     edx, edx
  7989                                  
  7990                                  .exponent_lop:
  7991 00005BEA 89D0                                    mov     eax, edx        ; val=i
  7992 00005BEC 89D3                                    mov     ebx, edx
  7993 00005BEE 89D1                                    mov     ecx, edx
  7994 00005BF0 C1EB04                                  shr     ebx, 4
  7995 00005BF3 C1E906                                  shr     ecx, 6          ; 4+2
  7996 00005BF6 83E00F                                  and     eax, 0Fh        ; val=i AND 0Fh
  7997 00005BF9 83E303                                  and     ebx, 3
  7998 00005BFC 8D1C83                                  lea     ebx, [ebx+eax*4] ; (0..0Fh)*4+(0..3)
  7999 00005BFF 8B049D[BC570200]                        mov     eax, [mp3_table_4_3_value+ebx*4]
  8000 00005C06 09C0                                    or      eax, eax
  8001 00005C08 741A                                    jz      short .this
  8002 00005C0A 2A8B[80D70100]                          sub     cl, [mp3_table_4_3_exp+ebx]
  8003 00005C10 770D                                    ja      short .left_shift
  8004 00005C12 F6D9                                    neg     cl
  8005 00005C14 D3E8                                    shr     eax, cl
  8006 00005C16 80F91F                                  cmp     cl, 1Fh
  8007 00005C19 7609                                    jbe     short .this
  8008 00005C1B 31C0                                    xor     eax, eax
  8009 00005C1D EB05                                    jmp     short .this
  8010                                  
  8011                                  .left_shift:
  8012 00005C1F B8FFFFFF7F                              mov     eax, 7FFFFFFFh
  8013                                  
  8014                                  .this:
  8015 00005C24 AB                                      stosd
  8016 00005C25 42                                      inc     edx
  8017 00005C26 81FA00200000                            cmp     edx, 2000h
  8018 00005C2C 72BC                                    jb      short .exponent_lop
  8019 00005C2E BE[AC600400]                            mov     esi, mp3_expval_table
  8020 00005C33 BF[AC580400]                            mov     edi, mp3_exp_table
  8021 00005C38 B900020000                              mov     ecx, 200h
  8022                                  
  8023                                  .exponent_dupe_lop:
  8024 00005C3D 8B4604                                  mov     eax, [esi+4]
  8025 00005C40 AB                                      stosd
  8026 00005C41 83C640                                  add     esi, 40h
  8027 00005C44 E2F7                                    loop    .exponent_dupe_lop
  8028 00005C46 C3                                      retn
  8029                                  
  8030                                  
  8031                                  ; =============== S U B R O U T I N E =======================================
  8032                                  
  8033                                  
  8034                                  cbrt96:
  8035 00005C47 83EC18                                  sub     esp, 18h        ; cube root, val^(1/3), from https://gist.github.com/anonymous/729557
  8036                                                                          ; in:  ebx:edx:eax = unsigned 96bit input (integer)
  8037                                                                          ; out: ebx         = unsigned 32bit result (with fractional bits)
  8038                                                                          ; out: cl          = number of fractional bits
  8039 00005C4A 890424                                  mov     [esp], eax
  8040 00005C4D 89542404                                mov     [esp+4], edx
  8041 00005C51 895C2408                                mov     [esp+8], ebx
  8042 00005C55 C744240C00000000                        mov     dword [esp+0Ch], 0
  8043 00005C5D C744241000000000                        mov     dword [esp+10h], 0
  8044 00005C65 C744241400000000                        mov     dword [esp+14h], 0
  8045 00005C6D 31DB                                    xor     ebx, ebx        ; result.value
  8046 00005C6F B100                                    mov     cl, 0           ; result.fraction
  8047 00005C71 09D0                                    or      eax, edx        ; skip if zero
  8048 00005C73 742F                                    jz      short .pre_shift_done
  8049                                  
  8050                                  .pre_shift_lop:
  8051 00005C75 F7442408000000E0                        test    dword [esp+8], 0E0000000h
  8052 00005C7D 7525                                    jnz     short .pre_shift_done
  8053 00005C7F D12424                                  shl     dword [esp], 1
  8054 00005C82 D1542404                                rcl     dword [esp+4], 1
  8055 00005C86 D1542408                                rcl     dword [esp+8], 1
  8056 00005C8A D12424                                  shl     dword [esp], 1
  8057 00005C8D D1542404                                rcl     dword [esp+4], 1
  8058 00005C91 D1542408                                rcl     dword [esp+8], 1
  8059 00005C95 D12424                                  shl     dword [esp], 1
  8060 00005C98 D1542404                                rcl     dword [esp+4], 1
  8061 00005C9C D1542408                                rcl     dword [esp+8], 1
  8062 00005CA0 FEC1                                    inc     cl
  8063 00005CA2 EBD1                                    jmp     short .pre_shift_lop
  8064                                  
  8065                                  .pre_shift_done:
  8066 00005CA4 B520                                    mov     ch, 20h         ; loopcount
  8067                                  
  8068                                  .lop:
  8069 00005CA6 01DB                                    add     ebx, ebx        ; result*2
  8070 00005CA8 89D8                                    mov     eax, ebx        ; y
  8071 00005CAA 43                                      inc     ebx             ; result+1
  8072 00005CAB F7E3                                    mul     ebx             ; y*(y+1)
  8073 00005CAD 89C6                                    mov     esi, eax
  8074 00005CAF 89D7                                    mov     edi, edx
  8075 00005CB1 31ED                                    xor     ebp, ebp
  8076 00005CB3 F9                                      stc
  8077 00005CB4 11F6                                    adc     esi, esi        ; y*(y+1)*2+1
  8078 00005CB6 11FF                                    adc     edi, edi
  8079 00005CB8 11ED                                    adc     ebp, ebp
  8080 00005CBA 01C6                                    add     esi, eax
  8081 00005CBC 11D7                                    adc     edi, edx        ; y*(y+1)*3+1
  8082 00005CBE 83D500                                  adc     ebp, 0
  8083 00005CC1 D12424                                  shl     dword [esp], 1
  8084 00005CC4 D1542404                                rcl     dword [esp+4], 1
  8085 00005CC8 D1542408                                rcl     dword [esp+8], 1 ; shl 3
  8086 00005CCC D154240C                                rcl     dword [esp+0Ch], 1
  8087 00005CD0 D1542410                                rcl     dword [esp+10h], 1
  8088 00005CD4 D1542414                                rcl     dword [esp+14h], 1
  8089 00005CD8 D12424                                  shl     dword [esp], 1
  8090 00005CDB D1542404                                rcl     dword [esp+4], 1
  8091 00005CDF D1542408                                rcl     dword [esp+8], 1
  8092 00005CE3 D154240C                                rcl     dword [esp+0Ch], 1
  8093 00005CE7 D1542410                                rcl     dword [esp+10h], 1
  8094 00005CEB D1542414                                rcl     dword [esp+14h], 1
  8095 00005CEF D12424                                  shl     dword [esp], 1
  8096 00005CF2 D1542404                                rcl     dword [esp+4], 1
  8097 00005CF6 D1542408                                rcl     dword [esp+8], 1
  8098 00005CFA D154240C                                rcl     dword [esp+0Ch], 1
  8099 00005CFE D1542410                                rcl     dword [esp+10h], 1
  8100 00005D02 D1542414                                rcl     dword [esp+14h], 1
  8101 00005D06 2974240C                                sub     [esp+0Ch], esi
  8102 00005D0A 197C2410                                sbb     [esp+10h], edi  ; sub/compare
  8103 00005D0E 196C2414                                sbb     [esp+14h], ebp
  8104 00005D12 730D                                    jnb     short .next
  8105 00005D14 4B                                      dec     ebx
  8106 00005D15 0174240C                                add     [esp+0Ch], esi
  8107 00005D19 117C2410                                adc     [esp+10h], edi  ; undo
  8108 00005D1D 116C2414                                adc     [esp+14h], ebp
  8109                                  
  8110                                  .next:
  8111 00005D21 FECD                                    dec     ch
  8112 00005D23 7581                                    jnz     short .lop
  8113 00005D25 83C418                                  add     esp, 18h
  8114                                  mp3_init_log_constants:
  8115 00005D28 C3                                      retn
  8116                                  
  8117                                  ;mp3_init_log_constants:
  8118                                  ;                retn
  8119                                  
  8120                                  ; =============== S U B R O U T I N E =======================================
  8121                                  
  8122                                  
  8123                                  mp3_build_huff_table_root:
  8124 00005D29 A3[5C2A0500]                            mov     [_@@nb_codes], eax ; "init_vlc"
  8125 00005D2E C705[602A0500]0000-                     mov     dword [_@@prefix_numbits], 0
  8125 00005D36 0000               
  8126 00005D38 C705[642A0500]0000-                     mov     dword [_@@prefix_pattern], 0
  8126 00005D40 0000               
  8127 00005D42 60                                      pusha
  8128 00005D43 89C1                                    mov     ecx, eax
  8129 00005D45 31C0                                    xor     eax, eax
  8130                                  
  8131                                  .prescan_lop:
  8132 00005D47 3A03                                    cmp     al, [ebx]
  8133 00005D49 7702                                    ja      short .prescan_next
  8134 00005D4B 8A03                                    mov     al, [ebx]
  8135                                  
  8136                                  .prescan_next:
  8137 00005D4D 43                                      inc     ebx
  8138 00005D4E E2F7                                    loop    .prescan_lop
  8139 00005D50 3C09                                    cmp     al, 9           ; CHILD_BITS
  8140 00005D52 7202                                    jb      short .prescan_this_limit
  8141 00005D54 B009                                    mov     al, 9
  8142                                  
  8143                                  .prescan_this_limit:
  8144 00005D56 A3[582A0500]                            mov     [_@@table_nb_bits], eax
  8145 00005D5B 61                                      popa
  8146                                  
  8147                                  mp3_build_huff_table_recursive_child:
  8148 00005D5C 8B0D[582A0500]                          mov     ecx, [_@@table_nb_bits]
  8149 00005D62 B801000000                              mov     eax, 1
  8150 00005D67 D3E0                                    shl     eax, cl
  8151 00005D69 A3[682A0500]                            mov     [_@@curr_table_size], eax
  8152 00005D6E 48                                      dec     eax
  8153 00005D6F A3[6C2A0500]                            mov     [_@@curr_table_mask], eax
  8154 00005D74 60                                      pusha
  8155 00005D75 8B1D[78820000]                          mov     ebx, [mp3_huff_num_entries]
  8156 00005D7B 891D[702A0500]                          mov     [_@@curr_table_index], ebx
  8157 00005D81 031D[682A0500]                          add     ebx, [_@@curr_table_size]
  8158 00005D87 891D[78820000]                          mov     [mp3_huff_num_entries], ebx
  8159 00005D8D 813D[78820000]002E-                     cmp     dword [mp3_huff_num_entries], 11776 ; HUFF_TREE_SIZE/4
  8159 00005D95 0000               
  8160 00005D97 0F8781AFFFFF                            ja      fatalunexpected
  8161 00005D9D 61                                      popa
  8162 00005D9E BF[401D0100]                            mov     edi, huff_tree_buf
  8163 00005DA3 A1[702A0500]                            mov     eax, [_@@curr_table_index]
  8164 00005DA8 66890497                                mov     [edi+edx*4], ax
  8165 00005DAC A1[582A0500]                            mov     eax, [_@@table_nb_bits]
  8166 00005DB1 F7D8                                    neg     eax
  8167 00005DB3 6689449702                              mov     [edi+edx*4+2], ax
  8168 00005DB8 BF[401D0100]                            mov     edi, huff_tree_buf
  8169 00005DBD 8B15[702A0500]                          mov     edx, [_@@curr_table_index]
  8170 00005DC3 8B0D[682A0500]                          mov     ecx, [_@@curr_table_size]
  8171                                  
  8172                                  .clear_table_lop:
  8173 00005DC9 66C70497FFFF                            mov     word [edi+edx*4], 0FFFFh
  8174 00005DCF 66C74497020000                          mov     word [edi+edx*4+2], 0
  8175 00005DD6 42                                      inc     edx
  8176 00005DD7 E2F0                                    loop    .clear_table_lop
  8177 00005DD9 53                                      push    ebx
  8178 00005DDA 56                                      push    esi
  8179 00005DDB 31D2                                    xor     edx, edx
  8180                                  
  8181                                  .make_table_lop:
  8182 00005DDD 0FB60B                                  movzx   ecx, byte [ebx]
  8183 00005DE0 0FB706                                  movzx   eax, word [esi]
  8184 00005DE3 2B0D[602A0500]                          sub     ecx, [_@@prefix_numbits]
  8185 00005DE9 7E74                                    jle     short .make_table_lop_next
  8186 00005DEB D3E8                                    shr     eax, cl
  8187 00005DED 3B05[642A0500]                          cmp     eax, [_@@prefix_pattern]
  8188 00005DF3 756A                                    jnz     short .make_table_lop_next
  8189 00005DF5 BF[401D0100]                            mov     edi, huff_tree_buf
  8190 00005DFA 0FB706                                  movzx   eax, word [esi]
  8191 00005DFD 2B0D[582A0500]                          sub     ecx, [_@@table_nb_bits]
  8192 00005E03 773E                                    ja      short .create_child_table
  8193 00005E05 F7D9                                    neg     ecx
  8194 00005E07 D3E0                                    shl     eax, cl
  8195 00005E09 2305[6C2A0500]                          and     eax, [_@@curr_table_mask]
  8196 00005E0F 0305[702A0500]                          add     eax, [_@@curr_table_index]
  8197 00005E15 8D3C87                                  lea     edi, [edi+eax*4]
  8198 00005E18 B801000000                              mov     eax, 1
  8199 00005E1D D3E0                                    shl     eax, cl
  8200 00005E1F 89C1                                    mov     ecx, eax
  8201 00005E21 0FB603                                  movzx   eax, byte [ebx]
  8202 00005E24 2B05[602A0500]                          sub     eax, [_@@prefix_numbits]
  8203                                  
  8204                                  .make_rept_lop:
  8205 00005E2A 66837F0200                              cmp     word [edi+2], 0
  8206 00005E2F 0F85E9AEFFFF                            jnz     fatalunexpected
  8207 00005E35 668917                                  mov     [edi], dx
  8208 00005E38 66894702                                mov     [edi+2], ax
  8209 00005E3C 83C704                                  add     edi, 4
  8210 00005E3F E2E9                                    loop    .make_rept_lop
  8211 00005E41 EB1C                                    jmp     short .make_table_lop_next
  8212                                  
  8213                                  .create_child_table:
  8214 00005E43 D3E8                                    shr     eax, cl
  8215 00005E45 2305[6C2A0500]                          and     eax, [_@@curr_table_mask]
  8216 00005E4B 0305[702A0500]                          add     eax, [_@@curr_table_index]
  8217 00005E51 F7D9                                    neg     ecx
  8218 00005E53 66394C8702                              cmp     [edi+eax*4+2], cx
  8219 00005E58 7C05                                    jl      short .make_table_lop_next
  8220 00005E5A 66894C8702                              mov     [edi+eax*4+2], cx
  8221                                  
  8222                                  .make_table_lop_next:
  8223 00005E5F 83C602                                  add     esi, 2
  8224 00005E62 43                                      inc     ebx
  8225 00005E63 42                                      inc     edx
  8226 00005E64 3B15[5C2A0500]                          cmp     edx, [_@@nb_codes]
  8227 00005E6A 0F826DFFFFFF                            jb      .make_table_lop
  8228 00005E70 5E                                      pop     esi
  8229 00005E71 5B                                      pop     ebx
  8230 00005E72 8B0D[682A0500]                          mov     ecx, [_@@curr_table_size]
  8231 00005E78 8B15[702A0500]                          mov     edx, [_@@curr_table_index]
  8232                                  
  8233                                  .make_child_tables_lop:
  8234 00005E7E BF[401D0100]                            mov     edi, huff_tree_buf
  8235 00005E83 0FBF449702                              movsx   eax, word [edi+edx*4+2]
  8236 00005E88 83F800                                  cmp     eax, 0
  8237 00005E8B 796D                                    jns     short .make_child_tables_lop_next
  8238 00005E8D F7D8                                    neg     eax
  8239 00005E8F 3B05[582A0500]                          cmp     eax, [_@@table_nb_bits]
  8240 00005E95 7605                                    jbe     short .make_child_tables_this
  8241 00005E97 A1[582A0500]                            mov     eax, [_@@table_nb_bits]
  8242                                  
  8243                                  .make_child_tables_this:
  8244 00005E9C 51                                      push	ecx
  8245 00005E9D 52                                      push	edx
  8246 00005E9E FF35[702A0500]                          push	dword [_@@curr_table_index]
  8247 00005EA4 FF35[582A0500]                          push	dword [_@@table_nb_bits]
  8248 00005EAA FF35[602A0500]                          push	dword [_@@prefix_numbits]
  8249 00005EB0 FF35[642A0500]                          push	dword [_@@prefix_pattern]
  8250 00005EB6 8B0D[582A0500]                          mov	ecx, [_@@table_nb_bits]
  8251 00005EBC A3[582A0500]                            mov	[_@@table_nb_bits], eax
  8252 00005EC1 010D[602A0500]                          add	[_@@prefix_numbits], ecx
  8253 00005EC7 D325[642A0500]                          shl	dword [_@@prefix_pattern], cl
  8254 00005ECD 89D0                                    mov	eax, edx
  8255 00005ECF 2B05[702A0500]                          sub	eax, [_@@curr_table_index]
  8256 00005ED5 0905[642A0500]                          or	[_@@prefix_pattern], eax
  8257 00005EDB E87CFEFFFF                              call	mp3_build_huff_table_recursive_child
  8258 00005EE0 8F05[642A0500]                          pop	dword [_@@prefix_pattern]
  8259 00005EE6 8F05[602A0500]                          pop	dword [_@@prefix_numbits]
  8260 00005EEC 8F05[582A0500]                          pop	dword [_@@table_nb_bits]
  8261 00005EF2 8F05[702A0500]                          pop	dword [_@@curr_table_index]
  8262 00005EF8 5A                                      pop	edx
  8263 00005EF9 59                                      pop	ecx
  8264                                  
  8265                                  .make_child_tables_lop_next:
  8266 00005EFA 42                                      inc	edx
  8267 00005EFB E281                                    loop	.make_child_tables_lop
  8268 00005EFD C3                                      retn
  8269                                  
  8270                                  
  8271                                  ; =============== S U B R O U T I N E =======================================
  8272                                  
  8273                                  
  8274                                  mp3_exclude_id3_and_tag:
  8275 00005EFE 8B35[802A0500]                          mov     esi, [stream_pos]
  8276 00005F04 8B0D[842A0500]                          mov     ecx, [bytes_left]
  8277 00005F0A 83F90A                                  cmp     ecx, 10
  8278 00005F0D 7240                                    jb      short .no_id3
  8279 00005F0F 8B06                                    mov     eax, [esi]
  8280 00005F11 25FFFFFF00                              and     eax, 0FFFFFFh
  8281                                                  ;cmp    eax, '3DI'     ; "ID3"
  8282                                                  ; 20/10/2024 
  8283 00005F16 3D49443300                              cmp     eax, 'ID3'     ; FASM & NASM syntax
  8284 00005F1B 7532                                    jnz     short .no_id3
  8285 00005F1D 8B4606                                  mov     eax, [esi+6]
  8286 00005F20 A980808080                              test    eax, 80808080h
  8287 00005F25 7528                                    jnz     short .no_id3
  8288                                  
  8289                                  .xlat_4x7bit_to_28bit:
  8290 00005F27 86E0                                    xchg    al, ah
  8291 00005F29 D0E0                                    shl     al, 1
  8292 00005F2B 66D1E0                                  shl     ax, 1
  8293 00005F2E 66C1E802                                shr     ax, 2
  8294 00005F32 C1C810                                  ror     eax, 16
  8295 00005F35 86E0                                    xchg    al, ah
  8296 00005F37 D0E0                                    shl     al, 1
  8297 00005F39 66D1E0                                  shl     ax, 1
  8298 00005F3C C1E802                                  shr     eax, 2
  8299 00005F3F 83C00A                                  add     eax, 10
  8300 00005F42 39C1                                    cmp     ecx, eax
  8301 00005F44 7209                                    jb      short .no_id3
  8302 00005F46 01C6                                    add     esi, eax
  8303 00005F48 29C1                                    sub     ecx, eax
  8304 00005F4A A3[00F20000]                            mov     [mp3_id3_size], eax
  8305                                  
  8306                                  .no_id3:
  8307 00005F4F BA80000000                              mov     edx, 80h
  8308 00005F54 39D1                                    cmp     ecx, edx
  8309 00005F56 721F                                    jb      short .no_tag_or_ext
  8310 00005F58 8B440E80                                mov     eax, [esi+ecx-80h]
  8311 00005F5C 25FFFFFF00                              and     eax, 0FFFFFFh
  8312                                                  ;cmp    eax, 'GAT'     ; "TAG"
  8313                                                  ; 20/10/2024
  8314 00005F61 3D54414700                              cmp     eax, 'TAG'     ; FASM & NASM syntax
  8315 00005F66 0F8421010000                            jz      .got_tag_size_edx
  8316                                                  ;cmp    eax, 'TXE'
  8317 00005F6C 3D45585400                              cmp     eax, 'EXT'
  8318 00005F71 0F8416010000                            jz      .got_tag_size_edx
  8319                                  
  8320                                  .no_tag_or_ext:
  8321 00005F77 BAE3000000                              mov     edx, 0E3h
  8322 00005F7C 39D1                                    cmp     ecx, edx
  8323 00005F7E 7211                                    jb      short .no_tagplus
  8324                                                  ;cmp    dword [esi+ecx-0E3h], '+GAT' ; "TAG+"
  8325                                                  ; 20/10/2024
  8326 00005F80 81BC0E1DFFFFFF5441-                     cmp     dword [esi+ecx-0E3h], 'TAG+'
  8326 00005F89 472B               
  8327 00005F8B 0F84FC000000                            jz      .got_tag_size_edx
  8328                                  
  8329                                  .no_tagplus:
  8330 00005F91 BA14000000                              mov     edx, 20        ; 10+10
  8331 00005F96 39D1                                    cmp     ecx, edx
  8332 00005F98 723C                                    jb      short .no_3di  ; "3DI",04h
  8333 00005F9A 817C0EF633444904                        cmp     dword [esi+ecx-10], 4494433h ; 'ID3'+04000000h
  8334 00005FA2 7532                                    jnz     short .no_3di
  8335 00005FA4 F6440EFB10                              test    byte [esi+ecx-5], 10h ; bit 4
  8336 00005FA9 742B                                    jz      short .no_3di
  8337 00005FAB 8B440EFC                                mov     eax, [esi+ecx-4]
  8338 00005FAF A980808080                              test    eax, 80808080h
  8339 00005FB4 7520                                    jnz     short .no_3di
  8340                                  
  8341                                  .@xlat_4x7bit_to_28bit:
  8342 00005FB6 86E0                                    xchg    al, ah
  8343 00005FB8 D0E0                                    shl     al, 1
  8344 00005FBA 66D1E0                                  shl     ax, 1
  8345 00005FBD 66C1E802                                shr     ax, 2
  8346 00005FC1 C1C810                                  ror     eax, 10h
  8347 00005FC4 86E0                                    xchg    al, ah
  8348 00005FC6 D0E0                                    shl     al, 1
  8349 00005FC8 66D1E0                                  shl     ax, 1
  8350 00005FCB C1E802                                  shr     eax, 2
  8351 00005FCE 8D5014                                  lea     edx, [eax+20]  ; [eax+10+10] ; hdr+footer siz
  8352 00005FD1 E9B7000000                              jmp     .got_tag_size_edx
  8353                                  
  8354                                  .no_3di:
  8355                                                  ;cmp    dword [esi+ecx-32], 'TEPA' ; [esi+ecx-32+0]
  8356                                                  ; 20/10/2024
  8357 00005FD6 817C0EE041504554                        cmp     dword [esi+ecx-32], 'APET'
  8358                                                                         ; check "APETAGEX"
  8359 00005FDE 7520                                    jnz     short .no_ape
  8360                                                  ;cmp    dword [esi+ecx-28], 'XEGA' ; [esi+ecx-32+4]
  8361 00005FE0 817C0EE441474558                        cmp     dword [esi+ecx-28], 'AGEX'
  8362 00005FE8 7516                                    jnz     short .no_ape
  8363 00005FEA 8B540EEC                                mov     edx, [esi+ecx-20] ; [esi+ecx-32+12] ; get size
  8364 00005FEE F7440EF400000080                        test    dword [esi+ecx-12], 80000000h ; [esi+ecx-32+20],1 shl 31
  8365 00005FF6 7403                                    jz      short .no_ape_header
  8366 00005FF8 83C220                                  add     edx, 32        ; hdr.size
  8367                                  
  8368                                  .no_ape_header: 
  8369 00005FFB E98D000000                              jmp     .got_tag_size_edx
  8370                                  
  8371                                  .no_ape:
  8372 00006000 BA14000000                              mov     edx, 20        ; 11+9
  8373 00006005 39D1                                    cmp     ecx, edx       ; "LYRICSEND" or "LYRICS200"
  8374                                                                         ; (11+N+9 bytes each)
  8375 00006007 7258                                    jb      short .no_lyrics
  8376                                                  ;cmp    dword [esi+ecx-9], 'IRYL'
  8377                                                  ; 20/10/2024
  8378 00006009 817C0EF74C595249                        cmp     dword [esi+ecx-9], 'LYRI' ; FASM & NASM syntax
  8379 00006011 754E                                    jnz     short .no_lyrics
  8380 00006013 807C0EFB43                              cmp     byte [esi+ecx-5], 'C'
  8381 00006018 7547                                    jnz     short .no_lyrics
  8382                                                  ;cmp    dword [esi+ecx-4], 'DNES'
  8383 0000601A 817C0EFC53454E44                        cmp     dword [esi+ecx-4], 'SEND'
  8384 00006022 740C                                    jz      short .lyrics3_v1
  8385                                                  ;cmp    dword [esi+ecx-4], '002S'
  8386 00006024 817C0EFC53323030                        cmp     dword [esi+ecx-4], 'S200'
  8387 0000602C 7440                                    jz      short .lyrics3_v2
  8388 0000602E 7531                                    jnz     short .no_lyrics
  8389                                  
  8390                                  .lyrics3_v1:
  8391 00006030 BA14000000                              mov     edx, 20        ; 11+9
  8392                                  
  8393                                  .lyrics3_v1_size_lop:
  8394 00006035 8D040E                                  lea     eax, [esi+ecx]
  8395 00006038 29D0                                    sub     eax, edx
  8396                                                  ;cmp    dword [eax], 'IRYL' ; "LYRICSBEGIN"
  8397                                                  ; 20/10/2024
  8398 0000603A 81384C595249                            cmp     dword [eax], 'LYRI'
  8399 00006040 7512                                    jnz     short .lyrics3_v1_size_next
  8400                                                  ;cmp    dword [eax+4], 'EBSC'
  8401 00006042 81780443534245                          cmp     dword [eax+4], 'CSBE'
  8402 00006049 7509                                    jnz     short .lyrics3_v1_size_next
  8403                                                  ;cmp    dword [eax+7], 'NIGE'
  8404 0000604B 8178074547494E                          cmp     dword [eax+7], 'EGIN'
  8405 00006052 7439                                    jz      short .got_tag_size_edx
  8406                                  
  8407                                  .lyrics3_v1_size_next:
  8408 00006054 42                                      inc     edx
  8409 00006055 81FA00140000                            cmp     edx, 5120
  8410 0000605B 7704                                    ja      short .no_lyrics
  8411 0000605D 39CA                                    cmp     edx, ecx
  8412 0000605F 76D4                                    jbe     short .lyrics3_v1_size_lop
  8413                                                  ;jmp     short .no_lyrics
  8414                                  
  8415                                  .no_lyrics:
  8416                                                  ;jmp    short .footer_tag_all_done
  8417                                  		; 22/10/2024
  8418                                  .footer_tag_all_done:
  8419 00006061 8935[802A0500]                          mov     [stream_pos], esi
  8420 00006067 890D[842A0500]                          mov     [bytes_left], ecx
  8421 0000606D C3                                      retn
  8422                                  
  8423                                  .lyrics3_v2:
  8424 0000606E 51                                      push    ecx
  8425 0000606F 56                                      push    esi
  8426 00006070 8D740EF1                                lea     esi, [esi+ecx-15] ; [esi+ecx-6-9]
  8427 00006074 B906000000                              mov     ecx, 6
  8428 00006079 31D2                                    xor     edx, edx
  8429                                  
  8430                                  .lyrics3_v2_size_lop:
  8431 0000607B 6BD20A                                  imul    edx, 10
  8432 0000607E 0FB606                                  movzx   eax, byte [esi]
  8433 00006081 46                                      inc     esi
  8434 00006082 2C30                                    sub     al, 30h
  8435 00006084 01C2                                    add     edx, eax
  8436 00006086 E2F3                                    loop    .lyrics3_v2_size_lop
  8437 00006088 5E                                      pop     esi
  8438 00006089 59                                      pop     ecx
  8439 0000608A 83C20F                                  add     edx, 0Fh       ; 6+9
  8440                                                  ;jmp    short .got_tag_size_edx
  8441                                  
  8442                                  .got_tag_size_edx:
  8443                                  		;;;
  8444                                  		; 22/10/2024
  8445 0000608D 29D1                                    sub    ecx, edx
  8446 0000608F 7311                                    jnb    short .cont
  8447                                  		;;;
  8448 00006091 89D0                                    mov     eax, edx
  8449 00006093 E853050000                              call    wr_decimal_eax
  8450 00006098 E822050000                              call    wrcrlf
  8451                                                  ;;;
  8452                                  		;sub    ecx, edx
  8453                                                  ;jb     fatalunexpected
  8454 0000609D E97CACFFFF              		jmp	fatalunexpected
  8455                                  .cont:
  8456                                  		;;;
  8457 000060A2 0115[04F20000]                          add     [mp3_tag_size], edx
  8458 000060A8 E9A2FEFFFF                              jmp     .no_id3
  8459                                  
  8460                                  
  8461                                  ; =============== S U B R O U T I N E =======================================
  8462                                  
  8463                                  
  8464                                  mp3_detect_free_format_block_size:
  8465 000060AD 833D[7CF10000]00                        cmp     dword [mp3_free_format_frame_size], 0
  8466 000060B4 0F85A5000000                            jnz     .already_detected
  8467 000060BA 31D2                                    xor     edx, edx
  8468                                  
  8469                                  .find_distance_lop:
  8470 000060BC 3B15[2CF20000]                          cmp     edx, [mp3_src_remain]
  8471 000060C2 742B                                    jz      short .match_eof
  8472 000060C4 8D4204                                  lea     eax, [edx+4]
  8473 000060C7 3B05[2CF20000]                          cmp     eax, [mp3_src_remain]
  8474 000060CD 771E                                    ja      short .find_distance_failed
  8475 000060CF 8B0416                                  mov     eax, [esi+edx]
  8476 000060D2 E8EDA0FFFF                              call    bswap_eax
  8477 000060D7 3305[2C9B0000]                          xor     eax, [mp3_hdr_32bit_header]
  8478 000060DD 25000CFEFF                              and     eax, 0FFFE0C00h
  8479 000060E2 740B                                    jz      short .match_eof
  8480                                  
  8481                                  .find_distance_next:
  8482 000060E4 42                                      inc     edx
  8483 000060E5 81FA00100000                            cmp     edx, 1000h
  8484 000060EB 76CF                                    jbe     short .find_distance_lop
  8485                                  
  8486                                  .find_distance_failed:
  8487 000060ED F9                                      stc
  8488 000060EE C3                                      retn
  8489                                  
  8490                                  .match_eof:
  8491 000060EF 89D0                                    mov     eax, edx
  8492 000060F1 2B05[389B0000]                          sub     eax, [mp3_hdr_flag_padding]
  8493 000060F7 83F804                                  cmp     eax, 4
  8494 000060FA 72E8                                    jb      short .find_distance_next
  8495 000060FC A3[7CF10000]                            mov     [mp3_free_format_frame_size], eax
  8496 00006101 31DB                                    xor     ebx, ebx
  8497                                  
  8498                                  .confirm_distance_lop:
  8499 00006103 8B041E                                  mov     eax, [esi+ebx]
  8500 00006106 E8B9A0FFFF                              call    bswap_eax
  8501 0000610B C1E80A                                  shr     eax, 10         ; 9+1
  8502 0000610E 131D[7CF10000]                          adc     ebx, [mp3_free_format_frame_size]
  8503 00006114 3B1D[2CF20000]                          cmp     ebx, [mp3_src_remain]
  8504 0000611A 7422                                    jz      short .confirm_distance_match_eof
  8505 0000611C 8D4304                                  lea     eax, [ebx+4]
  8506 0000611F 3B05[2CF20000]                          cmp     eax, [mp3_src_remain]
  8507 00006125 77BD                                    ja      short .find_distance_next
  8508 00006127 8B041E                                  mov     eax, [esi+ebx]
  8509 0000612A E895A0FFFF                              call    bswap_eax
  8510 0000612F 3305[2C9B0000]                          xor     eax, [mp3_hdr_32bit_header]
  8511 00006135 25000CFEFF                              and     eax, 0FFFE0C00h
  8512 0000613A 75A8                                    jnz     short .find_distance_next
  8513 0000613C EBC5                                    jmp     short .confirm_distance_lop
  8514                                  
  8515                                  .confirm_distance_match_eof:
  8516 0000613E A1[7CF10000]                            mov     eax, [mp3_free_format_frame_size]
  8517 00006143 C1E003                                  shl     eax, 3
  8518 00006146 F725[3C9B0000]                          mul     dword [mp3_sample_rate]
  8519 0000614C 8B0D[3CF20000]                          mov     ecx, [mp3_nb_granules]
  8520 00006152 69C940020000                            imul    ecx, 240h
  8521 00006158 F7F1                                    div     ecx
  8522 0000615A A3[449B0000]                            mov     [mp3_bit_rate], eax
  8523                                  
  8524                                  .already_detected:
  8525 0000615F F8                                      clc
  8526 00006160 C3                                      retn
  8527                                  
  8528                                  
  8529                                  ; =============== S U B R O U T I N E =======================================
  8530                                  
  8531                                  
  8532                                  mp3_check_xing_info:
  8533 00006161 C705[84F10000]0000-                     mov     dword [mp3_xing_id], 0
  8533 00006169 0000               
  8534 0000616B C705[8CF10000]0000-                     mov     dword [mp3_xing_frames], 0
  8534 00006173 0000               
  8535 00006175 C705[90F10000]0000-                     mov     dword [mp3_xing_filesize], 0
  8535 0000617D 0000               
  8536 0000617F 8B35[209B0000]                          mov     esi, [mp3_src_data_location]
  8537 00006185 AD                                      lodsd
  8538                                                  ;cmp    eax, 'gniX'
  8539                                  		; 20/10/2024
  8540 00006186 3D58696E67              		cmp	eax, 'Xing'     ; FASM & NASM syntax
  8541 0000618B 7401                                    jz      short .xing
  8542 0000618D C3                                      retn
  8543                                  
  8544                                  .xing:
  8545 0000618E A3[84F10000]                            mov     [mp3_xing_id], eax
  8546 00006193 AD                                      lodsd
  8547 00006194 E82BA0FFFF                              call    bswap_eax
  8548 00006199 A3[88F10000]                            mov     [mp3_xing_flags], eax
  8549 0000619E 89C2                                    mov     edx, eax
  8550 000061A0 F7C201000000                            test    edx, 1
  8551 000061A6 740B                                    jz      short .no_xing_frames
  8552 000061A8 AD                                      lodsd
  8553 000061A9 E816A0FFFF                              call    bswap_eax
  8554 000061AE A3[8CF10000]                            mov     [mp3_xing_frames], eax
  8555                                  
  8556                                  .no_xing_frames:
  8557 000061B3 F7C202000000                            test    edx, 2          ; 1 shl 1
  8558 000061B9 740B                                    jz      short .no_xing_filesize
  8559 000061BB AD                                      lodsd
  8560 000061BC E803A0FFFF                              call    bswap_eax
  8561 000061C1 A3[90F10000]                            mov     [mp3_xing_filesize], eax
  8562                                  
  8563                                  .no_xing_filesize:
  8564 000061C6 F7C204000000                            test    edx, 4          ; 1 shl 2
  8565 000061CC 740C                                    jz      short .no_xing_toc
  8566 000061CE B964000000                              mov     ecx, 100
  8567 000061D3 BF[94F10000]                            mov     edi, mp3_xing_toc
  8568 000061D8 F3A4                                    rep movsb
  8569                                  
  8570                                  .no_xing_toc:
  8571 000061DA F7C208000000                            test    edx, 8          ; 1 shl 3
  8572 000061E0 740B                                    jz      short .no_xing_vbr_scale
  8573 000061E2 AD                                      lodsd
  8574 000061E3 E8DC9FFFFF                              call    bswap_eax
  8575 000061E8 A3[F8F10000]                            mov     [mp3_xing_vbr_scale], eax
  8576                                  
  8577                                  .no_xing_vbr_scale:
  8578 000061ED C705[449B0000]0000-                     mov	dword [mp3_bit_rate], 0
  8578 000061F5 0000               
  8579 000061F7 A1[3C9B0000]                            mov	eax, [mp3_sample_rate]
  8580 000061FC C1E003                                  shl	eax, 3
  8581 000061FF F725[90F10000]                          mul	dword [mp3_xing_filesize]
  8582 00006205 8B0D[8CF10000]                          mov	ecx, [mp3_xing_frames]
  8583 0000620B 0FAF0D[3CF20000]                        imul	ecx, [mp3_nb_granules]
  8584 00006212 69C940020000                            imul	ecx, 576        ; 18*32
  8585 00006218 39CA                                    cmp	edx, ecx
  8586 0000621A 7307                                    jnb	short .overflow
  8587 0000621C F7F1                                    div	ecx
  8588 0000621E A3[449B0000]                            mov	[mp3_bit_rate], eax
  8589                                  
  8590                                  .overflow:
  8591 00006223 C3                                      retn
  8592                                  
  8593                                  
  8594                                  ; =============== S U B R O U T I N E =======================================
  8595                                  
  8596                                  		; 20/10/2024
  8597                                  mp3_decode_frame:
  8598 00006224 890D[2CF20000]                          mov     [mp3_src_remain], ecx
  8599 0000622A 893D[10F20000]                          mov     [mp3_samples_dst], edi
  8600 00006230 F605[DC730000]10                        test    byte [cpuid_flags], 10h
  8601 00006237 740E                                    jz      short .no_rdtsc_supported@@@@
  8602 00006239 0F31                                    rdtsc
  8603 0000623B 2905[9C750000]                          sub     [rdtsc_total], eax
  8604 00006241 1915[A0750000]                          sbb     [rdtsc_total+4], edx
  8605                                  
  8606                                  .no_rdtsc_supported@@@@:
  8607 00006247 E8DC9FFFFF                              call    mp3_search_get_header
  8608 0000624C 0F8294010000                            jc      .error
  8609 00006252 A1[249B0000]                            mov     eax, [mp3_src_frame_size]
  8610 00006257 83F800                                  cmp     eax, 0
  8611 0000625A 0F8E86010000                            jle     .error
  8612 00006260 3B05[2CF20000]                          cmp     eax, [mp3_src_remain]
  8613 00006266 0F877A010000                            ja      .error
  8614 0000626C 8935[28F20000]                          mov     [mp3_bitstream_start], esi
  8615                                  		; 11/01/2025
  8616                                  		;mov	eax, 32
  8617                                  
  8618                                  .mp3mac_bitstream_set_position:
  8619                                  		; 22/10/2024
  8620                                                  ;mov    esi, [mp3_bitstream_start]
  8621                                                  ;mov    cl, al
  8622                                                  ;shr    eax, 3
  8623                                                  ;and    cl, 7
  8624                                                  ;mov	eax, 4
  8625                                                  ;add    esi, eax
  8626 00006272 83C604                                  add     esi, 4
  8627 00006275 E8529FFFFF                              call    mp3_recollect_bits
  8628                                  
  8629                                  .mp3mac_get_n_bits:
  8630                                                  ;mov    eax, ebp        ; mp3_col32
  8631                                                  ;shl    ebp, cl
  8632                                                  ;rol    eax, cl
  8633                                                  ;xor    eax, ebp        ; mp3_col32
  8634                                                  ;sub    ch, cl          ; sub mp3_colNN,num
  8635                                                  ;jns    short .cont
  8636                                                  ;mov    cl, ch          ; mov cl,mp3_colNN
  8637                                                  ;add    ch, 16
  8638                                                  ;rol    ebp, cl         ; rol mp3_col32,cl
  8639                                                  ;mov    bp, [esi]       ; mov mp3_col16,word ptr [esi]
  8640                                                  ;add    esi, 2
  8641                                                  ;ror    bp, 8           ; endianess
  8642                                                  ;ror    ebp, cl         ; ror mp3_col32,cl
  8643                                  
  8644                                  .cont:
  8645 0000627A E8AFA1FFFF                              call	mp3_bitstream_read_header_extra
  8646 0000627F E839A3FFFF                              call	mp3_bitstream_read_granules
  8647 00006284 0F825C010000                            jc	.error
  8648 0000628A E88D9FFFFF                              call	mp3_uncollect_bits
  8649 0000628F 8935[209B0000]                          mov	[mp3_src_data_location], esi
  8650 00006295 833D[10F20000]00                        cmp	dword [mp3_samples_dst], 0
  8651 0000629C 0F840F010000                            jz	.skip_decoding
  8652 000062A2 E8ECA7FFFF                              call	mp3_bitstream_append_to_main_data_pool
  8653 000062A7 833D[14F20000]00                        cmp	dword [mp3_samples_output_size], 0
  8654 000062AE 0F84FD000000                            jz	.skip_decoding
  8655 000062B4 C705[20F20000]0000-                     mov	dword [mp3_curr_granule], 0
  8655 000062BC 0000               
  8656 000062BE BB[40F20000]                            mov	ebx, mp3_granules
  8657                                  
  8658                                  .body_granule_lop:
  8659 000062C3 891D[742A0500]                          mov	[_@@granule_addr], ebx
  8660 000062C9 C705[1CF20000]0000-                     mov	dword [mp3_curr_channel], 0
  8660 000062D1 0000               
  8661                                  
  8662                                  .body_channel_lop:
  8663 000062D3 8B4304                                  mov     eax, [ebx+4]    ; [ebx+$mp3gr_part2_3_start]
  8664 000062D6 8B35[28F20000]                          mov     esi, [mp3_bitstream_start]
  8665 000062DC 88C1                                    mov     cl, al          ; mp3mac_bitstream_set_position
  8666 000062DE C1E803                                  shr     eax, 3
  8667 000062E1 80E107                                  and     cl, 7
  8668 000062E4 01C6                                    add     esi, eax
  8669 000062E6 E8E19EFFFF                              call    mp3_recollect_bits
  8670 000062EB 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits cl
  8671 000062ED D3E5                                    shl     ebp, cl
  8672 000062EF D3C0                                    rol     eax, cl
  8673 000062F1 31E8                                    xor     eax, ebp
  8674 000062F3 28CD                                    sub     ch, cl
  8675 000062F5 7913                                    jns     short .cont@
  8676 000062F7 88E9                                    mov     cl, ch          ; mp3mac_collect_more
  8677 000062F9 80C510                                  add     ch, 16
  8678 000062FC D3C5                                    rol     ebp, cl
  8679 000062FE 668B2E                                  mov     bp, [esi]
  8680 00006301 83C602                                  add     esi, 2
  8681 00006304 66C1CD08                                ror     bp, 8
  8682 00006308 D3CD                                    ror     ebp, cl
  8683                                  
  8684                                  .cont@:
  8685 0000630A E81AA8FFFF                              call    mp3_bitstream_read_scalefacs
  8686 0000630F E812AAFFFF                              call    mp3_get_exponents_from_scale_factors
  8687 00006314 E856ABFFFF                              call    mp3_huffman_decode ; reads up to $mp3gr_part2_3_end
  8688 00006319 0F82C7000000                            jc      .error
  8689                                  
  8690                                  .body_channel_next:
  8691 0000631F 81C340130000                            add	ebx, 4928       ; $mp3gr_entrysiz*2
  8692 00006325 FF05[1CF20000]                          inc	dword [mp3_curr_channel]
  8693 0000632B A1[1CF20000]                            mov	eax, [mp3_curr_channel]
  8694 00006330 3B05[4C9B0000]                          cmp	eax, [mp3_output_num_channels]
  8695 00006336 729B                                    jb	short .body_channel_lop
  8696 00006338 8B1D[742A0500]                          mov	ebx, [_@@granule_addr]
  8697                                  
  8698                                  .mp3mac_push_bitstream:
  8699 0000633E 51                                      push	ecx
  8700 0000633F 55                                      push	ebp
  8701 00006340 56                                      push	esi
  8702 00006341 E827B0FFFF                              call	mp3_compute_stereo
  8703 00006346 C705[1CF20000]0000-                     mov	dword [mp3_curr_channel], 0
  8703 0000634E 0000               
  8704                                  
  8705                                  .cast_channel_lop:
  8706 00006350 E8F0B2FFFF                              call    mp3_reorder_block
  8707 00006355 E885B3FFFF                              call    mp3_compute_antialias
  8708 0000635A E870BCFFFF                              call    mp3_compute_imdct
  8709 0000635F 81C340130000                            add     ebx, 4928       ; $mp3gr_entrysiz*2
  8710 00006365 FF05[1CF20000]                          inc	dword [mp3_curr_channel]
  8711 0000636B A1[1CF20000]                            mov     eax, [mp3_curr_channel]
  8712 00006370 3B05[4C9B0000]                          cmp     eax, [mp3_output_num_channels]
  8713 00006376 72D8                                    jc      short .cast_channel_lop
  8714                                  
  8715                                  .mp3mac_pop_bitstream:
  8716 00006378 5E                                      pop	esi
  8717 00006379 5D                                      pop	ebp
  8718 0000637A 59                                      pop	ecx
  8719 0000637B 8B1D[742A0500]                          mov	ebx, [_@@granule_addr]
  8720 00006381 81C3A0090000                            add	ebx, 2464       ; $mp3gr_entrysiz
  8721 00006387 FF05[20F20000]                          inc	dword [mp3_curr_granule]
  8722 0000638D A1[20F20000]                            mov	eax, [mp3_curr_granule]
  8723 00006392 3B05[3CF20000]                          cmp	eax, [mp3_nb_granules]
  8724 00006398 0F8225FFFFFF                            jc	.body_granule_lop
  8725 0000639E E8799EFFFF                              call	mp3_uncollect_bits
  8726 000063A3 3B35[1C9B0000]                          cmp	esi, [main_data_pool_wr_ptr]
  8727 000063A9 773B                                    ja	short .error
  8728 000063AB FF15[709B0000]                          call	dword [mp3_synth_filter_proc] ; synth maths
  8729                                  
  8730                                  .skip_decoding:
  8731 000063B1 A1[30F20000]                            mov     eax, [mp3_extra_bytes]
  8732 000063B6 0105[249B0000]                          add     [mp3_src_frame_size], eax
  8733 000063BC A1[14F20000]                            mov     eax, [mp3_samples_output_size]
  8734 000063C1 0105[0CF20000]                          add     [mp3_total_output_size], eax
  8735 000063C7 FF05[08F20000]                          inc     dword [mp3_num_frames_decoded]
  8736                                  
  8737                                  .timelog_end:                            ; timelog_end macro ttt
  8738 000063CD F605[DC730000]10                        test    byte [cpuid_flags], 10h
  8739 000063D4 740F                                    jz      short .no_rdtsc_supported
  8740 000063D6 0F31                                    rdtsc                   ; read timestamp counter
  8741 000063D8 0105[9C750000]                          add     [rdtsc_total], eax
  8742 000063DE 1115[A0750000]                          adc     [rdtsc_total+4], edx
  8743                                  		; 22/10/2024
  8744 000063E4 F8                      		clc	
  8745                                  		; 20/10/2024
  8746                                  .no_rdtsc_supported:
  8747                                                  ;clc
  8748 000063E5 C3                                      retn
  8749                                  
  8750                                  .error:
  8751 000063E6 F605[DC730000]10                        test    byte [cpuid_flags], 10h ; timelog_end rdtsc_total
  8752 000063ED 740E                                    jz      short .no_rdtsc_supported@
  8753 000063EF 0F31                                    rdtsc
  8754 000063F1 0105[9C750000]                          add     [rdtsc_total], eax
  8755 000063F7 1115[A0750000]                          adc     [rdtsc_total+4], edx
  8756                                  
  8757                                  		; 20/10/2024
  8758                                  .no_rdtsc_supported@:
  8759 000063FD A1[30F20000]                            mov     eax, [mp3_extra_bytes]
  8760 00006402 0105[249B0000]                          add     [mp3_src_frame_size], eax
  8761 00006408 F9                                      stc
  8762 00006409 C3                                      retn
  8763                                  
  8764                                  
  8765                                  ; =============== S U B R O U T I N E =======================================
  8766                                  
  8767                                  
  8768                                  mp3_init:
  8769 0000640A BF[1C8B0000]                            mov     edi, main_data_pool_start ; = mp3_context_start
  8770                                                  ;mov    ecx, 74916      ; (mp3_context_end-mp3_context_start)/4
  8771 0000640F B984240100                              mov     ecx, (mp3_context_end-mp3_context_start)/4
  8772 00006414 31C0                                    xor     eax, eax        ; ERRIF @@len AND 03h
  8773 00006416 F3AB                                    rep stosd               ; clear context
  8774 00006418 C705[1C9B0000]-                         mov	dword [main_data_pool_wr_ptr], main_data_pool_start
  8774 0000641E [1C8B0000]         
  8775 00006422 833D[74820000]00                        cmp     dword [mp3_initialized], 0
  8776 00006429 753C                                    jnz     short .already_initialized
  8777 0000642B E8CAF6FFFF                              call    mp3_integer_init_is_stereo_lsf
  8778 00006430 E823F7FFFF                              call    mp3_integer_init_mdct_windows
  8779 00006435 E846F7FFFF                              call    mp3_integer_init_table_4_3
  8780 0000643A E8A4F7FFFF                              call    mp3_integer_init_exponent
  8781 0000643F E8F3F4FFFF                              call    mp3_any_init_synth_window
  8782 00006444 E8D2F5FFFF                              call    mp3_any_init_band_indices
  8783 00006449 E8F7F5FFFF                              call    mp3_any_init_lsf_sf_expand
  8784 0000644E E840F6FFFF                              call    mp3_any_init_huff_tables
  8785 00006453 E8D0F8FFFF                              call    mp3_init_log_constants
  8786 00006458 E8A3F5FFFF                              call    mp3_init_post_collapse
  8787 0000645D C705[74820000]0100-                     mov     dword [mp3_initialized], 1
  8787 00006465 0000               
  8788                                  
  8789                                  .already_initialized:
  8790 00006467 0FB605[DA730000]                        movzx   eax, byte [option_fast]
  8791 0000646E C705[549B0000]0200-                     mov     dword [mp3_bytes_per_sample], 2
  8791 00006476 0000               
  8792 00006478 D1E0                                    shl     eax, 1
  8793 0000647A 0205[D8730000]                          add     al, [option_8bit]
  8794 00006480 A801                                    test    al, 1
  8795 00006482 740A                                    jz      short .not_8bit
  8796 00006484 C705[549B0000]0100-                     mov     dword [mp3_bytes_per_sample], 1
  8796 0000648C 0000               
  8797                                  
  8798                                  .not_8bit:
  8799 0000648E 6BC003                                  imul    eax, 3
  8800 00006491 0205[D9730000]                          add     al, [option_rate_shift]
  8801 00006497 8B0485[9A880000]                        mov     eax, [mp3_synth_filter_procs+eax*4]
  8802 0000649E A3[709B0000]                            mov     [mp3_synth_filter_proc], eax
  8803 000064A3 C3                                      retn
  8804                                  
  8805                                  
  8806                                  ; =============== S U B R O U T I N E =======================================
  8807                                  
  8808                                  
  8809                                  mp3_check_1st_frame:
  8810 000064A4 E855FAFFFF                              call    mp3_exclude_id3_and_tag
  8811 000064A9 8B35[802A0500]                          mov     esi, [stream_pos]
  8812 000064AF 8B0D[842A0500]                          mov     ecx, [bytes_left]
  8813 000064B5 31FF                                    xor     edi, edi
  8814 000064B7 31ED                                    xor     ebp, ebp
  8815 000064B9 E866FDFFFF                              call    mp3_decode_frame
  8816 000064BE 0F82E9000000                            jc     .error
  8817 000064C4 E898FCFFFF                              call    mp3_check_xing_info
  8818 000064C9 BA[F8880000]                            mov     edx, txt_file_size ; "file size: "
  8819 000064CE E8DB000000                              call    wrstr_edx
  8820 000064D3 A1[FCF10000]                            mov     eax, [mp3_file_size]
  8821 000064D8 E807010000                              call    wr_decimal_eax_with_thousands_seperator
  8822 000064DD BA[04890000]                            mov     edx, txt_id3_size ; ", id3 size: "
  8823 000064E2 E8C7000000                              call    wrstr_edx
  8824 000064E7 A1[00F20000]                            mov     eax, [mp3_id3_size]
  8825 000064EC E8F3000000                              call    wr_decimal_eax_with_thousands_seperator
  8826 000064F1 BA[11890000]                            mov     edx, txt_tag_size ; ", tag size: "
  8827 000064F6 E8B3000000                              call    wrstr_edx
  8828 000064FB A1[04F20000]                            mov     eax, [mp3_tag_size]
  8829 00006500 E8DF000000                              call    wr_decimal_eax_with_thousands_seperator
  8830 00006505 E8B5000000                              call    wrcrlf
  8831 0000650A BA[1E890000]                            mov     edx, txt_input ; "input: "
  8832 0000650F E89A000000                              call    wrstr_edx
  8833 00006514 A1[3C9B0000]                            mov     eax, [mp3_sample_rate]
  8834 00006519 E8CD000000                              call    wr_decimal_eax
  8835 0000651E BA[2F890000]                            mov     edx, txt_hz ; " hz, "
  8836 00006523 E886000000                              call    wrstr_edx
  8837 00006528 A1[489B0000]                            mov     eax, [mp3_src_num_channels]
  8838 0000652D E8B9000000                              call    wr_decimal_eax
  8839 00006532 BA[35890000]                            mov     edx, txt_channels ; " channels, "
  8840 00006537 E872000000                              call    wrstr_edx
  8841 0000653C A1[449B0000]                            mov     eax, [mp3_bit_rate]
  8842 00006541 31D2                                    xor     edx, edx
  8843 00006543 B9E8030000                              mov     ecx, 1000
  8844 00006548 F7F1                                    div     ecx
  8845 0000654A E89C000000                              call    wr_decimal_eax
  8846 0000654F BA[46890000]                            mov     edx, txt_kbit_s ; " kbit/s"
  8847 00006554 E855000000                              call    wrstr_edx
  8848 00006559 E861000000                              call    wrcrlf
  8849 0000655E BA[26890000]                            mov     edx, txt_output ; "output: "
  8850 00006563 E846000000                              call    wrstr_edx
  8851 00006568 A1[509B0000]                            mov     eax, [mp3_output_sample_rate]
  8852 0000656D E879000000                              call    wr_decimal_eax
  8853 00006572 BA[2F890000]                            mov     edx, txt_hz ; " hz, "
  8854 00006577 E832000000                              call    wrstr_edx
  8855 0000657C A1[4C9B0000]                            mov     eax, [mp3_output_num_channels]
  8856 00006581 E865000000                              call    wr_decimal_eax
  8857 00006586 BA[35890000]                            mov     edx, txt_channels ; " channels, "
  8858 0000658B E81E000000                              call    wrstr_edx
  8859 00006590 A1[549B0000]                            mov     eax, [mp3_bytes_per_sample]
  8860 00006595 C1E003                                  shl     eax, 3
  8861 00006598 E84E000000                              call    wr_decimal_eax
  8862 0000659D BA[41890000]                            mov     edx, txt_bit ; " bit"
  8863 000065A2 E807000000                              call    wrstr_edx
  8864 000065A7 E813000000                              call    wrcrlf
  8865 000065AC F8                                      clc
  8866                                  .error:
  8867 000065AD C3                                      retn
  8868                                  
  8869                                  ;.error:
  8870                                                  ;stc
  8871                                                  ;retn
  8872                                  
  8873                                  
  8874                                  ; =============== S U B R O U T I N E =======================================
  8875                                  
  8876                                  ;wrchr:
  8877                                                  ;pusha
  8878                                                  ;mov     [wrchr_buf], al
  8879                                                  ;push    0            ; lpOverlapped
  8880                                                  ;push    diskresult   ; lpNumberOfBytesWritten
  8881                                                  ;push    1            ; nNumberOfBytesToWrite
  8882                                                  ;push    wrchr_buf    ; lpBuffer
  8883                                                  ;push    [std_out]    ; hFile
  8884                                                  ;call    [WriteFile]
  8885                                                  ;popa
  8886                                                  ;retn
  8887                                  
  8888                                  
  8889                                  ; =============== S U B R O U T I N E =======================================
  8890                                  
  8891                                  
  8892                                  wrstr_edx:
  8893 000065AE 50                                      push    eax
  8894                                  .lop:
  8895 000065AF 8A02                                    mov     al, [edx]
  8896 000065B1 42                                      inc     edx
  8897 000065B2 3C00                                    cmp     al, 0
  8898 000065B4 7407                                    jz      short .done
  8899 000065B6 E801040000                              call    wrchr
  8900 000065BB EBF2                                    jmp     short .lop
  8901                                  .done:
  8902 000065BD 58                                      pop     eax
  8903 000065BE C3                                      retn
  8904                                  
  8905                                  ; =============== S U B R O U T I N E =======================================
  8906                                  
  8907                                  
  8908                                  wrcrlf:
  8909 000065BF 50                                      push    eax
  8910 000065C0 B00D                                    mov     al, 0Dh
  8911 000065C2 E8F5030000                              call    wrchr
  8912 000065C7 B00A                                    mov     al, 0Ah
  8913 000065C9 E8EE030000                              call    wrchr
  8914 000065CE 58                                      pop     eax
  8915 000065CF C3                                      retn
  8916                                  
  8917                                  ; =============== S U B R O U T I N E =======================================
  8918                                  
  8919                                  
  8920                                  wrspc:
  8921 000065D0 50                                      push    eax
  8922 000065D1 B020                                    mov     al, 20h
  8923 000065D3 E8E4030000                              call    wrchr
  8924 000065D8 58                                      pop     eax
  8925 000065D9 C3                                      retn
  8926                                  
  8927                                  ; =============== S U B R O U T I N E =======================================
  8928                                  
  8929                                  
  8930                                  wrcomma:
  8931 000065DA 50                                      push    eax
  8932 000065DB B02C                                    mov     al, ','
  8933 000065DD E8DA030000                              call    wrchr
  8934 000065E2 58                                      pop     eax
  8935 000065E3 C3                                      retn
  8936                                  
  8937                                  ; =============== S U B R O U T I N E =======================================
  8938                                  
  8939                                  
  8940                                  wr_decimal_eax_with_thousands_seperator:
  8941 000065E4 51                                      push    ecx
  8942 000065E5 66B90200                                mov     cx, 2
  8943 000065E9 EB03                                    jmp     short wr_decimal_eax_inj
  8944                                  
  8945                                  ; =============== S U B R O U T I N E =======================================
  8946                                  
  8947                                  
  8948                                  wr_decimal_eax:
  8949 000065EB 51                                      push    ecx
  8950 000065EC 31C9                                    xor     ecx, ecx
  8951                                  
  8952                                  wr_decimal_eax_inj:
  8953 000065EE 50                                      push    eax
  8954 000065EF 53                                      push    ebx
  8955 000065F0 52                                      push    edx
  8956 000065F1 BB00CA9A3B                              mov     ebx, 1000000000 ; nine zeroes (32bit max 4.294.967.296)
  8957                                  
  8958                                  .dezlop:
  8959 000065F6 FEC9                                    dec     cl
  8960 000065F8 750C                                    jnz     short .no_thousands
  8961 000065FA B103                                    mov     cl, 3
  8962 000065FC 80FD00                                  cmp     ch, 0
  8963 000065FF 7405                                    jz      short .no_thousands
  8964 00006601 E8D4FFFFFF                              call    wrcomma
  8965                                  
  8966                                  .no_thousands:
  8967 00006606 31D2                                    xor     edx, edx
  8968 00006608 F7F3                                    div     ebx
  8969 0000660A 83FB01                                  cmp     ebx, 1
  8970 0000660D 7404                                    jz      short .force_last_zero
  8971 0000660F 08C5                                    or      ch, al
  8972 00006611 7407                                    jz      short .skip_lead_zero
  8973                                  
  8974                                  .force_last_zero:
  8975 00006613 0430                                    add     al, 30h
  8976 00006615 E8A2030000                              call    wrchr
  8977                                  
  8978                                  .skip_lead_zero:
  8979 0000661A 52                                      push    edx
  8980 0000661B 89D8                                    mov     eax, ebx
  8981 0000661D BB0A000000                              mov     ebx, 10
  8982 00006622 31D2                                    xor     edx, edx
  8983 00006624 F7F3                                    div     ebx
  8984 00006626 83F800                                  cmp     eax, 0
  8985 00006629 89C3                                    mov     ebx, eax
  8986 0000662B 58                                      pop     eax
  8987 0000662C 75C8                                    jnz     short .dezlop
  8988 0000662E 5A                                      pop     edx
  8989 0000662F 5B                                      pop     ebx
  8990 00006630 58                                      pop     eax
  8991 00006631 59                                      pop     ecx
  8992 00006632 C3                                      retn
  8993                                  
  8994                                  ; =============== S U B R O U T I N E =======================================
  8995                                  
  8996                                  
  8997                                  wrdigital:
  8998 00006633 50                                      push    eax
  8999 00006634 240F                                    and     al, 0Fh
  9000 00006636 3C09                                    cmp     al, 9
  9001 00006638 7602                                    jbe     short .this
  9002 0000663A 0407                                    add     al, 7
  9003                                  
  9004                                  .this:
  9005 0000663C 0430                                    add     al, 30h
  9006 0000663E E879030000                              call    wrchr
  9007 00006643 58                                      pop     eax
  9008 00006644 C3                                      retn
  9009                                  
  9010                                  ; =============== S U B R O U T I N E =======================================
  9011                                  
  9012                                  
  9013                                  wrhexal:
  9014 00006645 C0C804                                  ror     al, 4
  9015 00006648 E8E6FFFFFF                              call    wrdigital
  9016 0000664D C0C804                                  ror     al, 4
  9017 00006650 EBE1                                    jmp     short wrdigital
  9018                                  
  9019                                  ; =============== S U B R O U T I N E =======================================
  9020                                  
  9021                                  
  9022                                  wrhexax:
  9023 00006652 66C1C808                                ror     ax, 8
  9024 00006656 E8EAFFFFFF                              call    wrhexal
  9025 0000665B 66C1C808                                ror     ax, 8
  9026 0000665F EBE4                                    jmp     short wrhexal
  9027                                  
  9028                                  ; =============== S U B R O U T I N E =======================================
  9029                                  
  9030                                  
  9031                                  wrhexeax:
  9032 00006661 C1C810                                  ror     eax, 10h
  9033 00006664 E8E9FFFFFF                              call    wrhexax
  9034 00006669 C1C810                                  ror     eax, 10h
  9035 0000666C EBE4                                    jmp     short wrhexax
  9036                                  
  9037                                  ; =============== S U B R O U T I N E =======================================
  9038                                  
  9039                                  %if 0
  9040                                  
  9041                                  get_commandline:
  9042                                                  call    [GetCommandLineA]
  9043                                                  mov     esi, eax
  9044                                                  mov     edi, cmdline_buf
  9045                                                  mov     ecx, 1024       ; cmdline_max
  9046                                  
  9047                                  .get_cmdline_lop:
  9048                                                  lodsb
  9049                                                  cmp     al, 0
  9050                                                  stosb
  9051                                                  loopne  .get_cmdline_lop
  9052                                                  mov     byte [edi-1], 0
  9053                                                  mov     esi, cmdline_buf
  9054                                                  mov     edi, cmdline_buf
  9055                                                  call    _@@get_item     ; get/skip name of the executable itself
  9056                                  
  9057                                  .get_items_lop:
  9058                                                  call    _@@get_item
  9059                                                  mov     al, [ebx]
  9060                                                  cmp     al, 0
  9061                                                  jz      .done
  9062                                                  cmp     al, '/'
  9063                                                  jz      short .switch
  9064                                                  cmp     al, '-'
  9065                                                  jz      short .switch
  9066                                                  mov     eax, [edi-5]
  9067                                                  or      eax, 20202000h
  9068                                                  ;cmp    eax, 'vaw.'     ; ".wav"
  9069                                                  cmp     eax, '.wav'     ; FASM & NASM syntax
  9070                                                  jnz     short .not_wav_name
  9071                                                  mov     [mp3_dst_fname], ebx
  9072                                                  jmp     short .get_items_lop
  9073                                  
  9074                                  .not_wav_name:
  9075                                                  mov     eax, [edi-5]
  9076                                                  or      eax, 20202000h
  9077                                                  ;cmp    eax, 'mcp.'     ; ".pcm"
  9078                                                  cmp     eax, '.pcm'     ; FASM & NASM syntax
  9079                                                  jnz     short .not_pcm_name
  9080                                                  mov     [mp3_pcm_fname], ebx
  9081                                                  jmp     short .get_items_lop
  9082                                  
  9083                                  .not_pcm_name:
  9084                                                  mov     [mp3_src_fname], ebx
  9085                                                  jmp     short .get_items_lop
  9086                                  
  9087                                  .switch:
  9088                                                  ;cmp	dword [ebx+1], 'onom' ; "mono"
  9089                                                  cmp	dword [ebx+1], 'mono'
  9090                                                  jnz     short .not_switch_mono
  9091                                                  mov	byte [option_mono], 1
  9092                                                  jmp	short .get_items_lop
  9093                                  
  9094                                  .not_switch_mono:
  9095                                                  ;cmp	dword [ebx+1], 'tsaf' ; "fast"
  9096                                                  cmp	dword [ebx+1], 'fast' ; FASM & NASM syntax
  9097                                                  jnz	short .not_fast_option
  9098                                                  mov	byte [option_fast], 1
  9099                                                  jmp	short .get_items_lop
  9100                                  
  9101                                  .not_fast_option:
  9102                                                  ;cmp    dword [ebx+1], 'tib8' ; "8bit"
  9103                                                  cmp     dword [ebx+1], '8bit'
  9104                                                  jnz     short .not_switch_8bit
  9105                                                  mov     [option_8bit], 1
  9106                                                  jmp     .get_items_lop
  9107                                  
  9108                                  .not_switch_8bit:
  9109                                                  ;cmp    dword [ebx+1], 'flah' ; "half"
  9110                                                  cmp     dword [ebx+1], 'half'
  9111                                                  jnz     short .not_switch_half
  9112                                                  mov     [option_rate_shift], 1
  9113                                                  jmp     .get_items_lop
  9114                                  
  9115                                  .not_switch_half:
  9116                                                  ;cmp    dword [ebx+1], 'rauq' ; "quar"
  9117                                                  cmp     dword [ebx+1], 'quar'
  9118                                                  jnz     short .not_switch_quarter
  9119                                                  mov     [option_rate_shift], 2
  9120                                                  jmp     .get_items_lop
  9121                                  
  9122                                  .not_switch_quarter:
  9123                                                  ;cmp    dword [ebx+1], 'tset' ; "test"
  9124                                                  cmp     dword [ebx+1], 'test'
  9125                                                  jnz     short .not_switch_test
  9126                                                  mov     byte [option_test], 1
  9127                                                  jmp     .get_items_lop
  9128                                  
  9129                                  .not_switch_test:
  9130                                                  jmp     short .help
  9131                                  
  9132                                  .done:
  9133                                                  cmp	dword [mp3_src_fname], 0
  9134                                                  jz      short .help
  9135                                                  ;;; Erdogan Tan - 17/10/2024
  9136                                                  mov     edx, txt_ctrlc
  9137                                                  call    wrstr_edx
  9138                                                  ;;;
  9139                                                  mov     edx, txt_file ; "file: "
  9140                                                  call    wrstr_edx
  9141                                                  mov     edx, [mp3_src_fname]
  9142                                                  call    wrstr_edx
  9143                                                  call    wrcrlf
  9144                                                  clc
  9145                                                  retn
  9146                                  
  9147                                  .help:
  9148                                                  ;;; Erdogan Tan - 17/10/2024
  9149                                                  mov     edx, txt_about
  9150                                                  call    wrstr_edx
  9151                                                  ;;;
  9152                                                  mov     edx, txt_help ; "usage: mp3play input.mp3 [output.wav] ["...
  9153                                                  call    wrstr_edx
  9154                                                  stc
  9155                                                  retn
  9156                                  
  9157                                  %endif
  9158                                  
  9159                                  ; =============== S U B R O U T I N E =======================================
  9160                                  
  9161                                  %if 0
  9162                                  
  9163                                  _@@get_item:
  9164                                                  lodsb
  9165                                                  dec     al
  9166                                                  cmp     al, 1Fh         ; 20-1
  9167                                                  jbe     short _@@get_item ; _@@skip_spc_lop
  9168                                                  dec     esi
  9169                                                  mov     ebx, edi
  9170                                                  mov     ah, 0           ; flag initially not quoted
  9171                                  
  9172                                  .char_lop:
  9173                                                  lodsb
  9174                                                  cmp     al, '"'
  9175                                                  jnz     short .no_quote
  9176                                                  xor     ah, 1
  9177                                                  jmp     short .char_lop
  9178                                  
  9179                                  .no_quote:
  9180                                                  stosb
  9181                                                  cmp     al, 0
  9182                                                  jz      short .src_end
  9183                                                  cmp     al, 20h
  9184                                                  ja      short .char_lop
  9185                                                  cmp     ah, 0           ; ignore spaces if inside "quoted area"
  9186                                                  jnz     short .char_lop
  9187                                                  mov     byte [edi-1], 0 ; eol (replace space by 00h)
  9188                                                  retn
  9189                                  
  9190                                  .src_end:
  9191                                                  dec     esi
  9192                                                  retn
  9193                                  
  9194                                  %endif
  9195                                  
  9196                                  ; =============== S U B R O U T I N E =======================================
  9197                                  
  9198                                  
  9199                                  %if 0
  9200                                  
  9201                                  open_and_mmap_the_file:
  9202                                                  push    0               ; hTemplateFile
  9203                                                  push    0               ; dwFlagsAndAttributes
  9204                                                  push    3               ; dwCreationDisposition
  9205                                                  push    0               ; lpSecurityAttributes
  9206                                                  push    1               ; dwShareMode
  9207                                                  push    80000000h       ; dwDesiredAccess
  9208                                                  push    [mp3_src_fname] ; lpFileName
  9209                                                  call    [CreateFileA]
  9210                                                  mov     [hFile], eax
  9211                                                  cmp     eax, 0FFFFFFFFh ; INVALID_HANDLE_VALUE
  9212                                                  jz      short .not_found
  9213                                                  push    0               ; lpFileSizeHigh
  9214                                                  push    [hFile]      ; hFile
  9215                                                  call    [GetFileSize]
  9216                                                  mov     [mp3_file_size], eax
  9217                                                  mov     [bytes_left], eax
  9218                                                  push    0               ; lpName
  9219                                                  push    0               ; dwMaximumSizeLow
  9220                                                  push    0               ; dwMaximumSizeHigh
  9221                                                  push    2               ; flProtect
  9222                                                  push    0               ; lpFileMappingAttributes
  9223                                                  push    [hFile]      ; hFile
  9224                                                  call    [CreateFileMappingA]
  9225                                                  mov     [hMap], eax
  9226                                                  push    0               ; dwNumberOfBytesToMap
  9227                                                  push    0               ; dwFileOffsetLow
  9228                                                  push    0               ; dwFileOffsetHigh
  9229                                                  push    4               ; dwDesiredAccess
  9230                                                  push    [hMap]       ; hFileMappingObject
  9231                                                  call    [MapViewOfFile]
  9232                                                  mov     [stream_start], eax
  9233                                                  mov     [stream_pos], eax
  9234                                                  mov     esi, [stream_start]
  9235                                                  mov     ecx, [bytes_left]
  9236                                  
  9237                                  .lll:
  9238                                                  lodsb
  9239                                                  loop    .lll
  9240                                                  clc
  9241                                                  retn
  9242                                  
  9243                                  .not_found:
  9244                                                  mov     edx, txt_not_found ; "cannot open source file\r\n"
  9245                                                  call    wrstr_edx
  9246                                                  stc
  9247                                                  retn
  9248                                  
  9249                                  %endif
  9250                                  
  9251                                  
  9252                                  ; =============== S U B R O U T I N E =======================================
  9253                                  
  9254                                  
  9255                                  mp3_plain_test_without_output:
  9256 0000666E 60                                      pusha
  9257 0000666F 8B35[802A0500]                          mov     esi, [stream_pos]
  9258 00006675 8B0D[842A0500]                          mov     ecx, [bytes_left]
  9259 0000667B BF[00300500]                            mov     edi, sample_buffer
  9260 00006680 31ED                                    xor     ebp, ebp
  9261 00006682 E89DFBFFFF                              call    mp3_decode_frame
  9262 00006687 61                                      popa
  9263 00006688 7218                                    jc      short .exit
  9264 0000668A A1[249B0000]                            mov     eax, [mp3_src_frame_size]
  9265 0000668F 83F800                                  cmp     eax, 0
  9266 00006692 740E                                    jz      short .exit
  9267 00006694 0105[802A0500]                          add     [stream_pos], eax
  9268 0000669A 2905[842A0500]                          sub     [bytes_left], eax
  9269 000066A0 EBCC                                    jmp     short mp3_plain_test_without_output
  9270                                  
  9271                                  .exit:
  9272 000066A2 C3                                      retn
  9273                                  
  9274                                  
  9275                                  ; =============== S U B R O U T I N E =======================================
  9276                                  
  9277                                  		; 20/10/2024
  9278                                  mp3_cast_to_wav_file:
  9279 000066A3 E86F000000                              call	mp3_create_wav_file
  9280                                  		; 20/10/2024
  9281 000066A8 730A                    		jnc	short .lop
  9282 000066AA BBFFFFFFFF              		mov	ebx, -1
  9283 000066AF E91B050000              		jmp	ExitProcess
  9284                                  .lop:
  9285 000066B4 60                                      pusha
  9286 000066B5 8B35[802A0500]                          mov	esi, [stream_pos]
  9287 000066BB 8B0D[842A0500]                          mov	ecx, [bytes_left]
  9288 000066C1 BF[00300500]                            mov	edi, sample_buffer
  9289 000066C6 31ED                                    xor	ebp, ebp
  9290 000066C8 E857FBFFFF                              call	mp3_decode_frame
  9291 000066CD 61                                      popa
  9292 000066CE 7241                                    jc	short .exit
  9293 000066D0 A1[249B0000]                            mov	eax, [mp3_src_frame_size]
  9294 000066D5 83F800                                  cmp	eax, 0
  9295 000066D8 7437                                    jz	short .exit
  9296 000066DA 0105[802A0500]                          add	[stream_pos], eax
  9297 000066E0 2905[842A0500]                          sub	[bytes_left], eax
  9298                                                  ;push	0          ; lpOverlapped
  9299                                                  ;push	diskresult ; lpNumberOfBytesWritten
  9300 000066E6 FF35[14F20000]                          push	dword [mp3_samples_output_size] ; nNumberOfBytesToWrite
  9301 000066EC 68[00300500]                            push	sample_buffer ; lpBuffer
  9302 000066F1 FF35[082B0500]                          push	dword [mp3_wav_handle] ; hFile
  9303                                                  ;call	[WriteFile]
  9304                                  		;;;
  9305                                  		; 20/10/2024
  9306 000066F7 E8DC040000              		call	WriteFile
  9307 000066FC 7213                    		jc	short .exit
  9308                                  		;;;
  9309 000066FE A1[14F20000]                            mov	eax, [mp3_samples_output_size]
  9310 00006703 0105[90820000]                          add	dword [mp3_wav_header+4], eax
  9311 00006709 0105[B4820000]                          add	dword [mp3_wav_header+28h], eax
  9312 0000670F EBA3                                    jmp	short .lop
  9313                                  
  9314                                  .exit:
  9315 00006711 E860000000                              call	mp3_close_wav_file
  9316 00006716 C3                                      retn
  9317                                  
  9318                                  
  9319                                  ; =============== S U B R O U T I N E =======================================
  9320                                  
  9321                                  		; 20/10/2024
  9322                                  
  9323                                  mp3_create_wav_file:
  9324 00006717 A1[509B0000]                            mov     eax, [mp3_output_sample_rate]
  9325 0000671C 8B0D[4C9B0000]                          mov     ecx, [mp3_output_num_channels]
  9326 00006722 8B15[549B0000]                          mov     edx, [mp3_bytes_per_sample]
  9327 00006728 66890D[A2820000]                        mov     word [mp3_wav_header+16h], cx
  9328 0000672F A3[A4820000]                            mov     dword [mp3_wav_header+18h], eax
  9329 00006734 0FAFCA                                  imul    ecx, edx
  9330 00006737 0FAFC1                                  imul    eax, ecx
  9331 0000673A C1E203                                  shl     edx, 3
  9332 0000673D A3[A8820000]                            mov     dword [mp3_wav_header+1Ch], eax
  9333 00006742 66890D[AC820000]                        mov     word [mp3_wav_header+20h], cx
  9334 00006749 668915[AE820000]                        mov     word [mp3_wav_header+22h], dx
  9335                                                  ;push   0               ; hTemplateFile
  9336                                                  ;push   80h             ; dwFlagsAndAttributes
  9337                                                  ;push   2               ; dwCreationDisposition
  9338                                                  ;push   0               ; lpSecurityAttributes
  9339                                                  ;push   0               ; dwShareMode
  9340                                                  ;push   0C0000000h      ; dwDesiredAccess
  9341 00006750 FF35[84820000]                          push    dword [mp3_dst_fname] ; lpFileName
  9342                                                  ;call   [CreateFileA]
  9343                                  		;;;
  9344                                  		; 20/10/2024
  9345 00006756 E8AF040000              		call	CreateFile
  9346 0000675B 7301                    		jnc	short .ok
  9347 0000675D C3                      		retn
  9348                                  .ok:
  9349                                  		;;;
  9350 0000675E A3[082B0500]                            mov     [mp3_wav_handle], eax
  9351                                                  ; 20/10/2024
  9352                                  		;call   mp3_write_wav_header
  9353                                                  ;retn
  9354                                  
  9355                                  
  9356                                  ; =============== S U B R O U T I N E =======================================
  9357                                  
  9358                                  		; 20/10/2024
  9359                                  mp3_write_wav_header:
  9360                                                  ;push	0               ; lpOverlapped
  9361                                                  ;push	diskresult      ; lpNumberOfBytesWritten
  9362 00006763 6A2C                                    push	44 ; 2Ch        ; nNumberOfBytesToWrite
  9363 00006765 68[8C820000]                            push	mp3_wav_header  ; lpBuffer
  9364 0000676A FF35[082B0500]                          push	dword [mp3_wav_handle] ; hFile
  9365                                                  ;call	[WriteFile]
  9366                                                  ;;;
  9367                                  		; 20/10/2024
  9368 00006770 E863040000                              call	WriteFile
  9369                                                  ;;;
  9370 00006775 C3                      		retn
  9371                                  
  9372                                  
  9373                                  ; =============== S U B R O U T I N E =======================================
  9374                                  
  9375                                  		; 20/10/2024
  9376                                  mp3_close_wav_file:
  9377 00006776 6A00                                    push	0               ; dwMoveMethod
  9378                                                  ;push	0               ; lpDistanceToMoveHigh
  9379 00006778 6A00                                    push	0               ; lDistanceToMove
  9380 0000677A FF35[082B0500]                          push	dword [mp3_wav_handle] ; hFile
  9381                                                  ;call	[SetFilePointer]
  9382                                  		;;;
  9383                                  		; 20/10/2024
  9384 00006780 E8C1040000              		call	SetFilePointer
  9385                                  		;;;
  9386 00006785 E8D9FFFFFF                              call	mp3_write_wav_header
  9387 0000678A FF35[082B0500]                          push	dword [mp3_wav_handle] ; hObject
  9388                                                  ;call	[CloseHandle]
  9389                                  		;;;
  9390                                  		; 20/10/2024
  9391 00006790 E8EF040000              		call	CloseFile
  9392                                  		;;;
  9393 00006795 C3                                      retn
  9394                                  
  9395                                  
  9396                                  ; =============== S U B R O U T I N E =======================================
  9397                                  
  9398                                  		; 20/10/2024
  9399                                  mp3_verify_pcm_file:
  9400 00006796 E804020000                              call    mp3_open_pcm_file
  9401                                  		;;;
  9402                                  		; 20/10/2024
  9403 0000679B 7301                    		jnc	short .verify
  9404 0000679D C3                      		retn	; nothing to do (return without error msg)
  9405                                  .verify:
  9406                                  		;;;
  9407 0000679E C705[102B0500]0000-                     mov	dword [_@@max_diff], 0
  9407 000067A6 0000               
  9408 000067A8 C705[142B0500]0000-                     mov	dword [_@@avg_diff], 0
  9408 000067B0 0000               
  9409 000067B2 C705[182B0500]0000-                     mov	dword [_@@avg_diff+4], 0
  9409 000067BA 0000               
  9410 000067BC C705[1C2B0500]0000-                     mov	dword [pcm_filepos], 0
  9410 000067C4 0000               
  9411                                  
  9412                                  .lop:
  9413 000067C6 60                                      pusha
  9414 000067C7 8B35[802A0500]                          mov     esi, [stream_pos]
  9415 000067CD 8B0D[842A0500]                          mov     ecx, [bytes_left]
  9416 000067D3 BF[00300500]                            mov     edi, sample_buffer
  9417 000067D8 31ED                                    xor     ebp, ebp
  9418 000067DA E845FAFFFF                              call    mp3_decode_frame
  9419 000067DF 61                                      popa
  9420 000067E0 0F824D010000                            jb      .exit
  9421 000067E6 A1[249B0000]                            mov     eax, [mp3_src_frame_size]
  9422 000067EB 83F800                                  cmp     eax, 0
  9423 000067EE 0F843F010000                            jz      .exit
  9424 000067F4 31C0                                    xor     eax, eax
  9425 000067F6 833D[4C9B0000]02                        cmp     dword [mp3_output_num_channels], 2
  9426 000067FD 7207                                    jb      short .this_mono_convert
  9427 000067FF 0FB605[D7730000]                        movzx   eax, byte [option_mono]
  9428                                  
  9429                                  .this_mono_convert:
  9430 00006806 A3[202B0500]                            mov	[_@@mono_convert], eax
  9431 0000680B 8A0D[D9730000]                          mov	cl, [option_rate_shift]
  9432 00006811 B802000000                              mov	eax, 2
  9433 00006816 D3E0                                    shl	eax, cl
  9434 00006818 66A3[242B0500]                          mov	[_@@pcm_steps], ax
  9435 0000681E 66A3[262B0500]                          mov	[_@@pcm_steps+2], ax
  9436 00006824 833D[4C9B0000]02                        cmp	dword [mp3_output_num_channels], 2
  9437 0000682B 7213                                    jb	short .these_steps
  9438 0000682D 66C705[242B0500]02-                     mov	word [_@@pcm_steps], 2
  9438 00006835 00                 
  9439 00006836 8D4400FE                                lea     eax, [eax*2-2] ; [0FFFFFFFEh+eax*2]
  9440 0000683A 66A3[262B0500]                          mov     [_@@pcm_steps+2], ax
  9441                                  
  9442                                  .these_steps:
  9443 00006840 A1[14F20000]                            mov     eax, [mp3_samples_output_size]
  9444 00006845 8A0D[D9730000]                          mov     cl, [option_rate_shift]
  9445 0000684B 020D[D8730000]                          add     cl, [option_8bit]
  9446 00006851 020D[202B0500]                          add     cl, byte [_@@mono_convert]
  9447 00006857 D3E0                                    shl     eax, cl
  9448                                                  ;push   0               ; lpOverlapped
  9449                                                  ;push   diskresult      ; lpNumberOfBytesRead
  9450 00006859 50                                      push    eax             ; nNumberOfBytesToRead
  9451 0000685A 68[00420500]                            push    (sample_buffer+1200h) ; sample_buffer+MP3_MAX_OUTPUT_SIZE
  9452 0000685F FF35[0C2B0500]                          push    dword [mp3_pcm_handle] ; hFile
  9453                                                  ;call   [ReadFile]
  9454                                                  ;;;
  9455                                  		; 20/10/2024
  9456 00006865 E8E9030000              		call	ReadFile
  9457 0000686A 7306                    		jnc	short .pcm_read_ok
  9458                                  		; Note: File read error msg has been displayed
  9459 0000686C E83F010000              		call	mp3_close_pcm_file
  9460 00006871 C3                      		retn
  9461                                  .pcm_read_ok:
  9462                                  		;;;
  9463 00006872 8B0D[14F20000]          		mov     ecx, [mp3_samples_output_size]
  9464 00006878 D1E9                                    shr     ecx, 1
  9465 0000687A 0F849D000000                            jz      .compare_done
  9466 00006880 BE[00300500]                            mov     esi, sample_buffer ; decoded .mp3
  9467 00006885 BF[00420500]                            mov     edi, (sample_buffer+1200h) ; loaded .pcm
  9468                                  
  9469                                  .compare_lop:
  9470 0000688A 0FBF17                                  movsx   edx, word [edi]
  9471 0000688D 833D[202B0500]00                        cmp     dword [_@@mono_convert], 0
  9472 00006894 7408                                    jz      short .no_mono_convert
  9473 00006896 0FBF4702                                movsx   eax, word [edi+2]
  9474 0000689A 01C2                                    add     edx, eax
  9475 0000689C D1FA                                    sar     edx, 1
  9476                                  
  9477                                  .no_mono_convert:
  9478 0000689E 803D[D8730000]00                        cmp	byte [option_8bit], 0
  9479 000068A5 7508                                    jnz	short .compare_8bit
  9480 000068A7 0FBF06                                  movsx	eax, word [esi] ; get 16bit from decoded .mp3
  9481 000068AA 83C602                                  add	esi, 2
  9482 000068AD EB13                                    jmp	short .compare_this
  9483                                  
  9484                                  .compare_8bit:
  9485 000068AF 0FB606                                  movzx   eax, byte [esi]
  9486 000068B2 46                                      inc     esi             ; convert .pcm
  9487 000068B3 81C200800000                            add     edx, 8000h      ; make unsigned
  9488 000068B9 C1FA08                                  sar     edx, 8          ; div 100h
  9489 000068BC 80D200                                  adc     dl, 0           ; round up
  9490 000068BF 80DA00                                  sbb     dl, 0           ; undo on unsigned overflow
  9491                                  
  9492                                  .compare_this:
  9493 000068C2 29D0                                    sub     eax, edx
  9494 000068C4 7902                                    jns     short .compare_abs ; calc difference
  9495 000068C6 F7D8                                    neg     eax
  9496                                  
  9497                                  .compare_abs:
  9498 000068C8 0105[142B0500]                          add     [_@@avg_diff], eax
  9499 000068CE 8315[182B0500]00                        adc     dword [_@@avg_diff+4], 0
  9500 000068D5 3B05[102B0500]                          cmp     eax, [_@@max_diff]
  9501 000068DB 7223                                    jb      short .not_max
  9502 000068DD A3[102B0500]                            mov     [_@@max_diff], eax
  9503 000068E2 8B15[1C2B0500]                          mov     edx, [pcm_filepos]
  9504 000068E8 8915[282B0500]                          mov     [_@@worst_pcm_filepos], edx
  9505 000068EE 8B15[802A0500]                          mov     edx, [stream_pos]
  9506 000068F4 2B15[7C2A0500]                          sub     edx, [stream_start]
  9507 000068FA 8915[2C2B0500]                          mov     [_@@worst_mp3_filepos], edx
  9508                                  
  9509                                  .not_max:
  9510 00006900 0FB705[242B0500]                        movzx   eax, word [_@@pcm_steps]
  9511 00006907 C10D[242B0500]10                        ror     dword [_@@pcm_steps], 16 ; next .pcm addr
  9512 0000690E 01C7                                    add     edi, eax
  9513 00006910 0105[1C2B0500]                          add     [pcm_filepos], eax
  9514 00006916 49                                      dec     ecx
  9515 00006917 0F856DFFFFFF                            jnz    .compare_lop
  9516                                  
  9517                                  .compare_done:
  9518 0000691D A1[249B0000]                            mov     eax, [mp3_src_frame_size]
  9519 00006922 0105[802A0500]                          add     [stream_pos], eax
  9520 00006928 2905[842A0500]                          sub     [bytes_left], eax
  9521 0000692E E993FEFFFF                              jmp     .lop
  9522                                  
  9523                                  .exit:
  9524 00006933 E878000000                              call    mp3_close_pcm_file
  9525 00006938 BA[E8890000]                            mov     edx, _@@txt_verify1 ; "verify max difference = "
  9526 0000693D E86CFCFFFF                              call    wrstr_edx
  9527 00006942 A1[102B0500]                            mov     eax, [_@@max_diff]
  9528 00006947 E89FFCFFFF                              call    wr_decimal_eax
  9529 0000694C BA[018A0000]                            mov     edx, _@@txt_verify1_at_mp3 ; " at mp3:"
  9530 00006951 E858FCFFFF                              call    wrstr_edx
  9531 00006956 A1[2C2B0500]                            mov     eax, [_@@worst_mp3_filepos]
  9532 0000695B E801FDFFFF                              call    wrhexeax
  9533 00006960 BA[0A8A0000]                            mov     edx, _@@txt_verify2 ; ", average difference = "
  9534 00006965 E844FCFFFF                              call    wrstr_edx
  9535 0000696A A1[142B0500]                            mov     eax, [_@@avg_diff]
  9536 0000696F 8B15[182B0500]                          mov     edx, [_@@avg_diff+4]
  9537 00006975 8B0D[0CF20000]                          mov     ecx, [mp3_total_output_size]
  9538 0000697B D1E9                                    shr     ecx, 1
  9539 0000697D F7F1                                    div     ecx
  9540 0000697F E867FCFFFF                              call    wr_decimal_eax
  9541 00006984 B02E                                    mov     al, '.'
  9542 00006986 E831000000                              call    wrchr
  9543 0000698B B80A000000                              mov     eax, 10
  9544 00006990 F7E2                                    mul     edx             ; fraction*10
  9545 00006992 F7F1                                    div     ecx
  9546 00006994 E89AFCFFFF                              call    wrdigital       ; show fraction of average difference
  9547 00006999 E821FCFFFF                              call    wrcrlf
  9548 0000699E C3                                      retn
  9549                                  
  9550                                  
  9551                                  ; =============== S U B R O U T I N E =======================================
  9552                                  
  9553                                  		; 20/10/2024
  9554                                  mp3_open_pcm_file:
  9555                                                  ;push	0               ; hTemplateFile
  9556                                                  ;push	80h             ; dwFlagsAndAttributes
  9557                                                  ;push	3               ; dwCreationDisposition
  9558                                                  ;push	0               ; lpSecurityAttributes
  9559                                                  ;push	0               ; dwShareMode
  9560                                                  ;push	80000000h       ; dwDesiredAccess
  9561 0000699F FF35[88820000]                          push	dword [mp3_pcm_fname] ; lpFileName
  9562                                                  ;call	[CreateFileA]
  9563                                  		;;;
  9564                                  		; 20/10/2024
  9565 000069A5 E88F020000              		call	OpenFile
  9566                                  		;jc	short .return
  9567                                  		;;;
  9568 000069AA A3[0C2B0500]                            mov	[mp3_pcm_handle], eax
  9569                                  ;.return:
  9570 000069AF C3                                      retn
  9571                                  
  9572                                  
  9573                                  ; =============== S U B R O U T I N E =======================================
  9574                                  
  9575                                  		; 20/10/2024
  9576                                  mp3_close_pcm_file:
  9577 000069B0 FF35[0C2B0500]                          push	dword [mp3_pcm_handle] ; hObject
  9578                                                  ;call	[CloseHandle]
  9579                                                  ;retn
  9580                                  		;;;
  9581                                  		; 20/10/2024
  9582 000069B6 E8C9020000              		call	CloseFile
  9583                                  		;;;
  9584 000069BB C3                      		retn
  9585                                  
  9586                                  
  9587                                  ; ---------------------------------------------------------------------------
  9588                                  
  9589                                  ; =============== S U B R O U T I N E =======================================
  9590                                  
  9591                                  		; 20/10/2024
  9592                                  wrchr:
  9593                                  		; TRDOS 386 System Call
  9594                                  		; ebx = 2 -> write character onto STDOUT
  9595                                  		;push	ebx
  9596                                  		;push	ecx
  9597                                  		;push	eax
  9598 000069BC 60                      		pusha
  9599                                  		;;mov	dword [diskresult], 0
  9600                                  		sys	_stdio, 2, eax
   116                              <1> 
   117                              <1> 
   118                              <1> 
   119                              <1> 
   120                              <1>  %if %0 >= 2
   121 000069BD BB02000000          <1>  mov ebx, %2
   122                              <1>  %if %0 >= 3
   123 000069C2 89C1                <1>  mov ecx, %3
   124                              <1>  %if %0 = 4
   125                              <1>  mov edx, %4
   126                              <1>  %endif
   127                              <1>  %endif
   128                              <1>  %endif
   129 000069C4 B82E000000          <1>  mov eax, %1
   130                              <1> 
   131 000069C9 CD40                <1>  int 40h
  9601                                  		;jnc	short .ok ; if EOF, eax = 0
  9602                                  		;xor	eax, eax ; 0
  9603                                  ;.ok:
  9604                                  		;mov	[diskresult], eax ; written byte count
  9605 000069CB 61                      		popa
  9606                                  		;pop	eax
  9607                                  		;pop	ecx
  9608                                  		;pop	ebx
  9609 000069CC C3                      		retn
  9610                                  
  9611                                  
  9612                                  ; =============== S U B R O U T I N E =======================================
  9613                                  
  9614                                  		; 20/10/2024
  9615                                  get_commandline:
  9616                                  		; 21/10/2024
  9617 000069CD 5D                      		pop	ebp ; near call return address
  9618                                                 	; esp = command line start address
  9619                                  		;mov	[command_line],esp
  9620 000069CE 59                      		pop	ecx	; argc  ; number of arguments
  9621                                  		; esp = pointer to argument 1 ; argv[0]
  9622 000069CF 49                      		dec	ecx
  9623 000069D0 0F8405010000            		jz	.help
  9624 000069D6 58                      		pop	eax ; argument 1 (PRG file name)
  9625 000069D7 5E                      		pop	esi ; argument 2 (must be input file name)
  9626 000069D8 BF[882A0500]            		mov     edi, cmdline_buf
  9627                                  .get_item:
  9628 000069DD 89FB                    		mov	ebx, edi
  9629                                  .char_lop:
  9630 000069DF AC                                      lodsb
  9631 000069E0 AA                      		stosb
  9632 000069E1 3C00                                    cmp     al, 0
  9633 000069E3 75FA                                    jnz 	short .char_lop
  9634                                  		
  9635 000069E5 8A03                                    mov     al, [ebx]
  9636 000069E7 3C2F                                    cmp     al, '/'
  9637 000069E9 7442                                    jz      short .switch
  9638 000069EB 3C2D                                    cmp     al, '-'
  9639 000069ED 743E                                    jz      short .switch
  9640 000069EF 8B47FB                                  mov     eax, [edi-5]
  9641 000069F2 0D00202020                              or      eax, 20202000h
  9642 000069F7 3D2E776176                              cmp     eax, '.wav'     ; FASM & NASM syntax
  9643 000069FC 7510                                    jnz     short .not_wav_name
  9644 000069FE 891D[84820000]                          mov     [mp3_dst_fname], ebx
  9645                                  .get_items_lop:
  9646 00006A04 49                      		dec	ecx
  9647 00006A05 0F8494000000            		jz	.done
  9648 00006A0B 5E                      		pop	esi   ; next argument
  9649 00006A0C EBCF                    		jmp     short .get_item
  9650                                  
  9651                                  .not_wav_name:
  9652 00006A0E 8B47FB                                  mov     eax, [edi-5]
  9653 00006A11 0D00202020                              or      eax, 20202000h
  9654 00006A16 3D2E70636D                              cmp     eax, '.pcm'     ; FASM & NASM syntax
  9655 00006A1B 7508                                    jnz     short .not_pcm_name
  9656 00006A1D 891D[88820000]                          mov     [mp3_pcm_fname], ebx
  9657 00006A23 EBDF                                    jmp     short .get_items_lop
  9658                                  
  9659                                  .not_pcm_name:
  9660 00006A25 891D[80820000]                          mov     [mp3_src_fname], ebx
  9661 00006A2B EBD7                                    jmp     short .get_items_lop
  9662                                  
  9663                                  .switch:
  9664 00006A2D 817B016D6F6E6F                          cmp	dword [ebx+1], 'mono'
  9665 00006A34 7509                                    jnz	short .not_switch_mono
  9666 00006A36 C605[D7730000]01                        mov	byte [option_mono], 1
  9667 00006A3D EBC5                                    jmp	short .get_items_lop
  9668                                  
  9669                                  .not_switch_mono:
  9670 00006A3F 817B0166617374                          cmp	dword [ebx+1], 'fast' ; FASM & NASM syntax
  9671 00006A46 7509                                    jnz	short .not_fast_option
  9672 00006A48 C605[DA730000]01                        mov	byte [option_fast], 1
  9673 00006A4F EBB3                                    jmp	short .get_items_lop
  9674                                  
  9675                                  .not_fast_option:
  9676 00006A51 817B0138626974                          cmp	dword [ebx+1], '8bit'
  9677 00006A58 7509                                    jnz	short .not_switch_8bit
  9678 00006A5A C605[D8730000]01                        mov	byte [option_8bit], 1
  9679 00006A61 EBA1                                    jmp	short .get_items_lop
  9680                                  
  9681                                  .not_switch_8bit:
  9682 00006A63 817B0168616C66                          cmp	dword [ebx+1], 'half'
  9683 00006A6A 7509                                    jnz	short .not_switch_half
  9684 00006A6C C605[D9730000]01                        mov	byte [option_rate_shift], 1
  9685 00006A73 EB8F                                    jmp	short .get_items_lop
  9686                                  
  9687                                  .not_switch_half:
  9688 00006A75 817B0171756172                          cmp	dword [ebx+1], 'quar'
  9689 00006A7C 750C                                    jnz	short .not_switch_quarter
  9690 00006A7E C605[D9730000]02                        mov	byte [option_rate_shift], 2
  9691 00006A85 E97AFFFFFF                              jmp	.get_items_lop
  9692                                  
  9693                                  .not_switch_quarter:
  9694 00006A8A 817B0174657374                          cmp	dword [ebx+1], 'test'
  9695 00006A91 7548                                    jnz	short .not_switch_test
  9696 00006A93 C605[D6730000]01                        mov	byte [option_test], 1
  9697 00006A9A E965FFFFFF                              jmp	.get_items_lop
  9698                                  
  9699                                  .done:
  9700 00006A9F 833D[80820000]00                        cmp	dword [mp3_src_fname], 0
  9701 00006AA6 7433                                    jz	short .help
  9702                                                  ;;; Erdogan Tan - 17/10/2024
  9703                                                  ;mov	edx, txt_ctrlc
  9704                                                  ;call	wrstr_edx
  9705                                  		; 20/10/2024
  9706                                  		sys	_msg, txt_ctrlc, txt_ctrlc_size, 0Fh ; white
   116                              <1> 
   117                              <1> 
   118                              <1> 
   119                              <1> 
   120                              <1>  %if %0 >= 2
   121 00006AA8 BB[228A0000]        <1>  mov ebx, %2
   122                              <1>  %if %0 >= 3
   123 00006AAD B919000000          <1>  mov ecx, %3
   124                              <1>  %if %0 = 4
   125 00006AB2 BA0F000000          <1>  mov edx, %4
   126                              <1>  %endif
   127                              <1>  %endif
   128                              <1>  %endif
   129 00006AB7 B823000000          <1>  mov eax, %1
   130                              <1> 
   131 00006ABC CD40                <1>  int 40h
  9707                                                  ;;;
  9708 00006ABE BA[F1880000]                            mov	edx, txt_file ; "file: "
  9709 00006AC3 E8E6FAFFFF                              call	wrstr_edx
  9710 00006AC8 8B15[80820000]                          mov	edx, [mp3_src_fname]
  9711 00006ACE E8DBFAFFFF                              call	wrstr_edx
  9712 00006AD3 E8E7FAFFFF                              call	wrcrlf
  9713 00006AD8 F8                                      clc
  9714 00006AD9 55                      		push	ebp	; return address
  9715 00006ADA C3                                      retn
  9716                                  
  9717                                  .not_switch_test:
  9718                                  .help:
  9719                                                  ;;; Erdogan Tan - 17/10/2024
  9720 00006ADB BA[3B8A0000]                            mov	edx, txt_about
  9721 00006AE0 E8C9FAFFFF                              call	wrstr_edx
  9722                                                  ;;;
  9723 00006AE5 BA[68890000]                            mov	edx, txt_help ; "usage: mp3play input.mp3 [output.wav] ["...
  9724 00006AEA E8BFFAFFFF                              call	wrstr_edx
  9725 00006AEF F9                                      stc
  9726 00006AF0 55                      		push	ebp	; return address
  9727 00006AF1 C3                                      retn
  9728                                  
  9729                                  ; =============== S U B R O U T I N E =======================================
  9730                                  
  9731                                  		; 21/10/2024
  9732                                  set_break:
  9733                                  		; set [u.break] -end of bss- address to
  9734                                  		; end_of_bss at first (mp3 file will be loaded
  9735                                  		; at the end of bss)
  9736                                  		; ([u.break] initially points to the end of PRG file
  9737                                  		; -code and data- except BSS section)
  9738                                  		;
  9739                                  		; TRDOS 386 system call
  9740                                  		; Set break address
  9741                                  		; ebx = new [u.break]
  9742                                  		;sys	_break, end_of_bss
  9743                                  		; eax = new break address (dword aligned)
  9744                                  
  9745                                  		; 10/01/2025
  9746                                  		sys	_break, 100000h ; end of 1st 1MB
   116                              <1> 
   117                              <1> 
   118                              <1> 
   119                              <1> 
   120                              <1>  %if %0 >= 2
   121 00006AF2 BB00001000          <1>  mov ebx, %2
   122                              <1>  %if %0 >= 3
   123                              <1>  mov ecx, %3
   124                              <1>  %if %0 = 4
   125                              <1>  mov edx, %4
   126                              <1>  %endif
   127                              <1>  %endif
   128                              <1>  %endif
   129 00006AF7 B811000000          <1>  mov eax, %1
   130                              <1> 
   131 00006AFC CD40                <1>  int 40h
  9747                                  
  9748 00006AFE A3[7C2A0500]                            mov	[stream_start], eax
  9749 00006B03 A3[802A0500]                            mov	[stream_pos], eax
  9750                                  
  9751 00006B08 C3                      		retn
  9752                                  
  9753                                  
  9754                                  ; =============== S U B R O U T I N E =======================================
  9755                                  
  9756                                  		; 20/10/2024
  9757                                  
  9758                                  open_and_mmap_the_file:
  9759                                  		; 21/10/2024
  9760                                  		; TRDOS 386 system call
  9761                                  		; Open File
  9762                                  		; ebx = pointer to filename
  9763                                  		; ecx = open mode, 0 = read
  9764                                               	sys	_open, [mp3_src_fname], 0
   116                              <1> 
   117                              <1> 
   118                              <1> 
   119                              <1> 
   120                              <1>  %if %0 >= 2
   121 00006B09 8B1D[80820000]      <1>  mov ebx, %2
   122                              <1>  %if %0 >= 3
   123 00006B0F B900000000          <1>  mov ecx, %3
   124                              <1>  %if %0 = 4
   125                              <1>  mov edx, %4
   126                              <1>  %endif
   127                              <1>  %endif
   128                              <1>  %endif
   129 00006B14 B805000000          <1>  mov eax, %1
   130                              <1> 
   131 00006B19 CD40                <1>  int 40h
  9765 00006B1B 7270                    		jc	short .not_found
  9766                                  
  9767 00006B1D A3[782A0500]                            mov     [hFile], eax
  9768                                  
  9769                                                 	; get file size by using systell system call
  9770                                   		; (not applicable for TRDOS 386 Kernel v2.0.9 and earlier)
  9771                                  		; TRDOS 386 system call
  9772                                  		; Get current file (offset) pointer
  9773                                  		; ebx = file handle (file descriptor)
  9774                                  		; ecx = 0, offset
  9775                                  		; edx = 2, from the end of file
  9776                                  		;sys	_tell, eax, 0, 2
  9777                                                  ;mov     [mp3_file_size], eax
  9778                                  
  9779                                  		; *** get file size ***
  9780                                  		; TRDOS 386 system call
  9781                                  		; Set file (offset) pointer to file size 
  9782                                  		; (needed for TRDOS kernel v2.0.9 and earlier)
  9783                                  		; ebx = file handle (file descriptor)
  9784                                  		; ecx = 0, offset
  9785                                  		; edx = 2, from the end of file
  9786                                  		sys	_seek, eax, 0, 2
   116                              <1> 
   117                              <1> 
   118                              <1> 
   119                              <1> 
   120                              <1>  %if %0 >= 2
   121 00006B22 89C3                <1>  mov ebx, %2
   122                              <1>  %if %0 >= 3
   123 00006B24 B900000000          <1>  mov ecx, %3
   124                              <1>  %if %0 = 4
   125 00006B29 BA02000000          <1>  mov edx, %4
   126                              <1>  %endif
   127                              <1>  %endif
   128                              <1>  %endif
   129 00006B2E B813000000          <1>  mov eax, %1
   130                              <1> 
   131 00006B33 CD40                <1>  int 40h
  9787                                  		; TRDOS 386 system call
  9788                                  		; Get current file (offset) pointer
  9789                                  		; (needed for TRDOS 386 kernel version 2.0.9 and earlier)
  9790 00006B35 31D2                    		xor	edx, edx ; 0
  9791                                  		; ecx = 0
  9792                                  		; ebx = file handle
  9793                                  		sys	_tell
   116                              <1> 
   117                              <1> 
   118                              <1> 
   119                              <1> 
   120                              <1>  %if %0 >= 2
   121                              <1>  mov ebx, %2
   122                              <1>  %if %0 >= 3
   123                              <1>  mov ecx, %3
   124                              <1>  %if %0 = 4
   125                              <1>  mov edx, %4
   126                              <1>  %endif
   127                              <1>  %endif
   128                              <1>  %endif
   129 00006B37 B814000000          <1>  mov eax, %1
   130                              <1> 
   131 00006B3C CD40                <1>  int 40h
  9794 00006B3E A3[FCF10000]            		mov     [mp3_file_size], eax
  9795                                  
  9796                                  		; *** set file offset pointer to 0 again ***
  9797                                  		; TRDOS 386 system call
  9798                                  		; Set file (offset) pointer
  9799                                  		; ebx = file handle (file descriptor)
  9800                                  		; ecx = 0, offset
  9801                                  		; edx = 0, from the beginning/start of file
  9802 00006B43 50                      		push	eax
  9803                                  		sys	_seek
   116                              <1> 
   117                              <1> 
   118                              <1> 
   119                              <1> 
   120                              <1>  %if %0 >= 2
   121                              <1>  mov ebx, %2
   122                              <1>  %if %0 >= 3
   123                              <1>  mov ecx, %3
   124                              <1>  %if %0 = 4
   125                              <1>  mov edx, %4
   126                              <1>  %endif
   127                              <1>  %endif
   128                              <1>  %endif
   129 00006B44 B813000000          <1>  mov eax, %1
   130                              <1> 
   131 00006B49 CD40                <1>  int 40h
  9804 00006B4B 58                      		pop	eax
  9805                                  
  9806                                  		; now, set [u.break] address to the end of mp3 file
  9807                                  		; at memory -in BSS section-
  9808                                  		; (not necessary for TRDOS 386 PRG files)
  9809                                  		; (this system call will allocate user memory pages
  9810                                  		;  before sysread system call.. early)
  9811                                  		;add	eax, end_of_bss
  9812                                  		; 13/01/2025
  9813 00006B4C 0500001000              		add	eax, 100000h ; + end of 1st 1MB
  9814                                  		; TRDOS 386 system call
  9815                                  		; Set break address
  9816                                  		; ebx = new [u.break]
  9817                                  		sys	_break, eax
   116                              <1> 
   117                              <1> 
   118                              <1> 
   119                              <1> 
   120                              <1>  %if %0 >= 2
   121 00006B51 89C3                <1>  mov ebx, %2
   122                              <1>  %if %0 >= 3
   123                              <1>  mov ecx, %3
   124                              <1>  %if %0 = 4
   125                              <1>  mov edx, %4
   126                              <1>  %endif
   127                              <1>  %endif
   128                              <1>  %endif
   129 00006B53 B811000000          <1>  mov eax, %1
   130                              <1> 
   131 00006B58 CD40                <1>  int 40h
  9818                                  
  9819                                  		; TRDOS 386 system call
  9820                                  		; Read file
  9821                                  		; ebx = file handle (file descriptor)
  9822                                  		; ecx = buffer address
  9823                                  		; edx = byte count
  9824                                  		sys	_read, [hFile], [stream_start], [mp3_file_size]
   116                              <1> 
   117                              <1> 
   118                              <1> 
   119                              <1> 
   120                              <1>  %if %0 >= 2
   121 00006B5A 8B1D[782A0500]      <1>  mov ebx, %2
   122                              <1>  %if %0 >= 3
   123 00006B60 8B0D[7C2A0500]      <1>  mov ecx, %3
   124                              <1>  %if %0 = 4
   125 00006B66 8B15[FCF10000]      <1>  mov edx, %4
   126                              <1>  %endif
   127                              <1>  %endif
   128                              <1>  %endif
   129 00006B6C B803000000          <1>  mov eax, %1
   130                              <1> 
   131 00006B71 CD40                <1>  int 40h
  9825 00006B73 7204                    		jc	short .read_error
  9826 00006B75 39D0                    		cmp	eax, edx
  9827 00006B77 730E                    		jnb	short .ok
  9828                                  		;or	eax, eax
  9829                                  		;jnz	short .ok
  9830                                  .read_error:		
  9831                                  		; TRDOS 386 system call
  9832                                  		; Close file
  9833                                  		; ebx = file handle (file descriptor)
  9834                                  		;sys	_close, [hFile]
  9835                                   		sys	_close
   116                              <1> 
   117                              <1> 
   118                              <1> 
   119                              <1> 
   120                              <1>  %if %0 >= 2
   121                              <1>  mov ebx, %2
   122                              <1>  %if %0 >= 3
   123                              <1>  mov ecx, %3
   124                              <1>  %if %0 = 4
   125                              <1>  mov edx, %4
   126                              <1>  %endif
   127                              <1>  %endif
   128                              <1>  %endif
   129 00006B79 B806000000          <1>  mov eax, %1
   130                              <1> 
   131 00006B7E CD40                <1>  int 40h
  9836                                  
  9837 00006B80 BA[716C0000]            		mov	edx, txt_read_err
  9838 00006B85 EB0B                    		jmp	short .r_err_msg
  9839                                  .ok:
  9840 00006B87 A3[842A0500]                            mov     [bytes_left], eax ; read count
  9841 00006B8C C3                      		retn
  9842                                  .not_found:
  9843 00006B8D BA[4E890000]                            mov     edx, txt_not_found ; "cannot open source file\r\n"
  9844                                  .r_err_msg:
  9845 00006B92 E817FAFFFF                              call    wrstr_edx
  9846 00006B97 F9                                      stc
  9847 00006B98 C3                                      retn
  9848                                  
  9849                                  ;txt_read_err	db 'File read error!',0Dh,0Ah,0
  9850                                  
  9851                                  
  9852                                  ; =============== S U B R O U T I N E =======================================
  9853                                  
  9854                                  		; 20/10/2024
  9855                                  print_msg:
  9856                                  		; TRDOS 386 system call
  9857                                  		; write/display message on screen
  9858                                  		; ebx = ASCIIZ message (text) address
  9859                                  		; ecx = max. message length (stop count before char zero)
  9860                                  		; edx = character color (CGA)
  9861 00006B99 B9FF000000              		mov	ecx, 255
  9862 00006B9E BA0B000000              		mov	edx, 0Bh ; DL ; cyan
  9863                                  		sys	_msg
   116                              <1> 
   117                              <1> 
   118                              <1> 
   119                              <1> 
   120                              <1>  %if %0 >= 2
   121                              <1>  mov ebx, %2
   122                              <1>  %if %0 >= 3
   123                              <1>  mov ecx, %3
   124                              <1>  %if %0 = 4
   125                              <1>  mov edx, %4
   126                              <1>  %endif
   127                              <1>  %endif
   128                              <1>  %endif
   129 00006BA3 B823000000          <1>  mov eax, %1
   130                              <1> 
   131 00006BA8 CD40                <1>  int 40h
  9864 00006BAA C3                      		retn
  9865                                  
  9866                                  
  9867                                  ; =============== S U B R O U T I N E =======================================
  9868                                  
  9869                                  		; 20/10/2024
  9870                                  GetTickCount:
  9871                                  		; TRDOS 386 system call
  9872                                  		; get current time, get tick count
  9873                                  		; ebx = 4 -> get count of system timer ticks
  9874                                  		sys	_time, 4
   116                              <1> 
   117                              <1> 
   118                              <1> 
   119                              <1> 
   120                              <1>  %if %0 >= 2
   121 00006BAB BB04000000          <1>  mov ebx, %2
   122                              <1>  %if %0 >= 3
   123                              <1>  mov ecx, %3
   124                              <1>  %if %0 = 4
   125                              <1>  mov edx, %4
   126                              <1>  %endif
   127                              <1>  %endif
   128                              <1>  %endif
   129 00006BB0 B80D000000          <1>  mov eax, %1
   130                              <1> 
   131 00006BB5 CD40                <1>  int 40h
  9875                                  		; eax = system timer ticks (18.2 ticks per second)
  9876 00006BB7 BA15F4BC20              		mov	edx, 549254165	; 10^10/18.2
  9877 00006BBC F7E2                    		mul	edx
  9878                                  		; edx:eax = milliseconds * 10^7
  9879 00006BBE BB80969800              		mov	ebx, 10000000
  9880 00006BC3 F7F3                    		div	ebx		; 10^7
  9881                                  		; eax = milliseconds
  9882 00006BC5 81FA404B4C00            		cmp	edx, 5000000	; 10^7/2
  9883 00006BCB 7201                    		jb	short .ok
  9884 00006BCD 40                      		inc	eax		; round up
  9885                                  .ok:
  9886 00006BCE C3                      		retn
  9887                                  
  9888                                  
  9889                                  ; =============== E X I T ===================================================
  9890                                  
  9891                                  		; 20/10/2024
  9892                                  ExitProcess:
  9893 00006BCF 31DB                    		xor	ebx, ebx  ; mov ebx, 0  ; exit code
  9894                                  		sys	_exit
   116                              <1> 
   117                              <1> 
   118                              <1> 
   119                              <1> 
   120                              <1>  %if %0 >= 2
   121                              <1>  mov ebx, %2
   122                              <1>  %if %0 >= 3
   123                              <1>  mov ecx, %3
   124                              <1>  %if %0 = 4
   125                              <1>  mov edx, %4
   126                              <1>  %endif
   127                              <1>  %endif
   128                              <1>  %endif
   129 00006BD1 B801000000          <1>  mov eax, %1
   130                              <1> 
   131 00006BD6 CD40                <1>  int 40h
  9895                                  ;hang:
  9896                                  		;jmp	short hang
  9897                                  
  9898                                  
  9899                                  ; =============== S U B R O U T I N E =======================================
  9900                                  
  9901                                  		; 20/10/2024
  9902                                  WriteFile:
  9903 00006BD8 58                      		pop	eax ; near call return address
  9904 00006BD9 5B                      		pop	ebx
  9905 00006BDA 59                      		pop	ecx
  9906 00006BDB 5A                      		pop	edx
  9907 00006BDC 50                      		push	eax
  9908                                  		; TRDOS 386 system call
  9909                                  		; Write file
  9910                                  		; ebx = file handle (file descriptor)
  9911                                  		; ecx = buffer address
  9912                                  		; edx = byte count
  9913                                  		sys	_write
   116                              <1> 
   117                              <1> 
   118                              <1> 
   119                              <1> 
   120                              <1>  %if %0 >= 2
   121                              <1>  mov ebx, %2
   122                              <1>  %if %0 >= 3
   123                              <1>  mov ecx, %3
   124                              <1>  %if %0 = 4
   125                              <1>  mov edx, %4
   126                              <1>  %endif
   127                              <1>  %endif
   128                              <1>  %endif
   129 00006BDD B804000000          <1>  mov eax, %1
   130                              <1> 
   131 00006BE2 CD40                <1>  int 40h
  9914 00006BE4 730F                    		jnc	short .ok
  9915 00006BE6 39D0                    		cmp	eax, edx
  9916 00006BE8 730B                    		jnb	short .ok
  9917                                  		;or	eax, eax
  9918                                  		;jnz	short .ok
  9919                                  
  9920 00006BEA BA[F66B0000]            		mov	edx, txt_write_err
  9921 00006BEF E8BAF9FFFF                              call    wrstr_edx
  9922 00006BF4 F9                                      stc
  9923                                  .ok:
  9924 00006BF5 C3                                      retn
  9925                                  
  9926 00006BF6 46696C652077726974-     txt_write_err	db 'File write error!',0Dh,0Ah,0
  9926 00006BFF 65206572726F72210D-
  9926 00006C08 0A00               
  9927                                  
  9928                                  
  9929                                  ; =============== S U B R O U T I N E =======================================
  9930                                  
  9931                                  		; 20/10/2024
  9932                                  CreateFile:
  9933 00006C0A 58                      		pop	eax ; near call return address
  9934 00006C0B 5B                      		pop	ebx
  9935 00006C0C 50                      		push	eax
  9936                                  		; TRDOS 386 system call
  9937                                  		; Create file
  9938                                  		; ebx = (ASCIIZ) file name address
  9939                                  		; ecx = mode
  9940 00006C0D 31C9                    		xor	ecx, ecx ; CL ; mov ecx, 0 ; ordinary file
  9941                                  		sys	_creat
   116                              <1> 
   117                              <1> 
   118                              <1> 
   119                              <1> 
   120                              <1>  %if %0 >= 2
   121                              <1>  mov ebx, %2
   122                              <1>  %if %0 >= 3
   123                              <1>  mov ecx, %3
   124                              <1>  %if %0 = 4
   125                              <1>  mov edx, %4
   126                              <1>  %endif
   127                              <1>  %endif
   128                              <1>  %endif
   129 00006C0F B808000000          <1>  mov eax, %1
   130                              <1> 
   131 00006C14 CD40                <1>  int 40h
  9942 00006C16 730B                    		jnc	short .ok ; eax = file handle
  9943                                  
  9944 00006C18 BA[246C0000]            		mov	edx, txt_create_err
  9945 00006C1D E88CF9FFFF                              call    wrstr_edx
  9946 00006C22 F9                                      stc
  9947                                  .ok:
  9948 00006C23 C3                      		retn
  9949                                  
  9950 00006C24 46696C652063726561-     txt_create_err	db 'File create error!',0Dh,0Ah,0
  9950 00006C2D 7465206572726F7221-
  9950 00006C36 0D0A00             
  9951                                  
  9952                                  
  9953                                  ; =============== S U B R O U T I N E =======================================
  9954                                  
  9955                                  		; 20/10/2024
  9956                                  OpenFile:
  9957 00006C39 58                      		pop	eax ; near call return address
  9958 00006C3A 5B                      		pop	ebx
  9959 00006C3B 50                      		push	eax
  9960                                  		; TRDOS 386 system call
  9961                                  		; Open file
  9962                                  		; ebx = (ASCIIZ) file name address
  9963                                  		; ecx = mode
  9964 00006C3C 31C9                    		xor	ecx, ecx ; CL ; mov ecx, 0 ; ordinary file
  9965                                  		sys	_open
   116                              <1> 
   117                              <1> 
   118                              <1> 
   119                              <1> 
   120                              <1>  %if %0 >= 2
   121                              <1>  mov ebx, %2
   122                              <1>  %if %0 >= 3
   123                              <1>  mov ecx, %3
   124                              <1>  %if %0 = 4
   125                              <1>  mov edx, %4
   126                              <1>  %endif
   127                              <1>  %endif
   128                              <1>  %endif
   129 00006C3E B805000000          <1>  mov eax, %1
   130                              <1> 
   131 00006C43 CD40                <1>  int 40h
  9966                                  		;jnc	short .ok ; eax = file handle
  9967                                  		;
  9968                                  		;mov	edx, txt_open_err
  9969                                                  ;call   wrstr_edx
  9970                                                  ;stc
  9971                                  ;.ok:
  9972 00006C45 C3                      		retn
  9973                                  
  9974                                  ;txt_open_err	db 'File not found!',0Dh,0Ah,0
  9975                                  		;db 'File open error!',ODh,0Ah,0
  9976                                  	 
  9977                                  
  9978                                  ; =============== S U B R O U T I N E =======================================
  9979                                  
  9980                                  		; 20/10/2024
  9981                                  SetFilePointer:
  9982 00006C46 58                      		pop	eax ; near call return address
  9983 00006C47 5B                      		pop	ebx
  9984 00006C48 59                      		pop	ecx
  9985 00006C49 5A                      		pop	edx
  9986 00006C4A 50                      		push	eax
  9987                                  		; TRDOS 386 system call
  9988                                  		; Set file offset pointer  ; sysseek
  9989                                  		; ebx = file handle (file descriptor)
  9990                                  		; ecx = offset
  9991                                  		; edx = switch, DL = 0 = from the start of file
  9992                                  		;		     1 = from the current offset
  9993                                  		;		     2 = from the end of file
  9994                                  		sys	_seek
   116                              <1> 
   117                              <1> 
   118                              <1> 
   119                              <1> 
   120                              <1>  %if %0 >= 2
   121                              <1>  mov ebx, %2
   122                              <1>  %if %0 >= 3
   123                              <1>  mov ecx, %3
   124                              <1>  %if %0 = 4
   125                              <1>  mov edx, %4
   126                              <1>  %endif
   127                              <1>  %endif
   128                              <1>  %endif
   129 00006C4B B813000000          <1>  mov eax, %1
   130                              <1> 
   131 00006C50 CD40                <1>  int 40h
  9995                                  		; eax = (value of) new offset pointer
  9996                                  
  9997 00006C52 C3                      		retn
  9998                                  
  9999                                  
 10000                                  ; =============== S U B R O U T I N E =======================================
 10001                                  
 10002                                  		; 20/10/2024
 10003                                  ReadFile:
 10004 00006C53 58                      		pop	eax ; near call return address
 10005 00006C54 5B                      		pop	ebx
 10006 00006C55 59                      		pop	ecx
 10007 00006C56 5A                      		pop	edx
 10008 00006C57 50                      		push	eax
 10009                                  		; TRDOS 386 system call
 10010                                  		; Read file
 10011                                  		; ebx = file handle (file descriptor)
 10012                                  		; ecx = buffer address
 10013                                  		; edx = byte count
 10014                                  		sys	_read
   116                              <1> 
   117                              <1> 
   118                              <1> 
   119                              <1> 
   120                              <1>  %if %0 >= 2
   121                              <1>  mov ebx, %2
   122                              <1>  %if %0 >= 3
   123                              <1>  mov ecx, %3
   124                              <1>  %if %0 = 4
   125                              <1>  mov edx, %4
   126                              <1>  %endif
   127                              <1>  %endif
   128                              <1>  %endif
   129 00006C58 B803000000          <1>  mov eax, %1
   130                              <1> 
   131 00006C5D CD40                <1>  int 40h
 10015 00006C5F 730F                    		jnc	short .ok
 10016 00006C61 39D0                    		cmp	eax, edx
 10017 00006C63 730B                    		jnb	short .ok
 10018                                  		;or	eax, eax
 10019                                  		;jnz	short .ok
 10020                                  
 10021 00006C65 BA[716C0000]            		mov	edx, txt_read_err
 10022 00006C6A E83FF9FFFF                              call    wrstr_edx
 10023 00006C6F F9                                      stc
 10024                                  .ok:
 10025 00006C70 C3                                      retn
 10026                                  
 10027 00006C71 46696C652072656164-     txt_read_err	db 'File read error!',0Dh,0Ah,0
 10027 00006C7A 206572726F72210D0A-
 10027 00006C83 00                 
 10028                                  
 10029                                  
 10030                                  ; =============== S U B R O U T I N E =======================================
 10031                                  
 10032                                  		; 20/10/2024
 10033                                  CloseFile:
 10034 00006C84 58                      		pop	eax ; near call return address
 10035 00006C85 5B                      		pop	ebx
 10036 00006C86 50                      		push	eax
 10037                                  		; TRDOS 386 system call
 10038                                  		; Close file
 10039                                  		; ebx = file handle (file descriptor)
 10040                                  		sys	_close
   116                              <1> 
   117                              <1> 
   118                              <1> 
   119                              <1> 
   120                              <1>  %if %0 >= 2
   121                              <1>  mov ebx, %2
   122                              <1>  %if %0 >= 3
   123                              <1>  mov ecx, %3
   124                              <1>  %if %0 = 4
   125                              <1>  mov edx, %4
   126                              <1>  %endif
   127                              <1>  %endif
   128                              <1>  %endif
   129 00006C87 B806000000          <1>  mov eax, %1
   130                              <1> 
   131 00006C8C CD40                <1>  int 40h
 10041                                  
 10042 00006C8E C3                      		retn
 10043                                  
 10044                                  
 10045                                  ; ---------------------------------------------------------------------------
 10046                                  ; TRDOS 386 Audio System Functions
 10047                                  ; ---------------------------------------------------------------------------
 10048                                  
 10049                                  ; =============== S U B R O U T I N E =======================================
 10050                                  
 10051                                  		; 10/01/2025
 10052                                  		; 20/10/2024
 10053                                  detect_enable_audio_device:
 10054 00006C8F 66C705[128B0000]80-     		mov	word [max_frequency], 48000
 10054 00006C97 BB                 
 10055                                  		; 10/01/2025
 10056                                  		;mov	byte [blocks], 8
 10057                                  
 10058                                  		; check AC'97 hardware at first
 10059                                  		; (48kHz support)
 10060                                  		; TRDOS 386 system call
 10061                                  		; sysaudio
 10062                                  		; Detect (BH=1) AC'97 (BL=2) Audio Device
 10063                                  .ac97:
 10064                                          	sys	_audio, 0102h
   116                              <1> 
   117                              <1> 
   118                              <1> 
   119                              <1> 
   120                              <1>  %if %0 >= 2
   121 00006C98 BB02010000          <1>  mov ebx, %2
   122                              <1>  %if %0 >= 3
   123                              <1>  mov ecx, %3
   124                              <1>  %if %0 = 4
   125                              <1>  mov edx, %4
   126                              <1>  %endif
   127                              <1>  %endif
   128                              <1>  %endif
   129 00006C9D B820000000          <1>  mov eax, %1
   130                              <1> 
   131 00006CA2 CD40                <1>  int 40h
 10065 00006CA4 7245                    		jc	short .sb16
 10066 00006CA6 C605[108B0000]02        		mov	byte [audio_hardware], 2 ; AC97
 10067                                  
 10068                                  		;;;;
 10069                                  		; 12/01/2025 (ref: playwav9.s, 18/12/2024)
 10070                                  		sys	_audio, 0E00h ; get audio controller info
   116                              <1> 
   117                              <1> 
   118                              <1> 
   119                              <1> 
   120                              <1>  %if %0 >= 2
   121 00006CAD BB000E0000          <1>  mov ebx, %2
   122                              <1>  %if %0 >= 3
   123                              <1>  mov ecx, %3
   124                              <1>  %if %0 = 4
   125                              <1>  mov edx, %4
   126                              <1>  %endif
   127                              <1>  %endif
   128                              <1>  %endif
   129 00006CB2 B820000000          <1>  mov eax, %1
   130                              <1> 
   131 00006CB7 CD40                <1>  int 40h
 10071                                  		; EAX = IRQ Number in AL
 10072                                  		;	Audio Device Number in AH 
 10073                                  		; EBX = DEV/VENDOR ID
 10074                                  		;       (DDDDDDDDDDDDDDDDVVVVVVVVVVVVVVVV)
 10075                                  		; ECX = BUS/DEV/FN 
 10076                                  		;       (00000000BBBBBBBBDDDDDFFF00000000)
 10077                                  		; EDX = NABMBAR/NAMBAR (for AC97)
 10078                                  		;      (Low word, DX = NAMBAR address)
 10079                                  		; EDX = Base IO Addr (DX) for SB16 & VT8233
 10080                                  
 10081 00006CB9 891D[008B0000]          		mov	[dev_vendor], ebx
 10082 00006CBF 890D[FC8A0000]          		mov	[bus_dev_fn], ecx
 10083                                  
 10084 00006CC5 668915[048B0000]                	mov     [NAMBAR], dx	; save audio mixer base addr
 10085                                  		;shr	edx, 16
 10086                                          	;mov    [NABMBAR], dx	; save bus master base addr
 10087 00006CCC 8915[048B0000]          		mov	[NAMBAR], edx
 10088                                  
 10089 00006CD2 A2[0C8B0000]            		mov	[ac97_int_ln_reg], al
 10090                                  		;;;;
 10091                                  		
 10092                                  		; TRDOS 386 system call
 10093                                  		; sysaudio
 10094                                  		; Get AC'97 Codec info
 10095                                  		; (Function 14, sub function 1)
 10096                                  		sys	_audio, 0E01h
   116                              <1> 
   117                              <1> 
   118                              <1> 
   119                              <1> 
   120                              <1>  %if %0 >= 2
   121 00006CD7 BB010E0000          <1>  mov ebx, %2
   122                              <1>  %if %0 >= 3
   123                              <1>  mov ecx, %3
   124                              <1>  %if %0 = 4
   125                              <1>  mov edx, %4
   126                              <1>  %endif
   127                              <1>  %endif
   128                              <1>  %endif
   129 00006CDC B820000000          <1>  mov eax, %1
   130                              <1> 
   131 00006CE1 CD40                <1>  int 40h
 10097                                  		; Save Variable Rate Audio support bit
 10098 00006CE3 2401                    		and	al, 1
 10099 00006CE5 A2[118B0000]            		mov	[vra], al
 10100 00006CEA C3                      		retn
 10101                                  .sb16:
 10102                                  		; check Sound Blaster 16 card at second
 10103                                  		; (44100Hz support, but 24kHz will be used)
 10104                                  		; TRDOS 386 system call
 10105                                  		; sysaudio
 10106                                  		; Detect (BH=1) SB16 (BL=1) Audio Card
 10107                                          	sys	_audio, 0101h
   116                              <1> 
   117                              <1> 
   118                              <1> 
   119                              <1> 
   120                              <1>  %if %0 >= 2
   121 00006CEB BB01010000          <1>  mov ebx, %2
   122                              <1>  %if %0 >= 3
   123                              <1>  mov ecx, %3
   124                              <1>  %if %0 = 4
   125                              <1>  mov edx, %4
   126                              <1>  %endif
   127                              <1>  %endif
   128                              <1>  %endif
   129 00006CF0 B820000000          <1>  mov eax, %1
   130                              <1> 
   131 00006CF5 CD40                <1>  int 40h
 10108 00006CF7 7228                    		jc	short .vt8233
 10109 00006CF9 C605[108B0000]01        		mov	byte [audio_hardware], 1 ; SB16
 10110 00006D00 66C705[128B0000]44-     		mov	word [max_frequency], 44100
 10110 00006D08 AC                 
 10111                                  		; 10/01/2025
 10112                                  		;;mov	byte [blocks], 7
 10113                                  		;dec	byte [blocks]
 10114                                  
 10115                                  		;;;;
 10116                                  		; 12/01/2025 (ref: sb16play.s, 20/12/2024)
 10117                                  		sys	_audio, 0E00h ; get audio controller info
   116                              <1> 
   117                              <1> 
   118                              <1> 
   119                              <1> 
   120                              <1>  %if %0 >= 2
   121 00006D09 BB000E0000          <1>  mov ebx, %2
   122                              <1>  %if %0 >= 3
   123                              <1>  mov ecx, %3
   124                              <1>  %if %0 = 4
   125                              <1>  mov edx, %4
   126                              <1>  %endif
   127                              <1>  %endif
   128                              <1>  %endif
   129 00006D0E B820000000          <1>  mov eax, %1
   130                              <1> 
   131 00006D13 CD40                <1>  int 40h
 10118                                  	
 10119 00006D15 8915[088B0000]          		mov	[audio_io_base], edx
 10120 00006D1B A2[0C8B0000]            		mov	[audio_intr], al
 10121                                  		;;;;
 10122                                  
 10123 00006D20 C3                      		retn
 10124                                  .vt8233:
 10125                                  		; check VIA VT3237R (VT8233) hardware at third
 10126                                  		; (48kHz support)
 10127                                  		; TRDOS 386 system call
 10128                                  		; sysaudio
 10129                                  		; Detect (BH=1) VT8237R (BL=3) Audio Device
 10130                                  		sys	_audio, 0103h
   116                              <1> 
   117                              <1> 
   118                              <1> 
   119                              <1> 
   120                              <1>  %if %0 >= 2
   121 00006D21 BB03010000          <1>  mov ebx, %2
   122                              <1>  %if %0 >= 3
   123                              <1>  mov ecx, %3
   124                              <1>  %if %0 = 4
   125                              <1>  mov edx, %4
   126                              <1>  %endif
   127                              <1>  %endif
   128                              <1>  %endif
   129 00006D26 B820000000          <1>  mov eax, %1
   130                              <1> 
   131 00006D2B CD40                <1>  int 40h
 10131 00006D2D 7208                    		jc	short .hda
 10132 00006D2F C605[108B0000]03        		mov	byte [audio_hardware], 3 ; VT8237R
 10133 00006D36 C3                      		retn
 10134                                  .hda:	
 10135                                  		; check Intel HDA hardware at last
 10136                                  		; (48kHz support)
 10137                                  		; TRDOS 386 system call
 10138                                  		; sysaudio
 10139                                  		; Detect (BH=1) Intel HDA (BL=4) Audio Device
 10140                                  		sys	_audio, 0104h
   116                              <1> 
   117                              <1> 
   118                              <1> 
   119                              <1> 
   120                              <1>  %if %0 >= 2
   121 00006D37 BB04010000          <1>  mov ebx, %2
   122                              <1>  %if %0 >= 3
   123                              <1>  mov ecx, %3
   124                              <1>  %if %0 = 4
   125                              <1>  mov edx, %4
   126                              <1>  %endif
   127                              <1>  %endif
   128                              <1>  %endif
   129 00006D3C B820000000          <1>  mov eax, %1
   130                              <1> 
   131 00006D41 CD40                <1>  int 40h
 10141 00006D43 7208                    		jc	short .err
 10142 00006D45 C605[108B0000]04        		mov	byte [audio_hardware], 4 ; HDA
 10143 00006D4C C3                      		retn
 10144                                  .err:
 10145 00006D4D BA[596D0000]            		mov	edx, txt_audio_nf_err
 10146 00006D52 E857F8FFFF                              call    wrstr_edx
 10147 00006D57 F9                                      stc
 10148 00006D58 C3                      		retn
 10149                                  
 10150 00006D59 50726F706572206175-     txt_audio_nf_err: db 'Proper audio hardware not found!',0Dh,0Ah,0
 10150 00006D62 64696F206861726477-
 10150 00006D6B 617265206E6F742066-
 10150 00006D74 6F756E64210D0A00   
 10151                                  
 10152                                  
 10153                                  ; =============== CONSTANT ==================================================
 10154                                  
 10155                                  		; 21/10/2024
 10156                                  MP3_MAX_OUTPUT_SIZE equ 2*2*18*32*2
 10157                                      ; = 1200h = 4608 decimal = 2 channels, 2 granules, 18*32, 2 byte(16bit)
 10158                                  
 10159                                  
 10160                                  ; =============== S U B R O U T I N E =======================================
 10161                                  
 10162                                  		; 12/01/2025
 10163                                  audio_system_init:
 10164                                  		;mov	eax, sample_buffer_size
 10165                                  		; 10/01/2025
 10166                                  		;mov	byte [blocks], 16
 10167                                  		; 12/01/2025
 10168 00006D7C C605[168B0000]08        		mov	byte [blocks], 8
 10169 00006D83 A1[14F20000]            		mov	eax, [mp3_samples_output_size]
 10170 00006D88 C1E003                  		shl	eax, 3 ; * 8
 10171                                  		;shl	eax, 4 ; * 16
 10172                                  .asi@:		
 10173                                  		; 12/01/2025
 10174                                  		;cmp	eax, 65536
 10175                                  		;jna	short .asi@@
 10176                                  		;sub	eax, [mp3_samples_output_size]
 10177                                  		;dec	byte [blocks]
 10178                                  		;;;
 10179                                  		; 11/01/2025
 10180                                  		;test	byte [blocks], 1
 10181                                  		;jz	short .asi@
 10182                                  		;dec	byte [blocks] ; even number
 10183                                  		;sub	eax, [mp3_samples_output_size]
 10184                                  		;;;
 10185                                  		;jmp	short .asi@
 10186                                  .asi@@:
 10187 00006D8B 803D[108B0000]01        		cmp	byte [audio_hardware], 1 ; SB16
 10188 00006D92 7515                    		jne	short .bufaloc
 10189                                  .asi@@@:
 10190                                  		; 10/01/2025
 10191 00006D94 3D00800000              		cmp	eax, 32768
 10192 00006D99 760E                    		jna	short .bufaloc
 10193                                  		; sample_buffer_size = 36864 bytes ; 8 blocks
 10194                                  		;sub	eax, MP3_MAX_OUTPUT_SIZE
 10195                                  		; eax = 32256 ; 7 blocks
 10196                                  		; 10/01/2025
 10197 00006D9B 2B05[14F20000]          		sub	eax, [mp3_samples_output_size]
 10198 00006DA1 FE0D[168B0000]          		dec	byte [blocks]
 10199                                  		;;;
 10200                                  		; 11/01/2025
 10201                                  		;test	byte [blocks], 1
 10202                                  		;jz	short .asi@@@
 10203                                  		;dec	byte [blocks] ; even number
 10204                                  		;sub	eax, [mp3_samples_output_size]
 10205                                  		;;;
 10206 00006DA7 EBEB                    		jmp	short .asi@@@
 10207                                  .bufaloc:
 10208                                  		; TRDOS 386 system call
 10209                                  		; sysaudio
 10210                                  		; Allocate audio buffer (for user)
 10211                                  		; ebx = 0200h (BH=2)
 10212                                  		; ecx = buffer size (in bytes)
 10213                                  		; edx = buffer address (virtual)
 10214 00006DA9 A3[188B0000]            		mov	[buffer_size], eax
 10215                                  		sys	_audio, 0200h, eax, sample_buffer
   116                              <1> 
   117                              <1> 
   118                              <1> 
   119                              <1> 
   120                              <1>  %if %0 >= 2
   121 00006DAE BB00020000          <1>  mov ebx, %2
   122                              <1>  %if %0 >= 3
   123 00006DB3 89C1                <1>  mov ecx, %3
   124                              <1>  %if %0 = 4
   125 00006DB5 BA[00300500]        <1>  mov edx, %4
   126                              <1>  %endif
   127                              <1>  %endif
   128                              <1>  %endif
   129 00006DBA B820000000          <1>  mov eax, %1
   130                              <1> 
   131 00006DBF CD40                <1>  int 40h
 10216 00006DC1 7225                    		jc	short .init_err
 10217                                  
 10218                                  		; 12/01/2025
 10219                                  		; clear audio buffer (before playback)
 10220 00006DC3 BF[00300500]            		mov	edi, sample_buffer
 10221                                  		; ecx = buffer size in bytes
 10222 00006DC8 C1E902                  		shr	ecx, 2 ; double word
 10223 00006DCB 31C0                    		xor	eax, eax
 10224 00006DCD F3AB                    		rep	stosd
 10225                                  
 10226                                  		; TRDOS 386 system call
 10227                                  		; sysaudio
 10228                                  		; Initialize audio device (bh = 3)
 10229                                  		; bl = 01h -> CallBack method
 10230                                  		; edx = Callback service address (virtual)
 10231                                  		; ecx = 0 ; CL = srb value ; not used
 10232                                  		sys	_audio, 0301h, 0, audio_callback
   116                              <1> 
   117                              <1> 
   118                              <1> 
   119                              <1> 
   120                              <1>  %if %0 >= 2
   121 00006DCF BB01030000          <1>  mov ebx, %2
   122                              <1>  %if %0 >= 3
   123 00006DD4 B900000000          <1>  mov ecx, %3
   124                              <1>  %if %0 = 4
   125 00006DD9 BA[1B6E0000]        <1>  mov edx, %4
   126                              <1>  %endif
   127                              <1>  %endif
   128                              <1>  %endif
   129 00006DDE B820000000          <1>  mov eax, %1
   130                              <1> 
   131 00006DE3 CD40                <1>  int 40h
 10233                                  		; 12/01/2025
 10234                                  		; SRB method (faster than callback method)
 10235                                  		; bl = 0 -> Signal Response Byte method
 10236                                  		; cl = 1 -> SRB set value 
 10237                                  		;     (will be set by audio IRQ service of the kernel)
 10238                                  		; edx = SRB address -one byte data-
 10239                                  		;sys	_audio, 0300h, 1, srb	
 10240 00006DE5 7201                    		jc	short .init_err
 10241 00006DE7 C3                      		retn
 10242                                  .init_err:
 10243 00006DE8 BA[F46D0000]            		mov	edx, txt_audio_init_err
 10244 00006DED E8BCF7FFFF                              call    wrstr_edx
 10245 00006DF2 F9                                      stc
 10246 00006DF3 C3                      		retn
 10247                                  
 10248 00006DF4 417564696F20686172-     txt_audio_init_err: db 'Audio hardware initialization error!',0Dh,0Ah,0
 10248 00006DFD 647761726520696E69-
 10248 00006E06 7469616C697A617469-
 10248 00006E0F 6F6E206572726F7221-
 10248 00006E18 0D0A00             
 10249                                  
 10250                                  
 10251                                  ; =============== S U B R O U T I N E =======================================
 10252                                  
 10253                                  		; 21/10/2024
 10254                                  audio_callback:
 10255                                  		; Operating system has directed CPU here because of
 10256                                  		; user (2nd) stage of the audio hardware interrupt service.
 10257                                  		; This procedure must be short and return to operating
 10258                                  		; system again via sysrelease system call
 10259                                  		; (or any system call here will be handled as sysrelease).
 10260                                  
 10261 00006E1B C605[148B0000]01        		mov	byte [srb], 1
 10262                                  
 10263                                  		; 12/01/2025
 10264 00006E22 E860010000                              call	try_enqueue_all_blocks
 10265                                  
 10266                                  		sys	_rele ; return from callback service 
   116                              <1> 
   117                              <1> 
   118                              <1> 
   119                              <1> 
   120                              <1>  %if %0 >= 2
   121                              <1>  mov ebx, %2
   122                              <1>  %if %0 >= 3
   123                              <1>  mov ecx, %3
   124                              <1>  %if %0 = 4
   125                              <1>  mov edx, %4
   126                              <1>  %endif
   127                              <1>  %endif
   128                              <1>  %endif
   129 00006E27 B827000000          <1>  mov eax, %1
   130                              <1> 
   131 00006E2C CD40                <1>  int 40h
 10267                                  		
 10268                                  		; we must not come here !
 10269 00006E2E BBFFFFFFFF              		mov	ebx, -1
 10270                                  		sys	_exit
   116                              <1> 
   117                              <1> 
   118                              <1> 
   119                              <1> 
   120                              <1>  %if %0 >= 2
   121                              <1>  mov ebx, %2
   122                              <1>  %if %0 >= 3
   123                              <1>  mov ecx, %3
   124                              <1>  %if %0 = 4
   125                              <1>  mov edx, %4
   126                              <1>  %endif
   127                              <1>  %endif
   128                              <1>  %endif
   129 00006E33 B801000000          <1>  mov eax, %1
   130                              <1> 
   131 00006E38 CD40                <1>  int 40h
 10271                                  		;jmp	short audio_callback
 10272                                  
 10273                                  
 10274                                  ; =============== S U B R O U T I N E =======================================
 10275                                  
 10276                                  		; 12/01/2025
 10277                                  		; 10/01/2025
 10278                                  		; 21/10/2024
 10279                                  mp3_cast_to_speaker:
 10280                                                  ; 12/01/2025
 10281                                  		;call	try_enqueue_all_blocks
 10282                                  	
 10283                                  		; 12/01/2025
 10284                                  		;cmp	dword [bytes_left],0
 10285                                  		;jz	short .playback
 10286                                  		
 10287                                  		; 12/01/2025
 10288                                  		; (here audio buffer -sample_buffer- is empty)
 10289                                  		; (clear dma half buffer 1)
 10290                                  		sys	_audio, 1001h
   116                              <1> 
   117                              <1> 
   118                              <1> 
   119                              <1> 
   120                              <1>  %if %0 >= 2
   121 00006E3A BB01100000          <1>  mov ebx, %2
   122                              <1>  %if %0 >= 3
   123                              <1>  mov ecx, %3
   124                              <1>  %if %0 = 4
   125                              <1>  mov edx, %4
   126                              <1>  %endif
   127                              <1>  %endif
   128                              <1>  %endif
   129 00006E3F B820000000          <1>  mov eax, %1
   130                              <1> 
   131 00006E44 CD40                <1>  int 40h
 10291                                  		; (clear dma half buffer 2)		
 10292                                  		;sys	_audio, 1002h
 10293                                  
 10294                                  		; TRDOS 386 system call
 10295                                  		; sysaudio
 10296                                  		; bh = 16 : update (current, first) dma half buffer
 10297                                  		; bl = 0  : then switch to the next (second) half buffer
 10298                                  		sys	_audio, 1000h
   116                              <1> 
   117                              <1> 
   118                              <1> 
   119                              <1> 
   120                              <1>  %if %0 >= 2
   121 00006E46 BB00100000          <1>  mov ebx, %2
   122                              <1>  %if %0 >= 3
   123                              <1>  mov ecx, %3
   124                              <1>  %if %0 = 4
   125                              <1>  mov edx, %4
   126                              <1>  %endif
   127                              <1>  %endif
   128                              <1>  %endif
   129 00006E4B B820000000          <1>  mov eax, %1
   130                              <1> 
   131 00006E50 CD40                <1>  int 40h
 10299                                  
 10300                                  		; 12/01/2025
 10301                                  		; 22/10/2024
 10302                                  		;call	try_enqueue_all_blocks
 10303                                  .playback:
 10304                                  		; TRDOS 386 system call
 10305                                  		; sysaudio
 10306                                  		; Set Master Volume Level (BL=0 or 80h)
 10307                                  		; 	for next playing (BL>=80h)
 10308                                  		;sys	_audio, 0B80h, 1D1Dh
 10309                                  		sys	_audio, 0B00h, 1D1Dh
   116                              <1> 
   117                              <1> 
   118                              <1> 
   119                              <1> 
   120                              <1>  %if %0 >= 2
   121 00006E52 BB000B0000          <1>  mov ebx, %2
   122                              <1>  %if %0 >= 3
   123 00006E57 B91D1D0000          <1>  mov ecx, %3
   124                              <1>  %if %0 = 4
   125                              <1>  mov edx, %4
   126                              <1>  %endif
   127                              <1>  %endif
   128                              <1>  %endif
   129 00006E5C B820000000          <1>  mov eax, %1
   130                              <1> 
   131 00006E61 CD40                <1>  int 40h
 10310                                  
 10311                                  		;mov	byte [volume_level], 1Dh
 10312 00006E63 880D[158B0000]          		mov	[volume_level], cl
 10313                                  
 10314                                  		; Start	to play
 10315 00006E69 A1[549B0000]            		mov	eax, [mp3_bytes_per_sample]
 10316                                  		;shr	al, 1 ; 8 -> 0, 16 -> 1
 10317                                  		;shl	al, 1 ; 16 -> 2, 8 -> 0
 10318 00006E6E 2402                    		and	al, 2 ; 22/10/2024
 10319 00006E70 8B1D[4C9B0000]          		mov	ebx, [mp3_output_num_channels]
 10320 00006E76 4B                      		dec	ebx
 10321 00006E77 08C3                    		or	bl, al
 10322 00006E79 8B0D[509B0000]          		mov	ecx, [mp3_output_sample_rate]
 10323 00006E7F B704                    		mov	bh, 4 ; start to play
 10324                                  
 10325                                  		; TRDOS 386 system call
 10326                                  		; sysaudio
 10327                                  		; bh = 4 -> start to play
 10328                                  		; bl = mode -> bit 0, 1 = stereo, 0 = mono
 10329                                  		;	       bit 1, 1 = 16 bit, 0 = 8 bit
 10330                                  		; cx = sample rate (hertz)
 10331                                  		sys	_audio
   116                              <1> 
   117                              <1> 
   118                              <1> 
   119                              <1> 
   120                              <1>  %if %0 >= 2
   121                              <1>  mov ebx, %2
   122                              <1>  %if %0 >= 3
   123                              <1>  mov ecx, %3
   124                              <1>  %if %0 = 4
   125                              <1>  mov edx, %4
   126                              <1>  %endif
   127                              <1>  %endif
   128                              <1>  %endif
   129 00006E81 B820000000          <1>  mov eax, %1
   130                              <1> 
   131 00006E86 CD40                <1>  int 40h
 10332                                  
 10333                                  		; 12/01/2025
 10334 00006E88 C605[148B0000]00        		mov	byte [srb], 0
 10335                                  		;;;
 10336                                  
 10337                                  .playback_lop:
 10338 00006E8F 31C0                    		xor	eax, eax
 10339 00006E91 3905[842A0500]          		cmp	[bytes_left], eax ; 0
 10340 00006E97 7508                    		jnz	short .playback_next
 10341                                  		; 22/10/2024
 10342 00006E99 3805[BC820000]          		cmp	byte [num_enqueued_frames], al ; 0
 10343 00006E9F 742B                                    jz	short .playback_end
 10344                                  .playback_next:
 10345 00006EA1 A2[BC820000]            		mov	[num_enqueued_frames], al ; 0
 10346 00006EA6 803D[148B0000]01        		cmp	byte [srb], 1	; audio interrupt status
 10347 00006EAD 7258                    		jb	short .getchar
 10348                                  		;mov	byte [srb], 0	; reset
 10349 00006EAF A2[148B0000]            		mov	[srb], al ; 0
 10350                                  		; 12/01/2025
 10351                                  		;call	try_enqueue_all_blocks
 10352                                  		;;; 10/01/2025
 10353 00006EB4 A0[FA8A0000]            		mov	al, [half_buffer]
 10354 00006EB9 8035[FA8A0000]01        		xor	byte [half_buffer], 1
 10355 00006EC0 0431                    		add	al, '1'
 10356 00006EC2 B44E                    		mov	ah, 4Eh
 10357 00006EC4 66A300800B00            		mov	[0B8000h], ax 
 10358                                  		;;;	
 10359 00006ECA EBC3                    		jmp	short .playback_lop
 10360                                  .playback_end:
 10361                                  		;;; 10/01/2025
 10362 00006ECC 66B8304E                		mov	ax, 4E30h
 10363 00006ED0 66A300800B00            		mov	[0B8000h], ax 
 10364                                  		;;;
 10365                                  
 10366                                  		; TRDOS 386 system call
 10367                                  		; sysaudio
 10368                                  		; Stop playing
 10369                                  		sys	_audio, 0700h
   116                              <1> 
   117                              <1> 
   118                              <1> 
   119                              <1> 
   120                              <1>  %if %0 >= 2
   121 00006ED6 BB00070000          <1>  mov ebx, %2
   122                              <1>  %if %0 >= 3
   123                              <1>  mov ecx, %3
   124                              <1>  %if %0 = 4
   125                              <1>  mov edx, %4
   126                              <1>  %endif
   127                              <1>  %endif
   128                              <1>  %endif
   129 00006EDB B820000000          <1>  mov eax, %1
   130                              <1> 
   131 00006EE0 CD40                <1>  int 40h
 10370                                  		; Cancel callback service (for user)
 10371                                  		sys	_audio, 0900h
   116                              <1> 
   117                              <1> 
   118                              <1> 
   119                              <1> 
   120                              <1>  %if %0 >= 2
   121 00006EE2 BB00090000          <1>  mov ebx, %2
   122                              <1>  %if %0 >= 3
   123                              <1>  mov ecx, %3
   124                              <1>  %if %0 = 4
   125                              <1>  mov edx, %4
   126                              <1>  %endif
   127                              <1>  %endif
   128                              <1>  %endif
   129 00006EE7 B820000000          <1>  mov eax, %1
   130                              <1> 
   131 00006EEC CD40                <1>  int 40h
 10372                                  		; Deallocate audio buffer (for user)
 10373                                  		sys	_audio, 0A00h
   116                              <1> 
   117                              <1> 
   118                              <1> 
   119                              <1> 
   120                              <1>  %if %0 >= 2
   121 00006EEE BB000A0000          <1>  mov ebx, %2
   122                              <1>  %if %0 >= 3
   123                              <1>  mov ecx, %3
   124                              <1>  %if %0 = 4
   125                              <1>  mov edx, %4
   126                              <1>  %endif
   127                              <1>  %endif
   128                              <1>  %endif
   129 00006EF3 B820000000          <1>  mov eax, %1
   130                              <1> 
   131 00006EF8 CD40                <1>  int 40h
 10374                                  		; Disable audio device
 10375                                  		sys	_audio, 0C00h
   116                              <1> 
   117                              <1> 
   118                              <1> 
   119                              <1> 
   120                              <1>  %if %0 >= 2
   121 00006EFA BB000C0000          <1>  mov ebx, %2
   122                              <1>  %if %0 >= 3
   123                              <1>  mov ecx, %3
   124                              <1>  %if %0 = 4
   125                              <1>  mov edx, %4
   126                              <1>  %endif
   127                              <1>  %endif
   128                              <1>  %endif
   129 00006EFF B820000000          <1>  mov eax, %1
   130                              <1> 
   131 00006F04 CD40                <1>  int 40h
 10376 00006F06 C3                      		retn
 10377                                  
 10378                                  .getchar:
 10379                                  		; TRDOS 386 system call
 10380                                  		; sysstdio
 10381                                  		; BL = 1 -> read a character on stdin (no wait)
 10382                                  		sys	_stdio, 1
   116                              <1> 
   117                              <1> 
   118                              <1> 
   119                              <1> 
   120                              <1>  %if %0 >= 2
   121 00006F07 BB01000000          <1>  mov ebx, %2
   122                              <1>  %if %0 >= 3
   123                              <1>  mov ecx, %3
   124                              <1>  %if %0 = 4
   125                              <1>  mov edx, %4
   126                              <1>  %endif
   127                              <1>  %endif
   128                              <1>  %endif
   129 00006F0C B82E000000          <1>  mov eax, %1
   130                              <1> 
   131 00006F11 CD40                <1>  int 40h
 10383 00006F13 21C0                    		and	eax, eax
 10384 00006F15 748A                    		jz	short .playback_next
 10385                                  
 10386 00006F17 3C2B                    		cmp	al, '+' ; increase sound volume
 10387 00006F19 741B                    		je	short .inc_volume
 10388 00006F1B 3C2D                    		cmp	al, '-'
 10389 00006F1D 7441                    		je	short .dec_volume
 10390                                  
 10391                                  		;;;
 10392                                  		; 10/01/2025
 10393                                  		;cmp	ah, 01h
 10394 00006F1F 3C1B                    		cmp	al, 1Bh	; ESC
 10395 00006F21 74A9                    		je	short .playback_end
 10396                                  		;cmp	ax, 2E03h
 10397 00006F23 3C03                    		cmp	al, 03h	; CTRL+C
 10398 00006F25 74A5                    		je	short .playback_end
 10399                                  		;;;
 10400                                  		; 12/01/2025
 10401 00006F27 24DF                    		and	al, 0DFh
 10402 00006F29 3C48                    		cmp	al, 'H'
 10403 00006F2B 7446                    		je	short .hw_info
 10404 00006F2D 3C42                    		cmp	al,'B'
 10405 00006F2F 744C                    		je	short .b_info
 10406 00006F31 E96BFFFFFF              		jmp	.playback_next
 10407                                  
 10408                                  .inc_volume:
 10409 00006F36 8A0D[158B0000]          		mov	cl, [volume_level]
 10410 00006F3C 80F91F                  		cmp	cl, 1Fh ; 31
 10411 00006F3F 0F835CFFFFFF            		jnb	.playback_next
 10412 00006F45 FEC1                    		inc	cl
 10413                                  .chg_volume:
 10414 00006F47 880D[158B0000]          		mov	[volume_level], cl
 10415 00006F4D 88CD                    		mov	ch, cl
 10416                                  		; TRDOS 386 system call
 10417                                  		; sysstdio
 10418                                  		; Set master volume level
 10419                                  		; bh = 11
 10420                                  		; cl = left channel volume (0 to 31 max)
 10421                                  		; ch = right channel volume (0 to 31 max)
 10422                                  		sys	_audio, 0B00h
   116                              <1> 
   117                              <1> 
   118                              <1> 
   119                              <1> 
   120                              <1>  %if %0 >= 2
   121 00006F4F BB000B0000          <1>  mov ebx, %2
   122                              <1>  %if %0 >= 3
   123                              <1>  mov ecx, %3
   124                              <1>  %if %0 = 4
   125                              <1>  mov edx, %4
   126                              <1>  %endif
   127                              <1>  %endif
   128                              <1>  %endif
   129 00006F54 B820000000          <1>  mov eax, %1
   130                              <1> 
   131 00006F59 CD40                <1>  int 40h
 10423 00006F5B E941FFFFFF              		jmp	.playback_next
 10424                                  .dec_volume:
 10425 00006F60 8A0D[158B0000]          		mov	cl, [volume_level]
 10426 00006F66 80F901                  		cmp	cl, 1 ; 1
 10427 00006F69 0F8632FFFFFF            		jna	.playback_next
 10428 00006F6F FEC9                    		dec	cl
 10429 00006F71 EBD4                    		jmp	short .chg_volume
 10430                                  
 10431                                  		; 12/01/2025
 10432                                  .hw_info:
 10433 00006F73 E882000000              		call	write_audio_dev_info
 10434 00006F78 E924FFFFFF              		jmp	.playback_next
 10435                                  		; 12/01/2025
 10436                                  .b_info:
 10437 00006F7D E8ED020000              		call	write_buffer_size
 10438 00006F82 E91AFFFFFF              		jmp	.playback_next
 10439                                  
 10440                                  
 10441                                  ; =============== S U B R O U T I N E =======================================
 10442                                  
 10443                                  		; 12/01/2025
 10444                                  		; 09/01/2025
 10445                                  		; 21/10/2024
 10446                                  try_enqueue_all_blocks:
 10447                                  		; 12/01/2025
 10448 00006F87 60                      		pusha	 	
 10449 00006F88 BF[00300500]             		mov	edi, sample_buffer
 10450                                  		; 10/01/2025
 10451 00006F8D EB15                    		jmp	short .first_block
 10452                                  .next_block:
 10453 00006F8F 833D[842A0500]00                        cmp	dword [bytes_left], 0
 10454 00006F96 7E56                                    jle	short .enqueue_done
 10455                                  		;
 10456 00006F98 8B3D[10F20000]          		mov	edi, [mp3_samples_dst]
 10457 00006F9E 033D[14F20000]          		add	edi, [mp3_samples_output_size]
 10458                                  .first_block:
 10459                                  		;pusha
 10460 00006FA4 8B35[802A0500]          		mov	esi, [stream_pos]
 10461 00006FAA 8B0D[842A0500]          		mov	ecx, [bytes_left]
 10462 00006FB0 31ED                    		xor	ebp, ebp
 10463 00006FB2 E86DF2FFFF              		call	mp3_decode_frame
 10464                                  		;popa
 10465 00006FB7 7235                    		jc	short .enqueue_done
 10466 00006FB9 A1[249B0000]            		mov	eax, [mp3_src_frame_size]
 10467 00006FBE 83F800                  		cmp	eax, 0
 10468 00006FC1 742B                    		jz	short .enqueue_done
 10469 00006FC3 0105[802A0500]          		add	[stream_pos], eax
 10470 00006FC9 2905[842A0500]          		sub	[bytes_left], eax
 10471 00006FCF A1[14F20000]            		mov	eax, [mp3_samples_output_size]
 10472 00006FD4 83F800                  		cmp	eax, 0
 10473 00006FD7 74B6                    		jz	short .next_block
 10474                                  .no_error:
 10475 00006FD9 FE05[BC820000]          		inc	byte [num_enqueued_frames]
 10476 00006FDF A0[BC820000]            		mov	al, [num_enqueued_frames]
 10477 00006FE4 3A05[168B0000]          		cmp	al, [blocks]
 10478 00006FEA 72A3                    		jb	short .next_block
 10479                                  .rtn:
 10480                                  		; 12/01/2025
 10481 00006FEC 61                      		popa
 10482 00006FED C3                      		retn
 10483                                  .enqueue_done:
 10484 00006FEE C705[842A0500]0000-                     mov	dword [bytes_left], 0
 10484 00006FF6 0000               
 10485                                  		; 12/01/2025
 10486 00006FF8 EBF2                    		jmp	short .rtn
 10487                                  
 10488                                  
 10489                                  ; ---------------------------------------------------------------------------
 10490                                  ; 12/01/2025- Hardware Info display/write procedures.
 10491                                  ; ---------------------------------------------------------------------------
 10492                                  ; ref: playwav9.s (18/12/2024) - sb16play.s (20/12/2024)
 10493                                  
 10494                                  	; 12/01/2025
 10495                                  write_audio_dev_info:
 10496 00006FFA 803D[108B0000]02        	cmp	byte [audio_hardware], 2
 10497 00007001 7203                    	jb	short write_sb16_dev_info  ; SB16
 10498 00007003 745A                    	je	short write_ac97_pci_dev_info ; AC97
 10499 00007005 C3                      	retn
 10500                                  
 10501                                  	; 20/12/2024 (playwavx.s, sb16play.s)
 10502                                  write_sb16_dev_info:
 10503                                  	; 27/11/2024
 10504                                  	; 24/11/2024 (sb16play.asm)
 10505                                  
 10506 00007006 A1[088B0000]            	mov	eax, [audio_io_base]
 10507 0000700B 31DB                    	xor	ebx, ebx
 10508 0000700D 88C3                    	mov	bl, al
 10509 0000700F 88DA                    	mov	dl, bl
 10510 00007011 80E30F                  	and	bl, 0Fh
 10511 00007014 8A83[BF720000]          	mov	al, [ebx+hex_chars]
 10512 0000701A A2[BD730000]            	mov	[msgBasePort+2], al
 10513 0000701F 88D3                    	mov	bl, dl
 10514 00007021 C0EB04                  	shr	bl, 4
 10515 00007024 8A83[BF720000]          	mov	al, [ebx+hex_chars]
 10516 0000702A A2[BC730000]            	mov	[msgBasePort+1], al
 10517 0000702F 88E3                    	mov	bl, ah
 10518                                  	;and	bl, 0Fh
 10519 00007031 8A83[BF720000]          	mov	al, [ebx+hex_chars]
 10520 00007037 A2[BB730000]            	mov	[msgBasePort], al
 10521                                  
 10522                                  	;xor	eax, eax
 10523                                  	; 27/11/2024
 10524 0000703C A0[0C8B0000]            	mov	al, [audio_intr]
 10525                                  	;mov	cl, 10
 10526                                  	;div	cl
 10527                                  	;add	ah, 30h
 10528                                  	;mov	[msgIRQnum], ah
 10529                                  	; 25/11/2024
 10530 00007041 0430                    	add	al, 30h
 10531 00007043 A2[D2730000]            	mov	[msgIRQnum], al	; 12/01/2025
 10532                                  
 10533                                  	; 12/01/2025	
 10534                                  	; 20/12/2024
 10535                                  	sys	_msg, msgSB16Info, 255, 07h
   116                              <1> 
   117                              <1> 
   118                              <1> 
   119                              <1> 
   120                              <1>  %if %0 >= 2
   121 00007048 BB[85730000]        <1>  mov ebx, %2
   122                              <1>  %if %0 >= 3
   123 0000704D B9FF000000          <1>  mov ecx, %3
   124                              <1>  %if %0 = 4
   125 00007052 BA07000000          <1>  mov edx, %4
   126                              <1>  %endif
   127                              <1>  %endif
   128                              <1>  %endif
   129 00007057 B823000000          <1>  mov eax, %1
   130                              <1> 
   131 0000705C CD40                <1>  int 40h
 10536                                  
 10537 0000705E C3                      	retn
 10538                                  	
 10539                                  write_ac97_pci_dev_info:
 10540                                  	; 19/11/2024
 10541                                  	; 30/05/2024
 10542                                  	; 06/06/2017
 10543                                  	; 03/06/2017
 10544                                  	; BUS/DEV/FN
 10545                                  	;	00000000BBBBBBBBDDDDDFFF00000000
 10546                                  	; DEV/VENDOR
 10547                                  	;	DDDDDDDDDDDDDDDDVVVVVVVVVVVVVVVV
 10548                                  
 10549 0000705F A1[008B0000]            	mov	eax, [dev_vendor]
 10550 00007064 31DB                    	xor	ebx, ebx
 10551 00007066 88C3                    	mov	bl, al
 10552 00007068 88DA                    	mov	dl, bl
 10553 0000706A 80E30F                  	and	bl, 0Fh
 10554 0000706D 8A83[BF720000]          	mov	al, [ebx+hex_chars]
 10555 00007073 A2[06730000]            	mov	[msgVendorId+3], al
 10556 00007078 88D3                    	mov	bl, dl
 10557 0000707A C0EB04                  	shr	bl, 4
 10558 0000707D 8A83[BF720000]          	mov	al, [ebx+hex_chars]
 10559 00007083 A2[05730000]            	mov	[msgVendorId+2], al
 10560 00007088 88E3                    	mov	bl, ah
 10561 0000708A 88DA                    	mov	dl, bl
 10562 0000708C 80E30F                  	and	bl, 0Fh
 10563 0000708F 8A83[BF720000]          	mov	al, [ebx+hex_chars]
 10564 00007095 A2[04730000]            	mov	[msgVendorId+1], al
 10565 0000709A 88D3                    	mov	bl, dl
 10566 0000709C C0EB04                  	shr	bl, 4
 10567 0000709F 8A83[BF720000]          	mov	al, [ebx+hex_chars]
 10568 000070A5 A2[03730000]            	mov	[msgVendorId], al
 10569 000070AA C1E810                  	shr	eax, 16
 10570 000070AD 88C3                    	mov	bl, al
 10571 000070AF 88DA                    	mov	dl, bl
 10572 000070B1 80E30F                  	and	bl, 0Fh
 10573 000070B4 8A83[BF720000]          	mov	al, [ebx+hex_chars]
 10574 000070BA A2[17730000]            	mov	[msgDevId+3], al
 10575 000070BF 88D3                    	mov	bl, dl
 10576 000070C1 C0EB04                  	shr	bl, 4
 10577 000070C4 8A83[BF720000]          	mov	al, [ebx+hex_chars]
 10578 000070CA A2[16730000]            	mov	[msgDevId+2], al
 10579 000070CF 88E3                    	mov	bl, ah
 10580 000070D1 88DA                    	mov	dl, bl
 10581 000070D3 80E30F                  	and	bl, 0Fh
 10582 000070D6 8A83[BF720000]          	mov	al, [ebx+hex_chars]
 10583 000070DC A2[15730000]            	mov	[msgDevId+1], al
 10584 000070E1 88D3                    	mov	bl, dl
 10585 000070E3 C0EB04                  	shr	bl, 4
 10586 000070E6 8A83[BF720000]          	mov	al, [ebx+hex_chars]
 10587 000070EC A2[14730000]            	mov	[msgDevId], al
 10588                                  
 10589 000070F1 A1[FC8A0000]            	mov	eax, [bus_dev_fn]
 10590 000070F6 C1E808                  	shr	eax, 8
 10591 000070F9 88C3                    	mov	bl, al
 10592 000070FB 88DA                    	mov	dl, bl
 10593 000070FD 80E307                  	and	bl, 7 ; bit 0,1,2
 10594 00007100 8A83[BF720000]          	mov	al, [ebx+hex_chars]
 10595 00007106 A2[3C730000]            	mov	[msgFncNo+1], al
 10596 0000710B 88D3                    	mov	bl, dl
 10597 0000710D C0EB03                  	shr	bl, 3
 10598 00007110 88DA                    	mov	dl, bl
 10599 00007112 80E30F                  	and	bl, 0Fh
 10600 00007115 8A83[BF720000]          	mov	al, [ebx+hex_chars]
 10601 0000711B A2[2E730000]            	mov	[msgDevNo+1], al
 10602 00007120 88D3                    	mov	bl, dl
 10603 00007122 C0EB04                  	shr	bl, 4
 10604 00007125 8A83[BF720000]          	mov	al, [ebx+hex_chars]
 10605 0000712B A2[2D730000]            	mov	[msgDevNo], al
 10606 00007130 88E3                    	mov	bl, ah
 10607 00007132 88DA                    	mov	dl, bl
 10608 00007134 80E30F                  	and	bl, 0Fh
 10609 00007137 8A83[BF720000]          	mov	al, [ebx+hex_chars]
 10610 0000713D A2[22730000]            	mov	[msgBusNo+1], al
 10611 00007142 88D3                    	mov	bl, dl
 10612 00007144 C0EB04                  	shr	bl, 4
 10613 00007147 8A83[BF720000]          	mov	al, [ebx+hex_chars]
 10614 0000714D A2[21730000]            	mov	[msgBusNo], al
 10615                                  
 10616                                  	;mov	ax, [ac97_NamBar]
 10617 00007152 66A1[048B0000]          	mov	ax, [NAMBAR]
 10618 00007158 88C3                    	mov	bl, al
 10619 0000715A 88DA                    	mov	dl, bl
 10620 0000715C 80E30F                  	and	bl, 0Fh
 10621 0000715F 8A83[BF720000]          	mov	al, [ebx+hex_chars]
 10622 00007165 A2[4C730000]            	mov	[msgNamBar+3], al
 10623 0000716A 88D3                    	mov	bl, dl
 10624 0000716C C0EB04                  	shr	bl, 4
 10625 0000716F 8A83[BF720000]          	mov	al, [ebx+hex_chars]
 10626 00007175 A2[4B730000]            	mov	[msgNamBar+2], al
 10627 0000717A 88E3                    	mov	bl, ah
 10628 0000717C 88DA                    	mov	dl, bl
 10629 0000717E 80E30F                  	and	bl, 0Fh
 10630 00007181 8A83[BF720000]          	mov	al, [ebx+hex_chars]
 10631 00007187 A2[4A730000]            	mov	[msgNamBar+1], al
 10632 0000718C 88D3                    	mov	bl, dl
 10633 0000718E C0EB04                  	shr	bl, 4
 10634 00007191 8A83[BF720000]          	mov	al, [ebx+hex_chars]
 10635 00007197 A2[49730000]            	mov	[msgNamBar], al
 10636                                  
 10637                                  	;mov	ax, [ac97_NabmBar]
 10638 0000719C 66A1[068B0000]          	mov	ax, [NABMBAR]
 10639 000071A2 88C3                    	mov	bl, al
 10640 000071A4 88DA                    	mov	dl, bl
 10641 000071A6 80E30F                  	and	bl, 0Fh
 10642 000071A9 8A83[BF720000]          	mov	al, [ebx+hex_chars]
 10643 000071AF A2[5C730000]            	mov	[msgNabmBar+3], al
 10644 000071B4 88D3                    	mov	bl, dl
 10645 000071B6 C0EB04                  	shr	bl, 4
 10646 000071B9 8A83[BF720000]          	mov	al, [ebx+hex_chars]
 10647 000071BF A2[5B730000]            	mov	[msgNabmBar+2], al
 10648 000071C4 88E3                    	mov	bl, ah
 10649 000071C6 88DA                    	mov	dl, bl
 10650 000071C8 80E30F                  	and	bl, 0Fh
 10651 000071CB 8A83[BF720000]          	mov	al, [ebx+hex_chars]
 10652 000071D1 A2[5A730000]            	mov	[msgNabmBar+1], al
 10653 000071D6 88D3                    	mov	bl, dl
 10654 000071D8 C0EB04                  	shr	bl, 4
 10655 000071DB 8A83[BF720000]          	mov	al, [ebx+hex_chars]
 10656 000071E1 A2[59730000]            	mov	[msgNabmBar], al
 10657                                  
 10658 000071E6 31C0                    	xor	eax, eax
 10659 000071E8 A0[0C8B0000]            	mov	al, [ac97_int_ln_reg]
 10660 000071ED B10A                    	mov	cl, 10
 10661 000071EF F6F1                    	div	cl
 10662                                  	; 23/11/2024
 10663                                  	;add	[msgIRQ], ax
 10664 000071F1 66053030                	add	ax, 3030h
 10665 000071F5 66A3[65730000]          	mov	[msgIRQ], ax
 10666                                  	;and	al, al
 10667 000071FB 3C30                    	cmp	al, 30h
 10668 000071FD 750D                    	jnz	short _w_ac97imsg_
 10669 000071FF A0[66730000]            	mov	al, byte [msgIRQ+1]
 10670 00007204 B420                    	mov	ah, ' '
 10671 00007206 66A3[65730000]          	mov	[msgIRQ], ax
 10672                                  _w_ac97imsg_:
 10673                                  	; 12/01/2025
 10674                                  	; 01/12/2024
 10675                                  	sys	_msg, msgAC97Info, 255, 07h
   116                              <1> 
   117                              <1> 
   118                              <1> 
   119                              <1> 
   120                              <1>  %if %0 >= 2
   121 0000720C BB[D0720000]        <1>  mov ebx, %2
   122                              <1>  %if %0 >= 3
   123 00007211 B9FF000000          <1>  mov ecx, %3
   124                              <1>  %if %0 = 4
   125 00007216 BA07000000          <1>  mov edx, %4
   126                              <1>  %endif
   127                              <1>  %endif
   128                              <1>  %endif
   129 0000721B B823000000          <1>  mov eax, %1
   130                              <1> 
   131 00007220 CD40                <1>  int 40h
 10676                                  
 10677                                  	; 19/11/2024
 10678                                          ;retn
 10679                                  
 10680                                  	; 30/05/2024
 10681                                  write_VRA_info:
 10682                                  	; 12/01/2025
 10683                                  	; 01/12/2024
 10684                                  	sys	_msg, msgVRAheader, 255, 07h
   116                              <1> 
   117                              <1> 
   118                              <1> 
   119                              <1> 
   120                              <1>  %if %0 >= 2
   121 00007222 BB[6A730000]        <1>  mov ebx, %2
   122                              <1>  %if %0 >= 3
   123 00007227 B9FF000000          <1>  mov ecx, %3
   124                              <1>  %if %0 = 4
   125 0000722C BA07000000          <1>  mov edx, %4
   126                              <1>  %endif
   127                              <1>  %endif
   128                              <1>  %endif
   129 00007231 B823000000          <1>  mov eax, %1
   130                              <1> 
   131 00007236 CD40                <1>  int 40h
 10685 00007238 803D[118B0000]00        	cmp	byte [vra], 0
 10686 0000723F 7617                    	jna	short _w_VRAi_no
 10687                                  _w_VRAi_yes:
 10688                                  	sys	_msg, msgVRAyes, 255, 07h
   116                              <1> 
   117                              <1> 
   118                              <1> 
   119                              <1> 
   120                              <1>  %if %0 >= 2
   121 00007241 BB[79730000]        <1>  mov ebx, %2
   122                              <1>  %if %0 >= 3
   123 00007246 B9FF000000          <1>  mov ecx, %3
   124                              <1>  %if %0 = 4
   125 0000724B BA07000000          <1>  mov edx, %4
   126                              <1>  %endif
   127                              <1>  %endif
   128                              <1>  %endif
   129 00007250 B823000000          <1>  mov eax, %1
   130                              <1> 
   131 00007255 CD40                <1>  int 40h
 10689 00007257 C3                      	retn
 10690                                  _w_VRAi_no:
 10691                                  	sys	_msg, msgVRAno, 255, 07h
   116                              <1> 
   117                              <1> 
   118                              <1> 
   119                              <1> 
   120                              <1>  %if %0 >= 2
   121 00007258 BB[7F730000]        <1>  mov ebx, %2
   122                              <1>  %if %0 >= 3
   123 0000725D B9FF000000          <1>  mov ecx, %3
   124                              <1>  %if %0 = 4
   125 00007262 BA07000000          <1>  mov edx, %4
   126                              <1>  %endif
   127                              <1>  %endif
   128                              <1>  %endif
   129 00007267 B823000000          <1>  mov eax, %1
   130                              <1> 
   131 0000726C CD40                <1>  int 40h
 10692                                  
 10693 0000726E C3                      	retn
 10694                                  
 10695                                  ; ---------------------------------------------------------------------------
 10696                                  
 10697                                  	; 12/01/2025
 10698                                  write_buffer_size:
 10699                                  	;;;	
 10700 0000726F A0[168B0000]            	mov	al, [blocks]	; (must be less than 10) 
 10701 00007274 0430                    	add	al, '0'
 10702 00007276 A2[B2720000]            	mov	byte [blocks_txt], al
 10703                                  	;;;
 10704 0000727B BA[9A720000]            	mov	edx, buffersize_txt
 10705 00007280 E829F3FFFF              	call	wrstr_edx
 10706 00007285 A1[188B0000]            	mov	eax, [buffer_size]	
 10707 0000728A E855F3FFFF              	call	wr_decimal_eax_with_thousands_seperator
 10708 0000728F BA[AA720000]            	mov	edx, bytes_txt
 10709 00007294 E815F3FFFF              	call	wrstr_edx
 10710 00007299 C3                      	retn
 10711                                  
 10712                                  ; 11/01/2025
 10713 0000729A 0D0A                    buffersize_txt	db 0Dh, 0Ah
 10714 0000729C 427566666572205369-     		db 'Buffer Size: ', 0
 10714 000072A5 7A653A2000         
 10715                                  ; 12/01/2025
 10716                                  ;bytes_txt:	db ' bytes ', 0Dh, 0Ah, 0
 10717 000072AA 2062797465732028        bytes_txt:	db ' bytes ('
 10718 000072B2 3020626C6F636B7329-     blocks_txt	db '0 blocks) ', 0Dh, 0Ah, 0
 10718 000072BB 200D0A00           
 10719                                  
 10720                                  ; ---------------------------------------------------------------------------
 10721                                  
 10722                                  ; 19/11/2024
 10723                                  ; 03/06/2017
 10724 000072BF 303132333435363738-     hex_chars	db "0123456789ABCDEF", 0
 10724 000072C8 3941424344454600   
 10725 000072D0 0D0A                    msgAC97Info	db 0Dh, 0Ah
 10726 000072D2 204143393720417564-     		db " AC97 Audio Controller & Codec Info", 0Dh, 0Ah
 10726 000072DB 696F20436F6E74726F-
 10726 000072E4 6C6C6572202620436F-
 10726 000072ED 64656320496E666F0D-
 10726 000072F6 0A                 
 10727 000072F7 2056656E646F722049-     		db " Vendor ID: "
 10727 00007300 443A20             
 10728 00007303 303030306820446576-     msgVendorId	db "0000h Device ID: "
 10728 0000730C 6963652049443A20   
 10729 00007314 30303030680D0A          msgDevId	db "0000h", 0Dh, 0Ah
 10730 0000731B 204275733A20            		db " Bus: "
 10731 00007321 303068204465766963-     msgBusNo	db "00h Device: "
 10731 0000732A 653A20             
 10732 0000732D 3030682046756E6374-     msgDevNo	db "00h Function: "
 10732 00007336 696F6E3A20         
 10733 0000733B 303068                  msgFncNo	db "00h"
 10734 0000733E 0D0A                    		db 0Dh, 0Ah
 10735 00007340 204E414D4241523A20      		db " NAMBAR: "
 10736 00007349 30303030682020          msgNamBar	db "0000h  "
 10737 00007350 4E41424D4241523A20      		db "NABMBAR: "
 10738 00007359 303030306820204952-     msgNabmBar	db "0000h  IRQ: "
 10738 00007362 513A20             
 10739 00007365 3030                    msgIRQ		dw 3030h
 10740 00007367 0D0A00                  		db 0Dh, 0Ah, 0
 10741                                  ; 25/11/2023
 10742 0000736A 205652412073757070-     msgVRAheader	db " VRA support: "
 10742 00007373 6F72743A20         
 10743 00007378 00                      		db 0	
 10744 00007379 5945530D0A00            msgVRAyes	db "YES", 0Dh, 0Ah, 0
 10745 0000737F 4E4F200D0A              msgVRAno	db "NO ", 0Dh, 0Ah
 10746                                  		; 12/01/2025
 10747                                  		;db " (Interpolated sample rate playing method)"
 10748 00007384 00                      		db 0
 10749                                  		;db 0Dh, 0Ah, 0
 10750                                  
 10751                                  ; ----------------------------------
 10752                                  
 10753                                  ; 24/11/2024
 10754 00007385 0D0A                    msgSB16Info	db 0Dh, 0Ah
 10755 00007387 20417564696F204861-     		db " Audio Hardware: Sound Blaster 16", 0Dh, 0Ah 
 10755 00007390 7264776172653A2053-
 10755 00007399 6F756E6420426C6173-
 10755 000073A2 7465722031360D0A   
 10756 000073AA 202020202020426173-     		db "      Base Port: "
 10756 000073B3 6520506F72743A20   
 10757 000073BB 303030680D0A            msgBasePort	db "000h", 0Dh, 0Ah 
 10758 000073C1 202020202020202020-     		db "            IRQ: "
 10758 000073CA 2020204952513A20   
 10759 000073D2 30                      msgIRQnum	db 30h		; 12/01/2025
 10760 000073D3 0D0A00                  		db 0Dh, 0Ah, 0
 10761                                  
 10762                                  ; ===========================================================================
 10763                                  ; end of TRDOS 386 specific procedures.
 10764                                  ; ---------------------------------------------------------------------------
 10765                                  
 10766                                  ; ===========================================================================
 10767                                  ; Initialized DATA
 10768                                  ; ===========================================================================
 10769                                  
 10770 000073D6 00                      option_test     db 0                   
 10771 000073D7 00                      option_mono     db 0                   
 10772 000073D8 00                      option_8bit     db 0                   
 10773 000073D9 00                      option_rate_shift db 0                 
 10774 000073DA 00                      option_fast     db 0                   
 10775 000073DB 90                                      align 4
 10776 000073DC 00000000                cpuid_flags     dd 0                   
 10777 000073E0 00                      cpuid_exists    db 0                   
 10778 000073E1 00                      detected_cpu    db 0                   
 10779 000073E2 90<rep 2h>                              align 4
 10780 000073E4 00000000                mp3_output_milliseconds dd 0           
 10781 000073E8 00000000                millisecond_count dd 0
 10782                                  
 10783                                  ; 20/10/2024                 
 10784                                  ; HANDLE hProcess
 10785                                  ;hProcess       dd 0                   
 10786                                  ; HANDLE hThread
 10787                                  ;hThread        dd 0                   
 10788                                  ; DWORD dwPriorityClass
 10789                                  ;dwPriorityClass dd 0                   
 10790                                  ; int nPriority
 10791                                  ;nPriority      dd 0
 10792                                                     
 10793 000073EC 0000000000000000        ttt             dd 2 dup(0)            
 10794 000073F4 726561642068656164-     rdtsc_read_header db 'read header    ',0
 10794 000073FD 65722020202000     
 10795 00007404 0000000000000000        rdtsc_read_header_extra dd  0, 0       
 10796 0000740C 726561642065787472-                     db 'read extra     ',0
 10796 00007415 61202020202000     
 10797 0000741C 0000000000000000        rdtsc_read_granule dd 0, 0             
 10798 00007424 72656164206772616E-                     db 'read granule   ',0
 10798 0000742D 756C6520202000     
 10799 00007434 0000000000000000        rdtsc_append_main dd 2 dup(0)          
 10800 0000743C 617070656E64206D61-                     db 'append main    ',0
 10800 00007445 696E2020202000     
 10801 0000744C 0000000000000000        rdtsc_read_scalefac dd 2 dup(0)        
 10802 00007454 72656164207363616C-                     db 'read scalefac  ',0
 10802 0000745D 65666163202000     
 10803 00007464 0000000000000000        rdtsc_xlat_scalefac dd 2 dup(0)        
 10804 0000746C 786C6174207363616C-                     db 'xlat scalefac  ',0
 10804 00007475 65666163202000     
 10805 0000747C 0000000000000000        rdtsc_read_huffman dd 2 dup(0)         
 10806 00007484 726561642068756666-                     db 'read huffman   ',0
 10806 0000748D 6D616E20202000     
 10807 00007494 0000000000000000        rdtsc_ms_stereo dd 2 dup(0)            
 10808 0000749C 6D732073746572656F-                     db 'ms stereo      ',0
 10808 000074A5 20202020202000     
 10809 000074AC 0000000000000000        rdtsc_i_stereo  dd 2 dup(0)            
 10810 000074B4 692073746572656F20-                     db 'i stereo       ',0
 10810 000074BD 20202020202000     
 10811 000074C4 0000000000000000        rdtsc_reorder   dd 2 dup(0)            
 10812 000074CC 72656F726465722020-                     db 'reorder        ',0
 10812 000074D5 20202020202000     
 10813 000074DC 0000000000000000        rdtsc_antialias dd 2 dup(0)            
 10814 000074E4 616E7469616C696173-                     db 'antialias      ',0
 10814 000074ED 20202020202000     
 10815 000074F4 0000000000000000        rdtsc_imdct     dd 2 dup(0)            
 10816 000074FC 696D64637420202020-                     db 'imdct          ',0
 10816 00007505 20202020202000     
 10817 0000750C 0000000000000000        rdtsc_imdct36   dd 2 dup(0)            
 10818 00007514 20696D646374333620-                     db ' imdct36       ',0
 10818 0000751D 20202020202000     
 10819 00007524 0000000000000000        rdtsc_imdct12   dd 2 dup(0)            
 10820 0000752C 20696D646374313220-                     db ' imdct12       ',0
 10820 00007535 20202020202000     
 10821 0000753C 0000000000000000        rdtsc_imdct0    dd 2 dup(0)            
 10822 00007544 20696D646374302020-                     db ' imdct0        ',0
 10822 0000754D 20202020202000     
 10823 00007554 0000000000000000        rdtsc_synth_dct dd 2 dup(0)            
 10824 0000755C 73796E74682F646374-                     db 'synth/dct      ',0
 10824 00007565 20202020202000     
 10825 0000756C 0000000000000000        rdtsc_dct32     dd 2 dup(0)            
 10826 00007574 2073796E74682E6463-                     db ' synth.dct32   ',0
 10826 0000757D 74333220202000     
 10827 00007584 0000000000000000        rdtsc_synth     dd 2 dup(0)            
 10828 0000758C 2073796E74682E6F75-                     db ' synth.output  ',0
 10828 00007595 74707574202000     
 10829 0000759C 0000000000000000        rdtsc_total     dd 2 dup(0)            
 10830 000075A4 746F74616C20202020-                     db 'total          ',0
 10830 000075AD 20202020202000     
 10831 000075B4 000020002800300038-     mp3_bitrate_tab dw  0,32,40,48,56,64,80,96,112,128,160,192,224,256,320, 0
 10831 000075BD 004000500060007000-
 10831 000075C6 8000A000C000E00000-
 10831 000075CF 0140010000         
 10832 000075D4 000008001000180020-                     dw  0, 8,16,24,32,40,48,56,64,80,96,112,128,144,160, 0
 10832 000075DD 002800300038004000-
 10832 000075E6 500060007000800090-
 10832 000075EF 00A0000000         
 10833 000075F4 44AC80BB007D            mp3_freq_tab    dw 44100,48000,32000   
 10834 000075FA 000504040000            mp3_lsf_sf_expand_init_table db 0, 5, 4, 4, 0, 0
 10835 00007600 9001                                    dw 400                  ; 0..399 ; normal case
 10836 00007602 000504010C00                            db 0, 5, 4, 1, 0Ch, 0
 10837 00007608 F401                                    dw 500                  ; 400..499
 10838 0000760A 000301011801                            db 0, 3, 1, 1, 18h, 1
 10839 00007610 0002                                    dw 512                  ; 500..511
 10840 00007612 010606012400                            db 1, 6, 6, 1, 24h, 0
 10841 00007618 6803                                    dw 872                  ; 512+360 ; 0..359 for 2nd channel of intensity stereo
 10842 0000761A 010404013000                            db 1, 4, 4, 1, 30h, 0
 10843 00007620 E803                                    dw 1000                 ; 512+488 ; 360..487
 10844 00007622 010301013C00                            db 1, 3, 1, 1, 3Ch, 0
 10845 00007628 0004                                    dw 1024                 ; 512+512 ; 488..511
 10846 0000762A 010000000000000000-     mp3_synth_win_src dw      1,     0,     0,     0,     0,     0,     1,     0
 10846 00007633 00000001000000     
 10847 0000763A 000000000100000001-                     dw      0,     0,     1,     0,     1,     0,     1,     0
 10847 00007643 00000001000000     
 10848 0000764A 010001000000010001-                     dw      1,     1,     0,     1,     1,     1,     1,     2
 10848 00007653 00010001000200     
 10849 0000765A 010002000100020002-                     dw      1,     2,     1,     2,     2,     3,     2,     3
 10849 00007663 00030002000300     
 10850 0000766A 020004000300030004-                     dw      2,     4,     3,     3,     4,     4,     4,     5
 10850 00007673 00040004000500     
 10851 0000767A 050005000500060006-                     dw      5,     5,     5,     6,     6,     6,     6,     7
 10851 00007683 00060006000700     
 10852 0000768A 070006000800070007-                     dw      7,     6,     8,     7,     7,     8,     7,     7
 10852 00007693 00080007000700     
 10853 0000769A 080007000700070006-                     dw      8,     7,     7,     7,     6,     6,     6,     5
 10853 000076A3 00060006000500     
 10854 000076AA 51FEFCFFFDFFFEFFFF-                     dw 0FE51h,0FFFCh,0FFFDh,0FFFEh,0FFFFh,     0,     1,     3
 10854 000076B3 FF000001000300     
 10855 000076BA 03000600070008000B-                     dw      3,     6,     7,     8,   0Bh,   0Ch,   0Eh,   11h
 10855 000076C3 000C000E001100     
 10856 000076CA 1300150017001A001C-                     dw    13h,   15h,   17h,   1Ah,   1Ch,   1Fh,   22h,   24h
 10856 000076D3 001F0022002400     
 10857 000076DA 27002A002C002F0032-                     dw    27h,   2Ah,   2Ch,   2Fh,   32h,   35h,   36h,   3Ah
 10857 000076E3 00350036003A00     
 10858 000076EA 3C003E004000420044-                     dw    3Ch,   3Eh,   40h,   42h,   44h,   45h,   47h,   48h
 10858 000076F3 00450047004800     
 10859 000076FA 490049004900490049-                     dw    49h,   49h,   49h,   49h,   49h,   48h,   46h,   45h
 10859 00007703 00480046004500     
 10860 0000770A 430040003D003A0035-                     dw    43h,   40h,   3Dh,   3Ah,   35h,   31h,   2Bh,   27h
 10860 00007713 0031002B002700     
 10861 0000771A 1F00190012000A0002-                     dw    1Fh,   19h,   12h,   0Ah,     2,0FFF9h,0FFEFh,0FFE6h
 10861 00007723 00F9FFEFFFE6FF     
 10862 0000772A 3BF030003B00470053-                     dw 0F03Bh,   30h,   3Bh,   47h,   53h,   5Fh,   6Dh,   79h
 10862 00007733 005F006D007900     
 10863 0000773A 86009500A100B000BD-                     dw    86h,   95h,  0A1h,  0B0h,  0BDh,  0CBh,  0D9h,  0E6h
 10863 00007743 00CB00D900E600     
 10864 0000774A F30001010D01190125-                     dw   0F3h,  101h,  10Dh,  119h,  125h,  130h,  13Ah,  144h
 10864 00007753 0130013A014401     
 10865 0000775A 4D0155015B01620166-                     dw   14Dh,  155h,  15Bh,  162h,  166h,  16Ah,  16Bh,  16Dh
 10865 00007763 016A016B016D01     
 10866 0000776A 6C016A01660160015A-                     dw   16Ch,  16Ah,  166h,  160h,  15Ah,  150h,  146h,  139h
 10866 00007773 01500146013901     
 10867 0000777A 2B011A010801F300DD-                     dw   12Bh,  11Ah,  108h,  0F3h,  0DDh,  0C5h,  0A9h,   8Eh
 10867 00007783 00C500A9008E00     
 10868 0000778A 6F004E002B000700E1-                     dw    6Fh,   4Eh,   2Bh,     7,0FFE1h,0FFB8h,0FF8Fh,0FF62h
 10868 00007793 FFB8FF8FFF62FF     
 10869 0000779A 35FF06FFD5FEA4FE70-                     dw 0FF35h,0FF06h,0FED5h,0FEA4h,0FE70h,0FE3Ch,0FE06h,0FDD0h
 10869 000077A3 FE3CFE06FED0FD     
 10870 000077AA 0BCF9F02D702110349-                     dw 0CF0Bh,  29Fh,  2D7h,  311h,  349h,  382h,  3BBh,  3F4h
 10870 000077B3 038203BB03F403     
 10871 000077BA 2C0464049A04D10405-                     dw   42Ch,  464h,  49Ah,  4D1h,  505h,  538h,  56Ah,  59Bh
 10871 000077C3 0538056A059B05     
 10872 000077CA C805F505200647066C-                     dw   5C8h,  5F5h,  620h,  647h,  66Ch,  68Fh,  6AFh,  6CCh
 10872 000077D3 068F06AF06CC06     
 10873 000077DA E506FC060F071F072B-                     dw   6E5h,  6FCh,  70Fh,  71Fh,  72Bh,  734h,  739h,  739h
 10873 000077E3 07340739073907     
 10874 000077EA 370730072607170704-                     dw   737h,  730h,  726h,  717h,  704h,  6EDh,  6D3h,  6B4h
 10874 000077F3 07ED06D306B406     
 10875 000077FA 91066C0640061306E1-                     dw   691h,  66Ch,  640h,  613h,  5E1h,  5ABh,  573h,  537h
 10875 00007803 05AB0573053705     
 10876 0000780A F704B4046F042704DB-                     dw   4F7h,  4B4h,  46Fh,  427h,  3DBh,  38Fh,  33Eh,  2EDh
 10876 00007813 038F033E03ED02     
 10877 0000781A 9A024402ED0195013D-                     dw   29Ah,  244h,  1EDh,  195h,  13Dh,  0E2h,   88h,   2Eh
 10877 00007823 01E20088002E00     
 10878 0000782A 00                                      db    0
 10879 0000782B 00                                      db    0
 10880 0000782C 000000010002000303-     mp3_slen_table  dw  0000h, 0100h, 0200h, 0300h, 0003h, 0101h, 0201h, 0301h
 10880 00007835 00010101020103     
 10881 0000783C 020102020203030103-                     dw  0102h, 0202h, 0302h, 0103h, 0203h, 0303h, 0204h, 0304h
 10881 00007845 02030304020403     
 10882 0000784C 060505050909090906-     mp3_lsf_nsf_table dd  05050506h, 09090909h, 09090906h
 10882 00007855 090909             
 10883 00007858 0605070309090C0606-                     dd  03070506h, 060C0909h, 060C0906h
 10883 00007861 090C06             
 10884 00007864 0B0A0000121200000F-                     dd  00000A0Bh, 00001212h, 0000120Fh
 10884 0000786D 120000             
 10885 00007870 070707000C0C0C0006-                     dd  00070707h, 000C0C0Ch, 000C0F06h
 10885 00007879 0F0C00             
 10886 0000787C 060606030C09090606-                     dd  03060606h, 0609090Ch, 06090C06h
 10886 00007885 0C0906             
 10887 00007888 080805000F0C090006-                     dd  00050808h, 00090C0Fh, 00091206h
 10887 00007891 120900             
 10888 00007894 1101100022021221        huff_tree_list_data db  11h,   1, 10h,   0, 22h,   2, 12h, 21h
 10889 0000789C 2011011000220212                        db  20h, 11h,   1, 10h,   0, 22h,   2, 12h
 10890 000078A4 2120101101003323                        db  21h, 20h, 10h, 11h,   1,   0, 33h, 23h
 10891 000078AC 3231130330221221                        db  32h, 31h, 13h,   3, 30h, 22h, 12h, 21h
 10892 000078B4 0220110110003303                        db    2, 20h, 11h,   1, 10h,   0, 33h,   3
 10893 000078BC 2332301331220212                        db  23h, 32h, 30h, 13h, 31h, 22h,   2, 12h
 10894 000078C4 2120011110005545                        db  21h, 20h,   1, 11h, 10h,   0, 55h, 45h
 10895 000078CC 5453354425521551                        db  54h, 53h, 35h, 44h, 25h, 52h, 15h, 51h
 10896 000078D4 0534504333244214                        db    5, 34h, 50h, 43h, 33h, 24h, 42h, 14h
 10897 000078DC 4140042332031331                        db  41h, 40h,   4, 23h, 32h,   3, 13h, 31h
 10898 000078E4 3022122102201101                        db  30h, 22h, 12h, 21h,   2, 20h, 11h,   1
 10899 000078EC 1000555445533544                        db  10h,   0, 55h, 54h, 45h, 53h, 35h, 44h
 10900 000078F4 2552051551344350                        db  25h, 52h,   5, 15h, 51h, 34h, 43h, 50h
 10901 000078FC 3324421441044023                        db  33h, 24h, 42h, 14h, 41h,   4, 40h, 23h
 10902 00007904 3213310330220220                        db  32h, 13h, 31h,   3, 30h, 22h,   2, 20h
 10903 0000790C 1221110110005545                        db  12h, 21h, 11h,   1, 10h,   0, 55h, 45h
 10904 00007914 3553540544255215                        db  35h, 53h, 54h,   5, 44h, 25h, 52h, 15h
 10905 0000791C 5134435004244233                        db  51h, 34h, 43h, 50h,   4, 24h, 42h, 33h
 10906 00007924 4014412332133103                        db  40h, 14h, 41h, 23h, 32h, 13h, 31h,   3
 10907 0000792C 3022021221201101                        db  30h, 22h,   2, 12h, 21h, 20h, 11h,   1
 10908 00007934 1000776776577566                        db  10h,   0, 77h, 67h, 76h, 57h, 75h, 66h
 10909 0000793C 4774566537734655                        db  47h, 74h, 56h, 65h, 37h, 73h, 46h, 55h
 10910 00007944 5463277264077062                        db  54h, 63h, 27h, 72h, 64h,   7, 70h, 62h
 10911 0000794C 4535065344177136                        db  45h, 35h,   6, 53h, 44h, 17h, 71h, 36h
 10912 00007954 2625521551344316                        db  26h, 25h, 52h, 15h, 51h, 34h, 43h, 16h
 10913 0000795C 6160055024423304                        db  61h, 60h,   5, 50h, 24h, 42h, 33h,   4
 10914 00007964 1441402332031331                        db  14h, 41h, 40h, 23h, 32h,   3, 13h, 31h
 10915 0000796C 3022122102201101                        db  30h, 22h, 12h, 21h,   2, 20h, 11h,   1
 10916 00007974 1000776776756647                        db  10h,   0, 77h, 67h, 76h, 75h, 66h, 47h
 10917 0000797C 7457555665377346                        db  74h, 57h, 55h, 56h, 65h, 37h, 73h, 46h
 10918 00007984 4554355327726407                        db  45h, 54h, 35h, 53h, 27h, 72h, 64h,   7
 10919 0000798C 7117703663604425                        db  71h, 17h, 70h, 36h, 63h, 60h, 44h, 25h
 10920 00007994 5205156226061661                        db  52h,   5, 15h, 62h, 26h,   6, 16h, 61h
 10921 0000799C 5134504333244214                        db  51h, 34h, 50h, 43h, 33h, 24h, 42h, 14h
 10922 000079A4 4104402332133103                        db  41h,   4, 40h, 23h, 32h, 13h, 31h,   3
 10923 000079AC 3022211202201101                        db  30h, 22h, 21h, 12h,   2, 20h, 11h,   1
 10924 000079B4 1000776776577566                        db  10h,   0, 77h, 67h, 76h, 57h, 75h, 66h
 10925 000079BC 4774655637735527                        db  47h, 74h, 65h, 56h, 37h, 73h, 55h, 27h
 10926 000079C4 7246641771077036                        db  72h, 46h, 64h, 17h, 71h,   7, 70h, 36h
 10927 000079CC 6345544406052662                        db  63h, 45h, 54h, 44h,   6,   5, 26h, 62h
 10928 000079D4 6116603553255215                        db  61h, 16h, 60h, 35h, 53h, 25h, 52h, 15h
 10929 000079DC 5134435004244214                        db  51h, 34h, 43h, 50h,   4, 24h, 42h, 14h
 10930 000079E4 3341233240033013                        db  33h, 41h, 23h, 32h, 40h,   3, 30h, 13h
 10931 000079EC 3122122102200011                        db  31h, 22h, 12h, 21h,   2, 20h,   0, 11h
 10932 000079F4 0110FEFCFDEDFFEF                        db    1, 10h,0FEh,0FCh,0FDh,0EDh,0FFh,0EFh
 10933 000079FC DFEECFDEBFFBCEDC                        db 0DFh,0EEh,0CFh,0DEh,0BFh,0FBh,0CEh,0DCh
 10934 00007A04 AFE9ECDDFACDBEEB                        db 0AFh,0E9h,0ECh,0DDh,0FAh,0CDh,0BEh,0EBh
 10935 00007A0C 9FF9EABDDB8FF8CC                        db  9Fh,0F9h,0EAh,0BDh,0DBh, 8Fh,0F8h,0CCh
 10936 00007A14 AE9E8E7F7EF7DAAD                        db 0AEh, 9Eh, 8Eh, 7Fh, 7Eh,0F7h,0DAh,0ADh
 10937 00007A1C BCCBF66FE85F9DD9                        db 0BCh,0CBh,0F6h, 6Fh,0E8h, 5Fh, 9Dh,0D9h
 10938 00007A24 F5E7ACBB4FF4CAE6                        db 0F5h,0E7h,0ACh,0BBh, 4Fh,0F4h,0CAh,0E6h
 10939 00007A2C F33F8DD82FF26E9C                        db 0F3h, 3Fh, 8Dh,0D8h, 2Fh,0F2h, 6Eh, 9Ch
 10940 00007A34 0FC95EAB7DD74EC8                        db  0Fh,0C9h, 5Eh,0ABh, 7Dh,0D7h, 4Eh,0C8h
 10941 00007A3C D63EB99BAA1FF1F0                        db 0D6h, 3Eh,0B9h, 9Bh,0AAh, 1Fh,0F1h,0F0h
 10942 00007A44 BAE5E48C6DE3E22E                        db 0BAh,0E5h,0E4h, 8Ch, 6Dh,0E3h,0E2h, 2Eh
 10943 00007A4C 0E1EE1E05DD57CC7                        db  0Eh, 1Eh,0E1h,0E0h, 5Dh,0D5h, 7Ch,0C7h
 10944 00007A54 4D8BB8D49AA96CC6                        db  4Dh, 8Bh,0B8h,0D4h, 9Ah,0A9h, 6Ch,0C6h
 10945 00007A5C 3DD37B2DD21DB75C                        db  3Dh,0D3h, 7Bh, 2Dh,0D2h, 1Dh,0B7h, 5Ch
 10946 00007A64 C5997AC3A7974BD1                        db 0C5h, 99h, 7Ah,0C3h,0A7h, 97h, 4Bh,0D1h
 10947 00007A6C 0DD08AA84CC46BB6                        db  0Dh,0D0h, 8Ah,0A8h, 4Ch,0C4h, 6Bh,0B6h
 10948 00007A74 3C2CC25BB5891CC1                        db  3Ch, 2Ch,0C2h, 5Bh,0B5h, 89h, 1Ch,0C1h
 10949 00007A7C 980CC0B46AA6793B                        db  98h, 0Ch,0C0h,0B4h, 6Ah,0A6h, 79h, 3Bh
 10950 00007A84 B3885A2BA569A478                        db 0B3h, 88h, 5Ah, 2Bh,0A5h, 69h,0A4h, 78h
 10951 00007A8C 87947776B21BB10B                        db  87h, 94h, 77h, 76h,0B2h, 1Bh,0B1h, 0Bh
 10952 00007A94 B0964A3AA359952A                        db 0B0h, 96h, 4Ah, 3Ah,0A3h, 59h, 95h, 2Ah
 10953 00007A9C A21AA10A68A08649                        db 0A2h, 1Ah,0A1h, 0Ah, 68h,0A0h, 86h, 49h
 10954 00007AA4 9339588567299257                        db  93h, 39h, 58h, 85h, 67h, 29h, 92h, 57h
 10955 00007AAC 7538836647745665                        db  75h, 38h, 83h, 66h, 47h, 74h, 56h, 65h
 10956 00007AB4 7319910990488472                        db  73h, 19h, 91h,   9, 90h, 48h, 84h, 72h
 10957 00007ABC 4664288218372717                        db  46h, 64h, 28h, 82h, 18h, 37h, 27h, 17h
 10958 00007AC4 7155077036634554                        db  71h, 55h,   7, 70h, 36h, 63h, 45h, 54h
 10959 00007ACC 2662358108801661                        db  26h, 62h, 35h, 81h,   8, 80h, 16h, 61h
 10960 00007AD4 0660534425520515                        db    6, 60h, 53h, 44h, 25h, 52h,   5, 15h
 10961 00007ADC 5134435024423314                        db  51h, 34h, 43h, 50h, 24h, 42h, 33h, 14h
 10962 00007AE4 4104402332133103                        db  41h,   4, 40h, 23h, 32h, 13h, 31h,   3
 10963 00007AEC 3022122102201101                        db  30h, 22h, 12h, 21h,   2, 20h, 11h,   1
 10964 00007AF4 1000FFEFFEDFEEFD                        db  10h,   0,0FFh,0EFh,0FEh,0DFh,0EEh,0FDh
 10965 00007AFC CFFCDEEDBFFBCEEC                        db 0CFh,0FCh,0DEh,0EDh,0BFh,0FBh,0CEh,0ECh
 10966 00007B04 DDAFFABEEBCDDC9F                        db 0DDh,0AFh,0FAh,0BEh,0EBh,0CDh,0DCh, 9Fh
 10967 00007B0C F9EABDDB8FF8CC9E                        db 0F9h,0EAh,0BDh,0DBh, 8Fh,0F8h,0CCh, 9Eh
 10968 00007B14 E97FF7ADDABC6FAE                        db 0E9h, 7Fh,0F7h,0ADh,0DAh,0BCh, 6Fh,0AEh
 10969 00007B1C 0FCBF68EE85F9DF5                        db  0Fh,0CBh,0F6h, 8Eh,0E8h, 5Fh, 9Dh,0F5h
 10970 00007B24 7EE7ACCABBD98D4F                        db  7Eh,0E7h,0ACh,0CAh,0BBh,0D9h, 8Dh, 4Fh
 10971 00007B2C F43FF3D8E62FF26E                        db 0F4h, 3Fh,0F3h,0D8h,0E6h, 2Fh,0F2h, 6Eh
 10972 00007B34 F01FF19CC95EABBA                        db 0F0h, 1Fh,0F1h, 9Ch,0C9h, 5Eh,0ABh,0BAh
 10973 00007B3C E57DD74EE48CC83E                        db 0E5h, 7Dh,0D7h, 4Eh,0E4h, 8Ch,0C8h, 3Eh
 10974 00007B44 6DD6E39BB92EAAE2                        db  6Dh,0D6h,0E3h, 9Bh,0B9h, 2Eh,0AAh,0E2h
 10975 00007B4C 1EE10EE05DD57CC7                        db  1Eh,0E1h, 0Eh,0E0h, 5Dh,0D5h, 7Ch,0C7h
 10976 00007B54 4D8BD4B89AA96CC6                        db  4Dh, 8Bh,0D4h,0B8h, 9Ah,0A9h, 6Ch,0C6h
 10977 00007B5C 3DD3D22D0D1D7BB7                        db  3Dh,0D3h,0D2h, 2Dh, 0Dh, 1Dh, 7Bh,0B7h
 10978 00007B64 D15CD0C58AA84CC4                        db 0D1h, 5Ch,0D0h,0C5h, 8Ah,0A8h, 4Ch,0C4h
 10979 00007B6C 6BB6990C3CC37AA7                        db  6Bh,0B6h, 99h, 0Ch, 3Ch,0C3h, 7Ah,0A7h
 10980 00007B74 A6C00BC22C5BB51C                        db 0A6h,0C0h, 0Bh,0C2h, 2Ch, 5Bh,0B5h, 1Ch
 10981 00007B7C 8998C14BB46A3B79                        db  89h, 98h,0C1h, 4Bh,0B4h, 6Ah, 3Bh, 79h
 10982 00007B84 B397882B5AB2A51B                        db 0B3h, 97h, 88h, 2Bh, 5Ah,0B2h,0A5h, 1Bh
 10983 00007B8C B1B069964AA47887                        db 0B1h,0B0h, 69h, 96h, 4Ah,0A4h, 78h, 87h
 10984 00007B94 3AA359952AA21AA1                        db  3Ah,0A3h, 59h, 95h, 2Ah,0A2h, 1Ah,0A1h
 10985 00007B9C 0AA0688649943993                        db  0Ah,0A0h, 68h, 86h, 49h, 94h, 39h, 93h
 10986 00007BA4 7709588529677692                        db  77h,   9, 58h, 85h, 29h, 67h, 76h, 92h
 10987 00007BAC 9119904884577538                        db  91h, 19h, 90h, 48h, 84h, 57h, 75h, 38h
 10988 00007BB4 8366472882188174                        db  83h, 66h, 47h, 28h, 82h, 18h, 81h, 74h
 10989 00007BBC 0880566537734627                        db    8, 80h, 56h, 65h, 37h, 73h, 46h, 27h
 10990 00007BC4 7264175571077036                        db  72h, 64h, 17h, 55h, 71h,   7, 70h, 36h
 10991 00007BCC 6345542662160660                        db  63h, 45h, 54h, 26h, 62h, 16h,   6, 60h
 10992 00007BD4 3561534425521551                        db  35h, 61h, 53h, 44h, 25h, 52h, 15h, 51h
 10993 00007BDC 0550344324423341                        db    5, 50h, 34h, 43h, 24h, 42h, 33h, 41h
 10994 00007BE4 1404233240031331                        db  14h,   4, 23h, 32h, 40h,   3, 13h, 31h
 10995 00007BEC 3022122102201101                        db  30h, 22h, 12h, 21h,   2, 20h, 11h,   1
 10996 00007BF4 1000EFFEDFFDCFFC                        db  10h,   0,0EFh,0FEh,0DFh,0FDh,0CFh,0FCh
 10997 00007BFC BFFBAFFA9FF9F88F                        db 0BFh,0FBh,0AFh,0FAh, 9Fh,0F9h,0F8h, 8Fh
 10998 00007C04 7FF76FF6FF5FF54F                        db  7Fh,0F7h, 6Fh,0F6h,0FFh, 5Fh,0F5h, 4Fh
 10999 00007C0C F4F3F03FCEECDDDE                        db 0F4h,0F3h,0F0h, 3Fh,0CEh,0ECh,0DDh,0DEh
 11000 00007C14 E9EAD9EEEDEBBECD                        db 0E9h,0EAh,0D9h,0EEh,0EDh,0EBh,0BEh,0CDh
 11001 00007C1C DCDBAECCADDA7EAC                        db 0DCh,0DBh,0AEh,0CCh,0ADh,0DAh, 7Eh,0ACh
 11002 00007C24 CAC97D5EBDF22F0F                        db 0CAh,0C9h, 7Dh, 5Eh,0BDh,0F2h, 2Fh, 0Fh
 11003 00007C2C 1FF19EBCCB8EE89D                        db  1Fh,0F1h, 9Eh,0BCh,0CBh, 8Eh,0E8h, 9Dh
 11004 00007C34 E7BB8DD86EE69CAB                        db 0E7h,0BBh, 8Dh,0D8h, 6Eh,0E6h, 9Ch,0ABh
 11005 00007C3C BAE5D74EE48CC83E                        db 0BAh,0E5h,0D7h, 4Eh,0E4h, 8Ch,0C8h, 3Eh
 11006 00007C44 6DD69BB9AAE1D4B8                        db  6Dh,0D6h, 9Bh,0B9h,0AAh,0E1h,0D4h,0B8h
 11007 00007C4C A97BB7D0E30EE05D                        db 0A9h, 7Bh,0B7h,0D0h,0E3h, 0Eh,0E0h, 5Dh
 11008 00007C54 D57CC74D8B9A6CC6                        db 0D5h, 7Ch,0C7h, 4Dh, 8Bh, 9Ah, 6Ch,0C6h
 11009 00007C5C 3D5CC50D8AA8994C                        db  3Dh, 5Ch,0C5h, 0Dh, 8Ah,0A8h, 99h, 4Ch
 11010 00007C64 B67A3C5B891CC098                        db 0B6h, 7Ah, 3Ch, 5Bh, 89h, 1Ch,0C0h, 98h
 11011 00007C6C 79E22E1ED32DD2D1                        db  79h,0E2h, 2Eh, 1Eh,0D3h, 2Dh,0D2h,0D1h
 11012 00007C74 3B97881DC46BC3A7                        db  3Bh, 97h, 88h, 1Dh,0C4h, 6Bh,0C3h,0A7h
 11013 00007C7C 2CC2B5C10C4BB46A                        db  2Ch,0C2h,0B5h,0C1h, 0Ch, 4Bh,0B4h, 6Ah
 11014 00007C84 A6B35AA52BB21BB1                        db 0A6h,0B3h, 5Ah,0A5h, 2Bh,0B2h, 1Bh,0B1h
 11015 00007C8C 0BB069964AA47887                        db  0Bh,0B0h, 69h, 96h, 4Ah,0A4h, 78h, 87h
 11016 00007C94 A33A592A9568A186                        db 0A3h, 3Ah, 59h, 2Ah, 95h, 68h,0A1h, 86h
 11017 00007C9C 7794495767A21A0A                        db  77h, 94h, 49h, 57h, 67h,0A2h, 1Ah, 0Ah
 11018 00007CA4 A039935885299276                        db 0A0h, 39h, 93h, 58h, 85h, 29h, 92h, 76h
 11019 00007CAC 0919919048847538                        db    9, 19h, 91h, 90h, 48h, 84h, 75h, 38h
 11020 00007CB4 8366288247741881                        db  83h, 66h, 28h, 82h, 47h, 74h, 18h, 81h
 11021 00007CBC 8008563773654627                        db  80h,   8, 56h, 37h, 73h, 65h, 46h, 27h
 11022 00007CC4 7264550717717036                        db  72h, 64h, 55h,   7, 17h, 71h, 70h, 36h
 11023 00007CCC 6345542662166106                        db  63h, 45h, 54h, 26h, 62h, 16h, 61h,   6
 11024 00007CD4 6053354425525115                        db  60h, 53h, 35h, 44h, 25h, 52h, 51h, 15h
 11025 00007CDC 0534435024423314                        db    5, 34h, 43h, 50h, 24h, 42h, 33h, 14h
 11026 00007CE4 4104402332133103                        db  41h,   4, 40h, 23h, 32h, 13h, 31h,   3
 11027 00007CEC 3022122102201101                        db  30h, 22h, 12h, 21h,   2, 20h, 11h,   1
 11028 00007CF4 1000EFFEDFFDCFFC                        db  10h,   0,0EFh,0FEh,0DFh,0FDh,0CFh,0FCh
 11029 00007CFC BFFBFAAF9FF9F88F                        db 0BFh,0FBh,0FAh,0AFh, 9Fh,0F9h,0F8h, 8Fh
 11030 00007D04 7FF76FF65FF54FF4                        db  7Fh,0F7h, 6Fh,0F6h, 5Fh,0F5h, 4Fh,0F4h
 11031 00007D0C 3FF32FF2F11FF00F                        db  3Fh,0F3h, 2Fh,0F2h,0F1h, 1Fh,0F0h, 0Fh
 11032 00007D14 EEDEEDCEECDDBEEB                        db 0EEh,0DEh,0EDh,0CEh,0ECh,0DDh,0BEh,0EBh
 11033 00007D1C CDDCAEEABDDBCC9E                        db 0CDh,0DCh,0AEh,0EAh,0BDh,0DBh,0CCh, 9Eh
 11034 00007D24 E9ADDABCCB8EE89D                        db 0E9h,0ADh,0DAh,0BCh,0CBh, 8Eh,0E8h, 9Dh
 11035 00007D2C D97EE7ACFFCABB8D                        db 0D9h, 7Eh,0E7h,0ACh,0FFh,0CAh,0BBh, 8Dh
 11036 00007D34 D80EE00DE66E9CC9                        db 0D8h, 0Eh,0E0h, 0Dh,0E6h, 6Eh, 9Ch,0C9h
 11037 00007D3C 5EBAE5AB7DD7E48C                        db  5Eh,0BAh,0E5h,0ABh, 7Dh,0D7h,0E4h, 8Ch
 11038 00007D44 C84E2E3E6DD6E39B                        db 0C8h, 4Eh, 2Eh, 3Eh, 6Dh,0D6h,0E3h, 9Bh
 11039 00007D4C B9AAE21EE15DD57C                        db 0B9h,0AAh,0E2h, 1Eh,0E1h, 5Dh,0D5h, 7Ch
 11040 00007D54 C74D8BB8D49AA96C                        db 0C7h, 4Dh, 8Bh,0B8h,0D4h, 9Ah,0A9h, 6Ch
 11041 00007D5C C63DD32DD21D7BB7                        db 0C6h, 3Dh,0D3h, 2Dh,0D2h, 1Dh, 7Bh,0B7h
 11042 00007D64 D15CC58AA8994CC4                        db 0D1h, 5Ch,0C5h, 8Ah,0A8h, 99h, 4Ch,0C4h
 11043 00007D6C 6BB6D00C3CC37AA7                        db  6Bh,0B6h,0D0h, 0Ch, 3Ch,0C3h, 7Ah,0A7h
 11044 00007D74 2CC25BB51C8998C1                        db  2Ch,0C2h, 5Bh,0B5h, 1Ch, 89h, 98h,0C1h
 11045 00007D7C 4BC00B3BB00A1AB4                        db  4Bh,0C0h, 0Bh, 3Bh,0B0h, 0Ah, 1Ah,0B4h
 11046 00007D84 6AA67997A00990B3                        db  6Ah,0A6h, 79h, 97h,0A0h,   9, 90h,0B3h
 11047 00007D8C 882B5AB2A51BB169                        db  88h, 2Bh, 5Ah,0B2h,0A5h, 1Bh,0B1h, 69h
 11048 00007D94 96A44A78873AA359                        db  96h,0A4h, 4Ah, 78h, 87h, 3Ah,0A3h, 59h
 11049 00007D9C 952AA2A168867749                        db  95h, 2Ah,0A2h,0A1h, 68h, 86h, 77h, 49h
 11050 00007DA4 9439935885296776                        db  94h, 39h, 93h, 58h, 85h, 29h, 67h, 76h
 11051 00007DAC 9219914884577538                        db  92h, 19h, 91h, 48h, 84h, 57h, 75h, 38h
 11052 00007DB4 8366288218477481                        db  83h, 66h, 28h, 82h, 18h, 47h, 74h, 81h
 11053 00007DBC 0880566517077073                        db    8, 80h, 56h, 65h, 17h,   7, 70h, 73h
 11054 00007DC4 3727724664557136                        db  37h, 27h, 72h, 46h, 64h, 55h, 71h, 36h
 11055 00007DCC 6345542662166106                        db  63h, 45h, 54h, 26h, 62h, 16h, 61h,   6
 11056 00007DD4 6035534425521505                        db  60h, 35h, 53h, 44h, 25h, 52h, 15h,   5
 11057 00007DDC 5051344324423314                        db  50h, 51h, 34h, 43h, 24h, 42h, 33h, 14h
 11058 00007DE4 4104402332133103                        db  41h,   4, 40h, 23h, 32h, 13h, 31h,   3
 11059 00007DEC 3022122102201101                        db  30h, 22h, 12h, 21h,   2, 20h, 11h,   1
 11060 00007DF4 10000B0F0D0E0705                        db  10h,   0, 0Bh, 0Fh, 0Dh, 0Eh,   7,   5
 11061 00007DFC 0906030A0C020104                        db    9,   6,   3, 0Ah, 0Ch,   2,   1,   4
 11062 00007E04 08000F0E0D0C0B0A                        db    8,   0, 0Fh, 0Eh, 0Dh, 0Ch, 0Bh, 0Ah
 11063 00007E0C 0908070605040302                        db    9,   8,   7,   6,   5,   4,   3,   2
 11064 00007E14 0100                                    db    1,   0
 11065 00007E16 000000000000                            db 6 dup(0)
 11066 00007E1C 0000                    mp3_huff_data   db   0,  0             
 11067 00007E1E 0100                                    db   1,  0              ; byte[32][2] ; table,linbits
 11068 00007E20 0200                                    db   2,  0
 11069 00007E22 0300                                    db   3,  0
 11070 00007E24 0000                                    db   0,  0
 11071 00007E26 0400                                    db   4,  0
 11072 00007E28 0500                                    db   5,  0
 11073 00007E2A 0600                                    db   6,  0
 11074 00007E2C 0700                                    db   7,  0
 11075 00007E2E 0800                                    db   8,  0
 11076 00007E30 0900                                    db   9,  0
 11077 00007E32 0A00                                    db  10,  0
 11078 00007E34 0B00                                    db  11,  0
 11079 00007E36 0C00                                    db  12,  0
 11080 00007E38 0000                                    db   0,  0
 11081 00007E3A 0D00                                    db  13,  0
 11082 00007E3C 0E01                                    db  14,  1
 11083 00007E3E 0E02                                    db  14,  2
 11084 00007E40 0E03                                    db  14,  3
 11085 00007E42 0E04                                    db  14,  4
 11086 00007E44 0E06                                    db  14,  6
 11087 00007E46 0E08                                    db  14,  8
 11088 00007E48 0E0A                                    db  14, 10
 11089 00007E4A 0E0D                                    db  14, 13
 11090 00007E4C 0F04                                    db  15,  4
 11091 00007E4E 0F05                                    db  15,  5
 11092 00007E50 0F06                                    db  15,  6
 11093 00007E52 0F07                                    db  15,  7
 11094 00007E54 0F08                                    db  15,  8
 11095 00007E56 0F09                                    db  15,  9
 11096 00007E58 0F0B                                    db  15, 11
 11097 00007E5A 0F0D                                    db  15, 13
 11098 00007E5C 040404040404060608-     mp3_band_size_long db    4,   4,   4,   4,   4,   4,   6,   6,   8,   8, 0Ah
 11098 00007E65 080A               
 11099 00007E67 0C1014181C222A3236-                     db  0Ch, 10h, 14h, 18h, 1Ch, 22h, 2Ah, 32h, 36h, 4Ch, 9Eh ; byte[9][22]
 11099 00007E70 4C9E               
 11100 00007E72 040404040404060606-                     db    4,   4,   4,   4,   4,   4,   6,   6,   6,   8, 0Ah
 11100 00007E7B 080A               
 11101 00007E7D 0C1012161C22282E36-                     db  0Ch, 10h, 12h, 16h, 1Ch, 22h, 28h, 2Eh, 36h, 36h,0C0h
 11101 00007E86 36C0               
 11102 00007E88 040404040404060608-                     db    4,   4,   4,   4,   4,   4,   6,   6,   8, 0Ah, 0Ch
 11102 00007E91 0A0C               
 11103 00007E93 1014181E262E384454-                     db  10h, 14h, 18h, 1Eh, 26h, 2Eh, 38h, 44h, 54h, 66h, 1Ah
 11103 00007E9C 661A               
 11104 00007E9E 060606060606080A0C-                     db    6,   6,   6,   6,   6,   6,   8, 0Ah, 0Ch, 0Eh, 10h
 11104 00007EA7 0E10               
 11105 00007EA9 14181C20262E343C44-                     db  14h, 18h, 1Ch, 20h, 26h, 2Eh, 34h, 3Ch, 44h, 3Ah, 36h
 11105 00007EB2 3A36               
 11106 00007EB4 060606060606080A0C-                     db    6,   6,   6,   6,   6,   6,   8, 0Ah, 0Ch, 0Eh, 10h
 11106 00007EBD 0E10               
 11107 00007EBF 12161A20262E344046-                     db  12h, 16h, 1Ah, 20h, 26h, 2Eh, 34h, 40h, 46h, 4Ch, 24h
 11107 00007EC8 4C24               
 11108 00007ECA 060606060606080A0C-                     db    6,   6,   6,   6,   6,   6,   8, 0Ah, 0Ch, 0Eh, 10h
 11108 00007ED3 0E10               
 11109 00007ED5 14181C20262E343C44-                     db  14h, 18h, 1Ch, 20h, 26h, 2Eh, 34h, 3Ch, 44h, 3Ah, 36h
 11109 00007EDE 3A36               
 11110 00007EE0 060606060606080A0C-                     db    6,   6,   6,   6,   6,   6,   8, 0Ah, 0Ch, 0Eh, 10h
 11110 00007EE9 0E10               
 11111 00007EEB 14181C20262E343C44-                     db  14h, 18h, 1Ch, 20h, 26h, 2Eh, 34h, 3Ch, 44h, 3Ah, 36h
 11111 00007EF4 3A36               
 11112 00007EF6 060606060606080A0C-                     db    6,   6,   6,   6,   6,   6,   8, 0Ah, 0Ch, 0Eh, 10h
 11112 00007EFF 0E10               
 11113 00007F01 14181C20262E343C44-                     db  14h, 18h, 1Ch, 20h, 26h, 2Eh, 34h, 3Ch, 44h, 3Ah, 36h
 11113 00007F0A 3A36               
 11114 00007F0C 0C0C0C0C0C0C101418-                     db  0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 10h, 14h, 18h, 1Ch, 20h
 11114 00007F15 1C20               
 11115 00007F17 283038404C5A020202-                     db  28h, 30h, 38h, 40h, 4Ch, 5Ah,   2,   2,   2,   2,   2
 11115 00007F20 0202               
 11116 00007F22 000000000000000000-                     db 10 dup(0)            ; data align
 11116 00007F2B 00                 
 11117 00007F2C 0404040406080A0C0E-     mp3_band_size_short db    4,   4,   4,   4,   6,   8, 0Ah, 0Ch, 0Eh, 12h, 16h, 1Eh, 38h
 11117 00007F35 12161E38           
 11118 00007F39 0404040406060A0C0E-                     db    4,   4,   4,   4,   6,   6, 0Ah, 0Ch, 0Eh, 10h, 14h, 1Ah, 42h ; byte[9][16] ? ; byte [9][13]
 11118 00007F42 10141A42           
 11119 00007F46 0404040406080C1014-                     db    4,   4,   4,   4,   6,   8, 0Ch, 10h, 14h, 1Ah, 22h, 2Ah, 0Ch
 11119 00007F4F 1A222A0C           
 11120 00007F53 0404040606080A0E12-                     db    4,   4,   4,   6,   6,   8, 0Ah, 0Eh, 12h, 1Ah, 20h, 2Ah, 12h
 11120 00007F5C 1A202A12           
 11121 00007F60 04040406080A0C0E12-                     db    4,   4,   4,   6,   8, 0Ah, 0Ch, 0Eh, 12h, 18h, 20h, 2Ch, 0Ch
 11121 00007F69 18202C0C           
 11122 00007F6D 04040406080A0C0E12-                     db    4,   4,   4,   6,   8, 0Ah, 0Ch, 0Eh, 12h, 18h, 1Eh, 28h, 12h
 11122 00007F76 181E2812           
 11123 00007F7A 04040406080A0C0E12-                     db    4,   4,   4,   6,   8, 0Ah, 0Ch, 0Eh, 12h, 18h, 1Eh, 28h, 12h
 11123 00007F83 181E2812           
 11124 00007F87 04040406080A0C0E12-                     db    4,   4,   4,   6,   8, 0Ah, 0Ch, 0Eh, 12h, 18h, 1Eh, 28h, 12h
 11124 00007F90 181E2812           
 11125 00007F94 0808080C1014181C24-                     db    8,   8,   8, 0Ch, 10h, 14h, 18h, 1Ch, 24h,   2,   2,   2, 1Ah
 11125 00007F9D 0202021A           
 11126 00007FA1 000000000000000000-                     db 11 dup(0)            ; data align
 11126 00007FAA 0000               
 11127 00007FAC 000000000000000000-     mp3_pretab      db    0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0
 11127 00007FB5 0000               
 11128 00007FB7 000000000000000000-                     db    0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0
 11128 00007FC0 0000               
 11129 00007FC2 000000000000000000-                     db    0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0
 11129 00007FCB 0000               
 11130 00007FCD 010101010202030303-                     db    1,   1,   1,   1,   2,   2,   3,   3,   3,   2,   0
 11130 00007FD6 0200               
 11131 00007FD8 00000000                                db 4 dup(0)             ; data align
 11132 00007FDC 4B1D4200028FDB0016-     mp3_mdct_win_src dd  00421D4Bh, 00DB8F02h, 019C7F16h, 029ADCC0h, 04000001h, 06246711h
 11132 00007FE5 7F9C01C0DC9A020100-
 11132 00007FEE 000411672406       
 11133 00007FF4 4506EE090CD6A71238-                     dd  09EE0645h, 12A7D60Ch, 3DF40538h,0BC63D32Fh,0E7B0025Bh,0F069D222h ; these are sine values divided by cosine values...
 11133 00007FFD 05F43D2FD363BC5B02-
 11133 00008006 B0E722D269F0       
 11134 0000800C 567133F467D857F6A8-                     dd 0F4337156h,0F657D867h,0F7BCFBA8h,0F8BB5952h,0F97C4965h,0FA15BB1Ch
 11134 00008015 FBBCF75259BBF86549-
 11134 0000801E 7CF91CBB15FA       
 11135 00008024 936D94FA8E5100FB70-                     dd 0FA946D93h,0FB00518Eh,0FB5EA270h,0FBB2FDEAh,0FC000000h,0FC479F38h
 11135 0000802D A25EFBEAFDB2FB0000-
 11135 00008036 00FC389F47FC       
 11136 0000803C 09668BFC9898CCFC0B-                     dd 0FC8B6609h,0FCCC9898h,0FD0C4F0Bh,0FD4B895Ch,0FD8B3FCFh,0FDCC725Eh
 11136 00008045 4F0CFD5C894BFDCF3F-
 11136 0000804E 8BFD5E72CCFD       
 11137 00008054 2F3910FE67D857FE7D-                     dd 0FE10392Fh,0FE57D867h,0FEA4DA7Dh,0FEF935F7h,0FF5786D9h,0FFC36AD5h
 11137 0000805D DAA4FEF735F9FED986-
 11137 00008066 57FFD56AC3FF       
 11138 0000806C 4B1D4200028FDB0016-                     dd  00421D4Bh, 00DB8F02h, 019C7F16h, 029ADCC0h, 04000001h, 06246711h
 11138 00008075 7F9C01C0DC9A020100-
 11138 0000807E 000411672406       
 11139 00008084 4506EE090CD6A71238-                     dd  09EE0645h, 12A7D60Ch, 3DF40538h,0BC63D32Fh,0E7B0025Bh,0F069D222h
 11139 0000808D 05F43D2FD363BC5B02-
 11139 00008096 B0E722D269F0       
 11140 0000809C 567133F467D857F6A8-                     dd 0F4337156h,0F657D867h,0F7BCFBA8h,0F8BB5952h,0F97C4965h,0FA15BB1Ch
 11140 000080A5 FBBCF75259BBF86549-
 11140 000080AE 7CF91CBB15FA       
 11141 000080B4 291B93FAB946F5FABB-                     dd 0FA931B29h,0FAF546B9h,0FB41DABBh,0FB7D8F97h,0FBABA162h,0FBCE4E62h
 11141 000080BD DA41FB978F7DFB62A1-
 11141 000080C6 ABFB624ECEFB       
 11142 000080CC 671CF0FBAFC845FC0D-                     dd 0FBF01C67h,0FC45C8AFh,0FCD2D50Dh,0FD9008D0h,0FE74C032h,0FF771894h
 11142 000080D5 D5D2FCD00890FD32C0-
 11142 000080DE 74FE941877FF       
 11143 000080E4 000000000000000000-                     dd  00000000h, 00000000h, 00000000h, 00000000h, 00000000h, 00000000h
 11143 000080ED 000000000000000000-
 11143 000080F6 000000000000       
 11144 000080FC 028FDB00010000040C-                     dd  00DB8F02h, 04000001h, 12A7D60Ch,0E7B0025Bh,0F657D867h,0F97C4965h
 11144 00008105 D6A7125B02B0E767D8-
 11144 0000810E 57F665497CF9       
 11145 00008114 8E5100FB000000FC98-                     dd 0FB00518Eh,0FC000000h,0FCCC9898h,0FD8B3FCFh,0FE57D867h,0FF5786D9h
 11145 0000811D 98CCFCCF3F8BFD67D8-
 11145 00008126 57FED98657FF       
 11146 0000812C 000000000000000000-                     dd  00000000h, 00000000h, 00000000h, 00000000h, 00000000h, 00000000h
 11146 00008135 000000000000000000-
 11146 0000813E 000000000000       
 11147 00008144 000000000000000000-                     dd  00000000h, 00000000h, 00000000h, 00000000h, 00000000h, 00000000h
 11147 0000814D 000000000000000000-
 11147 00008156 000000000000       
 11148 0000815C 000000000000000000-                     dd  00000000h, 00000000h, 00000000h, 00000000h, 00000000h, 00000000h
 11148 00008165 000000000000000000-
 11148 0000816E 000000000000       
 11149 00008174 000000000000000000-                     dd  00000000h, 00000000h, 00000000h, 00000000h, 00000000h, 00000000h
 11149 0000817D 000000000000000000-
 11149 00008186 000000000000       
 11150 0000818C 000000000000000000-                     dd  00000000h, 00000000h, 00000000h, 00000000h, 00000000h, 00000000h
 11150 00008195 000000000000000000-
 11150 0000819E 000000000000       
 11151 000081A4 B58869025237BA0B4F-                     dd  026988B5h, 0BBA3752h, 37D3294Fh,0B73F655Bh,0E3B0025Bh,0EDAD5D13h
 11151 000081AD 29D3375B653FB75B02-
 11151 000081B6 B0E3135DADED       
 11152 000081BC A2ADB2F2B8288CF5D6-                     dd 0F2B2ADA2h,0F58C28B8h,0F75657D6h,0F88E2C57h,0F96DE565h,0FA1449CDh
 11152 000081C5 5756F7572C8EF865E5-
 11152 000081CE 6DF9CD4914FA       
 11153 000081D4 936D94FA8E5100FB70-                     dd 0FA946D93h,0FB00518Eh,0FB5EA270h,0FBB2FDEAh,0FC000000h,0FC479F38h
 11153 000081DD A25EFBEAFDB2FB0000-
 11153 000081E6 00FC389F47FC       
 11154 000081EC 09668BFC9898CCFC0B-                     dd 0FC8B6609h,0FCCC9898h,0FD0C4F0Bh,0FD4B895Ch,0FD8B3FCFh,0FDCC725Eh
 11154 000081F5 4F0CFD5C894BFDCF3F-
 11154 000081FE 8BFD5E72CCFD       
 11155 00008204 2F3910FE67D857FE7D-                     dd 0FE10392Fh,0FE57D867h,0FEA4DA7Dh,0FEF935F7h,0FF5786D9h,0FFC36AD5h
 11155 0000820D DAA4FEF735F9FED986-
 11155 00008216 57FFD56AC3FF       
 11156 0000821C 0000000000000040        mp3_is_table_normal dd  00000000h, 40000000h
 11157 00008224 BB58860D46A77932                        dd  0D8658BBh, 3279A746h
 11158 0000822C D1F56C17300A9328                        dd  176CF5D1h, 28930A30h
 11159 00008234 0000002000000020                        dd  20000000h, 20000000h
 11160 0000823C 300A9328D1F56C17                        dd  28930A30h, 176CF5D1h
 11161 00008244 46A77932BB58860D                        dd  3279A746h, 0D8658BBh
 11162 0000824C 0000004000000000                        dd  40000000h, 00000000h
 11163 00008254 00000080                mp3_is_table_lsf_src dd 80000000h      
 11164                                                                          ; sqrt based constants...
 11165                                                                          ; 40000000h*2 ; 2.0  (2^1.00) aka 2
 11166 00008258 667EA26B                                dd 6BA27E66h            ; 35D13F33h*2 ; 1.681 (2^0.75)
 11167 0000825C 9A79825A                                dd 5A82799Ah            ; 2D413CCDh*2 ; 1.414 (2^0.50) aka sqrt(2)
 11168 00008260 2AF81B4C                                dd 4C1BF82Ah            ; 260DFC15h*2 ; 1.189 (2^0.25) aka sqrt(sqrt(2))
 11169 00008264 00000080                mp3_pow2_quarters dd 80000000h         
 11170                                                                          ; 40000000h*2 ; 2^(0/4)
 11171 00008268 52F03798                                dd 9837F052h            ; 4C1BF829h*2 ; 2^(1/4)
 11172 0000826C 34F304B5                                dd 0B504F334h           ; 5A82799Ah*2 ; 2^(2/4)
 11173 00008270 CCFC44D7                                dd 0D744FCCCh           ; 6BA27E66h*2 ; 2^(3/4)
 11174 00008274 00000000                mp3_initialized dd 0                   
 11175 00008278 12000000                mp3_huff_num_entries dd 12h            
 11176 0000827C 00                      wrchr_buf       db 0                   
 11177 0000827D 90<rep 3h>                              align 4
 11178                                  ; LPCSTR mp3_src_fname
 11179 00008280 00000000                mp3_src_fname   dd 0                   
 11180                                  ; LPCSTR mp3_dst_fname
 11181 00008284 00000000                mp3_dst_fname   dd 0                   
 11182                                  ; LPCSTR mp3_pcm_fname
 11183 00008288 00000000                mp3_pcm_fname   dd 0                   
 11184 0000828C 524946462400000057-     mp3_wav_header  db 'RIFF$',0,0,0,'WAVEfmt ',10h,0,0,0,1,0,2,0,0,0,0,0,0,0,0,0,4,0,10h,0,'data',0,0,0,0
 11184 00008295 415645666D74201000-
 11184 0000829E 000001000200000000-
 11184 000082A7 000000000004001000-
 11184 000082B0 6461746100000000   
 11185                                  ; 21/10/2024                   
 11186 000082B8 00000000                zero		dd 0  
 11187 000082BC 00                      num_enqueued_frames db 0
 11188 000082BD 617564696F20647572-     txt_decode_timing1 db 'audio duration ',0
 11188 000082C6 6174696F6E2000     
 11189 000082CD 206D696C6C69736563-     txt_decode_timing2 db ' milliseconds, decoded in ',0
 11189 000082D6 6F6E64732C20646563-
 11189 000082DF 6F64656420696E2000 
 11190 000082E8 206D696C6C69736563-     txt_decode_timing3 db ' milliseconds',0Dh,0Ah,0
 11190 000082F1 6F6E64730D0A00     
 11191 000082F8 20636C6F636B206379-     txt_clks_per_second db ' clock cycles per second:',0Dh,0Ah,0
 11191 00008301 636C65732070657220-
 11191 0000830A 7365636F6E643A0D0A-
 11191 00008313 00                 
 11192 00008314 0303020106060505        huff_tree_list_numbits db    3,   3,   2,   1,   6,   6,   5,   5
 11193 0000831C 0503030301060605                        db    5,   3,   3,   3,   1,   6,   6,   5
 11194 00008324 0505030202020808                        db    5,   5,   3,   2,   2,   2,   8,   8
 11195 0000832C 0706070707070606                        db    7,   6,   7,   7,   7,   7,   6,   6
 11196 00008334 0606030303010707                        db    6,   6,   3,   3,   3,   1,   7,   7
 11197 0000833C 0606060505050504                        db    6,   6,   6,   5,   5,   5,   5,   4
 11198 00008344 0404030203030A0A                        db    4,   4,   3,   2,   3,   3, 0Ah, 0Ah
 11199 0000834C 0A0A090909090808                        db  0Ah, 0Ah,   9,   9,   9,   9,   8,   8
 11200 00008354 0909080909080807                        db    9,   9,   8,   9,   9,   8,   8,   7
 11201 0000835C 0707080808080707                        db    7,   7,   8,   8,   8,   8,   7,   7
 11202 00008364 0707060506060403                        db    7,   7,   6,   5,   6,   6,   4,   3
 11203 0000836C 03010B0B0A090A0A                        db    3,   1, 0Bh, 0Bh, 0Ah,   9, 0Ah, 0Ah
 11204 00008374 0909090808090909                        db    9,   9,   9,   8,   8,   9,   9,   9
 11205 0000837C 0908080807080808                        db    9,   8,   8,   8,   7,   8,   8,   8
 11206 00008384 0808080808060606                        db    8,   8,   8,   8,   8,   6,   6,   6
 11207 0000838C 0404020303020909                        db    4,   4,   2,   3,   3,   2,   9,   9
 11208 00008394 0808090908080808                        db    8,   8,   9,   9,   8,   8,   8,   8
 11209 0000839C 0707070808070707                        db    7,   7,   7,   8,   8,   7,   7,   7
 11210 000083A4 0706060606050506                        db    7,   6,   6,   6,   6,   5,   5,   6
 11211 000083AC 0605050404040303                        db    6,   5,   5,   4,   4,   4,   3,   3
 11212 000083B4 03030B0B0B0B0B0B                        db    3,   3, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh
 11213 000083BC 0A0A0A0A0A0A0A0B                        db  0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Bh
 11214 000083C4 0B0A09090A0A0909                        db  0Bh, 0Ah,   9,   9, 0Ah, 0Ah,   9,   9
 11215 000083CC 0A0A090A0A080809                        db  0Ah, 0Ah,   9, 0Ah, 0Ah,   8,   8,   9
 11216 000083D4 090A0A09090A0A08                        db    9, 0Ah, 0Ah,   9,   9, 0Ah, 0Ah,   8
 11217 000083DC 0808090909090909                        db    8,   8,   9,   9,   9,   9,   9,   9
 11218 000083E4 0808080808080707                        db    8,   8,   8,   8,   8,   8,   7,   7
 11219 000083EC 0707060606060403                        db    7,   7,   6,   6,   6,   6,   4,   3
 11220 000083F4 03010A0A0A0A0A0A                        db    3,   1, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah
 11221 000083FC 0A0B0B0A0A090909                        db  0Ah, 0Bh, 0Bh, 0Ah, 0Ah,   9,   9,   9
 11222 00008404 0A0A0A0A08080909                        db  0Ah, 0Ah, 0Ah, 0Ah,   8,   8,   9,   9
 11223 0000840C 0708080808080909                        db    7,   8,   8,   8,   8,   8,   9,   9
 11224 00008414 0909080708080707                        db    9,   9,   8,   7,   8,   8,   7,   7
 11225 0000841C 0808080909080808                        db    8,   8,   8,   9,   9,   8,   8,   8
 11226 00008424 0808080707060607                        db    8,   8,   8,   7,   7,   6,   6,   7
 11227 0000842C 0706050405050303                        db    7,   6,   5,   4,   5,   5,   3,   3
 11228 00008434 03020A0A09090909                        db    3,   2, 0Ah, 0Ah,   9,   9,   9,   9
 11229 0000843C 0909090808090908                        db    9,   9,   9,   8,   8,   9,   9,   8
 11230 00008444 0808080808090908                        db    8,   8,   8,   8,   8,   9,   9,   8
 11231 0000844C 0808080809090707                        db    8,   8,   8,   8,   9,   9,   7,   7
 11232 00008454 0708080808080807                        db    7,   8,   8,   8,   8,   8,   8,   7
 11233 0000845C 0707070808070707                        db    7,   7,   7,   8,   8,   7,   7,   7
 11234 00008464 0606060607070605                        db    6,   6,   6,   6,   7,   7,   6,   5
 11235 0000846C 0505040405050403                        db    5,   5,   4,   4,   5,   5,   4,   3
 11236 00008474 0303131312111010                        db    3,   3, 13h, 13h, 12h, 11h, 10h, 10h
 11237 0000847C 1010101010101010                        db  10h, 10h, 10h, 10h, 10h, 10h, 10h, 10h
 11238 00008484 11110F0F10100F0F                        db  11h, 11h, 0Fh, 0Fh, 10h, 10h, 0Fh, 0Fh
 11239 0000848C 0F0F0F0F0F0F0F0F                        db  0Fh, 0Fh, 0Fh, 0Fh, 0Fh, 0Fh, 0Fh, 0Fh
 11240 00008494 10100F10100E0E0F                        db  10h, 10h, 0Fh, 10h, 10h, 0Eh, 0Eh, 0Fh
 11241 0000849C 0F0F0F0E0E0E0E0E                        db  0Fh, 0Fh, 0Fh, 0Eh, 0Eh, 0Eh, 0Eh, 0Eh
 11242 000084A4 0E0E0E0E0E0E0F0F                        db  0Eh, 0Eh, 0Eh, 0Eh, 0Eh, 0Eh, 0Fh, 0Fh
 11243 000084AC 0E0D0E0E0D0D0E0E                        db  0Eh, 0Dh, 0Eh, 0Eh, 0Dh, 0Dh, 0Eh, 0Eh
 11244 000084B4 0D0E0E0D0E0E0D0E                        db  0Dh, 0Eh, 0Eh, 0Dh, 0Eh, 0Eh, 0Dh, 0Eh
 11245 000084BC 0E0D0D0E0E0C0C0C                        db  0Eh, 0Dh, 0Dh, 0Eh, 0Eh, 0Ch, 0Ch, 0Ch
 11246 000084C4 0D0D0D0D0D0D0C0D                        db  0Dh, 0Dh, 0Dh, 0Dh, 0Dh, 0Dh, 0Ch, 0Dh
 11247 000084CC 0D0C0C0D0D0D0D0D                        db  0Dh, 0Ch, 0Ch, 0Dh, 0Dh, 0Dh, 0Dh, 0Dh
 11248 000084D4 0D0D0D0D0D0D0D0C                        db  0Dh, 0Dh, 0Dh, 0Dh, 0Dh, 0Dh, 0Dh, 0Ch
 11249 000084DC 0C0D0D0C0C0C0C0D                        db  0Ch, 0Dh, 0Dh, 0Ch, 0Ch, 0Ch, 0Ch, 0Dh
 11250 000084E4 0D0D0D0C0D0D0C0B                        db  0Dh, 0Dh, 0Dh, 0Ch, 0Dh, 0Dh, 0Ch, 0Bh
 11251 000084EC 0C0C0C0C0C0C0C0C                        db  0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch
 11252 000084F4 0B0B0B0B0C0C0B0B                        db  0Bh, 0Bh, 0Bh, 0Bh, 0Ch, 0Ch, 0Bh, 0Bh
 11253 000084FC 0C0C0B0C0C0C0C0B                        db  0Ch, 0Ch, 0Bh, 0Ch, 0Ch, 0Ch, 0Ch, 0Bh
 11254 00008504 0B0C0C0B0C0C0B0C                        db  0Bh, 0Ch, 0Ch, 0Bh, 0Ch, 0Ch, 0Bh, 0Ch
 11255 0000850C 0C0B0C0C0A0A0A0B                        db  0Ch, 0Bh, 0Ch, 0Ch, 0Ah, 0Ah, 0Ah, 0Bh
 11256 00008514 0B0B0B0B0B0B0B0A                        db  0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Ah
 11257 0000851C 0A0A0A0B0B0A0B0B                        db  0Ah, 0Ah, 0Ah, 0Bh, 0Bh, 0Ah, 0Bh, 0Bh
 11258 00008524 0A0B0B0B0B0A0A0B                        db  0Ah, 0Bh, 0Bh, 0Bh, 0Bh, 0Ah, 0Ah, 0Bh
 11259 0000852C 0B0A0A0B0B0B0B0B                        db  0Bh, 0Ah, 0Ah, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh
 11260 00008534 0B09090A0A0A0A0A                        db  0Bh,   9,   9, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah
 11261 0000853C 0B0B0909090A0A09                        db  0Bh, 0Bh,   9,   9,   9, 0Ah, 0Ah,   9
 11262 00008544 090A0A0A0A0A0A0A                        db    9, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah
 11263 0000854C 0A0A0A0809090909                        db  0Ah, 0Ah, 0Ah,   8,   9,   9,   9,   9
 11264 00008554 09090A0A09090908                        db    9,   9, 0Ah, 0Ah,   9,   9,   9,   8
 11265 0000855C 0809090909090908                        db    8,   9,   9,   9,   9,   9,   9,   8
 11266 00008564 0708080808070707                        db    7,   8,   8,   8,   8,   7,   7,   7
 11267 0000856C 0707060606060404                        db    7,   7,   6,   6,   6,   6,   4,   4
 11268 00008574 03010D0D0D0D0C0D                        db    3,   1, 0Dh, 0Dh, 0Dh, 0Dh, 0Ch, 0Dh
 11269 0000857C 0D0D0D0D0D0C0D0D                        db  0Dh, 0Dh, 0Dh, 0Dh, 0Dh, 0Ch, 0Dh, 0Dh
 11270 00008584 0C0C0C0C0C0C0C0C                        db  0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch
 11271 0000858C 0C0C0C0C0C0C0C0C                        db  0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch
 11272 00008594 0C0C0C0C0C0C0C0D                        db  0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Dh
 11273 0000859C 0D0B0B0C0C0C0C0B                        db  0Dh, 0Bh, 0Bh, 0Ch, 0Ch, 0Ch, 0Ch, 0Bh
 11274 000085A4 0B0B0B0B0B0C0C0B                        db  0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Ch, 0Ch, 0Bh
 11275 000085AC 0B0B0B0B0B0B0B0C                        db  0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Ch
 11276 000085B4 0C0B0B0B0B0B0B0B                        db  0Ch, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh
 11277 000085BC 0B0B0B0B0B0B0B0B                        db  0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh
 11278 000085C4 0B0B0B0B0B0B0B0B                        db  0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh
 11279 000085CC 0B0B0C0C0B0B0B0B                        db  0Bh, 0Bh, 0Ch, 0Ch, 0Bh, 0Bh, 0Bh, 0Bh
 11280 000085D4 0B0B0A0B0B0B0B0B                        db  0Bh, 0Bh, 0Ah, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh
 11281 000085DC 0B0A0A0B0B0A0A0A                        db  0Bh, 0Ah, 0Ah, 0Bh, 0Bh, 0Ah, 0Ah, 0Ah
 11282 000085E4 0A0B0B0A0A0A0A0A                        db  0Ah, 0Bh, 0Bh, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah
 11283 000085EC 0A0A0B0B0A0A0A0A                        db  0Ah, 0Ah, 0Bh, 0Bh, 0Ah, 0Ah, 0Ah, 0Ah
 11284 000085F4 0A0B0B090A0A0A0A                        db  0Ah, 0Bh, 0Bh,   9, 0Ah, 0Ah, 0Ah, 0Ah
 11285 000085FC 0A0A0A0A0A0A0A0A                        db  0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah
 11286 00008604 090A0A0A0A090A0A                        db    9, 0Ah, 0Ah, 0Ah, 0Ah,   9, 0Ah, 0Ah
 11287 0000860C 090A0A0A0A0A0A0A                        db    9, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah
 11288 00008614 0A09090909090909                        db  0Ah,   9,   9,   9,   9,   9,   9,   9
 11289 0000861C 0A0A090909090909                        db  0Ah, 0Ah,   9,   9,   9,   9,   9,   9
 11290 00008624 0A0A090909090909                        db  0Ah, 0Ah,   9,   9,   9,   9,   9,   9
 11291 0000862C 0809090909090909                        db    8,   9,   9,   9,   9,   9,   9,   9
 11292 00008634 0909090808080809                        db    9,   9,   9,   8,   8,   8,   8,   9
 11293 0000863C 0909090909090908                        db    9,   9,   9,   9,   9,   9,   9,   8
 11294 00008644 0808080808090908                        db    8,   8,   8,   8,   8,   9,   9,   8
 11295 0000864C 0808080808080909                        db    8,   8,   8,   8,   8,   8,   9,   9
 11296 00008654 0807080807070707                        db    8,   7,   8,   8,   7,   7,   7,   7
 11297 0000865C 0808070707070706                        db    8,   8,   7,   7,   7,   7,   7,   6
 11298 00008664 0707060607070606                        db    7,   7,   6,   6,   7,   7,   6,   6
 11299 0000866C 0605050505050304                        db    6,   5,   5,   5,   5,   5,   3,   4
 11300 00008674 04030B0B0B0B0B0B                        db    4,   3, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh
 11301 0000867C 0B0B0A0B0B0B0B0A                        db  0Bh, 0Bh, 0Ah, 0Bh, 0Bh, 0Bh, 0Bh, 0Ah
 11302 00008684 0A0A0A0A080A0A09                        db  0Ah, 0Ah, 0Ah, 0Ah,   8, 0Ah, 0Ah,   9
 11303 0000868C 0909090A1011110F                        db    9,   9,   9, 0Ah, 10h, 11h, 11h, 0Fh
 11304 00008694 0F10100E0F0F0E0E                        db  0Fh, 10h, 10h, 0Eh, 0Fh, 0Fh, 0Eh, 0Eh
 11305 0000869C 0F0F0E0E0F0F0F0F                        db  0Fh, 0Fh, 0Eh, 0Eh, 0Fh, 0Fh, 0Fh, 0Fh
 11306 000086A4 0E0F0F0E0D080909                        db  0Eh, 0Fh, 0Fh, 0Eh, 0Dh,   8,   9,   9
 11307 000086AC 08080D0E0E0E0E0E                        db    8,   8, 0Dh, 0Eh, 0Eh, 0Eh, 0Eh, 0Eh
 11308 000086B4 0E0E0E0E0E0D0D0E                        db  0Eh, 0Eh, 0Eh, 0Eh, 0Eh, 0Dh, 0Dh, 0Eh
 11309 000086BC 0E0E0E0D0E0E0D0D                        db  0Eh, 0Eh, 0Eh, 0Dh, 0Eh, 0Eh, 0Dh, 0Dh
 11310 000086C4 0D0E0E0E0E0D0D0E                        db  0Dh, 0Eh, 0Eh, 0Eh, 0Eh, 0Dh, 0Dh, 0Eh
 11311 000086CC 0E0D0E0E0C0D0D0D                        db  0Eh, 0Dh, 0Eh, 0Eh, 0Ch, 0Dh, 0Dh, 0Dh
 11312 000086D4 0D0D0D0D0D0D0D0D                        db  0Dh, 0Dh, 0Dh, 0Dh, 0Dh, 0Dh, 0Dh, 0Dh
 11313 000086DC 0D0D0D0C0D0D0D0D                        db  0Dh, 0Dh, 0Dh, 0Ch, 0Dh, 0Dh, 0Dh, 0Dh
 11314 000086E4 0D0D0C0D0D0C0C0D                        db  0Dh, 0Dh, 0Ch, 0Dh, 0Dh, 0Ch, 0Ch, 0Dh
 11315 000086EC 0D0B0C0C0C0C0C0C                        db  0Dh, 0Bh, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch
 11316 000086F4 0C0D0D0B0C0C0C0C                        db  0Ch, 0Dh, 0Dh, 0Bh, 0Ch, 0Ch, 0Ch, 0Ch
 11317 000086FC 0B0C0C0C0C0C0C0C                        db  0Bh, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch
 11318 00008704 0C0B0C0C0B0B0B0B                        db  0Ch, 0Bh, 0Ch, 0Ch, 0Bh, 0Bh, 0Bh, 0Bh
 11319 0000870C 0C0C0C0C0C0C0C0C                        db  0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch
 11320 00008714 0B0C0C0B0C0C0B0C                        db  0Bh, 0Ch, 0Ch, 0Bh, 0Ch, 0Ch, 0Bh, 0Ch
 11321 0000871C 0C0B0C0C0B0A0A0B                        db  0Ch, 0Bh, 0Ch, 0Ch, 0Bh, 0Ah, 0Ah, 0Bh
 11322 00008724 0B0B0B0B0B0A0A0B                        db  0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Ah, 0Ah, 0Bh
 11323 0000872C 0B0A0A0B0B0B0B0B                        db  0Bh, 0Ah, 0Ah, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh
 11324 00008734 0B0B0B0A0B0B0A0A                        db  0Bh, 0Bh, 0Bh, 0Ah, 0Bh, 0Bh, 0Ah, 0Ah
 11325 0000873C 0A0B0B0A0A0B0B0A                        db  0Ah, 0Bh, 0Bh, 0Ah, 0Ah, 0Bh, 0Bh, 0Ah
 11326 00008744 0A0B0B0A09090A0A                        db  0Ah, 0Bh, 0Bh, 0Ah,   9,   9, 0Ah, 0Ah
 11327 0000874C 0A0A0A0A0909090A                        db  0Ah, 0Ah, 0Ah, 0Ah,   9,   9,   9, 0Ah
 11328 00008754 0A090A0A09090809                        db  0Ah,   9, 0Ah, 0Ah,   9,   9,   8,   9
 11329 0000875C 0909090909090908                        db    9,   9,   9,   9,   9,   9,   9,   8
 11330 00008764 0809090808070708                        db    8,   9,   9,   8,   8,   7,   7,   8
 11331 0000876C 0807060606060404                        db    8,   7,   6,   6,   6,   6,   4,   4
 11332 00008774 0301080808080808                        db    3,   1,   8,   8,   8,   8,   8,   8
 11333 0000877C 0808070808070708                        db    8,   8,   7,   8,   8,   7,   7,   8
 11334 00008784 0807070707070707                        db    8,   7,   7,   7,   7,   7,   7,   7
 11335 0000878C 0707070707080809                        db    7,   7,   7,   7,   7,   8,   8,   9
 11336 00008794 0B0B0B0B0B0B0B0B                        db  0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh
 11337 0000879C 0B0B0B0B0B0B0B0B                        db  0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh
 11338 000087A4 0B0B0B0B0B0B0B0B                        db  0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh
 11339 000087AC 0B0B0B0B040B0B0B                        db  0Bh, 0Bh, 0Bh, 0Bh,   4, 0Bh, 0Bh, 0Bh
 11340 000087B4 0B0C0C0B0A0B0B0A                        db  0Bh, 0Ch, 0Ch, 0Bh, 0Ah, 0Bh, 0Bh, 0Ah
 11341 000087BC 0A0A0A0B0B0A0A0A                        db  0Ah, 0Ah, 0Ah, 0Bh, 0Bh, 0Ah, 0Ah, 0Ah
 11342 000087C4 0A0B0B0A0A0A0A0A                        db  0Ah, 0Bh, 0Bh, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah
 11343 000087CC 0A0A0A0A0A0A0A0A                        db  0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah
 11344 000087D4 0A0A0A0A0A0A0A0A                        db  0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah
 11345 000087DC 0A0A0A0A0A0A0A0A                        db  0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah
 11346 000087E4 0A0A0A0A0A0A0A0A                        db  0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah
 11347 000087EC 0A0A0B0B0A0A0A0A                        db  0Ah, 0Ah, 0Bh, 0Bh, 0Ah, 0Ah, 0Ah, 0Ah
 11348 000087F4 0A0A0A0A0A0A0A0A                        db  0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah
 11349 000087FC 0A0B0B0A0B0B0A09                        db  0Ah, 0Bh, 0Bh, 0Ah, 0Bh, 0Bh, 0Ah,   9
 11350 00008804 0A0A0A0A0B0B0A09                        db  0Ah, 0Ah, 0Ah, 0Ah, 0Bh, 0Bh, 0Ah,   9
 11351 0000880C 090A0A090A0A0A0A                        db    9, 0Ah, 0Ah,   9, 0Ah, 0Ah, 0Ah, 0Ah
 11352 00008814 09090A0A09090909                        db    9,   9, 0Ah, 0Ah,   9,   9,   9,   9
 11353 0000881C 0909090909090909                        db    9,   9,   9,   9,   9,   9,   9,   9
 11354 00008824 0909090909090909                        db    9,   9,   9,   9,   9,   9,   9,   9
 11355 0000882C 0909090909090909                        db    9,   9,   9,   9,   9,   9,   9,   9
 11356 00008834 0909090909090909                        db    9,   9,   9,   9,   9,   9,   9,   9
 11357 0000883C 0A0A0909090A0A08                        db  0Ah, 0Ah,   9,   9,   9, 0Ah, 0Ah,   8
 11358 00008844 0909080808080808                        db    9,   9,   8,   8,   8,   8,   8,   8
 11359 0000884C 0808080808080809                        db    8,   8,   8,   8,   8,   8,   8,   9
 11360 00008854 0908080808080809                        db    9,   8,   8,   8,   8,   8,   8,   9
 11361 0000885C 0907080807070707                        db    9,   7,   8,   8,   7,   7,   7,   7
 11362 00008864 0708080707060607                        db    7,   8,   8,   7,   7,   6,   6,   7
 11363 0000886C 0706050506060404                        db    7,   6,   5,   5,   6,   6,   4,   4
 11364 00008874 0404060606060606                        db    4,   4,   6,   6,   6,   6,   6,   6
 11365 0000887C 0505050505040404                        db    5,   5,   5,   5,   5,   4,   4,   4
 11366 00008884 0401040404040404                        db    4,   1,   4,   4,   4,   4,   4,   4
 11367 0000888C 0404040404040404                        db    4,   4,   4,   4,   4,   4,   4,   4
 11368 00008894 0404                                    db    4,   4
 11369 00008896 03                      _@@const_3      db 3                   
 11370 00008897 000000                                  db 3 dup(0)
 11371 0000889A [B8470000]              mp3_synth_filter_procs dd synth_16bit_shift_0_slow ; SYNTH_MACRO 0,0,0
 11372 0000889E [A44A0000]                              dd synth_16bit_shift_1_slow ; SYNTH_MACRO 0,1,0
 11373 000088A2 [964D0000]                              dd synth_16bit_shift_2_slow ; SYNTH_MACRO 0,2,0
 11374 000088A6 [88500000]                              dd synth_8bit_shift_0_slow ; SYNTH_MACRO 1,0,0
 11375 000088AA [69530000]                              dd synth_8bit_shift_1_slow ; SYNTH_MACRO 1,1,0
 11376 000088AE [50560000]                              dd synth_8bit_shift_2_slow ; SYNTH_MACRO 1,2,0
 11377 000088B2 [79350000]                              dd synth_16bit_shift_0_fast ; SYNTH_MACRO 0,0,1
 11378 000088B6 [85380000]                              dd synth_16bit_shift_1_fast ; SYNTH_MACRO 0,1,1
 11379 000088BA [973B0000]                              dd synth_16bit_shift_2_fast ; SYNTH_MACRO 0,2,1
 11380 000088BE [A93E0000]                              dd synth_8bit_shift_0_fast ; SYNTH_MACRO 1,0,1
 11381 000088C2 [AA410000]                              dd synth_8bit_shift_1_fast ; SYNTH_MACRO 1,1,1
 11382 000088C6 [B1440000]                              dd synth_8bit_shift_2_fast ; SYNTH_MACRO 1,2,1
 11383                                  ;txt_hello      db 'nocash mp3 decoder v1.4, 2024 martin korth, press ctrl+c to quit,'
 11384                                  ;               db ' BDS now',0Dh,0Ah,0
 11385                                  ; Erdogan Tan - 17/10/2024
 11386 000088CA 0D0A                    txt_hello       db 13,10
 11387                                  		;db 'NOCASH MP3 PLAYER v1.4 for Windows ',0
 11388                                  		; 09/01/2025
 11389 000088CC 4E4F43415348204D50-     		db 'NOCASH MP3 PLAYER v1.0 for TRDOS386 ',0
 11389 000088D5 3320504C4159455220-
 11389 000088DE 76312E3020666F7220-
 11389 000088E7 5452444F5333383620-
 11389 000088F0 00                 
 11390                                  		 
 11391 000088F1 66696C653A2000          txt_file        db 'file: ',0          
 11392 000088F8 66696C652073697A65-     txt_file_size   db 'file size: ',0     
 11392 00008901 3A2000             
 11393 00008904 2C206964332073697A-     txt_id3_size    db ', id3 size: ',0    
 11393 0000890D 653A2000           
 11394 00008911 2C207461672073697A-     txt_tag_size    db ', tag size: ',0    
 11394 0000891A 653A2000           
 11395 0000891E 696E7075743A2000        txt_input       db 'input: ',0         
 11396 00008926 6F75747075743A2000      txt_output      db 'output: ',0        
 11397 0000892F 20687A2C2000            txt_hz          db ' hz, ',0           
 11398 00008935 206368616E6E656C73-     txt_channels    db ' channels, ',0     
 11398 0000893E 2C2000             
 11399 00008941 2062697400              txt_bit         db ' bit',0            
 11400 00008946 206B6269742F7300        txt_kbit_s      db ' kbit/s',0         
 11401 0000894E 63616E6E6F74206F70-     txt_not_found   db 'cannot open source file',0Dh,0Ah,0
 11401 00008957 656E20736F75726365-
 11401 00008960 2066696C650D0A00   
 11402 00008968 75736167653A206D70-     txt_help        db 'usage: mp3play input.mp3 [output.wav] [verify.pcm] [/test]', 0Dh,0Ah
 11402 00008971 33706C617920696E70-
 11402 0000897A 75742E6D7033205B6F-
 11402 00008983 75747075742E776176-
 11402 0000898C 5D205B766572696679-
 11402 00008995 2E70636D5D205B2F74-
 11402 0000899E 6573745D0D0A       
 11403 000089A4 202020202020202020-                     db '                         [/mono] [/8bit] [/fast] [/half|/quarter]',0Dh,0Ah,0
 11403 000089AD 202020202020202020-
 11403 000089B6 202020202020205B2F-
 11403 000089BF 6D6F6E6F5D205B2F38-
 11403 000089C8 6269745D205B2F6661-
 11403 000089D1 73745D205B2F68616C-
 11403 000089DA 667C2F717561727465-
 11403 000089E3 725D0D0A00         
 11404 000089E8 766572696679206D61-     _@@txt_verify1  db 'verify max difference = ',0
 11404 000089F1 782064696666657265-
 11404 000089FA 6E6365203D2000     
 11405 00008A01 206174206D70333A00      _@@txt_verify1_at_mp3 db ' at mp3:',0  
 11406 00008A0A 2C2061766572616765-     _@@txt_verify2  db ', average difference = ',0
 11406 00008A13 20646966666572656E-
 11406 00008A1C 6365203D2000       
 11407                                  
 11408                                  ; Erdogan Tan - 17/10/2024
 11409                                                 ;db 'NOCASH MP3 PLAYER v1.4 for Windows ',0
 11410 00008A22 287072657373204354-     txt_ctrlc       db '(press CTRL+C to quit)', 13,10,0
 11410 00008A2B 524C2B4320746F2071-
 11410 00008A34 756974290D0A00     
 11411                                  txt_ctrlc_size equ $ - txt_ctrlc
 11412 00008A3B 0D0A                    txt_about       db 13,10
 11413                                                  ;db '----------------------------------',13,10
 11414 00008A3D 2D2D2D2D2D2D2D2D2D-                     db '-----------------------------------',13,10
 11414 00008A46 2D2D2D2D2D2D2D2D2D-
 11414 00008A4F 2D2D2D2D2D2D2D2D2D-
 11414 00008A58 2D2D2D2D2D2D2D2D0D-
 11414 00008A61 0A                 
 11415 00008A62 4572646F67616E2054-                     db 'Erdogan Tan - 13/01/2025 (Assembler: NASM)', 13,10
 11415 00008A6B 616E202D2031332F30-
 11415 00008A74 312F32303235202841-
 11415 00008A7D 7373656D626C65723A-
 11415 00008A86 204E41534D290D0A   
 11416 00008A8E 4F726967696E616C20-                     db 'Original code: MP3PLAYER.EXE v1.4 (20/09/2024)', 13,10
 11416 00008A97 636F64653A204D5033-
 11416 00008AA0 504C415945522E4558-
 11416 00008AA9 452076312E34202832-
 11416 00008AB2 302F30392F32303234-
 11416 00008ABB 290D0A             
 11417 00008ABE 202020202020202020-                     db '               by Martin Korth (TASM source code)'
 11417 00008AC7 202020202020627920-
 11417 00008AD0 4D617274696E204B6F-
 11417 00008AD9 72746820285441534D-
 11417 00008AE2 20736F757263652063-
 11417 00008AEB 6F646529           
 11418 00008AEF 0D0A0D0A00                              db 13,10,13,10,0
 11419 00008AF4 76312E342E30                            db 'v1.4.0'
 11420                                  ; 10/01/2025
 11421 00008AFA 00                      half_buffer	db 0
 11422                                  
 11423                                  ; ===========================================================================
 11424                                  ; Uninitialized DATA (BSS)
 11425                                  ; ===========================================================================
 11426                                  
 11427 00008AFB 90                      align 4
 11428                                  
 11429                                  bss_start:
 11430                                  
 11431                                  ; 10/01/2025
 11432                                  ABSOLUTE bss_start
 11433                                  
 11434                                  ; 12/01/2025
 11435                                  ;;;;
 11436                                  ; AC97 specific
 11437 00008AFC ????????                bus_dev_fn	resd 1
 11438 00008B00 ????????                dev_vendor	resd 1
 11439 00008B04 ????                    NAMBAR		resw 1
 11440 00008B06 ????                    NABMBAR		resw 1
 11441                                  ; SB16 specific
 11442 00008B08 ????????                audio_io_base	resd 1
 11443                                  ac97_int_ln_reg:
 11444 00008B0C ??                      audio_intr	resb 1
 11445                                  ;;;;
 11446                                  
 11447 00008B0D ??????                  alignb 4
 11448                                  
 11449                                  ;;;
 11450                                  ; 20/10/2024 (TRDOS 386 specific parameters)
 11451 00008B10 ??                      audio_hardware	resb 1
 11452 00008B11 ??                      vra		resb 1
 11453 00008B12 ????                    max_frequency	resw 1
 11454 00008B14 ??                      srb		resb 1
 11455 00008B15 ??                      volume_level	resb 1
 11456 00008B16 ??                      blocks		resb 1
 11457 00008B17 ??                      		resb 1
 11458 00008B18 ????????                buffer_size	resd 1
 11459                                  ;;;	
 11460                                  
 11461                                  mp3_context_start:
 11462 00008B1C <res 1000h>             main_data_pool_start	resb 4096
 11463 00009B1C ????????                main_data_pool_wr_ptr	resd 1
 11464 00009B20 ????????                mp3_src_data_location	resd 1
 11465 00009B24 ????????                mp3_src_frame_size	resd 1
 11466 00009B28 ????????                mp3_src_frame_end	resd 1
 11467 00009B2C ????????                mp3_hdr_32bit_header	resd 1
 11468 00009B30 ????????                mp3_hdr_flag_crc	resd 1
 11469 00009B34 ????????                mp3_hdr_flag_mpeg25	resd 1
 11470 00009B38 ????????                mp3_hdr_flag_padding	resd 1
 11471 00009B3C ????????                mp3_sample_rate		resd 1
 11472 00009B40 ????????                mp3_hdr_sample_rate_index resd 1
 11473 00009B44 ????????                mp3_bit_rate		resd 1
 11474 00009B48 ????????                mp3_src_num_channels	resd 1
 11475 00009B4C ????????                mp3_output_num_channels resd 1
 11476 00009B50 ????????                mp3_output_sample_rate	resd 1
 11477 00009B54 ????????                mp3_bytes_per_sample	resd 1
 11478 00009B58 ????????                mp3_curr_syn_index	resd 1
 11479 00009B5C ????????                mp3_curr_syn_dst	resd 1
 11480 00009B60 ????????                mp3_nb_frames		resd 1
 11481 00009B64 ????????                mp3_hdr_mode_val	resd 1
 11482 00009B68 ????????                mp3_hdr_mode_ext	resd 1
 11483 00009B6C ????????                mp3_hdr_flag_lsf	resd 1
 11484 00009B70 ????????                mp3_synth_filter_proc	resd 1
 11485                                  
 11486 00009B74 <res 2000h>             mp3_synth_buf   resd 2048
 11487 0000BB74 ????????????????        mp3_synth_index resd 2
 11488 0000BB7C <res 2400h>             mp3_sb_samples  resd 2304
 11489                                  	                           ; MP3_MAX_CHANNELS*36*SBLIMIT
 11490 0000DF7C <res 1200h>             mp3_mdct_buf    resd 1152
 11491                                                                     ; MP3_MAX_CHANNELS*SBLIMIT*18
 11492 0000F17C ????????                mp3_free_format_frame_size resd 1
 11493                                  
 11494 0000F180 ??                      mp3_curr_vfrac_bits resb 1
 11495                                  
 11496 0000F181 ??????                  alignb 4
 11497                                  
 11498 0000F184 ????????                mp3_xing_id     resd 1
 11499 0000F188 ????????                mp3_xing_flags  resd 1
 11500 0000F18C ????????                mp3_xing_frames resd 1
 11501 0000F190 ????????                mp3_xing_filesize resd 1
 11502 0000F194 <res 64h>               mp3_xing_toc    resb 100
 11503 0000F1F8 ????????                mp3_xing_vbr_scale resd 1
 11504 0000F1FC ????????                mp3_file_size   resd 1
 11505 0000F200 ????????                mp3_id3_size    resd 1
 11506 0000F204 ????????                mp3_tag_size    resd 1
 11507                                  
 11508 0000F208 ????????                mp3_num_frames_decoded	resd 1
 11509 0000F20C ????????                mp3_total_output_size	resd 1
 11510 0000F210 ????????                mp3_samples_dst		resd 1
 11511                                  ; DWORD mp3_samples_output_size
 11512 0000F214 ????????                mp3_samples_output_size	resd 1
 11513 0000F218 ????????                mp3_samples_dst_step	resd 1
 11514                                  
 11515 0000F21C ????????                mp3_curr_channel	resd 1
 11516 0000F220 ????????                mp3_curr_granule	resd 1
 11517 0000F224 ????????                mp3_curr_frame		resd 1
 11518                                  
 11519 0000F228 ????????                mp3_bitstream_start	resd 1
 11520 0000F22C ????????                mp3_src_remain		resd 1
 11521 0000F230 ????????                mp3_extra_bytes		resd 1
 11522 0000F234 ????????                mp3_main_data_begin	resd 1
 11523 0000F238 ????????                mp3_num_compress_bits	resd 1
 11524                                  
 11525 0000F23C ????????                mp3_nb_granules resd 1
 11526                                  
 11527 0000F240 <res 2680h>             mp3_granules		resb 9856
 11528 000118C0 <res 480h>              mp3_exponents		resw 576
 11529 00011D40 <res B800h>             huff_tree_buf		resb 0B800h
 11530 0001D540 <res 240h>              mp3_band_index_long	resw 288
 11531 0001D780 <res 803Ch>             mp3_table_4_3_exp	resb 32828
 11532                                  
 11533 000257BC <res 200F0h>            mp3_table_4_3_value	resd 32828
 11534 000458AC <res 800h>              mp3_exp_table		resd 512
 11535 000460AC <res 8000h>             mp3_expval_table	resd 8192
 11536 0004E0AC <res 480h>              mp3_mdct_win		resd 288
 11537 0004E52C <res 800h>              mp3_is_table_lsf	resd 512
 11538 0004ED2C <res 1000h>             mp3_synth_win		resd 1024
 11539 0004FD2C <res 2000h>             mp3_lsf_sf_expand_exploded_table resb 8192
 11540                                  mp3_context_end:
 11541 00051D2C ????????                _@@region_address0	resd 1
 11542 00051D30 ????????                _@@region_address1	resd 1
 11543 00051D34 ????????                _@@saved_sp		resd 1
 11544 00051D38 ????????                mp3_main_data_siz	resd 1
 11545 00051D3C ????????                _@@scfsi        resd 1
 11546 00051D40 <res Ch>                _@@gains        resd 3
 11547 00051D4C ????????                _@@rle_point    resd 1
 11548 00051D50 ????????                _@@III          resd 1
 11549 00051D54 ????????                _@@JJJ          resd 1
 11550 00051D58 ????????                _@@linbits      resd 1
 11551 00051D5C ????????                _@@vlc_table    resd 1
 11552 00051D60 ????????                _@@coarse_end   resd 1
 11553                                  
 11554 00051D64 ????????                _@rle_point     resd 1
 11555 00051D68 ????????                _@@rle_ptr      resd 1
 11556 00051D6C ????????                _@@rle_val      resd 1
 11557 00051D70 ????????                _@@rle_val_x_40h resd 1
 11558 00051D74 ????????                _@@max_bands    resb 4
 11559 00051D78 ????????                _@@max_blocks   resd 1
 11560 00051D7C ????????                _@@max_pos      resd 1
 11561 00051D80 <res 28h>               _@@sfb_array    resb 40
 11562 00051DA8 ????????                _@@is_tab       resd 1
 11563 00051DAC ????????                _@@n_long_sfb   resd 1
 11564 00051DB0 ????????                _@@n_short_sfb  resd 1
 11565 00051DB4 ????????                _@@n_sfb        resd 1
 11566 00051DB8 <res 900h>              _@@tmp          resb 2304
 11567 000526B8 ????????                _@@s0           resd 1
 11568 000526BC ????????                _@@s2           resd 1
 11569 000526C0 ????????                _@@s3           resd 1
 11570                                  
 11571 000526C4 <res 48h>               _@@@tmp         resd 18 ; resb 72
 11572 0005270C ????????                _@@tmp0         resd 1
 11573 00052710 ????????                _@@tmp1         resd 1
 11574 00052714 ????????                _@@tmp2         resd 1
 11575 00052718 ????????                _@@tmp3         resd 1
 11576 0005271C ????????                _@@tmp4         resd 1
 11577 00052720 ????????                _@@tmp5         resd 1
 11578 00052724 ????????                mp3_out2_a0     resd 1
 11579 00052728 ????????                mp3_out2_a1     resd 1
 11580 0005272C ????????                mp3_out2_a2     resd 1
 11581 00052730 ????????                mp3_out2_b0     resd 1
 11582 00052734 ????????                mp3_out2_b1     resd 1
 11583 00052738 ????????                mp3_out2_b2     resd 1
 11584 0005273C ????????                                resd 1
 11585 00052740 ????????                                resd 1
 11586 00052744 ????????                _@@@JJJ         resd 1
 11587 00052748 ????????                _@@www          resd 1
 11588 0005274C ????????                _@@mdct_long_end resd 1
 11589 00052750 ????????                _@@sblimit      resd 1
 11590 00052754 ????????                _@@switch_point resd 1
 11591 00052758 <res 100h>              mp3_huff_tmp_bits	resb 256
 11592 00052858 <res 200h>              mp3_huff_tmp_codes	resb 512
 11593 00052A58 ????????                _@@table_nb_bits	resd 1
 11594 00052A5C ????????                _@@nb_codes		resd 1
 11595 00052A60 ????????                _@@prefix_numbits	resd 1
 11596 00052A64 ????????                _@@prefix_pattern	resd 1
 11597 00052A68 ????????                _@@curr_table_size	resd 1
 11598 00052A6C ????????                _@@curr_table_mask	resd 1
 11599 00052A70 ????????                _@@curr_table_index	resd 1
 11600 00052A74 ????????                _@@granule_addr		resd 1
 11601                                  ; HANDLE hFile
 11602 00052A78 ????????                hFile           resd 1
 11603                                  ; HANDLE hMap
 11604                                  ;hMap           resd 1
 11605 00052A7C ????????                stream_start    resd 1
 11606 00052A80 ????????                stream_pos      resd 1
 11607 00052A84 ????????                bytes_left      resd 1
 11608                                  
 11609                                  ; 20/10/2024
 11610                                  ; DWORD diskresult
 11611                                  ;diskresult     resd 1
 11612                                  ; HANDLE std_out
 11613                                  ;std_out        resd 1
 11614                                  ;cmdline_buf    resb 1024
 11615 00052A88 <res 80h>               cmdline_buf	resb 128
 11616                                  ; HANDLE mp3_wav_handle
 11617 00052B08 ????????                mp3_wav_handle  resd 1
 11618                                  ; HANDLE mp3_pcm_handle
 11619 00052B0C ????????                mp3_pcm_handle  resd 1
 11620 00052B10 ????????                _@@max_diff     resd 1
 11621 00052B14 ????????????????        _@@avg_diff     resd 2
 11622 00052B1C ????????                pcm_filepos     resd 1
 11623 00052B20 ????????                _@@mono_convert resd 1
 11624 00052B24 ????????                _@@pcm_steps    resw 2
 11625 00052B28 ????????                _@@worst_pcm_filepos resd 1
 11626 00052B2C ????????                _@@worst_mp3_filepos resd 1
 11627 00052B30 ????????                		resd 1
 11628                                  ;alignb 4
 11629                                  
 11630                                  ; 10/01/2025
 11631 00052B34 <res 4CCh>              alignb 4096
 11632                                  
 11633                                  ; 12/01/2025
 11634                                  ; 09/01/2025
 11635 00053000 <res 9000h>             sample_buffer	resb 36864
 11636                                  ;sample_buffer	resb 8*MP3_MAX_OUTPUT_SIZE
 11637                                  ;sample_buffer_size equ $-sample_buffer
 11638                                  
 11639                                  ; 10/01/2025
 11640                                  ;sample_buffer	resb 65536
 11641                                  
 11642                                  ;alignb 4096
 11643                                  
 11644                                  end_of_bss:
 11645                                  
 11646                                  ; ===========================================================================
 11647                                  ; end

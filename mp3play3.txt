     1                                  ; ****************************************************************************
     2                                  ; MP3PLAY.PRG - MP3 DECODER/PLAYER 1.0 for TRDOS 386 Operating System
     3                                  ; ----------------------------------------------------------------------------
     4                                  ; Based on 
     5                                  ; NOCASH MP3PLAY.EXE 1.4 (Windows) ASM source code (Martin Korth, 20/09/2024)
     6                                  ;
     7                                  ; FASM Source Code: Erdogan Tan - 19/10/2024 - 22/10/2024
     8                                  ; NASM Source Code: Erdogan Tan - 09/01/2025
     9                                  ;
    10                                  ; [ Last Modification: 15/01/2025 ]
    11                                  ;
    12                                  ; ----------------------------------------------------------------------------
    13                                  ; Modified from on MP3PLAY.ASM (for Windows console) source code - 17/10/2024
    14                                  ; ****************************************************************************
    15                                  ; Modified from Martin Korth's 'mp3play.asm' (TASM32) source code... (v1.4)
    16                                  ; Applied development method:
    17                                  ;         Disassembling 'mp3play.exe' v1.4 by using HEX-RAYS disassembler;
    18                                  ;         then... converting disassembled code to FASM syntax,
    19                                  ;                 adding '.idata' code (by help of FASM examples) to the raw
    20                                  ;                        asm file. Converting 'proc' procedures to labels.
    21                                  ;               and Finally: assembling mp3play.asm (single) file by using
    22                                  ;                           'fasm mp3play.asm' command.
    23                                  ;
    24                                  ; NOTE:
    25                                  ; Martin Korth's MP3PLAY.EXE (v1.4, 20/09/2024) file size is 45056 bytes.
    26                                  ; (This) modified MP3PLAY.EXE (v1.4.0, 17/10/2024) is 37888 bytes.
    27                                  ;
    28                                  ; ---------------------------------------------------------------------------
    29                                  ; nasm mp3play.s -l mp3play.txt -o MP3PLAY.PRG -Z error.txt
    30                                  
    31                                  ; 13/01/2025
    32                                  ; Interpolated sample rate playing method for non-VRA AC97 codecs.
    33                                  
    34                                  ; ===========================================================================
    35                                  ;  TRDOS 386 Operating System Specific Procedures - Erdogan Tan - 20/10/2024
    36                                  ; ===========================================================================
    37                                  
    38                                  ; 20/10/2024
    39                                  ; 20/08/2024 ; TRDOS 386 v2.0.9
    40                                  ; TRDOS 386 system calls
    41                                  _ver 	equ 0
    42                                  _exit 	equ 1
    43                                  _fork 	equ 2
    44                                  _read 	equ 3
    45                                  _write	equ 4
    46                                  _open	equ 5
    47                                  _close 	equ 6
    48                                  _wait 	equ 7
    49                                  _creat 	equ 8
    50                                  _rename equ 9
    51                                  _delete equ 10
    52                                  _exec	equ 11
    53                                  _chdir	equ 12
    54                                  _time 	equ 13
    55                                  _mkdir 	equ 14
    56                                  _chmod	equ 15
    57                                  _rmdir	equ 16
    58                                  _break	equ 17
    59                                  _drive	equ 18
    60                                  _seek	equ 19
    61                                  _tell 	equ 20
    62                                  _mem	equ 21
    63                                  _prompt	equ 22
    64                                  _path	equ 23
    65                                  _env	equ 24
    66                                  _stime	equ 25
    67                                  _quit	equ 26
    68                                  _intr	equ 27
    69                                  _dir	equ 28
    70                                  _emt 	equ 29
    71                                  _ldvrt 	equ 30
    72                                  _video 	equ 31
    73                                  _audio	equ 32
    74                                  _timer	equ 33
    75                                  _sleep	equ 34
    76                                  _msg    equ 35
    77                                  _geterr	equ 36
    78                                  _fpsave	equ 37
    79                                  _pri	equ 38
    80                                  _rele	equ 39
    81                                  _fff	equ 40
    82                                  _fnf	equ 41
    83                                  _alloc	equ 42
    84                                  _dalloc equ 43
    85                                  _calbac equ 44
    86                                  _dma	equ 45
    87                                  _stdio  equ 46	;  TRDOS 386 v2.0.9
    88                                  
    89                                  ; ---------------------------------------------------------------------------
    90                                  ; 'sys' macro in FASM format
    91                                  ; ---------------------------------------------------------------------------
    92                                  
    93                                  %if 0
    94                                  macro sys op1,op2,op3,op4
    95                                  {
    96                                      if op4 eq 
    97                                      else
    98                                          mov edx, op4
    99                                      end if
   100                                      if op3 eq
   101                                      else
   102                                          mov ecx, op3
   103                                      end if
   104                                      if op2 eq
   105                                      else
   106                                          mov ebx, op2
   107                                      end if
   108                                      mov eax, op1
   109                                      int 40h
   110                                  }
   111                                  %endif
   112                                  
   113                                  ; ---------------------------------------------------------------------------
   114                                  ; 'sys' macro in NASM format
   115                                  ; ---------------------------------------------------------------------------
   116                                  ; 09/01/2025
   117                                  
   118                                  %macro sys 1-4
   119                                      ; 29/04/2016 - TRDOS 386 (TRDOS v2.0)
   120                                      ; 03/09/2015
   121                                      ; 13/04/2015
   122                                      ; Retro UNIX 386 v1 system call.
   123                                      %if %0 >= 2
   124                                          mov ebx, %2
   125                                          %if %0 >= 3
   126                                              mov ecx, %3
   127                                              %if %0 = 4
   128                                                 mov edx, %4
   129                                              %endif
   130                                          %endif
   131                                      %endif
   132                                      mov eax, %1
   133                                      ;int 30h
   134                                      int 40h ; TRDOS 386 (TRDOS v2.0)
   135                                  %endmacro
   136                                  
   137                                  ; ===========================================================================
   138                                  ; CODE
   139                                  ; ===========================================================================
   140                                  
   141                                  		[BITS 32] ; 32-bit intructions
   142                                  
   143                                  		[ORG 0]
   144                                  
   145                                  ; ===========================================================================
   146                                  
   147                                  		; 20/10/2024
   148                                  start:
   149                                  		; 21/10/2024
   150 00000000 E8526B0000              		call	set_break	; set and clear bss section
   151                                  					; also set stream_start position
   152                                  
   153                                                  ;mov    edx, txt_hello  ; "nocash mp3 decoder v1.4, 2024" ...
   154                                                  ;call   wrstr_edx
   155 00000005 BB[EA9F0000]            		mov	ebx, txt_hello
   156 0000000A E8EF6B0000              		call	print_msg
   157                                  
   158 0000000F E81E6A0000                              call    get_commandline
   159 00000014 0F82A6010000                            jc      .exit
   160                                  
   161                                  		;;;
   162                                  		; 11/01/2025
   163 0000001A E8D56C0000              		call	detect_enable_audio_device
   164 0000001F 0F829B010000            		jc	.exit
   165                                  		;;;
   166                                  
   167                                  		;;;
   168                                  		; 10/01/2025 (Video memory access for buffer change indicator)
   169                                  		; DIRECT CGA (TEXT MODE) MEMORY ACCESS
   170                                  		; bl = 0, bh = 4
   171                                  		; Direct access/map to CGA (Text) memory (0B8000h)
   172                                  		sys	_video, 0400h
   119                              <1> 
   120                              <1> 
   121                              <1> 
   122                              <1> 
   123                              <1>  %if %0 >= 2
   124 00000025 BB00040000          <1>  mov ebx, %2
   125                              <1>  %if %0 >= 3
   126                              <1>  mov ecx, %3
   127                              <1>  %if %0 = 4
   128                              <1>  mov edx, %4
   129                              <1>  %endif
   130                              <1>  %endif
   131                              <1>  %endif
   132 0000002A B81F000000          <1>  mov eax, %1
   133                              <1> 
   134 0000002F CD40                <1>  int 40h
   173                                  		;cmp	eax, 0B8000h
   174                                  		;jne	short error_exit
   175                                  		;;;
   176                                  
   177 00000031 31ED                                    xor     ebp, ebp
   178 00000033 E837640000                              call    mp3_init
   179 00000038 E8316B0000                              call    open_and_mmap_the_file
   180 0000003D 0F827D010000                            jc      .exit
   181 00000043 E87D010000                              call    detect_cpu_386_and_up
   182 00000048 E8C36B0000                              call    GetTickCount
   183 0000004D F7D8                                    neg     eax
   184 0000004F A3[088B0000]                            mov     [millisecond_count], eax
   185 00000054 E8B0640000                              call    mp3_check_1st_frame
   186 00000059 0F8261010000                            jc      .exit
   187 0000005F 803D[F68A0000]00                        cmp     byte [option_test], 0
   188 00000066 740A                                    jz      short .no_benchmark_test
   189 00000068 E866660000                              call    mp3_plain_test_without_output
   190 0000006D E99A000000                              jmp     .decode_done
   191                                  
   192                                  .no_benchmark_test:
   193 00000072 833D[A8990000]00                        cmp     dword [mp3_pcm_fname], 0
   194 00000079 740A                                    jz      short .no_pcm_verify
   195 0000007B E87B670000                              call    mp3_verify_pcm_file
   196 00000080 E93B010000                              jmp     .exit
   197                                  
   198                                  .no_pcm_verify:
   199 00000085 833D[A4990000]00                        cmp     dword [mp3_dst_fname], 0
   200 0000008C 7407                                    jz      short .no_wav_output
   201 0000008E E875660000                              call    mp3_cast_to_wav_file
   202 00000093 EB77                    		jmp     short .decode_done
   203                                  .no_wav_output:
   204                                  		; 13/01/2025 (interpolation procs for non-VRA AC97 codecs)
   205                                  		;;;; --------------------------
   206                                  		;mov	byte [interpolation], 0
   207 00000095 B002                    		mov	al, 2 
   208 00000097 3805[30A20000]          		cmp	[audio_hardware], al ; 2
   209 0000009D 7551                    		jne	short .direct
   210                                  .chk_frq:
   211 0000009F 813D[7CB20000]80BB-     		cmp	dword [mp3_output_sample_rate], 48000 ; 48 kHZ
   211 000000A7 0000               
   212 000000A9 721A                    		jb	short .chk_vra
   213 000000AB 803D[78B20000]02        		cmp	byte [mp3_output_num_channels], 2
   214 000000B2 7208                    		jb	short .convert	; mono (8bit or 16bit)
   215 000000B4 3805[80B20000]          		cmp	[mp3_bytes_per_sample], al ; 2
   216 000000BA 7334                    		jnb	short .direct ; 16bit, stereo
   217                                  .convert:
   218                                  		; 8bit m/s or 16bit mono
   219 000000BC C605[44A20000]01        		mov	byte [interpolation], 1 ; convert (to 16 bit stereo)
   220 000000C3 EB3D                    		jmp	short .indirect
   221                                  .chk_vra:
   222 000000C5 A2[44A20000]            		mov	[interpolation], al ; 2 = interpolation
   223 000000CA 803D[31A20000]01        		cmp	byte [vra], 1
   224 000000D1 722F                    		jb	short .indirect
   225 000000D3 FE0D[44A20000]          		dec	byte [interpolation] ; 1 = convert (to 16 bit stereo)
   226 000000D9 803D[78B20000]02        		cmp	byte [mp3_output_num_channels], 2
   227 000000E0 7220                    		jb	short .indirect ; 8 bit
   228 000000E2 3805[80B20000]          		cmp	[mp3_bytes_per_sample], al ; 2
   229 000000E8 7218                    		jb	short .indirect ; mono
   230                                  
   231                                  		; 14/01/2025
   232 000000EA FE0D[44A20000]          		dec	byte [interpolation] ; 0
   233                                  .direct:
   234                                  		;;;; --------------------------
   235                                  
   236                                  		;;; 
   237                                  		; 20/10/2024
   238                                  		;call	detect_enable_audio_device
   239                                  		;jc	.exit
   240 000000F0 E8EC6C0000              		call	audio_system_init
   241 000000F5 0F82C5000000            		jc	.exit
   242                                  		;;;
   243                                  
   244 000000FB E89F6D0000                              call    mp3_cast_to_speaker
   245                                  
   246                                  		; 13/01/2025
   247                                  		;;;; --------------------------
   248 00000100 EB0A                    		jmp	short .decode_done
   249                                  .indirect:
   250 00000102 E87C6F0000              		call	audio_system_init_x
   251 00000107 E816720000              		call    mp3_cast_to_speaker_x
   252                                  		;;;; --------------------------
   253                                  .decode_done:
   254 0000010C E8FF6A0000                              call    GetTickCount
   255 00000111 0105[088B0000]                          add     [millisecond_count], eax
   256 00000117 BA[DD990000]                            mov     edx, txt_decode_timing1 ; "audio duration "
   257 0000011C E8F2640000                              call    wrstr_edx
   258 00000121 A1[38090100]                            mov     eax, [mp3_total_output_size]
   259 00000126 BAE8030000                              mov     edx, 1000
   260 0000012B F7E2                                    mul     edx
   261 0000012D F735[7CB20000]                          div     dword [mp3_output_sample_rate]
   262 00000133 31D2                                    xor     edx, edx
   263 00000135 F735[78B20000]                          div     dword [mp3_output_num_channels]
   264 0000013B 31D2                                    xor     edx, edx
   265 0000013D F735[80B20000]                          div     dword [mp3_bytes_per_sample]
   266 00000143 A3[048B0000]                            mov     [mp3_output_milliseconds], eax
   267 00000148 E8FC640000                              call    wr_decimal_eax_with_thousands_seperator
   268 0000014D BA[ED990000]                            mov     edx, txt_decode_timing2 ; " milliseconds, decoded in "
   269 00000152 E8BC640000                              call    wrstr_edx
   270 00000157 A1[088B0000]                            mov     eax, [millisecond_count]
   271 0000015C E8E8640000                              call    wr_decimal_eax_with_thousands_seperator
   272 00000161 BA[089A0000]                            mov     edx, txt_decode_timing3 ; " milliseconds\r\n"
   273 00000166 E8A8640000                              call    wrstr_edx
   274 0000016B BA[189A0000]                            mov     edx, txt_clks_per_second ; " clock cycles per second:\r\n"
   275 00000170 E89E640000                              call    wrstr_edx
   276 00000175 BE[0C8B0000]                            mov     esi, ttt ; rdtsc_list_start
   277                                  
   278                                  .timelog_lop:
   279 0000017A E8B6640000                              call    wrspc
   280 0000017F 8D5608                                  lea     edx, [esi+8]
   281 00000182 E88C640000                              call    wrstr_edx
   282 00000187 E8A9640000                              call    wrspc
   283 0000018C 8B06                                    mov     eax, [esi]
   284 0000018E 8B5E04                                  mov     ebx, [esi+4]
   285 00000191 BAE8030000                              mov     edx, 1000
   286 00000196 0FAFDA                                  imul    ebx, edx
   287 00000199 F7E2                                    mul     edx
   288 0000019B 01DA                                    add     edx, ebx
   289 0000019D 3B15[048B0000]                          cmp     edx, [mp3_output_milliseconds]
   290 000001A3 730B                                    jnb     short .timelog_oops
   291 000001A5 F735[048B0000]                          div     dword [mp3_output_milliseconds]
   292 000001AB E899640000                              call    wr_decimal_eax_with_thousands_seperator
   293                                  
   294                                  .timelog_oops:
   295 000001B0 E86F640000                              call    wrcrlf
   296 000001B5 83C618                                  add     esi, 24
   297 000001B8 81FE[D48C0000]                          cmp     esi, mp3_bitrate_tab
   298 000001BE 75BA                                    jnz     short .timelog_lop
   299                                  
   300                                  .exit:
   301                                  		;push   0               ; uExitCode
   302                                                  ;call   ExitProcess
   303 000001C0 E96F6A0000              		jmp	ExitProcess
   304                                  
   305                                  
   306                                  ; =============== S U B R O U T I N E =======================================
   307                                  
   308                                  
   309                                  detect_cpu_386_and_up:
   310 000001C5 C605[018B0000]03                        mov     byte [detected_cpu], 3
   311 000001CC 89E3                                    mov     ebx, esp
   312 000001CE 83E4FC                                  and     esp, ~3	; not 3
   313 000001D1 9C                                      pushf
   314 000001D2 58                                      pop     eax
   315 000001D3 89C1                                    mov     ecx, eax
   316 000001D5 3500000400                              xor     eax, 40000h
   317 000001DA 50                                      push    eax
   318 000001DB 9D                                      popf
   319 000001DC 9C                                      pushf
   320 000001DD 58                                      pop     eax
   321 000001DE 31C8                                    xor     eax, ecx
   322 000001E0 51                                      push    ecx
   323 000001E1 9D                                      popf
   324 000001E2 89DC                                    mov     esp, ebx
   325 000001E4 A900000400                              test    eax, 40000h
   326 000001E9 7431                                    jz      short .no_id
   327 000001EB FE05[018B0000]                          inc	byte [detected_cpu]
   328 000001F1 E827000000                              call    @@get_id_flag
   329 000001F6 7507                                    jnz     short .yep_id
   330 000001F8 E820000000                              call    @@get_id_flag
   331 000001FD 741D                                    jz      short .no_id
   332                                  
   333                                  .yep_id:
   334 000001FF B801000000                              mov     eax, 1
   335 00000204 0FA2                                    cpuid
   336 00000206 80E40F                                  and     ah, 0Fh
   337 00000209 8825[018B0000]                          mov     [detected_cpu], ah
   338 0000020F C605[008B0000]01                        mov	byte [cpuid_exists], 1
   339 00000216 8915[FC8A0000]                          mov     [cpuid_flags], edx
   340                                  
   341                                  .no_id:
   342 0000021C C3                                      retn
   343                                  
   344                                  ; =============== S U B R O U T I N E =======================================
   345                                  
   346                                  
   347                                  @@get_id_flag:
   348 0000021D 9C                                      pushf
   349 0000021E 58                                      pop     eax
   350 0000021F 0D00002000                              or      eax, 200000h
   351 00000224 50                                      push    eax
   352 00000225 9D                                      popf
   353 00000226 9C                                      pushf
   354 00000227 58                                      pop     eax
   355 00000228 A900002000                              test    eax, 200000h
   356 0000022D C3                                      retn
   357                                  
   358                                  ; =============== S U B R O U T I N E =======================================
   359                                  
   360                                  bswap_eax:
   361 0000022E 86E0                                    xchg    al, ah
   362 00000230 C1C810                                  ror     eax, 10h
   363 00000233 86E0                                    xchg    al, ah
   364 00000235 C3                                      retn
   365                                  
   366                                  ; =============== S U B R O U T I N E =======================================
   367                                  
   368                                  mp3_recollect_bits:
   369 00000236 F7C601000000                            test    esi, 1
   370 0000023C 7510                                    jnz     short .odd
   371 0000023E 668B2E                                  mov     bp, [esi]
   372 00000241 83C602                                  add     esi, 2
   373 00000244 66C1CD08                                ror     bp, 8
   374 00000248 C1E510                                  shl     ebp, 16
   375 0000024B B500                                    mov     ch, 0
   376 0000024D C3                                      retn
   377                                  
   378                                  .odd:
   379 0000024E 0FB62E                                  movzx   ebp, byte [esi]
   380 00000251 46                                      inc     esi
   381 00000252 C1E510                                  shl     ebp, 16
   382 00000255 668B2E                                  mov     bp, [esi]
   383 00000258 83C602                                  add     esi, 2
   384 0000025B 66C1CD08                                ror     bp, 8
   385 0000025F C1E508                                  shl     ebp, 8
   386 00000262 B508                                    mov     ch, 8
   387 00000264 C3                                      retn
   388                                  
   389                                  ; =============== S U B R O U T I N E =======================================
   390                                  
   391                                  
   392                                  mp3_get_bits:
   393 00000265 89E8                                    mov     eax, ebp
   394 00000267 D3E5                                    shl     ebp, cl
   395 00000269 D3C0                                    rol     eax, cl
   396 0000026B 31E8                                    xor     eax, ebp
   397 0000026D 28CD                                    sub     ch, cl
   398 0000026F 7801                                    js      short mp3_collect_more
   399 00000271 C3                                      retn
   400                                  
   401                                  mp3_collect_more:
   402 00000272 88E9                                    mov     cl, ch
   403 00000274 80C510                                  add     ch, 10h
   404 00000277 D3C5                                    rol     ebp, cl
   405 00000279 668B2E                                  mov     bp, [esi]
   406 0000027C 83C602                                  add     esi, 2
   407 0000027F 66C1CD08                                ror     bp, 8
   408 00000283 D3CD                                    ror     ebp, cl
   409 00000285 C3                                      retn
   410                                  
   411                                  ; =============== S U B R O U T I N E =======================================
   412                                  
   413                                  
   414                                  mp3_uncollect_bits:
   415 00000286 83EE02                                  sub     esi, 2
   416 00000289 C0ED03                                  shr     ch, 3
   417 0000028C 0FB6CD                                  movzx   ecx, ch
   418 0000028F 29CE                                    sub     esi, ecx
   419 00000291 C3                                      retn
   420                                  
   421                                  ; =============== S U B R O U T I N E =======================================
   422                                  
   423                                  
   424                                  mp3_search_get_header:
   425 00000292 F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
   426 00000299 740E                                    jz      short .no_rdtsc_supported
   427 0000029B 0F31                                    rdtsc
   428 0000029D 2905[0C8B0000]                          sub     [ttt], eax
   429 000002A3 1915[108B0000]                          sbb     [ttt+4], edx
   430                                  
   431                                  .no_rdtsc_supported:
   432 000002A9 C705[5C090100]0000-                     mov	dword [mp3_extra_bytes], 0
   432 000002B1 0000               
   433                                  
   434                                  .retry_header:
   435 000002B3 833D[58090100]04                        cmp	dword [mp3_src_remain], 4
   436 000002BA 0F82B5010000                            jb      .fail_no_header
   437 000002C0 803EFF                                  cmp     byte [esi], 0FFh
   438 000002C3 7516                                    jnz     short .bad_header
   439 000002C5 8A4601                                  mov     al, [esi+1]
   440 000002C8 24E6                                    and     al, 0E6h
   441 000002CA 3CE2                                    cmp     al, 0E2h
   442 000002CC 750D                                    jnz     short .bad_header
   443 000002CE 8A4602                                  mov     al, [esi+2]
   444 000002D1 3CF0                                    cmp     al, 0F0h
   445 000002D3 7306                                    jnb     short .bad_header
   446 000002D5 240C                                    and     al, 0Ch
   447 000002D7 3C0C                                    cmp     al, 0Ch
   448 000002D9 7519                                    jnz     short .good_header
   449                                  
   450                                  .bad_header:
   451 000002DB 46                                      inc	esi
   452 000002DC FF0D[58090100]                          dec	dword [mp3_src_remain]
   453 000002E2 FF05[5C090100]                          inc	dword [mp3_extra_bytes]
   454 000002E8 C705[48B20000]-                         mov	dword [main_data_pool_wr_ptr], main_data_pool_start
   454 000002EE [48A20000]         
   455 000002F2 EBBF                                    jmp	short .retry_header
   456                                  
   457                                  .good_header:
   458 000002F4 8B06                                    mov	eax, [esi]
   459 000002F6 E833FFFFFF                              call	bswap_eax
   460 000002FB A3[58B20000]                            mov	[mp3_hdr_32bit_header], eax
   461 00000300 C705[98B20000]0000-                     mov	dword [mp3_hdr_flag_lsf], 0
   461 00000308 0000               
   462 0000030A C705[60B20000]0000-                     mov	dword [mp3_hdr_flag_mpeg25], 0
   462 00000312 0000               
   463 00000314 C705[68090100]0200-                     mov	dword [mp3_nb_granules], 2
   463 0000031C 0000               
   464 0000031E A900000800                              test	eax, 80000h
   465 00000323 7525                                    jnz	short .lsf_this
   466 00000325 C705[98B20000]0100-                     mov	dword [mp3_hdr_flag_lsf], 1
   466 0000032D 0000               
   467 0000032F C705[68090100]0100-                     mov	dword [mp3_nb_granules], 1
   467 00000337 0000               
   468 00000339 A900001000                              test	eax, 100000h
   469 0000033E 750A                                    jnz	short .lsf_this
   470 00000340 C705[60B20000]0100-                     mov	dword [mp3_hdr_flag_mpeg25], 1
   470 00000348 0000               
   471                                  
   472                                  .lsf_this:
   473 0000034A C1E80A                                  shr     eax, 10
   474 0000034D 83E003                                  and     eax, 3
   475 00000350 8B0D[98B20000]                          mov     ecx, [mp3_hdr_flag_lsf]
   476 00000356 030D[60B20000]                          add     ecx, [mp3_hdr_flag_mpeg25]
   477 0000035C 0FB79400[148D0000]                      movzx   edx, word [mp3_freq_tab+eax*2]
   478 00000364 D3EA                                    shr     edx, cl
   479 00000366 8D0C49                                  lea     ecx, [ecx+ecx*2]
   480 00000369 01C8                                    add     eax, ecx
   481 0000036B A3[6CB20000]                            mov     [mp3_hdr_sample_rate_index], eax
   482 00000370 8915[68B20000]                          mov     [mp3_sample_rate], edx
   483                                  
   484 00000376 8A0D[F98A0000]                          mov     cl, [option_rate_shift]
   485 0000037C D3EA                                    shr     edx, cl
   486                                  
   487 0000037E 8915[7CB20000]                          mov     [mp3_output_sample_rate], edx
   488 00000384 A1[58B20000]                            mov     eax, [mp3_hdr_32bit_header]
   489 00000389 C1E810                                  shr     eax, 10h
   490 0000038C F7D0                                    not     eax
   491 0000038E 83E001                                  and     eax, 1
   492 00000391 A3[5CB20000]                            mov     [mp3_hdr_flag_crc], eax
   493 00000396 A1[58B20000]                            mov     eax, [mp3_hdr_32bit_header]
   494 0000039B C1E809                                  shr     eax, 9
   495 0000039E 83E001                                  and     eax, 1
   496 000003A1 A3[64B20000]                            mov     [mp3_hdr_flag_padding], eax
   497 000003A6 A1[58B20000]                            mov     eax, [mp3_hdr_32bit_header]
   498 000003AB C1E80C                                  shr     eax, 12
   499 000003AE 83E00F                                  and     eax, 0Fh
   500 000003B1 7512                                    jnz     short .not_free_format
   501 000003B3 E85A5D0000                              call    mp3_detect_free_format_block_size
   502 000003B8 0F821DFFFFFF                            jb      .bad_header
   503 000003BE A1[A8080100]                            mov     eax, [mp3_free_format_frame_size]
   504 000003C3 EB34                                    jmp     short .this_frame_size_plus_padding
   505                                  
   506                                  .not_free_format:
   507 000003C5 8B15[98B20000]                          mov     edx, [mp3_hdr_flag_lsf]
   508 000003CB C1E204                                  shl     edx, 4
   509 000003CE 01D0                                    add     eax, edx
   510 000003D0 0FB78400[D48C0000]                      movzx   eax, word [mp3_bitrate_tab+eax*2] ; kbit/s
   511 000003D8 69C0E8030000                            imul    eax, 1000       ; bit/s
   512 000003DE A3[70B20000]                            mov     [mp3_bit_rate], eax
   513 000003E3 69C090000000                            imul    eax, 144        ; 144=90h=8*18
   514 000003E9 31D2                                    xor     edx, edx
   515 000003EB F735[68B20000]                          div     dword [mp3_sample_rate]
   516 000003F1 8B0D[98B20000]                          mov     ecx, [mp3_hdr_flag_lsf]
   517 000003F7 D3E8                                    shr     eax, cl
   518                                  
   519                                  .this_frame_size_plus_padding:
   520 000003F9 0305[64B20000]                          add     eax, [mp3_hdr_flag_padding]
   521 000003FF A3[50B20000]                            mov     [mp3_src_frame_size], eax
   522 00000404 01F0                                    add     eax, esi
   523 00000406 A3[54B20000]                            mov     [mp3_src_frame_end], eax
   524 0000040B A1[58B20000]                            mov     eax, [mp3_hdr_32bit_header]
   525 00000410 C1E806                                  shr     eax, 6
   526 00000413 83E003                                  and     eax, 3
   527 00000416 A3[90B20000]                            mov     [mp3_hdr_mode_val], eax
   528 0000041B BA01000000                              mov     edx, 1
   529                                  
   530 00000420 3C03                    		cmp     al, 3
   531 00000422 7401                                    jz      short .this_channels
   532                                  
   533                                                  ;mov    edx, 2
   534                                  		; 10/01/2025
   535 00000424 42                      		inc	edx
   536                                  .this_channels:
   537 00000425 8915[74B20000]                          mov	[mp3_src_num_channels], edx
   538 0000042B 803D[F78A0000]00                        cmp	byte [option_mono], 0
   539 00000432 7405                                    jz	short .allow_stereo
   540 00000434 BA01000000                              mov	edx, 1
   541                                  .allow_stereo:
   542 00000439 8915[78B20000]                          mov     [mp3_output_num_channels], edx
   543 0000043F 0FAF15[80B20000]                        imul    edx, [mp3_bytes_per_sample]
   544 00000446 8915[44090100]                          mov     [mp3_samples_dst_step], edx
   545 0000044C A1[58B20000]                            mov     eax, [mp3_hdr_32bit_header]
   546 00000451 C1E804                                  shr     eax, 4
   547 00000454 83E003                                  and     eax, 3
   548 00000457 A3[94B20000]                            mov     [mp3_hdr_mode_ext], eax
   549 0000045C F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
   550 00000463 740E                                    jz      short .no_rdtsc_supported@
   551 00000465 0F31                                    rdtsc
   552 00000467 0105[0C8B0000]                          add     [ttt], eax
   553 0000046D 1115[108B0000]                          adc     [ttt+4], edx
   554                                  
   555                                  .no_rdtsc_supported@:
   556 00000473 F8                                      clc
   557 00000474 C3                                      retn
   558                                  
   559                                  .fail_no_header:
   560 00000475 F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
   561 0000047C 740E                                    jz      short .no_rdtsc_supported@@
   562 0000047E 0F31                                    rdtsc
   563 00000480 0105[0C8B0000]                          add     [ttt], eax
   564 00000486 1115[108B0000]                          adc     [ttt+4], edx
   565                                  
   566                                  .no_rdtsc_supported@@:
   567 0000048C C705[50B20000]0000-                     mov     dword [mp3_src_frame_size], 0
   567 00000494 0000               
   568 00000496 F9                                      stc
   569 00000497 C3                                      retn
   570                                  
   571                                  
   572                                  ; =============== S U B R O U T I N E =======================================
   573                                  
   574                                  
   575                                  mp3_bitstream_read_header_extra:
   576 00000498 F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
   577 0000049F 740E                                    jz      short .no_rdtsc_supported
   578 000004A1 0F31                                    rdtsc
   579 000004A3 2905[248B0000]                          sub     [rdtsc_read_header_extra], eax
   580 000004A9 1915[288B0000]                          sbb     [rdtsc_read_header_extra+4], edx
   581                                  
   582                                  .no_rdtsc_supported:
   583 000004AF 833D[5CB20000]00                        cmp     dword [mp3_hdr_flag_crc], 0
   584 000004B6 7422                                    jz      short .without_crc
   585 000004B8 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 16
   586 000004BA C1E510                                  shl     ebp, 10h
   587 000004BD C1C010                                  rol     eax, 10h
   588 000004C0 31E8                                    xor     eax, ebp
   589 000004C2 80ED10                                  sub     ch, 10h
   590 000004C5 7913                                    jns     short .without_crc
   591 000004C7 88E9                                    mov     cl, ch          ; mp3mac_collect_more
   592 000004C9 80C510                                  add     ch, 10h
   593 000004CC D3C5                                    rol     ebp, cl
   594 000004CE 668B2E                                  mov     bp, [esi]
   595 000004D1 83C602                                  add     esi, 2
   596 000004D4 66C1CD08                                ror     bp, 8
   597 000004D8 D3CD                                    ror     ebp, cl
   598                                  
   599                                  .without_crc:
   600 000004DA 833D[98B20000]00                        cmp     dword [mp3_hdr_flag_lsf], 0
   601 000004E1 745B                                    jz      short .pre_lsf_zero
   602 000004E3 C705[64090100]0900-                     mov     dword [mp3_num_compress_bits], 9
   602 000004EB 0000               
   603 000004ED 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 8
   604 000004EF C1E508                                  shl     ebp, 8
   605 000004F2 C1C008                                  rol     eax, 8
   606 000004F5 31E8                                    xor     eax, ebp
   607 000004F7 80ED08                                  sub     ch, 8
   608 000004FA 7913                                    jns     short .without_crc@
   609 000004FC 88E9                                    mov     cl, ch
   610 000004FE 80C510                                  add     ch, 10h
   611 00000501 D3C5                                    rol     ebp, cl
   612 00000503 668B2E                                  mov     bp, [esi]
   613 00000506 83C602                                  add     esi, 2
   614 00000509 66C1CD08                                ror     bp, 8
   615 0000050D D3CD                                    ror     ebp, cl
   616                                  
   617                                  .without_crc@:
   618 0000050F A3[60090100]                            mov     [mp3_main_data_begin], eax
   619 00000514 8A0D[74B20000]                          mov     cl, byte [mp3_src_num_channels]
   620 0000051A 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits cl
   621 0000051C D3E5                                    shl     ebp, cl
   622 0000051E D3C0                                    rol     eax, cl
   623 00000520 31E8                                    xor     eax, ebp
   624 00000522 28CD                                    sub     ch, cl
   625 00000524 7913                                    jns     short .without_crc@@
   626 00000526 88E9                                    mov     cl, ch
   627 00000528 80C510                                  add     ch, 10h
   628 0000052B D3C5                                    rol     ebp, cl
   629 0000052D 668B2E                                  mov     bp, [esi]
   630 00000530 83C602                                  add     esi, 2
   631 00000533 66C1CD08                                ror     bp, 8
   632 00000537 D3CD                                    ror     ebp, cl
   633                                  
   634                                  .without_crc@@:
   635 00000539 E9A1000000                              jmp     .pre_lsf_done
   636                                  
   637                                  .pre_lsf_zero:
   638 0000053E C705[64090100]0400-                     mov     dword [mp3_num_compress_bits], 4
   638 00000546 0000               
   639 00000548 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 9
   640 0000054A C1E509                                  shl     ebp, 9
   641 0000054D C1C009                                  rol     eax, 9
   642 00000550 31E8                                    xor     eax, ebp
   643 00000552 80ED09                                  sub     ch, 9
   644 00000555 7913                                    jns     short .without_crc@@@
   645 00000557 88E9                                    mov     cl, ch
   646 00000559 80C510                                  add     ch, 10h
   647 0000055C D3C5                                    rol     ebp, cl
   648 0000055E 668B2E                                  mov     bp, [esi]
   649 00000561 83C602                                  add     esi, 2
   650 00000564 66C1CD08                                ror     bp, 8
   651 00000568 D3CD                                    ror     ebp, cl
   652                                  
   653                                  .without_crc@@@:
   654 0000056A A3[60090100]                            mov     [mp3_main_data_begin], eax
   655 0000056F 8A0D[74B20000]                          mov     cl, byte [mp3_src_num_channels]
   656 00000575 D0E1                                    shl     cl, 1           ; 1,2 --> 2,4
   657 00000577 80F107                                  xor     cl, 7           ;     --> 5,3
   658 0000057A 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits cl
   659 0000057C D3E5                                    shl     ebp, cl
   660 0000057E D3C0                                    rol     eax, cl
   661 00000580 31E8                                    xor     eax, ebp
   662 00000582 28CD                                    sub     ch, cl
   663 00000584 7913                                    jns     short .without_crc@@@@
   664 00000586 88E9                                    mov     cl, ch
   665 00000588 80C510                                  add     ch, 10h
   666 0000058B D3C5                                    rol     ebp, cl
   667 0000058D 668B2E                                  mov     bp, [esi]
   668 00000590 83C602                                  add     esi, 2
   669 00000593 66C1CD08                                ror     bp, 8
   670 00000597 D3CD                                    ror     ebp, cl
   671                                  
   672                                  .without_crc@@@@:
   673 00000599 8B15[74B20000]                          mov     edx, [mp3_src_num_channels]
   674 0000059F BB[6C090100]                            mov     ebx, mp3_granules
   675                                  
   676                                  .pre_channel_lop:
   677 000005A4 C7432800000000                          mov     dword [ebx+40], 0 ; [ebx+$mp3gr_scfsi]
   678 000005AB 81C3A0090000                            add     ebx, 2464       ; $mp3gr_entrysiz
   679 000005B1 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 4
   680 000005B3 C1E504                                  shl     ebp, 4
   681 000005B6 C1C004                                  rol     eax, 4
   682 000005B9 31E8                                    xor     eax, ebp
   683 000005BB 80ED04                                  sub     ch, 4
   684 000005BE 7913                                    jns     short .without_crc@@@@@
   685 000005C0 88E9                                    mov     cl, ch
   686 000005C2 80C510                                  add     ch, 10h
   687 000005C5 D3C5                                    rol     ebp, cl
   688 000005C7 668B2E                                  mov     bp, [esi]
   689 000005CA 83C602                                  add     esi, 2
   690 000005CD 66C1CD08                                ror     bp, 8
   691 000005D1 D3CD                                    ror     ebp, cl
   692                                  
   693                                  .without_crc@@@@@:
   694 000005D3 894328                                  mov     [ebx+28h], eax  ; [ebx+$mp3gr_scfsi]
   695 000005D6 81C3A0090000                            add     ebx, 2464       ; $mp3gr_entrysiz
   696 000005DC 4A                                      dec     edx
   697 000005DD 75C5                                    jnz     short .pre_channel_lop
   698                                  
   699                                  .pre_lsf_done:
   700 000005DF A1[68090100]                            mov     eax, [mp3_nb_granules]
   701 000005E4 6BC012                                  imul    eax, 12h
   702 000005E7 A3[8CB20000]                            mov     [mp3_nb_frames], eax
   703                                  		; 14/01/2025
   704                                  		;mov	eax, [mp3_nb_frames]
   705 000005EC 0FAF05[78B20000]                        imul    eax, [mp3_output_num_channels]
   706 000005F3 0FAF05[80B20000]                        imul    eax, [mp3_bytes_per_sample]
   707 000005FA C1E005                                  shl     eax, 5
   708 000005FD 8A0D[F98A0000]                          mov     cl, [option_rate_shift]
   709 00000603 D3E8                                    shr     eax, cl
   710 00000605 A3[40090100]                            mov     [mp3_samples_output_size], eax
   711 0000060A F605[FC8A0000]10                        test    byte [cpuid_flags], 10h ; timelog_end rdtsc_read_header_extra
   712 00000611 740E                                    jz      short .no_rdtsc_supported@
   713 00000613 0F31                                    rdtsc
   714 00000615 0105[248B0000]                          add     [rdtsc_read_header_extra], eax
   715 0000061B 1115[288B0000]                          adc     [rdtsc_read_header_extra+4], edx
   716                                  
   717                                  .no_rdtsc_supported@:
   718 00000621 C3                                      retn
   719                                  
   720                                  
   721                                  ; =============== S U B R O U T I N E =======================================
   722                                  
   723                                  
   724                                  mp3_bitstream_read_granules:
   725 00000622 F605[FC8A0000]10                        test    byte [cpuid_flags], 10h ; timelog_start rdtsc_read_granule
   726 00000629 740E                                    jz      short .no_rdtsc_supported
   727 0000062B 0F31                                    rdtsc
   728 0000062D 2905[3C8B0000]                          sub     [rdtsc_read_granule], eax
   729 00000633 1915[408B0000]                          sbb     [rdtsc_read_granule+4], edx
   730                                  
   731                                  .no_rdtsc_supported:
   732 00000639 8925[60340500]                          mov	[_@@saved_sp], esp
   733 0000063F C705[64340500]0000-                     mov	dword [mp3_main_data_siz], 0
   733 00000647 0000               
   734 00000649 C705[4C090100]0000-                     mov	dword [mp3_curr_granule], 0
   734 00000651 0000               
   735 00000653 BB[6C090100]                            mov	ebx, mp3_granules
   736                                  
   737                                  .hdr_granule_lop:
   738 00000658 53                                      push    ebx
   739 00000659 C705[48090100]0000-                     mov     dword [mp3_curr_channel], 0
   739 00000661 0000               
   740                                  
   741                                  .hdr_channel_lop:
   742 00000663 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 12
   743 00000665 C1E50C                                  shl     ebp, 12
   744 00000668 C1C00C                                  rol     eax, 12
   745 0000066B 31E8                                    xor     eax, ebp
   746 0000066D 80ED0C                                  sub     ch, 12
   747 00000670 7913                                    jns     short .without_crc
   748 00000672 88E9                                    mov     cl, ch
   749 00000674 80C510                                  add     ch, 16
   750 00000677 D3C5                                    rol     ebp, cl
   751 00000679 668B2E                                  mov     bp, [esi]
   752 0000067C 83C602                                  add     esi, 2
   753 0000067F 66C1CD08                                ror     bp, 8
   754 00000683 D3CD                                    ror     ebp, cl
   755                                  
   756                                  .without_crc:
   757 00000685 8B15[64340500]                          mov     edx, [mp3_main_data_siz]
   758 0000068B 8903                                    mov     [ebx], eax
   759 0000068D 895304                                  mov     [ebx+4], edx
   760 00000690 01D0                                    add     eax, edx
   761 00000692 894308                                  mov     [ebx+8], eax
   762 00000695 A3[64340500]                            mov     [mp3_main_data_siz], eax
   763 0000069A 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 9
   764 0000069C C1E509                                  shl     ebp, 9
   765 0000069F C1C009                                  rol     eax, 9
   766 000006A2 31E8                                    xor     eax, ebp
   767 000006A4 80ED09                                  sub     ch, 9
   768 000006A7 7913                                    jns     short .without_crc@
   769 000006A9 88E9                                    mov     cl, ch
   770 000006AB 80C510                                  add     ch, 10h
   771 000006AE D3C5                                    rol     ebp, cl
   772 000006B0 668B2E                                  mov     bp, [esi]
   773 000006B3 83C602                                  add     esi, 2
   774 000006B6 66C1CD08                                ror     bp, 8
   775 000006BA D3CD                                    ror     ebp, cl
   776                                  
   777                                  .without_crc@:
   778 000006BC 89430C                                  mov     [ebx+12], eax   ; [ebx+$mp3gr_big_values]
   779 000006BF 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 8
   780 000006C1 C1E508                                  shl     ebp, 8
   781 000006C4 C1C008                                  rol     eax, 8
   782 000006C7 31E8                                    xor     eax, ebp
   783 000006C9 80ED08                                  sub     ch, 8
   784 000006CC 7913                                    jns     short .without_crc@@
   785 000006CE 88E9                                    mov     cl, ch
   786 000006D0 80C510                                  add     ch, 10h
   787 000006D3 D3C5                                    rol     ebp, cl
   788 000006D5 668B2E                                  mov     bp, [esi]
   789 000006D8 83C602                                  add     esi, 2
   790 000006DB 66C1CD08                                ror     bp, 8
   791 000006DF D3CD                                    ror     ebp, cl
   792                                  
   793                                  .without_crc@@:
   794 000006E1 05BE000000                              add	eax, 190        ; 400-210
   795 000006E6 833D[90B20000]01                        cmp	dword [mp3_hdr_mode_val], 1
   796 000006ED 750F                                    jnz	short .not_ms_stereo
   797 000006EF F705[94B20000]0200-                     test	dword [mp3_hdr_mode_ext], 2
   797 000006F7 0000               
   798 000006F9 7403                                    jz	short .not_ms_stereo
   799 000006FB 83E802                                  sub	eax, 2
   800                                  
   801                                  .not_ms_stereo:
   802 000006FE 894310                                  mov     [ebx+16], eax   ; [ebx+$mp3gr_global_gain]
   803 00000701 8A0D[64090100]                          mov     cl, byte [mp3_num_compress_bits]
   804 00000707 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits cl
   805 00000709 D3E5                                    shl     ebp, cl
   806 0000070B D3C0                                    rol     eax, cl
   807 0000070D 31E8                                    xor     eax, ebp
   808 0000070F 28CD                                    sub     ch, cl
   809 00000711 7913                                    jns     short .without_crc@@@
   810 00000713 88E9                                    mov     cl, ch
   811 00000715 80C510                                  add     ch, 10h
   812 00000718 D3C5                                    rol     ebp, cl
   813 0000071A 668B2E                                  mov     bp, [esi]
   814 0000071D 83C602                                  add     esi, 2
   815 00000720 66C1CD08                                ror     bp, 8
   816 00000724 D3CD                                    ror     ebp, cl
   817                                  
   818                                  .without_crc@@@:
   819 00000726 894314                                  mov     [ebx+20], eax   ; [ebx+$mp3gr_scalefac_compress]
   820 00000729 FECD                                    dec     ch              ; mp3mac_get_bit_to_cy
   821                                                                          ; dec mp3_colNN
   822 0000072B D1E5                                    shl     ebp, 1          ; shl mp3_col32,1 ; cy=data
   823 0000072D 0F834F010000                            jnb     .no_blocksplit
   824 00000733 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 2
   825 00000735 C1E502                                  shl     ebp, 2
   826 00000738 C1C002                                  rol     eax, 2
   827 0000073B 31E8                                    xor     eax, ebp
   828 0000073D 80ED02                                  sub     ch, 2
   829 00000740 7913                                    jns     short .without_crc@@@@
   830 00000742 88E9                                    mov     cl, ch
   831 00000744 80C510                                  add     ch, 10h
   832 00000747 D3C5                                    rol     ebp, cl
   833 00000749 668B2E                                  mov     bp, [esi]
   834 0000074C 83C602                                  add     esi, 2
   835 0000074F 66C1CD08                                ror     bp, 8
   836 00000753 D3CD                                    ror     ebp, cl
   837                                  
   838                                  .without_crc@@@@:
   839 00000755 83F800                                  cmp     eax, 0
   840 00000758 0F847B030000                            jz      .error
   841 0000075E 89432C                                  mov     [ebx+44], eax   ; [ebx+$mp3gr_block_type]
   842 00000761 83F802                                  cmp     eax, 2
   843 00000764 B812000000                              mov     eax, 18         ; 36/2 ; region_size (default)
   844 00000769 741C                                    jz      short .this_region_size
   845 0000076B 833D[6CB20000]02                        cmp     dword [mp3_hdr_sample_rate_index], 2
   846 00000772 7613                                    jbe     short .this_region_size
   847 00000774 B81B000000                              mov     eax, 27         ; 54/2 ; region_size
   848 00000779 833D[6CB20000]08                        cmp     dword [mp3_hdr_sample_rate_index], 8
   849 00000780 7505                                    jnz     short .this_region_size
   850 00000782 B836000000                              mov     eax, 54         ; 108/2 ; region_size (for rate=8)
   851                                  
   852                                  .this_region_size:
   853 00000787 894350                                  mov     [ebx+80], eax   ; [ebx+$mp3gr_region_size+0*4]
   854 0000078A C7435420010000                          mov     dword [ebx+84], 288 ; [ebx+$mp3gr_region_size+1*4],576/2
   855 00000791 C7435820010000                          mov     dword [ebx+88], 288 ; [ebx+$mp3gr_region_size+2*4],576/2
   856 00000798 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 1
   857 0000079A D1E5                                    shl     ebp, 1
   858 0000079C D1C0                                    rol     eax, 1
   859 0000079E 31E8                                    xor     eax, ebp
   860 000007A0 80ED01                                  sub     ch, 1
   861 000007A3 7913                                    jns     short .without_crc@@@@@
   862 000007A5 88E9                                    mov     cl, ch
   863 000007A7 80C510                                  add     ch, 10h
   864 000007AA D3C5                                    rol     ebp, cl
   865 000007AC 668B2E                                  mov     bp, [esi]
   866 000007AF 83C602                                  add     esi, 2
   867 000007B2 66C1CD08                                ror     bp, 8
   868 000007B6 D3CD                                    ror     ebp, cl
   869                                  
   870                                  .without_crc@@@@@:
   871 000007B8 894330                                  mov     [ebx+48], eax   ; [ebx+$mp3gr_switch_point]
   872 000007BB 89E8                                    mov     eax, ebp        ; IRP nn,0,1 ; only 0..1 for blocksplit
   873 000007BD C1E505                                  shl     ebp, 5          ; mp3mac_get_n_bits 5
   874 000007C0 C1C005                                  rol     eax, 5
   875 000007C3 31E8                                    xor     eax, ebp
   876 000007C5 80ED05                                  sub     ch, 5
   877 000007C8 7913                                    jns     short .without_crc@@@@@@
   878 000007CA 88E9                                    mov     cl, ch
   879 000007CC 80C510                                  add     ch, 10h
   880 000007CF D3C5                                    rol     ebp, cl
   881 000007D1 668B2E                                  mov     bp, [esi]
   882 000007D4 83C602                                  add     esi, 2
   883 000007D7 66C1CD08                                ror     bp, 8
   884 000007DB D3CD                                    ror     ebp, cl
   885                                  
   886                                  .without_crc@@@@@@:
   887 000007DD 894338                                  mov     [ebx+56], eax   ; [ebx+$mp3gr_table_select+nn*4] ; nn=0
   888 000007E0 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 5
   889 000007E2 C1E505                                  shl     ebp, 5
   890 000007E5 C1C005                                  rol     eax, 5
   891 000007E8 31E8                                    xor     eax, ebp
   892 000007EA 80ED05                                  sub     ch, 5
   893 000007ED 7913                                    jns     short .without_crc_@@@@
   894 000007EF 88E9                                    mov     cl, ch
   895 000007F1 80C510                                  add     ch, 10h
   896 000007F4 D3C5                                    rol     ebp, cl
   897 000007F6 668B2E                                  mov     bp, [esi]
   898 000007F9 83C602                                  add     esi, 2
   899 000007FC 66C1CD08                                ror     bp, 8
   900 00000800 D3CD                                    ror     ebp, cl
   901                                  
   902                                  .without_crc_@@@@:
   903 00000802 89433C                                  mov     [ebx+60], eax   ; [ebx+$mp3gr_table_select+nn*4] ; nn=1
   904 00000805 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 5
   905 00000807 C1E503                                  shl     ebp, 3          ; IRP nn,0,1,2
   906 0000080A C1C003                                  rol     eax, 3          ; mp3mac_get_n_bits 3
   907 0000080D 31E8                                    xor     eax, ebp
   908 0000080F 80ED03                                  sub     ch, 3
   909 00000812 7913                                    jns     short .without_crc_@@@@@
   910 00000814 88E9                                    mov     cl, ch
   911 00000816 80C510                                  add     ch, 10h
   912 00000819 D3C5                                    rol     ebp, cl
   913 0000081B 668B2E                                  mov     bp, [esi]
   914 0000081E 83C602                                  add     esi, 2
   915 00000821 66C1CD08                                ror     bp, 8
   916 00000825 D3CD                                    ror     ebp, cl
   917                                  
   918                                  .without_crc_@@@@@:
   919 00000827 C1E003                                  shl     eax, 3
   920 0000082A 894344                                  mov     [ebx+68], eax   ; [ebx+$mp3gr_subblock_gain+nn*4] ; nn=0
   921 0000082D 89E8                                    mov     eax, ebp
   922 0000082F C1E503                                  shl     ebp, 3
   923 00000832 C1C003                                  rol     eax, 3
   924 00000835 31E8                                    xor     eax, ebp
   925 00000837 80ED03                                  sub     ch, 3
   926 0000083A 7913                                    jns     short .without_crc_@@@@@@
   927 0000083C 88E9                                    mov     cl, ch
   928 0000083E 80C510                                  add     ch, 10h
   929 00000841 D3C5                                    rol     ebp, cl
   930 00000843 668B2E                                  mov     bp, [esi]
   931 00000846 83C602                                  add     esi, 2
   932 00000849 66C1CD08                                ror     bp, 8
   933 0000084D D3CD                                    ror     ebp, cl
   934                                  
   935                                  .without_crc_@@@@@@:
   936 0000084F C1E003                                  shl     eax, 3
   937 00000852 894348                                  mov     [ebx+72], eax   ; [ebx+$mp3gr_subblock_gain+nn*4] ; nn=1
   938 00000855 89E8                                    mov     eax, ebp
   939 00000857 C1E503                                  shl     ebp, 3
   940 0000085A C1C003                                  rol     eax, 3
   941 0000085D 31E8                                    xor     eax, ebp
   942 0000085F 80ED03                                  sub     ch, 3
   943 00000862 7913                                    jns     short .without_crc_@@@@@@@
   944 00000864 88E9                                    mov     cl, ch
   945 00000866 80C510                                  add     ch, 10h
   946 00000869 D3C5                                    rol     ebp, cl
   947 0000086B 668B2E                                  mov     bp, [esi]
   948 0000086E 83C602                                  add     esi, 2
   949 00000871 66C1CD08                                ror     bp, 8
   950 00000875 D3CD                                    ror     ebp, cl
   951                                  
   952                                  .without_crc_@@@@@@@:
   953 00000877 C1E003                                  shl     eax, 3
   954 0000087A 89434C                                  mov     [ebx+76], eax   ; [ebx+$mp3gr_subblock_gain+nn*4] ; nn=2
   955 0000087D E910010000                              jmp     .blocksplit_done
   956                                  
   957                                  .no_blocksplit:                       
   958 00000882 C7432C00000000                          mov     dword [ebx+44], 0 ; [ebx+$mp3gr_block_type]
   959 00000889 C7433000000000                          mov     dword [ebx+48], 0 ; [ebx+$mp3gr_switch_point]
   960 00000890 89E8                                    mov     eax, ebp        ; IRP nn,0,1,2 ; range 0..2 when non-blocksplit
   961 00000892 C1E505                                  shl     ebp, 5          ; mp3mac_get_n_bits 5
   962 00000895 C1C005                                  rol     eax, 5
   963 00000898 31E8                                    xor     eax, ebp
   964 0000089A 80ED05                                  sub     ch, 5
   965 0000089D 7913                                    jns     short .@_without_crc
   966 0000089F 88E9                                    mov     cl, ch
   967 000008A1 80C510                                  add     ch, 10h
   968 000008A4 D3C5                                    rol     ebp, cl
   969 000008A6 668B2E                                  mov     bp, [esi]
   970 000008A9 83C602                                  add     esi, 2
   971 000008AC 66C1CD08                                ror     bp, 8
   972 000008B0 D3CD                                    ror     ebp, cl
   973                                  
   974                                  .@_without_crc:
   975 000008B2 894338                                  mov     [ebx+56], eax   ; [ebx+$mp3gr_table_select+nn*4] ; nn=0
   976 000008B5 89E8                                    mov     eax, ebp
   977 000008B7 C1E505                                  shl     ebp, 5
   978 000008BA C1C005                                  rol     eax, 5
   979 000008BD 31E8                                    xor     eax, ebp
   980 000008BF 80ED05                                  sub     ch, 5
   981 000008C2 7913                                    jns     short .@_without_crc_@
   982 000008C4 88E9                                    mov     cl, ch
   983 000008C6 80C510                                  add     ch, 10h
   984 000008C9 D3C5                                    rol     ebp, cl
   985 000008CB 668B2E                                  mov     bp, [esi]
   986 000008CE 83C602                                  add     esi, 2
   987 000008D1 66C1CD08                                ror     bp, 8
   988 000008D5 D3CD                                    ror     ebp, cl
   989                                  
   990                                  .@_without_crc_@:
   991 000008D7 89433C                                  mov     [ebx+60], eax   ; [ebx+$mp3gr_table_select+nn*4] ; nn=1
   992 000008DA 89E8                                    mov     eax, ebp
   993 000008DC C1E505                                  shl     ebp, 5
   994 000008DF C1C005                                  rol     eax, 5
   995 000008E2 31E8                                    xor     eax, ebp
   996 000008E4 80ED05                                  sub     ch, 5
   997 000008E7 7913                                    jns     short .@_without_crc_@@
   998 000008E9 88E9                                    mov     cl, ch
   999 000008EB 80C510                                  add     ch, 10h
  1000 000008EE D3C5                                    rol     ebp, cl
  1001 000008F0 668B2E                                  mov     bp, [esi]
  1002 000008F3 83C602                                  add     esi, 2
  1003 000008F6 66C1CD08                                ror     bp, 8
  1004 000008FA D3CD                                    ror     ebp, cl
  1005                                  
  1006                                  .@_without_crc_@@:
  1007 000008FC 894340                                  mov     [ebx+64], eax   ; [ebx+$mp3gr_table_select+nn*4] ; nn=2
  1008 000008FF 89E8                                    mov     eax, ebp
  1009 00000901 C1E504                                  shl     ebp, 4
  1010 00000904 C1C004                                  rol     eax, 4
  1011 00000907 31E8                                    xor     eax, ebp
  1012 00000909 80ED04                                  sub     ch, 4
  1013 0000090C 7913                                    jns     short .@_without_crc@@@
  1014 0000090E 88E9                                    mov     cl, ch
  1015 00000910 80C510                                  add     ch, 10h
  1016 00000913 D3C5                                    rol     ebp, cl
  1017 00000915 668B2E                                  mov     bp, [esi]
  1018 00000918 83C602                                  add     esi, 2
  1019 0000091B 66C1CD08                                ror     bp, 8
  1020 0000091F D3CD                                    ror     ebp, cl
  1021                                  
  1022                                  .@_without_crc@@@:
  1023 00000921 40                                      inc     eax
  1024 00000922 A3[58340500]                            mov     [_@@region_address0], eax
  1025 00000927 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 3
  1026 00000929 C1E503                                  shl     ebp, 3
  1027 0000092C C1C003                                  rol     eax, 3
  1028 0000092F 31E8                                    xor     eax, ebp
  1029 00000931 80ED03                                  sub     ch, 3
  1030 00000934 7913                                    jns     short .@_without_crc@@@@
  1031 00000936 88E9                                    mov     cl, ch
  1032 00000938 80C510                                  add     ch, 10h
  1033 0000093B D3C5                                    rol     ebp, cl
  1034 0000093D 668B2E                                  mov     bp, [esi]
  1035 00000940 83C602                                  add     esi, 2
  1036 00000943 66C1CD08                                ror     bp, 8
  1037 00000947 D3CD                                    ror     ebp, cl
  1038                                  
  1039                                  .@_without_crc@@@@:
  1040 00000949 40                                      inc     eax
  1041 0000094A 0305[58340500]                          add     eax, [_@@region_address0]
  1042 00000950 A3[5C340500]                            mov     [_@@region_address1], eax
  1043 00000955 A1[6CB20000]                            mov     eax, [mp3_hdr_sample_rate_index]
  1044 0000095A C1E005                                  shl     eax, 5
  1045 0000095D 0305[58340500]                          add     eax, [_@@region_address0]
  1046 00000963 0FB78400[6CEC0100]                      movzx   eax, word [mp3_band_index_long+eax*2]
  1047 0000096B D1E8                                    shr     eax, 1
  1048 0000096D 894350                                  mov     [ebx+80], eax   ; [ebx+$mp3gr_region_size+0*4]
  1049 00000970 A1[6CB20000]                            mov     eax, [mp3_hdr_sample_rate_index]
  1050 00000975 C1E005                                  shl     eax, 5
  1051 00000978 0305[5C340500]                          add     eax, [_@@region_address1]
  1052 0000097E 0FB78400[6CEC0100]                      movzx   eax, word [mp3_band_index_long+eax*2]
  1053 00000986 D1E8                                    shr     eax, 1
  1054 00000988 894354                                  mov     [ebx+84], eax   ; [ebx+$mp3gr_region_size+1*4]
  1055 0000098B C7435820010000                          mov     dword [ebx+88], 288 ; [ebx+$mp3gr_region_size+2*4],576/2
  1056                                  
  1057                                  .blocksplit_done:
  1058 00000992 8D7B50                                  lea     edi, [ebx+80]   ; [ebx+$mp3gr_region_size+0]
  1059 00000995 31D2                                    xor     edx, edx
  1060 00000997 B103                                    mov     cl, 3
  1061                                  
  1062                                  .trunc_region_size_lop:
  1063 00000999 8B07                                    mov     eax, [edi]
  1064 0000099B 3B430C                                  cmp     eax, [ebx+12]   ; [ebx+$mp3gr_big_values]
  1065 0000099E 7603                                    jbe     short .trunc_region_size_this
  1066 000009A0 8B430C                                  mov     eax, [ebx+12]
  1067                                  
  1068                                  .trunc_region_size_this:
  1069 000009A3 29D0                                    sub     eax, edx
  1070 000009A5 8907                                    mov     [edi], eax
  1071 000009A7 01C2                                    add     edx, eax
  1072 000009A9 83C704                                  add     edi, 4
  1073 000009AC FEC9                                    dec     cl
  1074 000009AE 75E9                                    jnz     short .trunc_region_size_lop
  1075 000009B0 C7431C0D000000                          mov     dword [ebx+28], 13 ; [ebx+$mp3gr_short_start]
  1076 000009B7 C7432016000000                          mov     dword [ebx+32], 22 ; [ebx+$mp3gr_long_end]
  1077 000009BE 837B2C02                                cmp     dword [ebx+44], 2 ; [ebx+$mp3gr_block_type]
  1078 000009C2 7549                                    jnz     short .these_band_indices
  1079 000009C4 C7431C00000000                          mov     dword [ebx+28], 0 ; [ebx+$mp3gr_short_start]
  1080 000009CB C7432000000000                          mov     dword [ebx+32], 0 ; [ebx+$mp3gr_long_end]
  1081 000009D2 837B3000                                cmp     dword [ebx+48], 0 ; [ebx+$mp3gr_switch_point]
  1082 000009D6 7435                                    jz      short .these_band_indices
  1083 000009D8 C7431C02000000                          mov     dword [ebx+28], 2 ; [ebx+$mp3gr_short_start]
  1084 000009DF C7432004000000                          mov     dword [ebx+32], 4 ; [ebx+$mp3gr_long_end]
  1085 000009E6 833D[6CB20000]08                        cmp     dword [mp3_hdr_sample_rate_index], 8
  1086 000009ED 741E                                    jz      short .these_band_indices
  1087 000009EF 833D[6CB20000]02                        cmp     dword [mp3_hdr_sample_rate_index], 2
  1088 000009F6 C7431C03000000                          mov     dword [ebx+28], 3 ; [ebx+$mp3gr_short_start]
  1089 000009FD C7432008000000                          mov     dword [ebx+32], 8 ; [ebx+$mp3gr_long_end]
  1090 00000A04 7607                                    jbe     short .these_band_indices
  1091 00000A06 C7432006000000                          mov     dword [ebx+32], 6 ; [ebx+$mp3gr_long_end]
  1092                                  
  1093                                  .these_band_indices:
  1094 00000A0D 31C0                                    xor     eax, eax
  1095 00000A0F 833D[98B20000]00                        cmp     dword [mp3_hdr_flag_lsf], 0
  1096 00000A16 7520                                    jnz     short .no_preflag
  1097 00000A18 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 1
  1098 00000A1A D1E5                                    shl     ebp, 1
  1099 00000A1C D1C0                                    rol     eax, 1
  1100 00000A1E 31E8                                    xor     eax, ebp
  1101 00000A20 80ED01                                  sub     ch, 1
  1102 00000A23 7913                                    jns     short .no_preflag
  1103 00000A25 88E9                                    mov     cl, ch
  1104 00000A27 80C510                                  add     ch, 10h
  1105 00000A2A D3C5                                    rol     ebp, cl
  1106 00000A2C 668B2E                                  mov     bp, [esi]
  1107 00000A2F 83C602                                  add     esi, 2
  1108 00000A32 66C1CD08                                ror     bp, 8
  1109 00000A36 D3CD                                    ror     ebp, cl
  1110                                  
  1111                                  .no_preflag:
  1112 00000A38 894318                                  mov     [ebx+24], eax   ; [ebx+$mp3gr_preflag]
  1113 00000A3B 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 1
  1114 00000A3D D1E5                                    shl     ebp, 1
  1115 00000A3F D1C0                                    rol     eax, 1
  1116 00000A41 31E8                                    xor     eax, ebp
  1117 00000A43 80ED01                                  sub     ch, 1
  1118 00000A46 7913                                    jns     short .@_without_crc@@@@@
  1119 00000A48 88E9                                    mov     cl, ch
  1120 00000A4A 80C510                                  add     ch, 10h
  1121 00000A4D D3C5                                    rol     ebp, cl
  1122 00000A4F 668B2E                                  mov     bp, [esi]
  1123 00000A52 83C602                                  add     esi, 2
  1124 00000A55 66C1CD08                                ror     bp, 8
  1125 00000A59 D3CD                                    ror     ebp, cl
  1126                                  
  1127                                  .@_without_crc@@@@@:
  1128 00000A5B 40                                      inc     eax
  1129 00000A5C 894334                                  mov     [ebx+52], eax   ; [ebx+$mp3gr_scalefac_scale]
  1130 00000A5F 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 1
  1131 00000A61 D1E5                                    shl     ebp, 1
  1132 00000A63 D1C0                                    rol     eax, 1
  1133 00000A65 31E8                                    xor     eax, ebp
  1134 00000A67 80ED01                                  sub     ch, 1
  1135 00000A6A 7913                                    jns     short .@_without_crc@@@@@@
  1136 00000A6C 88E9                                    mov     cl, ch
  1137 00000A6E 80C510                                  add     ch, 10h
  1138 00000A71 D3C5                                    rol     ebp, cl
  1139 00000A73 668B2E                                  mov     bp, [esi]
  1140 00000A76 83C602                                  add     esi, 2
  1141 00000A79 66C1CD08                                ror     bp, 8
  1142 00000A7D D3CD                                    ror     ebp, cl
  1143                                  
  1144                                  .@_without_crc@@@@@@: 
  1145 00000A7F 83C010                                  add     eax, 10h        ; table 10h..11h (quad_vlc)
  1146 00000A82 894324                                  mov     [ebx+36], eax   ; [ebx+$mp3gr_count1table_select]
  1147 00000A85 81C340130000                            add     ebx, 4928       ; $mp3gr_entrysiz*2
  1148 00000A8B FF05[48090100]                          inc     dword [mp3_curr_channel]
  1149 00000A91 A1[48090100]                            mov     eax, [mp3_curr_channel]
  1150 00000A96 3B05[74B20000]                          cmp     eax, [mp3_src_num_channels]
  1151 00000A9C 0F82C1FBFFFF                            jb      .hdr_channel_lop
  1152 00000AA2 5B                                      pop     ebx
  1153 00000AA3 81C3A0090000                            add     ebx, 2464       ; $mp3gr_entrysiz
  1154 00000AA9 FF05[4C090100]                          inc     dword [mp3_curr_granule]
  1155 00000AAF A1[4C090100]                            mov     eax, [mp3_curr_granule]
  1156 00000AB4 3B05[68090100]                          cmp     eax, [mp3_nb_granules]
  1157 00000ABA 0F8298FBFFFF                            jb      .hdr_granule_lop
  1158 00000AC0 F605[FC8A0000]10                        test    byte [cpuid_flags], 10h ; timelog_end rdtsc_read_granule
  1159 00000AC7 740E                                    jz      short .no_rdtsc_supported@
  1160 00000AC9 0F31                                    rdtsc
  1161 00000ACB 0105[3C8B0000]                          add     [rdtsc_read_granule], eax
  1162 00000AD1 1115[408B0000]                          adc     [rdtsc_read_granule+4], edx
  1163                                  
  1164                                  .no_rdtsc_supported@:
  1165 00000AD7 F8                                      clc
  1166 00000AD8 C3                                      retn
  1167                                  
  1168                                  .error:
  1169 00000AD9 F605[FC8A0000]10                        test    byte [cpuid_flags], 10h ; timelog_end rdtsc_read_granule
  1170 00000AE0 740E                                    jz      short .no_rdtsc_supported@@
  1171 00000AE2 0F31                                    rdtsc
  1172 00000AE4 0105[3C8B0000]                          add     [rdtsc_read_granule], eax
  1173 00000AEA 1115[408B0000]                          adc     [rdtsc_read_granule+4], edx
  1174                                  
  1175                                  .no_rdtsc_supported@@:
  1176 00000AF0 8B25[60340500]                          mov     esp, [_@@saved_sp]
  1177 00000AF6 F9                                      stc
  1178 00000AF7 C3                                      retn
  1179                                  
  1180                                  
  1181                                  ; =============== S U B R O U T I N E =======================================
  1182                                  
  1183                                  
  1184                                  mp3_bitstream_append_to_main_data_pool:
  1185 00000AF8 F605[FC8A0000]10                        test    byte [cpuid_flags], 10h ; timelog_start rdtsc_append_main
  1186 00000AFF 740E                                    jz      short .no_rdtsc_supported
  1187 00000B01 0F31                                    rdtsc
  1188 00000B03 2905[548B0000]                          sub     [rdtsc_append_main], eax
  1189 00000B09 1915[588B0000]                          sbb     [rdtsc_append_main+4], edx
  1190                                  
  1191                                  .no_rdtsc_supported:
  1192 00000B0F 8B0D[54B20000]                          mov     ecx, [mp3_src_frame_end]
  1193 00000B15 29F1                                    sub     ecx, esi
  1194 00000B17 0F8266020000                            jb      fatalunexpected
  1195 00000B1D 8B3D[48B20000]                          mov     edi, [main_data_pool_wr_ptr]
  1196 00000B23 8D040F                                  lea     eax, [edi+ecx]
  1197 00000B26 3D[48B20000]                            cmp     eax, main_data_pool_wr_ptr
  1198 00000B2B 7616                                    jbe     short .pool_inrange
  1199 00000B2D 51                                      push    ecx
  1200 00000B2E 56                                      push    esi
  1201 00000B2F 8DB700FEFFFF                            lea     esi, [edi-200h]
  1202 00000B35 BF[48A20000]                            mov     edi, main_data_pool_start
  1203 00000B3A B980000000                              mov     ecx, 128
  1204 00000B3F F3A5                                    rep movsd
  1205 00000B41 5E                                      pop     esi
  1206 00000B42 59                                      pop     ecx
  1207                                  
  1208                                  .pool_inrange:
  1209 00000B43 89F8                                    mov     eax, edi
  1210 00000B45 2B05[60090100]                          sub     eax, [mp3_main_data_begin]
  1211 00000B4B F3A4                                    rep movsb
  1212 00000B4D 893D[48B20000]                          mov     [main_data_pool_wr_ptr], edi
  1213 00000B53 3D[48A20000]                            cmp     eax, main_data_pool_start
  1214 00000B58 7828                                    js      short .below_pool_start
  1215 00000B5A A3[54090100]                            mov     [mp3_bitstream_start], eax
  1216                                                  ; 22/10/2024
  1217                                  		;mov    eax, 0
  1218 00000B5F 8B35[54090100]                          mov     esi, [mp3_bitstream_start] ; mp3mac_bitstream_set_position
  1219                                                  ;mov    cl, al
  1220                                                  ;shr    eax, 3
  1221                                                  ;and    cl, 7
  1222                                                  ;add    esi, eax
  1223 00000B65 E8CCF6FFFF                              call    mp3_recollect_bits
  1224                                                  ;mov    eax, ebp        ; mp3mac_get_n_bits cl
  1225                                                  ;shl    ebp, cl
  1226                                                  ;rol    eax, cl
  1227                                                  ;xor    eax, ebp
  1228                                                  ;sub    ch, cl
  1229                                                  ;jns    short .cont
  1230                                                  ;mov    cl, ch          ; mp3mac_collect_more
  1231                                                  ;add    ch, 10h
  1232                                                  ;rol    ebp, cl
  1233                                                  ;mov    bp, [esi]
  1234                                                  ;add    esi, 2
  1235                                                  ;ror    bp, 8
  1236                                                  ;ror    ebp, cl
  1237                                  
  1238                                  .cont:
  1239 00000B6A F605[FC8A0000]10                        test    byte [cpuid_flags], 10h ; timelog_end rdtsc_append_main
  1240 00000B71 740E                                    jz      short .no_rdtsc_supported@
  1241 00000B73 0F31                                    rdtsc
  1242 00000B75 0105[548B0000]                          add     [rdtsc_append_main], eax
  1243 00000B7B 1115[588B0000]                          adc     [rdtsc_append_main+4], edx
  1244                                  
  1245                                  .no_rdtsc_supported@:
  1246 00000B81 C3                                      retn
  1247                                  
  1248                                  .below_pool_start:
  1249 00000B82 C705[40090100]0000-                     mov     dword [mp3_samples_output_size], 0
  1249 00000B8A 0000               
  1250 00000B8C EBDC                                    jmp     short .cont
  1251                                  
  1252                                  
  1253                                  ; =============== S U B R O U T I N E =======================================
  1254                                  
  1255                                  
  1256                                  mp3_bitstream_read_scalefacs:
  1257 00000B8E F605[FC8A0000]10                        test    byte [cpuid_flags], 10h ; timelog_start rdtsc_read_scalefac
  1258 00000B95 740E                                    jz      short .no_rdtsc_supported
  1259 00000B97 0F31                                    rdtsc
  1260 00000B99 2905[6C8B0000]                          sub     [rdtsc_read_scalefac], eax
  1261 00000B9F 1915[708B0000]                          sbb     [rdtsc_read_scalefac+4], edx
  1262                                  
  1263                                  .no_rdtsc_supported:
  1264 00000BA5 8D7B70                                  lea     edi, [ebx+112]  ; [ebx+$mp3gr_scale_factors]
  1265 00000BA8 833D[98B20000]00                        cmp     dword [mp3_hdr_flag_lsf], 0
  1266 00000BAF 0F850D010000                            jnz     .body_lsf_nonzero
  1267 00000BB5 8B4314                                  mov     eax, [ebx+20]   ; [ebx+$mp3gr_scalefac_compress]
  1268 00000BB8 668B9400[4C8F0000]                      mov     dx, [mp3_slen_table+eax*2] ; slen[0,1]
  1269 00000BC0 837B2C02                                cmp     dword [ebx+44], 2 ; [ebx+$mp3gr_block_type]
  1270 00000BC4 757F                                    jnz     short .body_lsf_zero_non_type2
  1271 00000BC6 53                                      push    ebx
  1272 00000BC7 B012                                    mov     al, 18
  1273 00000BC9 2A4330                                  sub     al, [ebx+48]    ; [ebx+$mp3gr_switch_point]
  1274 00000BCC 88C3                                    mov     bl, al          ; @@get_bl_scalefacs_with_dl_bits 0
  1275 00000BCE 80FA00                                  cmp     dl, 0
  1276 00000BD1 7428                                    jz      short .quickfill
  1277                                  
  1278                                  .scalefac_get_lop:
  1279 00000BD3 88D1                                    mov     cl, dl          ; LSB of edx, slen[i]
  1280 00000BD5 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits cl
  1281 00000BD7 D3E5                                    shl     ebp, cl
  1282 00000BD9 D3C0                                    rol     eax, cl
  1283 00000BDB 31E8                                    xor     eax, ebp
  1284 00000BDD 28CD                                    sub     ch, cl
  1285 00000BDF 7913                                    jns     short .cont@
  1286 00000BE1 88E9                                    mov     cl, ch          ; mp3mac_collect_more
  1287 00000BE3 80C510                                  add     ch, 10h
  1288 00000BE6 D3C5                                    rol     ebp, cl
  1289 00000BE8 668B2E                                  mov     bp, [esi]
  1290 00000BEB 83C602                                  add     esi, 2
  1291 00000BEE 66C1CD08                                ror     bp, 8
  1292 00000BF2 D3CD                                    ror     ebp, cl
  1293                                  
  1294                                  .cont@:
  1295 00000BF4 AA                                      stosb
  1296 00000BF5 FECB                                    dec     bl
  1297 00000BF7 75DA                                    jnz     short .scalefac_get_lop
  1298 00000BF9 EB09                                    jmp     short .skip_quickfill
  1299                                  
  1300                                  .quickfill:
  1301 00000BFB 51                                      push    ecx
  1302 00000BFC 0FB6CB                                  movzx   ecx, bl
  1303 00000BFF B000                                    mov     al, 0           ; NO_INTENSITY_FLAG
  1304 00000C01 F3AA                                    rep stosb
  1305 00000C03 59                                      pop     ecx
  1306                                  
  1307                                  .skip_quickfill:
  1308 00000C04 C1EA08                                  shr     edx, 8
  1309 00000C07 B312                                    mov     bl, 18
  1310 00000C09 80FA00                                  cmp     dl, 0           ; @@get_bl_scalefacs_with_dl_bits 0
  1311 00000C0C 7428                                    jz      short .quickfill@
  1312                                  
  1313                                  .scalefac_get_lop@:
  1314 00000C0E 88D1                                    mov     cl, dl
  1315 00000C10 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits cl
  1316 00000C12 D3E5                                    shl     ebp, cl
  1317 00000C14 D3C0                                    rol     eax, cl
  1318 00000C16 31E8                                    xor     eax, ebp
  1319 00000C18 28CD                                    sub     ch, cl
  1320 00000C1A 7913                                    jns     short .cont@@
  1321 00000C1C 88E9                                    mov     cl, ch          ; mp3mac_collect_more
  1322 00000C1E 80C510                                  add     ch, 10h
  1323 00000C21 D3C5                                    rol     ebp, cl
  1324 00000C23 668B2E                                  mov     bp, [esi]
  1325 00000C26 83C602                                  add     esi, 2
  1326 00000C29 66C1CD08                                ror     bp, 8
  1327 00000C2D D3CD                                    ror     ebp, cl
  1328                                  
  1329                                  .cont@@:
  1330 00000C2F AA                                      stosb
  1331 00000C30 FECB                                    dec     bl
  1332 00000C32 75DA                                    jnz     short .scalefac_get_lop@
  1333 00000C34 EB09                                    jmp     short .skip_quickfill@
  1334                                  
  1335                                  .quickfill@:
  1336 00000C36 51                                      push    ecx
  1337 00000C37 0FB6CB                                  movzx   ecx, bl
  1338 00000C3A B000                                    mov     al, 0
  1339 00000C3C F3AA                                    rep stosb
  1340 00000C3E 59                                      pop     ecx
  1341                                  
  1342                                  .skip_quickfill@:
  1343 00000C3F 5B                                      pop     ebx
  1344 00000C40 E914010000                              jmp     .body_lsf_zeropad
  1345                                  
  1346                                  .body_lsf_zero_non_type2:
  1347 00000C45 53                                      push    ebx
  1348 00000C46 C1CA08                                  ror     edx, 8
  1349 00000C49 88D6                                    mov     dh, dl          ; slen[0,1,2,3] = slen[0,0,1,1]
  1350 00000C4B C1C210                                  rol     edx, 16
  1351 00000C4E 88F2                                    mov     dl, dh
  1352 00000C50 8A4328                                  mov     al, [ebx+40]    ; [ebx+$mp3gr_scfsi]
  1353 00000C53 C0E004                                  shl     al, 4           ; move to upper 4bit
  1354 00000C56 A2[68340500]                            mov     byte [_@@scfsi], al
  1355 00000C5B BB06050505                              mov     ebx, 5050506h   ; num[0..3]
  1356                                  
  1357                                  .body_lsf_zero_non_type2_lop:
  1358 00000C60 D025[68340500]                          shl     byte [_@@scfsi], 1
  1359 00000C66 7238                                    jb      short .body_lsf_zero_non_type2_copy
  1360 00000C68 80FA00                                  cmp     dl, 0           ; @@get_bl_scalefacs_with_dl_bits 0
  1361 00000C6B 7428                                    jz      short .quickfill@@
  1362                                  
  1363                                  .scalefac_get_lop@@:
  1364 00000C6D 88D1                                    mov     cl, dl
  1365 00000C6F 89E8                                    mov     eax, ebp
  1366 00000C71 D3E5                                    shl     ebp, cl
  1367 00000C73 D3C0                                    rol     eax, cl
  1368 00000C75 31E8                                    xor     eax, ebp
  1369 00000C77 28CD                                    sub     ch, cl
  1370 00000C79 7913                                    jns     short .cont@@@
  1371 00000C7B 88E9                                    mov     cl, ch
  1372 00000C7D 80C510                                  add     ch, 10h
  1373 00000C80 D3C5                                    rol     ebp, cl
  1374 00000C82 668B2E                                  mov     bp, [esi]
  1375 00000C85 83C602                                  add     esi, 2
  1376 00000C88 66C1CD08                                ror     bp, 8
  1377 00000C8C D3CD                                    ror     ebp, cl
  1378                                  
  1379                                  .cont@@@:
  1380 00000C8E AA                                      stosb
  1381 00000C8F FECB                                    dec     bl
  1382 00000C91 75DA                                    jnz     short .scalefac_get_lop@@
  1383 00000C93 EB09                                    jmp     short .skip_quickfill@@
  1384                                  
  1385                                  .quickfill@@:
  1386 00000C95 51                                      push    ecx
  1387 00000C96 0FB6CB                                  movzx   ecx, bl
  1388 00000C99 B000                                    mov     al, 0
  1389 00000C9B F3AA                                    rep stosb
  1390 00000C9D 59                                      pop     ecx
  1391                                  
  1392                                  .skip_quickfill@@:
  1393 00000C9E EB11                                    jmp     short .body_lsf_zero_non_type2_next
  1394                                  
  1395                                  .body_lsf_zero_non_type2_copy:
  1396 00000CA0 51                                      push    ecx
  1397 00000CA1 89F0                                    mov     eax, esi
  1398 00000CA3 0FB6CB                                  movzx   ecx, bl         ; copy
  1399 00000CA6 8DB760F6FFFF                            lea     esi, [edi-2464] ; [edi-$mp3gr_entrysiz] ; src=granule[0] ; from
  1400 00000CAC F3A4                                    rep movsb               ; prev
  1401 00000CAE 89C6                                    mov     esi, eax
  1402 00000CB0 59                                      pop     ecx
  1403                                  
  1404                                  .body_lsf_zero_non_type2_next:
  1405 00000CB1 C1EA08                                  shr     edx, 8          ; dl=next slen
  1406 00000CB4 C1EB08                                  shr     ebx, 8          ; bl=next numfacs
  1407 00000CB7 75A7                                    jnz     short .body_lsf_zero_non_type2_lop
  1408 00000CB9 5B                                      pop     ebx
  1409 00000CBA B000                                    mov     al, 0
  1410 00000CBC AA                                      stosb
  1411 00000CBD E9A9000000                              jmp     .body_lsf_done
  1412                                  
  1413                                  .body_lsf_nonzero:
  1414 00000CC2 8B5314                                  mov     edx, [ebx+14h]  ; [ebx+$mp3gr_scalefac_compress]
  1415 00000CC5 F705[94B20000]0100-                     test    dword [mp3_hdr_mode_ext], 1 ; MODE_EXT_I_STEREO
  1415 00000CCD 0000               
  1416 00000CCF 740F                                    jz      short .normal_scalefac
  1417 00000CD1 833D[48090100]00                        cmp     dword [mp3_curr_channel], 0
  1418 00000CD8 7406                                    jz      short .normal_scalefac
  1419 00000CDA 81C200020000                            add     edx, 512        ; for 2nd channel of intensity_stereo
  1420                                  
  1421                                  .normal_scalefac:
  1422 00000CE0 8A04D5[5D140500]                        mov     al, [(mp3_lsf_sf_expand_exploded_table+5)+edx*8]
  1423 00000CE7 084318                                  or      [ebx+24], al    ; [ebx+$mp3gr_preflag]
  1424 00000CEA 53                                      push    ebx
  1425 00000CEB 0FB604D5[5C140500]                      movzx   eax, byte [(mp3_lsf_sf_expand_exploded_table+4)+edx*8]
  1426 00000CF3 837B2C02                                cmp     dword [ebx+44], 2 ;  [ebx+$mp3gr_block_type]
  1427 00000CF7 7507                                    jnz     short .this_tindex1
  1428 00000CF9 8B5B30                                  mov     ebx, [ebx+48]   ; [ebx+$mp3gr_switch_point]
  1429 00000CFC 8D449804                                lea     eax, [eax+ebx*4+4]
  1430                                  
  1431                                  .this_tindex1:
  1432 00000D00 8B98[6C8F0000]                          mov     ebx, [mp3_lsf_nsf_table+eax]
  1433 00000D06 8B14D5[58140500]                        mov     edx, dword [mp3_lsf_sf_expand_exploded_table+edx*8]
  1434                                  
  1435                                  .scalefax_outer_lop:
  1436 00000D0D 80FA00                                  cmp     dl, 0           ; @@get_bl_scalefacs_with_dl_bits 1
  1437 00000D10 7435                                    jz      short .@quickfil
  1438                                  
  1439                                  .@scalefac_get_lop:
  1440 00000D12 88D1                                    mov     cl, dl
  1441 00000D14 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits cl
  1442 00000D16 D3E5                                    shl     ebp, cl
  1443 00000D18 D3C0                                    rol     eax, cl
  1444 00000D1A 31E8                                    xor     eax, ebp
  1445 00000D1C 28CD                                    sub     ch, cl
  1446 00000D1E 7913                                    jns     short .cont
  1447 00000D20 88E9                                    mov     cl, ch
  1448 00000D22 80C510                                  add     ch, 10h
  1449 00000D25 D3C5                                    rol     ebp, cl
  1450 00000D27 668B2E                                  mov     bp, [esi]
  1451 00000D2A 83C602                                  add     esi, 2
  1452 00000D2D 66C1CD08                                ror     bp, 8
  1453 00000D31 D3CD                                    ror     ebp, cl
  1454                                  
  1455                                  .cont:
  1456 00000D33 88D1                                    mov     cl, dl          ; numbits
  1457 00000D35 88C4                                    mov     ah, al
  1458 00000D37 FEC4                                    inc     ah              ; val+1
  1459 00000D39 D2EC                                    shr     ah, cl          ; bit0=is.max.value
  1460 00000D3B C0E407                                  shl     ah, 7           ; bit7=is.max.value
  1461 00000D3E 08E0                                    or      al, ah          ; apply NO_INTENSITY_FLAG
  1462 00000D40 AA                                      stosb
  1463 00000D41 FECB                                    dec     bl
  1464 00000D43 75CD                                    jnz     short .@scalefac_get_lop
  1465 00000D45 EB09                                    jmp     short .@skip_quickfill
  1466                                  
  1467                                  .@quickfil:
  1468 00000D47 51                                      push    ecx
  1469 00000D48 0FB6CB                                  movzx   ecx, bl
  1470 00000D4B B080                                    mov     al, 80h
  1471 00000D4D F3AA                                    rep stosb
  1472 00000D4F 59                                      pop     ecx
  1473                                  
  1474                                  .@skip_quickfill:
  1475 00000D50 C1EA08                                  shr     edx, 8
  1476 00000D53 C1EB08                                  shr     ebx, 8
  1477 00000D56 75B5                                    jnz     short .scalefax_outer_lop
  1478 00000D58 5B                                      pop     ebx
  1479                                  
  1480                                  .body_lsf_zeropad:
  1481 00000D59 89CA                                    mov     edx, ecx
  1482 00000D5B 8D8B98000000                            lea     ecx, [ebx+152]  ; [ebx+$mp3gr_scale_factors+40]
  1483 00000D61 29F9                                    sub     ecx, edi
  1484                                                  ;jb     short fatal_scalefactors
  1485                                  		; 21/10/2024
  1486 00000D63 721E                    		jb	short fatalunexpected
  1487 00000D65 B000                                    mov     al, 0
  1488 00000D67 F3AA                                    rep stosb
  1489 00000D69 89D1                                    mov     ecx, edx
  1490                                  
  1491                                  .body_lsf_done:
  1492 00000D6B F605[FC8A0000]10                        test    byte [cpuid_flags], 10h ; timelog_end rdtsc_read_scalefac
  1493 00000D72 740E                                    jz      short .no_rdtsc_supported@@@
  1494 00000D74 0F31                                    rdtsc
  1495 00000D76 0105[6C8B0000]                          add     [rdtsc_read_scalefac], eax
  1496 00000D7C 1115[708B0000]                          adc     [rdtsc_read_scalefac+4], edx
  1497                                  
  1498                                  .no_rdtsc_supported@@@:
  1499 00000D82 C3                                      retn
  1500                                  
  1501                                  		; 21/10/2024
  1502                                  ;fatal_scalefactors:
  1503                                                  ;jmp    fatalunexpected
  1504                                  
  1505                                  ; ---------------------------------------------------------------------------
  1506                                  
  1507                                  		; 21/10/2024
  1508                                  fatalunexpected:                       
  1509 00000D83 F735[D8990000]                          div	dword [zero]
  1510                                  hang:
  1511 00000D89 EBFE                                    jmp     short hang
  1512                                  
  1513                                  
  1514                                  ; =============== S U B R O U T I N E =======================================
  1515                                  
  1516                                  
  1517                                  mp3_get_exponents_from_scale_factors:
  1518 00000D8B F605[FC8A0000]10                        test    byte [cpuid_flags], 10h ; timelog_start rdtsc_xlat_scalefac
  1519 00000D92 740E                                    jz      short .no_rdtsc_supported
  1520 00000D94 0F31                                    rdtsc
  1521 00000D96 2905[848B0000]                          sub     [rdtsc_xlat_scalefac], eax
  1522 00000D9C 1915[888B0000]                          sbb     [rdtsc_xlat_scalefac+4], edx
  1523                                  
  1524                                  .no_rdtsc_supported:
  1525 00000DA2 51                                      push    ecx             ; mp3mac_push_bitstream
  1526 00000DA3 55                                      push    ebp
  1527 00000DA4 56                                      push    esi
  1528 00000DA5 C705[78340500]0000-                     mov     dword [_@@rle_point], 0
  1528 00000DAD 0000               
  1529 00000DAF 8A4B34                                  mov     cl, [ebx+52]    ; [ebx+$mp3gr_scalefac_scale]
  1530 00000DB2 BF[EC2F0100]                            mov     edi, mp3_exponents
  1531 00000DB7 31D2                                    xor     edx, edx
  1532 00000DB9 3B5320                                  cmp     edx, [ebx+32]   ; [ebx+$mp3gr_long_end]
  1533 00000DBC 7345                                    jnb     short .long_done
  1534 00000DBE A1[6CB20000]                            mov     eax, [mp3_hdr_sample_rate_index]
  1535 00000DC3 6BC016                                  imul    eax, 22
  1536 00000DC6 8DA8[7C950000]                          lea     ebp, [mp3_band_size_long+eax]
  1537 00000DCC 8B4318                                  mov     eax, [ebx+24]   ; [ebx+$mp3gr_preflag]
  1538 00000DCF 6BC016                                  imul    eax, 22
  1539 00000DD2 8DB0[CC960000]                          lea     esi, [mp3_pretab+eax]
  1540                                  
  1541                                  .long_lop:
  1542 00000DD8 0FB6441370                              movzx   eax, byte [ebx+edx+112] ; [ebx+$mp3gr_scale_factors+edx]
  1543 00000DDD 247F                                    and     al, 7Fh         ; strip NO_INTENSITY_FLAG
  1544 00000DDF 020416                                  add     al, [esi+edx]
  1545 00000DE2 D3E0                                    shl     eax, cl
  1546 00000DE4 F7D8                                    neg     eax
  1547 00000DE6 034310                                  add     eax, [ebx+16]   ; [ebx+$mp3gr_global_gain]
  1548 00000DE9 C1E010                                  shl     eax, 16
  1549 00000DEC 8A441500                                mov     al, [ebp+edx+0]
  1550 00000DF0 0305[78340500]                          add     eax, [_@@rle_point]
  1551 00000DF6 66A3[78340500]                          mov     word [_@@rle_point], ax
  1552 00000DFC AB                                      stosd
  1553 00000DFD 42                                      inc     edx
  1554 00000DFE 3B5320                                  cmp     edx, [ebx+32]   ; [ebx+$mp3gr_long_end]
  1555 00000E01 72D5                                    jb      short .long_lop
  1556                                  
  1557                                  .long_done:
  1558 00000E03 8B531C                                  mov     edx, [ebx+28]   ; [ebx+$mp3gr_short_start]
  1559 00000E06 83FA0D                                  cmp     edx, 13
  1560 00000E09 0F83AA000000                            jnb     .skip_shorts
  1561 00000E0F A1[6CB20000]                            mov     eax, [mp3_hdr_sample_rate_index]
  1562 00000E14 6BC00D                                  imul    eax, 13
  1563 00000E17 8DA8[4C960000]                          lea     ebp, [mp3_band_size_short+eax]
  1564 00000E1D 8B7320                                  mov     esi, [ebx+32]   ; [ebx+$mp3gr_long_end]
  1565 00000E20 8B4310                                  mov     eax, [ebx+16]   ; [ebx+$mp3gr_global_gain]
  1566                                                                          ; IRP nn,0,1,2
  1567 00000E23 2B4344                                  sub     eax, [ebx+68]   ; [ebx+$mp3gr_subblock_gain+nn*4]
  1568 00000E26 A3[6C340500]                            mov     [_@@gains], eax ; [@@gains+nn*4]
  1569 00000E2B 8B4310                                  mov     eax, [ebx+16]
  1570 00000E2E 2B4348                                  sub     eax, [ebx+72]
  1571 00000E31 A3[70340500]                            mov     [_@@gains+4], eax ; [@@gains+nn*4]
  1572 00000E36 8B4310                                  mov     eax, [ebx+16]
  1573 00000E39 2B434C                                  sub     eax, [ebx+76]   ; [ebx+$mp3gr_subblock_gain+nn*4]
  1574 00000E3C A3[74340500]                            mov     [_@@gains+8], eax ; [@@gains+nn*4]
  1575                                  
  1576                                  .short_lop:
  1577 00000E41 0FB6443370                              movzx   eax, byte [ebx+esi+112] ; [ebx+$mp3gr_scale_factors+esi]
  1578                                                                          ; IRP nn,0,1,2
  1579 00000E46 247F                                    and     al, 7Fh         ; strip NO_INTENSITY_FLAG
  1580 00000E48 46                                      inc     esi
  1581 00000E49 D3E0                                    shl     eax, cl
  1582 00000E4B F7D8                                    neg     eax
  1583 00000E4D 0305[6C340500]                          add     eax, [_@@gains] ; [@@gains+nn*4] ; nn=0
  1584 00000E53 C1E010                                  shl     eax, 16
  1585 00000E56 8A441500                                mov     al, [ebp+edx+0] ; bstab[edx]
  1586 00000E5A 0305[78340500]                          add     eax, [_@@rle_point]
  1587 00000E60 66A3[78340500]                          mov     word [_@@rle_point], ax
  1588 00000E66 AB                                      stosd                   ; msw=val, lsw=point
  1589 00000E67 0FB6443370                              movzx   eax, byte [ebx+esi+112] ; [ebx+$mp3gr_scalefac_scale]
  1590 00000E6C 247F                                    and     al, 7Fh
  1591 00000E6E 46                                      inc     esi
  1592 00000E6F D3E0                                    shl     eax, cl
  1593 00000E71 F7D8                                    neg     eax
  1594 00000E73 0305[70340500]                          add     eax, [_@@gains+4] ; [@@gains+nn*4] ; nn = 1
  1595 00000E79 C1E010                                  shl     eax, 16
  1596 00000E7C 8A441500                                mov     al, [ebp+edx+0]
  1597 00000E80 0305[78340500]                          add     eax, [_@@rle_point]
  1598 00000E86 66A3[78340500]                          mov     word [_@@rle_point], ax
  1599 00000E8C AB                                      stosd
  1600 00000E8D 0FB6443370                              movzx   eax, byte [ebx+esi+70h]
  1601 00000E92 247F                                    and     al, 7Fh
  1602 00000E94 46                                      inc     esi
  1603 00000E95 D3E0                                    shl     eax, cl
  1604 00000E97 F7D8                                    neg     eax
  1605 00000E99 0305[74340500]                          add     eax, [_@@gains+8] ; [@@gains+nn*4] ; nn=2
  1606 00000E9F C1E010                                  shl     eax, 10h
  1607 00000EA2 8A441500                                mov     al, [ebp+edx+0]
  1608 00000EA6 0305[78340500]                          add     eax, [_@@rle_point]
  1609 00000EAC 66A3[78340500]                          mov     word [_@@rle_point], ax
  1610 00000EB2 AB                                      stosd
  1611 00000EB3 42                                      inc     edx
  1612 00000EB4 83FA0D                                  cmp     edx, 13
  1613 00000EB7 7288                                    jb      short .short_lop
  1614                                  
  1615                                  .skip_shorts:
  1616 00000EB9 5E                                      pop     esi             ; mp3mac_pop_bitstream
  1617 00000EBA 5D                                      pop     ebp
  1618 00000EBB 59                                      pop     ecx
  1619 00000EBC F605[FC8A0000]10                        test    byte [cpuid_flags], 10h ; timelog_end rdtsc_xlat_scalefac
  1620 00000EC3 740E                                    jz      short .no_rdtsc_supported@
  1621 00000EC5 0F31                                    rdtsc
  1622 00000EC7 0105[848B0000]                          add     [rdtsc_xlat_scalefac], eax
  1623 00000ECD 1115[888B0000]                          adc     [rdtsc_xlat_scalefac+4], edx
  1624                                  
  1625                                  .no_rdtsc_supported@:
  1626 00000ED3 C3                                      retn
  1627                                  
  1628                                  
  1629                                  ; =============== S U B R O U T I N E =======================================
  1630                                  
  1631                                  
  1632                                  mp3_huffman_decode:
  1633 00000ED4 F605[FC8A0000]10                        test    byte [cpuid_flags], 10h ; in: ebx=granule, out: [sb_hybrid..]
  1634                                                                          ; timelog_start rdtsc_read_huffman
  1635 00000EDB 740E                                    jz      short .no_rdtsc_supported
  1636 00000EDD 0F31                                    rdtsc
  1637 00000EDF 2905[9C8B0000]                          sub     [rdtsc_read_huffman], eax
  1638 00000EE5 1915[A08B0000]                          sbb     [rdtsc_read_huffman+4], edx
  1639                                  
  1640                                  .no_rdtsc_supported:
  1641 00000EEB 8B4308                                  mov	eax, [ebx+8]    ; [ebx+$mp3gr_part2_3_end]
  1642 00000EEE C1E803                                  shr	eax, 3
  1643 00000EF1 0305[54090100]                          add	eax, [mp3_bitstream_start]
  1644 00000EF7 A3[8C340500]                            mov	[_@@coarse_end], eax
  1645 00000EFC 31FF                                    xor	edi, edi
  1646 00000EFE C705[94340500]-                         mov	dword [_@@rle_ptr], mp3_exponents
  1646 00000F04 [EC2F0100]         
  1647 00000F08 C705[90340500]0000-                     mov	dword [_@rle_point], 0
  1647 00000F10 0000               
  1648 00000F12 C705[7C340500]0000-                     mov	dword [_@@III], 0  ; i=0
  1648 00000F1A 0000               
  1649                                  
  1650                                  .low_freq_lop_i:
  1651 00000F1C 8B15[7C340500]                          mov     edx, [_@@III] ; for i=0 to 2
  1652                                                                          ; low frequencies (called big_values)...
  1653 00000F22 8B449350                                mov     eax, [ebx+edx*4+80] ; [ebx+$mp3gr_region_size+edx*4]
  1654 00000F26 83F800                                  cmp     eax, 0
  1655 00000F29 0F84D9020000                            jz      .low_freq_next_i
  1656 00000F2F A3[80340500]                            mov     [_@@JJJ], eax
  1657 00000F34 8B549338                                mov     edx, [ebx+edx*4+56] ; [ebx+$mp3gr_table_select+edx*4]
  1658                                                                          ; select vlc table
  1659 00000F38 0FB68412[3C950000]                      movzx   eax, byte [mp3_huff_data+edx*2] ; get huff.table number
  1660 00000F40 83F800                                  cmp     eax, 0          ; huff.table
  1661 00000F43 7528                                    jnz     short .low_freq_nonzero
  1662 00000F45 51                                      push    ecx
  1663 00000F46 57                                      push    edi
  1664 00000F47 8DBCBBA0000000                          lea     edi, [ebx+edi*4+160] ; [ebx+$mp3gr_sb_hybrid+edi*4]
  1665 00000F4E 8B0D[80340500]                          mov     ecx, [_@@JJJ]
  1666 00000F54 D1E1                                    shl     ecx, 1
  1667 00000F56 31C0                                    xor     eax, eax        ; when huff.table=0,
  1668                                                                          ; simply set NUM*2 entries to zero
  1669 00000F58 F3AB                                    rep stosd
  1670 00000F5A 5F                                      pop     edi
  1671 00000F5B 59                                      pop     ecx
  1672 00000F5C 033D[80340500]                          add     edi, [_@@JJJ] ; raise index accordingly (by num*2)
  1673 00000F62 033D[80340500]                          add     edi, [_@@JJJ]
  1674 00000F68 E99B020000                              jmp     .low_freq_next_i
  1675                                  
  1676                                  .low_freq_nonzero:
  1677 00000F6D A3[88340500]                            mov     [_@@vlc_table], eax ; =1..15
  1678 00000F72 83F80E                                  cmp     eax, 14         ; only table 14..15 have linbits
  1679 00000F75 0F83FA000000                            jnb     .with_linbits  ; so table 0..13 can use faster code...
  1680                                  
  1681                                  .low_freq_lop_j_small:
  1682 00000F7B 3B35[8C340500]                          cmp     esi, [_@@coarse_end] ; loop @@JJJ times..
  1683 00000F81 0F87CF000000                            ja      .small_near_end
  1684                                  
  1685                                  .small_not_end:
  1686 00000F87 3B3D[90340500]                          cmp     edi, [_@rle_point] ; @@get_runlength small
  1687 00000F8D 0F839E030000                            jnb     .rle_fetch_next_small
  1688                                  
  1689                                  .rle_back_small:
  1690 00000F93 8B15[88340500]                          mov     edx, [_@@vlc_table] ; get huffcode
  1691                                  
  1692                                  .get_child_lop:
  1693 00000F99 8A0C95[6E340100]                        mov     cl, [(huff_tree_buf+2)+edx*4] ; mp3mac_get_huffcode
  1694                                                                          ; in: edx=table, out: eax=data
  1695                                                                          ; bits (table size) (-7..-1)
  1696 00000FA0 668B1495[6C340100]                      mov     dx, word [huff_tree_buf+edx*4] ; code (child table)
  1697 00000FA8 89E8                                    mov     eax, ebp        ; mov eax,mp3_col32 ; peek bitstream
  1698 00000FAA D3E8                                    shr     eax, cl
  1699 00000FAC 01C2                                    add     edx, eax
  1700 00000FAE 8A0C95[6E340100]                        mov     cl, [(huff_tree_buf+2)+edx*4] ; bits (of entry)
  1701 00000FB5 80F900                                  cmp     cl, 0
  1702 00000FB8 7823                                    js      short .got_child
  1703 00000FBA 0FB70495[6C340100]                      movzx   eax, word [huff_tree_buf+edx*4] ; return data value
  1704 00000FC2 D3E5                                    shl     ebp, cl         ; shl mp3_col32,cl ; discard cl bits
  1705 00000FC4 28CD                                    sub     ch, cl          ; sub mp3_colNN,cl
  1706 00000FC6 7932                                    jns     short .got_done
  1707 00000FC8 88E9                                    mov     cl, ch          ; mp3mac_collect_more
  1708                                                                          ; mov cl,mp3_colNN ; byte ptr [mp3_numbits_collected]
  1709 00000FCA 80C510                                  add     ch, 16          ; byte ptr [mp3_numbits_collected]
  1710 00000FCD D3C5                                    rol     ebp, cl         ; dword ptr [mp3_collected_data]
  1711 00000FCF 668B2E                                  mov     bp, [esi]
  1712 00000FD2 83C602                                  add     esi, 2
  1713 00000FD5 66C1CD08                                ror     bp, 8           ; ror mp3_col16,8 ; endianess
  1714 00000FD9 D3CD                                    ror     ebp, cl         ; ror mp3_col32,cl ; dword ptr [mp3_collected_data]
  1715 00000FDB EB1D                                    jmp     short .got_done
  1716                                  
  1717                                  .got_child:
  1718 00000FDD C1E509                                  shl     ebp, 9          ; shl mp3_col32,CHILD_BITS
  1719                                                                          ; discard 7 bits
  1720                                                                          ; (assuming that parents are always 7bit wide)
  1721 00000FE0 80ED09                                  sub     ch, 9
  1722 00000FE3 79B4                                    jns     short .get_child_lop
  1723 00000FE5 88E9                                    mov     cl, ch          ; mp3mac_collect_more
  1724 00000FE7 80C510                                  add     ch, 10h
  1725 00000FEA D3C5                                    rol     ebp, cl
  1726 00000FEC 668B2E                                  mov     bp, [esi]
  1727 00000FEF 83C602                                  add     esi, 2
  1728 00000FF2 66C1CD08                                ror     bp, 8
  1729 00000FF6 D3CD                                    ror     ebp, cl
  1730 00000FF8 EB9F                                    jmp     short .get_child_lop
  1731                                  
  1732                                  .got_done:
  1733 00000FFA 50                                      push    eax
  1734 00000FFB C1E804                                  shr     eax, 4          ; x
  1735 00000FFE 7417                                    jz      short .this_sign ; @@getexpval 0 ; @@getexpval macro has_linbits
  1736                                                                          ; eax=0 (without sign) ; when x=0
  1737 00001000 8B15[9C340500]                          mov     edx, [_@@rle_val_x_40h]
  1738 00001006 8B8482[D8770400]                        mov     eax, [mp3_expval_table+edx+eax*4]
  1739 0000100D FECD                                    dec     ch              ; mp3mac_get_bit_to_cy
  1740                                                                          ; ;jnc short @@this_sign
  1741                                                                          ; ;neg  eax
  1742 0000100F D1E5                                    shl     ebp, 1          ; dec mp3_colNN ; shl mp3_col32,1 ; cy=data
  1743 00001011 19D2                                    sbb     edx, edx        ; cy=0,1 --> 0,FFFFFFFF
  1744 00001013 31D0                                    xor     eax, edx        ; invert if cy was 1 ; get sign (negate if sign=1)
  1745 00001015 29D0                                    sub     eax, edx        ; add 1 if cy was 1
  1746                                  
  1747                                  .this_sign:
  1748 00001017 8984BBA0000000                          mov     [ebx+edi*4+160], eax ; [ebx+$mp3gr_sb_hybrid+edi*4+0]
  1749 0000101E 58                                      pop     eax
  1750 0000101F 83E00F                                  and     eax, 0Fh        ; y
  1751 00001022 7417                                    jz      short .this_sign@ ; @@getexpval 0
  1752 00001024 8B15[9C340500]                          mov     edx, [_@@rle_val_x_40h]
  1753 0000102A 8B8482[D8770400]                        mov     eax, [mp3_expval_table+edx+eax*4]
  1754 00001031 FECD                                    dec     ch
  1755 00001033 D1E5                                    shl     ebp, 1
  1756 00001035 19D2                                    sbb     edx, edx
  1757 00001037 31D0                                    xor     eax, edx
  1758 00001039 29D0                                    sub     eax, edx
  1759                                  
  1760                                  .this_sign@:
  1761 0000103B 8984BBA4000000                          mov     [ebx+edi*4+164], eax ; [ebx+$mp3gr_sb_hybrid+edi*4+4]
  1762 00001042 83C702                                  add     edi, 2
  1763 00001045 FF0D[80340500]                          dec     dword [_@@JJJ]
  1764 0000104B 0F852AFFFFFF                            jnz     .low_freq_lop_j_small
  1765 00001051 E9B2010000                              jmp     .low_freq_next_i
  1766                                  
  1767                                  .small_near_end:
  1768 00001056 89F0                                    mov     eax, esi        ; mp3mac_bitstream_get_position
  1769 00001058 2B05[54090100]                          sub     eax, [mp3_bitstream_start]
  1770 0000105E 0FBED5                                  movsx   edx, ch         ; mp3_colNN
  1771 00001061 F7DA                                    neg     edx
  1772 00001063 8D44C2F0                                lea     eax, [edx+eax*8-16]
  1773 00001067 3B4308                                  cmp     eax, [ebx+8]    ; [ebx+$mp3gr_part2_3_end]
  1774 0000106A 0F8217FFFFFF                            jb      .small_not_end
  1775 00001070 E993010000                              jmp     .low_freq_next_i
  1776                                  
  1777                                  .with_linbits:
  1778 00001075 0FB68412[3D950000]                      movzx   eax, byte [(mp3_huff_data+1)+edx*2]
  1779 0000107D A3[84340500]                            mov     [_@@linbits], eax
  1780                                  
  1781                                  .low_freq_lop_j:
  1782 00001082 3B35[8C340500]                          cmp     esi, [_@@coarse_end] ; mp3mac_bitstream_get_position
  1783                                                                          ; loop @@JJJ times...
  1784 00001088 0F8725030000                            ja      .lop_j_near_end
  1785                                  
  1786                                  .small_not_end@:
  1787 0000108E 3B3D[90340500]                          cmp     edi, [_@rle_point] ; @@get_runlength small
  1788 00001094 0F83C5020000                            jnb     .rle_fetch_next_full
  1789                                  
  1790                                  .rle_back_full:
  1791 0000109A 8B15[88340500]                          mov     edx, [_@@vlc_table] ; get huffcode
  1792                                  
  1793                                  .get_child_lop@:
  1794 000010A0 8A0C95[6E340100]                        mov     cl, [(huff_tree_buf+2)+edx*4] ; mp3mac_get_huffcode
  1795                                                                          ; in: edx=table, out: eax=data
  1796                                                                          ; bits (table size) (-7..-1)
  1797 000010A7 668B1495[6C340100]                      mov     dx, word [huff_tree_buf+edx*4] ; code (child table)
  1798 000010AF 89E8                                    mov     eax, ebp
  1799 000010B1 D3E8                                    shr     eax, cl
  1800 000010B3 01C2                                    add     edx, eax
  1801 000010B5 8A0C95[6E340100]                        mov     cl, [(huff_tree_buf+2)+edx*4] ; bits (of entry)
  1802 000010BC 80F900                                  cmp     cl, 0
  1803 000010BF 7823                                    js      short .got_child@
  1804 000010C1 0FB70495[6C340100]                      movzx   eax, word [huff_tree_buf+edx*4] ; return data value
  1805 000010C9 D3E5                                    shl     ebp, cl         ; discard cl bits
  1806 000010CB 28CD                                    sub     ch, cl
  1807 000010CD 7932                                    jns     short .got_done@
  1808 000010CF 88E9                                    mov     cl, ch          ; mp3mac_collect_more
  1809 000010D1 80C510                                  add     ch, 10h
  1810 000010D4 D3C5                                    rol     ebp, cl
  1811 000010D6 668B2E                                  mov     bp, [esi]
  1812 000010D9 83C602                                  add     esi, 2
  1813 000010DC 66C1CD08                                ror     bp, 8
  1814 000010E0 D3CD                                    ror     ebp, cl
  1815 000010E2 EB1D                                    jmp     short .got_done@
  1816                                  
  1817                                  .got_child@:
  1818 000010E4 C1E509                                  shl     ebp, 9
  1819 000010E7 80ED09                                  sub     ch, 9
  1820 000010EA 79B4                                    jns     short .get_child_lop@
  1821 000010EC 88E9                                    mov     cl, ch
  1822 000010EE 80C510                                  add     ch, 10h
  1823 000010F1 D3C5                                    rol     ebp, cl
  1824 000010F3 668B2E                                  mov     bp, [esi]
  1825 000010F6 83C602                                  add     esi, 2
  1826 000010F9 66C1CD08                                ror     bp, 8
  1827 000010FD D3CD                                    ror     ebp, cl
  1828 000010FF EB9F                                    jmp     short .get_child_lop@
  1829                                  
  1830                                  .got_done@:
  1831 00001101 50                                      push    eax
  1832 00001102 C1E804                                  shr     eax, 4          ; x
  1833 00001105 746F                                    jz      short .@this_sign ; @@getexpval 1
  1834 00001107 8B15[98340500]                          mov     edx, [_@@rle_val]
  1835 0000110D 83F80F                                  cmp     eax, 15
  1836 00001110 7250                                    jb      short .small    ; when x=1..14
  1837 00001112 8A0D[84340500]                          mov     cl, byte [_@@linbits] ; =0..13 ; when x=15, with linbits
  1838 00001118 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits cl ; value = 0..1FFFh
  1839 0000111A D3E5                                    shl     ebp, cl         ; mp3mac_collect_more
  1840 0000111C D3C0                                    rol     eax, cl
  1841 0000111E 31E8                                    xor     eax, ebp
  1842 00001120 28CD                                    sub     ch, cl
  1843 00001122 7913                                    jns     short .cont
  1844 00001124 88E9                                    mov     cl, ch          ; mp3mac_collect_more
  1845 00001126 80C510                                  add     ch, 16
  1846 00001129 D3C5                                    rol     ebp, cl
  1847 0000112B 668B2E                                  mov     bp, [esi]
  1848 0000112E 83C602                                  add     esi, 2
  1849 00001131 66C1CD08                                ror     bp, 8
  1850 00001135 D3CD                                    ror     ebp, cl
  1851                                  
  1852                                  .cont:
  1853 00001137 88D1                                    mov     cl, dl          ; exponent.lsb
  1854 00001139 80E103                                  and     cl, 3           ; exponent.lsb
  1855 0000113C C1EA02                                  shr     edx, 2          ; exponent.msb
  1856 0000113F 8D04853C000000                          lea     eax, [eax*4+60] ; (value+15)*4
  1857 00001146 08C8                                    or      al, cl          ; exponent.lsb+(value+15)*4
  1858 00001148 8A88[ACEE0100]                          mov     cl, [mp3_table_4_3_exp+eax]
  1859 0000114E 8B0485[E86E0200]                        mov     eax, [mp3_table_4_3_value+eax*4]
  1860 00001155 28D1                                    sub     cl, dl          ; sub exponent.msb
  1861 00001157 D3E8                                    shr     eax, cl
  1862 00001159 80F91F                                  cmp     cl, 31
  1863 0000115C 760E                                    jbe     short .get_sign
  1864 0000115E 31C0                                    xor     eax, eax
  1865 00001160 EB0A                                    jmp     short .get_sign
  1866                                  
  1867                                  .small:
  1868 00001162 C1E206                                  shl     edx, 6          ; shl edx,4+2 ; mul16*4 ; when x<15 aka x=1..14
  1869 00001165 8B8482[D8770400]                        mov     eax, [mp3_expval_table+edx+eax*4]
  1870                                  
  1871                                  .get_sign:
  1872 0000116C FECD                                    dec     ch              ; mp3mac_get_bit_to_cy
  1873 0000116E D1E5                                    shl     ebp, 1
  1874 00001170 19D2                                    sbb     edx, edx        ; get sign (negate if sign=1)
  1875 00001172 31D0                                    xor     eax, edx
  1876 00001174 29D0                                    sub     eax, edx
  1877                                  
  1878                                  .@this_sign:
  1879 00001176 8984BBA0000000                          mov     [ebx+edi*4+160], eax ; [ebx+$mp3gr_sb_hybrid+edi*4+0]
  1880 0000117D 58                                      pop     eax
  1881 0000117E 83E00F                                  and     eax, 0Fh        ; y
  1882 00001181 746F                                    jz      short .@this_sign@ ; @@getexpval 1
  1883 00001183 8B15[98340500]                          mov     edx, [_@@rle_val]
  1884 00001189 83F80F                                  cmp     eax, 0Fh
  1885 0000118C 7250                                    jb      short .small@
  1886 0000118E 8A0D[84340500]                          mov     cl, byte [_@@linbits]
  1887 00001194 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits cl
  1888 00001196 D3E5                                    shl     ebp, cl
  1889 00001198 D3C0                                    rol     eax, cl
  1890 0000119A 31E8                                    xor     eax, ebp
  1891 0000119C 28CD                                    sub     ch, cl
  1892 0000119E 7913                                    jns     short .cont@
  1893 000011A0 88E9                                    mov     cl, ch          ; mp3mac_collect_more
  1894 000011A2 80C510                                  add     ch, 10h
  1895 000011A5 D3C5                                    rol     ebp, cl
  1896 000011A7 668B2E                                  mov     bp, [esi]
  1897 000011AA 83C602                                  add     esi, 2
  1898 000011AD 66C1CD08                                ror     bp, 8
  1899 000011B1 D3CD                                    ror     ebp, cl
  1900                                  
  1901                                  .cont@:
  1902 000011B3 88D1                                    mov     cl, dl
  1903 000011B5 80E103                                  and     cl, 3
  1904 000011B8 C1EA02                                  shr     edx, 2
  1905 000011BB 8D04853C000000                          lea     eax, [eax*4+60]
  1906 000011C2 08C8                                    or      al, cl
  1907 000011C4 8A88[ACEE0100]                          mov     cl, [mp3_table_4_3_exp+eax]
  1908 000011CA 8B0485[E86E0200]                        mov     eax, [mp3_table_4_3_value+eax*4]
  1909 000011D1 28D1                                    sub     cl, dl
  1910 000011D3 D3E8                                    shr     eax, cl
  1911 000011D5 80F91F                                  cmp     cl, 31
  1912 000011D8 760E                                    jbe     short .get_sign@
  1913 000011DA 31C0                                    xor     eax, eax
  1914 000011DC EB0A                                    jmp     short .get_sign@
  1915                                  
  1916                                  .small@:
  1917 000011DE C1E206                                  shl     edx, 6
  1918 000011E1 8B8482[D8770400]                        mov     eax, [mp3_expval_table+edx+eax*4]
  1919                                  
  1920                                  .get_sign@:                           
  1921 000011E8 FECD                                    dec     ch              ; dec mp3_colNN
  1922 000011EA D1E5                                    shl     ebp, 1          ; shl mp3_col32,1 ; cy=data
  1923 000011EC 19D2                                    sbb     edx, edx        ; cy=0,1 --> 0,FFFFFFFF
  1924 000011EE 31D0                                    xor     eax, edx        ; invert if cy was 1
  1925 000011F0 29D0                                    sub     eax, edx        ; add 1 if cy was 1
  1926                                  
  1927                                  .@this_sign@:
  1928 000011F2 8984BBA4000000                          mov	[ebx+edi*4+164], eax ; [ebx+$mp3gr_sb_hybrid+edi*4+4]
  1929 000011F9 83C702                                  add	edi, 2          ; next j
  1930 000011FC FF0D[80340500]                          dec	dword [_@@JJJ]
  1931 00001202 0F857AFEFFFF                            jnz	.low_freq_lop_j
  1932                                  
  1933                                  .low_freq_next_i:
  1934 00001208 FF05[7C340500]                          inc	dword [_@@III]	; next i
  1935 0000120E 833D[7C340500]03                        cmp	dword [_@@III], 3
  1936 00001215 0F8201FDFFFF                            jb	.low_freq_lop_i
  1937 0000121B 81FF3C020000                            cmp	edi, 572	; aka 576-4 ; skip if less than 4 entries left
  1938 00001221 0F87DA000000                            ja	.high_freq_done
  1939                                  
  1940                                  .high_freq_lop:
  1941 00001227 3B35[8C340500]                          cmp     esi, [_@@coarse_end]
  1942 0000122D 7629                                    jbe     short .high_freq_inrange
  1943 0000122F 89F0                                    mov     eax, esi        ; mp3mac_bitstream_get_position
  1944 00001231 2B05[54090100]                          sub     eax, [mp3_bitstream_start]
  1945 00001237 0FBED5                                  movsx   edx, ch         ; mp3_colNN
  1946 0000123A F7DA                                    neg     edx
  1947 0000123C 8D44C2F0                                lea     eax, [edx+eax*8-16]
  1948 00001240 3B4308                                  cmp     eax, [ebx+8]    ; [ebx+$mp3gr_part2_3_end] ; check end
  1949 00001243 7213                                    jb      short .high_freq_inrange ; not yet end
  1950 00001245 0F84B6000000                            jz      .high_freq_done ; okay, exact end
  1951 0000124B 83FF04                                  cmp     edi, 4
  1952 0000124E 7203                                    jb      short .high_freq_cannot_stepback
  1953 00001250 83EF04                                  sub     edi, 4          ; stepback, s_index-4 ; dst stepback
  1954                                  
  1955                                  .high_freq_cannot_stepback:
  1956 00001253 E9A9000000                              jmp     .high_freq_done
  1957                                  
  1958                                  .high_freq_inrange:
  1959 00001258 8B5324                                  mov     edx, [ebx+24h]  ; [ebx+$mp3gr_count1table_select]
  1960                                                                          ; get huffcode (quad_vlc)
  1961                                  
  1962                                  .get_child_lop@@:
  1963 0000125B 8A0C95[6E340100]                        mov     cl, [(huff_tree_buf+2)+edx*4] ; mp3mac_get_huffcode
  1964 00001262 668B1495[6C340100]                      mov     dx, word [huff_tree_buf+edx*4]
  1965 0000126A 89E8                                    mov     eax, ebp
  1966 0000126C D3E8                                    shr     eax, cl
  1967 0000126E 01C2                                    add     edx, eax
  1968 00001270 8A0C95[6E340100]                        mov     cl, [(huff_tree_buf+2)+edx*4]
  1969 00001277 80F900                                  cmp     cl, 0
  1970 0000127A 7823                                    js      short .got_child@@
  1971 0000127C 0FB70495[6C340100]                      movzx   eax, word [huff_tree_buf+edx*4]
  1972 00001284 D3E5                                    shl     ebp, cl
  1973 00001286 28CD                                    sub     ch, cl
  1974 00001288 7932                                    jns     short .got_done@@
  1975 0000128A 88E9                                    mov     cl, ch
  1976 0000128C 80C510                                  add     ch, 10h
  1977 0000128F D3C5                                    rol     ebp, cl
  1978 00001291 668B2E                                  mov     bp, [esi]
  1979 00001294 83C602                                  add     esi, 2
  1980 00001297 66C1CD08                                ror     bp, 8
  1981 0000129B D3CD                                    ror     ebp, cl
  1982 0000129D EB1D                                    jmp     short .got_done@@
  1983                                  
  1984                                  .got_child@@:
  1985 0000129F C1E509                                  shl     ebp, 9
  1986 000012A2 80ED09                                  sub     ch, 9
  1987 000012A5 79B4                                    jns     short .get_child_lop@@
  1988 000012A7 88E9                                    mov     cl, ch
  1989 000012A9 80C510                                  add     ch, 10h
  1990 000012AC D3C5                                    rol     ebp, cl
  1991 000012AE 668B2E                                  mov     bp, [esi]
  1992 000012B1 83C602                                  add     esi, 2
  1993 000012B4 66C1CD08                                ror     bp, 8
  1994 000012B8 D3CD                                    ror     ebp, cl
  1995 000012BA EB9F                                    jmp     short .get_child_lop@@
  1996                                  
  1997                                  .got_done@@:
  1998 000012BC 88C2                                    mov     dl, al          ; flags
  1999 000012BE C0E204                                  shl     dl, 4           ; flags, to upper 4bit
  2000 000012C1 B604                                    mov     dh, 4           ; lopcount
  2001                                  
  2002                                  .high_freq_flag_lop:
  2003 000012C3 31C0                                    xor     eax, eax
  2004 000012C5 D0E2                                    shl     dl, 1           ; flag
  2005 000012C7 7320                                    jnb     short .high_freq_flag_this
  2006 000012C9 3B3D[90340500]                          cmp     edi, [_@rle_point] ; @@get_runlength quads
  2007 000012CF 0F83B8000000                            jnb     .rle_fetch_next_quads
  2008                                  
  2009                                  .rle_back_quads:
  2010 000012D5 A1[98340500]                            mov     eax, [_@@rle_val]
  2011 000012DA 8B0485[D86F0400]                        mov     eax, [mp3_exp_table+eax*4] ; xlat and get sign
  2012 000012E1 FECD                                    dec     ch              ; mp3mac_get_bit_to_cy
  2013 000012E3 D1E5                                    shl     ebp, 1
  2014 000012E5 7302                                    jnb     short .high_freq_flag_this ;
  2015                                                                          ; sbb edx, edx ; cy=0,1 --> 0,FFFFFFFF
  2016                                                                          ; xor eax, edx ; invert if cy was 1
  2017                                                                          ; sub eax, edx ; add 1 if cy was 1
  2018 000012E7 F7D8                                    neg     eax
  2019                                  
  2020                                  .high_freq_flag_this:
  2021 000012E9 8984BBA0000000                          mov     [ebx+edi*4+160], eax ; [ebx+$mp3gr_sb_hybrid+edi*4+0]
  2022 000012F0 47                                      inc     edi
  2023 000012F1 FECE                                    dec     dh
  2024 000012F3 75CE                                    jnz     short .high_freq_flag_lop
  2025 000012F5 81FF3C020000                            cmp     edi, 572        ; aka 576-4 ; loop while space for another 4 values
  2026 000012FB 0F8626FFFFFF                            jbe     .high_freq_lop
  2027                                  
  2028                                  .high_freq_done:
  2029 00001301 897B5C                                  mov     [ebx+92], edi   ; [ebx+$mp3gr_num_nonzero_hybrids]
  2030 00001304 51                                      push    ecx
  2031 00001305 B940020000                              mov     ecx, 576        ; end
  2032 0000130A 29F9                                    sub     ecx, edi        ; remain = end-curr
  2033                                                                          ; zeropad remaining entries (can be 0 or 2 dwords,
  2034                                                                          ; or more. If above loop was aborted)
  2035 0000130C 8DBCBBA0000000                          lea     edi, [ebx+edi*4+160] ; [ebx+$mp3gr_sb_hybrid+edi*4]
  2036 00001313 31C0                                    xor     eax, eax
  2037 00001315 F3AB                                    rep stosd
  2038 00001317 59                                      pop     ecx
  2039 00001318 F605[FC8A0000]10                        test    byte [cpuid_flags], 10h ; timelog_end rdtsc_read_huffman
  2040 0000131F 740E                                    jz      short .no_rdtsc_supported@
  2041 00001321 0F31                                    rdtsc
  2042 00001323 0105[9C8B0000]                          add     [rdtsc_read_huffman], eax
  2043 00001329 1115[A08B0000]                          adc     [rdtsc_read_huffman+4], edx
  2044                                  
  2045                                  .no_rdtsc_supported@:
  2046 0000132F F8                                      clc                     ; out: cy=0=okay
  2047 00001330 C3                                      retn
  2048                                  
  2049                                  .rle_fetch_next_small:
  2050 00001331 A1[94340500]                            mov     eax, [_@@rle_ptr] ; @@next_runlength small
  2051 00001336 8305[94340500]04                        add     dword [_@@rle_ptr], 4
  2052 0000133D 8B00                                    mov     eax, [eax]
  2053 0000133F 6639C7                                  cmp     di, ax
  2054 00001342 73ED                                    jnb     short .rle_fetch_next_small
  2055 00001344 66A3[90340500]                          mov     word [_@rle_point], ax
  2056 0000134A C1E810                                  shr     eax, 16
  2057 0000134D A3[98340500]                            mov     [_@@rle_val], eax
  2058 00001352 C1E006                                  shl     eax, 6
  2059 00001355 A3[9C340500]                            mov     [_@@rle_val_x_40h], eax
  2060 0000135A E934FCFFFF                              jmp     .rle_back_small
  2061                                  
  2062                                  .rle_fetch_next_full:
  2063 0000135F A1[94340500]                            mov     eax, [_@@rle_ptr] ; @@next_runlength full
  2064 00001364 8305[94340500]04                        add	dword [_@@rle_ptr], 4
  2065 0000136B 8B00                                    mov     eax, [eax]
  2066 0000136D 6639C7                                  cmp     di, ax
  2067 00001370 73ED                                    jnb     short .rle_fetch_next_full
  2068 00001372 66A3[90340500]                          mov     word [_@rle_point], ax
  2069 00001378 C1E810                                  shr     eax, 16
  2070 0000137B A3[98340500]                            mov     [_@@rle_val], eax
  2071 00001380 C1E006                                  shl     eax, 6
  2072 00001383 A3[9C340500]                            mov     [_@@rle_val_x_40h], eax
  2073 00001388 E90DFDFFFF                              jmp     .rle_back_full
  2074                                  
  2075                                  .rle_fetch_next_quads:
  2076 0000138D A1[94340500]                            mov	eax, [_@@rle_ptr] ; msw=val, lsw=point
  2077 00001392 8305[94340500]04                        add	dword [_@@rle_ptr], 4 ; 2+2
  2078 00001399 8B00                                    mov	eax, [eax]
  2079 0000139B 6639C7                                  cmp	di, ax          ; needed if rle fetching was skipped
  2080 0000139E 73ED                                    jnb	short .rle_fetch_next_quads
  2081 000013A0 66A3[90340500]                          mov	word [_@rle_point], ax
  2082 000013A6 C1E810                                  shr	eax, 16
  2083 000013A9 A3[98340500]                            mov	[_@@rle_val], eax
  2084 000013AE E922FFFFFF                              jmp	.rle_back_quads
  2085                                  
  2086                                  .lop_j_near_end:
  2087 000013B3 89F0                                    mov     eax, esi
  2088 000013B5 2B05[54090100]                          sub     eax, [mp3_bitstream_start]
  2089 000013BB 0FBED5                                  movsx   edx, ch
  2090 000013BE F7DA                                    neg     edx
  2091 000013C0 8D44C2F0                                lea     eax, [edx+eax*8-16]
  2092 000013C4 3B4308                                  cmp     eax, [ebx+8]
  2093 000013C7 0F82C1FCFFFF                            jb      .small_not_end@
  2094 000013CD E936FEFFFF                              jmp     .low_freq_next_i
  2095                                  
  2096                                  
  2097                                  ; =============== S U B R O U T I N E =======================================
  2098                                  
  2099                                  
  2100                                  mp3_compute_stereo:
  2101 000013D2 833D[78B20000]02                        cmp	dword [mp3_output_num_channels], 2 ; in: ebx=granule(s)
  2102 000013D9 7515                                    jnz	short .no_stereo
  2103 000013DB 833D[94B20000]02                        cmp	dword [mp3_hdr_mode_ext], 2 ; MODE_EXT_MS_STEREO
  2104                                                                          ; only MS stereo
  2105 000013E2 740D                                    jz	short mp3_compute_ms_stereo
  2106 000013E4 F705[94B20000]0100-                     test	dword [mp3_hdr_mode_ext], 1 ; MODE_EXT_I_STEREO
  2106 000013EC 0000               
  2107                                                                          ; intensity stereo (optionally with MS stereo)
  2108 000013EE 7567                                    jnz	short mp3_compute_i_stereo
  2109                                  
  2110                                  .no_stereo:
  2111 000013F0 C3                                      retn
  2112                                  
  2113                                  mp3_compute_ms_stereo:
  2114 000013F1 F605[FC8A0000]10                        test    byte [cpuid_flags], 10h ; ms_stereo is most commonly used
  2115                                                                          ; the 1/sqrt(2) normalization factor is included
  2116                                                                          ; in the global gain
  2117 000013F8 740E                                    jz      short .no_rdtsc_supported ; timelog_start rdtsc_ms_stereo
  2118 000013FA 0F31                                    rdtsc
  2119 000013FC 2905[B48B0000]                          sub     [rdtsc_ms_stereo], eax
  2120 00001402 1915[B88B0000]                          sbb     [rdtsc_ms_stereo+4], edx
  2121                                  
  2122                                  .no_rdtsc_supported:
  2123 00001408 8DBBE0130000                            lea     edi, [ebx+5088] ; [ebx+$mp3gr_sb_hybrid+$mp3gr_entrysiz*2]
  2124                                                                          ; for ch1 (2nd channel)
  2125 0000140E 8B4B5C                                  mov     ecx, [ebx+92]   ; [ebx+$mp3gr_num_nonzero_hybrids] ; ch0
  2126 00001411 8B839C130000                            mov     eax, [ebx+5020] ; [ebx+$mp3gr_num_nonzero_hybrids+($mp3gr_entrysiz*2)] ; ch1
  2127 00001417 39C1                                    cmp     ecx, eax
  2128 00001419 7702                                    ja      short .this_len
  2129 0000141B 89C1                                    mov     ecx, eax
  2130                                  
  2131                                  .this_len:
  2132 0000141D E320                                    jecxz   .ms_stereo_done
  2133 0000141F 894B5C                                  mov     [ebx+92], ecx   ; [ebx+$mp3gr_num_nonzero_hybrids] ; ch0
  2134 00001422 898B9C130000                            mov     [ebx+5020], ecx ; [ebx+$mp3gr_num_nonzero_hybrids+($mp3gr_entrysiz*2)] ; ch1
  2135                                  
  2136                                  .ms_stereo_lop:
  2137 00001428 8B87C0ECFFFF                            mov     eax, [edi-4928] ; for i=0 to 576-1
  2138                                                                          ; [edi+@@ch0]
  2139                                                                          ; @@ch0 equ (-$mp3gr_entrysiz*2) ; granule for channel=0
  2140                                                                          ; tmp0 = granule.ch0.sb_hybrid[i]
  2141 0000142E 8B17                                    mov     edx, [edi]      ; @@ch1 equ 0 ; granule for channel=1
  2142                                                                          ; [edi+@@ch1]
  2143                                                                          ; tmp1 = granule.ch1.sb_hybrid[i]
  2144 00001430 29D0                                    sub     eax, edx        ; tmp0 - tmp1
  2145 00001432 8D1450                                  lea     edx, [eax+edx*2] ; tmp0 + tmp1
  2146 00001435 8997C0ECFFFF                            mov     [edi-4928], edx ; [edi+@@ch0]
  2147                                                                          ; granule.ch0.sb_hybrid[i] = tmp0 + tmp1
  2148 0000143B AB                                      stosd                   ; [edi+@@ch1]
  2149                                                                          ; granule.ch1.sb_hybrid[i] = tmp0 - tmp1
  2150 0000143C 49                                      dec     ecx
  2151 0000143D 75E9                                    jnz     short .ms_stereo_lop
  2152                                  
  2153                                  .ms_stereo_done:
  2154 0000143F F605[FC8A0000]10                        test    byte [cpuid_flags], 10h ; timelog_end rdtsc_ms_stereo
  2155 00001446 740E                                    jz      short .no_rdtsc_supported@
  2156 00001448 0F31                                    rdtsc
  2157 0000144A 0105[B48B0000]                          add     [rdtsc_ms_stereo], eax
  2158 00001450 1115[B88B0000]                          adc     [rdtsc_ms_stereo+4], edx
  2159                                  
  2160                                  .no_rdtsc_supported@:
  2161 00001456 C3                                      retn
  2162                                  
  2163                                  mp3_compute_i_stereo:
  2164 00001457 F605[FC8A0000]10                        test    byte [cpuid_flags], 10h ; timelog_start rdtsc_i_stereo
  2165 0000145E 740E                                    jz      short .no_rdtsc_supported@@@
  2166 00001460 0F31                                    rdtsc
  2167 00001462 2905[CC8B0000]                          sub     [rdtsc_i_stereo], eax
  2168 00001468 1915[D08B0000]                          sbb     [rdtsc_i_stereo+4], edx
  2169                                  
  2170                                  .no_rdtsc_supported@@@:
  2171 0000146E C7435C40020000                          mov     dword [ebx+92], 576 ; ch0
  2172                                                                          ; [ebx+$mp3gr_num_nonzero_hybrids]
  2173 00001475 C7839C130000400200-                     mov     dword [ebx+5020], 576 ; ch1
  2173 0000147E 00                 
  2174                                                                          ; [ebx+$mp3gr_num_nonzero_hybrids+($mp3gr_entrysiz*2)]
  2175 0000147F 8B4320                                  mov     eax, [ebx+32]   ; [ebx+$mp3gr_long_end]
  2176 00001482 A3[D8340500]                            mov     [_@@n_long_sfb], eax
  2177 00001487 B80D000000                              mov     eax, 13         ; 39/3
  2178 0000148C 2B431C                                  sub     eax, [ebx+28]   ; [ebx+$mp3gr_short_start]
  2179 0000148F 8D0440                                  lea     eax, [eax+eax*2] ; mul3
  2180 00001492 A3[DC340500]                            mov     [_@@n_short_sfb], eax
  2181 00001497 0305[D8340500]                          add     eax, [_@@n_long_sfb]
  2182 0000149D A3[E0340500]                            mov     [_@@n_sfb], eax ;
  2183                                                                          ; n_sfb = gr->n_long_sfb + gr->n_short_sfb;
  2184 000014A2 803D[DC340500]00                        cmp     byte [_@@n_short_sfb], 0
  2185 000014A9 B801000000                              mov     eax, 1
  2186 000014AE 7405                                    jz      short .without_short
  2187 000014B0 B803000000                              mov     eax, 3          ; max_blocks = gr->n_short_sfb ? 3 : 1;
  2188                                  
  2189                                  .without_short:
  2190 000014B5 A3[A4340500]                            mov     [_@@max_blocks], eax
  2191 000014BA BF[AC340500]                            mov     edi, _@@sfb_array
  2192 000014BF A1[6CB20000]                            mov     eax, [mp3_hdr_sample_rate_index] ; bstab
  2193 000014C4 6BC016                                  imul    eax, 22
  2194 000014C7 8DB0[7C950000]                          lea     esi, [mp3_band_size_long+eax]
  2195 000014CD 8B0D[D8340500]                          mov     ecx, [_@@n_long_sfb]
  2196 000014D3 F3A4                                    rep movsb
  2197 000014D5 A1[6CB20000]                            mov     eax, [mp3_hdr_sample_rate_index]
  2198 000014DA 6BC00D                                  imul    eax, 13
  2199 000014DD 8DB0[4C960000]                          lea     esi, [mp3_band_size_short+eax] ; merge lieff-style
  2200 000014E3 8B0D[DC340500]                          mov     ecx, [_@@n_short_sfb]
  2201 000014E9 E30C                                    jecxz   .make_sfb_done ; doing that here is a bit slow,
  2202                                                                          ; it would be better to pre-compute
  2203                                                                          ; all merged-combinations
  2204 000014EB 03731C                                  add     esi, [ebx+28]   ; [ebx+$mp3gr_short_start]
  2205                                  
  2206                                  .make_sfb_lop:
  2207 000014EE AC                                      lodsb
  2208 000014EF AA                                      stosb
  2209 000014F0 AA                                      stosb
  2210 000014F1 AA                                      stosb
  2211 000014F2 83E903                                  sub     ecx, 3
  2212 000014F5 75F7                                    jnz     short .make_sfb_lop
  2213                                  
  2214                                  .make_sfb_done:
  2215 000014F7 E888000000                              call    _@@find_top_bands ;
  2216                                                                          ; L3_stereo_top_band(left+576,gr->sfbtab,n_sfb,max_band);
  2217 000014FC 803D[D8340500]00                        cmp     byte [_@@n_long_sfb], 0
  2218 00001503 7420                                    jz      short .without_long
  2219 00001505 A1[A0340500]                            mov     eax, dword [_@@max_bands]
  2220 0000150A 38C4                                    cmp     ah, al          ; if (gr->n_long_sfb)
  2221 0000150C 7F02                                    jg      short .not_max1 ; max_band[0] = max_band[1] = max_band[2] = MINIMP3_MAX
  2222                                                                          ; (MINIMP3_MAX(max_band[0], max_band[1]), max_band[2]);
  2223 0000150E 88C4                                    mov     ah, al
  2224                                  
  2225                                  .not_max1:
  2226 00001510 C1E808                                  shr     eax, 8
  2227 00001513 38C4                                    cmp     ah, al
  2228 00001515 7F02                                    jg      short .not_max2
  2229 00001517 88C4                                    mov     ah, al
  2230                                  
  2231                                  .not_max2:
  2232 00001519 88E0                                    mov     al, ah
  2233 0000151B C1E008                                  shl     eax, 8
  2234 0000151E 88E0                                    mov     al, ah
  2235 00001520 A3[A0340500]                            mov     dword [_@@max_bands], eax
  2236                                  
  2237                                  .without_long:
  2238 00001525 31ED                                    xor     ebp, ebp        ; blk
  2239                                  
  2240                                  .adjust_last_prev_lop:
  2241 00001527 8B15[E0340500]                          mov     edx, [_@@n_sfb]
  2242 0000152D 2B15[A4340500]                          sub     edx, [_@@max_blocks] ; itop = n_sfb - max_blocks + blk
  2243 00001533 01EA                                    add     edx, ebp
  2244 00001535 89D1                                    mov     ecx, edx
  2245 00001537 2B0D[A4340500]                          sub     ecx, [_@@max_blocks] ; prev = itop - max_blocks;
  2246 0000153D A1[98B20000]                            mov     eax, [mp3_hdr_flag_lsf]
  2247 00001542 8D0440                                  lea     eax, [eax+eax*2] ; 0,1 --> 0,3
  2248                                                                          ; default_pos = HDR_TEST_MPEG1(hdr) ? 3
  2249 00001545 3403                                    xor     al, 3           ; 0,3 --> 3,0
  2250 00001547 363A8D[A0340500]                        cmp     cl, [ss:_@@max_bands+ebp]
  2251 0000154E 7E07                                    jle     short .use_default_pos ; ist_pos[itop] = max_band[blk] >=
  2252                                                                          ; prev ? default_pos : ist_pos[prev]
  2253 00001550 8A840BB0130000                          mov     al, [ebx+ecx+5040] ; [ebx+@@right+$mp3gr_scale_factors+ecx]
  2254                                  
  2255                                  .use_default_pos:
  2256 00001557 888413B0130000                          mov     [ebx+edx+5040], al ; [ebx+@@right+$mp3gr_scale_factors+edx]
  2257 0000155E 45                                      inc     ebp             ; blk
  2258 0000155F 3B2D[A4340500]                          cmp     ebp, [_@@max_blocks]
  2259 00001565 72C0                                    jb      short .adjust_last_prev_lop
  2260 00001567 E867000000                              call    _@@apply_i_stereo
  2261 0000156C F605[FC8A0000]10                        test    byte [cpuid_flags], 10h ; timelog_end rdtsc_i_stereo
  2262 00001573 740E                                    jz      short .no_rdtsc_supported@@@@
  2263 00001575 0F31                                    rdtsc
  2264 00001577 0105[CC8B0000]                          add     [rdtsc_i_stereo], eax
  2265 0000157D 1115[D08B0000]                          adc     [rdtsc_i_stereo+4], edx
  2266                                  
  2267                                  .no_rdtsc_supported@@@@:
  2268 00001583 C3                                      retn
  2269                                  
  2270                                  
  2271                                  ; =============== S U B R O U T I N E =======================================
  2272                                  
  2273                                  
  2274                                  _@@find_top_bands:
  2275 00001584 C705[A0340500]FFFF-                     mov     dword [_@@max_bands], 0FFFFFFh ; set maxband[0..2]=(-1)
  2275 0000158C FF00               
  2276 0000158E 8DB3E0130000                            lea     esi, [ebx+5088] ; [ebx+@@right+$mp3gr_sb_hybrid]
  2277 00001594 31D2                                    xor     edx, edx
  2278                                  
  2279                                  .find_top_lop_iii:                    
  2280 00001596 31C9                                    xor     ecx, ecx        ; for (i = 0; i < nbands; i++)
  2281                                  
  2282                                  .find_top_lop_kkk:                    
  2283 00001598 8B048E                                  mov     eax, [esi+ecx*4] ; for (k = 0; k < sfb[i]; k += 2)
  2284 0000159B 0B448E04                                or      eax, [esi+ecx*4+4]
  2285 0000159F 750D                                    jnz     short .found_nonzero
  2286 000015A1 83C102                                  add     ecx, 2
  2287 000015A4 3A8A[AC340500]                          cmp     cl, [_@@sfb_array+edx]
  2288 000015AA 72EC                                    jb      short .find_top_lop_kkk
  2289 000015AC EB11                                    jmp     short .find_top_next
  2290                                  
  2291                                  .found_nonzero:
  2292 000015AE 89D0                                    mov     eax, edx
  2293 000015B0 F635[B69F0000]                          div     byte [_@@const_3]
  2294 000015B6 0FB6C4                                  movzx   eax, ah         ; remainder (mod 3)
  2295 000015B9 8890[A0340500]                          mov     [_@@max_bands+eax], dl ; max_bands[0..2]=i
  2296                                  
  2297                                  .find_top_next:
  2298 000015BF 0FB682[AC340500]                        movzx   eax, byte [_@@sfb_array+edx]
  2299 000015C6 8D3486                                  lea     esi, [esi+eax*4]
  2300 000015C9 42                                      inc     edx             ; next
  2301 000015CA 3B15[E0340500]                          cmp     edx, [_@@n_sfb]
  2302 000015D0 72C4                                    jb      short .find_top_lop_iii
  2303 000015D2 C3                                      retn
  2304                                  
  2305                                  ; =============== S U B R O U T I N E =======================================
  2306                                  
  2307                                  
  2308                                  _@@apply_i_stereo:
  2309 000015D3 B8[3C990000]                            mov     eax, mp3_is_table_normal
  2310 000015D8 B907000000                              mov     ecx, 7
  2311 000015DD 833D[98B20000]00                        cmp     dword [mp3_hdr_flag_lsf], 0
  2312 000015E4 7425                                    jz      short .this_lsf
  2313 000015E6 8B8354130000                            mov     eax, [ebx+4948] ; [ebx+@@right+$mp3gr_scalefac_compress]
  2314 000015EC 83E001                                  and     eax, 1          ; bit0
  2315 000015EF F705[94B20000]0200-                     test    dword [mp3_hdr_mode_ext], 2 ; MODE_EXT_MS_STEREO
  2315 000015F7 0000               
  2316 000015F9 7403                                    jz      short .no_ms
  2317 000015FB 83C802                                  or      eax, 2          ; bit1=mul_1.414
  2318                                  
  2319                                  .no_ms:
  2320 000015FE C1E009                                  shl     eax, 9          ; N*40h*2*4
  2321 00001601 05[58FC0400]                            add     eax, mp3_is_table_lsf
  2322 00001606 B940000000                              mov     ecx, 64         ; max (must be below NO_INTENSITY_FLAG)
  2323                                  
  2324                                  .this_lsf:
  2325 0000160B 890D[A8340500]                          mov     [_@@max_pos], ecx ; 7 or 64
  2326 00001611 A3[D4340500]                            mov     [_@@is_tab], eax ; table
  2327 00001616 8DB3A0000000                            lea     esi, [ebx+160]  ; [ebx+$mp3gr_sb_hybrid]
  2328 0000161C 31C9                                    xor     ecx, ecx        ; iii ; for (i = 0; sfb[i]; i++)
  2329                                  
  2330                                  .apply_lop_i:
  2331 0000161E 0FB6A9[AC340500]                        movzx   ebp, byte [_@@sfb_array+ecx] ; if ((int)i > max_band[i % 3]
  2332                                                                          ; && ipos < max_pos)
  2333 00001625 89C8                                    mov     eax, ecx
  2334 00001627 F635[B69F0000]                          div     byte [_@@const_3] ; max_band[i % 3]
  2335 0000162D 0FB6C4                                  movzx   eax, ah         ; remainder (mod 3)
  2336 00001630 3A88[A0340500]                          cmp     cl, [_@@max_bands+eax] ; iii,max_bands[0..2];
  2337 00001636 7E38                                    jle     short .apply_ms_stereo
  2338 00001638 0FB6BC0BB0130000                        movzx   edi, byte [ebx+ecx+5040] ; [ebx+@@right+$mp3gr_scale_factors+ecx]
  2339                                                                          ; @@right = $mp3gr_entrysiz*2 = 4928
  2340                                                                          ; $mp3gr_scale_factors = 112
  2341 00001640 3B3D[A8340500]                          cmp     edi, [_@@max_pos] ; check ipos
  2342 00001646 7328                                    jnb     short .apply_ms_stereo
  2343 00001648 C1E703                                  shl     edi, 3          ; mul 2*4
  2344 0000164B 033D[D4340500]                          add     edi, [_@@is_tab]
  2345                                  
  2346                                  .apply_pan_lop:
  2347 00001651 8B06                                    mov     eax, [esi]      ; tmp = granule.ch0.sb_hybrid
  2348 00001653 C1E002                                  shl     eax, 2
  2349 00001656 F76F04                                  imul    dword [edi+4] ; v1
  2350 00001659 899640130000                            mov     [esi+4928], edx ; [esi+@@right]
  2351                                                                          ; granule.ch1.sb_hybrid = tmp*v1
  2352 0000165F 8B06                                    mov     eax, [esi]      ; tmp = granule.ch0.sb_hybrid
  2353 00001661 C1E002                                  shl     eax, 2
  2354 00001664 F72F                                    imul    dword [edi] ; v0
  2355 00001666 8916                                    mov     [esi], edx      ; granule.ch0.sb_hybrid = tmp*v0
  2356 00001668 83C604                                  add     esi, 4
  2357 0000166B 4D                                      dec     ebp
  2358 0000166C 75E3                                    jnz     short .apply_pan_lop
  2359 0000166E EB2C                                    jmp     short .apply_next
  2360                                  
  2361                                  .apply_ms_stereo:
  2362 00001670 F705[94B20000]0200-                     test	dword [mp3_hdr_mode_ext], 2 ; MODE_EXT_MS_STEREO
  2362 00001678 0000               
  2363 0000167A 741D                                    jz	short .apply_none
  2364                                  
  2365                                  .ms_stereo_lop:
  2366 0000167C 8B06                                    mov     eax, [esi]      ; tmp0 = granule.ch0.sb_hybrid[i]
  2367 0000167E 8B9640130000                            mov     edx, [esi+4928] ; [esi+@@right]
  2368                                                                          ; tmp1 = granule.ch1.sb_hybrid[i]
  2369 00001684 29D0                                    sub     eax, edx        ; tmp0 - tmp1
  2370 00001686 8D1450                                  lea     edx, [eax+edx*2] ; tmp0 + tmp1
  2371 00001689 8916                                    mov     [esi], edx      ; granule.ch0.sb_hybrid[i] = tmp0 + tmp1
  2372 0000168B 898640130000                            mov     [esi+4928], eax ; [esi+@@right]
  2373                                                                          ; granule.ch1.sb_hybrid[i] = tmp0 - tmp1
  2374 00001691 83C604                                  add     esi, 4
  2375 00001694 4D                                      dec     ebp
  2376 00001695 75E5                                    jnz     short .ms_stereo_lop
  2377 00001697 EB03                                    jmp     short .apply_next
  2378                                  
  2379                                  .apply_none:
  2380 00001699 8D34AE                                  lea     esi, [esi+ebp*4] ; skip, keep unchanged
  2381                                  
  2382                                  .apply_next:
  2383 0000169C 41                                      inc     ecx             ; iii
  2384 0000169D 3B0D[E0340500]                          cmp     ecx, [_@@n_sfb]
  2385 000016A3 0F8275FFFFFF                            jb      .apply_lop_i   ; next
  2386 000016A9 C3                                      retn
  2387                                  
  2388                                  ; =============== S U B R O U T I N E =======================================
  2389                                  
  2390                                  
  2391                                  mp3_reorder_block:
  2392 000016AA F605[FC8A0000]10                        test    byte [cpuid_flags], 10h ; timelog_start rdtsc_reorder
  2393 000016B1 740E                                    jz      short .no_rdtsc_supported
  2394 000016B3 0F31                                    rdtsc
  2395 000016B5 2905[E48B0000]                          sub     [rdtsc_reorder], eax
  2396 000016BB 1915[E88B0000]                          sbb     [rdtsc_reorder+4], edx
  2397                                  
  2398                                  .no_rdtsc_supported:
  2399 000016C1 807B2C02                                cmp	byte [ebx+44], 2 ; ebx+$mp3gr_block_type] ; only for type 2
  2400 000016C5 7565                                    jnz	short .no_reorder
  2401 000016C7 8DB3A0000000                            lea	esi, [ebx+160]  ; [ebx+$mp3gr_sb_hybrid] ; ptr+0
  2402 000016CD 807B3000                                cmp	byte [ebx+48], 0 ; [ebx+$mp3gr_switch_point]
  2403 000016D1 7412                                    jz	short .this_src
  2404 000016D3 81C690000000                            add	esi, 144        ; 36*4 ; ptr+36*4
  2405 000016D9 833D[6CB20000]08                        cmp	dword [mp3_hdr_sample_rate_index], 8
  2406 000016E0 7503                                    jnz	short .this_src
  2407 000016E2 83C630                                  add	esi, 48         ; 12*4 ; additionally to above 36*4 ; ptr+48*4
  2408                                  
  2409                                  .this_src:
  2410 000016E5 8B531C                                  mov     edx, [ebx+28]   ; [ebx+$mp3gr_short_start] ; can be 13
  2411 000016E8 83FA0D                                  cmp     edx, 13
  2412 000016EB 733F                                    jnb     short .no_reorder
  2413 000016ED C7435C40020000                          mov     dword [ebx+92], 576 ; [ebx+$mp3gr_num_nonzero_hybrids]
  2414                                  
  2415                                  .outer_lop:
  2416 000016F4 A1[6CB20000]                            mov     eax, [mp3_hdr_sample_rate_index]
  2417 000016F9 6BC00D                                  imul    eax, 13         ; X*13
  2418 000016FC 0FB68C10[4C960000]                      movzx   ecx, byte [mp3_band_size_short+eax+edx] ; [X*13+Y]
  2419 00001704 BF[E4340500]                            mov     edi, _@@tmp
  2420 00001709 60                                      pusha
  2421 0000170A 89CA                                    mov     edx, ecx        ; step=len (4..44) ; copy LEN*3 dwords to tmp
  2422                                  
  2423                                  .inner_lop:
  2424 0000170C 8B06                                    mov     eax, [esi]
  2425 0000170E AB                                      stosd
  2426 0000170F 8B0496                                  mov     eax, [esi+edx*4] ; copy 3 dwords
  2427 00001712 AB                                      stosd
  2428 00001713 8B04D6                                  mov     eax, [esi+edx*8]
  2429 00001716 AB                                      stosd
  2430 00001717 83C604                                  add     esi, 4
  2431 0000171A E2F0                                    loop    .inner_lop
  2432 0000171C 61                                      popa
  2433 0000171D 8D0C49                                  lea     ecx, [ecx+ecx*2] ; len*3
  2434 00001720 87FE                                    xchg    esi, edi        ; copy LEN*3 dwords back from tmp
  2435 00001722 F3A5                                    rep movsd
  2436 00001724 87FE                                    xchg    esi, edi
  2437 00001726 42                                      inc     edx
  2438 00001727 83FA0D                                  cmp     edx, 13
  2439 0000172A 72C8                                    jb      short .outer_lop ; next
  2440                                  
  2441                                  .no_reorder:
  2442 0000172C F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
  2443 00001733 740E                                    jz      short .no_rdtsc_supported@ ; timelog_end rdtsc_reorder
  2444 00001735 0F31                                    rdtsc
  2445 00001737 0105[E48B0000]                          add     [rdtsc_reorder], eax
  2446 0000173D 1115[E88B0000]                          adc     [rdtsc_reorder+4], edx
  2447                                  
  2448                                  .no_rdtsc_supported@:
  2449 00001743 C3                                      retn
  2450                                  
  2451                                  
  2452                                  ; =============== S U B R O U T I N E =======================================
  2453                                  
  2454                                  
  2455                                  mp3_compute_antialias:
  2456 00001744 F605[FC8A0000]10                        test    byte [cpuid_flags], 10h ; in: ebx=granule
  2457 0000174B 740E                                    jz      short .no_rdtsc_supported ; timelog_start rdtsc_antialias
  2458 0000174D 0F31                                    rdtsc
  2459 0000174F 2905[FC8B0000]                          sub     [rdtsc_antialias], eax
  2460 00001755 1915[008C0000]                          sbb     [rdtsc_antialias+4], edx
  2461                                  
  2462                                  .no_rdtsc_supported:
  2463 0000175B 8B435C                                  mov     eax, [ebx+92]   ; [ebx+$mp3gr_num_nonzero_hybrids]
  2464 0000175E 83C008                                  add     eax, 8          ; 9-1 ; 0..576+8
  2465 00001761 31D2                                    xor     edx, edx
  2466 00001763 B909000000                              mov     ecx, 9
  2467 00001768 F7F1                                    div     ecx             ; (num/9) ; 0..64
  2468 0000176A 894360                                  mov     [ebx+60h], eax
  2469 0000176D D1E8                                    shr     eax, 1          ; (num/18) ; 0..32
  2470 0000176F 0F84B8010000                            jz      .no_antialias  ; 0 (when num/9 = 0..1)
  2471 00001775 89C1                                    mov     ecx, eax        ; 1..32
  2472 00001777 C1E805                                  shr     eax, 5          ; 0..1
  2473 0000177A 29C1                                    sub     ecx, eax        ; 1..31 ; len excluding zeropadding
  2474 0000177C 807B2C02                                cmp     byte [ebx+44], 2 ; [ebx+$mp3gr_block_type]
  2475 00001780 750F                                    jnz     short .this_len ; antialias only "long" bands
  2476 00001782 807B3000                                cmp     byte [ebx+48], 0 ; [ebx+$mp3gr_switch_point]
  2477 00001786 0F84A1010000                            jz      .no_antialias
  2478 0000178C B901000000                              mov     ecx, 1          ; check this for 8000Hz case
  2479                                  
  2480                                  .this_len:
  2481 00001791 8D440901                                lea     eax, [1+ecx*2]
  2482 00001795 394360                                  cmp     [ebx+96], eax   ; [ebx+$mp3gr_num_nonzero_hybrids_div9]
  2483 00001798 7703                                    ja      short .is_bigger
  2484 0000179A 894360                                  mov     [ebx+96], eax   ; opdate highest
  2485                                                                          ; (nonzero required for l3-si_huff.bit)
  2486                                  
  2487                                  .is_bigger:
  2488 0000179D 53                                      push    ebx
  2489 0000179E 8D9BA0000000                            lea     ebx, [ebx+160]  ; [ebx+$mp3gr_sb_hybrid]
  2490                                  
  2491                                  .lop:
  2492 000017A4 83C348                                  add     ebx, 72         ; 18*4
  2493 000017A7 8B73FC                                  mov     esi, [ebx-4]    ; IRP nn,0,1,2,3,4,5,6,7 ; INT_AA(nn=0..7)
  2494 000017AA 8B3B                                    mov     edi, [ebx]      ; @@def_csa macro nn,cs,ca
  2495                                                                          ;   mp3_csa_&nn&_cs equ cs
  2496                                                                          ;   mp3_csa_&nn&_ca equ ca
  2497                                                                          ;  endm
  2498                                                                          ; constants for mp3_csa_table
  2499 000017AC C1E602                                  shl     esi, 2          ; tmp0 = ptr[-nn-1]*4
  2500 000017AF C1E702                                  shl     edi, 2          ; tmp1 = ptr[+nn]*4
  2501 000017B2 8D043E                                  lea     eax, [esi+edi]  ; tmp2 = tmp0+tmp1
  2502 000017B5 BD032AE136                              mov     ebp, 36E12A03h  ; @@def_csa 0,36E12A03h,-20ED7F9Ah  ;-0.6
  2503                                                                          ; mp3_csa_&nn&_cs
  2504 000017BA F7ED                                    imul    ebp             ; tmp2 = (tmp2*csa[0])
  2505 000017BC 89D5                                    mov     ebp, edx
  2506 000017BE B8635631A8                              mov     eax, -57CEA99Dh ; mp3_csa_&nn&_ca-mp3_csa_&nn&_cs
  2507 000017C3 F7EE                                    imul    esi             ; tmp0 = (tmp2+(tmp0*csa[3]))
  2508 000017C5 01EA                                    add     edx, ebp
  2509 000017C7 8913                                    mov     [ebx], edx      ; [ebx+(nn)*4]
  2510 000017C9 B869AAF315                              mov     eax, 15F3AA69h  ; mp3_csa_&nn&_ca+mp3_csa_&nn&_cs
  2511 000017CE F7EF                                    imul    edi             ; tmp1 = (tmp2-(tmp1*csa[2]))
  2512 000017D0 29D5                                    sub     ebp, edx
  2513 000017D2 896BFC                                  mov     [ebx-4], ebp    ; [ebx-(nn+1)*4]
  2514 000017D5 8B73F8                                  mov     esi, [ebx-8]
  2515 000017D8 8B7B04                                  mov     edi, [ebx+4]
  2516 000017DB C1E602                                  shl     esi, 2
  2517 000017DE C1E702                                  shl     edi, 2
  2518 000017E1 8D043E                                  lea     eax, [esi+edi]
  2519 000017E4 BDFD756E38                              mov     ebp, 386E75FDh  ; @@def_csa 1,386E75FDh,-1E30DB48h  ;-0.535
  2520 000017E9 F7ED                                    imul    ebp
  2521 000017EB 89D5                                    mov     ebp, edx
  2522 000017ED B8BBAE60A9                              mov     eax, -569F5145h
  2523 000017F2 F7EE                                    imul    esi
  2524 000017F4 01EA                                    add     edx, ebp
  2525 000017F6 895304                                  mov     [ebx+4], edx    ; [ebx+(nn)*4]
  2526 000017F9 B8B59A3D1A                              mov     eax, 1A3D9AB5h
  2527 000017FE F7EF                                    imul    edi
  2528 00001800 29D5                                    sub     ebp, edx
  2529 00001802 896BF8                                  mov     [ebx-8], ebp    ; [ebx-(nn+1)*4]
  2530 00001805 8B73F4                                  mov     esi, [ebx-12]
  2531 00001808 8B7B08                                  mov     edi, [ebx+8]
  2532 0000180B C1E602                                  shl     esi, 2
  2533 0000180E C1E702                                  shl     edi, 2
  2534 00001811 8D043E                                  lea     eax, [esi+edi]
  2535 00001814 BD3EB7C63C                              mov     ebp, 3CC6B73Eh  ;  @@def_csa 2,3CC6B73Eh,-140E604Fh  ;-0.33
  2536 00001819 F7ED                                    imul    ebp
  2537 0000181B 89D5                                    mov     ebp, edx
  2538 0000181D B873E82AAF                              mov     eax, -50D5178Dh
  2539 00001822 F7EE                                    imul    esi
  2540 00001824 01EA                                    add     edx, ebp
  2541 00001826 895308                                  mov     [ebx+8], edx    ; [ebx+(nn)*4]
  2542 00001829 B8EF56B828                              mov     eax, 28B856EFh
  2543 0000182E F7EF                                    imul    edi
  2544 00001830 29D5                                    sub     ebp, edx
  2545 00001832 896BF4                                  mov     [ebx-12], ebp   ; [ebx-(nn+1)*4]
  2546 00001835 8B73F0                                  mov     esi, [ebx-16]
  2547 00001838 8B7B0C                                  mov     edi, [ebx+12]
  2548 0000183B C1E602                                  shl     esi, 2
  2549 0000183E C1E702                                  shl     edi, 2
  2550 00001841 8D043E                                  lea     eax, [esi+edi]
  2551 00001844 BD55A0EE3E                              mov     ebp, 3EEEA055h  ; @@def_csa 3,3EEEA055h,-0BA47742h  ;-0.185
  2552 00001849 F7ED                                    imul    ebp
  2553 0000184B 89D5                                    mov     ebp, edx
  2554 0000184D B869E86CB5                              mov     eax, -4A931797h
  2555 00001852 F7EE                                    imul    esi
  2556 00001854 01EA                                    add     edx, ebp
  2557 00001856 89530C                                  mov     [ebx+12], edx   ; [ebx+(nn)*4]
  2558 00001859 B813294A33                              mov     eax, 334A2913h
  2559 0000185E F7EF                                    imul    edi
  2560 00001860 29D5                                    sub     ebp, edx
  2561 00001862 896BF0                                  mov     [ebx-16], ebp   ; [ebx-(nn+1)*4]
  2562 00001865 8B73EC                                  mov     esi, [ebx-20]   ; ebx-(nn+1)*4] ; tmp0 = ptr[-nn-1]
  2563 00001868 8B7B10                                  mov     edi, [ebx+16]   ; [ebx+(nn)*4] ; tmp1 = ptr[+nn]
  2564 0000186B C1E602                                  shl     esi, 2
  2565 0000186E C1E702                                  shl     edi, 2
  2566 00001871 8D043E                                  lea     eax, [esi+edi]  ; tmp2 = tmp0+tmp1
  2567 00001874 BD5C90B63F                              mov     ebp, 3FB6905Ch  ; @@def_csa 4,3FB6905Ch,-060D80E9h  ;-0.095
  2568 00001879 F7ED                                    imul    ebp             ; tmp2 = (tmp2*csa[0])
  2569 0000187B 89D5                                    mov     ebp, edx
  2570 0000187D B8BBEE3BBA                              mov     eax, -45C41145h
  2571 00001882 F7EE                                    imul    esi             ; tmp0 = (tmp2+(tmp0*csa[3]))
  2572 00001884 01EA                                    add     edx, ebp
  2573 00001886 895310                                  mov     [ebx+16], edx   ; [ebx+(nn)*4]
  2574 00001889 B8730FA939                              mov     eax, 39A90F73h
  2575 0000188E F7EF                                    imul    edi             ; tmp1 = (tmp2-(tmp1*csa[2]))
  2576 00001890 29D5                                    sub     ebp, edx
  2577 00001892 896BEC                                  mov     [ebx-20], ebp   ; [ebx-(nn+1)*4]
  2578 00001895 8B73E8                                  mov     esi, [ebx-24]
  2579 00001898 8B7B14                                  mov     edi, [ebx+20]
  2580 0000189B C1E602                                  shl     esi, 2
  2581 0000189E C1E702                                  shl     edi, 2
  2582 000018A1 8D043E                                  lea     eax, [esi+edi]
  2583 000018A4 BD213FF23F                              mov     ebp, 3FF23F21h  ; @@def_csa 5,3FF23F21h,-029F2E1Bh  ;-0.041
  2584 000018A9 F7ED                                    imul    ebp
  2585 000018AB 89D5                                    mov     ebp, edx
  2586 000018AD B8C4926EBD                              mov     eax, -42916D3Ch
  2587 000018B2 F7EE                                    imul    esi
  2588 000018B4 01EA                                    add     edx, ebp
  2589 000018B6 895314                                  mov     [ebx+20], edx   ; [ebx+(nn)*4]
  2590 000018B9 B80611533D                              mov     eax, 3D531106h
  2591 000018BE F7EF                                    imul    edi
  2592 000018C0 29D5                                    sub     ebp, edx
  2593 000018C2 896BE8                                  mov     [ebx-24], ebp   ; [ebx-(nn+1)*4]
  2594 000018C5 8B73E4                                  mov     esi, [ebx-28]
  2595 000018C8 8B7B18                                  mov     edi, [ebx+24]
  2596 000018CB C1E602                                  shl     esi, 2
  2597 000018CE C1E702                                  shl     edi, 2
  2598 000018D1 8D043E                                  lea     eax, [esi+edi]
  2599 000018D4 BD3259FE3F                              mov     ebp, 3FFE5932h  ; @@def_csa 6,3FFE5932h,-00E8A11Ch  ;-0.0142
  2600 000018D9 F7ED                                    imul    ebp
  2601 000018DB 89D5                                    mov     ebp, edx
  2602 000018DD B8B20519BF                              mov     eax, -40E6FA4Eh
  2603 000018E2 F7EE                                    imul    esi
  2604 000018E4 01EA                                    add     edx, ebp
  2605 000018E6 895318                                  mov     [ebx+24], edx   ; [ebx+(nn)*4]
  2606 000018E9 B816B8153F                              mov     eax, 3F15B816h
  2607 000018EE F7EF                                    imul    edi
  2608 000018F0 29D5                                    sub     ebp, edx
  2609 000018F2 896BE4                                  mov     [ebx-28], ebp   ; [ebx-(nn+1)*4]
  2610 000018F5 8B73E0                                  mov     esi, [ebx-32]
  2611 000018F8 8B7B1C                                  mov     edi, [ebx+28]
  2612 000018FB C1E602                                  shl     esi, 2
  2613 000018FE C1E702                                  shl     edi, 2
  2614 00001901 8D043E                                  lea     eax, [esi+edi]
  2615 00001904 BD4BE3FF3F                              mov     ebp, 3FFFE34Bh  ; @@def_csa 7,3FFFE34Bh,-003C9ED1h  ;-0.0037
  2616 00001909 F7ED                                    imul    ebp
  2617 0000190B 89D5                                    mov     ebp, edx
  2618 0000190D B8E47DC3BF                              mov     eax, -403C821Ch
  2619 00001912 F7EE                                    imul    esi
  2620 00001914 01EA                                    add     edx, ebp
  2621 00001916 89531C                                  mov     [ebx+28], edx   ; [ebx+(nn)*4]
  2622 00001919 B87A44C33F                              mov     eax, 3FC3447Ah
  2623 0000191E F7EF                                    imul    edi
  2624 00001920 29D5                                    sub     ebp, edx
  2625 00001922 896BE0                                  mov     [ebx-32], ebp   ; [ebx-(nn+1)*4]
  2626 00001925 49                                      dec     ecx
  2627 00001926 0F8578FEFFFF                            jnz     .lop
  2628 0000192C 5B                                      pop     ebx
  2629                                  
  2630                                  .no_antialias:
  2631 0000192D F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
  2632 00001934 740E                                    jz      short .no_rdtsc_supported@
  2633 00001936 0F31                                    rdtsc
  2634 00001938 0105[FC8B0000]                          add     [rdtsc_antialias], eax
  2635 0000193E 1115[008C0000]                          adc     [rdtsc_antialias+4], edx
  2636                                  
  2637                                  .no_rdtsc_supported@:
  2638 00001944 C3                                      retn
  2639                                  
  2640                                  
  2641                                  ; =============== S U B R O U T I N E =======================================
  2642                                  
  2643                                  
  2644                                  mp3_imdct36:
  2645 00001945 8B06                                    mov     eax, [esi]      ; in: esi=src (sb_hybrid)
  2646                                                                          ; in: edi=dst (sb_samples)
  2647                                                                          ; in: ebx=buf (mdct_buf)
  2648                                                                          ; in: ebp=win (mdct_win)
  2649                                                                          ;
  2650                                                                          ; [esi+0*4]
  2651 00001947 8B5604                                  mov     edx, [esi+4]    ; IRP i,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17
  2652 0000194A 01D0                                    add     eax, edx        ; IF i AND 1 (*) ; mov edx,[esi+i*4] ; val[i]
  2653                                                                          ;  add val[i-1]
  2654 0000194C 894604                                  mov     [esi+4], eax    ;  IF i GT 1
  2655                                                                          ;   add  ecx,eax ; add val[i-2]
  2656                                                                          ;   mov  [esi+(i)*4],ecx
  2657                                                                          ;  ELSE
  2658                                                                          ;   mov  [esi+(i)*4],eax
  2659 0000194F 89C1                                    mov     ecx, eax        ;  memorize as val[i-2]
  2660 00001951 8B4608                                  mov     eax, [esi+8]    ; ELSE (*) ; [esi+i*4] ; val[i]
  2661 00001954 01C2                                    add     edx, eax        ;  add val[i-1]
  2662 00001956 895608                                  mov     [esi+8], edx    ; [esi+(i)*4
  2663 00001959 8B560C                                  mov     edx, [esi+12]
  2664 0000195C 01D0                                    add     eax, edx
  2665 0000195E 01C1                                    add     ecx, eax
  2666 00001960 894E0C                                  mov     [esi+12], ecx
  2667 00001963 89C1                                    mov     ecx, eax
  2668 00001965 8B4610                                  mov     eax, [esi+16]
  2669 00001968 01C2                                    add     edx, eax
  2670 0000196A 895610                                  mov     [esi+16], edx
  2671 0000196D 8B5614                                  mov     edx, [esi+20]
  2672 00001970 01D0                                    add     eax, edx
  2673 00001972 01C1                                    add     ecx, eax
  2674 00001974 894E14                                  mov     [esi+20], ecx
  2675 00001977 89C1                                    mov     ecx, eax
  2676 00001979 8B4618                                  mov     eax, [esi+24]
  2677 0000197C 01C2                                    add     edx, eax
  2678 0000197E 895618                                  mov     [esi+24], edx
  2679 00001981 8B561C                                  mov     edx, [esi+28]
  2680 00001984 01D0                                    add     eax, edx
  2681 00001986 01C1                                    add     ecx, eax
  2682 00001988 894E1C                                  mov     [esi+28], ecx
  2683 0000198B 89C1                                    mov     ecx, eax
  2684 0000198D 8B4620                                  mov     eax, [esi+32]
  2685 00001990 01C2                                    add     edx, eax
  2686 00001992 895620                                  mov     [esi+32], edx
  2687 00001995 8B5624                                  mov     edx, [esi+36]
  2688 00001998 01D0                                    add     eax, edx
  2689 0000199A 01C1                                    add     ecx, eax
  2690 0000199C 894E24                                  mov     [esi+36], ecx
  2691 0000199F 89C1                                    mov     ecx, eax
  2692 000019A1 8B4628                                  mov     eax, [esi+40]
  2693 000019A4 01C2                                    add     edx, eax
  2694 000019A6 895628                                  mov     [esi+40], edx
  2695 000019A9 8B562C                                  mov     edx, [esi+44]
  2696 000019AC 01D0                                    add     eax, edx
  2697 000019AE 01C1                                    add     ecx, eax
  2698 000019B0 894E2C                                  mov     [esi+44], ecx
  2699 000019B3 89C1                                    mov     ecx, eax
  2700 000019B5 8B4630                                  mov     eax, [esi+48]
  2701 000019B8 01C2                                    add     edx, eax
  2702 000019BA 895630                                  mov     [esi+48], edx
  2703 000019BD 8B5634                                  mov     edx, [esi+52]
  2704 000019C0 01D0                                    add     eax, edx
  2705 000019C2 01C1                                    add     ecx, eax
  2706 000019C4 894E34                                  mov     [esi+52], ecx
  2707 000019C7 89C1                                    mov     ecx, eax
  2708 000019C9 8B4638                                  mov     eax, [esi+56]
  2709 000019CC 01C2                                    add     edx, eax
  2710 000019CE 895638                                  mov     [esi+56], edx
  2711 000019D1 8B563C                                  mov     edx, [esi+60]
  2712 000019D4 01D0                                    add     eax, edx
  2713 000019D6 01C1                                    add     ecx, eax
  2714 000019D8 894E3C                                  mov     [esi+60], ecx
  2715 000019DB 89C1                                    mov     ecx, eax
  2716 000019DD 8B4640                                  mov     eax, [esi+64]
  2717 000019E0 01C2                                    add     edx, eax
  2718 000019E2 895640                                  mov     [esi+64], edx
  2719 000019E5 8B5644                                  mov     edx, [esi+68]
  2720 000019E8 01D0                                    add     eax, edx
  2721 000019EA 01C1                                    add     ecx, eax
  2722 000019EC 894E44                                  mov     [esi+68], ecx
  2723 000019EF 89C1                                    mov     ecx, eax
  2724 000019F1 53                                      push    ebx
  2725 000019F2 55                                      push    ebp
  2726 000019F3 57                                      push    edi
  2727 000019F4 8B0E                                    mov     ecx, [esi]      ; IRP j,0,1
  2728 000019F6 8B5E30                                  mov     ebx, [esi+48]   ; t1 = [esi+(0*2+j)*4], t0 = [esi+(6*2+j)*4]
  2729 000019F9 8B7E20                                  mov     edi, [esi+32]   ; t2 = [esi+(4*2+j)*4]
  2730 000019FC 037E40                                  add     edi, [esi+64]   ; + [esi+(8*2+j)*4]
  2731 000019FF 2B7E10                                  sub     edi, [esi+16]   ; - [esi+(2*2+j)*4]
  2732 00001A02 8D2C4B                                  lea     ebp, [ebx+ecx*2] ; t2 = src[4*2+j] + src[8*2+j] - src[2*2+j]
  2733                                                                          ; t3 = [t1*2+t0]
  2734 00001A05 D1FD                                    sar     ebp, 1          ; sar @@t3,1
  2735 00001A07 29D9                                    sub     ecx, ebx        ; sub @@t1,@@t0
  2736 00001A09 89C8                                    mov     eax, ecx        ; @@SUM [@@tmp+(16+j)*4],@@t1,add,@@t2
  2737 00001A0B 01F8                                    add     eax, edi
  2738 00001A0D A3[303E0500]                            mov     [_@@@tmp+40h], eax ; [@@tmp+(16+j)*4]
  2739 00001A12 D1FF                                    sar     edi, 1          ; sar @@t2,1
  2740 00001A14 89C8                                    mov     eax, ecx        ; @@SUM [@@tmp+(6+j)*4],@@t1,sub,@@t2
  2741 00001A16 29F8                                    sub     eax, edi
  2742 00001A18 A3[083E0500]                            mov     [_@@@tmp+18h], eax ; [@@tmp+(6+j)*4]
  2743 00001A1D 8B4610                                  mov     eax, [esi+16]   ; [esi+(4*2+j)*4]
  2744 00001A20 034620                                  add     eax, [esi+32]   ; [esi+(2*2+j)*4]
  2745 00001A23 D1E0                                    shl     eax, 1
  2746 00001A25 BA0AD94778                              mov     edx, 7847D90Ah  ; C2
  2747 00001A2A F7EA                                    imul    edx
  2748 00001A2C 89D3                                    mov     ebx, edx
  2749 00001A2E 8B4620                                  mov     eax, [esi+32]
  2750 00001A31 2B4640                                  sub     eax, [esi+64]
  2751 00001A34 BA04CB8BD3                              mov     edx, 0D38BCB04h ; negC8
  2752 00001A39 F7EA                                    imul    edx
  2753 00001A3B 89D1                                    mov     ecx, edx
  2754 00001A3D 8B4610                                  mov     eax, [esi+16]
  2755 00001A40 034640                                  add     eax, [esi+64]
  2756 00001A43 D1E0                                    shl     eax, 1
  2757 00001A45 BA7541F29D                              mov     edx, 9DF24175h  ; negC4
  2758 00001A4A F7EA                                    imul    edx
  2759 00001A4C 89E8                                    mov     eax, ebp
  2760 00001A4E 01D8                                    add     eax, ebx
  2761 00001A50 01C8                                    add     eax, ecx
  2762 00001A52 A3[F83D0500]                            mov     [_@@@tmp+8], eax
  2763 00001A57 89E8                                    mov     eax, ebp
  2764 00001A59 29D8                                    sub     eax, ebx
  2765 00001A5B 29D0                                    sub     eax, edx
  2766 00001A5D A3[183E0500]                            mov     [_@@@tmp+28h], eax
  2767 00001A62 89E8                                    mov     eax, ebp
  2768 00001A64 01D0                                    add     eax, edx
  2769 00001A66 29C8                                    sub     eax, ecx
  2770 00001A68 A3[283E0500]                            mov     [_@@@tmp+38h], eax
  2771 00001A6D 8B4628                                  mov     eax, [esi+40]
  2772 00001A70 034638                                  add     eax, [esi+56]
  2773 00001A73 2B4608                                  sub     eax, [esi+8]
  2774 00001A76 D1E0                                    shl     eax, 1
  2775 00001A78 BA5F142691                              mov     edx, 9126145Fh  ; negC3
  2776 00001A7D F7EA                                    imul    edx
  2777 00001A7F 8915[003E0500]                          mov     [_@@@tmp+10h], edx
  2778 00001A85 8B4608                                  mov     eax, [esi+8]
  2779 00001A88 034628                                  add     eax, [esi+40]
  2780 00001A8B D1E0                                    shl     eax, 1
  2781 00001A8D BA332E0E7E                              mov     edx, 7E0E2E33h  ; C1
  2782 00001A92 F7EA                                    imul    edx
  2783 00001A94 89D7                                    mov     edi, edx
  2784 00001A96 8B4628                                  mov     eax, [esi+40]
  2785 00001A99 2B4638                                  sub     eax, [esi+56]
  2786 00001A9C BA2E5E71A8                              mov     edx, 0A8715E2Eh ; negC7
  2787 00001AA1 F7EA                                    imul    edx
  2788 00001AA3 89D5                                    mov     ebp, edx
  2789 00001AA5 8B4608                                  mov     eax, [esi+8]
  2790 00001AA8 034638                                  add     eax, [esi+56]
  2791 00001AAB D1E0                                    shl     eax, 1
  2792 00001AAD BAB822B9AD                              mov     edx, 0ADB922B8h ; negC5
  2793 00001AB2 F7EA                                    imul    edx
  2794 00001AB4 89D1                                    mov     ecx, edx
  2795 00001AB6 8B4618                                  mov     eax, [esi+24]
  2796 00001AB9 D1E0                                    shl     eax, 1
  2797 00001ABB BAA2EBD96E                              mov     edx, 6ED9EBA2h  ; C3
  2798 00001AC0 F7EA                                    imul    edx
  2799 00001AC2 89E8                                    mov     eax, ebp
  2800 00001AC4 01F8                                    add     eax, edi
  2801 00001AC6 01D0                                    add     eax, edx
  2802 00001AC8 A3[F03D0500]                            mov     [_@@@tmp], eax
  2803 00001ACD 89E8                                    mov     eax, ebp
  2804 00001ACF 29C8                                    sub     eax, ecx
  2805 00001AD1 29D0                                    sub     eax, edx
  2806 00001AD3 A3[103E0500]                            mov     [_@@@tmp+20h], eax
  2807 00001AD8 89F8                                    mov     eax, edi
  2808 00001ADA 01C8                                    add     eax, ecx
  2809 00001ADC 29D0                                    sub     eax, edx
  2810 00001ADE A3[203E0500]                            mov     [_@@@tmp+30h], eax
  2811 00001AE3 8B4E04                                  mov     ecx, [esi+4]
  2812 00001AE6 8B5E34                                  mov     ebx, [esi+52]
  2813 00001AE9 8B7E24                                  mov     edi, [esi+36]
  2814 00001AEC 037E44                                  add     edi, [esi+68]
  2815 00001AEF 2B7E14                                  sub     edi, [esi+20]
  2816 00001AF2 8D2C4B                                  lea     ebp, [ebx+ecx*2]
  2817 00001AF5 D1FD                                    sar     ebp, 1
  2818 00001AF7 29D9                                    sub     ecx, ebx
  2819 00001AF9 89C8                                    mov     eax, ecx
  2820 00001AFB 01F8                                    add     eax, edi
  2821 00001AFD A3[343E0500]                            mov     [_@@@tmp+44h], eax
  2822 00001B02 D1FF                                    sar     edi, 1
  2823 00001B04 89C8                                    mov     eax, ecx
  2824 00001B06 29F8                                    sub     eax, edi
  2825 00001B08 A3[0C3E0500]                            mov     [_@@@tmp+1Ch], eax
  2826 00001B0D 8B4614                                  mov     eax, [esi+20]   ; t0 = MULH(2*(src[2*2+j]+src[4*2+j]),C2)
  2827 00001B10 034624                                  add     eax, [esi+36]
  2828 00001B13 D1E0                                    shl     eax, 1
  2829 00001B15 BA0AD94778                              mov     edx, 7847D90Ah  ; C2
  2830 00001B1A F7EA                                    imul    edx
  2831 00001B1C 89D3                                    mov     ebx, edx
  2832 00001B1E 8B4624                                  mov     eax, [esi+36]   ; t1 = MULH(src[4*2+j]-src[8*2+j],negC8)
  2833 00001B21 2B4644                                  sub     eax, [esi+68]
  2834 00001B24 BA04CB8BD3                              mov     edx, 0D38BCB04h ; negC8
  2835 00001B29 F7EA                                    imul    edx
  2836 00001B2B 89D1                                    mov     ecx, edx
  2837 00001B2D 8B4614                                  mov     eax, [esi+20]   ; t2 = MULH(2*(src[2*2+j]+src[8*2+j]),negC4)
  2838 00001B30 034644                                  add     eax, [esi+68]
  2839 00001B33 D1E0                                    shl     eax, 1
  2840 00001B35 BA7541F29D                              mov     edx, 9DF24175h  ; negC4
  2841 00001B3A F7EA                                    imul    edx
  2842 00001B3C 89E8                                    mov     eax, ebp        ; tmp[2+j] = t3+t0+t1
  2843 00001B3E 01D8                                    add     eax, ebx
  2844 00001B40 01C8                                    add     eax, ecx
  2845 00001B42 A3[FC3D0500]                            mov     [_@@@tmp+0Ch], eax
  2846 00001B47 89E8                                    mov     eax, ebp        ; tmp[10+j] = t3-t0-t2
  2847 00001B49 29D8                                    sub     eax, ebx
  2848 00001B4B 29D0                                    sub     eax, edx
  2849 00001B4D A3[1C3E0500]                            mov     [_@@@tmp+2Ch], eax
  2850 00001B52 89E8                                    mov     eax, ebp        ; tmp[14+j] = t3+t2-t1
  2851 00001B54 01D0                                    add     eax, edx
  2852 00001B56 29C8                                    sub     eax, ecx
  2853 00001B58 A3[2C3E0500]                            mov     [_@@@tmp+3Ch], eax
  2854 00001B5D 8B462C                                  mov     eax, [esi+44]   ; tmp[4+j] = MULH(2*(src[5*2+j]+src[7*2+j]-src[1*2+j]),negC3)
  2855 00001B60 03463C                                  add     eax, [esi+60]
  2856 00001B63 2B460C                                  sub     eax, [esi+12]
  2857 00001B66 D1E0                                    shl     eax, 1
  2858 00001B68 BA5F142691                              mov     edx, 9126145Fh  ; negC3
  2859 00001B6D F7EA                                    imul    edx
  2860 00001B6F 8915[043E0500]                          mov     [_@@@tmp+14h], edx
  2861 00001B75 8B460C                                  mov     eax, [esi+12]   ; @@MULH @@t2,[esi+(1*2+j)*4],add,[esi+(5*2+j)*4],-,-              ,1,C1,-
  2862                                                                          ; t2 = MULH(2*(src[1*2+j],add,src[5*2+j]),-,-,1,C1)
  2863 00001B78 03462C                                  add     eax, [esi+44]
  2864 00001B7B D1E0                                    shl     eax, 1
  2865 00001B7D BA332E0E7E                              mov     edx, 7E0E2E33h  ; C1
  2866 00001B82 F7EA                                    imul    edx
  2867 00001B84 89D7                                    mov     edi, edx
  2868 00001B86 8B462C                                  mov     eax, [esi+44]   ; @@MULH @@t3,[esi+(5*2+j)*4],sub,[esi+(7*2+j)*4],-,-,
  2869                                                                          ; ,0,negC7,-
  2870                                                                          ;
  2871                                                                          ; t3 = MULH( src[5*2+j],sub,src[7*2+j],-,-,0,negC7)
  2872 00001B89 2B463C                                  sub     eax, [esi+60]
  2873 00001B8C BA2E5E71A8                              mov     edx, 0A8715E2Eh ; negC7
  2874 00001B91 F7EA                                    imul    edx
  2875 00001B93 89D5                                    mov     ebp, edx
  2876 00001B95 8B460C                                  mov     eax, [esi+12]   ; t1 = MULH(2*(src[1*2+j],add,src[7*2+j]),-,-,1,negC5)
  2877 00001B98 03463C                                  add     eax, [esi+60]
  2878 00001B9B D1E0                                    shl     eax, 1          ; shift = 1
  2879 00001B9D BAB822B9AD                              mov     edx, 0ADB922B8h ; negC5
  2880 00001BA2 F7EA                                    imul    edx
  2881 00001BA4 89D1                                    mov     ecx, edx
  2882 00001BA6 8B461C                                  mov     eax, [esi+28]   ; t0 = MULH(2*src[3*2+j],-,-,-,-,1,C3)
  2883 00001BA9 D1E0                                    shl     eax, 1
  2884 00001BAB BAA2EBD96E                              mov     edx, 6ED9EBA2h  ; C3
  2885 00001BB0 F7EA                                    imul    edx
  2886 00001BB2 89E8                                    mov     eax, ebp
  2887 00001BB4 01F8                                    add     eax, edi
  2888 00001BB6 01D0                                    add     eax, edx
  2889 00001BB8 A3[F43D0500]                            mov     [_@@@tmp+4], eax
  2890 00001BBD 89E8                                    mov     eax, ebp
  2891 00001BBF 29C8                                    sub     eax, ecx
  2892 00001BC1 29D0                                    sub     eax, edx
  2893 00001BC3 A3[143E0500]                            mov     [_@@@tmp+24h], eax
  2894 00001BC8 89F8                                    mov     eax, edi        ; @@SUM [@@tmp+(12+j)*4],@@t2,add,@@t1,sub,edx
  2895 00001BCA 01C8                                    add     eax, ecx
  2896 00001BCC 29D0                                    sub     eax, edx
  2897 00001BCE A3[243E0500]                            mov     [_@@@tmp+34h], eax
  2898 00001BD3 5F                                      pop     edi
  2899 00001BD4 5D                                      pop     ebp
  2900 00001BD5 5B                                      pop     ebx
  2901 00001BD6 56                                      push    esi             ; IRP j,0,1,2,3 ; j = 0
  2902 00001BD7 8B15[F03D0500]                          mov     edx, [_@@@tmp] ; t0 = [@@tmp+(j*4+0)*4]
  2903 00001BDD 8B35[F43D0500]                          mov     esi, [_@@@tmp+4] ; t1 = [@@tmp+(j*4+1)*4]
  2904 00001BE3 A1[F83D0500]                            mov     eax, [_@@@tmp+8] ; t2 = [@@tmp+(j*4+2)*4]
  2905 00001BE8 8B0D[FC3D0500]                          mov     ecx, [_@@@tmp+0Ch] ; t2 = [@@tmp+(j*4+3)*4]
  2906 00001BEE 29D0                                    sub     eax, edx        ; s2 = t2 - t0
  2907 00001BF0 8D1450                                  lea     edx, [eax+edx*2] ; s0 = t2 + t0
  2908 00001BF3 A3[E83D0500]                            mov     [_@@s2], eax ; @@MULH esi,eax ,-,-,-,-,1,icos36h_&j,-
  2909                                                                          ; s2 = MULH(s2*2, icos36h[j])
  2910 00001BF8 8915[E43D0500]                          mov     [_@@s0], edx
  2911 00001BFE 29F1                                    sub     ecx, esi
  2912 00001C00 8D0471                                  lea     eax, [ecx+esi*2]
  2913 00001C03 D1E0                                    shl     eax, 1
  2914 00001C05 BA90953E40                              mov     edx, 403E9590h  ; icos36h_0
  2915 00001C0A F7EA                                    imul    edx
  2916 00001C0C 89D6                                    mov     esi, edx
  2917 00001C0E 89C8                                    mov     eax, ecx        ; @@MULH @@s3,ecx,-,-,-,-,shift_for_8minus&j,icos36h_8minus&j,-
  2918                                                                          ; s3 = MULL(s3,icos36[8-j]) ; <-- "MULL" with "icos36"
  2919 00001C10 C1E004                                  shl     eax, 4
  2920 00001C13 BA2C2ACA5B                              mov     edx, 5BCA2A2Ch  ; icos36h_8 (8-0)
  2921 00001C18 F7EA                                    imul    edx
  2922 00001C1A 8915[EC3D0500]                          mov     [_@@s3], edx
  2923 00001C20 8B0D[E43D0500]                          mov     ecx, [_@@s0]
  2924 00001C26 29F1                                    sub     ecx, esi
  2925 00001C28 8D3471                                  lea     esi, [ecx+esi*2]
  2926 00001C2B 8B4524                                  mov     eax, [ebp+36]   ; @@MULH [edi+(9+j)*SBLIMIT*4],[ebp+(9+j)*4],
  2927                                                                          ; -,-,-,-,0,ecx,[ebx+(9+j)*4]
  2928                                                                          ; out[(9+j)*SBLIMIT] = MULH(t0, win[9+j])+buf[9+j]
  2929 00001C2E F7E9                                    imul    ecx
  2930 00001C30 035324                                  add     edx, [ebx+36]   ; [ebx+(9+j)*4]
  2931 00001C33 899780040000                            mov     [edi+1152], edx ; SBLIMIT=32 ; 9*SBLIMIT*4 = 1152
  2932 00001C39 8B4520                                  mov     eax, [ebp+32]   ; @@MULH [edi+(8-j)*SBLIMIT*4],[ebp+(8-j)*4]
  2933                                                                          ; ,-,-,-,-,0,ecx,[ebx+(8-j)*4]
  2934 00001C3C F7E9                                    imul    ecx
  2935 00001C3E 035320                                  add     edx, [ebx+32]
  2936 00001C41 899700040000                            mov     [edi+1024], edx ; SBLIMIT=32 ; 8*SBLIMIT*4 = 1024
  2937 00001C47 8B456C                                  mov     eax, [ebp+108]
  2938 00001C4A F7EE                                    imul    esi
  2939 00001C4C 895324                                  mov     [ebx+36], edx
  2940 00001C4F 8B4568                                  mov     eax, [ebp+104]  ; @@MULH [ebx+(8-j)*4],[ebp+(8-j+18)*4],-,-,-,-,0,esi,-
  2941 00001C52 F7EE                                    imul    esi
  2942 00001C54 895320                                  mov     [ebx+32], edx
  2943 00001C57 8B0D[E83D0500]                          mov     ecx, [_@@s2]
  2944 00001C5D 8B35[EC3D0500]                          mov     esi, [_@@s3]
  2945 00001C63 29F1                                    sub     ecx, esi        ; t2 = s2 - s3
  2946 00001C65 8D3471                                  lea     esi, [ecx+esi*2] ; t3 = s2 + s3
  2947 00001C68 8B4500                                  mov     eax, [ebp+0]    ; @@MULH [edi+(0+j)*SBLIMIT*4],[ebp+(0+j)*4],
  2948                                                                          ; -,-,-,-,0,ecx,[ebx+(0+j)*4]
  2949 00001C6B F7E9                                    imul    ecx
  2950 00001C6D 0313                                    add     edx, [ebx]
  2951 00001C6F 8917                                    mov     [edi], edx
  2952 00001C71 8B4544                                  mov     eax, [ebp+68]   ; @@MULH [edi+(17-j)*SBLIMIT*4],[ebp+(17-j)*4]
  2953                                                                          ; ,-,-,-,-,0,ecx,[ebx+(17-j)*4]
  2954 00001C74 F7E9                                    imul    ecx
  2955 00001C76 035344                                  add     edx, [ebx+68]
  2956 00001C79 899780080000                            mov     [edi+2176], edx ; 17*SBLIMIT*4 = 2176
  2957 00001C7F 8B4548                                  mov     eax, [ebp+72]   ; @@MULH [ebx+(0+j)*4],[ebp+(0+j+18)*4],-,-,-,-,0,esi,-
  2958 00001C82 F7EE                                    imul    esi
  2959 00001C84 8913                                    mov     [ebx], edx
  2960 00001C86 8B858C000000                            mov     eax, [ebp+140]  ; @@MULH [ebx+(17-j)*4],[ebp+(17-j+18)*4],-,-,-,-,0,esi,-
  2961 00001C8C F7EE                                    imul    esi
  2962 00001C8E 895344                                  mov     [ebx+68], edx
  2963 00001C91 8B15[003E0500]                          mov     edx, [_@@@tmp+10h] ; IRP j,0,1,2,3 ; j = 1
  2964 00001C97 8B35[043E0500]                          mov     esi, [_@@@tmp+14h]
  2965 00001C9D A1[083E0500]                            mov     eax, [_@@@tmp+18h]
  2966 00001CA2 8B0D[0C3E0500]                          mov     ecx, [_@@@tmp+1Ch]
  2967 00001CA8 29D0                                    sub     eax, edx
  2968 00001CAA 8D1450                                  lea     edx, [eax+edx*2]
  2969 00001CAD A3[E83D0500]                            mov     [_@@s2], eax
  2970 00001CB2 8915[E43D0500]                          mov     [_@@s0], edx
  2971 00001CB8 29F1                                    sub     ecx, esi
  2972 00001CBA 8D0471                                  lea     eax, [ecx+esi*2]
  2973 00001CBD D1E0                                    shl     eax, 1
  2974 00001CBF BA07F74142                              mov     edx, 4241F707h  ; icos36h_1
  2975 00001CC4 F7EA                                    imul    edx
  2976 00001CC6 89D6                                    mov     esi, edx
  2977 00001CC8 89C8                                    mov     eax, ecx
  2978 00001CCA C1E002                                  shl     eax, 2
  2979 00001CCD BA1E75A37B                              mov     edx, 7BA3751Eh  ; icos36h_7 (8-1)
  2980 00001CD2 F7EA                                    imul    edx
  2981 00001CD4 8915[EC3D0500]                          mov     [_@@s3], edx
  2982 00001CDA 8B0D[E43D0500]                          mov     ecx, [_@@s0]
  2983 00001CE0 29F1                                    sub     ecx, esi
  2984 00001CE2 8D3471                                  lea     esi, [ecx+esi*2]
  2985 00001CE5 8B4528                                  mov     eax, [ebp+40]
  2986 00001CE8 F7E9                                    imul    ecx
  2987 00001CEA 035328                                  add     edx, [ebx+40]
  2988 00001CED 899700050000                            mov     [edi+1280], edx
  2989 00001CF3 8B451C                                  mov     eax, [ebp+28]
  2990 00001CF6 F7E9                                    imul    ecx
  2991 00001CF8 03531C                                  add     edx, [ebx+28]
  2992 00001CFB 899780030000                            mov     [edi+896], edx
  2993 00001D01 8B4570                                  mov     eax, [ebp+112]
  2994 00001D04 F7EE                                    imul    esi
  2995 00001D06 895328                                  mov     [ebx+40], edx
  2996 00001D09 8B4564                                  mov     eax, [ebp+100]
  2997 00001D0C F7EE                                    imul    esi
  2998 00001D0E 89531C                                  mov     [ebx+28], edx
  2999 00001D11 8B0D[E83D0500]                          mov     ecx, [_@@s2]
  3000 00001D17 8B35[EC3D0500]                          mov     esi, [_@@s3]
  3001 00001D1D 29F1                                    sub     ecx, esi
  3002 00001D1F 8D3471                                  lea     esi, [ecx+esi*2]
  3003 00001D22 8B4504                                  mov     eax, [ebp+4]
  3004 00001D25 F7E9                                    imul    ecx
  3005 00001D27 035304                                  add     edx, [ebx+4]
  3006 00001D2A 899780000000                            mov     [edi+128], edx
  3007 00001D30 8B4540                                  mov     eax, [ebp+64]
  3008 00001D33 F7E9                                    imul    ecx
  3009 00001D35 035340                                  add     edx, [ebx+64]
  3010 00001D38 899700080000                            mov     [edi+2048], edx
  3011 00001D3E 8B454C                                  mov     eax, [ebp+76]
  3012 00001D41 F7EE                                    imul    esi
  3013 00001D43 895304                                  mov     [ebx+4], edx
  3014 00001D46 8B8588000000                            mov     eax, [ebp+136]
  3015 00001D4C F7EE                                    imul    esi
  3016 00001D4E 895340                                  mov     [ebx+64], edx
  3017 00001D51 8B15[103E0500]                          mov     edx, [_@@@tmp+20h] ; IRP j,0,1,2,3 ; j = 2
  3018 00001D57 8B35[143E0500]                          mov     esi, [_@@@tmp+24h]
  3019 00001D5D A1[183E0500]                            mov     eax, [_@@@tmp+28h]
  3020 00001D62 8B0D[1C3E0500]                          mov     ecx, [_@@@tmp+2Ch]
  3021 00001D68 29D0                                    sub     eax, edx
  3022 00001D6A 8D1450                                  lea     edx, [eax+edx*2]
  3023 00001D6D A3[E83D0500]                            mov     [_@@s2], eax
  3024 00001D72 8915[E43D0500]                          mov     [_@@s0], edx
  3025 00001D78 29F1                                    sub     ecx, esi
  3026 00001D7A 8D0471                                  lea     eax, [ecx+esi*2]
  3027 00001D7D D1E0                                    shl     eax, 1
  3028 00001D7F BA6CBE9D46                              mov     edx, 469DBE6Ch  ; icos36h_2
  3029 00001D84 F7EA                                    imul    edx
  3030 00001D86 89D6                                    mov     esi, edx
  3031 00001D88 89C8                                    mov     eax, ecx
  3032 00001D8A C1E002                                  shl     eax, 2
  3033 00001D8D BA62ECB74B                              mov     edx, 4BB7EC62h  ; icos36h_6 (8-2)
  3034 00001D92 F7EA                                    imul    edx
  3035 00001D94 8915[EC3D0500]                          mov     [_@@s3], edx
  3036 00001D9A 8B0D[E43D0500]                          mov     ecx, [_@@s0]
  3037 00001DA0 29F1                                    sub     ecx, esi
  3038 00001DA2 8D3471                                  lea     esi, [ecx+esi*2]
  3039 00001DA5 8B452C                                  mov     eax, [ebp+44]
  3040 00001DA8 F7E9                                    imul    ecx
  3041 00001DAA 03532C                                  add     edx, [ebx+44]
  3042 00001DAD 899780050000                            mov     [edi+1408], edx
  3043 00001DB3 8B4518                                  mov     eax, [ebp+24]
  3044 00001DB6 F7E9                                    imul    ecx
  3045 00001DB8 035318                                  add     edx, [ebx+24]
  3046 00001DBB 899700030000                            mov     [edi+768], edx
  3047 00001DC1 8B4574                                  mov     eax, [ebp+116]
  3048 00001DC4 F7EE                                    imul    esi
  3049 00001DC6 89532C                                  mov     [ebx+44], edx
  3050 00001DC9 8B4560                                  mov     eax, [ebp+96]
  3051 00001DCC F7EE                                    imul    esi
  3052 00001DCE 895318                                  mov     [ebx+24], edx
  3053 00001DD1 8B0D[E83D0500]                          mov     ecx, [_@@s2]
  3054 00001DD7 8B35[EC3D0500]                          mov     esi, [_@@s3]
  3055 00001DDD 29F1                                    sub     ecx, esi
  3056 00001DDF 8D3471                                  lea     esi, [ecx+esi*2]
  3057 00001DE2 8B4508                                  mov     eax, [ebp+8]
  3058 00001DE5 F7E9                                    imul    ecx
  3059 00001DE7 035308                                  add     edx, [ebx+8]
  3060 00001DEA 899700010000                            mov     [edi+256], edx
  3061 00001DF0 8B453C                                  mov     eax, [ebp+60]
  3062 00001DF3 F7E9                                    imul    ecx
  3063 00001DF5 03533C                                  add     edx, [ebx+60]
  3064 00001DF8 899780070000                            mov     [edi+1920], edx
  3065 00001DFE 8B4550                                  mov     eax, [ebp+80]
  3066 00001E01 F7EE                                    imul    esi
  3067 00001E03 895308                                  mov     [ebx+8], edx
  3068 00001E06 8B8584000000                            mov     eax, [ebp+132]
  3069 00001E0C F7EE                                    imul    esi
  3070 00001E0E 89533C                                  mov     [ebx+60], edx
  3071 00001E11 8B15[203E0500]                          mov     edx, [_@@@tmp+30h] ; IRP j,0,1,2,3 ; j = 3
  3072 00001E17 8B35[243E0500]                          mov     esi, [_@@@tmp+34h]
  3073 00001E1D A1[283E0500]                            mov     eax, [_@@@tmp+38h]
  3074 00001E22 8B0D[2C3E0500]                          mov     ecx, [_@@@tmp+3Ch]
  3075 00001E28 29D0                                    sub     eax, edx
  3076 00001E2A 8D1450                                  lea     edx, [eax+edx*2]
  3077 00001E2D A3[E83D0500]                            mov     [_@@s2], eax
  3078 00001E32 8915[E43D0500]                          mov     [_@@s0], edx
  3079 00001E38 29F1                                    sub     ecx, esi
  3080 00001E3A 8D0471                                  lea     eax, [ecx+esi*2]
  3081 00001E3D D1E0                                    shl     eax, 1
  3082 00001E3F BABE2B214E                              mov     edx, 4E212BBEh  ; icos36h_3
  3083 00001E44 F7EA                                    imul    edx
  3084 00001E46 89D6                                    mov     esi, edx
  3085 00001E48 89C8                                    mov     eax, ecx
  3086 00001E4A D1E0                                    shl     eax, 1
  3087 00001E4C BADFA1946F                              mov     edx, 6F94A1DFh  ; icos36h_5 (8-3)
  3088 00001E51 F7EA                                    imul    edx
  3089 00001E53 8915[EC3D0500]                          mov     [_@@s3], edx
  3090 00001E59 8B0D[E43D0500]                          mov     ecx, [_@@s0]
  3091 00001E5F 29F1                                    sub     ecx, esi
  3092 00001E61 8D3471                                  lea     esi, [ecx+esi*2]
  3093 00001E64 8B4530                                  mov     eax, [ebp+48]
  3094 00001E67 F7E9                                    imul    ecx
  3095 00001E69 035330                                  add     edx, [ebx+48]
  3096 00001E6C 899700060000                            mov     [edi+1536], edx
  3097 00001E72 8B4514                                  mov     eax, [ebp+20]
  3098 00001E75 F7E9                                    imul    ecx
  3099 00001E77 035314                                  add     edx, [ebx+20]
  3100 00001E7A 899780020000                            mov     [edi+640], edx
  3101 00001E80 8B4578                                  mov     eax, [ebp+120]
  3102 00001E83 F7EE                                    imul    esi
  3103 00001E85 895330                                  mov     [ebx+30h], edx
  3104 00001E88 8B455C                                  mov     eax, [ebp+92]
  3105 00001E8B F7EE                                    imul    esi
  3106 00001E8D 895314                                  mov     [ebx+20], edx
  3107 00001E90 8B0D[E83D0500]                          mov     ecx, [_@@s2]
  3108 00001E96 8B35[EC3D0500]                          mov     esi, [_@@s3]
  3109 00001E9C 29F1                                    sub     ecx, esi
  3110 00001E9E 8D3471                                  lea     esi, [ecx+esi*2]
  3111 00001EA1 8B450C                                  mov     eax, [ebp+12]
  3112 00001EA4 F7E9                                    imul    ecx
  3113 00001EA6 03530C                                  add     edx, [ebx+12]
  3114 00001EA9 899780010000                            mov     [edi+384], edx
  3115 00001EAF 8B4538                                  mov     eax, [ebp+56]
  3116 00001EB2 F7E9                                    imul    ecx
  3117 00001EB4 035338                                  add     edx, [ebx+56]
  3118 00001EB7 899700070000                            mov     [edi+1792], edx
  3119 00001EBD 8B4554                                  mov     eax, [ebp+84]
  3120 00001EC0 F7EE                                    imul    esi
  3121 00001EC2 89530C                                  mov     [ebx+12], edx
  3122 00001EC5 8B8580000000                            mov     eax, [ebp+128]
  3123 00001ECB F7EE                                    imul    esi
  3124 00001ECD 895338                                  mov     [ebx+56], edx
  3125 00001ED0 8B0D[303E0500]                          mov     ecx, [_@@@tmp+40h] ; IRP j,4
  3126                                                                          ; [@@tmp+(j*4+0)*4]
  3127 00001ED6 A1[343E0500]                            mov     eax, [_@@@tmp+44h] ; [@@tmp+(j*4+1)*4]
  3128 00001EDB D1E0                                    shl     eax, 1
  3129 00001EDD BA9A79825A                              mov     edx, 5A82799Ah  ; icos36h_4 (8-4)
  3130 00001EE2 F7EA                                    imul    edx
  3131 00001EE4 29D1                                    sub     ecx, edx
  3132 00001EE6 8D3451                                  lea     esi, [ecx+edx*2]
  3133 00001EE9 8B4534                                  mov     eax, [ebp+52]   ; @@MULH [edi+(9+j)*SBLIMIT*4],[ebp+(9+j)*4],
  3134                                                                          ; -,-,-,-,0,ecx,[ebx+(9+j)*4]
  3135                                                                          ; out[(9+4)*SBLIMIT] = MULH(t0,win[9+4])+buf[9+4]
  3136 00001EEC F7E9                                    imul    ecx
  3137 00001EEE 035334                                  add     edx, [ebx+52]
  3138 00001EF1 899780060000                            mov     [edi+1664], edx ; 13*SBLIMIT*4 = 1664
  3139 00001EF7 8B4510                                  mov     eax, [ebp+16]   ; @MULH [edi+(8-j)*SBLIMIT*4],[ebp+(8-j)*4],
  3140                                                                          ; -,-,-,-,0,ecx,[ebx+(8-j)*4]
  3141 00001EFA F7E9                                    imul    ecx
  3142 00001EFC 035310                                  add     edx, [ebx+16]
  3143 00001EFF 899700020000                            mov     [edi+512], edx
  3144 00001F05 8B457C                                  mov     eax, [ebp+124]  ; @@MULH [ebx+(9+j)*4],[ebp+(9+j+18)*4] ,-,-,-,-,0,esi,-
  3145 00001F08 F7EE                                    imul    esi
  3146 00001F0A 895334                                  mov     [ebx+52], edx
  3147 00001F0D 8B4558                                  mov     eax, [ebp+88]   ; @@MULH [ebx+(8-j)*4],[ebp+(8-j+18)*4],-,-,-,-,0,esi,-
  3148 00001F10 F7EE                                    imul    esi
  3149 00001F12 895310                                  mov     [ebx+16], edx
  3150 00001F15 5E                                      pop     esi
  3151 00001F16 C3                                      retn
  3152                                  
  3153                                  
  3154                                  ; =============== S U B R O U T I N E =======================================
  3155                                  
  3156                                  
  3157                                  mp3_imdct12:
  3158 00001F17 8B06                                    mov     eax, [esi]      ; in: esi=src - out: [out2_...]
  3159 00001F19 A3[383E0500]                            mov     [_@@tmp0], eax  ; IRP nn,0,1,2,3,4,5
  3160                                                                          ;  @@tmp&nn rd 1
  3161                                                                          ; ENDM
  3162                                                                          ; mov  eax,[esi+0*3*4] ; = src[0*3]
  3163 00001F1E 8B560C                                  mov     edx, [esi+12]   ; [esi+1*3*4] ; = src[1*3]
  3164 00001F21 01D0                                    add     eax, edx        ; = src[0*3]+src[1*3]
  3165 00001F23 A3[3C3E0500]                            mov     [_@@tmp1], eax
  3166 00001F28 8B4618                                  mov     eax, [esi+24]
  3167 00001F2B 01C2                                    add     edx, eax
  3168 00001F2D 8915[403E0500]                          mov     [_@@tmp2], edx
  3169 00001F33 8B5624                                  mov     edx, [esi+36]   ; [esi+3*3*4]
  3170 00001F36 01D0                                    add     eax, edx
  3171 00001F38 A3[443E0500]                            mov     [_@@tmp3], eax
  3172 00001F3D 8B4630                                  mov     eax, [esi+48]
  3173 00001F40 01C2                                    add     edx, eax
  3174 00001F42 8915[483E0500]                          mov     [_@@tmp4], edx
  3175 00001F48 8B563C                                  mov     edx, [esi+60]   ; [esi+5*3*4]
  3176 00001F4B 01D0                                    add     eax, edx        ; = src[4*3]+src[5*3]
  3177 00001F4D 0305[443E0500]                          add     eax, [_@@tmp3]
  3178 00001F53 A3[4C3E0500]                            mov     [_@@tmp5], eax  ; tmp5 = src[4*3]+src[5*3]+tmp3
  3179 00001F58 8B15[3C3E0500]                          mov     edx, [_@@tmp1]
  3180 00001F5E 0115[443E0500]                          add     [_@@tmp3], edx
  3181 00001F64 A1[403E0500]                            mov     eax, [_@@tmp2]  ; @@MULH @@tmp2,@@tmp2,-,-,-,-,1,C3,-
  3182                                                                          ; tmp2 = MULH(2*tmp2,C3)
  3183 00001F69 D1E0                                    shl     eax, 1
  3184 00001F6B BAA2EBD96E                              mov     edx, 6ED9EBA2h  ; C3
  3185 00001F70 F7EA                                    imul    edx
  3186 00001F72 8915[403E0500]                          mov     [_@@tmp2], edx
  3187 00001F78 A1[443E0500]                            mov     eax, [_@@tmp3]  ; @@MULH @@tmp3,@@tmp3,-,-,-,-,2,C3,-
  3188                                                                          ; tmp3 = MULH(4*tmp3,C3)
  3189 00001F7D C1E002                                  shl     eax, 2
  3190 00001F80 BAA2EBD96E                              mov     edx, 6ED9EBA2h  ; C3
  3191 00001F85 F7EA                                    imul    edx
  3192 00001F87 8915[443E0500]                          mov     [_@@tmp3], edx
  3193 00001F8D A1[3C3E0500]                            mov     eax, [_@@tmp1]  ; @@MULH edx,@@tmp1,sub,@@tmp5,-,-,1,icos36h_4,-
  3194 00001F92 2B05[4C3E0500]                          sub     eax, [_@@tmp5]  ; t2 = MULH(2*(tmp1-tmp5),icos36h_4)
  3195 00001F98 D1E0                                    shl     eax, 1
  3196 00001F9A BA9A79825A                              mov     edx, 5A82799Ah  ; icos36h_4
  3197 00001F9F F7EA                                    imul    edx
  3198 00001FA1 A1[383E0500]                            mov     eax, [_@@tmp0]  ; @@SUM eax,@@tmp0,sub,@@tmp4,-,-
  3199 00001FA6 2B05[483E0500]                          sub     eax, [_@@tmp4]  ; t1 = tmp0 - tmp4
  3200 00001FAC 29D0                                    sub     eax, edx        ; @@CAST macro t1,t2,dst0,dst1,dst2,dst3
  3201                                                                          ;   sub  t1,t2                           ;t1-t2
  3202                                                                          ;   lea  t2,[t1+t2*2]                    ;t1+t2
  3203                                                                          ;   mov  dword ptr [mp3_out2_a&dst0],t1  ;t1-t2
  3204                                                                          ;   mov  dword ptr [mp3_out2_b&dst0],t2  ;t1+t2
  3205                                                                          ; endm
  3206 00001FAE 8D1450                                  lea     edx, [eax+edx*2] ; @@CAST eax,edx,1,4,7,10
  3207                                                                          ; out2[1,4,7,10]=t1-t2,t1-t2,t1+t2,t1+t2
  3208 00001FB1 A3[543E0500]                            mov     [mp3_out2_a1], eax
  3209 00001FB6 8915[603E0500]                          mov     [mp3_out2_b1], edx
  3210 00001FBC A1[483E0500]                            mov     eax, [_@@tmp4]
  3211 00001FC1 8B15[3C3E0500]                          mov     edx, [_@@tmp1]
  3212 00001FC7 D1F8                                    sar     eax, 1
  3213 00001FC9 D1E2                                    shl     edx, 1
  3214 00001FCB 0105[383E0500]                          add     [_@@tmp0], eax  ; tmp0 = tmp0 + tmp4/2
  3215 00001FD1 0115[4C3E0500]                          add     [_@@tmp5], edx  ; tmp5 = tmp5 + tmp1*2
  3216 00001FD7 A1[4C3E0500]                            mov     eax, [_@@tmp5]  ; @@MULH edx,@@tmp5,add,@@tmp3,-,-,0,icos36h_1,-
  3217 00001FDC 0305[443E0500]                          add     eax, [_@@tmp3]
  3218 00001FE2 BA07F74142                              mov     edx, 4241F707h  ; icos36h_1
  3219 00001FE7 F7EA                                    imul    edx
  3220 00001FE9 A1[383E0500]                            mov     eax, [_@@tmp0]  ; @@SUM eax,@@tmp0,add,@@tmp2,-,-
  3221 00001FEE 0305[403E0500]                          add     eax, [_@@tmp2]
  3222 00001FF4 29D0                                    sub     eax, edx        ; @@CAST eax,edx,2,3,8,9
  3223 00001FF6 8D1450                                  lea     edx, [eax+edx*2]
  3224 00001FF9 A3[583E0500]                            mov     [mp3_out2_a2], eax
  3225 00001FFE 8915[643E0500]                          mov     [mp3_out2_b2], edx
  3226 00002004 A1[4C3E0500]                            mov     eax, [_@@tmp5]  ; @@MULH edx,@@tmp5,sub,@@tmp3,-,-,1,icos36h_7,-
  3227 00002009 2B05[443E0500]                          sub     eax, [_@@tmp3]
  3228 0000200F D1E0                                    shl     eax, 1
  3229 00002011 BA1E75A37B                              mov     edx, 7BA3751Eh  ; icos36h_7
  3230 00002016 F7EA                                    imul    edx
  3231 00002018 A1[383E0500]                            mov     eax, [_@@tmp0]  ; @@SUM eax,@@tmp0,sub,@@tmp2,-,-
  3232 0000201D 2B05[403E0500]                          sub     eax, [_@@tmp2]
  3233 00002023 29D0                                    sub     eax, edx        ; @@CAST eax,edx,0,5,6,11
  3234 00002025 8D1450                                  lea     edx, [eax+edx*2]
  3235 00002028 A3[503E0500]                            mov     [mp3_out2_a0], eax
  3236 0000202D 8915[5C3E0500]                          mov     [mp3_out2_b0], edx
  3237 00002033 C3                                      retn
  3238                                  
  3239                                  
  3240                                  ; =============== S U B R O U T I N E =======================================
  3241                                  
  3242                                  
  3243                                  mp3_compute_imdct:
  3244 00002034 F605[FC8A0000]10                        test    byte [cpuid_flags], 10h ; in: ebx=granule
  3245 0000203B 740E                                    jz      short .no_rdtsc_supported ; timelog_start rdtsc_imdct
  3246 0000203D 0F31                                    rdtsc
  3247 0000203F 2905[148C0000]                          sub     [rdtsc_imdct], eax
  3248 00002045 1915[188C0000]                          sbb     [rdtsc_imdct+4], edx
  3249                                  
  3250                                  .no_rdtsc_supported:
  3251 0000204B 53                                      push    ebx
  3252 0000204C 8B4B60                                  mov     ecx, [ebx+96]   ; [ebx+$mp3gr_num_nonzero_hybrids_div9]
  3253 0000204F 6BC109                                  imul    eax, ecx, 9
  3254 00002052 8DBC83A0000000                          lea     edi, [ebx+eax*4+160] ; [ebx+$mp3gr_sb_hybrid+eax*4]
  3255 00002059 E322                                    jecxz   .breakout
  3256                                  
  3257                                  .scan_zero_lop:
  3258 0000205B 83EF24                                  sub     edi, 36         ; index-9
  3259 0000205E 8B07                                    mov     eax, [edi]      ; [edi+0*4]
  3260 00002060 0B4704                                  or      eax, [edi+4]
  3261 00002063 0B4708                                  or      eax, [edi+8]
  3262 00002066 0B470C                                  or      eax, [edi+12]
  3263 00002069 0B4710                                  or      eax, [edi+16]
  3264 0000206C 0B4714                                  or      eax, [edi+20]
  3265 0000206F 0B4718                                  or      eax, [edi+24]
  3266 00002072 0B471C                                  or      eax, [edi+28]
  3267 00002075 0B4720                                  or      eax, [edi+32]   ; [edi+8*4]
  3268 00002078 7503                                    jnz     short .breakout
  3269 0000207A 49                                      dec     ecx
  3270 0000207B 75DE                                    jnz     short .scan_zero_lop
  3271                                  
  3272                                  .breakout:
  3273 0000207D 41                                      inc     ecx             ; div9+1
  3274 0000207E D1E9                                    shr     ecx, 1          ; div18
  3275 00002080 890D[7C3E0500]                          mov     [_@@sblimit], ecx
  3276 00002086 837B2C02                                cmp     dword [ebx+44], 2 ; [ebx+$mp3gr_block_type]
  3277 0000208A 7505                                    jnz     short .this_long_end
  3278 0000208C 8B4B30                                  mov     ecx, [ebx+48]   ; [ebx+$mp3gr_switch_point]
  3279 0000208F D1E1                                    shl     ecx, 1          ; 0,1 --> 0,2
  3280                                  
  3281                                  .this_long_end:
  3282 00002091 890D[783E0500]                          mov     [_@@mdct_long_end], ecx
  3283 00002097 8B4330                                  mov     eax, [ebx+48]   ; [ebx+$mp3gr_switch_point]
  3284 0000209A A3[803E0500]                            mov     [_@@switch_point], eax
  3285 0000209F 8B432C                                  mov     eax, [ebx+44]   ; [ebx+$mp3gr_block_type]
  3286 000020A2 69C090000000                            imul    eax, 144        ; 1*36*4
  3287 000020A8 A3[743E0500]                            mov     [_@@www], eax
  3288 000020AD 8B0D[48090100]                          mov     ecx, [mp3_curr_channel]
  3289 000020B3 A1[4C090100]                            mov     eax, [mp3_curr_granule]
  3290 000020B8 69C900120000                            imul    ecx, 4608       ; 36*SBLIMIT*4 ; channel ; sb_samples[ch][gr*18]
  3291 000020BE 69C000090000                            imul    eax, 2304       ; 18*SBLIMIT*4 ; frame=granule*18
  3292 000020C4 8DBC01[A8D20000]                        lea     edi, [mp3_sb_samples+ecx+eax]
  3293 000020CB 8DB3A0000000                            lea     esi, [ebx+160]  ; [ebx+$mp3gr_sb_hybrid]
  3294 000020D1 A1[48090100]                            mov     eax, [mp3_curr_channel]
  3295 000020D6 69C000090000                            imul    eax, 2304       ; SBLIMIT*18*4
  3296 000020DC 8D98[A8F60000]                          lea     ebx, [mp3_mdct_buf+eax]
  3297 000020E2 F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
  3298 000020E9 740E                                    jz      short .no_rdtsc_supported@ ; timelog_start rdtsc_imdct36
  3299 000020EB 0F31                                    rdtsc
  3300 000020ED 2905[2C8C0000]                          sub     [rdtsc_imdct36], eax
  3301 000020F3 1915[308C0000]                          sbb     [rdtsc_imdct36+4], edx
  3302                                  
  3303                                  .no_rdtsc_supported@:
  3304 000020F9 C705[703E0500]0000-                     mov	dword [_@@@JJJ], 0
  3304 00002101 0000               
  3305 00002103 833D[783E0500]00                        cmp	dword [_@@mdct_long_end], 0
  3306 0000210A 744D                                    jz      short .imdct36_done
  3307                                  
  3308                                  .imdct36_lop:
  3309 0000210C BD[D8F70400]                            mov	ebp, mp3_mdct_win ; for j=0 to mdct_long_end-1
  3310 00002111 833D[703E0500]02                        cmp	dword [_@@@JJJ], 2
  3311 00002118 19C0                                    sbb	eax, eax
  3312 0000211A 2305[803E0500]                          and	eax, [_@@switch_point]
  3313 00002120 7506                                    jnz	short .this_window ; force window 0
  3314 00002122 032D[743E0500]                          add	ebp, [_@@www] ; mdct_win
  3315                                  
  3316                                  .this_window:
  3317 00002128 A1[703E0500]                            mov	eax, [_@@@JJJ]
  3318 0000212D D1E8                                    shr	eax, 1          ; cy=0,1
  3319 0000212F 19C0                                    sbb	eax, eax        ; eax=0,FFFFFFFFh
  3320 00002131 2540020000                              and	eax, 576        ; 4*36*4
  3321 00002136 01C5                                    add	ebp, eax
  3322 00002138 E808F8FFFF                              call	mp3_imdct36
  3323 0000213D 83C704                                  add	edi, 4          ; 1*4 ; dst
  3324 00002140 83C648                                  add	esi, 72         ; 18*4 ; sb_hybrid
  3325 00002143 83C348                                  add	ebx, 72         ; mdct_buf ; next
  3326 00002146 FF05[703E0500]                          inc	dword [_@@@JJJ]
  3327 0000214C A1[703E0500]                            mov	eax, [_@@@JJJ]
  3328 00002151 3B05[783E0500]                          cmp	eax, [_@@mdct_long_end]
  3329 00002157 72B3                                    jb	short .imdct36_lop
  3330                                  
  3331                                  .imdct36_done:
  3332 00002159 F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
  3333 00002160 740E                                    jz      short .no_rdtsc_supported@@ ; timelog_end rdtsc_imdct36
  3334 00002162 0F31                                    rdtsc
  3335 00002164 0105[2C8C0000]                          add     [rdtsc_imdct36], eax
  3336 0000216A 1115[308C0000]                          adc     [rdtsc_imdct36+4], edx
  3337                                  
  3338                                  .no_rdtsc_supported@@:
  3339 00002170 F605[FC8A0000]10                        test    byte [cpuid_flags], 10h ; timelog_start rdtsc_imdct12
  3340 00002177 740E                                    jz      short .no_rdtsc_supported@@@
  3341 00002179 0F31                                    rdtsc
  3342 0000217B 2905[448C0000]                          sub     [rdtsc_imdct12], eax
  3343 00002181 1915[488C0000]                          sbb     [rdtsc_imdct12+4], edx
  3344                                  
  3345                                  .no_rdtsc_supported@@@:
  3346 00002187 A1[703E0500]                            mov     eax, [_@@@JJJ]
  3347 0000218C 3B05[7C3E0500]                          cmp     eax, [_@@sblimit]
  3348 00002192 0F83D7020000                            jnb     .imdct12_done
  3349                                  
  3350                                  .imdct12_lop:
  3351 00002198 BD[F8F80400]                            mov     ebp, (mp3_mdct_win+120h) ; for j=mdct_long_end to sblimit-1
  3352 0000219D A1[703E0500]                            mov     eax, [_@@@JJJ]
  3353 000021A2 D1E8                                    shr     eax, 1          ; cy=0,1
  3354 000021A4 19C0                                    sbb     eax, eax        ; eax=0,FFFFFFFFh
  3355 000021A6 2540020000                              and     eax, 576        ; 4*36*4
  3356 000021AB 01C5                                    add     ebp, eax        ; mdct_win
  3357 000021AD 8B03                                    mov     eax, [ebx]      ; IRP i,0,1,2,3,4,5
  3358 000021AF 8907                                    mov     [edi], eax      ; @@SUM [edi+i*SBLIMIT*4],[ebx+(i+0)*4],-,-,-,-
  3359 000021B1 8B4304                                  mov     eax, [ebx+4]
  3360 000021B4 898780000000                            mov     [edi+128], eax
  3361 000021BA 8B4308                                  mov     eax, [ebx+8]
  3362 000021BD 898700010000                            mov     [edi+256], eax
  3363 000021C3 8B430C                                  mov     eax, [ebx+12]
  3364 000021C6 898780010000                            mov     [edi+384], eax
  3365 000021CC 8B4310                                  mov     eax, [ebx+16]
  3366 000021CF 898700020000                            mov     [edi+512], eax
  3367 000021D5 8B4314                                  mov     eax, [ebx+20]
  3368 000021D8 898780020000                            mov     [edi+640], eax  ; ENDM
  3369 000021DE 81C700030000                            add     edi, 768        ; 6*SBLIMIT*4
  3370 000021E4 E82EFDFFFF                              call    mp3_imdct12
  3371 000021E9 A1[503E0500]                            mov     eax, [mp3_out2_a0] ; IRP i,0,1,2,3,4,5
  3372 000021EE 8B5500                                  mov     edx, [ebp+0]    ; @@MULH [edi+i*SBLIMIT*4],[mp3_out2_a&i],
  3373                                                                          ; -,-,-,-,0,[ebp+(i+0)*4],[ebx+(1*6+i)*4]
  3374 000021F1 F7EA                                    imul    edx
  3375 000021F3 035318                                  add     edx, [ebx+24]
  3376 000021F6 8917                                    mov     [edi], edx
  3377 000021F8 A1[5C3E0500]                            mov     eax, [mp3_out2_b0] ; @@MULH [ebx+(2*6+i)*4],[mp3_out2_b&i],
  3378                                                                          ; -,-,-,-,0,[ebp+(i+6)*4],-
  3379 000021FD 8B5518                                  mov     edx, [ebp+24]
  3380 00002200 F7EA                                    imul    edx
  3381 00002202 895330                                  mov     [ebx+48], edx
  3382 00002205 A1[543E0500]                            mov     eax, [mp3_out2_a1] ; i = 1
  3383 0000220A 8B5504                                  mov     edx, [ebp+4]
  3384 0000220D F7EA                                    imul    edx
  3385 0000220F 03531C                                  add     edx, [ebx+28]
  3386 00002212 899780000000                            mov     [edi+128], edx
  3387 00002218 A1[603E0500]                            mov     eax, [mp3_out2_b1]
  3388 0000221D 8B551C                                  mov     edx, [ebp+28]
  3389 00002220 F7EA                                    imul    edx
  3390 00002222 895334                                  mov     [ebx+52], edx
  3391 00002225 A1[583E0500]                            mov     eax, [mp3_out2_a2] ; i = 2
  3392 0000222A 8B5508                                  mov     edx, [ebp+8]
  3393 0000222D F7EA                                    imul    edx
  3394 0000222F 035320                                  add     edx, [ebx+32]
  3395 00002232 899700010000                            mov     [edi+256], edx
  3396 00002238 A1[643E0500]                            mov     eax, [mp3_out2_b2]
  3397 0000223D 8B5520                                  mov     edx, [ebp+32]
  3398 00002240 F7EA                                    imul    edx
  3399 00002242 895338                                  mov     [ebx+56], edx
  3400 00002245 A1[583E0500]                            mov     eax, [mp3_out2_a2] ; i = 3 ; mp3_out2_a3 equ mp3_out2_a2
  3401 0000224A 8B550C                                  mov     edx, [ebp+12]
  3402 0000224D F7EA                                    imul    edx
  3403 0000224F 035324                                  add     edx, [ebx+36]
  3404 00002252 899780010000                            mov     [edi+384], edx
  3405 00002258 A1[643E0500]                            mov     eax, [mp3_out2_b2] ; mp3_out2_b3 equ mp3_out2_b2
  3406 0000225D 8B5524                                  mov     edx, [ebp+36]
  3407 00002260 F7EA                                    imul    edx
  3408 00002262 89533C                                  mov     [ebx+60], edx
  3409 00002265 A1[543E0500]                            mov     eax, [mp3_out2_a1] ; i = 4 ; mp3_out2_a4 equ mp3_out2_a1
  3410 0000226A 8B5510                                  mov     edx, [ebp+16]
  3411 0000226D F7EA                                    imul    edx
  3412 0000226F 035328                                  add     edx, [ebx+40]
  3413 00002272 899700020000                            mov     [edi+512], edx
  3414 00002278 A1[603E0500]                            mov     eax, [mp3_out2_b1] ; mp3_out2_b4 equ mp3_out2_b1
  3415 0000227D 8B5528                                  mov     edx, [ebp+40]
  3416 00002280 F7EA                                    imul    edx
  3417 00002282 895340                                  mov     [ebx+64], edx
  3418 00002285 A1[503E0500]                            mov     eax, [mp3_out2_a0] ; i = 5 ; mp3_out2_a5 equ mp3_out2_a0
  3419 0000228A 8B5514                                  mov     edx, [ebp+20]
  3420 0000228D F7EA                                    imul    edx
  3421 0000228F 03532C                                  add     edx, [ebx+44]
  3422 00002292 899780020000                            mov     [edi+640], edx
  3423 00002298 A1[5C3E0500]                            mov     eax, [mp3_out2_b0] ; mp3_out2_b5 equ mp3_out2_b0
  3424 0000229D 8B552C                                  mov     edx, [ebp+44]
  3425 000022A0 F7EA                                    imul    edx
  3426 000022A2 895344                                  mov     [ebx+68], edx   ; ENDM
  3427 000022A5 81C700030000                            add     edi, 768        ; 6*SBLIMIT*4
  3428 000022AB 83C604                                  add     esi, 4          ; sb_hybrid
  3429 000022AE E864FCFFFF                              call    mp3_imdct12
  3430 000022B3 A1[503E0500]                            mov     eax, [mp3_out2_a0] ; IRP i,0,1,2,3,4,5
  3431 000022B8 8B5500                                  mov     edx, [ebp+0]    ; @@MULH [edi+i*SBLIMIT*4],[mp3_out2_a&i],
  3432                                                                          ; -,-,-,-,0,[ebp+(i+0)*4],[ebx+(2*6+i)*4]
  3433 000022BB F7EA                                    imul    edx             ; @@MULH [ebx+(0*6+i)*4],[mp3_out2_b&i],
  3434                                                                          ; -,-,-,-,0,[ebp+(i+6)*4],-
  3435 000022BD 035330                                  add     edx, [ebx+48]
  3436 000022C0 8917                                    mov     [edi], edx
  3437 000022C2 A1[5C3E0500]                            mov     eax, [mp3_out2_b0]
  3438 000022C7 8B5518                                  mov     edx, [ebp+18h]
  3439 000022CA F7EA                                    imul    edx
  3440 000022CC 8913                                    mov     [ebx], edx
  3441 000022CE A1[543E0500]                            mov     eax, [mp3_out2_a1] ; i = 1
  3442 000022D3 8B5504                                  mov     edx, [ebp+4]
  3443 000022D6 F7EA                                    imul    edx
  3444 000022D8 035334                                  add     edx, [ebx+52]
  3445 000022DB 899780000000                            mov     [edi+128], edx
  3446 000022E1 A1[603E0500]                            mov     eax, [mp3_out2_b1]
  3447 000022E6 8B551C                                  mov     edx, [ebp+28]
  3448 000022E9 F7EA                                    imul    edx
  3449 000022EB 895304                                  mov     [ebx+4], edx
  3450 000022EE A1[583E0500]                            mov     eax, [mp3_out2_a2] ; i = 2
  3451 000022F3 8B5508                                  mov     edx, [ebp+8]
  3452 000022F6 F7EA                                    imul    edx
  3453 000022F8 035338                                  add     edx, [ebx+56]
  3454 000022FB 899700010000                            mov     [edi+256], edx
  3455 00002301 A1[643E0500]                            mov     eax, [mp3_out2_b2]
  3456 00002306 8B5520                                  mov     edx, [ebp+32]
  3457 00002309 F7EA                                    imul    edx
  3458 0000230B 895308                                  mov     [ebx+8], edx
  3459 0000230E A1[583E0500]                            mov     eax, [mp3_out2_a2] ; i = 3
  3460 00002313 8B550C                                  mov     edx, [ebp+12]
  3461 00002316 F7EA                                    imul    edx
  3462 00002318 03533C                                  add     edx, [ebx+60]
  3463 0000231B 899780010000                            mov     [edi+384], edx
  3464 00002321 A1[643E0500]                            mov     eax, [mp3_out2_b2]
  3465 00002326 8B5524                                  mov     edx, [ebp+36]
  3466 00002329 F7EA                                    imul    edx
  3467 0000232B 89530C                                  mov     [ebx+12], edx
  3468 0000232E A1[543E0500]                            mov     eax, [mp3_out2_a1] ; i = 4
  3469 00002333 8B5510                                  mov     edx, [ebp+16]
  3470 00002336 F7EA                                    imul    edx
  3471 00002338 035340                                  add     edx, [ebx+64]
  3472 0000233B 899700020000                            mov     [edi+512], edx
  3473 00002341 A1[603E0500]                            mov     eax, [mp3_out2_b1]
  3474 00002346 8B5528                                  mov     edx, [ebp+40]
  3475 00002349 F7EA                                    imul    edx
  3476 0000234B 895310                                  mov     [ebx+16], edx
  3477 0000234E A1[503E0500]                            mov     eax, [mp3_out2_a0] ; i = 5
  3478 00002353 8B5514                                  mov     edx, [ebp+20]
  3479 00002356 F7EA                                    imul    edx
  3480 00002358 035344                                  add     edx, [ebx+68]
  3481 0000235B 899780020000                            mov     [edi+640], edx
  3482 00002361 A1[5C3E0500]                            mov     eax, [mp3_out2_b0]
  3483 00002366 8B552C                                  mov     edx, [ebp+44]
  3484 00002369 F7EA                                    imul    edx
  3485 0000236B 895314                                  mov     [ebx+20], edx   ; ENDM
  3486 0000236E 83C604                                  add     esi, 4
  3487 00002371 E8A1FBFFFF                              call    mp3_imdct12
  3488 00002376 A1[503E0500]                            mov     eax, [mp3_out2_a0] ; IRP i,0,1,2,3,4,5
  3489 0000237B 8B5500                                  mov     edx, [ebp+0]    ; @@MULH [ebx+(0*6+i)*4],[mp3_out2_a&i],
  3490                                                                          ; -,-,-,-,0,[ebp+(i+0)*4],[ebx+(0*6+i)*4]
  3491 0000237E F7EA                                    imul    edx
  3492 00002380 0313                                    add     edx, [ebx]
  3493 00002382 8913                                    mov     [ebx], edx
  3494 00002384 A1[5C3E0500]                            mov     eax, [mp3_out2_b0] ; @@MULH [ebx+(1*6+i)*4],[mp3_out2_b&i],
  3495                                                                          ; -,-,-,-,0,[ebp+(i+6)*4],-
  3496 00002389 8B5518                                  mov     edx, [ebp+24]
  3497 0000238C F7EA                                    imul    edx
  3498 0000238E 895318                                  mov     [ebx+24], edx
  3499 00002391 C7433000000000                          mov     dword [ebx+48], 0 ; [ebx+(2*6+i)*4]
  3500 00002398 A1[543E0500]                            mov     eax, [mp3_out2_a1] ; i = 1
  3501 0000239D 8B5504                                  mov     edx, [ebp+4]
  3502 000023A0 F7EA                                    imul    edx
  3503 000023A2 035304                                  add     edx, [ebx+4]
  3504 000023A5 895304                                  mov     [ebx+4], edx
  3505 000023A8 A1[603E0500]                            mov     eax, [mp3_out2_b1]
  3506 000023AD 8B551C                                  mov     edx, [ebp+28]
  3507 000023B0 F7EA                                    imul    edx
  3508 000023B2 89531C                                  mov     [ebx+28], edx
  3509 000023B5 C7433400000000                          mov     dword [ebx+52], 0 ; [ebx+(2*6+i)*4]
  3510 000023BC A1[583E0500]                            mov     eax, [mp3_out2_a2] ; i = 2
  3511 000023C1 8B5508                                  mov     edx, [ebp+8]
  3512 000023C4 F7EA                                    imul    edx
  3513 000023C6 035308                                  add     edx, [ebx+8]
  3514 000023C9 895308                                  mov     [ebx+8], edx
  3515 000023CC A1[643E0500]                            mov     eax, [mp3_out2_b2]
  3516 000023D1 8B5520                                  mov     edx, [ebp+32]
  3517 000023D4 F7EA                                    imul    edx
  3518 000023D6 895320                                  mov     [ebx+32], edx
  3519 000023D9 C7433800000000                          mov     dword [ebx+56], 0
  3520 000023E0 A1[583E0500]                            mov     eax, [mp3_out2_a2] ; i = 3
  3521 000023E5 8B550C                                  mov     edx, [ebp+12]
  3522 000023E8 F7EA                                    imul    edx
  3523 000023EA 03530C                                  add     edx, [ebx+0Ch]
  3524 000023ED 89530C                                  mov     [ebx+12], edx
  3525 000023F0 A1[643E0500]                            mov     eax, [mp3_out2_b2]
  3526 000023F5 8B5524                                  mov     edx, [ebp+36]
  3527 000023F8 F7EA                                    imul    edx
  3528 000023FA 895324                                  mov     [ebx+36], edx
  3529 000023FD C7433C00000000                          mov     dword [ebx+60], 0 ; [ebx+(2*6+i)*4]
  3530 00002404 A1[543E0500]                            mov     eax, [mp3_out2_a1] ; i = 4
  3531 00002409 8B5510                                  mov     edx, [ebp+16]
  3532 0000240C F7EA                                    imul    edx
  3533 0000240E 035310                                  add     edx, [ebx+16]
  3534 00002411 895310                                  mov     [ebx+16], edx
  3535 00002414 A1[603E0500]                            mov     eax, [mp3_out2_b1]
  3536 00002419 8B5528                                  mov     edx, [ebp+40]
  3537 0000241C F7EA                                    imul    edx
  3538 0000241E 895328                                  mov     [ebx+40], edx
  3539 00002421 C7434000000000                          mov     dword [ebx+64], 0
  3540 00002428 A1[503E0500]                            mov     eax, [mp3_out2_a0] ; i = 5
  3541 0000242D 8B5514                                  mov     edx, [ebp+20]
  3542 00002430 F7EA                                    imul    edx
  3543 00002432 035314                                  add     edx, [ebx+20]
  3544 00002435 895314                                  mov     [ebx+20], edx
  3545 00002438 A1[5C3E0500]                            mov     eax, [mp3_out2_b0]
  3546 0000243D 8B552C                                  mov     edx, [ebp+44]
  3547 00002440 F7EA                                    imul    edx
  3548 00002442 89532C                                  mov     [ebx+44], edx
  3549 00002445 C7434400000000                          mov     dword [ebx+68], 0 ; [ebx+(2*6+i)*4]
  3550 0000244C 81C704FAFFFF                            add     edi, -1532      ; (1*4) - (2*6*SBLIMIT*4) ; dst
  3551 00002452 83C640                                  add     esi, 64         ; 18*4 - (2*4) ; sb_hybrid
  3552 00002455 83C348                                  add     ebx, 72         ; 18*4 ; mdct_buf
  3553 00002458 FF05[703E0500]                          inc     dword [_@@@JJJ]	; next
  3554 0000245E A1[703E0500]                            mov     eax, [_@@@JJJ]
  3555 00002463 3B05[7C3E0500]                          cmp     eax, [_@@sblimit]
  3556 00002469 0F8229FDFFFF                            jb      .imdct12_lop
  3557                                  
  3558                                  .imdct12_done:
  3559 0000246F F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
  3560 00002476 740E                                    jz      short .no_rdtsc_supported@@@@ ; timelog_end rdtsc_imdct12
  3561 00002478 0F31                                    rdtsc
  3562 0000247A 0105[448C0000]                          add     [rdtsc_imdct12], eax
  3563 00002480 1115[488C0000]                          adc     [rdtsc_imdct12+4], edx
  3564                                  
  3565                                  .no_rdtsc_supported@@@@:
  3566 00002486 F605[FC8A0000]10                        test    byte [cpuid_flags], 10h ; timelog_start rdtsc_imdct0
  3567 0000248D 740E                                    jz      short .no_rdtsc_supported@@@@@
  3568 0000248F 0F31                                    rdtsc
  3569 00002491 2905[5C8C0000]                          sub     [rdtsc_imdct0], eax
  3570 00002497 1915[608C0000]                          sbb     [rdtsc_imdct0+4], edx
  3571                                  
  3572                                  .no_rdtsc_supported@@@@@:
  3573 0000249D 833D[703E0500]20                        cmp     dword [_@@@JJJ], 32 ; SBLIMIT
  3574 000024A4 0F8333010000                            jnb     .zero_outer_done
  3575                                  
  3576                                  .zero_outer_lop:
  3577 000024AA 8B03                                    mov     eax, [ebx]      ; zero bands
  3578                                                                          ; IRP nn,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17
  3579                                                                          ;  mov  eax,dword ptr [ebx+nn*4]
  3580                                                                          ;  mov  dword ptr [ebx+nn*4],0
  3581                                                                          ;  mov  dword ptr [edi+nn*SBLIMIT*4],eax ; [dst]
  3582                                                                          ; ENDM
  3583 000024AC C70300000000                            mov     dword [ebx], 0 ; nn = 0
  3584 000024B2 8907                                    mov     [edi], eax
  3585 000024B4 8B4304                                  mov     eax, [ebx+4]    ; nn = 1
  3586 000024B7 C7430400000000                          mov     dword [ebx+4], 0
  3587 000024BE 898780000000                            mov     [edi+128], eax
  3588 000024C4 8B4308                                  mov     eax, [ebx+8]
  3589 000024C7 C7430800000000                          mov     dword [ebx+8], 0
  3590 000024CE 898700010000                            mov     [edi+256], eax
  3591 000024D4 8B430C                                  mov     eax, [ebx+12]
  3592 000024D7 C7430C00000000                          mov     dword [ebx+12], 0
  3593 000024DE 898780010000                            mov     [edi+384], eax
  3594 000024E4 8B4310                                  mov     eax, [ebx+16]   ; nn = 4
  3595 000024E7 C7431000000000                          mov     dword [ebx+16], 0
  3596 000024EE 898700020000                            mov     [edi+512], eax
  3597 000024F4 8B4314                                  mov     eax, [ebx+20]
  3598 000024F7 C7431400000000                          mov     dword [ebx+20], 0
  3599 000024FE 898780020000                            mov     [edi+640], eax  ; [edi+5*SBLIMIT*4]
  3600 00002504 8B4318                                  mov     eax, [ebx+24]
  3601 00002507 C7431800000000                          mov     dword [ebx+24], 0
  3602 0000250E 898700030000                            mov     [edi+768], eax
  3603 00002514 8B431C                                  mov     eax, [ebx+28]   ; nn = 7
  3604 00002517 C7431C00000000                          mov     dword [ebx+28], 0
  3605 0000251E 898780030000                            mov     [edi+896], eax
  3606 00002524 8B4320                                  mov     eax, [ebx+32]
  3607 00002527 C7432000000000                          mov     dword [ebx+32], 0
  3608 0000252E 898700040000                            mov     [edi+1024], eax ; [edi+8*SBLIMIT*4]
  3609 00002534 8B4324                                  mov     eax, [ebx+36]
  3610 00002537 C7432400000000                          mov     dword [ebx+36], 0
  3611 0000253E 898780040000                            mov     [edi+1152], eax
  3612 00002544 8B4328                                  mov     eax, [ebx+40]
  3613 00002547 C7432800000000                          mov     dword [ebx+40], 0
  3614 0000254E 898700050000                            mov     [edi+1280], eax
  3615 00002554 8B432C                                  mov     eax, [ebx+44]
  3616 00002557 C7432C00000000                          mov     dword [ebx+44], 0
  3617 0000255E 898780050000                            mov     [edi+1408], eax
  3618 00002564 8B4330                                  mov     eax, [ebx+48]
  3619 00002567 C7433000000000                          mov     dword [ebx+48], 0
  3620 0000256E 898700060000                            mov     [edi+1536], eax
  3621 00002574 8B4334                                  mov     eax, [ebx+52]
  3622 00002577 C7433400000000                          mov     dword [ebx+52], 0
  3623 0000257E 898780060000                            mov     [edi+1664], eax
  3624 00002584 8B4338                                  mov     eax, [ebx+56]
  3625 00002587 C7433800000000                          mov     dword [ebx+56], 0
  3626 0000258E 898700070000                            mov     [edi+1792], eax
  3627 00002594 8B433C                                  mov     eax, [ebx+60]
  3628 00002597 C7433C00000000                          mov     dword [ebx+60], 0
  3629 0000259E 898780070000                            mov     [edi+1920], eax
  3630 000025A4 8B4340                                  mov     eax, [ebx+64]
  3631 000025A7 C7434000000000                          mov     dword [ebx+64], 0 ; [edi+16*SBLIMIT*4]
  3632 000025AE 898700080000                            mov     [edi+2048], eax
  3633 000025B4 8B4344                                  mov     eax, [ebx+68]   ; nn = 17
  3634 000025B7 C7434400000000                          mov     dword [ebx+68], 0
  3635 000025BE 898780080000                            mov     [edi+2176], eax ; ENDM
  3636 000025C4 83C348                                  add     ebx, 72         ; 18*4
  3637 000025C7 83C704                                  add     edi, 4
  3638 000025CA FF05[703E0500]                          inc     dword [_@@@JJJ]
  3639 000025D0 833D[703E0500]20                        cmp     dword [_@@@JJJ], 32
  3640 000025D7 0F82CDFEFFFF                            jb      .zero_outer_lop
  3641                                  
  3642                                  .zero_outer_done:
  3643 000025DD F605[FC8A0000]10                        test    byte [cpuid_flags], 10h ; timelog_end rdtsc_imdct0
  3644 000025E4 740E                                    jz      short .no_rdtsc_supported@@@@@@
  3645 000025E6 0F31                                    rdtsc
  3646 000025E8 0105[5C8C0000]                          add     [rdtsc_imdct0], eax
  3647 000025EE 1115[608C0000]                          adc     [rdtsc_imdct0+4], edx
  3648                                  
  3649                                  .no_rdtsc_supported@@@@@@:
  3650 000025F4 5B                                      pop     ebx
  3651 000025F5 F605[FC8A0000]10                        test    byte [cpuid_flags], 10h ; timelog_end rdtsc_imdct
  3652 000025FC 740E                                    jz      short .no_rdtsc_supported@@@@@@@
  3653 000025FE 0F31                                    rdtsc
  3654 00002600 0105[148C0000]                          add     [rdtsc_imdct], eax
  3655 00002606 1115[188C0000]                          adc     [rdtsc_imdct+4], edx
  3656                                  
  3657                                  .no_rdtsc_supported@@@@@@@:
  3658 0000260C C3                                      retn
  3659                                  
  3660                                  
  3661                                  ; =============== S U B R O U T I N E =======================================
  3662                                  
  3663                                  
  3664                                  mp3_dct32_shift_0:
  3665 0000260D 8B06                                    mov     eax, [esi]      ; mp3_dct32_macro macro rate_shift ; rate_shift = 0
  3666 0000260F 8B567C                                  mov     edx, [esi+124]  ; @@BF macro a,b,sign,cos,shift
  3667                                                                          ; @@BF 0,31,+,COS0_0,1
  3668                                                                          ; @@need_a equ (rate_shift EQ 0) or (a LT 16) ; a = 0
  3669                                                                          ; @@need_b equ (rate_shift EQ 0) or (b LT 16) ; b = 31
  3670                                                                          ; IF @@need_a AND @@need_b ; rate_shift = 0
  3671                                                                          ;    mov eax,dword ptr [esi+a*4]
  3672                                                                          ;    mov edx,dword ptr [esi+b*4]
  3673                                                                          ;    add dword ptr [esi+a*4],edx
  3674 00002612 0116                                    add     [esi], edx
  3675 00002614 29D0                                    sub     eax, edx
  3676 00002616 D1E0                                    shl     eax, 1          ; shl  eax,shift
  3677                                                                          ; (needed when COS.fraction is less than 32bit)
  3678 00002618 BA51C21340                              mov     edx, 4013C251h  ; sign&&cos ; +COS0_0 = 4013C251h
  3679 0000261D F7EA                                    imul    edx
  3680 0000261F 89567C                                  mov     [esi+124], edx  ; [esi+b*4] ; upper 32bit of multiply result
  3681 00002622 8B463C                                  mov     eax, [esi+60]   ; @@BF 15,16,+,COS0_15,5
  3682                                                                          ; [esi+a*4]
  3683 00002625 8B5640                                  mov     edx, [esi+64]   ; [esi+b*4]
  3684 00002628 01563C                                  add     [esi+60], edx   ; [esi+a*4]
  3685 0000262B 29D0                                    sub     eax, edx
  3686 0000262D C1E005                                  shl     eax, 5          ; shl eax,shift
  3687 00002630 BAFB228551                              mov     edx, 518522FBh  ; sign&&cos ; +COS0_15 = 518522FBh
  3688 00002635 F7EA                                    imul    edx
  3689 00002637 895640                                  mov     [esi+64], edx   ; [esi+b*4]
  3690 0000263A 8B06                                    mov     eax, [esi]      ; @@BF 0,15,+,COS1_0,1
  3691 0000263C 8B563C                                  mov     edx, [esi+60]
  3692 0000263F 0116                                    add     [esi], edx
  3693 00002641 29D0                                    sub     eax, edx
  3694 00002643 D1E0                                    shl     eax, 1
  3695 00002645 BA72464F40                              mov     edx, 404F4672h  ; +COS1_0
  3696 0000264A F7EA                                    imul    edx
  3697 0000264C 89563C                                  mov     [esi+60], edx
  3698 0000264F 8B4640                                  mov     eax, [esi+64]   ; @@BF 16,31,-,COS1_0,1
  3699 00002652 8B567C                                  mov     edx, [esi+124]
  3700 00002655 015640                                  add     [esi+64], edx
  3701 00002658 29D0                                    sub     eax, edx
  3702 0000265A D1E0                                    shl     eax, 1
  3703 0000265C BA8EB9B0BF                              mov     edx, 0BFB0B98Eh ; -COS1_0
  3704 00002661 F7EA                                    imul    edx
  3705 00002663 89567C                                  mov     [esi+124], edx
  3706 00002666 8B461C                                  mov     eax, [esi+28]   ; @@BF 7,24,+,COS0_7,1
  3707 00002669 8B5660                                  mov     edx, [esi+96]
  3708 0000266C 01561C                                  add     [esi+28], edx
  3709 0000266F 29D0                                    sub     eax, edx
  3710 00002671 D1E0                                    shl     eax, 1
  3711 00002673 BAA71E6056                              mov     edx, 56601EA7h
  3712 00002678 F7EA                                    imul    edx
  3713 0000267A 895660                                  mov     [esi+96], edx
  3714 0000267D 8B4620                                  mov     eax, [esi+32]   ; @@BF 8,23,+,COS0_8,1
  3715 00002680 8B565C                                  mov     edx, [esi+92]
  3716 00002683 015620                                  add     [esi+32], edx
  3717 00002686 29D0                                    sub     eax, edx
  3718 00002688 D1E0                                    shl     eax, 1
  3719 0000268A BAECF64C5F                              mov     edx, 5F4CF6ECh
  3720 0000268F F7EA                                    imul    edx
  3721 00002691 89565C                                  mov     [esi+92], edx
  3722 00002694 8B461C                                  mov     eax, [esi+28]   ; @@BF 7,8,+,COS1_7,4
  3723 00002697 8B5620                                  mov     edx, [esi+32]
  3724 0000269A 01561C                                  add     [esi+28], edx
  3725 0000269D 29D0                                    sub     eax, edx
  3726 0000269F C1E004                                  shl     eax, 4
  3727 000026A2 BA044E9E51                              mov     edx, 519E4E04h
  3728 000026A7 F7EA                                    imul    edx
  3729 000026A9 895620                                  mov     [esi+32], edx
  3730 000026AC 8B465C                                  mov     eax, [esi+92]   ; @@BF 23,24,-,COS1_7,4
  3731 000026AF 8B5660                                  mov     edx, [esi+96]
  3732 000026B2 01565C                                  add     [esi+92], edx
  3733 000026B5 29D0                                    sub     eax, edx
  3734 000026B7 C1E004                                  shl     eax, 4
  3735 000026BA BAFCB161AE                              mov     edx, 0AE61B1FCh
  3736 000026BF F7EA                                    imul    edx
  3737 000026C1 895660                                  mov     [esi+96], edx
  3738 000026C4 8B06                                    mov     eax, [esi]      ; @@BF 0,7,+,COS2_0,1
  3739 000026C6 8B561C                                  mov     edx, [esi+28]
  3740 000026C9 0116                                    add     [esi], edx
  3741 000026CB 29D0                                    sub     eax, edx
  3742 000026CD D1E0                                    shl     eax, 1
  3743 000026CF BA46FB4041                              mov     edx, 4140FB46h
  3744 000026D4 F7EA                                    imul    edx
  3745 000026D6 89561C                                  mov     [esi+28], edx
  3746 000026D9 8B4620                                  mov     eax, [esi+32]   ; @@BF 8,15,-,COS2_0,1
  3747 000026DC 8B563C                                  mov     edx, [esi+60]
  3748 000026DF 015620                                  add     [esi+32], edx
  3749 000026E2 29D0                                    sub     eax, edx
  3750 000026E4 D1E0                                    shl     eax, 1
  3751 000026E6 BABA04BFBE                              mov     edx, 0BEBF04BAh
  3752 000026EB F7EA                                    imul    edx
  3753 000026ED 89563C                                  mov     [esi+60], edx
  3754 000026F0 8B4640                                  mov     eax, [esi+64]   ; @@BF 16,23,+,COS2_0,1
  3755 000026F3 8B565C                                  mov     edx, [esi+92]
  3756 000026F6 015640                                  add     [esi+40h], edx
  3757 000026F9 29D0                                    sub     eax, edx
  3758 000026FB D1E0                                    shl     eax, 1
  3759 000026FD BA46FB4041                              mov     edx, 4140FB46h
  3760 00002702 F7EA                                    imul    edx
  3761 00002704 89565C                                  mov     [esi+92], edx
  3762 00002707 8B4660                                  mov     eax, [esi+96]   ; @@BF 24,31,-,COS2_0,1
  3763 0000270A 8B567C                                  mov     edx, [esi+124]
  3764 0000270D 015660                                  add     [esi+96], edx
  3765 00002710 29D0                                    sub     eax, edx
  3766 00002712 D1E0                                    shl     eax, 1
  3767 00002714 BABA04BFBE                              mov     edx, 0BEBF04BAh
  3768 00002719 F7EA                                    imul    edx
  3769 0000271B 89567C                                  mov     [esi+124], edx
  3770 0000271E 8B460C                                  mov     eax, [esi+12]   ; @@BF 3,28,+,COS0_3,1
  3771 00002721 8B5670                                  mov     edx, [esi+112]
  3772 00002724 01560C                                  add     [esi+12], edx
  3773 00002727 29D0                                    sub     eax, edx
  3774 00002729 D1E0                                    shl     eax, 1
  3775 0000272B BA2134F943                              mov     edx, 43F93421h
  3776 00002730 F7EA                                    imul    edx
  3777 00002732 895670                                  mov     [esi+112], edx
  3778 00002735 8B4630                                  mov     eax, [esi+48]   ; @@BF 12,19,+,COS0_12,2
  3779 00002738 8B564C                                  mov     edx, [esi+76]
  3780 0000273B 015630                                  add     [esi+48], edx
  3781 0000273E 29D0                                    sub     eax, edx
  3782 00002740 C1E002                                  shl     eax, 2
  3783 00002743 BA978DFC5E                              mov     edx, 5EFC8D97h
  3784 00002748 F7EA                                    imul    edx
  3785 0000274A 89564C                                  mov     [esi+76], edx
  3786 0000274D 8B460C                                  mov     eax, [esi+12]   ; @@BF 3,12,+,COS1_3,1
  3787 00002750 8B5630                                  mov     edx, [esi+48]
  3788 00002753 01560C                                  add     [esi+12], edx
  3789 00002756 29D0                                    sub     eax, edx
  3790 00002758 D1E0                                    shl     eax, 1
  3791 0000275A BA630ECB52                              mov     edx, 52CB0E63h
  3792 0000275F F7EA                                    imul    edx
  3793 00002761 895630                                  mov     [esi+48], edx
  3794 00002764 8B464C                                  mov     eax, [esi+76]   ; @@BF 19,28,-,COS1_3,1
  3795 00002767 8B5670                                  mov     edx, [esi+112]
  3796 0000276A 01564C                                  add     [esi+76], edx
  3797 0000276D 29D0                                    sub     eax, edx
  3798 0000276F D1E0                                    shl     eax, 1
  3799 00002771 BA9DF134AD                              mov     edx, 0AD34F19Dh
  3800 00002776 F7EA                                    imul    edx
  3801 00002778 895670                                  mov     [esi+112], edx
  3802 0000277B 8B4610                                  mov     eax, [esi+16]   ; @@BF 4,27,+,COS0_4,1
  3803 0000277E 8B566C                                  mov     edx, [esi+108]
  3804 00002781 015610                                  add     [esi+16], edx
  3805 00002784 29D0                                    sub     eax, edx
  3806 00002786 D1E0                                    shl     eax, 1
  3807 00002788 BAC51BCC46                              mov     edx, 46CC1BC5h
  3808 0000278D F7EA                                    imul    edx
  3809 0000278F 89566C                                  mov     [esi+108], edx
  3810 00002792 8B462C                                  mov     eax, [esi+44]   ; @@BF 11,20,+,COS0_11,2
  3811 00002795 8B5650                                  mov     edx, [esi+80]
  3812 00002798 01562C                                  add     [esi+44], edx
  3813 0000279B 29D0                                    sub     eax, edx
  3814 0000279D C1E002                                  shl     eax, 2
  3815 000027A0 BA981AD84A                              mov     edx, 4AD81A98h
  3816 000027A5 F7EA                                    imul    edx
  3817 000027A7 895650                                  mov     [esi+80], edx
  3818 000027AA 8B4610                                  mov     eax, [esi+16]   ; @@BF 4,11,+,COS1_4,1
  3819 000027AD 8B562C                                  mov     edx, [esi+44]
  3820 000027B0 015610                                  add     [esi+16], edx
  3821 000027B3 29D0                                    sub     eax, edx
  3822 000027B5 D1E0                                    shl     eax, 1
  3823 000027B7 BA2E40E264                              mov     edx, 64E2402Eh
  3824 000027BC F7EA                                    imul    edx
  3825 000027BE 89562C                                  mov     [esi+44], edx
  3826 000027C1 8B4650                                  mov     eax, [esi+80]   ; @@BF 20,27,-,COS1_4,1
  3827 000027C4 8B566C                                  mov     edx, [esi+108]
  3828 000027C7 015650                                  add     [esi+80], edx
  3829 000027CA 29D0                                    sub     eax, edx
  3830 000027CC D1E0                                    shl     eax, 1
  3831 000027CE BAD2BF1D9B                              mov     edx, 9B1DBFD2h
  3832 000027D3 F7EA                                    imul    edx
  3833 000027D5 89566C                                  mov     [esi+108], edx
  3834 000027D8 8B460C                                  mov     eax, [esi+12]   ; @@BF 3,4,+,COS2_3,3
  3835 000027DB 8B5610                                  mov     edx, [esi+16]
  3836 000027DE 01560C                                  add     [esi+12], edx
  3837 000027E1 29D0                                    sub     eax, edx
  3838 000027E3 C1E003                                  shl     eax, 3
  3839 000027E6 BA42670352                              mov     edx, 52036742h
  3840 000027EB F7EA                                    imul    edx
  3841 000027ED 895610                                  mov     [esi+16], edx
  3842 000027F0 8B462C                                  mov     eax, [esi+44]   ; @@BF 11,12,-,COS2_3,3
  3843 000027F3 8B5630                                  mov     edx, [esi+48]
  3844 000027F6 01562C                                  add     [esi+44], edx
  3845 000027F9 29D0                                    sub     eax, edx
  3846 000027FB C1E003                                  shl     eax, 3
  3847 000027FE BABE98FCAD                              mov     edx, 0ADFC98BEh ; -COS2_3
  3848 00002803 F7EA                                    imul    edx
  3849 00002805 895630                                  mov     [esi+48], edx
  3850 00002808 8B464C                                  mov     eax, [esi+76]   ; @@BF 19,20,+,COS2_3,3
  3851 0000280B 8B5650                                  mov     edx, [esi+80]
  3852 0000280E 01564C                                  add     [esi+4Ch], edx
  3853 00002811 29D0                                    sub     eax, edx
  3854 00002813 C1E003                                  shl     eax, 3
  3855 00002816 BA42670352                              mov     edx, 52036742h  ; +COS2_3
  3856 0000281B F7EA                                    imul    edx
  3857 0000281D 895650                                  mov     [esi+80], edx
  3858 00002820 8B466C                                  mov     eax, [esi+108]  ; @@BF 27,28,-,COS2_3,3
  3859 00002823 8B5670                                  mov     edx, [esi+112]
  3860 00002826 01566C                                  add     [esi+108], edx
  3861 00002829 29D0                                    sub     eax, edx
  3862 0000282B C1E003                                  shl     eax, 3
  3863 0000282E BABE98FCAD                              mov     edx, 0ADFC98BEh
  3864 00002833 F7EA                                    imul    edx
  3865 00002835 895670                                  mov     [esi+112], edx
  3866 00002838 8B06                                    mov     eax, [esi]      ; @@BF 0,3,+,COS3_0,1
  3867 0000283A 8B560C                                  mov     edx, [esi+12]
  3868 0000283D 0116                                    add     [esi], edx
  3869 0000283F 29D0                                    sub     eax, edx
  3870 00002841 D1E0                                    shl     eax, 1
  3871 00002843 BAF0E94545                              mov     edx, 4545E9F0h
  3872 00002848 F7EA                                    imul    edx
  3873 0000284A 89560C                                  mov     [esi+12], edx
  3874 0000284D 8B4610                                  mov     eax, [esi+16]   ; @@BF 4,7,-,COS3_0,1
  3875 00002850 8B561C                                  mov     edx, [esi+28]
  3876 00002853 015610                                  add     [esi+16], edx
  3877 00002856 29D0                                    sub     eax, edx
  3878 00002858 D1E0                                    shl     eax, 1
  3879 0000285A BA1016BABA                              mov     edx, 0BABA1610h
  3880 0000285F F7EA                                    imul    edx
  3881 00002861 89561C                                  mov     [esi+28], edx
  3882 00002864 8B4620                                  mov     eax, [esi+32]   ; @@BF 8,11,+,COS3_0,1
  3883 00002867 8B562C                                  mov     edx, [esi+44]
  3884 0000286A 015620                                  add     [esi+32], edx
  3885 0000286D 29D0                                    sub     eax, edx
  3886 0000286F D1E0                                    shl     eax, 1
  3887 00002871 BAF0E94545                              mov     edx, 4545E9F0h
  3888 00002876 F7EA                                    imul    edx
  3889 00002878 89562C                                  mov     [esi+44], edx
  3890 0000287B 8B4630                                  mov     eax, [esi+48]   ; @@BF 12,15,-,COS3_0,1
  3891 0000287E 8B563C                                  mov     edx, [esi+60]
  3892 00002881 015630                                  add     [esi+48], edx
  3893 00002884 29D0                                    sub     eax, edx
  3894 00002886 D1E0                                    shl     eax, 1
  3895 00002888 BA1016BABA                              mov     edx, 0BABA1610h
  3896 0000288D F7EA                                    imul    edx
  3897 0000288F 89563C                                  mov     [esi+60], edx
  3898 00002892 8B4640                                  mov     eax, [esi+64]   ; @@BF 16,19,+,COS3_0,1
  3899 00002895 8B564C                                  mov     edx, [esi+76]
  3900 00002898 015640                                  add     [esi+64], edx
  3901 0000289B 29D0                                    sub     eax, edx
  3902 0000289D D1E0                                    shl     eax, 1
  3903 0000289F BAF0E94545                              mov     edx, 4545E9F0h
  3904 000028A4 F7EA                                    imul    edx
  3905 000028A6 89564C                                  mov     [esi+76], edx
  3906 000028A9 8B4650                                  mov     eax, [esi+80]   ; @@BF 20,23,-,COS3_0,1
  3907 000028AC 8B565C                                  mov     edx, [esi+92]
  3908 000028AF 015650                                  add     [esi+80], edx
  3909 000028B2 29D0                                    sub     eax, edx
  3910 000028B4 D1E0                                    shl     eax, 1
  3911 000028B6 BA1016BABA                              mov     edx, 0BABA1610h ; -COS3_0
  3912 000028BB F7EA                                    imul    edx
  3913 000028BD 89565C                                  mov     [esi+92], edx
  3914 000028C0 8B4660                                  mov     eax, [esi+96]   ; @@BF 24,27,+,COS3_0,1
  3915 000028C3 8B566C                                  mov     edx, [esi+108]
  3916 000028C6 015660                                  add     [esi+96], edx
  3917 000028C9 29D0                                    sub     eax, edx
  3918 000028CB D1E0                                    shl     eax, 1
  3919 000028CD BAF0E94545                              mov     edx, 4545E9F0h  ; +COS3_0
  3920 000028D2 F7EA                                    imul    edx
  3921 000028D4 89566C                                  mov     [esi+108], edx
  3922 000028D7 8B4670                                  mov     eax, [esi+112]  ; @@BF 28,31,-,COS3_0,1
  3923 000028DA 8B567C                                  mov     edx, [esi+124]
  3924 000028DD 015670                                  add     [esi+112], edx
  3925 000028E0 29D0                                    sub     eax, edx
  3926 000028E2 D1E0                                    shl     eax, 1
  3927 000028E4 BA1016BABA                              mov     edx, 0BABA1610h
  3928 000028E9 F7EA                                    imul    edx
  3929 000028EB 89567C                                  mov     [esi+124], edx
  3930 000028EE 8B4604                                  mov     eax, [esi+4]    ; @@BF 1,30,+,COS0_1,1
  3931 000028F1 8B5678                                  mov     edx, [esi+120]
  3932 000028F4 015604                                  add     [esi+4], edx
  3933 000028F7 29D0                                    sub     eax, edx
  3934 000028F9 D1E0                                    shl     eax, 1
  3935 000028FB BABD45B340                              mov     edx, 40B345BDh
  3936 00002900 F7EA                                    imul    edx
  3937 00002902 895678                                  mov     [esi+120], edx
  3938 00002905 8B4638                                  mov     eax, [esi+56]   ; @@BF 14,17,+,COS0_14,3
  3939 00002908 8B5644                                  mov     edx, [esi+68]
  3940 0000290B 015638                                  add     [esi+56], edx
  3941 0000290E 29D0                                    sub     eax, edx
  3942 00002910 C1E003                                  shl     eax, 3
  3943 00002913 BAD0200B6D                              mov     edx, 6D0B20D0h
  3944 00002918 F7EA                                    imul    edx
  3945 0000291A 895644                                  mov     [esi+68], edx
  3946 0000291D 8B4604                                  mov     eax, [esi+4]    ; @@BF 1,14,+,COS1_1,1
  3947 00002920 8B5638                                  mov     edx, [esi+56]
  3948 00002923 015604                                  add     [esi+4], edx
  3949 00002926 29D0                                    sub     eax, edx
  3950 00002928 D1E0                                    shl     eax, 1
  3951 0000292A BA103CE142                              mov     edx, 42E13C10h
  3952 0000292F F7EA                                    imul    edx
  3953 00002931 895638                                  mov     [esi+56], edx
  3954 00002934 8B4644                                  mov     eax, [esi+68]   ; @@BF 17,30,-,COS1_1,1
  3955 00002937 8B5678                                  mov     edx, [esi+120]
  3956 0000293A 015644                                  add     [esi+68], edx
  3957 0000293D 29D0                                    sub     eax, edx
  3958 0000293F D1E0                                    shl     eax, 1
  3959 00002941 BAF0C31EBD                              mov     edx, 0BD1EC3F0h
  3960 00002946 F7EA                                    imul    edx
  3961 00002948 895678                                  mov     [esi+120], edx
  3962 0000294B 8B4618                                  mov     eax, [esi+24]   ; @@BF 6,25,+,COS0_6,1
  3963 0000294E 8B5664                                  mov     edx, [esi+100]
  3964 00002951 015618                                  add     [esi+24], edx
  3965 00002954 29D0                                    sub     eax, edx
  3966 00002956 D1E0                                    shl     eax, 1
  3967 00002958 BA1237AE4F                              mov     edx, 4FAE3712h
  3968 0000295D F7EA                                    imul    edx
  3969 0000295F 895664                                  mov     [esi+100], edx
  3970 00002962 8B4624                                  mov     eax, [esi+36]   ; @@BF 9,22,+,COS0_9,1
  3971 00002965 8B5658                                  mov     edx, [esi+88]
  3972 00002968 015624                                  add     [esi+36], edx
  3973 0000296B 29D0                                    sub     eax, edx
  3974 0000296D D1E0                                    shl     eax, 1
  3975 0000296F BA27CF6F6B                              mov     edx, 6B6FCF27h
  3976 00002974 F7EA                                    imul    edx
  3977 00002976 895658                                  mov     [esi+88], edx
  3978 00002979 8B4618                                  mov     eax, [esi+24]   ; @@BF 6, 9,+,COS1_6,2
  3979 0000297C 8B5624                                  mov     edx, [esi+36]
  3980 0000297F 015618                                  add     [esi+24], edx
  3981 00002982 29D0                                    sub     eax, edx
  3982 00002984 C1E002                                  shl     eax, 2
  3983 00002987 BAC2923C6E                              mov     edx, 6E3C92C2h
  3984 0000298C F7EA                                    imul    edx
  3985 0000298E 895624                                  mov     [esi+36], edx
  3986 00002991 8B4658                                  mov     eax, [esi+88]   ; @@BF 22,25,-,COS1_6,2
  3987 00002994 8B5664                                  mov     edx, [esi+100]
  3988 00002997 015658                                  add     [esi+88], edx
  3989 0000299A 29D0                                    sub     eax, edx
  3990 0000299C C1E002                                  shl     eax, 2
  3991 0000299F BA3E6DC391                              mov     edx, 91C36D3Eh
  3992 000029A4 F7EA                                    imul    edx
  3993 000029A6 895664                                  mov     [esi+100], edx
  3994 000029A9 8B4604                                  mov     eax, [esi+4]    ; @@BF 1, 6,+,COS2_1,1
  3995 000029AC 8B5618                                  mov     edx, [esi+24]
  3996 000029AF 015604                                  add     [esi+4], edx
  3997 000029B2 29D0                                    sub     eax, edx
  3998 000029B4 D1E0                                    shl     eax, 1
  3999 000029B6 BA88DEF84C                              mov     edx, 4CF8DE88h
  4000 000029BB F7EA                                    imul    edx
  4001 000029BD 895618                                  mov     [esi+24], edx
  4002 000029C0 8B4624                                  mov     eax, [esi+36]   ; @@BF 9,14,-,COS2_1,1
  4003 000029C3 8B5638                                  mov     edx, [esi+56]
  4004 000029C6 015624                                  add     [esi+36], edx
  4005 000029C9 29D0                                    sub     eax, edx
  4006 000029CB D1E0                                    shl     eax, 1
  4007 000029CD BA782107B3                              mov     edx, 0B3072178h
  4008 000029D2 F7EA                                    imul    edx
  4009 000029D4 895638                                  mov     [esi+56], edx
  4010 000029D7 8B4644                                  mov     eax, [esi+68]   ; @@BF 17,22,+,COS2_1,1
  4011 000029DA 8B5658                                  mov     edx, [esi+88]
  4012 000029DD 015644                                  add     [esi+68], edx
  4013 000029E0 29D0                                    sub     eax, edx
  4014 000029E2 D1E0                                    shl     eax, 1
  4015 000029E4 BA88DEF84C                              mov     edx, 4CF8DE88h
  4016 000029E9 F7EA                                    imul    edx
  4017 000029EB 895658                                  mov     [esi+88], edx
  4018 000029EE 8B4664                                  mov     eax, [esi+100]  ; @@BF 25,30,-,COS2_1,1
  4019 000029F1 8B5678                                  mov     edx, [esi+120]
  4020 000029F4 015664                                  add     [esi+100], edx
  4021 000029F7 29D0                                    sub     eax, edx
  4022 000029F9 D1E0                                    shl     eax, 1
  4023 000029FB BA782107B3                              mov     edx, 0B3072178h
  4024 00002A00 F7EA                                    imul    edx
  4025 00002A02 895678                                  mov     [esi+120], edx
  4026 00002A05 8B4608                                  mov     eax, [esi+8]    ; @@BF 2,29,+,COS0_2,1
  4027 00002A08 8B5674                                  mov     edx, [esi+116]
  4028 00002A0B 015608                                  add     [esi+8], edx
  4029 00002A0E 29D0                                    sub     eax, edx
  4030 00002A10 D1E0                                    shl     eax, 1
  4031 00002A12 BA6E2DFA41                              mov     edx, 41FA2D6Eh
  4032 00002A17 F7EA                                    imul    edx
  4033 00002A19 895674                                  mov     [esi+116], edx
  4034 00002A1C 8B4634                                  mov     eax, [esi+52]   ; @@BF 13,18,+,COS0_13,3
  4035 00002A1F 8B5648                                  mov     edx, [esi+72]
  4036 00002A22 015634                                  add     [esi+52], edx
  4037 00002A25 29D0                                    sub     eax, edx
  4038 00002A27 C1E003                                  shl     eax, 3
  4039 00002A2A BA9057D941                              mov     edx, 41D95790h
  4040 00002A2F F7EA                                    imul    edx
  4041 00002A31 895648                                  mov     [esi+72], edx
  4042 00002A34 8B4608                                  mov     eax, [esi+8]    ; @@BF 2,13,+,COS1_2,1
  4043 00002A37 8B5634                                  mov     edx, [esi+52]
  4044 00002A3A 015608                                  add     [esi+8], edx
  4045 00002A3D 29D0                                    sub     eax, edx
  4046 00002A3F D1E0                                    shl     eax, 1
  4047 00002A41 BA459F9148                              mov     edx, 48919F45h
  4048 00002A46 F7EA                                    imul    edx
  4049 00002A48 895634                                  mov     [esi+52], edx
  4050 00002A4B 8B4648                                  mov     eax, [esi+72]   ; @@BF 18,29,-,COS1_2,1
  4051 00002A4E 8B5674                                  mov     edx, [esi+116]
  4052 00002A51 015648                                  add     [esi+72], edx
  4053 00002A54 29D0                                    sub     eax, edx
  4054 00002A56 D1E0                                    shl     eax, 1
  4055 00002A58 BABB606EB7                              mov     edx, 0B76E60BBh
  4056 00002A5D F7EA                                    imul    edx
  4057 00002A5F 895674                                  mov     [esi+116], edx
  4058 00002A62 8B4614                                  mov     eax, [esi+20]   ; @@BF 5,26,+,COS0_5,1
  4059 00002A65 8B5668                                  mov     edx, [esi+104]
  4060 00002A68 015614                                  add     [esi+20], edx
  4061 00002A6B 29D0                                    sub     eax, edx
  4062 00002A6D D1E0                                    shl     eax, 1
  4063 00002A6F BAF19C9D4A                              mov     edx, 4A9D9CF1h
  4064 00002A74 F7EA                                    imul    edx
  4065 00002A76 895668                                  mov     [esi+104], edx
  4066 00002A79 8B4628                                  mov     eax, [esi+40]   ; @@BF 10,21,+,COS0_10,1
  4067 00002A7C 8B5654                                  mov     edx, [esi+84]
  4068 00002A7F 015628                                  add     [esi+40], edx
  4069 00002A82 29D0                                    sub     eax, edx
  4070 00002A84 D1E0                                    shl     eax, 1
  4071 00002A86 BAB41D7D7C                              mov     edx, 7C7D1DB4h
  4072 00002A8B F7EA                                    imul    edx
  4073 00002A8D 895654                                  mov     [esi+84], edx
  4074 00002A90 8B4614                                  mov     eax, [esi+20]   ; @@BF 5,10,+,COS1_5,2
  4075 00002A93 8B5628                                  mov     edx, [esi+40]
  4076 00002A96 015614                                  add     [esi+20], edx
  4077 00002A99 29D0                                    sub     eax, edx
  4078 00002A9B C1E002                                  shl     eax, 2
  4079 00002A9E BAAA24E243                              mov     edx, 43E224AAh
  4080 00002AA3 F7EA                                    imul    edx
  4081 00002AA5 895628                                  mov     [esi+40], edx
  4082 00002AA8 8B4654                                  mov     eax, [esi+84]   ; @@BF 21,26,-,COS1_5,2
  4083 00002AAB 8B5668                                  mov     edx, [esi+104]
  4084 00002AAE 015654                                  add     [esi+84], edx
  4085 00002AB1 29D0                                    sub     eax, edx
  4086 00002AB3 C1E002                                  shl     eax, 2
  4087 00002AB6 BA56DB1DBC                              mov     edx, 0BC1DDB56h
  4088 00002ABB F7EA                                    imul    edx
  4089 00002ABD 895668                                  mov     [esi+104], edx
  4090 00002AC0 8B4608                                  mov     eax, [esi+8]    ; @@BF 2,5,+,COS2_2,1
  4091 00002AC3 8B5614                                  mov     edx, [esi+20]
  4092 00002AC6 015608                                  add     [esi+8], edx
  4093 00002AC9 29D0                                    sub     eax, edx
  4094 00002ACB D1E0                                    shl     eax, 1
  4095 00002ACD BABF6B3273                              mov     edx, 73326BBFh  ; +COS2_2
  4096 00002AD2 F7EA                                    imul    edx
  4097 00002AD4 895614                                  mov     [esi+20], edx
  4098 00002AD7 8B4628                                  mov     eax, [esi+40]   ; @@BF 10,13,-,COS2_2,1
  4099 00002ADA 8B5634                                  mov     edx, [esi+52]
  4100 00002ADD 015628                                  add     [esi+40], edx
  4101 00002AE0 29D0                                    sub     eax, edx
  4102 00002AE2 D1E0                                    shl     eax, 1
  4103 00002AE4 BA4194CD8C                              mov     edx, 8CCD9441h  ; -COS2_2
  4104 00002AE9 F7EA                                    imul    edx
  4105 00002AEB 895634                                  mov     [esi+52], edx
  4106 00002AEE 8B4648                                  mov     eax, [esi+72]   ; @@BF 18,21,+,COS2_2,1
  4107 00002AF1 8B5654                                  mov     edx, [esi+84]
  4108 00002AF4 015648                                  add     [esi+72], edx
  4109 00002AF7 29D0                                    sub     eax, edx
  4110 00002AF9 D1E0                                    shl     eax, 1
  4111 00002AFB BABF6B3273                              mov     edx, 73326BBFh
  4112 00002B00 F7EA                                    imul    edx
  4113 00002B02 895654                                  mov     [esi+84], edx
  4114 00002B05 8B4668                                  mov     eax, [esi+104]  ; @@BF 26,29,-,COS2_2,1
  4115 00002B08 8B5674                                  mov     edx, [esi+116]
  4116 00002B0B 015668                                  add     [esi+104], edx
  4117 00002B0E 29D0                                    sub     eax, edx
  4118 00002B10 D1E0                                    shl     eax, 1
  4119 00002B12 BA4194CD8C                              mov     edx, 8CCD9441h
  4120 00002B17 F7EA                                    imul    edx
  4121 00002B19 895674                                  mov     [esi+116], edx
  4122 00002B1C 8B4604                                  mov     eax, [esi+4]    ; @@BF 1,2,+,COS3_1,2
  4123 00002B1F 8B5608                                  mov     edx, [esi+8]
  4124 00002B22 015604                                  add     [esi+4], edx
  4125 00002B25 29D0                                    sub     eax, edx
  4126 00002B27 C1E002                                  shl     eax, 2
  4127 00002B2A BA46BA9E53                              mov     edx, 539EBA46h
  4128 00002B2F F7EA                                    imul    edx
  4129 00002B31 895608                                  mov     [esi+8], edx
  4130 00002B34 8B4614                                  mov     eax, [esi+20]   ; @@BF 5,6,-,COS3_1,2
  4131 00002B37 8B5618                                  mov     edx, [esi+24]
  4132 00002B3A 015614                                  add     [esi+20], edx
  4133 00002B3D 29D0                                    sub     eax, edx
  4134 00002B3F C1E002                                  shl     eax, 2
  4135 00002B42 BABA4561AC                              mov     edx, 0AC6145BAh
  4136 00002B47 F7EA                                    imul    edx
  4137 00002B49 895618                                  mov     [esi+24], edx
  4138 00002B4C 8B4624                                  mov     eax, [esi+36]   ; IF rate_shift LT 2
  4139                                                                          ; @@BF 9,10,+,COS3_1,2
  4140 00002B4F 8B5628                                  mov     edx, [esi+40]
  4141 00002B52 015624                                  add     [esi+36], edx
  4142 00002B55 29D0                                    sub     eax, edx
  4143 00002B57 C1E002                                  shl     eax, 2
  4144 00002B5A BA46BA9E53                              mov     edx, 539EBA46h
  4145 00002B5F F7EA                                    imul    edx
  4146 00002B61 895628                                  mov     [esi+40], edx
  4147 00002B64 8B4634                                  mov     eax, [esi+52]   ; @@BF 13,14,-,COS3_1,2
  4148 00002B67 8B5638                                  mov     edx, [esi+56]
  4149 00002B6A 015634                                  add     [esi+52], edx
  4150 00002B6D 29D0                                    sub     eax, edx
  4151 00002B6F C1E002                                  shl     eax, 2
  4152 00002B72 BABA4561AC                              mov     edx, 0AC6145BAh
  4153 00002B77 F7EA                                    imul    edx
  4154 00002B79 895638                                  mov     [esi+56], edx   ; ENDIF
  4155 00002B7C 8B4644                                  mov     eax, [esi+68]   ; @@BF 17,18,+,COS3_1,2
  4156 00002B7F 8B5648                                  mov     edx, [esi+72]
  4157 00002B82 015644                                  add     [esi+68], edx
  4158 00002B85 29D0                                    sub     eax, edx
  4159 00002B87 C1E002                                  shl     eax, 2
  4160 00002B8A BA46BA9E53                              mov     edx, 539EBA46h
  4161 00002B8F F7EA                                    imul    edx
  4162 00002B91 895648                                  mov     [esi+72], edx
  4163 00002B94 8B4654                                  mov     eax, [esi+84]   ; @@BF 21,22,-,COS3_1,2
  4164 00002B97 8B5658                                  mov     edx, [esi+88]
  4165 00002B9A 015654                                  add     [esi+84], edx
  4166 00002B9D 29D0                                    sub     eax, edx
  4167 00002B9F C1E002                                  shl     eax, 2
  4168 00002BA2 BABA4561AC                              mov     edx, 0AC6145BAh
  4169 00002BA7 F7EA                                    imul    edx
  4170 00002BA9 895658                                  mov     [esi+88], edx
  4171 00002BAC 8B4664                                  mov     eax, [esi+100]  ; @@BF 25,26,+,COS3_1,2
  4172 00002BAF 8B5668                                  mov     edx, [esi+104]
  4173 00002BB2 015664                                  add     [esi+100], edx
  4174 00002BB5 29D0                                    sub     eax, edx
  4175 00002BB7 C1E002                                  shl     eax, 2
  4176 00002BBA BA46BA9E53                              mov     edx, 539EBA46h
  4177 00002BBF F7EA                                    imul    edx
  4178 00002BC1 895668                                  mov     [esi+104], edx
  4179 00002BC4 8B4674                                  mov     eax, [esi+116]  ; @@BF 29,30,-,COS3_1,2
  4180 00002BC7 8B5678                                  mov     edx, [esi+120]
  4181 00002BCA 015674                                  add     [esi+116], edx
  4182 00002BCD 29D0                                    sub     eax, edx
  4183 00002BCF C1E002                                  shl     eax, 2
  4184 00002BD2 BABA4561AC                              mov     edx, 0AC6145BAh
  4185 00002BD7 F7EA                                    imul    edx
  4186 00002BD9 895678                                  mov     [esi+120], edx
  4187 00002BDC 8B06                                    mov     eax, [esi]      ; @@BF1 macro a, b, c, d
  4188                                                                          ;   @@BF  a, b,+,COS4_0, 1
  4189                                                                          ;   @@BF  c, d,-,COS4_0, 1
  4190                                                                          ;   @@ADD c, d
  4191                                                                          ;  endm
  4192                                                                          ; @@BF1 0,1,2,3
  4193 00002BDE 8B5604                                  mov     edx, [esi+4]    ; @@BF 0,1,+,COS4_0,1
  4194 00002BE1 0116                                    add     [esi], edx
  4195 00002BE3 29D0                                    sub     eax, edx
  4196 00002BE5 D1E0                                    shl     eax, 1
  4197 00002BE7 BA9A79825A                              mov     edx, 5A82799Ah  ; +COS4_0
  4198 00002BEC F7EA                                    imul    edx
  4199 00002BEE 895604                                  mov     [esi+4], edx
  4200 00002BF1 8B4608                                  mov     eax, [esi+8]    ; @@BF 2,3,-,COS4_0,1
  4201 00002BF4 8B560C                                  mov     edx, [esi+12]
  4202 00002BF7 015608                                  add     [esi+8], edx
  4203 00002BFA 29D0                                    sub     eax, edx
  4204 00002BFC D1E0                                    shl     eax, 1
  4205 00002BFE BA66867DA5                              mov     edx, 0A57D8666h ; -COS4_0
  4206 00002C03 F7EA                                    imul    edx
  4207 00002C05 89560C                                  mov     [esi+12], edx
  4208 00002C08 8B460C                                  mov     eax, [esi+12]   ; @@ADD 2,3
  4209 00002C0B 014608                                  add     [esi+8], eax
  4210 00002C0E 8B4610                                  mov     eax, [esi+16]   ; @@BF2 macro a, b, c, d
  4211                                                                          ;   @@BF  a, b,+,COS4_0, 1
  4212                                                                          ;   @@BF  c, d,-,COS4_0, 1
  4213                                                                          ;   @@ADD c, d
  4214                                                                          ;   @@ADD a, c
  4215                                                                          ;   @@ADD c, b
  4216                                                                          ;   @@ADD b, d
  4217                                                                          ;  endm
  4218                                                                          ; @@BF2 4,5,6,7
  4219 00002C11 8B5614                                  mov     edx, [esi+20]   ; @@BF 4,5,+,COS4_0,1
  4220 00002C14 015610                                  add     [esi+16], edx
  4221 00002C17 29D0                                    sub     eax, edx
  4222 00002C19 D1E0                                    shl     eax, 1
  4223 00002C1B BA9A79825A                              mov     edx, 5A82799Ah
  4224 00002C20 F7EA                                    imul    edx
  4225 00002C22 895614                                  mov     [esi+20], edx
  4226 00002C25 8B4618                                  mov     eax, [esi+24]   ; @@BF 6,7,-,COS4_0,1
  4227 00002C28 8B561C                                  mov     edx, [esi+28]
  4228 00002C2B 015618                                  add     [esi+24], edx
  4229 00002C2E 29D0                                    sub     eax, edx
  4230 00002C30 D1E0                                    shl     eax, 1
  4231 00002C32 BA66867DA5                              mov     edx, 0A57D8666h
  4232 00002C37 F7EA                                    imul    edx
  4233 00002C39 89561C                                  mov     [esi+28], edx
  4234 00002C3C 8B461C                                  mov     eax, [esi+28]   ; @@ADD macro dst,src
  4235                                                                          ;   IF (rate_shift EQ 0) or (dst LT 16)
  4236                                                                          ;    ;tab[a] += tab[b]
  4237                                                                          ;    mov  eax,dword ptr [esi+src*4]
  4238                                                                          ;    add  dword ptr [esi+dst*4],eax
  4239                                                                          ;   ENDIF
  4240                                                                          ;  endm
  4241                                                                          ; @@ADD 6,7
  4242 00002C3F 014618                                  add     [esi+24], eax
  4243 00002C42 8B4618                                  mov     eax, [esi+24]   ; @@ADD 4,6
  4244 00002C45 014610                                  add     [esi+16], eax
  4245 00002C48 8B4614                                  mov     eax, [esi+20]   ; @@ADD 6,5
  4246 00002C4B 014618                                  add     [esi+24], eax
  4247 00002C4E 8B461C                                  mov     eax, [esi+28]   ; @@ADD 5,7
  4248 00002C51 014614                                  add     [esi+20], eax
  4249 00002C54 8B4620                                  mov     eax, [esi+32]   ; IF rate_shift LT 2
  4250                                                                          ; @@BF1 8,9,10,11
  4251 00002C57 8B5624                                  mov     edx, [esi+36]   ; @@BF 8,9,+,COS4_0,1
  4252 00002C5A 015620                                  add     [esi+32], edx
  4253 00002C5D 29D0                                    sub     eax, edx
  4254 00002C5F D1E0                                    shl     eax, 1
  4255 00002C61 BA9A79825A                              mov     edx, 5A82799Ah
  4256 00002C66 F7EA                                    imul    edx
  4257 00002C68 895624                                  mov     [esi+36], edx
  4258 00002C6B 8B4628                                  mov     eax, [esi+40]   ; @@BF 10,11,-,COS4_0,1
  4259 00002C6E 8B562C                                  mov     edx, [esi+44]
  4260 00002C71 015628                                  add     [esi+40], edx
  4261 00002C74 29D0                                    sub     eax, edx
  4262 00002C76 D1E0                                    shl     eax, 1
  4263 00002C78 BA66867DA5                              mov     edx, 0A57D8666h
  4264 00002C7D F7EA                                    imul    edx
  4265 00002C7F 89562C                                  mov     [esi+44], edx
  4266 00002C82 8B462C                                  mov     eax, [esi+44]   ; @@ADD 10,11
  4267 00002C85 014628                                  add     [esi+40], eax
  4268 00002C88 8B4630                                  mov     eax, [esi+48]   ; @@BF2 12,13,14,15
  4269 00002C8B 8B5634                                  mov     edx, [esi+52]   ; @@BF 12,13,+,COS4_0,1
  4270 00002C8E 015630                                  add     [esi+48], edx
  4271 00002C91 29D0                                    sub     eax, edx
  4272 00002C93 D1E0                                    shl     eax, 1
  4273 00002C95 BA9A79825A                              mov     edx, 5A82799Ah
  4274 00002C9A F7EA                                    imul    edx
  4275 00002C9C 895634                                  mov     [esi+52], edx
  4276 00002C9F 8B4638                                  mov     eax, [esi+56]   ; @@BF 14,15,-,COS4_0,1
  4277 00002CA2 8B563C                                  mov     edx, [esi+60]
  4278 00002CA5 015638                                  add     [esi+56], edx
  4279 00002CA8 29D0                                    sub     eax, edx
  4280 00002CAA D1E0                                    shl     eax, 1
  4281 00002CAC BA66867DA5                              mov     edx, 0A57D8666h
  4282 00002CB1 F7EA                                    imul    edx
  4283 00002CB3 89563C                                  mov     [esi+60], edx
  4284 00002CB6 8B463C                                  mov     eax, [esi+60]   ; @@ADD 14,15
  4285 00002CB9 014638                                  add     [esi+56], eax
  4286 00002CBC 8B4638                                  mov     eax, [esi+56]   ; @@ADD 12,14
  4287 00002CBF 014630                                  add     [esi+48], eax
  4288 00002CC2 8B4634                                  mov     eax, [esi+52]   ; @@ADD 14,13
  4289 00002CC5 014638                                  add     [esi+56], eax
  4290 00002CC8 8B463C                                  mov     eax, [esi+60]   ; @@ADD 13,15
  4291 00002CCB 014634                                  add     [esi+52], eax   ; ENDIF
  4292 00002CCE 8B4640                                  mov     eax, [esi+64]   ; @@BF1 16,17,18,19
  4293 00002CD1 8B5644                                  mov     edx, [esi+68]
  4294 00002CD4 015640                                  add     [esi+64], edx
  4295 00002CD7 29D0                                    sub     eax, edx
  4296 00002CD9 D1E0                                    shl     eax, 1
  4297 00002CDB BA9A79825A                              mov     edx, 5A82799Ah  ; +COS4_0
  4298 00002CE0 F7EA                                    imul    edx
  4299 00002CE2 895644                                  mov     [esi+68], edx
  4300 00002CE5 8B4648                                  mov     eax, [esi+72]
  4301 00002CE8 8B564C                                  mov     edx, [esi+76]
  4302 00002CEB 015648                                  add     [esi+72], edx
  4303 00002CEE 29D0                                    sub     eax, edx
  4304 00002CF0 D1E0                                    shl     eax, 1
  4305 00002CF2 BA66867DA5                              mov     edx, 0A57D8666h ; -COS4_0
  4306 00002CF7 F7EA                                    imul    edx
  4307 00002CF9 89564C                                  mov     [esi+76], edx
  4308 00002CFC 8B464C                                  mov     eax, [esi+76]   ; @@ADD 18,19
  4309 00002CFF 014648                                  add     [esi+72], eax
  4310 00002D02 8B4650                                  mov     eax, [esi+80]   ; @@BF2 20,21,22,23
  4311 00002D05 8B5654                                  mov     edx, [esi+84]
  4312 00002D08 015650                                  add     [esi+80], edx
  4313 00002D0B 29D0                                    sub     eax, edx
  4314 00002D0D D1E0                                    shl     eax, 1
  4315 00002D0F BA9A79825A                              mov     edx, 5A82799Ah
  4316 00002D14 F7EA                                    imul    edx
  4317 00002D16 895654                                  mov     [esi+84], edx
  4318 00002D19 8B4658                                  mov     eax, [esi+88]
  4319 00002D1C 8B565C                                  mov     edx, [esi+92]
  4320 00002D1F 015658                                  add     [esi+88], edx
  4321 00002D22 29D0                                    sub     eax, edx
  4322 00002D24 D1E0                                    shl     eax, 1
  4323 00002D26 BA66867DA5                              mov     edx, 0A57D8666h
  4324 00002D2B F7EA                                    imul    edx
  4325 00002D2D 89565C                                  mov     [esi+92], edx
  4326 00002D30 8B465C                                  mov     eax, [esi+92]   ; @@ADD 22,23
  4327 00002D33 014658                                  add     [esi+88], eax
  4328 00002D36 8B4658                                  mov     eax, [esi+88]   ; @@ADD 20,22
  4329 00002D39 014650                                  add     [esi+80], eax
  4330 00002D3C 8B4654                                  mov     eax, [esi+84]
  4331 00002D3F 014658                                  add     [esi+88], eax
  4332 00002D42 8B465C                                  mov     eax, [esi+92]
  4333 00002D45 014654                                  add     [esi+84], eax
  4334 00002D48 8B4660                                  mov     eax, [esi+96]   ; @@BF1 24,25,26,27
  4335 00002D4B 8B5664                                  mov     edx, [esi+100]
  4336 00002D4E 015660                                  add     [esi+96], edx
  4337 00002D51 29D0                                    sub     eax, edx
  4338 00002D53 D1E0                                    shl     eax, 1
  4339 00002D55 BA9A79825A                              mov     edx, 5A82799Ah
  4340 00002D5A F7EA                                    imul    edx
  4341 00002D5C 895664                                  mov     [esi+100], edx
  4342 00002D5F 8B4668                                  mov     eax, [esi+104]
  4343 00002D62 8B566C                                  mov     edx, [esi+108]
  4344 00002D65 015668                                  add     [esi+104], edx
  4345 00002D68 29D0                                    sub     eax, edx
  4346 00002D6A D1E0                                    shl     eax, 1
  4347 00002D6C BA66867DA5                              mov     edx, 0A57D8666h
  4348 00002D71 F7EA                                    imul    edx
  4349 00002D73 89566C                                  mov     [esi+108], edx
  4350 00002D76 8B466C                                  mov     eax, [esi+108]
  4351 00002D79 014668                                  add     [esi+104], eax
  4352 00002D7C 8B4670                                  mov     eax, [esi+112]  ; @@BF2 28,29,30,31
  4353 00002D7F 8B5674                                  mov     edx, [esi+116]
  4354 00002D82 015670                                  add     [esi+112], edx
  4355 00002D85 29D0                                    sub     eax, edx
  4356 00002D87 D1E0                                    shl     eax, 1
  4357 00002D89 BA9A79825A                              mov     edx, 5A82799Ah
  4358 00002D8E F7EA                                    imul    edx
  4359 00002D90 895674                                  mov     [esi+116], edx
  4360 00002D93 8B4678                                  mov     eax, [esi+120]
  4361 00002D96 8B567C                                  mov     edx, [esi+124]
  4362 00002D99 015678                                  add     [esi+120], edx
  4363 00002D9C 29D0                                    sub     eax, edx
  4364 00002D9E D1E0                                    shl     eax, 1
  4365 00002DA0 BA66867DA5                              mov     edx, 0A57D8666h
  4366 00002DA5 F7EA                                    imul    edx
  4367 00002DA7 89567C                                  mov     [esi+124], edx
  4368 00002DAA 8B467C                                  mov     eax, [esi+124]
  4369 00002DAD 014678                                  add     [esi+120], eax
  4370 00002DB0 8B4678                                  mov     eax, [esi+120]
  4371 00002DB3 014670                                  add     [esi+112], eax
  4372 00002DB6 8B4674                                  mov     eax, [esi+116]
  4373 00002DB9 014678                                  add     [esi+120], eax
  4374 00002DBC 8B467C                                  mov     eax, [esi+124]
  4375 00002DBF 014674                                  add     [esi+116], eax
  4376 00002DC2 8B06                                    mov     eax, [esi]      ; @@OUT macro dst,src1,src2
  4377                                                                          ; IF ((dst AND ((1 SHL rate_shift)-1)) EQ 0)
  4378                                                                          ;    mov eax,dword ptr [esi+src1*4]
  4379                                                                          ;    IFDIFI <src2>,<->
  4380                                                                          ;      add eax,dword ptr [esi+src2*4]
  4381                                                                          ;    ENDIF
  4382                                                                          ;    IF SYNTH32
  4383                                                                          ;       mov dword ptr [edi+dst*4],eax
  4384                                                                          ;       IF (LONG_WINDOW EQ 0)
  4385                                                                          ;          mov dword ptr [edi+dst*4+512*4],eax
  4386                                                                          ;       ENDIF
  4387                                                                          ;    ELSE
  4388                                                                          ;        ......
  4389                                                                          ;    ENDIF
  4390                                                                          ; @@OUT 0,0,-
  4391 00002DC4 8907                                    mov     [edi], eax      ; mov dword ptr [edi+dst*4],eax
  4392 00002DC6 8B4604                                  mov     eax, [esi+4]    ; @@OUT 16,1, -
  4393                                                                          ; mov eax,dword ptr [esi+src1*4]
  4394 00002DC9 894740                                  mov     [edi+64], eax   ; mov dword ptr [edi+dst*4],eax
  4395 00002DCC 8B4608                                  mov     eax, [esi+8]    ; @@OUT 8,2,-
  4396 00002DCF 894720                                  mov     [edi+32], eax
  4397 00002DD2 8B460C                                  mov     eax, [esi+12]   ; @@OUT 24,3,-
  4398 00002DD5 894760                                  mov     [edi+96], eax
  4399 00002DD8 8B4610                                  mov     eax, [esi+16]   ; @@OUT 4,4,-
  4400 00002DDB 894710                                  mov     [edi+16], eax
  4401 00002DDE 8B4614                                  mov     eax, [esi+20]   ; @@OUT 20,5,-
  4402 00002DE1 894750                                  mov     [edi+80], eax
  4403 00002DE4 8B4618                                  mov     eax, [esi+24]   ; @@OUT 12,6,-
  4404 00002DE7 894730                                  mov     [edi+48], eax
  4405 00002DEA 8B461C                                  mov     eax, [esi+28]   ; @@OUT 28,7,-
  4406 00002DED 894770                                  mov     [edi+112], eax
  4407 00002DF0 8B4620                                  mov     eax, [esi+32]   ; @@OUT 2,8,12
  4408 00002DF3 034630                                  add     eax, [esi+48]   ; add eax,dword ptr [esi+src2*4]
  4409 00002DF6 894708                                  mov     [edi+8], eax
  4410 00002DF9 8B4624                                  mov     eax, [esi+36]   ; @@OUT 18,9,13
  4411 00002DFC 034634                                  add     eax, [esi+52]   ; add eax,dword ptr [esi+src2*4]
  4412 00002DFF 894748                                  mov     [edi+72], eax
  4413 00002E02 8B4628                                  mov     eax, [esi+40]   ; @@OUT 10,10,14
  4414 00002E05 034638                                  add     eax, [esi+56]
  4415 00002E08 894728                                  mov     [edi+40], eax
  4416 00002E0B 8B462C                                  mov     eax, [esi+44]   ; @@OUT 26,11,15
  4417 00002E0E 03463C                                  add     eax, [esi+60]
  4418 00002E11 894768                                  mov     [edi+104], eax
  4419 00002E14 8B4630                                  mov     eax, [esi+48]   ; @@OUT 6,12,10
  4420 00002E17 034628                                  add     eax, [esi+40]
  4421 00002E1A 894718                                  mov     [edi+24], eax
  4422 00002E1D 8B4634                                  mov     eax, [esi+52]   ; @@OUT 22,13,11
  4423 00002E20 03462C                                  add     eax, [esi+44]
  4424 00002E23 894758                                  mov     [edi+88], eax
  4425 00002E26 8B4638                                  mov     eax, [esi+56]   ; @@OUT 14,14,9
  4426 00002E29 034624                                  add     eax, [esi+36]
  4427 00002E2C 894738                                  mov     [edi+56], eax
  4428 00002E2F 8B463C                                  mov     eax, [esi+60]   ; @@OUT 30,15,-
  4429 00002E32 894778                                  mov     [edi+120], eax
  4430 00002E35 8B4670                                  mov     eax, [esi+112]  ; @@ADD 24,28
  4431 00002E38 014660                                  add     [esi+96], eax
  4432 00002E3B 8B4668                                  mov     eax, [esi+104]  ; @@ADD 28,26
  4433 00002E3E 014670                                  add     [esi+112], eax
  4434 00002E41 8B4678                                  mov     eax, [esi+120]  ; @@ADD 26,30
  4435 00002E44 014668                                  add     [esi+104], eax
  4436 00002E47 8B4664                                  mov     eax, [esi+100]  ; @@ADD 30,25
  4437 00002E4A 014678                                  add     [esi+120], eax
  4438 00002E4D 8B4674                                  mov     eax, [esi+116]  ; @@ADD 25,29
  4439 00002E50 014664                                  add     [esi+100], eax
  4440 00002E53 8B466C                                  mov     eax, [esi+108]  ; @@ADD 29,27
  4441 00002E56 014674                                  add     [esi+116], eax
  4442 00002E59 8B467C                                  mov     eax, [esi+124]  ; @@ADD 27,31
  4443 00002E5C 01466C                                  add     [esi+108], eax
  4444 00002E5F 8B4640                                  mov     eax, [esi+64]   ; @@OUT 1,16,24
  4445 00002E62 034660                                  add     eax, [esi+96]
  4446 00002E65 894704                                  mov     [edi+4], eax
  4447 00002E68 8B4644                                  mov     eax, [esi+68]   ; @@OUT 17,17,25
  4448 00002E6B 034664                                  add     eax, [esi+100]
  4449 00002E6E 894744                                  mov     [edi+68], eax
  4450 00002E71 8B4648                                  mov     eax, [esi+72]   ; @@OUT 9,18,26
  4451 00002E74 034668                                  add     eax, [esi+104]
  4452 00002E77 894724                                  mov     [edi+36], eax
  4453 00002E7A 8B464C                                  mov     eax, [esi+76]   ; @@OUT 25,19,27
  4454 00002E7D 03466C                                  add     eax, [esi+108]
  4455 00002E80 894764                                  mov     [edi+100], eax
  4456 00002E83 8B4650                                  mov     eax, [esi+80]   ; @@OUT 5,20,28
  4457 00002E86 034670                                  add     eax, [esi+112]
  4458 00002E89 894714                                  mov     [edi+20], eax
  4459 00002E8C 8B4654                                  mov     eax, [esi+84]   ; @@OUT 21,21,29
  4460 00002E8F 034674                                  add     eax, [esi+116]
  4461 00002E92 894754                                  mov     [edi+84], eax
  4462 00002E95 8B4658                                  mov     eax, [esi+88]   ; @@OUT 13,22,30
  4463 00002E98 034678                                  add     eax, [esi+120]
  4464 00002E9B 894734                                  mov     [edi+52], eax
  4465 00002E9E 8B465C                                  mov     eax, [esi+92]   ; @@OUT 29,23,31
  4466 00002EA1 03467C                                  add     eax, [esi+124]
  4467 00002EA4 894774                                  mov     [edi+116], eax
  4468 00002EA7 8B4660                                  mov     eax, [esi+96]   ; @@OUT 3,24,20
  4469 00002EAA 034650                                  add     eax, [esi+80]
  4470 00002EAD 89470C                                  mov     [edi+12], eax
  4471 00002EB0 8B4664                                  mov     eax, [esi+100]  ; @@OUT 19,25,21
  4472 00002EB3 034654                                  add     eax, [esi+84]
  4473 00002EB6 89474C                                  mov     [edi+76], eax
  4474 00002EB9 8B4668                                  mov     eax, [esi+104]  ; @@OUT 11,26,22
  4475 00002EBC 034658                                  add     eax, [esi+88]
  4476 00002EBF 89472C                                  mov     [edi+44], eax
  4477 00002EC2 8B466C                                  mov     eax, [esi+108]  ; @@OUT 27,27,23
  4478 00002EC5 03465C                                  add     eax, [esi+92]
  4479 00002EC8 89476C                                  mov     [edi+108], eax
  4480 00002ECB 8B4670                                  mov     eax, [esi+112]  ; @@OUT 7,28,18
  4481 00002ECE 034648                                  add     eax, [esi+72]
  4482 00002ED1 89471C                                  mov     [edi+28], eax
  4483 00002ED4 8B4674                                  mov     eax, [esi+116]  ; @@OUT 23,29,19
  4484 00002ED7 03464C                                  add     eax, [esi+76]
  4485 00002EDA 89475C                                  mov     [edi+92], eax
  4486 00002EDD 8B4678                                  mov     eax, [esi+120]  ; @@OUT 15,30,17
  4487 00002EE0 034644                                  add     eax, [esi+68]
  4488 00002EE3 89473C                                  mov     [edi+60], eax
  4489 00002EE6 8B467C                                  mov     eax, [esi+124]  ; @@OUT 31,31,-
  4490 00002EE9 89477C                                  mov     [edi+124], eax
  4491 00002EEC C3                                      retn
  4492                                  
  4493                                  
  4494                                  ; =============== S U B R O U T I N E =======================================
  4495                                  
  4496                                  
  4497                                  mp3_dct32_shift_1:
  4498 00002EED 8B467C                                  mov     eax, [esi+124]  ; mp3_dct32_macro macro rate_shift ; rate_shift = 1
  4499 00002EF0 0106                                    add     [esi], eax      ; @@BF macro a,b,sign,cos,shift
  4500                                                                          ; @@need_a equ (rate_shift EQ 0) or (a LT 16) ; a = 0
  4501                                                                          ; @@need_b equ (rate_shift EQ 0) or (b LT 16) ; b = 31
  4502                                                                          ; IF @@need_a AND @@need_b ; rate_shift = 0
  4503                                                                          ;    mov eax,dword ptr [esi+a*4]
  4504                                                                          ;    mov edx,dword ptr [esi+b*4]
  4505                                                                          ;    add dword ptr [esi+a*4],edx
  4506                                                                          ; ELSEIF @@need_a
  4507                                                                          ;    mov eax,dword ptr [esi+b*4]
  4508                                                                          ;    add dword ptr [esi+a*4],eax
  4509                                                                          ;
  4510                                                                          ; @@BF 0,31,+,COS0_0,1
  4511 00002EF2 8B4640                                  mov     eax, [esi+64]   ; @@BF 15,16,+,COS0_15,5
  4512 00002EF5 01463C                                  add     [esi+60], eax
  4513 00002EF8 8B06                                    mov     eax, [esi]      ; @@BF 0,15,+,COS1_0,1
  4514 00002EFA 8B563C                                  mov     edx, [esi+60]
  4515 00002EFD 0116                                    add     [esi], edx
  4516 00002EFF 29D0                                    sub     eax, edx
  4517 00002F01 D1E0                                    shl     eax, 1
  4518 00002F03 BA72464F40                              mov     edx, 404F4672h  ; COS1_0
  4519 00002F08 F7EA                                    imul    edx
  4520 00002F0A 89563C                                  mov     [esi+60], edx
  4521 00002F0D 8B4660                                  mov     eax, [esi+96]   ; skip @@BF 16,31,-,COS1_0,1
  4522                                                                          ; @@BF 7,24,+,COS0_7,1
  4523 00002F10 01461C                                  add     [esi+28], eax
  4524 00002F13 8B465C                                  mov     eax, [esi+92]   ; @@BF 8,23,+,COS0_8,1
  4525 00002F16 014620                                  add     [esi+32], eax
  4526 00002F19 8B461C                                  mov     eax, [esi+28]   ; @@BF 7,8,+,COS1_7,4
  4527 00002F1C 8B5620                                  mov     edx, [esi+32]
  4528 00002F1F 01561C                                  add     [esi+28], edx
  4529 00002F22 29D0                                    sub     eax, edx
  4530 00002F24 C1E004                                  shl     eax, 4
  4531 00002F27 BA044E9E51                              mov     edx, 519E4E04h  ; COS1_7
  4532 00002F2C F7EA                                    imul    edx
  4533 00002F2E 895620                                  mov     [esi+32], edx
  4534 00002F31 8B06                                    mov     eax, [esi]      ; skip @@BF 23,24,-,COS1_7,4
  4535                                                                          ; @@BF 0,7,+,COS2_0,1
  4536 00002F33 8B561C                                  mov     edx, [esi+28]
  4537 00002F36 0116                                    add     [esi], edx
  4538 00002F38 29D0                                    sub     eax, edx
  4539 00002F3A D1E0                                    shl     eax, 1
  4540 00002F3C BA46FB4041                              mov     edx, 4140FB46h  ; COS2_0
  4541 00002F41 F7EA                                    imul    edx
  4542 00002F43 89561C                                  mov     [esi+28], edx
  4543 00002F46 8B4620                                  mov     eax, [esi+32]   ; @@BF 8,15,-,COS2_0,1
  4544 00002F49 8B563C                                  mov     edx, [esi+60]
  4545 00002F4C 015620                                  add     [esi+32], edx
  4546 00002F4F 29D0                                    sub     eax, edx
  4547 00002F51 D1E0                                    shl     eax, 1
  4548 00002F53 BABA04BFBE                              mov     edx, 0BEBF04BAh ; -COS2_0
  4549 00002F58 F7EA                                    imul    edx
  4550 00002F5A 89563C                                  mov     [esi+60], edx
  4551 00002F5D 8B4670                                  mov     eax, [esi+112]  ; skip @@BF 16,23,+,COS2_0,1
  4552                                                                          ;      @@BF 24,31,-,COS2_0,1
  4553                                                                          ; @@BF 3,28,+,COS0_3,1
  4554 00002F60 01460C                                  add     [esi+12], eax
  4555 00002F63 8B464C                                  mov     eax, [esi+76]   ; @@BF 12,19,+,COS0_12,2
  4556 00002F66 014630                                  add     [esi+48], eax
  4557 00002F69 8B460C                                  mov     eax, [esi+12]   ; @@BF 3,12,+,COS1_3,1
  4558 00002F6C 8B5630                                  mov     edx, [esi+48]
  4559 00002F6F 01560C                                  add     [esi+12], edx
  4560 00002F72 29D0                                    sub     eax, edx
  4561 00002F74 D1E0                                    shl     eax, 1
  4562 00002F76 BA630ECB52                              mov     edx, 52CB0E63h
  4563 00002F7B F7EA                                    imul    edx
  4564 00002F7D 895630                                  mov     [esi+48], edx
  4565 00002F80 8B466C                                  mov     eax, [esi+108]  ; @@BF 4,27,+,COS0_4,1
  4566 00002F83 014610                                  add     [esi+16], eax
  4567 00002F86 8B4650                                  mov     eax, [esi+80]   ; @@BF 11,20,+,COS0_11,2
  4568 00002F89 01462C                                  add     [esi+44], eax
  4569 00002F8C 8B4610                                  mov     eax, [esi+16]   ; @@BF 4,11,+,COS1_4,1
  4570 00002F8F 8B562C                                  mov     edx, [esi+44]
  4571 00002F92 015610                                  add     [esi+16], edx
  4572 00002F95 29D0                                    sub     eax, edx
  4573 00002F97 D1E0                                    shl     eax, 1
  4574 00002F99 BA2E40E264                              mov     edx, 64E2402Eh  ; COS1_4
  4575 00002F9E F7EA                                    imul    edx
  4576 00002FA0 89562C                                  mov     [esi+44], edx
  4577 00002FA3 8B460C                                  mov     eax, [esi+12]   ; @@BF 3,4,+,COS2_3,3
  4578 00002FA6 8B5610                                  mov     edx, [esi+16]
  4579 00002FA9 01560C                                  add     [esi+12], edx
  4580 00002FAC 29D0                                    sub     eax, edx
  4581 00002FAE C1E003                                  shl     eax, 3
  4582 00002FB1 BA42670352                              mov     edx, 52036742h
  4583 00002FB6 F7EA                                    imul    edx
  4584 00002FB8 895610                                  mov     [esi+16], edx
  4585 00002FBB 8B462C                                  mov     eax, [esi+44]   ; @@BF 11,12,-,COS2_3,3
  4586 00002FBE 8B5630                                  mov     edx, [esi+48]
  4587 00002FC1 01562C                                  add     [esi+44], edx
  4588 00002FC4 29D0                                    sub     eax, edx
  4589 00002FC6 C1E003                                  shl     eax, 3
  4590 00002FC9 BABE98FCAD                              mov     edx, 0ADFC98BEh ; -COS2_3
  4591 00002FCE F7EA                                    imul    edx
  4592 00002FD0 895630                                  mov     [esi+48], edx
  4593 00002FD3 8B06                                    mov     eax, [esi]      ; @@BF 0,3,+,COS3_0,1
  4594 00002FD5 8B560C                                  mov     edx, [esi+12]
  4595 00002FD8 0116                                    add     [esi], edx
  4596 00002FDA 29D0                                    sub     eax, edx
  4597 00002FDC D1E0                                    shl     eax, 1
  4598 00002FDE BAF0E94545                              mov     edx, 4545E9F0h
  4599 00002FE3 F7EA                                    imul    edx
  4600 00002FE5 89560C                                  mov     [esi+12], edx
  4601 00002FE8 8B4610                                  mov     eax, [esi+16]   ; @@BF 4,7,-,COS3_0,1
  4602 00002FEB 8B561C                                  mov     edx, [esi+28]
  4603 00002FEE 015610                                  add     [esi+16], edx
  4604 00002FF1 29D0                                    sub     eax, edx
  4605 00002FF3 D1E0                                    shl     eax, 1
  4606 00002FF5 BA1016BABA                              mov     edx, 0BABA1610h
  4607 00002FFA F7EA                                    imul    edx
  4608 00002FFC 89561C                                  mov     [esi+28], edx
  4609 00002FFF 8B4620                                  mov     eax, [esi+32]   ; @@BF 8,11,+,COS3_0,1
  4610 00003002 8B562C                                  mov     edx, [esi+44]
  4611 00003005 015620                                  add     [esi+32], edx
  4612 00003008 29D0                                    sub     eax, edx
  4613 0000300A D1E0                                    shl     eax, 1
  4614 0000300C BAF0E94545                              mov     edx, 4545E9F0h
  4615 00003011 F7EA                                    imul    edx
  4616 00003013 89562C                                  mov     [esi+44], edx
  4617 00003016 8B4630                                  mov     eax, [esi+48]   ; @@BF 12,15,-,COS3_0,1
  4618 00003019 8B563C                                  mov     edx, [esi+60]
  4619 0000301C 015630                                  add     [esi+48], edx
  4620 0000301F 29D0                                    sub     eax, edx
  4621 00003021 D1E0                                    shl     eax, 1
  4622 00003023 BA1016BABA                              mov     edx, 0BABA1610h ; -COS3_0
  4623 00003028 F7EA                                    imul    edx
  4624 0000302A 89563C                                  mov     [esi+60], edx
  4625 0000302D 8B4678                                  mov     eax, [esi+120]  ; @@BF 1,30,+,COS0_1,1
  4626 00003030 014604                                  add     [esi+4], eax
  4627 00003033 8B4644                                  mov     eax, [esi+68]   ; @@BF 14,17,+,COS0_14,3
  4628 00003036 014638                                  add     [esi+56], eax
  4629 00003039 8B4604                                  mov     eax, [esi+4]    ; @@BF 1,14,+,COS1_1,1
  4630 0000303C 8B5638                                  mov     edx, [esi+56]
  4631 0000303F 015604                                  add     [esi+4], edx
  4632 00003042 29D0                                    sub     eax, edx
  4633 00003044 D1E0                                    shl     eax, 1
  4634 00003046 BA103CE142                              mov     edx, 42E13C10h
  4635 0000304B F7EA                                    imul    edx
  4636 0000304D 895638                                  mov     [esi+56], edx
  4637 00003050 8B4664                                  mov     eax, [esi+100]  ; @@BF 6,25,+,COS0_6,1
  4638 00003053 014618                                  add     [esi+24], eax
  4639 00003056 8B4658                                  mov     eax, [esi+88]   ; @@BF 9,22,+,COS0_9,1
  4640 00003059 014624                                  add     [esi+36], eax
  4641 0000305C 8B4618                                  mov     eax, [esi+24]   ; @@BF 6,9,+,COS1_6,2
  4642 0000305F 8B5624                                  mov     edx, [esi+36]
  4643 00003062 015618                                  add     [esi+24], edx
  4644 00003065 29D0                                    sub     eax, edx
  4645 00003067 C1E002                                  shl     eax, 2
  4646 0000306A BAC2923C6E                              mov     edx, 6E3C92C2h  ; +COS1_6
  4647 0000306F F7EA                                    imul    edx
  4648 00003071 895624                                  mov     [esi+36], edx
  4649 00003074 8B4604                                  mov     eax, [esi+4]    ; @@BF 1,6,+,COS2_1,1
  4650 00003077 8B5618                                  mov     edx, [esi+24]
  4651 0000307A 015604                                  add     [esi+4], edx
  4652 0000307D 29D0                                    sub     eax, edx
  4653 0000307F D1E0                                    shl     eax, 1
  4654 00003081 BA88DEF84C                              mov     edx, 4CF8DE88h
  4655 00003086 F7EA                                    imul    edx
  4656 00003088 895618                                  mov     [esi+24], edx
  4657 0000308B 8B4624                                  mov     eax, [esi+36]   ; @@BF 9,14,-,COS2_1,1
  4658 0000308E 8B5638                                  mov     edx, [esi+56]
  4659 00003091 015624                                  add     [esi+36], edx
  4660 00003094 29D0                                    sub     eax, edx
  4661 00003096 D1E0                                    shl     eax, 1
  4662 00003098 BA782107B3                              mov     edx, 0B3072178h ; -COS2_1
  4663 0000309D F7EA                                    imul    edx
  4664 0000309F 895638                                  mov     [esi+56], edx
  4665 000030A2 8B4674                                  mov     eax, [esi+116]  ; @@BF 2,29,+,COS0_2,1
  4666 000030A5 014608                                  add     [esi+8], eax
  4667 000030A8 8B4648                                  mov     eax, [esi+72]   ; @@BF 13,18,+,COS0_13,3
  4668 000030AB 014634                                  add     [esi+52], eax
  4669 000030AE 8B4608                                  mov     eax, [esi+8]    ; @@BF 2,13,+,COS1_2,1
  4670 000030B1 8B5634                                  mov     edx, [esi+52]
  4671 000030B4 015608                                  add     [esi+8], edx
  4672 000030B7 29D0                                    sub     eax, edx
  4673 000030B9 D1E0                                    shl     eax, 1
  4674 000030BB BA459F9148                              mov     edx, 48919F45h
  4675 000030C0 F7EA                                    imul    edx
  4676 000030C2 895634                                  mov     [esi+52], edx
  4677 000030C5 8B4668                                  mov     eax, [esi+104]  ; @@BF 5,26,+,COS0_5,1
  4678 000030C8 014614                                  add     [esi+20], eax
  4679 000030CB 8B4654                                  mov     eax, [esi+84]   ; @@BF 10,21,+,COS0_10,1
  4680 000030CE 014628                                  add     [esi+40], eax
  4681 000030D1 8B4614                                  mov     eax, [esi+20]   ; @@BF 5,10,+,COS1_5,2
  4682 000030D4 8B5628                                  mov     edx, [esi+40]
  4683 000030D7 015614                                  add     [esi+20], edx
  4684 000030DA 29D0                                    sub     eax, edx
  4685 000030DC C1E002                                  shl     eax, 2
  4686 000030DF BAAA24E243                              mov     edx, 43E224AAh
  4687 000030E4 F7EA                                    imul    edx
  4688 000030E6 895628                                  mov     [esi+40], edx
  4689 000030E9 8B4608                                  mov     eax, [esi+8]    ; @@BF 2,5,+,COS2_2,1
  4690 000030EC 8B5614                                  mov     edx, [esi+20]
  4691 000030EF 015608                                  add     [esi+8], edx
  4692 000030F2 29D0                                    sub     eax, edx
  4693 000030F4 D1E0                                    shl     eax, 1
  4694 000030F6 BABF6B3273                              mov     edx, 73326BBFh  ; COS2_2
  4695 000030FB F7EA                                    imul    edx
  4696 000030FD 895614                                  mov     [esi+20], edx
  4697 00003100 8B4628                                  mov     eax, [esi+40]   ; @@BF 10,13,-,COS2_2,1
  4698 00003103 8B5634                                  mov     edx, [esi+52]
  4699 00003106 015628                                  add     [esi+40], edx
  4700 00003109 29D0                                    sub     eax, edx
  4701 0000310B D1E0                                    shl     eax, 1
  4702 0000310D BA4194CD8C                              mov     edx, 8CCD9441h  ; -COS2_2
  4703 00003112 F7EA                                    imul    edx
  4704 00003114 895634                                  mov     [esi+52], edx
  4705 00003117 8B4604                                  mov     eax, [esi+4]    ; @@BF 1,2,+,COS3_1,2
  4706 0000311A 8B5608                                  mov     edx, [esi+8]
  4707 0000311D 015604                                  add     [esi+4], edx
  4708 00003120 29D0                                    sub     eax, edx
  4709 00003122 C1E002                                  shl     eax, 2
  4710 00003125 BA46BA9E53                              mov     edx, 539EBA46h
  4711 0000312A F7EA                                    imul    edx
  4712 0000312C 895608                                  mov     [esi+8], edx
  4713 0000312F 8B4614                                  mov     eax, [esi+20]   ; @@BF 5,6,-,COS3_1,2
  4714 00003132 8B5618                                  mov     edx, [esi+24]
  4715 00003135 015614                                  add     [esi+20], edx
  4716 00003138 29D0                                    sub     eax, edx
  4717 0000313A C1E002                                  shl     eax, 2
  4718 0000313D BABA4561AC                              mov     edx, 0AC6145BAh
  4719 00003142 F7EA                                    imul    edx
  4720 00003144 895618                                  mov     [esi+24], edx
  4721 00003147 8B4624                                  mov     eax, [esi+36]   ; IF rate_shift LT 2
  4722                                                                          ; @@BF 9,10,+,COS3_1,2
  4723 0000314A 8B5628                                  mov     edx, [esi+40]
  4724 0000314D 015624                                  add     [esi+36], edx
  4725 00003150 29D0                                    sub     eax, edx
  4726 00003152 C1E002                                  shl     eax, 2
  4727 00003155 BA46BA9E53                              mov     edx, 539EBA46h  ; +COS3_1
  4728 0000315A F7EA                                    imul    edx
  4729 0000315C 895628                                  mov     [esi+40], edx
  4730 0000315F 8B4634                                  mov     eax, [esi+52]   ; @@BF 13,14,-,COS3_1,2
  4731 00003162 8B5638                                  mov     edx, [esi+56]
  4732 00003165 015634                                  add     [esi+52], edx
  4733 00003168 29D0                                    sub     eax, edx
  4734 0000316A C1E002                                  shl     eax, 2
  4735 0000316D BABA4561AC                              mov     edx, 0AC6145BAh ; -COS3_1
  4736 00003172 F7EA                                    imul    edx
  4737 00003174 895638                                  mov     [esi+56], edx   ; ENDIF
  4738 00003177 8B06                                    mov     eax, [esi]      ; @@BF1 macro a, b, c, d
  4739                                                                          ;   @@BF  a, b,+,COS4_0, 1
  4740                                                                          ;   @@BF  c, d,-,COS4_0, 1
  4741                                                                          ;   @@ADD c, d
  4742                                                                          ;  endm
  4743                                                                          ; @@BF1 0,1,2,3
  4744 00003179 8B5604                                  mov     edx, [esi+4]    ; @@BF 0,1,+,COS4_0,1
  4745 0000317C 0116                                    add     [esi], edx
  4746 0000317E 29D0                                    sub     eax, edx
  4747 00003180 D1E0                                    shl     eax, 1
  4748 00003182 BA9A79825A                              mov     edx, 5A82799Ah
  4749 00003187 F7EA                                    imul    edx
  4750 00003189 895604                                  mov     [esi+4], edx
  4751 0000318C 8B4608                                  mov     eax, [esi+8]    ; @@BF 2,3,+,COS4_0,1
  4752 0000318F 8B560C                                  mov     edx, [esi+12]
  4753 00003192 015608                                  add     [esi+8], edx
  4754 00003195 29D0                                    sub     eax, edx
  4755 00003197 D1E0                                    shl     eax, 1
  4756 00003199 BA66867DA5                              mov     edx, 0A57D8666h
  4757 0000319E F7EA                                    imul    edx
  4758 000031A0 89560C                                  mov     [esi+12], edx
  4759 000031A3 8B460C                                  mov     eax, [esi+12]   ; @@ADD 2,3
  4760 000031A6 014608                                  add     [esi+8], eax
  4761 000031A9 8B4610                                  mov     eax, [esi+16]   ; @@BF2 macro a, b, c, d
  4762                                                                          ;   @@BF  a, b,+,COS4_0, 1
  4763                                                                          ;   @@BF  c, d,-,COS4_0, 1
  4764                                                                          ;   @@ADD c, d
  4765                                                                          ;   @@ADD a, c
  4766                                                                          ;   @@ADD c, b
  4767                                                                          ;   @@ADD b, d
  4768                                                                          ;  endm
  4769                                                                          ; @@BF2 4,5,6,7
  4770 000031AC 8B5614                                  mov     edx, [esi+20]   ; @@BF 4,5,+,COS4_0,1
  4771 000031AF 015610                                  add     [esi+16], edx
  4772 000031B2 29D0                                    sub     eax, edx
  4773 000031B4 D1E0                                    shl     eax, 1
  4774 000031B6 BA9A79825A                              mov     edx, 5A82799Ah  ; +COS4_0
  4775 000031BB F7EA                                    imul    edx
  4776 000031BD 895614                                  mov     [esi+20], edx
  4777 000031C0 8B4618                                  mov     eax, [esi+24]   ; @@BF 6,7,-,COS4_0,1
  4778 000031C3 8B561C                                  mov     edx, [esi+28]
  4779 000031C6 015618                                  add     [esi+24], edx
  4780 000031C9 29D0                                    sub     eax, edx
  4781 000031CB D1E0                                    shl     eax, 1
  4782 000031CD BA66867DA5                              mov     edx, 0A57D8666h ; -COS4_0
  4783 000031D2 F7EA                                    imul    edx
  4784 000031D4 89561C                                  mov     [esi+28], edx
  4785 000031D7 8B461C                                  mov     eax, [esi+28]   ; @@ADD macro dst,src
  4786                                                                          ;   IF (rate_shift EQ 0) or (dst LT 16)
  4787                                                                          ;    ;tab[a] += tab[b]
  4788                                                                          ;    mov  eax,dword ptr [esi+src*4]
  4789                                                                          ;    add  dword ptr [esi+dst*4],eax
  4790                                                                          ;   ENDIF
  4791                                                                          ;  endm
  4792                                                                          ; @@ADD 6,7
  4793 000031DA 014618                                  add     [esi+24], eax
  4794 000031DD 8B4618                                  mov     eax, [esi+24]   ; @@ADD 4,6
  4795 000031E0 014610                                  add     [esi+16], eax
  4796 000031E3 8B4614                                  mov     eax, [esi+20]   ; @@ADD 6,5
  4797 000031E6 014618                                  add     [esi+24], eax
  4798 000031E9 8B461C                                  mov     eax, [esi+28]   ; @@ADD 5,7
  4799 000031EC 014614                                  add     [esi+20], eax
  4800 000031EF 8B4620                                  mov     eax, [esi+32]   ; IF rate_shift LT 2
  4801                                                                          ; @@BF1 8,9,10,11
  4802 000031F2 8B5624                                  mov     edx, [esi+36]
  4803 000031F5 015620                                  add     [esi+32], edx
  4804 000031F8 29D0                                    sub     eax, edx
  4805 000031FA D1E0                                    shl     eax, 1
  4806 000031FC BA9A79825A                              mov     edx, 5A82799Ah
  4807 00003201 F7EA                                    imul    edx
  4808 00003203 895624                                  mov     [esi+36], edx
  4809 00003206 8B4628                                  mov     eax, [esi+40]
  4810 00003209 8B562C                                  mov     edx, [esi+44]
  4811 0000320C 015628                                  add     [esi+40], edx
  4812 0000320F 29D0                                    sub     eax, edx
  4813 00003211 D1E0                                    shl     eax, 1
  4814 00003213 BA66867DA5                              mov     edx, 0A57D8666h
  4815 00003218 F7EA                                    imul    edx
  4816 0000321A 89562C                                  mov     [esi+44], edx
  4817 0000321D 8B462C                                  mov     eax, [esi+44]
  4818 00003220 014628                                  add     [esi+40], eax
  4819 00003223 8B4630                                  mov     eax, [esi+48]   ; @@BF2 12,13,14,15
  4820 00003226 8B5634                                  mov     edx, [esi+52]
  4821 00003229 015630                                  add     [esi+48], edx
  4822 0000322C 29D0                                    sub     eax, edx
  4823 0000322E D1E0                                    shl     eax, 1
  4824 00003230 BA9A79825A                              mov     edx, 5A82799Ah
  4825 00003235 F7EA                                    imul    edx
  4826 00003237 895634                                  mov     [esi+52], edx
  4827 0000323A 8B4638                                  mov     eax, [esi+56]
  4828 0000323D 8B563C                                  mov     edx, [esi+60]
  4829 00003240 015638                                  add     [esi+56], edx
  4830 00003243 29D0                                    sub     eax, edx
  4831 00003245 D1E0                                    shl     eax, 1
  4832 00003247 BA66867DA5                              mov     edx, 0A57D8666h
  4833 0000324C F7EA                                    imul    edx
  4834 0000324E 89563C                                  mov     [esi+60], edx
  4835 00003251 8B463C                                  mov     eax, [esi+60]
  4836 00003254 014638                                  add     [esi+56], eax
  4837 00003257 8B4638                                  mov     eax, [esi+56]
  4838 0000325A 014630                                  add     [esi+48], eax
  4839 0000325D 8B4634                                  mov     eax, [esi+52]
  4840 00003260 014638                                  add     [esi+56], eax
  4841 00003263 8B463C                                  mov     eax, [esi+60]
  4842 00003266 014634                                  add     [esi+52], eax
  4843 00003269 8B06                                    mov     eax, [esi]      ; @@OUT macro dst,src1,src2
  4844                                                                          ; IF ((dst AND ((1 SHL rate_shift)-1)) EQ 0)
  4845                                                                          ;    mov eax,dword ptr [esi+src1*4]
  4846                                                                          ;    IFDIFI <src2>,<->
  4847                                                                          ;      add eax,dword ptr [esi+src2*4]
  4848                                                                          ;    ENDIF
  4849                                                                          ;    IF SYNTH32
  4850                                                                          ;       mov dword ptr [edi+dst*4],eax
  4851                                                                          ;       IF (LONG_WINDOW EQ 0)
  4852                                                                          ;          mov dword ptr [edi+dst*4+512*4],eax
  4853                                                                          ;       ENDIF
  4854                                                                          ;    ELSE
  4855                                                                          ;        ......
  4856                                                                          ;    ENDIF
  4857                                                                          ; @@OUT 0,0,-
  4858 0000326B 8907                                    mov     [edi], eax
  4859 0000326D 8B4604                                  mov     eax, [esi+4]    ; @@OUT 16,1,-
  4860 00003270 894740                                  mov     [edi+64], eax
  4861 00003273 8B4608                                  mov     eax, [esi+8]    ; @@OUT 8,2,-
  4862 00003276 894720                                  mov     [edi+32], eax
  4863 00003279 8B460C                                  mov     eax, [esi+12]   ; @@OUT 24,3,-
  4864 0000327C 894760                                  mov     [edi+96], eax
  4865 0000327F 8B4610                                  mov     eax, [esi+16]   ; @@OUT 4,4,-
  4866 00003282 894710                                  mov     [edi+16], eax
  4867 00003285 8B4614                                  mov     eax, [esi+20]   ; @@OUT 20,5,-
  4868 00003288 894750                                  mov     [edi+80], eax
  4869 0000328B 8B4618                                  mov     eax, [esi+24]   ; @@OUT 12,6,-
  4870 0000328E 894730                                  mov     [edi+48], eax
  4871 00003291 8B461C                                  mov     eax, [esi+28]   ; @@OUT 28,7,-
  4872 00003294 894770                                  mov     [edi+112], eax
  4873 00003297 8B4620                                  mov     eax, [esi+32]   ; @@OUT 2,8,12
  4874 0000329A 034630                                  add     eax, [esi+48]
  4875 0000329D 894708                                  mov     [edi+8], eax
  4876 000032A0 8B4624                                  mov     eax, [esi+36]   ; @@OUT 18,9,13
  4877 000032A3 034634                                  add     eax, [esi+52]
  4878 000032A6 894748                                  mov     [edi+72], eax
  4879 000032A9 8B4628                                  mov     eax, [esi+40]   ; @@OUT 10,10,14
  4880 000032AC 034638                                  add     eax, [esi+56]
  4881 000032AF 894728                                  mov     [edi+40], eax
  4882 000032B2 8B462C                                  mov     eax, [esi+44]   ; @@OUT 26,11,15
  4883 000032B5 03463C                                  add     eax, [esi+60]
  4884 000032B8 894768                                  mov     [edi+104], eax
  4885 000032BB 8B4630                                  mov     eax, [esi+48]   ; @@OUT 6,12,10
  4886 000032BE 034628                                  add     eax, [esi+40]
  4887 000032C1 894718                                  mov     [edi+24], eax
  4888 000032C4 8B4634                                  mov     eax, [esi+52]   ; @@OUT 22,13,11
  4889 000032C7 03462C                                  add     eax, [esi+44]
  4890 000032CA 894758                                  mov     [edi+88], eax
  4891 000032CD 8B4638                                  mov     eax, [esi+56]   ; @@OUT 14,14,9
  4892 000032D0 034624                                  add     eax, [esi+36]
  4893 000032D3 894738                                  mov     [edi+56], eax
  4894 000032D6 8B463C                                  mov     eax, [esi+60]   ; @@OUT 30,15,-
  4895 000032D9 894778                                  mov     [edi+120], eax
  4896 000032DC C3                                      retn
  4897                                  
  4898                                  
  4899                                  ; =============== S U B R O U T I N E =======================================
  4900                                  
  4901                                  
  4902                                  mp3_dct32_shift_2:
  4903 000032DD 8B467C                                  mov     eax, [esi+124]  ; mp3_dct32_macro macro rate_shift ; rate_shift = 2
  4904 000032E0 0106                                    add     [esi], eax      ; @@BF macro a,b,sign,cos,shift
  4905                                                                          ; @@need_a equ (rate_shift EQ 0) or (a LT 16) ; a = 0
  4906                                                                          ; @@need_b equ (rate_shift EQ 0) or (b LT 16) ; b = 31
  4907                                                                          ; IF @@need_a AND @@need_b ; rate_shift = 0
  4908                                                                          ;    mov eax,dword ptr [esi+a*4]
  4909                                                                          ;    mov edx,dword ptr [esi+b*4]
  4910                                                                          ;    add dword ptr [esi+a*4],edx
  4911                                                                          ; ELSEIF @@need_a
  4912                                                                          ;    mov eax,dword ptr [esi+b*4]
  4913                                                                          ;    add dword ptr [esi+a*4],eax
  4914                                                                          ;
  4915                                                                          ; @@BF 0,31,+,COS0_0,1
  4916 000032E2 8B4640                                  mov     eax, [esi+64]   ; @@BF 15,16,+,COS0_15,5
  4917 000032E5 01463C                                  add     [esi+60], eax
  4918 000032E8 8B06                                    mov     eax, [esi]      ; @@BF 0,15,+,COS1_0,1
  4919 000032EA 8B563C                                  mov     edx, [esi+60]
  4920 000032ED 0116                                    add     [esi], edx
  4921 000032EF 29D0                                    sub     eax, edx
  4922 000032F1 D1E0                                    shl     eax, 1
  4923 000032F3 BA72464F40                              mov     edx, 404F4672h  ; COS1_0
  4924 000032F8 F7EA                                    imul    edx
  4925 000032FA 89563C                                  mov     [esi+60], edx
  4926 000032FD 8B4660                                  mov     eax, [esi+96]   ; @@BF 7,24,+,COS0_7,1
  4927 00003300 01461C                                  add     [esi+28], eax
  4928 00003303 8B465C                                  mov     eax, [esi+92]   ; @@BF 8,23,+,COS0_8,1
  4929 00003306 014620                                  add     [esi+32], eax
  4930 00003309 8B461C                                  mov     eax, [esi+28]   ; @@BF 7,8,+,COS1_7,4
  4931 0000330C 8B5620                                  mov     edx, [esi+32]
  4932 0000330F 01561C                                  add     [esi+28], edx
  4933 00003312 29D0                                    sub     eax, edx
  4934 00003314 C1E004                                  shl     eax, 4
  4935 00003317 BA044E9E51                              mov     edx, 519E4E04h  ; COS1_7
  4936 0000331C F7EA                                    imul    edx
  4937 0000331E 895620                                  mov     [esi+32], edx
  4938 00003321 8B06                                    mov     eax, [esi]      ; @@BF 0,7,+,COS2_0,1
  4939 00003323 8B561C                                  mov     edx, [esi+28]
  4940 00003326 0116                                    add     [esi], edx
  4941 00003328 29D0                                    sub     eax, edx
  4942 0000332A D1E0                                    shl     eax, 1
  4943 0000332C BA46FB4041                              mov     edx, 4140FB46h  ; COS2_0
  4944 00003331 F7EA                                    imul    edx
  4945 00003333 89561C                                  mov     [esi+28], edx
  4946 00003336 8B4620                                  mov     eax, [esi+32]   ; @@BF 8,15,-,COS2_0,1
  4947 00003339 8B563C                                  mov     edx, [esi+60]
  4948 0000333C 015620                                  add     [esi+32], edx
  4949 0000333F 29D0                                    sub     eax, edx
  4950 00003341 D1E0                                    shl     eax, 1
  4951 00003343 BABA04BFBE                              mov     edx, 0BEBF04BAh
  4952 00003348 F7EA                                    imul    edx
  4953 0000334A 89563C                                  mov     [esi+60], edx
  4954 0000334D 8B4670                                  mov     eax, [esi+112]  ; @@BF 3,28,+,COS0_3,1
  4955 00003350 01460C                                  add     [esi+12], eax
  4956 00003353 8B464C                                  mov     eax, [esi+76]   ; @@BF 12,19,+,COS0_12,2
  4957 00003356 014630                                  add     [esi+48], eax
  4958 00003359 8B460C                                  mov     eax, [esi+12]   ; @@BF 3,12,+,COS1_3,1
  4959 0000335C 8B5630                                  mov     edx, [esi+48]
  4960 0000335F 01560C                                  add     [esi+12], edx
  4961 00003362 29D0                                    sub     eax, edx
  4962 00003364 D1E0                                    shl     eax, 1
  4963 00003366 BA630ECB52                              mov     edx, 52CB0E63h  ; COS1_3
  4964 0000336B F7EA                                    imul    edx
  4965 0000336D 895630                                  mov     [esi+48], edx
  4966 00003370 8B466C                                  mov     eax, [esi+108]  ; @@BF 4,27,+,COS0_4,1
  4967 00003373 014610                                  add     [esi+16], eax
  4968 00003376 8B4650                                  mov     eax, [esi+80]   ; @@BF 11,20,+,COS0_11,2
  4969 00003379 01462C                                  add     [esi+44], eax
  4970 0000337C 8B4610                                  mov     eax, [esi+16]   ; @@BF 4,11,+,COS1_4,1
  4971 0000337F 8B562C                                  mov     edx, [esi+44]
  4972 00003382 015610                                  add     [esi+16], edx
  4973 00003385 29D0                                    sub     eax, edx
  4974 00003387 D1E0                                    shl     eax, 1
  4975 00003389 BA2E40E264                              mov     edx, 64E2402Eh
  4976 0000338E F7EA                                    imul    edx
  4977 00003390 89562C                                  mov     [esi+44], edx
  4978 00003393 8B460C                                  mov     eax, [esi+12]   ; @@BF 3,4,+,COS2_3,3
  4979 00003396 8B5610                                  mov     edx, [esi+16]
  4980 00003399 01560C                                  add     [esi+12], edx
  4981 0000339C 29D0                                    sub     eax, edx
  4982 0000339E C1E003                                  shl     eax, 3
  4983 000033A1 BA42670352                              mov     edx, 52036742h
  4984 000033A6 F7EA                                    imul    edx
  4985 000033A8 895610                                  mov     [esi+16], edx
  4986 000033AB 8B462C                                  mov     eax, [esi+44]   ; @@BF 11,12,-,COS2_3,3
  4987 000033AE 8B5630                                  mov     edx, [esi+48]
  4988 000033B1 01562C                                  add     [esi+44], edx
  4989 000033B4 29D0                                    sub     eax, edx
  4990 000033B6 C1E003                                  shl     eax, 3
  4991 000033B9 BABE98FCAD                              mov     edx, 0ADFC98BEh ; -COS2_3
  4992 000033BE F7EA                                    imul    edx
  4993 000033C0 895630                                  mov     [esi+48], edx
  4994 000033C3 8B06                                    mov     eax, [esi]      ; @@BF 0,3,+,COS3_0,1
  4995 000033C5 8B560C                                  mov     edx, [esi+12]
  4996 000033C8 0116                                    add     [esi], edx
  4997 000033CA 29D0                                    sub     eax, edx
  4998 000033CC D1E0                                    shl     eax, 1
  4999 000033CE BAF0E94545                              mov     edx, 4545E9F0h
  5000 000033D3 F7EA                                    imul    edx
  5001 000033D5 89560C                                  mov     [esi+12], edx
  5002 000033D8 8B4610                                  mov     eax, [esi+16]   ; @@BF 4,7,-,COS3_0,1
  5003 000033DB 8B561C                                  mov     edx, [esi+28]
  5004 000033DE 015610                                  add     [esi+16], edx
  5005 000033E1 29D0                                    sub     eax, edx
  5006 000033E3 D1E0                                    shl     eax, 1
  5007 000033E5 BA1016BABA                              mov     edx, 0BABA1610h
  5008 000033EA F7EA                                    imul    edx
  5009 000033EC 89561C                                  mov     [esi+28], edx
  5010 000033EF 8B4620                                  mov     eax, [esi+32]   ; @@BF 8,11,+,COS3_0,1
  5011 000033F2 8B562C                                  mov     edx, [esi+44]
  5012 000033F5 015620                                  add     [esi+32], edx
  5013 000033F8 29D0                                    sub     eax, edx
  5014 000033FA D1E0                                    shl     eax, 1
  5015 000033FC BAF0E94545                              mov     edx, 4545E9F0h
  5016 00003401 F7EA                                    imul    edx
  5017 00003403 89562C                                  mov     [esi+44], edx
  5018 00003406 8B4630                                  mov     eax, [esi+48]   ; @@BF 12,15,-,COS3_0,1
  5019 00003409 8B563C                                  mov     edx, [esi+60]
  5020 0000340C 015630                                  add     [esi+48], edx
  5021 0000340F 29D0                                    sub     eax, edx
  5022 00003411 D1E0                                    shl     eax, 1
  5023 00003413 BA1016BABA                              mov     edx, 0BABA1610h
  5024 00003418 F7EA                                    imul    edx
  5025 0000341A 89563C                                  mov     [esi+60], edx
  5026 0000341D 8B4678                                  mov     eax, [esi+120]  ; @@BF 1,30,+,COS0_1,1
  5027 00003420 014604                                  add     [esi+4], eax
  5028 00003423 8B4644                                  mov     eax, [esi+68]   ; @@BF 14,17,+,COS0_14,3
  5029 00003426 014638                                  add     [esi+56], eax
  5030 00003429 8B4604                                  mov     eax, [esi+4]    ; @@BF 1,14,+,COS1_1,1
  5031 0000342C 8B5638                                  mov     edx, [esi+56]
  5032 0000342F 015604                                  add     [esi+4], edx
  5033 00003432 29D0                                    sub     eax, edx
  5034 00003434 D1E0                                    shl     eax, 1
  5035 00003436 BA103CE142                              mov     edx, 42E13C10h  ; COS1_1
  5036 0000343B F7EA                                    imul    edx
  5037 0000343D 895638                                  mov     [esi+56], edx
  5038 00003440 8B4664                                  mov     eax, [esi+100]  ; @@BF 6,25,+,COS0_6,1
  5039 00003443 014618                                  add     [esi+24], eax
  5040 00003446 8B4658                                  mov     eax, [esi+88]   ; @@BF 9,22,+,COS0_9,1
  5041 00003449 014624                                  add     [esi+36], eax
  5042 0000344C 8B4618                                  mov     eax, [esi+24]   ; @@BF 6,9,+,COS1_6,2
  5043 0000344F 8B5624                                  mov     edx, [esi+36]
  5044 00003452 015618                                  add     [esi+24], edx
  5045 00003455 29D0                                    sub     eax, edx
  5046 00003457 C1E002                                  shl     eax, 2
  5047 0000345A BAC2923C6E                              mov     edx, 6E3C92C2h
  5048 0000345F F7EA                                    imul    edx
  5049 00003461 895624                                  mov     [esi+36], edx
  5050 00003464 8B4604                                  mov     eax, [esi+4]    ; @@BF 1,6,+,COS2_1,1
  5051 00003467 8B5618                                  mov     edx, [esi+24]
  5052 0000346A 015604                                  add     [esi+4], edx
  5053 0000346D 29D0                                    sub     eax, edx
  5054 0000346F D1E0                                    shl     eax, 1
  5055 00003471 BA88DEF84C                              mov     edx, 4CF8DE88h  ; COS2_1
  5056 00003476 F7EA                                    imul    edx
  5057 00003478 895618                                  mov     [esi+24], edx
  5058 0000347B 8B4624                                  mov     eax, [esi+36]   ; @@BF 9,14,-,COS2_1,1
  5059 0000347E 8B5638                                  mov     edx, [esi+56]
  5060 00003481 015624                                  add     [esi+36], edx
  5061 00003484 29D0                                    sub     eax, edx
  5062 00003486 D1E0                                    shl     eax, 1
  5063 00003488 BA782107B3                              mov     edx, 0B3072178h ; -COS2_1
  5064 0000348D F7EA                                    imul    edx
  5065 0000348F 895638                                  mov     [esi+56], edx
  5066 00003492 8B4674                                  mov     eax, [esi+116]  ; @@BF 2,29,+,COS0_2,1
  5067 00003495 014608                                  add     [esi+8], eax
  5068 00003498 8B4648                                  mov     eax, [esi+72]   ; @@BF 13,18,+,COS0_13,3
  5069 0000349B 014634                                  add     [esi+52], eax
  5070 0000349E 8B4608                                  mov     eax, [esi+8]    ; @@BF 2,13,+,COS1_2,1
  5071 000034A1 8B5634                                  mov     edx, [esi+52]
  5072 000034A4 015608                                  add     [esi+8], edx
  5073 000034A7 29D0                                    sub     eax, edx
  5074 000034A9 D1E0                                    shl     eax, 1
  5075 000034AB BA459F9148                              mov     edx, 48919F45h
  5076 000034B0 F7EA                                    imul    edx
  5077 000034B2 895634                                  mov     [esi+52], edx
  5078 000034B5 8B4668                                  mov     eax, [esi+104]  ; @@BF 5,26,+,COS0_5,1
  5079 000034B8 014614                                  add     [esi+20], eax
  5080 000034BB 8B4654                                  mov     eax, [esi+84]   ; @@BF 10,21,+,COS0_10,1
  5081 000034BE 014628                                  add     [esi+40], eax
  5082 000034C1 8B4614                                  mov     eax, [esi+20]   ; @@BF 5,10,+,COS1_5,2
  5083 000034C4 8B5628                                  mov     edx, [esi+40]
  5084 000034C7 015614                                  add     [esi+20], edx
  5085 000034CA 29D0                                    sub     eax, edx
  5086 000034CC C1E002                                  shl     eax, 2
  5087 000034CF BAAA24E243                              mov     edx, 43E224AAh
  5088 000034D4 F7EA                                    imul    edx
  5089 000034D6 895628                                  mov     [esi+40], edx
  5090 000034D9 8B4608                                  mov     eax, [esi+8]    ; @@BF 2,5,+,COS2_2,1
  5091 000034DC 8B5614                                  mov     edx, [esi+20]
  5092 000034DF 015608                                  add     [esi+8], edx
  5093 000034E2 29D0                                    sub     eax, edx
  5094 000034E4 D1E0                                    shl     eax, 1
  5095 000034E6 BABF6B3273                              mov     edx, 73326BBFh  ; COS2_2
  5096 000034EB F7EA                                    imul    edx
  5097 000034ED 895614                                  mov     [esi+20], edx
  5098 000034F0 8B4628                                  mov     eax, [esi+40]   ; @@BF 10,13,-,COS2_2,1
  5099 000034F3 8B5634                                  mov     edx, [esi+52]
  5100 000034F6 015628                                  add     [esi+40], edx
  5101 000034F9 29D0                                    sub     eax, edx
  5102 000034FB D1E0                                    shl     eax, 1
  5103 000034FD BA4194CD8C                              mov     edx, 8CCD9441h  ; -COS2_2
  5104 00003502 F7EA                                    imul    edx
  5105 00003504 895634                                  mov     [esi+52], edx
  5106 00003507 8B4604                                  mov     eax, [esi+4]    ; @@BF 1,2,+,COS3_1,2
  5107 0000350A 8B5608                                  mov     edx, [esi+8]
  5108 0000350D 015604                                  add     [esi+4], edx
  5109 00003510 29D0                                    sub     eax, edx
  5110 00003512 C1E002                                  shl     eax, 2
  5111 00003515 BA46BA9E53                              mov     edx, 539EBA46h  ; COS3_1
  5112 0000351A F7EA                                    imul    edx
  5113 0000351C 895608                                  mov     [esi+8], edx
  5114 0000351F 8B4614                                  mov     eax, [esi+20]   ; @@BF 5,6,-,COS3_1,2
  5115 00003522 8B5618                                  mov     edx, [esi+24]
  5116 00003525 015614                                  add     [esi+14h], edx
  5117 00003528 29D0                                    sub     eax, edx
  5118 0000352A C1E002                                  shl     eax, 2
  5119 0000352D BABA4561AC                              mov     edx, 0AC6145BAh ; -COS3_1
  5120 00003532 F7EA                                    imul    edx
  5121 00003534 895618                                  mov     [esi+24], edx
  5122 00003537 8B06                                    mov     eax, [esi]      ; @@BF1 macro a, b, c, d
  5123                                                                          ;   @@BF  a, b,+,COS4_0, 1
  5124                                                                          ;   @@BF  c, d,-,COS4_0, 1
  5125                                                                          ;   @@ADD c, d
  5126                                                                          ;  endm
  5127                                                                          ; @@BF1 0,1,2,3
  5128 00003539 8B5604                                  mov     edx, [esi+4]    ; @@BF 0,1,+,COS4_0,1
  5129 0000353C 0116                                    add     [esi], edx
  5130 0000353E 29D0                                    sub     eax, edx
  5131 00003540 D1E0                                    shl     eax, 1
  5132 00003542 BA9A79825A                              mov     edx, 5A82799Ah
  5133 00003547 F7EA                                    imul    edx
  5134 00003549 895604                                  mov     [esi+4], edx
  5135 0000354C 8B4608                                  mov     eax, [esi+8]    ; @@BF 2,3,-,COS4_0,1
  5136 0000354F 8B560C                                  mov     edx, [esi+12]
  5137 00003552 015608                                  add     [esi+8], edx
  5138 00003555 29D0                                    sub     eax, edx
  5139 00003557 D1E0                                    shl     eax, 1
  5140 00003559 BA66867DA5                              mov     edx, 0A57D8666h
  5141 0000355E F7EA                                    imul    edx
  5142 00003560 89560C                                  mov     [esi+12], edx
  5143 00003563 8B460C                                  mov     eax, [esi+12]   ; @@ADD 2,3
  5144 00003566 014608                                  add     [esi+8], eax
  5145 00003569 8B4610                                  mov     eax, [esi+16]   ; @@BF2 macro a, b, c, d
  5146                                                                          ;   @@BF  a, b,+,COS4_0, 1
  5147                                                                          ;   @@BF  c, d,-,COS4_0, 1
  5148                                                                          ;   @@ADD c, d
  5149                                                                          ;   @@ADD a, c
  5150                                                                          ;   @@ADD c, b
  5151                                                                          ;   @@ADD b, d
  5152                                                                          ;  endm
  5153                                                                          ; @@BF2 4,5,6,7
  5154 0000356C 8B5614                                  mov     edx, [esi+20]   ; @@BF 4,5,+,COS4_0,1
  5155 0000356F 015610                                  add     [esi+16], edx
  5156 00003572 29D0                                    sub     eax, edx
  5157 00003574 D1E0                                    shl     eax, 1
  5158 00003576 BA9A79825A                              mov     edx, 5A82799Ah  ; COS4_0
  5159 0000357B F7EA                                    imul    edx
  5160 0000357D 895614                                  mov     [esi+20], edx
  5161 00003580 8B4618                                  mov     eax, [esi+24]   ; @@BF 6,7,-,COS4_0,1
  5162 00003583 8B561C                                  mov     edx, [esi+28]
  5163 00003586 015618                                  add     [esi+18h], edx
  5164 00003589 29D0                                    sub     eax, edx
  5165 0000358B D1E0                                    shl     eax, 1
  5166 0000358D BA66867DA5                              mov     edx, 0A57D8666h ; -COS4_0
  5167 00003592 F7EA                                    imul    edx
  5168 00003594 89561C                                  mov     [esi+28], edx
  5169 00003597 8B461C                                  mov     eax, [esi+28]   ; @@ADD 6,7
  5170 0000359A 014618                                  add     [esi+24], eax
  5171 0000359D 8B4618                                  mov     eax, [esi+24]   ; @@ADD 4,6
  5172 000035A0 014610                                  add     [esi+16], eax
  5173 000035A3 8B4614                                  mov     eax, [esi+20]   ; @@ADD 6,5
  5174 000035A6 014618                                  add     [esi+24], eax
  5175 000035A9 8B461C                                  mov     eax, [esi+28]   ; @@ADD 5,7
  5176 000035AC 014614                                  add     [esi+20], eax
  5177 000035AF 8B06                                    mov     eax, [esi]      ; @@OUT macro dst,src1,src2
  5178                                                                          ; IF ((dst AND ((1 SHL rate_shift)-1)) EQ 0)
  5179                                                                          ;    mov eax,dword ptr [esi+src1*4]
  5180                                                                          ;    IFDIFI <src2>,<->
  5181                                                                          ;      add eax,dword ptr [esi+src2*4]
  5182                                                                          ;    ENDIF
  5183                                                                          ;    IF SYNTH32
  5184                                                                          ;       mov dword ptr [edi+dst*4],eax
  5185                                                                          ;       IF (LONG_WINDOW EQ 0)
  5186                                                                          ;          mov dword ptr [edi+dst*4+512*4],eax
  5187                                                                          ;       ENDIF
  5188                                                                          ;    ELSE
  5189                                                                          ;        ......
  5190                                                                          ;    ENDIF
  5191                                                                          ; @@OUT 0,0,-
  5192 000035B1 8907                                    mov     [edi], eax
  5193 000035B3 8B4604                                  mov     eax, [esi+4]    ; @@OUT 16,1,-
  5194 000035B6 894740                                  mov     [edi+64], eax
  5195 000035B9 8B4608                                  mov     eax, [esi+8]    ; @@OUT 8,2,-
  5196 000035BC 894720                                  mov     [edi+32], eax
  5197 000035BF 8B460C                                  mov     eax, [esi+12]   ; @@OUT 24,3,-
  5198 000035C2 894760                                  mov     [edi+96], eax
  5199 000035C5 8B4610                                  mov     eax, [esi+16]   ; @@OUT 4,4,-
  5200 000035C8 894710                                  mov     [edi+16], eax
  5201 000035CB 8B4614                                  mov     eax, [esi+20]   ; @@OUT 20,5,-
  5202 000035CE 894750                                  mov     [edi+80], eax
  5203 000035D1 8B4618                                  mov     eax, [esi+24]   ; @@OUT 12,6,-
  5204 000035D4 894730                                  mov     [edi+48], eax
  5205 000035D7 8B461C                                  mov     eax, [esi+28]   ; @@OUT 28,7,-
  5206 000035DA 894770                                  mov     [edi+112], eax
  5207 000035DD C3                                      retn
  5208                                  
  5209                                  
  5210                                  ; =============== S U B R O U T I N E =======================================
  5211                                  
  5212                                  
  5213                                  synth_16bit_shift_0_fast:
  5214 000035DE F605[FC8A0000]10                        test    byte [cpuid_flags], 10h ; SYNTH_MACRO 0,0,1
  5215 000035E5 740E                                    jz      short .no_rdtsc_supported
  5216 000035E7 0F31                                    rdtsc
  5217 000035E9 2905[748C0000]                          sub     [rdtsc_synth_dct], eax
  5218 000035EF 1915[788C0000]                          sbb     [rdtsc_synth_dct+4], edx
  5219                                  
  5220                                  .no_rdtsc_supported:
  5221 000035F5 BE[A8D20000]                            mov	esi, mp3_sb_samples
  5222 000035FA 8B3D[3C090100]                          mov	edi, [mp3_samples_dst]
  5223 00003600 C705[48090100]0000-                     mov	dword [mp3_curr_channel], 0
  5223 00003608 0000               
  5224                                  
  5225                                  .synth_channel_lop:
  5226 0000360A 56                                      push	esi
  5227 0000360B 57                                      push	edi
  5228 0000360C 893D[88B20000]                          mov	[mp3_curr_syn_dst], edi
  5229 00003612 C705[50090100]0000-                     mov	dword [mp3_curr_frame], 0
  5229 0000361A 0000               
  5230                                  
  5231                                  .synth_frame_lop:
  5232 0000361C 56                                      push    esi
  5233 0000361D F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
  5234 00003624 740E                                    jz      short .no_rdtsc_supported@
  5235 00003626 0F31                                    rdtsc
  5236 00003628 2905[8C8C0000]                          sub     [rdtsc_dct32], eax
  5237 0000362E 1915[908C0000]                          sbb     [rdtsc_dct32+4], edx
  5238                                  
  5239                                  .no_rdtsc_supported@:
  5240 00003634 8B15[48090100]                          mov     edx, [mp3_curr_channel]
  5241 0000363A 8B0495[A0D20000]                        mov     eax, [mp3_synth_index+edx*4]
  5242 00003641 832C95[A0D20000]20                      sub     dword [mp3_synth_index+edx*4], 32
  5243 00003649 C1E20A                                  shl     edx, 10
  5244 0000364C 25E0010000                              and     eax, 1E0h       ; 1FFh-1Fh
  5245 00003651 09D0                                    or      eax, edx
  5246 00003653 A3[84B20000]                            mov     [mp3_curr_syn_index], eax
  5247 00003658 8B3D[84B20000]                          mov     edi, [mp3_curr_syn_index]
  5248 0000365E 8D3CBD[A0B20000]                        lea     edi, [mp3_synth_buf+edi*4]
  5249 00003665 E8A3EFFFFF                              call    mp3_dct32_shift_0
  5250 0000366A F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
  5251 00003671 740E                                    jz      short .no_rdtsc_supported@@
  5252 00003673 0F31                                    rdtsc
  5253 00003675 0105[8C8C0000]                          add     [rdtsc_dct32], eax
  5254 0000367B 1115[908C0000]                          adc     [rdtsc_dct32+4], edx
  5255                                  
  5256                                  .no_rdtsc_supported@@:
  5257 00003681 F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
  5258 00003688 740E                                    jz      short .no_rdtsc_supported@@@
  5259 0000368A 0F31                                    rdtsc
  5260 0000368C 2905[A48C0000]                          sub     [rdtsc_synth], eax
  5261 00003692 1915[A88C0000]                          sbb     [rdtsc_synth+4], edx
  5262                                  
  5263                                  .no_rdtsc_supported@@@:
  5264 00003698 E888000000                              call    mp3_synth_filter_this_16bit_shift_0_fast ;
  5265                                                                          ; mp3_synth_filter_this_&force_8bit&_&rate_shift&_&force_fast
  5266 0000369D F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
  5267 000036A4 740E                                    jz      short .no_rdtsc_supported@@@@
  5268 000036A6 0F31                                    rdtsc
  5269 000036A8 0105[A48C0000]                          add     [rdtsc_synth], eax
  5270 000036AE 1115[A88C0000]                          adc     [rdtsc_synth+4], edx
  5271                                  
  5272                                  .no_rdtsc_supported@@@@:
  5273 000036B4 5E                                      pop     esi
  5274 000036B5 A1[44090100]                            mov     eax, [mp3_samples_dst_step]
  5275 000036BA C1E005                                  shl     eax, 5
  5276 000036BD 8A0D[F98A0000]                          mov     cl, [option_rate_shift]
  5277 000036C3 D3E8                                    shr     eax, cl
  5278 000036C5 0105[88B20000]                          add     [mp3_curr_syn_dst], eax
  5279 000036CB 81C680000000                            add     esi, 128        ; SBLIMIT*4
  5280 000036D1 FF05[50090100]                          inc     dword [mp3_curr_frame]
  5281 000036D7 A1[50090100]                            mov     eax, [mp3_curr_frame]
  5282 000036DC 3B05[8CB20000]                          cmp     eax, [mp3_nb_frames]
  5283 000036E2 0F8234FFFFFF                            jb      .synth_frame_lop
  5284 000036E8 5F                                      pop     edi
  5285 000036E9 5E                                      pop     esi
  5286 000036EA 033D[80B20000]                          add     edi, [mp3_bytes_per_sample]
  5287 000036F0 81C600120000                            add     esi, 4608       ; 36*SBLIMIT*4
  5288 000036F6 FF05[48090100]                          inc     dword [mp3_curr_channel]
  5289 000036FC A1[48090100]                            mov     eax, [mp3_curr_channel]
  5290 00003701 3B05[78B20000]                          cmp     eax, [mp3_output_num_channels]
  5291 00003707 0F82FDFEFFFF                            jb      .synth_channel_lop
  5292 0000370D F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
  5293 00003714 740E                                    jz      short .no_rdtsc_supported@@@@@
  5294 00003716 0F31                                    rdtsc
  5295 00003718 0105[748C0000]                          add     [rdtsc_synth_dct], eax
  5296 0000371E 1115[788C0000]                          adc     [rdtsc_synth_dct+4], edx
  5297                                  
  5298                                  .no_rdtsc_supported@@@@@:
  5299 00003724 C3                                      retn
  5300                                  
  5301                                  
  5302                                  ; =============== S U B R O U T I N E =======================================
  5303                                  
  5304                                  
  5305                                  mp3_synth_filter_this_16bit_shift_0_fast:
  5306 00003725 A1[84B20000]                            mov     eax, [mp3_curr_syn_index]
  5307 0000372A A9E0010000                              test    eax, 1E0h       ; 1FFh-1Fh
  5308 0000372F 0F849C010000                            jz      .append_copy_to_window
  5309 00003735 90                                      nop
  5310                                  
  5311                                  .append_copy_to_window_back:
  5312 00003736 89C5                                    mov     ebp, eax
  5313 00003738 81E5C0010000                            and     ebp, 1C0h       ; @win1,1FFh-1Fh-20h
  5314 0000373E 2520040000                              and     eax, 420h       ; and eax,20h+(1 shl 10) ; bit5 and channel
  5315 00003743 8D7010                                  lea     esi, [eax+10h]  ; @@syn1,[eax+10h]
  5316 00003746 8D7830                                  lea     edi, [eax+30h]  ; @@syn2,[eax+30h]
  5317 00003749 F7DD                                    neg     ebp
  5318 0000374B 81E5C0010000                            and     ebp, 1C0h       ; @win1,1FFh-1Fh-20h
  5319 00003751 8B0D[88B20000]                          mov     ecx, [mp3_curr_syn_dst] ; @@dst,dword ptr [mp3_curr_syn_dst]
  5320                                  
  5321                                  .samples_lop:
  5322 00003757 BB00200020                              mov     ebx, 20002000h  ; mov @@sum,(8000h SHL (@@out_shift))+(1 SHL (@@out_shift-1))
  5323                                                                          ; @@out_shift equ (OUT_SHIFT_fast+(8*force_8bit))
  5324                                                                          ; out_shift = 14
  5325 0000375C 8B14B5[A0B20000]                        mov     edx, [mp3_synth_buf+esi*4] ; @@SUM8 macro sum,win,ww,syn
  5326                                                                          ; @@SUM8 @@sum,@@win1,0,@@syn1
  5327                                                                          ; IRP nn,0,1,2,3,4,5,6,7
  5328                                                                          ; mov edx,dword ptr [mp3_synth_buf+syn*4+(nn*64*4)]
  5329                                                                          ; movsx eax,word ptr [mp3_synth_win+win*2+(nn*64*2)+ww*2]
  5330                                                                          ; imul eax,edx
  5331                                                                          ; add sum,eax
  5332 00003763 0FBF842D[58040500]                      movsx   eax, word [mp3_synth_win+ebp*2] ; nn=0, ww=0
  5333 0000376B 0FAFC2                                  imul    eax, edx
  5334 0000376E 01C3                                    add     ebx, eax
  5335 00003770 8B14B5[A0B30000]                        mov     edx, [(mp3_synth_buf+100h)+esi*4]
  5336 00003777 0FBF842D[D8040500]                      movsx   eax, word [(mp3_synth_win+80h)+ebp*2] ; nn=1, ww=0
  5337 0000377F 0FAFC2                                  imul    eax, edx
  5338 00003782 01C3                                    add     ebx, eax
  5339 00003784 8B14B5[A0B40000]                        mov     edx, [(mp3_synth_buf+200h)+esi*4]
  5340 0000378B 0FBF842D[58050500]                      movsx   eax, word [(mp3_synth_win+100h)+ebp*2] ; nn=2
  5341 00003793 0FAFC2                                  imul    eax, edx
  5342 00003796 01C3                                    add     ebx, eax
  5343 00003798 8B14B5[A0B50000]                        mov     edx, [(mp3_synth_buf+300h)+esi*4]
  5344 0000379F 0FBF842D[D8050500]                      movsx   eax, word [(mp3_synth_win+180h)+ebp*2] ; nn=3
  5345 000037A7 0FAFC2                                  imul    eax, edx
  5346 000037AA 01C3                                    add     ebx, eax
  5347 000037AC 8B14B5[A0B60000]                        mov     edx, [(mp3_synth_buf+400h)+esi*4]
  5348 000037B3 0FBF842D[58060500]                      movsx   eax, word [(mp3_synth_win+200h)+ebp*2] ; nn=4
  5349 000037BB 0FAFC2                                  imul    eax, edx
  5350 000037BE 01C3                                    add     ebx, eax
  5351 000037C0 8B14B5[A0B70000]                        mov     edx, [(mp3_synth_buf+500h)+esi*4]
  5352 000037C7 0FBF842D[D8060500]                      movsx   eax, word [(mp3_synth_win+280h)+ebp*2] ; nn=5
  5353 000037CF 0FAFC2                                  imul    eax, edx
  5354 000037D2 01C3                                    add     ebx, eax
  5355 000037D4 8B14B5[A0B80000]                        mov     edx, [(mp3_synth_buf+600h)+esi*4]
  5356 000037DB 0FBF842D[58070500]                      movsx   eax, word [(mp3_synth_win+300h)+ebp*2] ; nn=6
  5357 000037E3 0FAFC2                                  imul    eax, edx
  5358 000037E6 01C3                                    add     ebx, eax
  5359 000037E8 8B14B5[A0B90000]                        mov     edx, [(mp3_synth_buf+700h)+esi*4]
  5360 000037EF 0FBF842D[D8070500]                      movsx   eax, word [(mp3_synth_win+380h)+ebp*2] ; nn=7
  5361 000037F7 0FAFC2                                  imul    eax, edx
  5362 000037FA 01C3                                    add     ebx, eax
  5363 000037FC 8B14BD[A0B20000]                        mov     edx, [mp3_synth_buf+edi*4] ; @@SUM8 @@sum,@@win1,32, @@syn2
  5364 00003803 0FBF842D[98040500]                      movsx   eax, word [(mp3_synth_win+40h)+ebp*2] ; nn=0, ww=32
  5365 0000380B 0FAFC2                                  imul    eax, edx
  5366 0000380E 01C3                                    add     ebx, eax
  5367 00003810 8B14BD[A0B30000]                        mov     edx, [(mp3_synth_buf+100h)+edi*4]
  5368 00003817 0FBF842D[18050500]                      movsx   eax, word [(mp3_synth_win+0C0h)+ebp*2] ; nn=1, ww=32
  5369 0000381F 0FAFC2                                  imul    eax, edx
  5370 00003822 01C3                                    add     ebx, eax
  5371 00003824 8B14BD[A0B40000]                        mov     edx, [(mp3_synth_buf+200h)+edi*4]
  5372 0000382B 0FBF842D[98050500]                      movsx   eax, word [(mp3_synth_win+140h)+ebp*2] ; nn=2
  5373 00003833 0FAFC2                                  imul    eax, edx
  5374 00003836 01C3                                    add     ebx, eax
  5375 00003838 8B14BD[A0B50000]                        mov     edx, [(mp3_synth_buf+300h)+edi*4]
  5376 0000383F 0FBF842D[18060500]                      movsx   eax, word [(mp3_synth_win+1C0h)+ebp*2] ; nn=3
  5377 00003847 0FAFC2                                  imul    eax, edx
  5378 0000384A 01C3                                    add     ebx, eax
  5379 0000384C 8B14BD[A0B60000]                        mov     edx, [(mp3_synth_buf+400h)+edi*4]
  5380 00003853 0FBF842D[98060500]                      movsx   eax, word [(mp3_synth_win+240h)+ebp*2] ; nn=4
  5381 0000385B 0FAFC2                                  imul    eax, edx
  5382 0000385E 01C3                                    add     ebx, eax
  5383 00003860 8B14BD[A0B70000]                        mov     edx, [(mp3_synth_buf+500h)+edi*4]
  5384 00003867 0FBF842D[18070500]                      movsx   eax, word [(mp3_synth_win+2C0h)+ebp*2] ; nn=5
  5385 0000386F 0FAFC2                                  imul    eax, edx
  5386 00003872 01C3                                    add     ebx, eax
  5387 00003874 8B14BD[A0B80000]                        mov     edx, [(mp3_synth_buf+600h)+edi*4]
  5388 0000387B 0FBF842D[98070500]                      movsx   eax, word [(mp3_synth_win+340h)+ebp*2] ; nn=6
  5389 00003883 0FAFC2                                  imul    eax, edx
  5390 00003886 01C3                                    add     ebx, eax
  5391 00003888 8B14BD[A0B90000]                        mov     edx, [(mp3_synth_buf+700h)+edi*4]
  5392 0000388F 0FBF842D[18080500]                      movsx   eax, word [(mp3_synth_win+3C0h)+ebp*2] ; nn=7
  5393 00003897 0FAFC2                                  imul    eax, edx
  5394 0000389A 01C3                                    add     ebx, eax
  5395 0000389C 81FB00000040                            cmp     ebx, 40000000h  ; cmp @@sum,10000h SHL (@@out_shift) ; out_shift = 14
  5396 000038A2 7322                                    jnb     short .sat
  5397 000038A4 C1FB0E                                  sar     ebx, 14         ; sar @@sum,(@@out_shift)
  5398 000038A7 81EB00800000                            sub     ebx, 8000h      ; sub @@sum,8000h ; make 16bit signed
  5399                                  
  5400                                  .sat_back:
  5401 000038AD 668919                                  mov     [ecx], bx       ; mov word ptr [@@dst],@@sum_16bit
  5402 000038B0 030D[44090100]                          add     ecx, [mp3_samples_dst_step]
  5403 000038B6 46                                      inc     esi             ; inc @@syn1
  5404 000038B7 4F                                      dec     edi             ; dec @@syn2
  5405 000038B8 45                                      inc     ebp             ; inc @@win1
  5406 000038B9 F7C51F000000                            test    ebp, 1Fh        ; IF LONG_WINDOW
  5407 000038BF 0F8592FEFFFF                            jnz     .samples_lop   ; test @@win1,1Fh
  5408 000038C5 C3                                      retn
  5409                                  
  5410                                  .sat:
  5411 000038C6 C1FB1F                                  sar     ebx, 31         ; sar @@sum,31 ; FFFFFFFFh,00000000h
  5412 000038C9 81F3FF7F0000                            xor     ebx, 7FFFh      ; xor @@sum,7fffh ; FFFF8000h,00007FFFh (signed 16bit)
  5413 000038CF EBDC                                    jmp     short .sat_back
  5414                                  
  5415                                  .append_copy_to_window:
  5416 000038D1 8D3485[A0B20000]                        lea     esi, [mp3_synth_buf+eax*4] ; IF SYNTH32
  5417 000038D8 8DBE00080000                            lea     edi, [esi+2048] ; [esi+512*4]
  5418 000038DE B912000000                              mov     ecx, 18         ; (12h*4)/4
  5419 000038E3 F3A5                                    rep movsd
  5420 000038E5 E94CFEFFFF                              jmp     .append_copy_to_window_back
  5421                                  
  5422                                  
  5423                                  ; =============== S U B R O U T I N E =======================================
  5424                                  
  5425                                  
  5426                                  synth_16bit_shift_1_fast:
  5427 000038EA F605[FC8A0000]10                        test    byte [cpuid_flags], 10h ; SYNTH_MACRO 0,1,1
  5428 000038F1 740E                                    jz      short .no_rdtsc_supported
  5429 000038F3 0F31                                    rdtsc
  5430 000038F5 2905[748C0000]                          sub     [rdtsc_synth_dct], eax
  5431 000038FB 1915[788C0000]                          sbb     [rdtsc_synth_dct+4], edx
  5432                                  
  5433                                  .no_rdtsc_supported:
  5434 00003901 BE[A8D20000]                            mov	esi, mp3_sb_samples
  5435 00003906 8B3D[3C090100]                          mov	edi, [mp3_samples_dst]
  5436 0000390C C705[48090100]0000-                     mov	dword [mp3_curr_channel], 0
  5436 00003914 0000               
  5437                                  
  5438                                  .synth_channel_lop:
  5439 00003916 56                                      push	esi
  5440 00003917 57                                      push	edi
  5441 00003918 893D[88B20000]                          mov	[mp3_curr_syn_dst], edi
  5442 0000391E C705[50090100]0000-                     mov	dword [mp3_curr_frame], 0
  5442 00003926 0000               
  5443                                  
  5444                                  .synth_frame_lop:
  5445 00003928 56                                      push    esi
  5446 00003929 F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
  5447 00003930 740E                                    jz      short .no_rdtsc_supported@
  5448 00003932 0F31                                    rdtsc
  5449 00003934 2905[8C8C0000]                          sub     [rdtsc_dct32], eax
  5450 0000393A 1915[908C0000]                          sbb     [rdtsc_dct32+4], edx
  5451                                  
  5452                                  .no_rdtsc_supported@:
  5453 00003940 8B15[48090100]                          mov     edx, [mp3_curr_channel]
  5454 00003946 8B0495[A0D20000]                        mov     eax, [mp3_synth_index+edx*4]
  5455 0000394D 832C95[A0D20000]20                      sub	dword [mp3_synth_index+edx*4], 32
  5456 00003955 C1E20A                                  shl     edx, 10
  5457 00003958 25E0010000                              and     eax, 1E0h       ; 1FFh-1Fh
  5458 0000395D 09D0                                    or      eax, edx
  5459 0000395F A3[84B20000]                            mov     [mp3_curr_syn_index], eax
  5460 00003964 8B3D[84B20000]                          mov     edi, [mp3_curr_syn_index]
  5461 0000396A 8D3CBD[A0B20000]                        lea     edi, [mp3_synth_buf+edi*4]
  5462 00003971 E877F5FFFF                              call    mp3_dct32_shift_1 ; mp3_dct32_shift_&rate_shift
  5463 00003976 F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
  5464 0000397D 740E                                    jz      short .no_rdtsc_supported@@
  5465 0000397F 0F31                                    rdtsc
  5466 00003981 0105[8C8C0000]                          add     [rdtsc_dct32], eax
  5467 00003987 1115[908C0000]                          adc     [rdtsc_dct32+4], edx
  5468                                  
  5469                                  .no_rdtsc_supported@@:
  5470 0000398D F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
  5471 00003994 740E                                    jz      short .no_rdtsc_supported@@@
  5472 00003996 0F31                                    rdtsc
  5473 00003998 2905[A48C0000]                          sub     [rdtsc_synth], eax
  5474 0000399E 1915[A88C0000]                          sbb     [rdtsc_synth+4], edx
  5475                                  
  5476                                  .no_rdtsc_supported@@@:
  5477 000039A4 E888000000                              call    mp3_synth_filter_this_16bit_shift_1_fast ;
  5478                                                                          ; mp3_synth_filter_this_&force_8bit&_&rate_shift&_&force_fast
  5479 000039A9 F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
  5480 000039B0 740E                                    jz      short .no_rdtsc_supported@@@@
  5481 000039B2 0F31                                    rdtsc
  5482 000039B4 0105[A48C0000]                          add     [rdtsc_synth], eax
  5483 000039BA 1115[A88C0000]                          adc     [rdtsc_synth+4], edx
  5484                                  
  5485                                  .no_rdtsc_supported@@@@:
  5486 000039C0 5E                                      pop     esi
  5487 000039C1 A1[44090100]                            mov     eax, [mp3_samples_dst_step]
  5488 000039C6 C1E005                                  shl     eax, 5
  5489 000039C9 8A0D[F98A0000]                          mov     cl, [option_rate_shift]
  5490 000039CF D3E8                                    shr     eax, cl
  5491 000039D1 0105[88B20000]                          add     [mp3_curr_syn_dst], eax
  5492 000039D7 81C680000000                            add     esi, 128        ; SBLIMIT*4
  5493 000039DD FF05[50090100]                          inc     dword [mp3_curr_frame]
  5494 000039E3 A1[50090100]                            mov     eax, [mp3_curr_frame]
  5495 000039E8 3B05[8CB20000]                          cmp     eax, [mp3_nb_frames]
  5496 000039EE 0F8234FFFFFF                            jb      .synth_frame_lop
  5497 000039F4 5F                                      pop     edi
  5498 000039F5 5E                                      pop     esi
  5499 000039F6 033D[80B20000]                          add     edi, [mp3_bytes_per_sample]
  5500 000039FC 81C600120000                            add     esi, 4608       ; 36*SBLIMIT*4
  5501 00003A02 FF05[48090100]                          inc     dword [mp3_curr_channel]
  5502 00003A08 A1[48090100]                            mov     eax, [mp3_curr_channel]
  5503 00003A0D 3B05[78B20000]                          cmp     eax, [mp3_output_num_channels]
  5504 00003A13 0F82FDFEFFFF                            jb      .synth_channel_lop
  5505 00003A19 F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
  5506 00003A20 740E                                    jz      short .no_rdtsc_supported@@@@@
  5507 00003A22 0F31                                    rdtsc
  5508 00003A24 0105[748C0000]                          add     [rdtsc_synth_dct], eax
  5509 00003A2A 1115[788C0000]                          adc     [rdtsc_synth_dct+4], edx
  5510                                  
  5511                                  .no_rdtsc_supported@@@@@:
  5512 00003A30 C3                                      retn
  5513                                  
  5514                                  
  5515                                  ; =============== S U B R O U T I N E =======================================
  5516                                  
  5517                                  
  5518                                  mp3_synth_filter_this_16bit_shift_1_fast:
  5519 00003A31 A1[84B20000]                            mov     eax, [mp3_curr_syn_index]
  5520 00003A36 A9E0010000                              test    eax, 1E0h       ; 1FFh-1Fh
  5521 00003A3B 0F84A2010000                            jz      .append_copy_to_window
  5522 00003A41 90                                      nop
  5523                                  
  5524                                  .append_copy_to_window_back:
  5525 00003A42 89C5                                    mov     ebp, eax
  5526 00003A44 81E5C0010000                            and     ebp, 1C0h
  5527 00003A4A 2520040000                              and     eax, 420h
  5528 00003A4F 8D7010                                  lea     esi, [eax+10h]
  5529 00003A52 8D7830                                  lea     edi, [eax+30h]
  5530 00003A55 F7DD                                    neg     ebp
  5531 00003A57 81E5C0010000                            and     ebp, 1C0h
  5532 00003A5D 8B0D[88B20000]                          mov     ecx, [mp3_curr_syn_dst]
  5533                                  
  5534                                  .samples_lop:
  5535 00003A63 BB00200020                              mov     ebx, 20002000h  ; mov @@sum,(8000h SHL (@@out_shift))+(1 SHL (@@out_shift-1))
  5536                                                                          ; @@out_shift equ (OUT_SHIFT_fast+(8*force_8bit))
  5537                                                                          ; out_shift = 14
  5538 00003A68 8B14B5[A0B20000]                        mov     edx, [mp3_synth_buf+esi*4] ; @@SUM8 macro sum,win,ww,syn
  5539                                                                          ; @@SUM8 @@sum,@@win1,0,@@syn1
  5540                                                                          ; IRP nn,0,1,2,3,4,5,6,7
  5541                                                                          ; mov edx,dword ptr [mp3_synth_buf+syn*4+(nn*64*4)]
  5542                                                                          ; movsx eax,word ptr [mp3_synth_win+win*2+(nn*64*2)+ww*2]
  5543                                                                          ; imul eax,edx
  5544                                                                          ; add sum,eax
  5545 00003A6F 0FBF842D[58040500]                      movsx   eax, word [mp3_synth_win+ebp*2]
  5546 00003A77 0FAFC2                                  imul    eax, edx
  5547 00003A7A 01C3                                    add     ebx, eax
  5548 00003A7C 8B14B5[A0B30000]                        mov     edx, [(mp3_synth_buf+100h)+esi*4] ; nn=1
  5549 00003A83 0FBF842D[D8040500]                      movsx   eax, word [(mp3_synth_win+80h)+ebp*2] ; ww=0
  5550 00003A8B 0FAFC2                                  imul    eax, edx
  5551 00003A8E 01C3                                    add     ebx, eax
  5552 00003A90 8B14B5[A0B40000]                        mov     edx, [(mp3_synth_buf+200h)+esi*4]
  5553 00003A97 0FBF842D[58050500]                      movsx   eax, word [(mp3_synth_win+100h)+ebp*2]
  5554 00003A9F 0FAFC2                                  imul    eax, edx
  5555 00003AA2 01C3                                    add     ebx, eax
  5556 00003AA4 8B14B5[A0B50000]                        mov     edx, [(mp3_synth_buf+300h)+esi*4]
  5557 00003AAB 0FBF842D[D8050500]                      movsx   eax, word [(mp3_synth_win+180h)+ebp*2]
  5558 00003AB3 0FAFC2                                  imul    eax, edx
  5559 00003AB6 01C3                                    add     ebx, eax
  5560 00003AB8 8B14B5[A0B60000]                        mov     edx, [(mp3_synth_buf+400h)+esi*4] ; nn=4
  5561 00003ABF 0FBF842D[58060500]                      movsx   eax, word [(mp3_synth_win+200h)+ebp*2]
  5562 00003AC7 0FAFC2                                  imul    eax, edx
  5563 00003ACA 01C3                                    add     ebx, eax
  5564 00003ACC 8B14B5[A0B70000]                        mov     edx, [(mp3_synth_buf+500h)+esi*4]
  5565 00003AD3 0FBF842D[D8060500]                      movsx   eax, word [(mp3_synth_win+280h)+ebp*2]
  5566 00003ADB 0FAFC2                                  imul    eax, edx
  5567 00003ADE 01C3                                    add     ebx, eax
  5568 00003AE0 8B14B5[A0B80000]                        mov     edx, [(mp3_synth_buf+600h)+esi*4]
  5569 00003AE7 0FBF842D[58070500]                      movsx   eax, word [(mp3_synth_win+300h)+ebp*2]
  5570 00003AEF 0FAFC2                                  imul    eax, edx
  5571 00003AF2 01C3                                    add     ebx, eax
  5572 00003AF4 8B14B5[A0B90000]                        mov     edx, [(mp3_synth_buf+700h)+esi*4] ; nn=7
  5573 00003AFB 0FBF842D[D8070500]                      movsx   eax, word [(mp3_synth_win+380h)+ebp*2] ; ww=0
  5574 00003B03 0FAFC2                                  imul    eax, edx
  5575 00003B06 01C3                                    add     ebx, eax
  5576 00003B08 8B14BD[A0B20000]                        mov     edx, [mp3_synth_buf+edi*4]
  5577 00003B0F 0FBF842D[98040500]                      movsx   eax, word [(mp3_synth_win+40h)+ebp*2]
  5578 00003B17 0FAFC2                                  imul    eax, edx
  5579 00003B1A 01C3                                    add     ebx, eax
  5580 00003B1C 8B14BD[A0B30000]                        mov     edx, [(mp3_synth_buf+100h)+edi*4]
  5581 00003B23 0FBF842D[18050500]                      movsx   eax, word [(mp3_synth_win+0C0h)+ebp*2]
  5582 00003B2B 0FAFC2                                  imul    eax, edx
  5583 00003B2E 01C3                                    add     ebx, eax
  5584 00003B30 8B14BD[A0B40000]                        mov     edx, [(mp3_synth_buf+200h)+edi*4] ; nn=2, ww=32
  5585 00003B37 0FBF842D[98050500]                      movsx   eax, word [(mp3_synth_win+140h)+ebp*2]
  5586 00003B3F 0FAFC2                                  imul    eax, edx
  5587 00003B42 01C3                                    add     ebx, eax
  5588 00003B44 8B14BD[A0B50000]                        mov     edx, [(mp3_synth_buf+300h)+edi*4]
  5589 00003B4B 0FBF842D[18060500]                      movsx   eax, word [(mp3_synth_win+1C0h)+ebp*2]
  5590 00003B53 0FAFC2                                  imul    eax, edx
  5591 00003B56 01C3                                    add     ebx, eax
  5592 00003B58 8B14BD[A0B60000]                        mov     edx, [(mp3_synth_buf+400h)+edi*4]
  5593 00003B5F 0FBF842D[98060500]                      movsx   eax, word [(mp3_synth_win+240h)+ebp*2]
  5594 00003B67 0FAFC2                                  imul    eax, edx
  5595 00003B6A 01C3                                    add     ebx, eax
  5596 00003B6C 8B14BD[A0B70000]                        mov     edx, [(mp3_synth_buf+500h)+edi*4]
  5597 00003B73 0FBF842D[18070500]                      movsx   eax, word [(mp3_synth_win+2C0h)+ebp*2]
  5598 00003B7B 0FAFC2                                  imul    eax, edx
  5599 00003B7E 01C3                                    add     ebx, eax
  5600 00003B80 8B14BD[A0B80000]                        mov     edx, [(mp3_synth_buf+600h)+edi*4] ; nn=6, ww=32
  5601 00003B87 0FBF842D[98070500]                      movsx   eax, word [(mp3_synth_win+340h)+ebp*2]
  5602 00003B8F 0FAFC2                                  imul    eax, edx
  5603 00003B92 01C3                                    add     ebx, eax
  5604 00003B94 8B14BD[A0B90000]                        mov     edx, [(mp3_synth_buf+700h)+edi*4]
  5605 00003B9B 0FBF842D[18080500]                      movsx   eax, word [(mp3_synth_win+3C0h)+ebp*2]
  5606 00003BA3 0FAFC2                                  imul    eax, edx
  5607 00003BA6 01C3                                    add     ebx, eax
  5608 00003BA8 81FB00000040                            cmp     ebx, 40000000h  ; cmp  @@sum,10000h SHL (@@out_shift)
  5609 00003BAE 7328                                    jnb     short .sat
  5610 00003BB0 C1FB0E                                  sar     ebx, 14         ; sar @@sum,(@@out_shift)
  5611 00003BB3 81EB00800000                            sub     ebx, 8000h      ; make 16bit signed
  5612                                  
  5613                                  .sat_back:
  5614 00003BB9 668919                                  mov     [ecx], bx
  5615 00003BBC 030D[44090100]                          add     ecx, [mp3_samples_dst_step]
  5616 00003BC2 83C602                                  add     esi, 2          ; IF rate_shift
  5617                                                                          ; add  @@syn1,1 shl rate_shift
  5618 00003BC5 83EF02                                  sub     edi, 2          ; sub @@syn2,1 shl rate_shift
  5619 00003BC8 83C502                                  add     ebp, 2          ; add @@win1,1 shl rate_shift
  5620 00003BCB F7C51F000000                            test    ebp, 1Fh        ; IF LONG_WINDOW
  5621 00003BD1 0F858CFEFFFF                            jnz     .samples_lop   ; test @@win1,1fh
  5622 00003BD7 C3                                      retn
  5623                                  
  5624                                  .sat:
  5625 00003BD8 C1FB1F                                  sar     ebx, 31         ; sar @@sum,31 ; FFFFFFFFh,00000000h
  5626 00003BDB 81F3FF7F0000                            xor     ebx, 7FFFh      ; xor @@sum,7fffh ; FFFF8000h,00007FFFh (signed 16bit)
  5627 00003BE1 EBD6                                    jmp     short .sat_back
  5628                                  
  5629                                  .append_copy_to_window:
  5630 00003BE3 8D3485[A0B20000]                        lea     esi, [mp3_synth_buf+eax*4]
  5631 00003BEA 8DBE00080000                            lea     edi, [esi+2048] ; [esi+512*4]
  5632 00003BF0 B912000000                              mov     ecx, 18         ; (12h*4)/4
  5633 00003BF5 F3A5                                    rep movsd
  5634 00003BF7 E946FEFFFF                              jmp     .append_copy_to_window_back
  5635                                  
  5636                                  
  5637                                  ; =============== S U B R O U T I N E =======================================
  5638                                  
  5639                                  
  5640                                  synth_16bit_shift_2_fast:
  5641 00003BFC F605[FC8A0000]10                        test    byte [cpuid_flags], 10h ; SYNTH_MACRO 0,2,1
  5642 00003C03 740E                                    jz      short .no_rdtsc_supported
  5643 00003C05 0F31                                    rdtsc
  5644 00003C07 2905[748C0000]                          sub     [rdtsc_synth_dct], eax
  5645 00003C0D 1915[788C0000]                          sbb     [rdtsc_synth_dct+4], edx
  5646                                  
  5647                                  .no_rdtsc_supported:
  5648 00003C13 BE[A8D20000]                            mov	esi, mp3_sb_samples
  5649 00003C18 8B3D[3C090100]                          mov	edi, [mp3_samples_dst]
  5650 00003C1E C705[48090100]0000-                     mov	dword [mp3_curr_channel], 0
  5650 00003C26 0000               
  5651                                  
  5652                                  .synth_channel_lop:
  5653 00003C28 56                                      push	esi
  5654 00003C29 57                                      push	edi
  5655 00003C2A 893D[88B20000]                          mov	[mp3_curr_syn_dst], edi
  5656 00003C30 C705[50090100]0000-                     mov	dword [mp3_curr_frame], 0
  5656 00003C38 0000               
  5657                                  
  5658                                  .synth_frame_lop:
  5659 00003C3A 56                                      push    esi
  5660 00003C3B F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
  5661 00003C42 740E                                    jz      short .no_rdtsc_supported@
  5662 00003C44 0F31                                    rdtsc
  5663 00003C46 2905[8C8C0000]                          sub     [rdtsc_dct32], eax
  5664 00003C4C 1915[908C0000]                          sbb     [rdtsc_dct32+4], edx
  5665                                  
  5666                                  .no_rdtsc_supported@:
  5667 00003C52 8B15[48090100]                          mov     edx, [mp3_curr_channel]
  5668 00003C58 8B0495[A0D20000]                        mov     eax, [mp3_synth_index+edx*4]
  5669 00003C5F 832C95[A0D20000]20                      sub     dword [mp3_synth_index+edx*4], 32
  5670 00003C67 C1E20A                                  shl     edx, 10
  5671 00003C6A 25E0010000                              and     eax, 1E0h       ; 1FFh-1Fh
  5672 00003C6F 09D0                                    or      eax, edx
  5673 00003C71 A3[84B20000]                            mov     [mp3_curr_syn_index], eax
  5674 00003C76 8B3D[84B20000]                          mov     edi, [mp3_curr_syn_index]
  5675 00003C7C 8D3CBD[A0B20000]                        lea     edi, [mp3_synth_buf+edi*4]
  5676 00003C83 E855F6FFFF                              call    mp3_dct32_shift_2 ; mp3_dct32_shift_&rate_shift
  5677 00003C88 F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
  5678 00003C8F 740E                                    jz      short .no_rdtsc_supported@@
  5679 00003C91 0F31                                    rdtsc
  5680 00003C93 0105[8C8C0000]                          add     [rdtsc_dct32], eax
  5681 00003C99 1115[908C0000]                          adc     [rdtsc_dct32+4], edx
  5682                                  
  5683                                  .no_rdtsc_supported@@:
  5684 00003C9F F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
  5685 00003CA6 740E                                    jz      short .no_rdtsc_supported@@@
  5686 00003CA8 0F31                                    rdtsc
  5687 00003CAA 2905[A48C0000]                          sub     [rdtsc_synth], eax
  5688 00003CB0 1915[A88C0000]                          sbb     [rdtsc_synth+4], edx
  5689                                  
  5690                                  .no_rdtsc_supported@@@:
  5691 00003CB6 E888000000                              call    mp3_synth_filter_this_16bit_shift_2_fast ;
  5692                                                                          ; mp3_synth_filter_this_&force_8bit&_&rate_shift&_&force_fas
  5693 00003CBB F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
  5694 00003CC2 740E                                    jz      short .no_rdtsc_supported@@@@
  5695 00003CC4 0F31                                    rdtsc
  5696 00003CC6 0105[A48C0000]                          add     [rdtsc_synth], eax
  5697 00003CCC 1115[A88C0000]                          adc     [rdtsc_synth+4], edx
  5698                                  
  5699                                  .no_rdtsc_supported@@@@:
  5700 00003CD2 5E                                      pop     esi
  5701 00003CD3 A1[44090100]                            mov     eax, [mp3_samples_dst_step]
  5702 00003CD8 C1E005                                  shl     eax, 5
  5703 00003CDB 8A0D[F98A0000]                          mov     cl, [option_rate_shift]
  5704 00003CE1 D3E8                                    shr     eax, cl
  5705 00003CE3 0105[88B20000]                          add     [mp3_curr_syn_dst], eax
  5706 00003CE9 81C680000000                            add     esi, 128        ; SBLIMIT*4
  5707 00003CEF FF05[50090100]                          inc     dword [mp3_curr_frame]
  5708 00003CF5 A1[50090100]                            mov     eax, [mp3_curr_frame]
  5709 00003CFA 3B05[8CB20000]                          cmp     eax, [mp3_nb_frames]
  5710 00003D00 0F8234FFFFFF                            jb      .synth_frame_lop
  5711 00003D06 5F                                      pop     edi
  5712 00003D07 5E                                      pop     esi
  5713 00003D08 033D[80B20000]                          add     edi, [mp3_bytes_per_sample]
  5714 00003D0E 81C600120000                            add     esi, 4608       ; 36*SBLIMIT*4
  5715 00003D14 FF05[48090100]                          inc     dword [mp3_curr_channel]
  5716 00003D1A A1[48090100]                            mov     eax, [mp3_curr_channel]
  5717 00003D1F 3B05[78B20000]                          cmp     eax, [mp3_output_num_channels]
  5718 00003D25 0F82FDFEFFFF                            jb      .synth_channel_lop
  5719 00003D2B F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
  5720 00003D32 740E                                    jz      short .no_rdtsc_supported@@@@@
  5721 00003D34 0F31                                    rdtsc
  5722 00003D36 0105[748C0000]                          add     [rdtsc_synth_dct], eax
  5723 00003D3C 1115[788C0000]                          adc     [rdtsc_synth_dct+4], edx
  5724                                  
  5725                                  .no_rdtsc_supported@@@@@:
  5726 00003D42 C3                                      retn
  5727                                  
  5728                                  
  5729                                  ; =============== S U B R O U T I N E =======================================
  5730                                  
  5731                                  
  5732                                  mp3_synth_filter_this_16bit_shift_2_fast:
  5733 00003D43 A1[84B20000]                            mov     eax, [mp3_curr_syn_index]
  5734 00003D48 A9E0010000                              test    eax, 1E0h       ; 1FFh-1Fh
  5735 00003D4D 0F84A2010000                            jz      .append_copy_to_window
  5736 00003D53 90                                      nop
  5737                                  
  5738                                  .append_copy_to_window_back:
  5739 00003D54 89C5                                    mov     ebp, eax
  5740 00003D56 81E5C0010000                            and     ebp, 1C0h       ; 1FFh-1Fh-20h
  5741 00003D5C 2520040000                              and     eax, 420h       ; 20h+(1 shl 10)
  5742 00003D61 8D7010                                  lea     esi, [eax+10h]
  5743 00003D64 8D7830                                  lea     edi, [eax+30h]
  5744 00003D67 F7DD                                    neg     ebp
  5745 00003D69 81E5C0010000                            and     ebp, 1C0h
  5746 00003D6F 8B0D[88B20000]                          mov     ecx, [mp3_curr_syn_dst]
  5747                                  
  5748                                  .samples_lop:
  5749 00003D75 BB00200020                              mov     ebx, 20002000h  ; mov @@sum,(8000h SHL (@@out_shift))+(1 SHL (@@out_shift-1))
  5750                                                                          ; @@out_shift equ (OUT_SHIFT_fast+(8*force_8bit))
  5751                                                                          ; out_shift = 14
  5752 00003D7A 8B14B5[A0B20000]                        mov     edx, [mp3_synth_buf+esi*4]
  5753 00003D81 0FBF842D[58040500]                      movsx   eax, word [mp3_synth_win+ebp*2]
  5754 00003D89 0FAFC2                                  imul    eax, edx
  5755 00003D8C 01C3                                    add     ebx, eax
  5756 00003D8E 8B14B5[A0B30000]                        mov     edx, [(mp3_synth_buf+100h)+esi*4]
  5757 00003D95 0FBF842D[D8040500]                      movsx   eax, word [(mp3_synth_win+80h)+ebp*2]
  5758 00003D9D 0FAFC2                                  imul    eax, edx
  5759 00003DA0 01C3                                    add     ebx, eax
  5760 00003DA2 8B14B5[A0B40000]                        mov     edx, [(mp3_synth_buf+200h)+esi*4]
  5761 00003DA9 0FBF842D[58050500]                      movsx   eax, word [(mp3_synth_win+100h)+ebp*2]
  5762 00003DB1 0FAFC2                                  imul    eax, edx
  5763 00003DB4 01C3                                    add     ebx, eax
  5764 00003DB6 8B14B5[A0B50000]                        mov     edx, [(mp3_synth_buf+300h)+esi*4]
  5765 00003DBD 0FBF842D[D8050500]                      movsx   eax, word [(mp3_synth_win+180h)+ebp*2]
  5766 00003DC5 0FAFC2                                  imul    eax, edx
  5767 00003DC8 01C3                                    add     ebx, eax
  5768 00003DCA 8B14B5[A0B60000]                        mov     edx, [(mp3_synth_buf+400h)+esi*4]
  5769 00003DD1 0FBF842D[58060500]                      movsx   eax, word [(mp3_synth_win+200h)+ebp*2]
  5770 00003DD9 0FAFC2                                  imul    eax, edx
  5771 00003DDC 01C3                                    add     ebx, eax
  5772 00003DDE 8B14B5[A0B70000]                        mov     edx, [(mp3_synth_buf+500h)+esi*4]
  5773 00003DE5 0FBF842D[D8060500]                      movsx   eax, word [(mp3_synth_win+280h)+ebp*2]
  5774 00003DED 0FAFC2                                  imul    eax, edx
  5775 00003DF0 01C3                                    add     ebx, eax
  5776 00003DF2 8B14B5[A0B80000]                        mov     edx, [(mp3_synth_buf+600h)+esi*4]
  5777 00003DF9 0FBF842D[58070500]                      movsx   eax, word [(mp3_synth_win+300h)+ebp*2]
  5778 00003E01 0FAFC2                                  imul    eax, edx
  5779 00003E04 01C3                                    add     ebx, eax
  5780 00003E06 8B14B5[A0B90000]                        mov     edx, [(mp3_synth_buf+700h)+esi*4]
  5781 00003E0D 0FBF842D[D8070500]                      movsx   eax, word [(mp3_synth_win+380h)+ebp*2]
  5782 00003E15 0FAFC2                                  imul    eax, edx
  5783 00003E18 01C3                                    add     ebx, eax
  5784 00003E1A 8B14BD[A0B20000]                        mov     edx, [mp3_synth_buf+edi*4]
  5785 00003E21 0FBF842D[98040500]                      movsx   eax, word [(mp3_synth_win+40h)+ebp*2]
  5786 00003E29 0FAFC2                                  imul    eax, edx
  5787 00003E2C 01C3                                    add     ebx, eax
  5788 00003E2E 8B14BD[A0B30000]                        mov     edx, [(mp3_synth_buf+100h)+edi*4]
  5789 00003E35 0FBF842D[18050500]                      movsx   eax, word [(mp3_synth_win+0C0h)+ebp*2]
  5790 00003E3D 0FAFC2                                  imul    eax, edx
  5791 00003E40 01C3                                    add     ebx, eax
  5792 00003E42 8B14BD[A0B40000]                        mov     edx, [(mp3_synth_buf+200h)+edi*4]
  5793 00003E49 0FBF842D[98050500]                      movsx   eax, word [(mp3_synth_win+140h)+ebp*2]
  5794 00003E51 0FAFC2                                  imul    eax, edx
  5795 00003E54 01C3                                    add     ebx, eax
  5796 00003E56 8B14BD[A0B50000]                        mov     edx, [(mp3_synth_buf+300h)+edi*4]
  5797 00003E5D 0FBF842D[18060500]                      movsx   eax, word [(mp3_synth_win+1C0h)+ebp*2]
  5798 00003E65 0FAFC2                                  imul    eax, edx
  5799 00003E68 01C3                                    add     ebx, eax
  5800 00003E6A 8B14BD[A0B60000]                        mov     edx, [(mp3_synth_buf+400h)+edi*4]
  5801 00003E71 0FBF842D[98060500]                      movsx   eax, word [(mp3_synth_win+240h)+ebp*2]
  5802 00003E79 0FAFC2                                  imul    eax, edx
  5803 00003E7C 01C3                                    add     ebx, eax
  5804 00003E7E 8B14BD[A0B70000]                        mov     edx, [(mp3_synth_buf+500h)+edi*4]
  5805 00003E85 0FBF842D[18070500]                      movsx   eax, word [(mp3_synth_win+2C0h)+ebp*2]
  5806 00003E8D 0FAFC2                                  imul    eax, edx
  5807 00003E90 01C3                                    add     ebx, eax
  5808 00003E92 8B14BD[A0B80000]                        mov     edx, [(mp3_synth_buf+600h)+edi*4]
  5809 00003E99 0FBF842D[98070500]                      movsx   eax, word [(mp3_synth_win+340h)+ebp*2]
  5810 00003EA1 0FAFC2                                  imul    eax, edx
  5811 00003EA4 01C3                                    add     ebx, eax
  5812 00003EA6 8B14BD[A0B90000]                        mov     edx, [(mp3_synth_buf+700h)+edi*4]
  5813 00003EAD 0FBF842D[18080500]                      movsx   eax, word [(mp3_synth_win+3C0h)+ebp*2]
  5814 00003EB5 0FAFC2                                  imul    eax, edx
  5815 00003EB8 01C3                                    add     ebx, eax
  5816 00003EBA 81FB00000040                            cmp     ebx, 40000000h
  5817 00003EC0 7328                                    jnb     short .sat
  5818 00003EC2 C1FB0E                                  sar     ebx, 14
  5819 00003EC5 81EB00800000                            sub     ebx, 8000h      ; make 16bit signed
  5820                                  
  5821                                  .sat_back:
  5822 00003ECB 668919                                  mov     [ecx], bx
  5823 00003ECE 030D[44090100]                          add     ecx, [mp3_samples_dst_step]
  5824 00003ED4 83C604                                  add     esi, 4
  5825 00003ED7 83EF04                                  sub     edi, 4
  5826 00003EDA 83C504                                  add     ebp, 4
  5827 00003EDD F7C51F000000                            test    ebp, 1Fh
  5828 00003EE3 0F858CFEFFFF                            jnz     .samples_lop
  5829 00003EE9 C3                                      retn
  5830                                  
  5831                                  .sat:
  5832 00003EEA C1FB1F                                  sar     ebx, 31
  5833 00003EED 81F3FF7F0000                            xor     ebx, 7FFFh
  5834 00003EF3 EBD6                                    jmp     short .sat_back
  5835                                  
  5836                                  .append_copy_to_window:
  5837 00003EF5 8D3485[A0B20000]                        lea     esi, [mp3_synth_buf+eax*4]
  5838 00003EFC 8DBE00080000                            lea     edi, [esi+2048]
  5839 00003F02 B912000000                              mov     ecx, 18
  5840 00003F07 F3A5                                    rep movsd
  5841 00003F09 E946FEFFFF                              jmp     .append_copy_to_window_back
  5842                                  
  5843                                  
  5844                                  ; =============== S U B R O U T I N E =======================================
  5845                                  
  5846                                  
  5847                                  synth_8bit_shift_0_fast:
  5848 00003F0E F605[FC8A0000]10                        test    byte [cpuid_flags], 10h ; SYNTH_MACRO 1,0,1
  5849 00003F15 740E                                    jz      short .no_rdtsc_supported
  5850 00003F17 0F31                                    rdtsc
  5851 00003F19 2905[748C0000]                          sub     [rdtsc_synth_dct], eax
  5852 00003F1F 1915[788C0000]                          sbb     [rdtsc_synth_dct+4], edx
  5853                                  
  5854                                  .no_rdtsc_supported:
  5855 00003F25 BE[A8D20000]                            mov	esi, mp3_sb_samples
  5856 00003F2A 8B3D[3C090100]                          mov	edi, [mp3_samples_dst]
  5857 00003F30 C705[48090100]0000-                     mov	dword [mp3_curr_channel], 0
  5857 00003F38 0000               
  5858                                  
  5859                                  .synth_channel_lop:
  5860 00003F3A 56                                      push	esi
  5861 00003F3B 57                                      push	edi
  5862 00003F3C 893D[88B20000]                          mov	[mp3_curr_syn_dst], edi
  5863 00003F42 C705[50090100]0000-                     mov	dword [mp3_curr_frame], 0
  5863 00003F4A 0000               
  5864                                  
  5865                                  .synth_frame_lop:
  5866 00003F4C 56                                      push    esi
  5867 00003F4D F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
  5868 00003F54 740E                                    jz      short .no_rdtsc_supported@
  5869 00003F56 0F31                                    rdtsc
  5870 00003F58 2905[8C8C0000]                          sub     [rdtsc_dct32], eax
  5871 00003F5E 1915[908C0000]                          sbb     [rdtsc_dct32+4], edx
  5872                                  
  5873                                  .no_rdtsc_supported@:
  5874 00003F64 8B15[48090100]                          mov     edx, [mp3_curr_channel]
  5875 00003F6A 8B0495[A0D20000]                        mov     eax, [mp3_synth_index+edx*4]
  5876 00003F71 832C95[A0D20000]20                      sub     dword [mp3_synth_index+edx*4], 32
  5877 00003F79 C1E20A                                  shl     edx, 10
  5878 00003F7C 25E0010000                              and     eax, 1E0h       ; 1FFh-1Fh
  5879 00003F81 09D0                                    or      eax, edx
  5880 00003F83 A3[84B20000]                            mov     [mp3_curr_syn_index], eax
  5881 00003F88 8B3D[84B20000]                          mov     edi, [mp3_curr_syn_index]
  5882 00003F8E 8D3CBD[A0B20000]                        lea     edi, [mp3_synth_buf+edi*4]
  5883 00003F95 E873E6FFFF                              call    mp3_dct32_shift_0 ; mp3_dct32_shift_&rate_shift
  5884 00003F9A F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
  5885 00003FA1 740E                                    jz      short .no_rdtsc_supported@@
  5886 00003FA3 0F31                                    rdtsc
  5887 00003FA5 0105[8C8C0000]                          add     [rdtsc_dct32], eax
  5888 00003FAB 1115[908C0000]                          adc     [rdtsc_dct32+4], edx
  5889                                  
  5890                                  .no_rdtsc_supported@@:
  5891 00003FB1 F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
  5892 00003FB8 740E                                    jz      short .no_rdtsc_supported@@@
  5893 00003FBA 0F31                                    rdtsc
  5894 00003FBC 2905[A48C0000]                          sub     [rdtsc_synth], eax
  5895 00003FC2 1915[A88C0000]                          sbb     [rdtsc_synth+4], edx
  5896                                  
  5897                                  .no_rdtsc_supported@@@:
  5898 00003FC8 E888000000                              call    mp3_synth_filter_this_8bit_shift_0_fast ;
  5899                                                                          ; mp3_synth_filter_this_&force_8bit&_&rate_shift&_&force_fast
  5900 00003FCD F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
  5901 00003FD4 740E                                    jz      short .no_rdtsc_supported@@@@
  5902 00003FD6 0F31                                    rdtsc
  5903 00003FD8 0105[A48C0000]                          add     [rdtsc_synth], eax
  5904 00003FDE 1115[A88C0000]                          adc     [rdtsc_synth+4], edx
  5905                                  
  5906                                  .no_rdtsc_supported@@@@:
  5907 00003FE4 5E                                      pop     esi
  5908 00003FE5 A1[44090100]                            mov     eax, [mp3_samples_dst_step]
  5909 00003FEA C1E005                                  shl     eax, 5
  5910 00003FED 8A0D[F98A0000]                          mov     cl, [option_rate_shift]
  5911 00003FF3 D3E8                                    shr     eax, cl
  5912 00003FF5 0105[88B20000]                          add     [mp3_curr_syn_dst], eax
  5913 00003FFB 81C680000000                            add     esi, 128        ; SBLIMIT*4
  5914 00004001 FF05[50090100]                          inc     dword [mp3_curr_frame]
  5915 00004007 A1[50090100]                            mov     eax, [mp3_curr_frame]
  5916 0000400C 3B05[8CB20000]                          cmp     eax, [mp3_nb_frames]
  5917 00004012 0F8234FFFFFF                            jb      .synth_frame_lop
  5918 00004018 5F                                      pop     edi
  5919 00004019 5E                                      pop     esi
  5920 0000401A 033D[80B20000]                          add     edi, [mp3_bytes_per_sample]
  5921 00004020 81C600120000                            add     esi, 4608       ; 36*SBLIMIT*4
  5922 00004026 FF05[48090100]                          inc     dword [mp3_curr_channel]
  5923 0000402C A1[48090100]                            mov     eax, [mp3_curr_channel]
  5924 00004031 3B05[78B20000]                          cmp     eax, [mp3_output_num_channels]
  5925 00004037 0F82FDFEFFFF                            jb      .synth_channel_lop
  5926 0000403D F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
  5927 00004044 740E                                    jz      short .no_rdtsc_supported@@@@@
  5928 00004046 0F31                                    rdtsc
  5929 00004048 0105[748C0000]                          add     [rdtsc_synth_dct], eax
  5930 0000404E 1115[788C0000]                          adc     [rdtsc_synth_dct+4], edx
  5931                                  
  5932                                  .no_rdtsc_supported@@@@@:
  5933 00004054 C3                                      retn
  5934                                  
  5935                                  
  5936                                  ; =============== S U B R O U T I N E =======================================
  5937                                  
  5938                                  
  5939                                  mp3_synth_filter_this_8bit_shift_0_fast:
  5940 00004055 A1[84B20000]                            mov     eax, [mp3_curr_syn_index]
  5941 0000405A A9E0010000                              test    eax, 1E0h       ; 1FFh-1Fh
  5942 0000405F 0F8491010000                            jz      .append_copy_to_window
  5943 00004065 90                                      nop
  5944                                  
  5945                                  .append_copy_to_window_back:
  5946 00004066 89C5                                    mov     ebp, eax
  5947 00004068 81E5C0010000                            and     ebp, 1C0h       ; 1FFh-1Fh-20h
  5948 0000406E 2520040000                              and     eax, 420h       ; 20h+(1 shl 10)
  5949 00004073 8D7010                                  lea     esi, [eax+10h]
  5950 00004076 8D7830                                  lea     edi, [eax+30h]
  5951 00004079 F7DD                                    neg     ebp
  5952 0000407B 81E5C0010000                            and     ebp, 1C0h
  5953 00004081 8B0D[88B20000]                          mov     ecx, [mp3_curr_syn_dst]
  5954                                  
  5955                                  .samples_lop:
  5956 00004087 BB00002020                              mov     ebx, 20200000h  ; mov @@sum,(80h SHL (@@out_shift))+(1 SHL (@@out_shift-1))
  5957                                                                          ; @@out_shift equ (OUT_SHIFT_fast(8*force_8bit))
  5958                                                                          ; @@out_shift = 22
  5959 0000408C 8B14B5[A0B20000]                        mov     edx, [mp3_synth_buf+esi*4] ; @@SUM8 macro sum,win,ww,syn
  5960                                                                          ; @@SUM8 @@sum,@@win1,0,@@syn1
  5961                                                                          ; IRP nn,0,1,2,3,4,5,6,7
  5962                                                                          ; mov edx,dword ptr [mp3_synth_buf+syn*4+(nn*64*4)]
  5963                                                                          ; movsx eax,word ptr [mp3_synth_win+win*2+(nn*64*2)+ww*2]
  5964                                                                          ; imul eax,edx
  5965                                                                          ; add sum,eax
  5966 00004093 0FBF842D[58040500]                      movsx   eax, word [mp3_synth_win+ebp*2]
  5967 0000409B 0FAFC2                                  imul    eax, edx
  5968 0000409E 01C3                                    add     ebx, eax
  5969 000040A0 8B14B5[A0B30000]                        mov     edx, [(mp3_synth_buf+100h)+esi*4] ; nn=1
  5970 000040A7 0FBF842D[D8040500]                      movsx   eax, word [(mp3_synth_win+80h)+ebp*2] ; ww=0
  5971 000040AF 0FAFC2                                  imul    eax, edx
  5972 000040B2 01C3                                    add     ebx, eax
  5973 000040B4 8B14B5[A0B40000]                        mov     edx, [(mp3_synth_buf+200h)+esi*4]
  5974 000040BB 0FBF842D[58050500]                      movsx   eax, word [(mp3_synth_win+100h)+ebp*2]
  5975 000040C3 0FAFC2                                  imul    eax, edx
  5976 000040C6 01C3                                    add     ebx, eax
  5977 000040C8 8B14B5[A0B50000]                        mov     edx, [(mp3_synth_buf+300h)+esi*4]
  5978 000040CF 0FBF842D[D8050500]                      movsx   eax, word [(mp3_synth_win+180h)+ebp*2]
  5979 000040D7 0FAFC2                                  imul    eax, edx
  5980 000040DA 01C3                                    add     ebx, eax
  5981 000040DC 8B14B5[A0B60000]                        mov     edx, [(mp3_synth_buf+400h)+esi*4]
  5982 000040E3 0FBF842D[58060500]                      movsx   eax, word [(mp3_synth_win+200h)+ebp*2]
  5983 000040EB 0FAFC2                                  imul    eax, edx
  5984 000040EE 01C3                                    add     ebx, eax
  5985 000040F0 8B14B5[A0B70000]                        mov     edx, [(mp3_synth_buf+500h)+esi*4]
  5986 000040F7 0FBF842D[D8060500]                      movsx   eax, word [(mp3_synth_win+280h)+ebp*2]
  5987 000040FF 0FAFC2                                  imul    eax, edx
  5988 00004102 01C3                                    add     ebx, eax
  5989 00004104 8B14B5[A0B80000]                        mov     edx, [(mp3_synth_buf+600h)+esi*4]
  5990 0000410B 0FBF842D[58070500]                      movsx   eax, word [(mp3_synth_win+300h)+ebp*2]
  5991 00004113 0FAFC2                                  imul    eax, edx
  5992 00004116 01C3                                    add     ebx, eax
  5993 00004118 8B14B5[A0B90000]                        mov     edx, [(mp3_synth_buf+700h)+esi*4]
  5994 0000411F 0FBF842D[D8070500]                      movsx   eax, word [(mp3_synth_win+380h)+ebp*2]
  5995 00004127 0FAFC2                                  imul    eax, edx
  5996 0000412A 01C3                                    add     ebx, eax
  5997 0000412C 8B14BD[A0B20000]                        mov     edx, [mp3_synth_buf+edi*4]
  5998 00004133 0FBF842D[98040500]                      movsx   eax, word [(mp3_synth_win+40h)+ebp*2]
  5999 0000413B 0FAFC2                                  imul    eax, edx
  6000 0000413E 01C3                                    add     ebx, eax
  6001 00004140 8B14BD[A0B30000]                        mov     edx, [(mp3_synth_buf+100h)+edi*4]
  6002 00004147 0FBF842D[18050500]                      movsx   eax, word [(mp3_synth_win+0C0h)+ebp*2]
  6003 0000414F 0FAFC2                                  imul    eax, edx
  6004 00004152 01C3                                    add     ebx, eax
  6005 00004154 8B14BD[A0B40000]                        mov     edx, [(mp3_synth_buf+200h)+edi*4] ; nn=2
  6006 0000415B 0FBF842D[98050500]                      movsx   eax, word [(mp3_synth_win+140h)+ebp*2] ; ww=32
  6007 00004163 0FAFC2                                  imul    eax, edx
  6008 00004166 01C3                                    add     ebx, eax
  6009 00004168 8B14BD[A0B50000]                        mov     edx, [(mp3_synth_buf+300h)+edi*4]
  6010 0000416F 0FBF842D[18060500]                      movsx   eax, word [(mp3_synth_win+1C0h)+ebp*2]
  6011 00004177 0FAFC2                                  imul    eax, edx
  6012 0000417A 01C3                                    add     ebx, eax
  6013 0000417C 8B14BD[A0B60000]                        mov     edx, [(mp3_synth_buf+400h)+edi*4]
  6014 00004183 0FBF842D[98060500]                      movsx   eax, word [(mp3_synth_win+240h)+ebp*2]
  6015 0000418B 0FAFC2                                  imul    eax, edx
  6016 0000418E 01C3                                    add     ebx, eax
  6017 00004190 8B14BD[A0B70000]                        mov     edx, [(mp3_synth_buf+500h)+edi*4]
  6018 00004197 0FBF842D[18070500]                      movsx   eax, word [(mp3_synth_win+2C0h)+ebp*2]
  6019 0000419F 0FAFC2                                  imul    eax, edx
  6020 000041A2 01C3                                    add     ebx, eax
  6021 000041A4 8B14BD[A0B80000]                        mov     edx, [(mp3_synth_buf+600h)+edi*4]
  6022 000041AB 0FBF842D[98070500]                      movsx   eax, word [(mp3_synth_win+340h)+ebp*2]
  6023 000041B3 0FAFC2                                  imul    eax, edx
  6024 000041B6 01C3                                    add     ebx, eax
  6025 000041B8 8B14BD[A0B90000]                        mov     edx, [(mp3_synth_buf+700h)+edi*4]
  6026 000041BF 0FBF842D[18080500]                      movsx   eax, word [(mp3_synth_win+3C0h)+ebp*2]
  6027 000041C7 0FAFC2                                  imul    eax, edx
  6028 000041CA 01C3                                    add     ebx, eax
  6029 000041CC 81FB00000040                            cmp     ebx, 40000000h  ; cmp  @@sum,100h SHL (@@out_shift)
  6030 000041D2 731B                                    jnb     short .sat
  6031 000041D4 C1FB16                                  sar     ebx, 22         ; sar @@sum,(@@out_shift)
  6032                                  
  6033                                  .sat_back:
  6034 000041D7 8819                                    mov     [ecx], bl       ; mov byte ptr [@@dst],@@sum_8bit
  6035 000041D9 030D[44090100]                          add     ecx, [mp3_samples_dst_step]
  6036 000041DF 46                                      inc     esi             ; inc @@syn1
  6037 000041E0 4F                                      dec     edi             ; dec @@syn2
  6038 000041E1 45                                      inc     ebp             ; inc @@win1
  6039 000041E2 F7C51F000000                            test    ebp, 1Fh        ; IF LONG_WINDOW
  6040                                                                          ; test @@win1,1fh
  6041 000041E8 0F8599FEFFFF                            jnz     .samples_lop
  6042 000041EE C3                                      retn
  6043                                  
  6044                                  .sat:                                 
  6045 000041EF C1FB1F                                  sar     ebx, 31         ; sar @@sum,31 ; FFFFFFFFh,00000000h
  6046 000041F2 F7D3                                    not     ebx             ; IF force_8bit
  6047                                                                          ; not @@sum ; 00000000h,FFFFFFFFh (unsigned 8bit)
  6048 000041F4 EBE1                                    jmp     short .sat_back
  6049                                  
  6050                                  .append_copy_to_window:
  6051 000041F6 8D3485[A0B20000]                        lea     esi, [mp3_synth_buf+eax*4]
  6052 000041FD 8DBE00080000                            lea     edi, [esi+2048] ; [esi+512*4]
  6053 00004203 B912000000                              mov     ecx, 18         ; (12h*4)/4
  6054 00004208 F3A5                                    rep movsd
  6055 0000420A E957FEFFFF                              jmp     .append_copy_to_window_back
  6056                                  
  6057                                  
  6058                                  ; =============== S U B R O U T I N E =======================================
  6059                                  
  6060                                  
  6061                                  synth_8bit_shift_1_fast:
  6062 0000420F F605[FC8A0000]10                        test    byte [cpuid_flags], 10h ; SYNTH_MACRO 1,1,1
  6063 00004216 740E                                    jz      short .no_rdtsc_supported
  6064 00004218 0F31                                    rdtsc
  6065 0000421A 2905[748C0000]                          sub     [rdtsc_synth_dct], eax
  6066 00004220 1915[788C0000]                          sbb     [rdtsc_synth_dct+4], edx
  6067                                  
  6068                                  .no_rdtsc_supported:
  6069 00004226 BE[A8D20000]                            mov	esi, mp3_sb_samples
  6070 0000422B 8B3D[3C090100]                          mov	edi, [mp3_samples_dst]
  6071 00004231 C705[48090100]0000-                     mov	dword [mp3_curr_channel], 0
  6071 00004239 0000               
  6072                                  
  6073                                  .synth_channel_lop:
  6074 0000423B 56                                      push	esi
  6075 0000423C 57                                      push	edi
  6076 0000423D 893D[88B20000]                          mov	[mp3_curr_syn_dst], edi
  6077 00004243 C705[50090100]0000-                     mov	dword [mp3_curr_frame], 0
  6077 0000424B 0000               
  6078                                  
  6079                                  .synth_frame_lop:
  6080 0000424D 56                                      push    esi
  6081 0000424E F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
  6082 00004255 740E                                    jz      short .no_rdtsc_supported@
  6083 00004257 0F31                                    rdtsc
  6084 00004259 2905[8C8C0000]                          sub     [rdtsc_dct32], eax
  6085 0000425F 1915[908C0000]                          sbb     [rdtsc_dct32+4], edx
  6086                                  
  6087                                  .no_rdtsc_supported@:
  6088 00004265 8B15[48090100]                          mov     edx, [mp3_curr_channel]
  6089 0000426B 8B0495[A0D20000]                        mov     eax, [mp3_synth_index+edx*4]
  6090 00004272 832C95[A0D20000]20                      sub     dword [mp3_synth_index+edx*4], 32
  6091 0000427A C1E20A                                  shl     edx, 10
  6092 0000427D 25E0010000                              and     eax, 1E0h       ; 1FFh-1Fh
  6093 00004282 09D0                                    or      eax, edx
  6094 00004284 A3[84B20000]                            mov     [mp3_curr_syn_index], eax
  6095 00004289 8B3D[84B20000]                          mov     edi, [mp3_curr_syn_index]
  6096 0000428F 8D3CBD[A0B20000]                        lea     edi, [mp3_synth_buf+edi*4]
  6097 00004296 E852ECFFFF                              call    mp3_dct32_shift_1 ; mp3_dct32_shift_&rate_shift
  6098 0000429B F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
  6099 000042A2 740E                                    jz      short .no_rdtsc_supported@@
  6100 000042A4 0F31                                    rdtsc
  6101 000042A6 0105[8C8C0000]                          add     [rdtsc_dct32], eax
  6102 000042AC 1115[908C0000]                          adc     [rdtsc_dct32+4], edx
  6103                                  
  6104                                  .no_rdtsc_supported@@:
  6105 000042B2 F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
  6106 000042B9 740E                                    jz      short .no_rdtsc_supported@@@
  6107 000042BB 0F31                                    rdtsc
  6108 000042BD 2905[A48C0000]                          sub     [rdtsc_synth], eax
  6109 000042C3 1915[A88C0000]                          sbb     [rdtsc_synth+4], edx
  6110                                  
  6111                                  .no_rdtsc_supported@@@:
  6112 000042C9 E888000000                              call    mp3_synth_filter_this_8bit_shift_1_fast ;
  6113                                                                          ; mp3_synth_filter_this_&force_8bit&_&rate_shift&_&force_fast
  6114 000042CE F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
  6115 000042D5 740E                                    jz      short .no_rdtsc_supported@@@@
  6116 000042D7 0F31                                    rdtsc
  6117 000042D9 0105[A48C0000]                          add     [rdtsc_synth], eax
  6118 000042DF 1115[A88C0000]                          adc     [rdtsc_synth+4], edx
  6119                                  
  6120                                  .no_rdtsc_supported@@@@:
  6121 000042E5 5E                                      pop     esi
  6122 000042E6 A1[44090100]                            mov     eax, [mp3_samples_dst_step]
  6123 000042EB C1E005                                  shl     eax, 5
  6124 000042EE 8A0D[F98A0000]                          mov     cl, [option_rate_shift]
  6125 000042F4 D3E8                                    shr     eax, cl
  6126 000042F6 0105[88B20000]                          add     [mp3_curr_syn_dst], eax
  6127 000042FC 81C680000000                            add     esi, 128        ; SBLIMIT*4
  6128 00004302 FF05[50090100]                          inc     dword [mp3_curr_frame]
  6129 00004308 A1[50090100]                            mov     eax, [mp3_curr_frame]
  6130 0000430D 3B05[8CB20000]                          cmp     eax, [mp3_nb_frames]
  6131 00004313 0F8234FFFFFF                            jb      .synth_frame_lop
  6132 00004319 5F                                      pop     edi
  6133 0000431A 5E                                      pop     esi
  6134 0000431B 033D[80B20000]                          add     edi, [mp3_bytes_per_sample]
  6135 00004321 81C600120000                            add     esi, 4608       ; 36*SBLIMIT*4
  6136 00004327 FF05[48090100]                          inc     dword [mp3_curr_channel]
  6137 0000432D A1[48090100]                            mov     eax, [mp3_curr_channel]
  6138 00004332 3B05[78B20000]                          cmp     eax, [mp3_output_num_channels]
  6139 00004338 0F82FDFEFFFF                            jb      .synth_channel_lop
  6140 0000433E F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
  6141 00004345 740E                                    jz      short .no_rdtsc_supported@@@@@
  6142 00004347 0F31                                    rdtsc
  6143 00004349 0105[748C0000]                          add     [rdtsc_synth_dct], eax
  6144 0000434F 1115[788C0000]                          adc     [rdtsc_synth_dct+4], edx
  6145                                  
  6146                                  .no_rdtsc_supported@@@@@:
  6147 00004355 C3                                      retn
  6148                                  
  6149                                  
  6150                                  ; =============== S U B R O U T I N E =======================================
  6151                                  
  6152                                  
  6153                                  mp3_synth_filter_this_8bit_shift_1_fast:
  6154 00004356 A1[84B20000]                            mov     eax, [mp3_curr_syn_index]
  6155 0000435B A9E0010000                              test    eax, 1E0h
  6156 00004360 0F8497010000                            jz      .append_copy_to_window
  6157 00004366 90                                      nop
  6158                                  
  6159                                  .append_copy_to_window_back:
  6160 00004367 89C5                                    mov     ebp, eax
  6161 00004369 81E5C0010000                            and     ebp, 1C0h
  6162 0000436F 2520040000                              and     eax, 420h
  6163 00004374 8D7010                                  lea     esi, [eax+10h]
  6164 00004377 8D7830                                  lea     edi, [eax+30h]
  6165 0000437A F7DD                                    neg     ebp
  6166 0000437C 81E5C0010000                            and     ebp, 1C0h
  6167 00004382 8B0D[88B20000]                          mov     ecx, [mp3_curr_syn_dst]
  6168                                  
  6169                                  .samples_lop:
  6170 00004388 BB00002020                              mov     ebx, 20200000h
  6171 0000438D 8B14B5[A0B20000]                        mov     edx, [mp3_synth_buf+esi*4]
  6172 00004394 0FBF842D[58040500]                      movsx   eax, word [mp3_synth_win+ebp*2]
  6173 0000439C 0FAFC2                                  imul    eax, edx
  6174 0000439F 01C3                                    add     ebx, eax
  6175 000043A1 8B14B5[A0B30000]                        mov     edx, [(mp3_synth_buf+100h)+esi*4]
  6176 000043A8 0FBF842D[D8040500]                      movsx   eax, word [(mp3_synth_win+80h)+ebp*2]
  6177 000043B0 0FAFC2                                  imul    eax, edx
  6178 000043B3 01C3                                    add     ebx, eax
  6179 000043B5 8B14B5[A0B40000]                        mov     edx, [(mp3_synth_buf+200h)+esi*4]
  6180 000043BC 0FBF842D[58050500]                      movsx   eax, word [(mp3_synth_win+100h)+ebp*2]
  6181 000043C4 0FAFC2                                  imul    eax, edx
  6182 000043C7 01C3                                    add     ebx, eax
  6183 000043C9 8B14B5[A0B50000]                        mov     edx, [(mp3_synth_buf+300h)+esi*4]
  6184 000043D0 0FBF842D[D8050500]                      movsx   eax, word [(mp3_synth_win+180h)+ebp*2]
  6185 000043D8 0FAFC2                                  imul    eax, edx
  6186 000043DB 01C3                                    add     ebx, eax
  6187 000043DD 8B14B5[A0B60000]                        mov     edx, [(mp3_synth_buf+400h)+esi*4]
  6188 000043E4 0FBF842D[58060500]                      movsx   eax, word [(mp3_synth_win+200h)+ebp*2]
  6189 000043EC 0FAFC2                                  imul    eax, edx
  6190 000043EF 01C3                                    add     ebx, eax
  6191 000043F1 8B14B5[A0B70000]                        mov     edx, [(mp3_synth_buf+500h)+esi*4]
  6192 000043F8 0FBF842D[D8060500]                      movsx   eax, word [(mp3_synth_win+280h)+ebp*2]
  6193 00004400 0FAFC2                                  imul    eax, edx
  6194 00004403 01C3                                    add     ebx, eax
  6195 00004405 8B14B5[A0B80000]                        mov     edx, [(mp3_synth_buf+600h)+esi*4]
  6196 0000440C 0FBF842D[58070500]                      movsx   eax, word [(mp3_synth_win+300h)+ebp*2]
  6197 00004414 0FAFC2                                  imul    eax, edx
  6198 00004417 01C3                                    add     ebx, eax
  6199 00004419 8B14B5[A0B90000]                        mov     edx, [(mp3_synth_buf+700h)+esi*4]
  6200 00004420 0FBF842D[D8070500]                      movsx   eax, word [(mp3_synth_win+380h)+ebp*2]
  6201 00004428 0FAFC2                                  imul    eax, edx
  6202 0000442B 01C3                                    add     ebx, eax
  6203 0000442D 8B14BD[A0B20000]                        mov     edx, [mp3_synth_buf+edi*4]
  6204 00004434 0FBF842D[98040500]                      movsx   eax, word [(mp3_synth_win+40h)+ebp*2]
  6205 0000443C 0FAFC2                                  imul    eax, edx
  6206 0000443F 01C3                                    add     ebx, eax
  6207 00004441 8B14BD[A0B30000]                        mov     edx, [(mp3_synth_buf+100h)+edi*4]
  6208 00004448 0FBF842D[18050500]                      movsx   eax, word [(mp3_synth_win+0C0h)+ebp*2]
  6209 00004450 0FAFC2                                  imul    eax, edx
  6210 00004453 01C3                                    add     ebx, eax
  6211 00004455 8B14BD[A0B40000]                        mov     edx, [(mp3_synth_buf+200h)+edi*4]
  6212 0000445C 0FBF842D[98050500]                      movsx   eax, word [(mp3_synth_win+140h)+ebp*2]
  6213 00004464 0FAFC2                                  imul    eax, edx
  6214 00004467 01C3                                    add     ebx, eax
  6215 00004469 8B14BD[A0B50000]                        mov     edx, [(mp3_synth_buf+300h)+edi*4]
  6216 00004470 0FBF842D[18060500]                      movsx   eax, word [(mp3_synth_win+1C0h)+ebp*2]
  6217 00004478 0FAFC2                                  imul    eax, edx
  6218 0000447B 01C3                                    add     ebx, eax
  6219 0000447D 8B14BD[A0B60000]                        mov     edx, [(mp3_synth_buf+400h)+edi*4]
  6220 00004484 0FBF842D[98060500]                      movsx   eax, word [(mp3_synth_win+240h)+ebp*2]
  6221 0000448C 0FAFC2                                  imul    eax, edx
  6222 0000448F 01C3                                    add     ebx, eax
  6223 00004491 8B14BD[A0B70000]                        mov     edx, [(mp3_synth_buf+500h)+edi*4]
  6224 00004498 0FBF842D[18070500]                      movsx   eax, word [(mp3_synth_win+2C0h)+ebp*2]
  6225 000044A0 0FAFC2                                  imul    eax, edx
  6226 000044A3 01C3                                    add     ebx, eax
  6227 000044A5 8B14BD[A0B80000]                        mov     edx, [(mp3_synth_buf+600h)+edi*4]
  6228 000044AC 0FBF842D[98070500]                      movsx   eax, word [(mp3_synth_win+340h)+ebp*2]
  6229 000044B4 0FAFC2                                  imul    eax, edx
  6230 000044B7 01C3                                    add     ebx, eax
  6231 000044B9 8B14BD[A0B90000]                        mov     edx, [(mp3_synth_buf+700h)+edi*4]
  6232 000044C0 0FBF842D[18080500]                      movsx   eax, word [(mp3_synth_win+3C0h)+ebp*2]
  6233 000044C8 0FAFC2                                  imul    eax, edx
  6234 000044CB 01C3                                    add     ebx, eax
  6235 000044CD 81FB00000040                            cmp     ebx, 40000000h
  6236 000044D3 7321                                    jnb     short .sat
  6237 000044D5 C1FB16                                  sar     ebx, 22
  6238                                  
  6239                                  .sat_back:
  6240 000044D8 8819                                    mov     [ecx], bl
  6241 000044DA 030D[44090100]                          add     ecx, [mp3_samples_dst_step]
  6242 000044E0 83C602                                  add     esi, 2
  6243 000044E3 83EF02                                  sub     edi, 2
  6244 000044E6 83C502                                  add     ebp, 2
  6245 000044E9 F7C51F000000                            test    ebp, 1Fh
  6246 000044EF 0F8593FEFFFF                            jnz     .samples_lop
  6247 000044F5 C3                                      retn
  6248                                  
  6249                                  .sat:
  6250 000044F6 C1FB1F                                  sar     ebx, 31
  6251 000044F9 F7D3                                    not     ebx
  6252 000044FB EBDB                                    jmp     short .sat_back
  6253                                  
  6254                                  .append_copy_to_window:
  6255 000044FD 8D3485[A0B20000]                        lea     esi, [mp3_synth_buf+eax*4]
  6256 00004504 8DBE00080000                            lea     edi, [esi+2048]
  6257 0000450A B912000000                              mov     ecx, 18
  6258 0000450F F3A5                                    rep movsd
  6259 00004511 E951FEFFFF                              jmp     .append_copy_to_window_back
  6260                                  
  6261                                  
  6262                                  ; =============== S U B R O U T I N E =======================================
  6263                                  
  6264                                  
  6265                                  synth_8bit_shift_2_fast:
  6266 00004516 F605[FC8A0000]10                        test    byte [cpuid_flags], 10h ; SYNTH_MACRO 1,2,1
  6267 0000451D 740E                                    jz      short .no_rdtsc_supported
  6268 0000451F 0F31                                    rdtsc
  6269 00004521 2905[748C0000]                          sub     [rdtsc_synth_dct], eax
  6270 00004527 1915[788C0000]                          sbb     [rdtsc_synth_dct+4], edx
  6271                                  
  6272                                  .no_rdtsc_supported:
  6273 0000452D BE[A8D20000]                            mov	esi, mp3_sb_samples
  6274 00004532 8B3D[3C090100]                          mov	edi, [mp3_samples_dst]
  6275 00004538 C705[48090100]0000-                     mov	dword [mp3_curr_channel], 0
  6275 00004540 0000               
  6276                                  
  6277                                  .synth_channel_lop:
  6278 00004542 56                                      push	esi
  6279 00004543 57                                      push	edi
  6280 00004544 893D[88B20000]                          mov	[mp3_curr_syn_dst], edi
  6281 0000454A C705[50090100]0000-                     mov	dword [mp3_curr_frame], 0
  6281 00004552 0000               
  6282                                  
  6283                                  .synth_frame_lop:
  6284 00004554 56                                      push    esi
  6285 00004555 F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
  6286 0000455C 740E                                    jz      short .no_rdtsc_supported@
  6287 0000455E 0F31                                    rdtsc
  6288 00004560 2905[8C8C0000]                          sub     [rdtsc_dct32], eax
  6289 00004566 1915[908C0000]                          sbb     [rdtsc_dct32+4], edx
  6290                                  
  6291                                  .no_rdtsc_supported@:
  6292 0000456C 8B15[48090100]                          mov     edx, [mp3_curr_channel]
  6293 00004572 8B0495[A0D20000]                        mov     eax, [mp3_synth_index+edx*4]
  6294 00004579 832C95[A0D20000]20                      sub     dword [mp3_synth_index+edx*4], 32
  6295 00004581 C1E20A                                  shl     edx, 10
  6296 00004584 25E0010000                              and     eax, 1E0h       ; 1FFh-1Fh
  6297 00004589 09D0                                    or      eax, edx
  6298 0000458B A3[84B20000]                            mov     [mp3_curr_syn_index], eax
  6299 00004590 8B3D[84B20000]                          mov     edi, [mp3_curr_syn_index]
  6300 00004596 8D3CBD[A0B20000]                        lea     edi, [mp3_synth_buf+edi*4]
  6301 0000459D E83BEDFFFF                              call    mp3_dct32_shift_2 ; mp3_dct32_shift_&rate_shift
  6302 000045A2 F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
  6303 000045A9 740E                                    jz      short .no_rdtsc_supported@@
  6304 000045AB 0F31                                    rdtsc
  6305 000045AD 0105[8C8C0000]                          add     [rdtsc_dct32], eax
  6306 000045B3 1115[908C0000]                          adc     [rdtsc_dct32+4], edx
  6307                                  
  6308                                  .no_rdtsc_supported@@:
  6309 000045B9 F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
  6310 000045C0 740E                                    jz      short .no_rdtsc_supported@@@
  6311 000045C2 0F31                                    rdtsc
  6312 000045C4 2905[A48C0000]                          sub     [rdtsc_synth], eax
  6313 000045CA 1915[A88C0000]                          sbb     [rdtsc_synth+4], edx
  6314                                  
  6315                                  .no_rdtsc_supported@@@:
  6316 000045D0 E888000000                              call    mp3_synth_filter_this_8bit_shift_2_fast ;
  6317                                                                          ; mp3_synth_filter_this_&force_8bit&_&rate_shift&_&force_fast
  6318 000045D5 F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
  6319 000045DC 740E                                    jz      short .no_rdtsc_supported@@@@
  6320 000045DE 0F31                                    rdtsc
  6321 000045E0 0105[A48C0000]                          add     [rdtsc_synth], eax
  6322 000045E6 1115[A88C0000]                          adc     [rdtsc_synth+4], edx
  6323                                  
  6324                                  .no_rdtsc_supported@@@@:
  6325 000045EC 5E                                      pop     esi
  6326 000045ED A1[44090100]                            mov     eax, [mp3_samples_dst_step]
  6327 000045F2 C1E005                                  shl     eax, 5
  6328 000045F5 8A0D[F98A0000]                          mov     cl, [option_rate_shift]
  6329 000045FB D3E8                                    shr     eax, cl
  6330 000045FD 0105[88B20000]                          add     [mp3_curr_syn_dst], eax
  6331 00004603 81C680000000                            add     esi, 128        ; SBLIMIT*4
  6332 00004609 FF05[50090100]                          inc     dword [mp3_curr_frame]
  6333 0000460F A1[50090100]                            mov     eax, [mp3_curr_frame]
  6334 00004614 3B05[8CB20000]                          cmp     eax, [mp3_nb_frames]
  6335 0000461A 0F8234FFFFFF                            jb      .synth_frame_lop
  6336 00004620 5F                                      pop     edi
  6337 00004621 5E                                      pop     esi
  6338 00004622 033D[80B20000]                          add     edi, [mp3_bytes_per_sample]
  6339 00004628 81C600120000                            add     esi, 4608       ; 36*SBLIMIT*4
  6340 0000462E FF05[48090100]                          inc     dword [mp3_curr_channel]
  6341 00004634 A1[48090100]                            mov     eax, [mp3_curr_channel]
  6342 00004639 3B05[78B20000]                          cmp     eax, [mp3_output_num_channels]
  6343 0000463F 0F82FDFEFFFF                            jb      .synth_channel_lop
  6344 00004645 F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
  6345 0000464C 740E                                    jz      short .no_rdtsc_supported@@@@@
  6346 0000464E 0F31                                    rdtsc
  6347 00004650 0105[748C0000]                          add     [rdtsc_synth_dct], eax
  6348 00004656 1115[788C0000]                          adc     [rdtsc_synth_dct+4], edx
  6349                                  
  6350                                  .no_rdtsc_supported@@@@@:
  6351 0000465C C3                                      retn
  6352                                  
  6353                                  
  6354                                  ; =============== S U B R O U T I N E =======================================
  6355                                  
  6356                                  
  6357                                  mp3_synth_filter_this_8bit_shift_2_fast:
  6358 0000465D A1[84B20000]                            mov     eax, [mp3_curr_syn_index]
  6359 00004662 A9E0010000                              test    eax, 1E0h
  6360 00004667 0F8497010000                            jz      .append_copy_to_window
  6361 0000466D 90                                      nop
  6362                                  
  6363                                  .append_copy_to_window_back:
  6364 0000466E 89C5                                    mov     ebp, eax
  6365 00004670 81E5C0010000                            and     ebp, 1C0h
  6366 00004676 2520040000                              and     eax, 420h
  6367 0000467B 8D7010                                  lea     esi, [eax+10h]
  6368 0000467E 8D7830                                  lea     edi, [eax+30h]
  6369 00004681 F7DD                                    neg     ebp
  6370 00004683 81E5C0010000                            and     ebp, 1C0h
  6371 00004689 8B0D[88B20000]                          mov     ecx, [mp3_curr_syn_dst]
  6372                                  
  6373                                  .samples_lop:
  6374 0000468F BB00002020                              mov     ebx, 20200000h
  6375 00004694 8B14B5[A0B20000]                        mov     edx, [mp3_synth_buf+esi*4]
  6376 0000469B 0FBF842D[58040500]                      movsx   eax, word [mp3_synth_win+ebp*2]
  6377 000046A3 0FAFC2                                  imul    eax, edx
  6378 000046A6 01C3                                    add     ebx, eax
  6379 000046A8 8B14B5[A0B30000]                        mov     edx, [(mp3_synth_buf+100h)+esi*4]
  6380 000046AF 0FBF842D[D8040500]                      movsx   eax, word [(mp3_synth_win+80h)+ebp*2]
  6381 000046B7 0FAFC2                                  imul    eax, edx
  6382 000046BA 01C3                                    add     ebx, eax
  6383 000046BC 8B14B5[A0B40000]                        mov     edx, [(mp3_synth_buf+200h)+esi*4]
  6384 000046C3 0FBF842D[58050500]                      movsx   eax, word [(mp3_synth_win+100h)+ebp*2]
  6385 000046CB 0FAFC2                                  imul    eax, edx
  6386 000046CE 01C3                                    add     ebx, eax
  6387 000046D0 8B14B5[A0B50000]                        mov     edx, [(mp3_synth_buf+300h)+esi*4]
  6388 000046D7 0FBF842D[D8050500]                      movsx   eax, word [(mp3_synth_win+180h)+ebp*2]
  6389 000046DF 0FAFC2                                  imul    eax, edx
  6390 000046E2 01C3                                    add     ebx, eax
  6391 000046E4 8B14B5[A0B60000]                        mov     edx, [(mp3_synth_buf+400h)+esi*4]
  6392 000046EB 0FBF842D[58060500]                      movsx   eax, word [(mp3_synth_win+200h)+ebp*2]
  6393 000046F3 0FAFC2                                  imul    eax, edx
  6394 000046F6 01C3                                    add     ebx, eax
  6395 000046F8 8B14B5[A0B70000]                        mov     edx, [(mp3_synth_buf+500h)+esi*4]
  6396 000046FF 0FBF842D[D8060500]                      movsx   eax, word [(mp3_synth_win+280h)+ebp*2]
  6397 00004707 0FAFC2                                  imul    eax, edx
  6398 0000470A 01C3                                    add     ebx, eax
  6399 0000470C 8B14B5[A0B80000]                        mov     edx, [(mp3_synth_buf+600h)+esi*4]
  6400 00004713 0FBF842D[58070500]                      movsx   eax, word [(mp3_synth_win+300h)+ebp*2]
  6401 0000471B 0FAFC2                                  imul    eax, edx
  6402 0000471E 01C3                                    add     ebx, eax
  6403 00004720 8B14B5[A0B90000]                        mov     edx, [(mp3_synth_buf+700h)+esi*4]
  6404 00004727 0FBF842D[D8070500]                      movsx   eax, word [(mp3_synth_win+380h)+ebp*2]
  6405 0000472F 0FAFC2                                  imul    eax, edx
  6406 00004732 01C3                                    add     ebx, eax
  6407 00004734 8B14BD[A0B20000]                        mov     edx, [mp3_synth_buf+edi*4]
  6408 0000473B 0FBF842D[98040500]                      movsx   eax, word [(mp3_synth_win+40h)+ebp*2]
  6409 00004743 0FAFC2                                  imul    eax, edx
  6410 00004746 01C3                                    add     ebx, eax
  6411 00004748 8B14BD[A0B30000]                        mov     edx, [(mp3_synth_buf+100h)+edi*4]
  6412 0000474F 0FBF842D[18050500]                      movsx   eax, word [(mp3_synth_win+0C0h)+ebp*2]
  6413 00004757 0FAFC2                                  imul    eax, edx
  6414 0000475A 01C3                                    add     ebx, eax
  6415 0000475C 8B14BD[A0B40000]                        mov     edx, [(mp3_synth_buf+200h)+edi*4]
  6416 00004763 0FBF842D[98050500]                      movsx   eax, word [(mp3_synth_win+140h)+ebp*2]
  6417 0000476B 0FAFC2                                  imul    eax, edx
  6418 0000476E 01C3                                    add     ebx, eax
  6419 00004770 8B14BD[A0B50000]                        mov     edx, [(mp3_synth_buf+300h)+edi*4]
  6420 00004777 0FBF842D[18060500]                      movsx   eax, word [(mp3_synth_win+1C0h)+ebp*2]
  6421 0000477F 0FAFC2                                  imul    eax, edx
  6422 00004782 01C3                                    add     ebx, eax
  6423 00004784 8B14BD[A0B60000]                        mov     edx, [(mp3_synth_buf+400h)+edi*4]
  6424 0000478B 0FBF842D[98060500]                      movsx   eax, word [(mp3_synth_win+240h)+ebp*2]
  6425 00004793 0FAFC2                                  imul    eax, edx
  6426 00004796 01C3                                    add     ebx, eax
  6427 00004798 8B14BD[A0B70000]                        mov     edx, [(mp3_synth_buf+500h)+edi*4]
  6428 0000479F 0FBF842D[18070500]                      movsx   eax, word [(mp3_synth_win+2C0h)+ebp*2]
  6429 000047A7 0FAFC2                                  imul    eax, edx
  6430 000047AA 01C3                                    add     ebx, eax
  6431 000047AC 8B14BD[A0B80000]                        mov     edx, [(mp3_synth_buf+600h)+edi*4]
  6432 000047B3 0FBF842D[98070500]                      movsx   eax, word [(mp3_synth_win+340h)+ebp*2]
  6433 000047BB 0FAFC2                                  imul    eax, edx
  6434 000047BE 01C3                                    add     ebx, eax
  6435 000047C0 8B14BD[A0B90000]                        mov     edx, [(mp3_synth_buf+700h)+edi*4]
  6436 000047C7 0FBF842D[18080500]                      movsx   eax, word [(mp3_synth_win+3C0h)+ebp*2]
  6437 000047CF 0FAFC2                                  imul    eax, edx
  6438 000047D2 01C3                                    add     ebx, eax
  6439 000047D4 81FB00000040                            cmp     ebx, 40000000h
  6440 000047DA 7321                                    jnb     short .sat
  6441 000047DC C1FB16                                  sar     ebx, 22
  6442                                  
  6443                                  .sat_back:
  6444 000047DF 8819                                    mov     [ecx], bl
  6445 000047E1 030D[44090100]                          add     ecx, [mp3_samples_dst_step]
  6446 000047E7 83C604                                  add     esi, 4
  6447 000047EA 83EF04                                  sub     edi, 4
  6448 000047ED 83C504                                  add     ebp, 4
  6449 000047F0 F7C51F000000                            test    ebp, 1Fh
  6450 000047F6 0F8593FEFFFF                            jnz     .samples_lop
  6451 000047FC C3                                      retn
  6452                                  
  6453                                  .sat:
  6454 000047FD C1FB1F                                  sar     ebx, 31
  6455 00004800 F7D3                                    not     ebx
  6456 00004802 EBDB                                    jmp     short .sat_back
  6457                                  
  6458                                  .append_copy_to_window:
  6459 00004804 8D3485[A0B20000]                        lea     esi, [mp3_synth_buf+eax*4]
  6460 0000480B 8DBE00080000                            lea     edi, [esi+2048]
  6461 00004811 B912000000                              mov     ecx, 18
  6462 00004816 F3A5                                    rep movsd
  6463 00004818 E951FEFFFF                              jmp     .append_copy_to_window_back
  6464                                  
  6465                                  
  6466                                  ; =============== S U B R O U T I N E =======================================
  6467                                  
  6468                                  
  6469                                  synth_16bit_shift_0_slow:
  6470 0000481D F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
  6471 00004824 740E                                    jz      short .no_rdtsc_supported
  6472 00004826 0F31                                    rdtsc
  6473 00004828 2905[748C0000]                          sub     [rdtsc_synth_dct], eax
  6474 0000482E 1915[788C0000]                          sbb     [rdtsc_synth_dct+4], edx
  6475                                  
  6476                                  .no_rdtsc_supported:
  6477 00004834 BE[A8D20000]                            mov	esi, mp3_sb_samples
  6478 00004839 8B3D[3C090100]                          mov	edi, [mp3_samples_dst]
  6479 0000483F C705[48090100]0000-                     mov	dword [mp3_curr_channel], 0
  6479 00004847 0000               
  6480                                  
  6481                                  .synth_channel_lop:
  6482 00004849 56                                      push	esi
  6483 0000484A 57                                      push	edi
  6484 0000484B 893D[88B20000]                          mov	[mp3_curr_syn_dst], edi
  6485 00004851 C705[50090100]0000-                     mov	dword [mp3_curr_frame], 0
  6485 00004859 0000               
  6486                                  
  6487                                  .synth_frame_lop:
  6488 0000485B 56                                      push    esi
  6489 0000485C F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
  6490 00004863 740E                                    jz      short .no_rdtsc_supported@
  6491 00004865 0F31                                    rdtsc
  6492 00004867 2905[8C8C0000]                          sub     [rdtsc_dct32], eax
  6493 0000486D 1915[908C0000]                          sbb     [rdtsc_dct32+4], edx
  6494                                  
  6495                                  .no_rdtsc_supported@:
  6496 00004873 8B15[48090100]                          mov     edx, [mp3_curr_channel]
  6497 00004879 8B0495[A0D20000]                        mov     eax, [mp3_synth_index+edx*4]
  6498 00004880 832C95[A0D20000]20                      sub     dword [mp3_synth_index+edx*4], 32
  6499 00004888 C1E20A                                  shl     edx, 10         ; channel*1024
  6500 0000488B 25E0010000                              and     eax, 1E0h       ; 1FFh-1Fh
  6501 00004890 09D0                                    or      eax, edx
  6502 00004892 A3[84B20000]                            mov     [mp3_curr_syn_index], eax
  6503 00004897 8B3D[84B20000]                          mov     edi, [mp3_curr_syn_index]
  6504 0000489D 8D3CBD[A0B20000]                        lea     edi, [mp3_synth_buf+edi*4]
  6505 000048A4 E864DDFFFF                              call    mp3_dct32_shift_0 ; mp3_dct32_shift_&rate_shift
  6506 000048A9 F605[FC8A0000]10                        test    byte [cpuid_flags], 10h ; timelog_end rdtsc_dct32
  6507 000048B0 740E                                    jz      short .no_rdtsc_supported@@
  6508 000048B2 0F31                                    rdtsc
  6509 000048B4 0105[8C8C0000]                          add     [rdtsc_dct32], eax
  6510 000048BA 1115[908C0000]                          adc     [rdtsc_dct32+4], edx
  6511                                  
  6512                                  .no_rdtsc_supported@@:
  6513 000048C0 F605[FC8A0000]10                        test    byte [cpuid_flags], 10h ; timelog_start rdtsc_synth
  6514 000048C7 740E                                    jz      short .no_rdtsc_supported@@@
  6515 000048C9 0F31                                    rdtsc
  6516 000048CB 2905[A48C0000]                          sub     [rdtsc_synth], eax
  6517 000048D1 1915[A88C0000]                          sbb     [rdtsc_synth+4], edx
  6518                                  
  6519                                  .no_rdtsc_supported@@@:
  6520 000048D7 E888000000                              call    mp3_synth_filter_this_16bit_shift_0_slow
  6521 000048DC F605[FC8A0000]10                        test    byte [cpuid_flags], 10h ; timelog_end rdtsc_synth
  6522 000048E3 740E                                    jz      short .no_rdtsc_supported@@@@
  6523 000048E5 0F31                                    rdtsc
  6524 000048E7 0105[A48C0000]                          add     [rdtsc_synth], eax
  6525 000048ED 1115[A88C0000]                          adc     [rdtsc_synth+4], edx
  6526                                  
  6527                                  .no_rdtsc_supported@@@@:
  6528 000048F3 5E                                      pop     esi
  6529 000048F4 A1[44090100]                            mov     eax, [mp3_samples_dst_step]
  6530 000048F9 C1E005                                  shl     eax, 5
  6531 000048FC 8A0D[F98A0000]                          mov     cl, [option_rate_shift]
  6532 00004902 D3E8                                    shr     eax, cl
  6533 00004904 0105[88B20000]                          add     [mp3_curr_syn_dst], eax
  6534 0000490A 81C680000000                            add     esi, 128        ; SBLIMIT*4
  6535 00004910 FF05[50090100]                          inc     dword [mp3_curr_frame]
  6536 00004916 A1[50090100]                            mov     eax, [mp3_curr_frame]
  6537 0000491B 3B05[8CB20000]                          cmp     eax, [mp3_nb_frames]
  6538 00004921 0F8234FFFFFF                            jb      .synth_frame_lop
  6539 00004927 5F                                      pop     edi
  6540 00004928 5E                                      pop     esi
  6541 00004929 033D[80B20000]                          add     edi, [mp3_bytes_per_sample]
  6542 0000492F 81C600120000                            add     esi, 4608       ; 36*SBLIMIT*4
  6543 00004935 FF05[48090100]                          inc     dword [mp3_curr_channel]
  6544 0000493B A1[48090100]                            mov     eax, [mp3_curr_channel]
  6545 00004940 3B05[78B20000]                          cmp     eax, [mp3_output_num_channels]
  6546 00004946 0F82FDFEFFFF                            jb      .synth_channel_lop
  6547 0000494C F605[FC8A0000]10                        test    byte [cpuid_flags], 10h ; timelog_end rdtsc_synth_dct
  6548 00004953 740E                                    jz      short .no_rdtsc_supported@@@@@
  6549 00004955 0F31                                    rdtsc
  6550 00004957 0105[748C0000]                          add     [rdtsc_synth_dct], eax
  6551 0000495D 1115[788C0000]                          adc     [rdtsc_synth_dct+4], edx
  6552                                  
  6553                                  .no_rdtsc_supported@@@@@:
  6554 00004963 C3                                      retn
  6555                                  
  6556                                  
  6557                                  ; =============== S U B R O U T I N E =======================================
  6558                                  
  6559                                  
  6560                                  mp3_synth_filter_this_16bit_shift_0_slow:
  6561 00004964 A1[84B20000]                            mov     eax, [mp3_curr_syn_index]
  6562 00004969 A9E0010000                              test    eax, 1E0h       ; 1FFh-1Fh
  6563 0000496E 0F847C010000                            jz      .append_copy_to_window
  6564 00004974 90                                      nop
  6565                                  
  6566                                  .append_copy_to_window_back:
  6567 00004975 89C5                                    mov     ebp, eax        ; mov @@win1,eax
  6568 00004977 81E5C0010000                            and     ebp, 1C0h       ; and @@win1,1FFh-1Fh-20h
  6569 0000497D 2520040000                              and     eax, 420h       ; and eax,20h+(1 shl 10) ; bit5, and channel
  6570 00004982 8D7010                                  lea     esi, [eax+10h]  ; lea @@syn1,[eax+10h]
  6571 00004985 8D7830                                  lea     edi, [eax+30h]  ; lea @@syn2,[eax+30h]
  6572 00004988 F7DD                                    neg     ebp
  6573 0000498A 81E5C0010000                            and     ebp, 1C0h       ; and @@win1,1FFh-1Fh-20h
  6574 00004990 8B0D[88B20000]                          mov     ecx, [mp3_curr_syn_dst]
  6575                                  
  6576                                  .samples_lop:
  6577 00004996 BB10001000                              mov     ebx, 100010h    ; mov @@sum,(8000h SHL (@@out_shift))+(1 SHL (@@out_shift-1))
  6578                                                                          ; @@out_shift = 5
  6579                                  
  6580                                  .SUM8_@:                                ; @@SUM8 macro sum,win,ww,syn
  6581 0000499B 8B14B5[A0B20000]                        mov     edx, [mp3_synth_buf+esi*4] ; IRP nn,0,1,2,3,4,5,6,7
  6582                                                                          ; @@SUM8 @@sum,@@win1,0, @@syn1
  6583 000049A2 8B04AD[58040500]                        mov     eax, [mp3_synth_win+ebp*4] ; [mp3_synth_buf+syn*4+(nn*64*4)]
  6584 000049A9 F7EA                                    imul    edx             ; [mp3_synth_win+win*4+(nn*64*4)+ww*4]
  6585 000049AB 01D3                                    add     ebx, edx
  6586 000049AD 8B14B5[A0B30000]                        mov     edx, [(mp3_synth_buf+100h)+esi*4]
  6587 000049B4 8B04AD[58050500]                        mov     eax, [(mp3_synth_win+100h)+ebp*4]
  6588 000049BB F7EA                                    imul    edx
  6589 000049BD 01D3                                    add     ebx, edx        ; add sum,edx
  6590 000049BF 8B14B5[A0B40000]                        mov     edx, [(mp3_synth_buf+200h)+esi*4]
  6591 000049C6 8B04AD[58060500]                        mov     eax, [(mp3_synth_win+200h)+ebp*4] ; [mp3_synth_win+win*4+(nn*64*4)+ww*4]
  6592 000049CD F7EA                                    imul    edx             ; 64bit = 32bit * 32bit
  6593 000049CF 01D3                                    add     ebx, edx
  6594 000049D1 8B14B5[A0B50000]                        mov     edx, [(mp3_synth_buf+300h)+esi*4]
  6595 000049D8 8B04AD[58070500]                        mov     eax, [(mp3_synth_win+300h)+ebp*4]
  6596 000049DF F7EA                                    imul    edx
  6597 000049E1 01D3                                    add     ebx, edx
  6598 000049E3 8B14B5[A0B60000]                        mov     edx, [(mp3_synth_buf+400h)+esi*4]
  6599 000049EA 8B04AD[58080500]                        mov     eax, [(mp3_synth_win+400h)+ebp*4]
  6600 000049F1 F7EA                                    imul    edx
  6601 000049F3 01D3                                    add     ebx, edx
  6602 000049F5 8B14B5[A0B70000]                        mov     edx, [(mp3_synth_buf+500h)+esi*4]
  6603 000049FC 8B04AD[58090500]                        mov     eax, [(mp3_synth_win+500h)+ebp*4]
  6604 00004A03 F7EA                                    imul    edx
  6605 00004A05 01D3                                    add     ebx, edx
  6606 00004A07 8B14B5[A0B80000]                        mov     edx, [(mp3_synth_buf+600h)+esi*4]
  6607 00004A0E 8B04AD[580A0500]                        mov     eax, [(mp3_synth_win+600h)+ebp*4]
  6608 00004A15 F7EA                                    imul    edx
  6609 00004A17 01D3                                    add     ebx, edx
  6610 00004A19 8B14B5[A0B90000]                        mov     edx, [(mp3_synth_buf+700h)+esi*4]
  6611 00004A20 8B04AD[580B0500]                        mov     eax, [(mp3_synth_win+700h)+ebp*4]
  6612 00004A27 F7EA                                    imul    edx
  6613 00004A29 01D3                                    add     ebx, edx
  6614                                  
  6615                                  .skippp:                               ; @@SUM8 macro sum,win,ww,syn
  6616 00004A2B 8B14BD[A0B20000]                        mov     edx, [mp3_synth_buf+edi*4] ; @@SUM8 @@sum,@@win1,32,@@syn2
  6617                                                                          ; [mp3_synth_buf+syn*4+(nn*64*4)]
  6618 00004A32 8B04AD[D8040500]                        mov     eax, [(mp3_synth_win+80h)+ebp*4] ; [mp3_synth_win+win*4+(nn*64*4)+ww*4]
  6619 00004A39 F7EA                                    imul    edx
  6620 00004A3B 01D3                                    add     ebx, edx
  6621 00004A3D 8B14BD[A0B30000]                        mov     edx, [(mp3_synth_buf+100h)+edi*4]
  6622 00004A44 8B04AD[D8050500]                        mov     eax, [(mp3_synth_win+180h)+ebp*4]
  6623 00004A4B F7EA                                    imul    edx
  6624 00004A4D 01D3                                    add     ebx, edx
  6625 00004A4F 8B14BD[A0B40000]                        mov     edx, [(mp3_synth_buf+200h)+edi*4]
  6626 00004A56 8B04AD[D8060500]                        mov     eax, [(mp3_synth_win+280h)+ebp*4]
  6627 00004A5D F7EA                                    imul    edx
  6628 00004A5F 01D3                                    add     ebx, edx
  6629 00004A61 8B14BD[A0B50000]                        mov     edx, [(mp3_synth_buf+300h)+edi*4]
  6630 00004A68 8B04AD[D8070500]                        mov     eax, [(mp3_synth_win+380h)+ebp*4]
  6631 00004A6F F7EA                                    imul    edx
  6632 00004A71 01D3                                    add     ebx, edx
  6633 00004A73 8B14BD[A0B60000]                        mov     edx, [(mp3_synth_buf+400h)+edi*4]
  6634 00004A7A 8B04AD[D8080500]                        mov     eax, [(mp3_synth_win+480h)+ebp*4]
  6635 00004A81 F7EA                                    imul    edx
  6636 00004A83 01D3                                    add     ebx, edx
  6637 00004A85 8B14BD[A0B70000]                        mov     edx, [(mp3_synth_buf+500h)+edi*4]
  6638 00004A8C 8B04AD[D8090500]                        mov     eax, [(mp3_synth_win+580h)+ebp*4]
  6639 00004A93 F7EA                                    imul    edx
  6640 00004A95 01D3                                    add     ebx, edx
  6641 00004A97 8B14BD[A0B80000]                        mov     edx, [(mp3_synth_buf+600h)+edi*4]
  6642 00004A9E 8B04AD[D80A0500]                        mov     eax, [(mp3_synth_win+680h)+ebp*4]
  6643 00004AA5 F7EA                                    imul    edx
  6644 00004AA7 01D3                                    add     ebx, edx
  6645 00004AA9 8B14BD[A0B90000]                        mov     edx, [(mp3_synth_buf+700h)+edi*4]
  6646 00004AB0 8B04AD[D80B0500]                        mov     eax, [(mp3_synth_win+780h)+ebp*4]
  6647 00004AB7 F7EA                                    imul    edx
  6648 00004AB9 01D3                                    add     ebx, edx
  6649 00004ABB 81FB00002000                            cmp     ebx, 200000h    ; cmp @@sum,10000h SHL (@@out_shift)
  6650 00004AC1 7322                                    jnb     short .sat
  6651 00004AC3 C1FB05                                  sar     ebx, 5          ; sar @@sum,(@@out_shift)
  6652 00004AC6 81EB00800000                            sub     ebx, 8000h      ; make 16bit signed
  6653                                  
  6654                                  .sat_back:
  6655 00004ACC 668919                                  mov     [ecx], bx
  6656 00004ACF 030D[44090100]                          add     ecx, [mp3_samples_dst_step]
  6657 00004AD5 46                                      inc     esi             ; inc @@syn1
  6658 00004AD6 4F                                      dec     edi             ; dec @@syn2
  6659 00004AD7 45                                      inc     ebp             ; inc @@win1
  6660 00004AD8 F7C51F000000                            test    ebp, 1Fh        ; test @@win1,1Fh
  6661 00004ADE 0F85B2FEFFFF                            jnz     .samples_lop
  6662 00004AE4 C3                                      retn
  6663                                  
  6664                                  .sat:
  6665 00004AE5 C1FB1F                                  sar     ebx, 31         ; FFFFFFFFh,00000000h
  6666 00004AE8 81F3FF7F0000                            xor     ebx, 7FFFh      ; FFFF8000h,00007FFFh (signed 16bit)
  6667 00004AEE EBDC                                    jmp     short .sat_back
  6668                                  
  6669                                  .append_copy_to_window:
  6670 00004AF0 8D3485[A0B20000]                        lea     esi, [mp3_synth_buf+eax*4]
  6671 00004AF7 8DBE00080000                            lea     edi, [esi+2048] ; [esi+512*4]
  6672 00004AFD B912000000                              mov     ecx, 18         ; (12h*4)/4
  6673 00004B02 F3A5                                    rep movsd
  6674 00004B04 E96CFEFFFF                              jmp     .append_copy_to_window_back
  6675                                  
  6676                                  
  6677                                  ; =============== S U B R O U T I N E =======================================
  6678                                  
  6679                                  
  6680                                  synth_16bit_shift_1_slow:
  6681 00004B09 F605[FC8A0000]10                        test    byte [cpuid_flags], 10h ; SYNTH_MACRO 0,1,0
  6682 00004B10 740E                                    jz      short .no_rdtsc_supported
  6683 00004B12 0F31                                    rdtsc
  6684 00004B14 2905[748C0000]                          sub     [rdtsc_synth_dct], eax
  6685 00004B1A 1915[788C0000]                          sbb     [rdtsc_synth_dct+4], edx
  6686                                  
  6687                                  .no_rdtsc_supported:
  6688 00004B20 BE[A8D20000]                            mov	esi, mp3_sb_samples
  6689 00004B25 8B3D[3C090100]                          mov	edi, [mp3_samples_dst]
  6690 00004B2B C705[48090100]0000-                     mov	dword [mp3_curr_channel], 0
  6690 00004B33 0000               
  6691                                  
  6692                                  .synth_channel_lop:
  6693 00004B35 56                                      push	esi
  6694 00004B36 57                                      push	edi
  6695 00004B37 893D[88B20000]                          mov	[mp3_curr_syn_dst], edi
  6696 00004B3D C705[50090100]0000-                     mov	dword [mp3_curr_frame], 0
  6696 00004B45 0000               
  6697                                  
  6698                                  .synth_frame_lop:
  6699 00004B47 56                                      push    esi
  6700 00004B48 F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
  6701 00004B4F 740E                                    jz      short .no_rdtsc_supported@
  6702 00004B51 0F31                                    rdtsc
  6703 00004B53 2905[8C8C0000]                          sub     [rdtsc_dct32], eax
  6704 00004B59 1915[908C0000]                          sbb     [rdtsc_dct32+4], edx
  6705                                  
  6706                                  .no_rdtsc_supported@:
  6707 00004B5F 8B15[48090100]                          mov     edx, [mp3_curr_channel]
  6708 00004B65 8B0495[A0D20000]                        mov     eax, [mp3_synth_index+edx*4]
  6709 00004B6C 832C95[A0D20000]20                      sub     dword [mp3_synth_index+edx*4], 32
  6710 00004B74 C1E20A                                  shl     edx, 10         ; channel*1024
  6711 00004B77 25E0010000                              and     eax, 1E0h       ; 1FFh-1Fh ; index(0..511), align 32
  6712 00004B7C 09D0                                    or      eax, edx
  6713 00004B7E A3[84B20000]                            mov     [mp3_curr_syn_index], eax
  6714 00004B83 8B3D[84B20000]                          mov     edi, [mp3_curr_syn_index]
  6715 00004B89 8D3CBD[A0B20000]                        lea     edi, [mp3_synth_buf+edi*4]
  6716 00004B90 E858E3FFFF                              call    mp3_dct32_shift_1 ; call mp3_dct32_shift_&rate_shift
  6717 00004B95 F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
  6718 00004B9C 740E                                    jz      short .no_rdtsc_supported@@
  6719 00004B9E 0F31                                    rdtsc
  6720 00004BA0 0105[8C8C0000]                          add     [rdtsc_dct32], eax
  6721 00004BA6 1115[908C0000]                          adc     [rdtsc_dct32+4], edx
  6722                                  
  6723                                  .no_rdtsc_supported@@:
  6724 00004BAC F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
  6725 00004BB3 740E                                    jz      short .no_rdtsc_supported@@@
  6726 00004BB5 0F31                                    rdtsc
  6727 00004BB7 2905[A48C0000]                          sub     [rdtsc_synth], eax
  6728 00004BBD 1915[A88C0000]                          sbb     [rdtsc_synth+4], edx
  6729                                  
  6730                                  .no_rdtsc_supported@@@:
  6731 00004BC3 E888000000                              call    mp3_synth_filter_this_16bit_shift_1_slow ;
  6732                                                                          ; mp3_synth_filter_this_&force_8bit&_&rate_shift&_&force_fast
  6733 00004BC8 F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
  6734 00004BCF 740E                                    jz      short .no_rdtsc_supported@@@@
  6735 00004BD1 0F31                                    rdtsc
  6736 00004BD3 0105[A48C0000]                          add     [rdtsc_synth], eax
  6737 00004BD9 1115[A88C0000]                          adc     [rdtsc_synth+4], edx
  6738                                  
  6739                                  .no_rdtsc_supported@@@@:
  6740 00004BDF 5E                                      pop     esi
  6741 00004BE0 A1[44090100]                            mov     eax, [mp3_samples_dst_step]
  6742 00004BE5 C1E005                                  shl     eax, 5
  6743 00004BE8 8A0D[F98A0000]                          mov     cl, [option_rate_shift] ; IF with_rate_shift
  6744 00004BEE D3E8                                    shr     eax, cl
  6745 00004BF0 0105[88B20000]                          add     [mp3_curr_syn_dst], eax
  6746 00004BF6 81C680000000                            add     esi, 128        ; SBLIMIT*4  ; src+32*4
  6747 00004BFC FF05[50090100]                          inc	dword [mp3_curr_frame]
  6748 00004C02 A1[50090100]                            mov     eax, [mp3_curr_frame]
  6749 00004C07 3B05[8CB20000]                          cmp     eax, [mp3_nb_frames]
  6750 00004C0D 0F8234FFFFFF                            jb      .synth_frame_lop
  6751 00004C13 5F                                      pop     edi
  6752 00004C14 5E                                      pop     esi
  6753 00004C15 033D[80B20000]                          add     edi, [mp3_bytes_per_sample]
  6754 00004C1B 81C600120000                            add     esi, 4608       ; 36*SBLIMIT*4 ; src
  6755 00004C21 FF05[48090100]                          inc	dword [mp3_curr_channel]
  6756 00004C27 A1[48090100]                            mov     eax, [mp3_curr_channel]
  6757 00004C2C 3B05[78B20000]                          cmp     eax, [mp3_output_num_channels]
  6758 00004C32 0F82FDFEFFFF                            jb      .synth_channel_lop
  6759 00004C38 F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
  6760 00004C3F 740E                                    jz      short .no_rdtsc_supported@@@@@
  6761 00004C41 0F31                                    rdtsc
  6762 00004C43 0105[748C0000]                          add     [rdtsc_synth_dct], eax
  6763 00004C49 1115[788C0000]                          adc     [rdtsc_synth_dct+4], edx
  6764                                  
  6765                                  .no_rdtsc_supported@@@@@:
  6766 00004C4F C3                                      retn
  6767                                  
  6768                                  
  6769                                  ; =============== S U B R O U T I N E =======================================
  6770                                  
  6771                                  
  6772                                  mp3_synth_filter_this_16bit_shift_1_slow:
  6773 00004C50 A1[84B20000]                            mov     eax, [mp3_curr_syn_index]
  6774 00004C55 A9E0010000                              test    eax, 1E0h
  6775 00004C5A 0F8482010000                            jz      .append_copy_to_window
  6776 00004C60 90                                      nop
  6777                                  
  6778                                  .append_copy_to_window_back:
  6779 00004C61 89C5                                    mov     ebp, eax
  6780 00004C63 81E5C0010000                            and     ebp, 1C0h
  6781 00004C69 2520040000                              and     eax, 420h
  6782 00004C6E 8D7010                                  lea     esi, [eax+10h]
  6783 00004C71 8D7830                                  lea     edi, [eax+30h]
  6784 00004C74 F7DD                                    neg     ebp
  6785 00004C76 81E5C0010000                            and     ebp, 1C0h
  6786 00004C7C 8B0D[88B20000]                          mov     ecx, [mp3_curr_syn_dst]
  6787                                  
  6788                                  .samples_lop:
  6789 00004C82 BB10001000                              mov     ebx, 100010h
  6790 00004C87 8B14B5[A0B20000]                        mov     edx, [mp3_synth_buf+esi*4]
  6791 00004C8E 8B04AD[58040500]                        mov     eax, [mp3_synth_win+ebp*4]
  6792 00004C95 F7EA                                    imul    edx
  6793 00004C97 01D3                                    add     ebx, edx
  6794 00004C99 8B14B5[A0B30000]                        mov     edx, [(mp3_synth_buf+100h)+esi*4]
  6795 00004CA0 8B04AD[58050500]                        mov     eax, [(mp3_synth_win+100h)+ebp*4]
  6796 00004CA7 F7EA                                    imul    edx
  6797 00004CA9 01D3                                    add     ebx, edx
  6798 00004CAB 8B14B5[A0B40000]                        mov     edx, [(mp3_synth_buf+200h)+esi*4]
  6799 00004CB2 8B04AD[58060500]                        mov     eax, [(mp3_synth_win+200h)+ebp*4]
  6800 00004CB9 F7EA                                    imul    edx
  6801 00004CBB 01D3                                    add     ebx, edx
  6802 00004CBD 8B14B5[A0B50000]                        mov     edx, [(mp3_synth_buf+300h)+esi*4]
  6803 00004CC4 8B04AD[58070500]                        mov     eax, [(mp3_synth_win+300h)+ebp*4]
  6804 00004CCB F7EA                                    imul    edx
  6805 00004CCD 01D3                                    add     ebx, edx
  6806 00004CCF 8B14B5[A0B60000]                        mov     edx, [(mp3_synth_buf+400h)+esi*4]
  6807 00004CD6 8B04AD[58080500]                        mov     eax, [(mp3_synth_win+400h)+ebp*4]
  6808 00004CDD F7EA                                    imul    edx
  6809 00004CDF 01D3                                    add     ebx, edx
  6810 00004CE1 8B14B5[A0B70000]                        mov     edx, [(mp3_synth_buf+500h)+esi*4]
  6811 00004CE8 8B04AD[58090500]                        mov     eax, [(mp3_synth_win+500h)+ebp*4]
  6812 00004CEF F7EA                                    imul    edx
  6813 00004CF1 01D3                                    add     ebx, edx
  6814 00004CF3 8B14B5[A0B80000]                        mov     edx, [(mp3_synth_buf+600h)+esi*4]
  6815 00004CFA 8B04AD[580A0500]                        mov     eax, [(mp3_synth_win+600h)+ebp*4]
  6816 00004D01 F7EA                                    imul    edx
  6817 00004D03 01D3                                    add     ebx, edx
  6818 00004D05 8B14B5[A0B90000]                        mov     edx, [(mp3_synth_buf+700h)+esi*4]
  6819 00004D0C 8B04AD[580B0500]                        mov     eax, [(mp3_synth_win+700h)+ebp*4]
  6820 00004D13 F7EA                                    imul    edx
  6821 00004D15 01D3                                    add     ebx, edx
  6822 00004D17 8B14BD[A0B20000]                        mov     edx, [mp3_synth_buf+edi*4]
  6823 00004D1E 8B04AD[D8040500]                        mov     eax, [(mp3_synth_win+80h)+ebp*4]
  6824 00004D25 F7EA                                    imul    edx
  6825 00004D27 01D3                                    add     ebx, edx
  6826 00004D29 8B14BD[A0B30000]                        mov     edx, [(mp3_synth_buf+100h)+edi*4]
  6827 00004D30 8B04AD[D8050500]                        mov     eax, [(mp3_synth_win+180h)+ebp*4]
  6828 00004D37 F7EA                                    imul    edx
  6829 00004D39 01D3                                    add     ebx, edx
  6830 00004D3B 8B14BD[A0B40000]                        mov     edx, [(mp3_synth_buf+200h)+edi*4]
  6831 00004D42 8B04AD[D8060500]                        mov     eax, [(mp3_synth_win+280h)+ebp*4]
  6832 00004D49 F7EA                                    imul    edx
  6833 00004D4B 01D3                                    add     ebx, edx
  6834 00004D4D 8B14BD[A0B50000]                        mov     edx, [(mp3_synth_buf+300h)+edi*4]
  6835 00004D54 8B04AD[D8070500]                        mov     eax, [(mp3_synth_win+380h)+ebp*4]
  6836 00004D5B F7EA                                    imul    edx
  6837 00004D5D 01D3                                    add     ebx, edx
  6838 00004D5F 8B14BD[A0B60000]                        mov     edx, [(mp3_synth_buf+400h)+edi*4]
  6839 00004D66 8B04AD[D8080500]                        mov     eax, [(mp3_synth_win+480h)+ebp*4]
  6840 00004D6D F7EA                                    imul    edx
  6841 00004D6F 01D3                                    add     ebx, edx
  6842 00004D71 8B14BD[A0B70000]                        mov     edx, [(mp3_synth_buf+500h)+edi*4]
  6843 00004D78 8B04AD[D8090500]                        mov     eax, [(mp3_synth_win+580h)+ebp*4]
  6844 00004D7F F7EA                                    imul    edx
  6845 00004D81 01D3                                    add     ebx, edx
  6846 00004D83 8B14BD[A0B80000]                        mov     edx, [(mp3_synth_buf+600h)+edi*4]
  6847 00004D8A 8B04AD[D80A0500]                        mov     eax, [(mp3_synth_win+680h)+ebp*4]
  6848 00004D91 F7EA                                    imul    edx
  6849 00004D93 01D3                                    add     ebx, edx
  6850 00004D95 8B14BD[A0B90000]                        mov     edx, [(mp3_synth_buf+700h)+edi*4]
  6851 00004D9C 8B04AD[D80B0500]                        mov     eax, [(mp3_synth_win+780h)+ebp*4]
  6852 00004DA3 F7EA                                    imul    edx
  6853 00004DA5 01D3                                    add     ebx, edx
  6854 00004DA7 81FB00002000                            cmp     ebx, 200000h
  6855 00004DAD 7328                                    jnb     short .sat
  6856 00004DAF C1FB05                                  sar     ebx, 5
  6857 00004DB2 81EB00800000                            sub     ebx, 8000h
  6858                                  
  6859                                  .sat_back:
  6860 00004DB8 668919                                  mov     [ecx], bx
  6861 00004DBB 030D[44090100]                          add     ecx, [mp3_samples_dst_step]
  6862 00004DC1 83C602                                  add     esi, 2
  6863 00004DC4 83EF02                                  sub     edi, 2
  6864 00004DC7 83C502                                  add     ebp, 2
  6865 00004DCA F7C51F000000                            test    ebp, 1Fh
  6866 00004DD0 0F85ACFEFFFF                            jnz     .samples_lop
  6867 00004DD6 C3                                      retn
  6868                                  
  6869                                  .sat:
  6870 00004DD7 C1FB1F                                  sar     ebx, 31
  6871 00004DDA 81F3FF7F0000                            xor     ebx, 7FFFh
  6872 00004DE0 EBD6                                    jmp     short .sat_back
  6873                                  
  6874                                  .append_copy_to_window:
  6875 00004DE2 8D3485[A0B20000]                        lea     esi, [mp3_synth_buf+eax*4]
  6876 00004DE9 8DBE00080000                            lea     edi, [esi+2048]
  6877 00004DEF B912000000                              mov     ecx, 18
  6878 00004DF4 F3A5                                    rep movsd
  6879 00004DF6 E966FEFFFF                              jmp     .append_copy_to_window_back
  6880                                  
  6881                                  
  6882                                  ; =============== S U B R O U T I N E =======================================
  6883                                  
  6884                                  
  6885                                  synth_16bit_shift_2_slow:
  6886 00004DFB F605[FC8A0000]10                        test    byte [cpuid_flags], 10h ; SYNTH_MACRO 0,2,0
  6887 00004E02 740E                                    jz      short .no_rdtsc_supported
  6888 00004E04 0F31                                    rdtsc
  6889 00004E06 2905[748C0000]                          sub     [rdtsc_synth_dct], eax
  6890 00004E0C 1915[788C0000]                          sbb     [rdtsc_synth_dct+4], edx
  6891                                  
  6892                                  .no_rdtsc_supported:
  6893 00004E12 BE[A8D20000]                            mov	esi, mp3_sb_samples
  6894 00004E17 8B3D[3C090100]                          mov	edi, [mp3_samples_dst]
  6895 00004E1D C705[48090100]0000-                     mov	dword [mp3_curr_channel], 0
  6895 00004E25 0000               
  6896                                  
  6897                                  .synth_channel_lop:
  6898 00004E27 56                                      push	esi
  6899 00004E28 57                                      push	edi
  6900 00004E29 893D[88B20000]                          mov	[mp3_curr_syn_dst], edi
  6901 00004E2F C705[50090100]0000-                     mov	dword [mp3_curr_frame], 0
  6901 00004E37 0000               
  6902                                  
  6903                                  .synth_frame_lop:
  6904 00004E39 56                                      push    esi
  6905 00004E3A F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
  6906 00004E41 740E                                    jz      short .no_rdtsc_supported@
  6907 00004E43 0F31                                    rdtsc
  6908 00004E45 2905[8C8C0000]                          sub     [rdtsc_dct32], eax
  6909 00004E4B 1915[908C0000]                          sbb     [rdtsc_dct32+4], edx
  6910                                  
  6911                                  .no_rdtsc_supported@:
  6912 00004E51 8B15[48090100]                          mov     edx, [mp3_curr_channel]
  6913 00004E57 8B0495[A0D20000]                        mov     eax, [mp3_synth_index+edx*4]
  6914 00004E5E 832C95[A0D20000]20                      sub     dword [mp3_synth_index+edx*4], 32
  6915 00004E66 C1E20A                                  shl     edx, 10
  6916 00004E69 25E0010000                              and     eax, 1E0h       ; 1FFh-1Fh
  6917 00004E6E 09D0                                    or      eax, edx
  6918 00004E70 A3[84B20000]                            mov     [mp3_curr_syn_index], eax
  6919 00004E75 8B3D[84B20000]                          mov     edi, [mp3_curr_syn_index]
  6920 00004E7B 8D3CBD[A0B20000]                        lea     edi, [mp3_synth_buf+edi*4]
  6921 00004E82 E856E4FFFF                              call    mp3_dct32_shift_2 ; call mp3_dct32_shift_&rate_shift
  6922 00004E87 F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
  6923 00004E8E 740E                                    jz      short .no_rdtsc_supported@@
  6924 00004E90 0F31                                    rdtsc
  6925 00004E92 0105[8C8C0000]                          add     [rdtsc_dct32], eax
  6926 00004E98 1115[908C0000]                          adc     [rdtsc_dct32+4], edx
  6927                                  
  6928                                  .no_rdtsc_supported@@:
  6929 00004E9E F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
  6930 00004EA5 740E                                    jz      short .no_rdtsc_supported@@@
  6931 00004EA7 0F31                                    rdtsc
  6932 00004EA9 2905[A48C0000]                          sub     [rdtsc_synth], eax
  6933 00004EAF 1915[A88C0000]                          sbb     [rdtsc_synth+4], edx
  6934                                  
  6935                                  .no_rdtsc_supported@@@:
  6936 00004EB5 E888000000                              call    mp3_synth_filter_this_16bit_shift_2_slow ;
  6937                                                                          ; mp3_synth_filter_this_&force_8bit&_&rate_shift&_&force_fast
  6938 00004EBA F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
  6939 00004EC1 740E                                    jz      short .no_rdtsc_supported@@@@
  6940 00004EC3 0F31                                    rdtsc
  6941 00004EC5 0105[A48C0000]                          add     [rdtsc_synth], eax
  6942 00004ECB 1115[A88C0000]                          adc     [rdtsc_synth+4], edx
  6943                                  
  6944                                  .no_rdtsc_supported@@@@:
  6945 00004ED1 5E                                      pop     esi
  6946 00004ED2 A1[44090100]                            mov     eax, [mp3_samples_dst_step]
  6947 00004ED7 C1E005                                  shl     eax, 5
  6948 00004EDA 8A0D[F98A0000]                          mov     cl, [option_rate_shift]
  6949 00004EE0 D3E8                                    shr     eax, cl
  6950 00004EE2 0105[88B20000]                          add     [mp3_curr_syn_dst], eax
  6951 00004EE8 81C680000000                            add     esi, 128        ; SBLIMIT*4
  6952 00004EEE FF05[50090100]                          inc     dword [mp3_curr_frame]
  6953 00004EF4 A1[50090100]                            mov     eax, [mp3_curr_frame]
  6954 00004EF9 3B05[8CB20000]                          cmp     eax, [mp3_nb_frames]
  6955 00004EFF 0F8234FFFFFF                            jb      .synth_frame_lop
  6956 00004F05 5F                                      pop     edi
  6957 00004F06 5E                                      pop     esi
  6958 00004F07 033D[80B20000]                          add     edi, [mp3_bytes_per_sample]
  6959 00004F0D 81C600120000                            add     esi, 4608       ; 36*SBLIMIT*4
  6960 00004F13 FF05[48090100]                          inc     dword [mp3_curr_channel]
  6961 00004F19 A1[48090100]                            mov     eax, [mp3_curr_channel]
  6962 00004F1E 3B05[78B20000]                          cmp     eax, [mp3_output_num_channels]
  6963 00004F24 0F82FDFEFFFF                            jb      .synth_channel_lop
  6964 00004F2A F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
  6965 00004F31 740E                                    jz      short .no_rdtsc_supported@@@@@
  6966 00004F33 0F31                                    rdtsc
  6967 00004F35 0105[748C0000]                          add     [rdtsc_synth_dct], eax
  6968 00004F3B 1115[788C0000]                          adc     [rdtsc_synth_dct+4], edx
  6969                                  
  6970                                  .no_rdtsc_supported@@@@@:
  6971 00004F41 C3                                      retn
  6972                                  
  6973                                  
  6974                                  ; =============== S U B R O U T I N E =======================================
  6975                                  
  6976                                  
  6977                                  mp3_synth_filter_this_16bit_shift_2_slow:
  6978 00004F42 A1[84B20000]                            mov     eax, [mp3_curr_syn_index]
  6979 00004F47 A9E0010000                              test    eax, 1E0h
  6980 00004F4C 0F8482010000                            jz      .append_copy_to_window
  6981 00004F52 90                                      nop
  6982                                  
  6983                                  .append_copy_to_window_back:
  6984 00004F53 89C5                                    mov     ebp, eax
  6985 00004F55 81E5C0010000                            and     ebp, 1C0h
  6986 00004F5B 2520040000                              and     eax, 420h
  6987 00004F60 8D7010                                  lea     esi, [eax+10h]
  6988 00004F63 8D7830                                  lea     edi, [eax+30h]
  6989 00004F66 F7DD                                    neg     ebp
  6990 00004F68 81E5C0010000                            and     ebp, 1C0h
  6991 00004F6E 8B0D[88B20000]                          mov     ecx, [mp3_curr_syn_dst]
  6992                                  
  6993                                  .samples_lop:
  6994 00004F74 BB10001000                              mov     ebx, 100010h
  6995 00004F79 8B14B5[A0B20000]                        mov     edx, [mp3_synth_buf+esi*4]
  6996 00004F80 8B04AD[58040500]                        mov     eax, [mp3_synth_win+ebp*4]
  6997 00004F87 F7EA                                    imul    edx
  6998 00004F89 01D3                                    add     ebx, edx
  6999 00004F8B 8B14B5[A0B30000]                        mov     edx, [(mp3_synth_buf+100h)+esi*4]
  7000 00004F92 8B04AD[58050500]                        mov     eax, [(mp3_synth_win+100h)+ebp*4]
  7001 00004F99 F7EA                                    imul    edx
  7002 00004F9B 01D3                                    add     ebx, edx
  7003 00004F9D 8B14B5[A0B40000]                        mov     edx, [(mp3_synth_buf+200h)+esi*4]
  7004 00004FA4 8B04AD[58060500]                        mov     eax, [(mp3_synth_win+200h)+ebp*4]
  7005 00004FAB F7EA                                    imul    edx
  7006 00004FAD 01D3                                    add     ebx, edx
  7007 00004FAF 8B14B5[A0B50000]                        mov     edx, [(mp3_synth_buf+300h)+esi*4]
  7008 00004FB6 8B04AD[58070500]                        mov     eax, [(mp3_synth_win+300h)+ebp*4]
  7009 00004FBD F7EA                                    imul    edx
  7010 00004FBF 01D3                                    add     ebx, edx
  7011 00004FC1 8B14B5[A0B60000]                        mov     edx, [(mp3_synth_buf+400h)+esi*4]
  7012 00004FC8 8B04AD[58080500]                        mov     eax, [(mp3_synth_win+400h)+ebp*4]
  7013 00004FCF F7EA                                    imul    edx
  7014 00004FD1 01D3                                    add     ebx, edx
  7015 00004FD3 8B14B5[A0B70000]                        mov     edx, [(mp3_synth_buf+500h)+esi*4]
  7016 00004FDA 8B04AD[58090500]                        mov     eax, [(mp3_synth_win+500h)+ebp*4]
  7017 00004FE1 F7EA                                    imul    edx
  7018 00004FE3 01D3                                    add     ebx, edx
  7019 00004FE5 8B14B5[A0B80000]                        mov     edx, [(mp3_synth_buf+600h)+esi*4]
  7020 00004FEC 8B04AD[580A0500]                        mov     eax, [(mp3_synth_win+600h)+ebp*4]
  7021 00004FF3 F7EA                                    imul    edx
  7022 00004FF5 01D3                                    add     ebx, edx
  7023 00004FF7 8B14B5[A0B90000]                        mov     edx, [(mp3_synth_buf+700h)+esi*4]
  7024 00004FFE 8B04AD[580B0500]                        mov     eax, [(mp3_synth_win+700h)+ebp*4]
  7025 00005005 F7EA                                    imul    edx
  7026 00005007 01D3                                    add     ebx, edx
  7027 00005009 8B14BD[A0B20000]                        mov     edx, [mp3_synth_buf+edi*4]
  7028 00005010 8B04AD[D8040500]                        mov     eax, [(mp3_synth_win+80h)+ebp*4]
  7029 00005017 F7EA                                    imul    edx
  7030 00005019 01D3                                    add     ebx, edx
  7031 0000501B 8B14BD[A0B30000]                        mov     edx, [(mp3_synth_buf+100h)+edi*4]
  7032 00005022 8B04AD[D8050500]                        mov     eax, [(mp3_synth_win+180h)+ebp*4]
  7033 00005029 F7EA                                    imul    edx
  7034 0000502B 01D3                                    add     ebx, edx
  7035 0000502D 8B14BD[A0B40000]                        mov     edx, [(mp3_synth_buf+200h)+edi*4]
  7036 00005034 8B04AD[D8060500]                        mov     eax, [(mp3_synth_win+280h)+ebp*4]
  7037 0000503B F7EA                                    imul    edx
  7038 0000503D 01D3                                    add     ebx, edx
  7039 0000503F 8B14BD[A0B50000]                        mov     edx, [(mp3_synth_buf+300h)+edi*4]
  7040 00005046 8B04AD[D8070500]                        mov     eax, [(mp3_synth_win+380h)+ebp*4]
  7041 0000504D F7EA                                    imul    edx
  7042 0000504F 01D3                                    add     ebx, edx
  7043 00005051 8B14BD[A0B60000]                        mov     edx, [(mp3_synth_buf+400h)+edi*4]
  7044 00005058 8B04AD[D8080500]                        mov     eax, [(mp3_synth_win+480h)+ebp*4]
  7045 0000505F F7EA                                    imul    edx
  7046 00005061 01D3                                    add     ebx, edx
  7047 00005063 8B14BD[A0B70000]                        mov     edx, [(mp3_synth_buf+500h)+edi*4]
  7048 0000506A 8B04AD[D8090500]                        mov     eax, [(mp3_synth_win+580h)+ebp*4]
  7049 00005071 F7EA                                    imul    edx
  7050 00005073 01D3                                    add     ebx, edx
  7051 00005075 8B14BD[A0B80000]                        mov     edx, [(mp3_synth_buf+600h)+edi*4]
  7052 0000507C 8B04AD[D80A0500]                        mov     eax, [(mp3_synth_win+680h)+ebp*4]
  7053 00005083 F7EA                                    imul    edx
  7054 00005085 01D3                                    add     ebx, edx
  7055 00005087 8B14BD[A0B90000]                        mov     edx, [(mp3_synth_buf+700h)+edi*4]
  7056 0000508E 8B04AD[D80B0500]                        mov     eax, [(mp3_synth_win+780h)+ebp*4]
  7057 00005095 F7EA                                    imul    edx
  7058 00005097 01D3                                    add     ebx, edx
  7059 00005099 81FB00002000                            cmp     ebx, 200000h
  7060 0000509F 7328                                    jnb     short .sat
  7061 000050A1 C1FB05                                  sar     ebx, 5
  7062 000050A4 81EB00800000                            sub     ebx, 8000h
  7063                                  
  7064                                  .sat_back:
  7065 000050AA 668919                                  mov     [ecx], bx
  7066 000050AD 030D[44090100]                          add     ecx, [mp3_samples_dst_step]
  7067 000050B3 83C604                                  add     esi, 4
  7068 000050B6 83EF04                                  sub     edi, 4
  7069 000050B9 83C504                                  add     ebp, 4
  7070 000050BC F7C51F000000                            test    ebp, 1Fh
  7071 000050C2 0F85ACFEFFFF                            jnz     .samples_lop
  7072 000050C8 C3                                      retn
  7073                                  
  7074                                  .sat:
  7075 000050C9 C1FB1F                                  sar     ebx, 31
  7076 000050CC 81F3FF7F0000                            xor     ebx, 7FFFh
  7077 000050D2 EBD6                                    jmp     short .sat_back
  7078                                  
  7079                                  .append_copy_to_window:
  7080 000050D4 8D3485[A0B20000]                        lea     esi, [mp3_synth_buf+eax*4]
  7081 000050DB 8DBE00080000                            lea     edi, [esi+2048]
  7082 000050E1 B912000000                              mov     ecx, 18
  7083 000050E6 F3A5                                    rep movsd
  7084 000050E8 E966FEFFFF                              jmp     .append_copy_to_window_back
  7085                                  
  7086                                  
  7087                                  ; =============== S U B R O U T I N E =======================================
  7088                                  
  7089                                  
  7090                                  synth_8bit_shift_0_slow:
  7091 000050ED F605[FC8A0000]10                        test    byte [cpuid_flags], 10h ; SYNTH_MACRO 1,0,0
  7092 000050F4 740E                                    jz      short .no_rdtsc_supported
  7093 000050F6 0F31                                    rdtsc
  7094 000050F8 2905[748C0000]                          sub     [rdtsc_synth_dct], eax
  7095 000050FE 1915[788C0000]                          sbb     [rdtsc_synth_dct+4], edx
  7096                                  
  7097                                  .no_rdtsc_supported:
  7098 00005104 BE[A8D20000]                            mov	esi, mp3_sb_samples
  7099 00005109 8B3D[3C090100]                          mov	edi, [mp3_samples_dst]
  7100 0000510F C705[48090100]0000-                     mov	dword [mp3_curr_channel], 0
  7100 00005117 0000               
  7101                                  
  7102                                  .synth_channel_lop:
  7103 00005119 56                                      push	esi
  7104 0000511A 57                                      push	edi
  7105 0000511B 893D[88B20000]                          mov	[mp3_curr_syn_dst], edi
  7106 00005121 C705[50090100]0000-                     mov	dword [mp3_curr_frame], 0
  7106 00005129 0000               
  7107                                  
  7108                                  .synth_frame_lop:
  7109 0000512B 56                                      push    esi
  7110 0000512C F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
  7111 00005133 740E                                    jz      short .no_rdtsc_supported@
  7112 00005135 0F31                                    rdtsc
  7113 00005137 2905[8C8C0000]                          sub     [rdtsc_dct32], eax
  7114 0000513D 1915[908C0000]                          sbb     [rdtsc_dct32+4], edx
  7115                                  
  7116                                  .no_rdtsc_supported@:
  7117 00005143 8B15[48090100]                          mov     edx, [mp3_curr_channel]
  7118 00005149 8B0495[A0D20000]                        mov     eax, [mp3_synth_index+edx*4]
  7119 00005150 832C95[A0D20000]20                      sub     dword [mp3_synth_index+edx*4], 32
  7120 00005158 C1E20A                                  shl     edx, 10
  7121 0000515B 25E0010000                              and     eax, 1E0h       ; 1FFh-1Fh
  7122 00005160 09D0                                    or      eax, edx
  7123 00005162 A3[84B20000]                            mov     [mp3_curr_syn_index], eax
  7124 00005167 8B3D[84B20000]                          mov     edi, [mp3_curr_syn_index]
  7125 0000516D 8D3CBD[A0B20000]                        lea     edi, [mp3_synth_buf+edi*4]
  7126 00005174 E894D4FFFF                              call    mp3_dct32_shift_0
  7127 00005179 F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
  7128 00005180 740E                                    jz      short .no_rdtsc_supported@@
  7129 00005182 0F31                                    rdtsc
  7130 00005184 0105[8C8C0000]                          add     [rdtsc_dct32], eax
  7131 0000518A 1115[908C0000]                          adc     [rdtsc_dct32+4], edx
  7132                                  
  7133                                  .no_rdtsc_supported@@:
  7134 00005190 F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
  7135 00005197 740E                                    jz      short .no_rdtsc_supported@@@
  7136 00005199 0F31                                    rdtsc
  7137 0000519B 2905[A48C0000]                          sub     [rdtsc_synth], eax
  7138 000051A1 1915[A88C0000]                          sbb     [rdtsc_synth+4], edx
  7139                                  
  7140                                  .no_rdtsc_supported@@@:
  7141 000051A7 E888000000                              call    mp3_synth_filter_this_8bit_shift_0_slow ;
  7142                                                                          ; mp3_synth_filter_this_&force_8bit&_&rate_shift&_&force_fast
  7143 000051AC F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
  7144 000051B3 740E                                    jz      short .no_rdtsc_supported@@@@
  7145 000051B5 0F31                                    rdtsc
  7146 000051B7 0105[A48C0000]                          add     [rdtsc_synth], eax
  7147 000051BD 1115[A88C0000]                          adc     [rdtsc_synth+4], edx
  7148                                  
  7149                                  .no_rdtsc_supported@@@@:
  7150 000051C3 5E                                      pop     esi
  7151 000051C4 A1[44090100]                            mov     eax, [mp3_samples_dst_step]
  7152 000051C9 C1E005                                  shl     eax, 5
  7153 000051CC 8A0D[F98A0000]                          mov     cl, [option_rate_shift]
  7154 000051D2 D3E8                                    shr     eax, cl
  7155 000051D4 0105[88B20000]                          add     [mp3_curr_syn_dst], eax
  7156 000051DA 81C680000000                            add     esi, 128        ; SBLIMIT*4
  7157 000051E0 FF05[50090100]                          inc     dword [mp3_curr_frame]
  7158 000051E6 A1[50090100]                            mov     eax, [mp3_curr_frame]
  7159 000051EB 3B05[8CB20000]                          cmp     eax, [mp3_nb_frames]
  7160 000051F1 0F8234FFFFFF                            jb      .synth_frame_lop
  7161 000051F7 5F                                      pop     edi
  7162 000051F8 5E                                      pop     esi
  7163 000051F9 033D[80B20000]                          add     edi, [mp3_bytes_per_sample]
  7164 000051FF 81C600120000                            add     esi, 4608       ; 36*SBLIMIT*4
  7165 00005205 FF05[48090100]                          inc     dword [mp3_curr_channel]
  7166 0000520B A1[48090100]                            mov     eax, [mp3_curr_channel]
  7167 00005210 3B05[78B20000]                          cmp     eax, [mp3_output_num_channels]
  7168 00005216 0F82FDFEFFFF                            jb      .synth_channel_lop
  7169 0000521C F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
  7170 00005223 740E                                    jz      short .no_rdtsc_supported@@@@@
  7171 00005225 0F31                                    rdtsc
  7172 00005227 0105[748C0000]                          add     [rdtsc_synth_dct], eax
  7173 0000522D 1115[788C0000]                          adc     [rdtsc_synth_dct+4], edx
  7174                                  
  7175                                  .no_rdtsc_supported@@@@@:
  7176 00005233 C3                                      retn
  7177                                  
  7178                                  
  7179                                  ; =============== S U B R O U T I N E =======================================
  7180                                  
  7181                                  
  7182                                  mp3_synth_filter_this_8bit_shift_0_slow:
  7183 00005234 A1[84B20000]                            mov     eax, [mp3_curr_syn_index]
  7184 00005239 A9E0010000                              test    eax, 1E0h
  7185 0000523E 0F8471010000                            jz      .append_copy_to_window
  7186 00005244 90                                      nop
  7187                                  
  7188                                  .append_copy_to_window_back:
  7189 00005245 89C5                                    mov     ebp, eax
  7190 00005247 81E5C0010000                            and     ebp, 1C0h
  7191 0000524D 2520040000                              and     eax, 420h
  7192 00005252 8D7010                                  lea     esi, [eax+10h]
  7193 00005255 8D7830                                  lea     edi, [eax+30h]
  7194 00005258 F7DD                                    neg     ebp
  7195 0000525A 81E5C0010000                            and     ebp, 1C0h
  7196 00005260 8B0D[88B20000]                          mov     ecx, [mp3_curr_syn_dst]
  7197                                  
  7198                                  .samples_lop:
  7199 00005266 BB00101000                              mov     ebx, 101000h
  7200 0000526B 8B14B5[A0B20000]                        mov     edx, [mp3_synth_buf+esi*4]
  7201 00005272 8B04AD[58040500]                        mov     eax, [mp3_synth_win+ebp*4]
  7202 00005279 F7EA                                    imul    edx
  7203 0000527B 01D3                                    add     ebx, edx
  7204 0000527D 8B14B5[A0B30000]                        mov     edx, [(mp3_synth_buf+100h)+esi*4]
  7205 00005284 8B04AD[58050500]                        mov     eax, [(mp3_synth_win+100h)+ebp*4]
  7206 0000528B F7EA                                    imul    edx
  7207 0000528D 01D3                                    add     ebx, edx
  7208 0000528F 8B14B5[A0B40000]                        mov     edx, [(mp3_synth_buf+200h)+esi*4]
  7209 00005296 8B04AD[58060500]                        mov     eax, [(mp3_synth_win+200h)+ebp*4]
  7210 0000529D F7EA                                    imul    edx
  7211 0000529F 01D3                                    add     ebx, edx
  7212 000052A1 8B14B5[A0B50000]                        mov     edx, [(mp3_synth_buf+300h)+esi*4]
  7213 000052A8 8B04AD[58070500]                        mov     eax, [(mp3_synth_win+300h)+ebp*4]
  7214 000052AF F7EA                                    imul    edx
  7215 000052B1 01D3                                    add     ebx, edx
  7216 000052B3 8B14B5[A0B60000]                        mov     edx, [(mp3_synth_buf+400h)+esi*4]
  7217 000052BA 8B04AD[58080500]                        mov     eax, [(mp3_synth_win+400h)+ebp*4]
  7218 000052C1 F7EA                                    imul    edx
  7219 000052C3 01D3                                    add     ebx, edx
  7220 000052C5 8B14B5[A0B70000]                        mov     edx, [(mp3_synth_buf+500h)+esi*4]
  7221 000052CC 8B04AD[58090500]                        mov     eax, [(mp3_synth_win+500h)+ebp*4]
  7222 000052D3 F7EA                                    imul    edx
  7223 000052D5 01D3                                    add     ebx, edx
  7224 000052D7 8B14B5[A0B80000]                        mov     edx, [(mp3_synth_buf+600h)+esi*4]
  7225 000052DE 8B04AD[580A0500]                        mov     eax, [(mp3_synth_win+600h)+ebp*4]
  7226 000052E5 F7EA                                    imul    edx
  7227 000052E7 01D3                                    add     ebx, edx
  7228 000052E9 8B14B5[A0B90000]                        mov     edx, [(mp3_synth_buf+700h)+esi*4]
  7229 000052F0 8B04AD[580B0500]                        mov     eax, [(mp3_synth_win+700h)+ebp*4]
  7230 000052F7 F7EA                                    imul    edx
  7231 000052F9 01D3                                    add     ebx, edx
  7232 000052FB 8B14BD[A0B20000]                        mov     edx, [mp3_synth_buf+edi*4]
  7233 00005302 8B04AD[D8040500]                        mov     eax, [(mp3_synth_win+80h)+ebp*4]
  7234 00005309 F7EA                                    imul    edx
  7235 0000530B 01D3                                    add     ebx, edx
  7236 0000530D 8B14BD[A0B30000]                        mov     edx, [(mp3_synth_buf+100h)+edi*4]
  7237 00005314 8B04AD[D8050500]                        mov     eax, [(mp3_synth_win+180h)+ebp*4]
  7238 0000531B F7EA                                    imul    edx
  7239 0000531D 01D3                                    add     ebx, edx
  7240 0000531F 8B14BD[A0B40000]                        mov     edx, [(mp3_synth_buf+200h)+edi*4]
  7241 00005326 8B04AD[D8060500]                        mov     eax, [(mp3_synth_win+280h)+ebp*4]
  7242 0000532D F7EA                                    imul    edx
  7243 0000532F 01D3                                    add     ebx, edx
  7244 00005331 8B14BD[A0B50000]                        mov     edx, [(mp3_synth_buf+300h)+edi*4]
  7245 00005338 8B04AD[D8070500]                        mov     eax, [(mp3_synth_win+380h)+ebp*4]
  7246 0000533F F7EA                                    imul    edx
  7247 00005341 01D3                                    add     ebx, edx
  7248 00005343 8B14BD[A0B60000]                        mov     edx, [(mp3_synth_buf+400h)+edi*4]
  7249 0000534A 8B04AD[D8080500]                        mov     eax, [(mp3_synth_win+480h)+ebp*4]
  7250 00005351 F7EA                                    imul    edx
  7251 00005353 01D3                                    add     ebx, edx
  7252 00005355 8B14BD[A0B70000]                        mov     edx, [(mp3_synth_buf+500h)+edi*4]
  7253 0000535C 8B04AD[D8090500]                        mov     eax, [(mp3_synth_win+580h)+ebp*4]
  7254 00005363 F7EA                                    imul    edx
  7255 00005365 01D3                                    add     ebx, edx
  7256 00005367 8B14BD[A0B80000]                        mov     edx, [(mp3_synth_buf+600h)+edi*4]
  7257 0000536E 8B04AD[D80A0500]                        mov     eax, [(mp3_synth_win+680h)+ebp*4]
  7258 00005375 F7EA                                    imul    edx
  7259 00005377 01D3                                    add     ebx, edx
  7260 00005379 8B14BD[A0B90000]                        mov     edx, [(mp3_synth_buf+700h)+edi*4]
  7261 00005380 8B04AD[D80B0500]                        mov     eax, [(mp3_synth_win+780h)+ebp*4]
  7262 00005387 F7EA                                    imul    edx
  7263 00005389 01D3                                    add     ebx, edx
  7264 0000538B 81FB00002000                            cmp     ebx, 200000h
  7265 00005391 731B                                    jnb     short .sat
  7266 00005393 C1FB0D                                  sar     ebx, 13
  7267                                  
  7268                                  .sat_back:
  7269 00005396 8819                                    mov     [ecx], bl
  7270 00005398 030D[44090100]                          add     ecx, [mp3_samples_dst_step]
  7271 0000539E 46                                      inc     esi
  7272 0000539F 4F                                      dec     edi
  7273 000053A0 45                                      inc     ebp
  7274 000053A1 F7C51F000000                            test    ebp, 1Fh
  7275 000053A7 0F85B9FEFFFF                            jnz     .samples_lop
  7276 000053AD C3                                      retn
  7277                                  
  7278                                  .sat:
  7279 000053AE C1FB1F                                  sar     ebx, 31
  7280 000053B1 F7D3                                    not     ebx
  7281 000053B3 EBE1                                    jmp     short .sat_back
  7282                                  
  7283                                  .append_copy_to_window:
  7284 000053B5 8D3485[A0B20000]                        lea     esi, [mp3_synth_buf+eax*4]
  7285 000053BC 8DBE00080000                            lea     edi, [esi+2048]
  7286 000053C2 B912000000                              mov     ecx, 18
  7287 000053C7 F3A5                                    rep movsd
  7288 000053C9 E977FEFFFF                              jmp     .append_copy_to_window_back
  7289                                  
  7290                                  
  7291                                  ; =============== S U B R O U T I N E =======================================
  7292                                  
  7293                                  
  7294                                  synth_8bit_shift_1_slow:
  7295 000053CE F605[FC8A0000]10                        test    byte [cpuid_flags], 10h ; SYNTH_MACRO 1,1,0
  7296                                                                          ; force_8bit, rate_shift=1, force_fast=0
  7297 000053D5 740E                                    jz      short .no_rdtsc_supported
  7298 000053D7 0F31                                    rdtsc
  7299 000053D9 2905[748C0000]                          sub     [rdtsc_synth_dct], eax
  7300 000053DF 1915[788C0000]                          sbb     [rdtsc_synth_dct+4], edx
  7301                                  
  7302                                  .no_rdtsc_supported:
  7303 000053E5 BE[A8D20000]                            mov	esi, mp3_sb_samples
  7304 000053EA 8B3D[3C090100]                          mov	edi, [mp3_samples_dst]
  7305 000053F0 C705[48090100]0000-                     mov	dword [mp3_curr_channel], 0
  7305 000053F8 0000               
  7306                                  
  7307                                  .synth_channel_lop:
  7308 000053FA 56                                      push	esi
  7309 000053FB 57                                      push	edi
  7310 000053FC 893D[88B20000]                          mov	[mp3_curr_syn_dst], edi
  7311 00005402 C705[50090100]0000-                     mov	dword [mp3_curr_frame], 0
  7311 0000540A 0000               
  7312                                  
  7313                                  .synth_frame_lop:
  7314 0000540C 56                                      push    esi
  7315 0000540D F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
  7316 00005414 740E                                    jz      short .no_rdtsc_supported@
  7317 00005416 0F31                                    rdtsc
  7318 00005418 2905[8C8C0000]                          sub     [rdtsc_dct32], eax
  7319 0000541E 1915[908C0000]                          sbb     [rdtsc_dct32+4], edx
  7320                                  
  7321                                  .no_rdtsc_supported@:
  7322 00005424 8B15[48090100]                          mov     edx, [mp3_curr_channel]
  7323 0000542A 8B0495[A0D20000]                        mov     eax, [mp3_synth_index+edx*4]
  7324 00005431 832C95[A0D20000]20                      sub     dword [mp3_synth_index+edx*4], 32
  7325 00005439 C1E20A                                  shl     edx, 10
  7326 0000543C 25E0010000                              and     eax, 1E0h       ; 1FFh-1Fh
  7327 00005441 09D0                                    or      eax, edx
  7328 00005443 A3[84B20000]                            mov     [mp3_curr_syn_index], eax
  7329 00005448 8B3D[84B20000]                          mov     edi, [mp3_curr_syn_index]
  7330 0000544E 8D3CBD[A0B20000]                        lea     edi, [mp3_synth_buf+edi*4]
  7331 00005455 E893DAFFFF                              call    mp3_dct32_shift_1 ; mp3_dct32_shift_&rate_shift ; rate_shift = 1
  7332 0000545A F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
  7333 00005461 740E                                    jz      short .no_rdtsc_supported@@
  7334 00005463 0F31                                    rdtsc
  7335 00005465 0105[8C8C0000]                          add     [rdtsc_dct32], eax
  7336 0000546B 1115[908C0000]                          adc     [rdtsc_dct32+4], edx
  7337                                  
  7338                                  .no_rdtsc_supported@@:
  7339 00005471 F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
  7340 00005478 740E                                    jz      short .no_rdtsc_supported@@@
  7341 0000547A 0F31                                    rdtsc
  7342 0000547C 2905[A48C0000]                          sub     [rdtsc_synth], eax
  7343 00005482 1915[A88C0000]                          sbb     [rdtsc_synth+4], edx
  7344                                  
  7345                                  .no_rdtsc_supported@@@:
  7346 00005488 E888000000                              call    mp3_synth_filter_this_8bit_shift_1_slow ;
  7347                                                                          ; mp3_synth_filter_this_&force_8bit&_&rate_shift&_&force_fast
  7348 0000548D F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
  7349 00005494 740E                                    jz      short .no_rdtsc_supported@@@@
  7350 00005496 0F31                                    rdtsc
  7351 00005498 0105[A48C0000]                          add     [rdtsc_synth], eax
  7352 0000549E 1115[A88C0000]                          adc     [rdtsc_synth+4], edx
  7353                                  
  7354                                  .no_rdtsc_supported@@@@:
  7355 000054A4 5E                                      pop     esi
  7356 000054A5 A1[44090100]                            mov     eax, [mp3_samples_dst_step]
  7357 000054AA C1E005                                  shl     eax, 5          ; mul32
  7358 000054AD 8A0D[F98A0000]                          mov     cl, [option_rate_shift]
  7359 000054B3 D3E8                                    shr     eax, cl
  7360 000054B5 0105[88B20000]                          add     [mp3_curr_syn_dst], eax
  7361 000054BB 81C680000000                            add     esi, 128        ; SBLIMIT*4
  7362 000054C1 FF05[50090100]                          inc	dword [mp3_curr_frame]
  7363 000054C7 A1[50090100]                            mov     eax, [mp3_curr_frame]
  7364 000054CC 3B05[8CB20000]                          cmp     eax, [mp3_nb_frames]
  7365 000054D2 0F8234FFFFFF                            jb      .synth_frame_lop
  7366 000054D8 5F                                      pop     edi
  7367 000054D9 5E                                      pop     esi
  7368 000054DA 033D[80B20000]                          add     edi, [mp3_bytes_per_sample]
  7369 000054E0 81C600120000                            add     esi, 4608       ; 36*SBLIMIT*4
  7370 000054E6 FF05[48090100]                          inc	dword [mp3_curr_channel]
  7371 000054EC A1[48090100]                            mov     eax, [mp3_curr_channel]
  7372 000054F1 3B05[78B20000]                          cmp     eax, [mp3_output_num_channels]
  7373 000054F7 0F82FDFEFFFF                            jb      .synth_channel_lop
  7374 000054FD F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
  7375 00005504 740E                                    jz      short .no_rdtsc_supported@@@@@
  7376 00005506 0F31                                    rdtsc
  7377 00005508 0105[748C0000]                          add     [rdtsc_synth_dct], eax
  7378 0000550E 1115[788C0000]                          adc     [rdtsc_synth_dct+4], edx
  7379                                  
  7380                                  .no_rdtsc_supported@@@@@:
  7381 00005514 C3                                      retn
  7382                                  
  7383                                  
  7384                                  ; =============== S U B R O U T I N E =======================================
  7385                                  
  7386                                  
  7387                                  mp3_synth_filter_this_8bit_shift_1_slow:
  7388 00005515 A1[84B20000]                            mov     eax, [mp3_curr_syn_index] ; IF LONG_WINDOW
  7389 0000551A A9E0010000                              test    eax, 1E0h       ; 1FFh-1Fh
  7390 0000551F 0F8477010000                            jz      .append_copy_to_window
  7391 00005525 90                                      nop
  7392                                  
  7393                                  .append_copy_to_window_back:
  7394 00005526 89C5                                    mov     ebp, eax
  7395 00005528 81E5C0010000                            and     ebp, 1C0h       ; 1FFh-1Fh-20h
  7396 0000552E 2520040000                              and     eax, 420h       ; 20h+(1 shl 10)
  7397 00005533 8D7010                                  lea     esi, [eax+10h]
  7398 00005536 8D7830                                  lea     edi, [eax+30h]
  7399 00005539 F7DD                                    neg     ebp
  7400 0000553B 81E5C0010000                            and     ebp, 1C0h
  7401 00005541 8B0D[88B20000]                          mov     ecx, [mp3_curr_syn_dst]
  7402                                  
  7403                                  .samples_lop:
  7404 00005547 BB00101000                              mov     ebx, 101000h    ; mov @@sum,(8000h SHL (@@out_shift))+(1 SHL (@@out_shift-1))
  7405                                                                          ; @@out_shift equ (OUT_SHIFT_slow+(8*force_8bit))
  7406                                                                          ; OUT_SHIFT_slow = 5 ; @@out_shift = 13
  7407 0000554C 8B14B5[A0B20000]                        mov     edx, [mp3_synth_buf+esi*4] ; @@SUM8 @@sum,@@win1,0,@@syn1
  7408                                                                          ; @@SUM8 macro sum,win,ww,syn
  7409                                                                          ;   IRP nn,0,1,2,3,4,5,6,7
  7410 00005553 8B04AD[58040500]                        mov     eax, [mp3_synth_win+ebp*4]
  7411 0000555A F7EA                                    imul    edx
  7412 0000555C 01D3                                    add     ebx, edx
  7413 0000555E 8B14B5[A0B30000]                        mov     edx, [(mp3_synth_buf+100h)+esi*4] ; @@syn1 equ esi
  7414 00005565 8B04AD[58050500]                        mov     eax, [(mp3_synth_win+100h)+ebp*4] ; @@win1 equ ebp
  7415 0000556C F7EA                                    imul    edx
  7416 0000556E 01D3                                    add     ebx, edx
  7417 00005570 8B14B5[A0B40000]                        mov     edx, [(mp3_synth_buf+200h)+esi*4]
  7418 00005577 8B04AD[58060500]                        mov     eax, [(mp3_synth_win+200h)+ebp*4]
  7419 0000557E F7EA                                    imul    edx
  7420 00005580 01D3                                    add     ebx, edx
  7421 00005582 8B14B5[A0B50000]                        mov     edx, [(mp3_synth_buf+300h)+esi*4]
  7422 00005589 8B04AD[58070500]                        mov     eax, [(mp3_synth_win+300h)+ebp*4]
  7423 00005590 F7EA                                    imul    edx
  7424 00005592 01D3                                    add     ebx, edx
  7425 00005594 8B14B5[A0B60000]                        mov     edx, [(mp3_synth_buf+400h)+esi*4]
  7426 0000559B 8B04AD[58080500]                        mov     eax, [(mp3_synth_win+400h)+ebp*4]
  7427 000055A2 F7EA                                    imul    edx
  7428 000055A4 01D3                                    add     ebx, edx
  7429 000055A6 8B14B5[A0B70000]                        mov     edx, [(mp3_synth_buf+500h)+esi*4]
  7430 000055AD 8B04AD[58090500]                        mov     eax, [(mp3_synth_win+500h)+ebp*4]
  7431 000055B4 F7EA                                    imul    edx
  7432 000055B6 01D3                                    add     ebx, edx
  7433 000055B8 8B14B5[A0B80000]                        mov     edx, [(mp3_synth_buf+600h)+esi*4]
  7434 000055BF 8B04AD[580A0500]                        mov     eax, [(mp3_synth_win+600h)+ebp*4]
  7435 000055C6 F7EA                                    imul    edx
  7436 000055C8 01D3                                    add     ebx, edx
  7437 000055CA 8B14B5[A0B90000]                        mov     edx, [(mp3_synth_buf+700h)+esi*4]
  7438 000055D1 8B04AD[580B0500]                        mov     eax, [(mp3_synth_win+700h)+ebp*4]
  7439 000055D8 F7EA                                    imul    edx
  7440 000055DA 01D3                                    add     ebx, edx
  7441 000055DC 8B14BD[A0B20000]                        mov     edx, [mp3_synth_buf+edi*4]
  7442 000055E3 8B04AD[D8040500]                        mov     eax, [(mp3_synth_win+80h)+ebp*4]
  7443 000055EA F7EA                                    imul    edx
  7444 000055EC 01D3                                    add     ebx, edx
  7445 000055EE 8B14BD[A0B30000]                        mov     edx, [(mp3_synth_buf+100h)+edi*4] ; @@SUM8 @@sum,@@win1,32,@@syn2
  7446                                                                          ; @@syn2 equ edi
  7447                                                                          ; @@win1 equ ebp
  7448 000055F5 8B04AD[D8050500]                        mov     eax, [(mp3_synth_win+180h)+ebp*4]
  7449 000055FC F7EA                                    imul    edx
  7450 000055FE 01D3                                    add     ebx, edx
  7451 00005600 8B14BD[A0B40000]                        mov     edx, [(mp3_synth_buf+200h)+edi*4]
  7452 00005607 8B04AD[D8060500]                        mov     eax, [(mp3_synth_win+280h)+ebp*4]
  7453 0000560E F7EA                                    imul    edx
  7454 00005610 01D3                                    add     ebx, edx
  7455 00005612 8B14BD[A0B50000]                        mov     edx, [(mp3_synth_buf+300h)+edi*4]
  7456 00005619 8B04AD[D8070500]                        mov     eax, [(mp3_synth_win+380h)+ebp*4]
  7457 00005620 F7EA                                    imul    edx
  7458 00005622 01D3                                    add     ebx, edx
  7459 00005624 8B14BD[A0B60000]                        mov     edx, [(mp3_synth_buf+400h)+edi*4]
  7460 0000562B 8B04AD[D8080500]                        mov     eax, [(mp3_synth_win+480h)+ebp*4]
  7461 00005632 F7EA                                    imul    edx
  7462 00005634 01D3                                    add     ebx, edx
  7463 00005636 8B14BD[A0B70000]                        mov     edx, [(mp3_synth_buf+500h)+edi*4]
  7464 0000563D 8B04AD[D8090500]                        mov     eax, [(mp3_synth_win+580h)+ebp*4]
  7465 00005644 F7EA                                    imul    edx
  7466 00005646 01D3                                    add     ebx, edx
  7467 00005648 8B14BD[A0B80000]                        mov     edx, [(mp3_synth_buf+600h)+edi*4]
  7468 0000564F 8B04AD[D80A0500]                        mov     eax, [(mp3_synth_win+680h)+ebp*4]
  7469 00005656 F7EA                                    imul    edx
  7470 00005658 01D3                                    add     ebx, edx
  7471 0000565A 8B14BD[A0B90000]                        mov     edx, [(mp3_synth_buf+700h)+edi*4]
  7472 00005661 8B04AD[D80B0500]                        mov     eax, [(mp3_synth_win+780h)+ebp*4]
  7473 00005668 F7EA                                    imul    edx
  7474 0000566A 01D3                                    add     ebx, edx
  7475 0000566C 81FB00002000                            cmp     ebx, 200000h    ; cmp @@sum,100h SHL (@@out_shift)
  7476 00005672 7321                                    jnb     short .sat
  7477 00005674 C1FB0D                                  sar     ebx, 13         ; sar @@sum,(@@out_shift)
  7478                                  
  7479                                  .sat_back:
  7480 00005677 8819                                    mov     [ecx], bl
  7481 00005679 030D[44090100]                          add     ecx, [mp3_samples_dst_step]
  7482 0000567F 83C602                                  add     esi, 2
  7483 00005682 83EF02                                  sub     edi, 2
  7484 00005685 83C502                                  add     ebp, 2
  7485 00005688 F7C51F000000                            test    ebp, 1Fh
  7486 0000568E 0F85B3FEFFFF                            jnz     .samples_lop
  7487 00005694 C3                                      retn
  7488                                  
  7489                                  .sat:
  7490 00005695 C1FB1F                                  sar     ebx, 31         ; sar @@sum,31 ; FFFFFFFFh,00000000h
  7491 00005698 F7D3                                    not     ebx
  7492 0000569A EBDB                                    jmp     short .sat_back
  7493                                  
  7494                                  .append_copy_to_window:
  7495 0000569C 8D3485[A0B20000]                        lea     esi, [mp3_synth_buf+eax*4]
  7496 000056A3 8DBE00080000                            lea     edi, [esi+2048]
  7497 000056A9 B912000000                              mov     ecx, 18
  7498 000056AE F3A5                                    rep movsd
  7499 000056B0 E971FEFFFF                              jmp     .append_copy_to_window_back
  7500                                  
  7501                                  
  7502                                  ; =============== S U B R O U T I N E =======================================
  7503                                  
  7504                                  
  7505                                  synth_8bit_shift_2_slow:
  7506 000056B5 F605[FC8A0000]10                        test    byte [cpuid_flags], 10h ; SYNTH_MACRO 1,2,0 ; 8bit, quarter rate
  7507                                                                          ; force_8bit, rate_shift=2, force_fast=0
  7508 000056BC 740E                                    jz      short .no_rdtsc_supported ; timelog_start rdtsc_synth_dct
  7509 000056BE 0F31                                    rdtsc
  7510 000056C0 2905[748C0000]                          sub     [rdtsc_synth_dct], eax
  7511 000056C6 1915[788C0000]                          sbb     [rdtsc_synth_dct+4], edx
  7512                                  
  7513                                  .no_rdtsc_supported:
  7514 000056CC BE[A8D20000]                            mov	esi, mp3_sb_samples
  7515 000056D1 8B3D[3C090100]                          mov	edi, [mp3_samples_dst]
  7516 000056D7 C705[48090100]0000-                     mov	dword [mp3_curr_channel], 0
  7516 000056DF 0000               
  7517                                  
  7518                                  .synth_channel_lop:
  7519 000056E1 56                                      push	esi
  7520 000056E2 57                                      push	edi
  7521 000056E3 893D[88B20000]                          mov	[mp3_curr_syn_dst], edi
  7522 000056E9 C705[50090100]0000-                     mov	dword [mp3_curr_frame], 0
  7522 000056F1 0000               
  7523                                  
  7524                                  .synth_frame_lop:
  7525 000056F3 56                                      push    esi             ; sb_samples[ch][i]
  7526 000056F4 F605[FC8A0000]10                        test    byte [cpuid_flags], 10h ; timelog_start rdtsc_dct32
  7527 000056FB 740E                                    jz      short .no_rdtsc_supported@
  7528 000056FD 0F31                                    rdtsc
  7529 000056FF 2905[8C8C0000]                          sub     [rdtsc_dct32], eax
  7530 00005705 1915[908C0000]                          sbb     [rdtsc_dct32+4], edx
  7531                                  
  7532                                  .no_rdtsc_supported@:
  7533 0000570B 8B15[48090100]                          mov     edx, [mp3_curr_channel]
  7534 00005711 8B0495[A0D20000]                        mov     eax, [mp3_synth_index+edx*4]
  7535 00005718 832C95[A0D20000]20                      sub     dword [mp3_synth_index+edx*4], 32
  7536 00005720 C1E20A                                  shl     edx, 10         ; channel*1024
  7537 00005723 25E0010000                              and     eax, 1E0h       ; 1FFh-1Fh ; index(0..511), align 32
  7538 00005728 09D0                                    or      eax, edx
  7539 0000572A A3[84B20000]                            mov     [mp3_curr_syn_index], eax
  7540 0000572F 8B3D[84B20000]                          mov     edi, [mp3_curr_syn_index]
  7541 00005735 8D3CBD[A0B20000]                        lea     edi, [mp3_synth_buf+edi*4] ; IF SYNTH32
  7542 0000573C E89CDBFFFF                              call    mp3_dct32_shift_2 ; mp3_dct32_shift_&rate_shift ; rate_shift=2
  7543 00005741 F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
  7544 00005748 740E                                    jz      short .no_rdtsc_supported@@ ; timelog_end rdtsc_dct32
  7545 0000574A 0F31                                    rdtsc
  7546 0000574C 0105[8C8C0000]                          add     [rdtsc_dct32], eax
  7547 00005752 1115[908C0000]                          adc     [rdtsc_dct32+4], edx
  7548                                  
  7549                                  .no_rdtsc_supported@@:
  7550 00005758 F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
  7551 0000575F 740E                                    jz      short .no_rdtsc_supported@@@ ; timelog_start rdtsc_synth
  7552 00005761 0F31                                    rdtsc
  7553 00005763 2905[A48C0000]                          sub     [rdtsc_synth], eax
  7554 00005769 1915[A88C0000]                          sbb     [rdtsc_synth+4], edx
  7555                                  
  7556                                  .no_rdtsc_supported@@@:
  7557 0000576F E888000000                              call    mp3_synth_filter_this_8bit_shift_2_slow ;
  7558                                                                          ; mp3_synth_filter_this_&force_8bit&_&rate_shift&_&force_fast
  7559 00005774 F605[FC8A0000]10                        test    byte [cpuid_flags], 10h ; timelog_end rdtsc_synth
  7560 0000577B 740E                                    jz      short .no_rdtsc_supported@@@@
  7561 0000577D 0F31                                    rdtsc
  7562 0000577F 0105[A48C0000]                          add     [rdtsc_synth], eax
  7563 00005785 1115[A88C0000]                          adc     [rdtsc_synth+4], edx
  7564                                  
  7565                                  .no_rdtsc_supported@@@@:
  7566 0000578B 5E                                      pop     esi             ; src
  7567 0000578C A1[44090100]                            mov     eax, [mp3_samples_dst_step]
  7568 00005791 C1E005                                  shl     eax, 5          ; mul32
  7569 00005794 8A0D[F98A0000]                          mov     cl, [option_rate_shift] ; IF with_rate_shift
  7570 0000579A D3E8                                    shr     eax, cl
  7571 0000579C 0105[88B20000]                          add     [mp3_curr_syn_dst], eax
  7572 000057A2 81C680000000                            add     esi, 128        ; SBLIMIT*4 ; src+32*4
  7573 000057A8 FF05[50090100]                          inc     dword [mp3_curr_frame]
  7574 000057AE A1[50090100]                            mov     eax, [mp3_curr_frame]
  7575 000057B3 3B05[8CB20000]                          cmp     eax, [mp3_nb_frames]
  7576 000057B9 0F8234FFFFFF                            jb      .synth_frame_lop
  7577 000057BF 5F                                      pop     edi
  7578 000057C0 5E                                      pop     esi
  7579 000057C1 033D[80B20000]                          add     edi, [mp3_bytes_per_sample]
  7580 000057C7 81C600120000                            add     esi, 4608       ; 36*SBLIMIT*4 ; src
  7581 000057CD FF05[48090100]                          inc     dword [mp3_curr_channel]
  7582 000057D3 A1[48090100]                            mov     eax, [mp3_curr_channel]
  7583 000057D8 3B05[78B20000]                          cmp     eax, [mp3_output_num_channels]
  7584 000057DE 0F82FDFEFFFF                            jb      .synth_channel_lop
  7585 000057E4 F605[FC8A0000]10                        test    byte [cpuid_flags], 10h ; timelog_end rdtsc_synth_dct
  7586 000057EB 740E                                    jz      short .no_rdtsc_supported@@@@@
  7587 000057ED 0F31                                    rdtsc
  7588 000057EF 0105[748C0000]                          add     [rdtsc_synth_dct], eax
  7589 000057F5 1115[788C0000]                          adc     [rdtsc_synth_dct+4], edx
  7590                                  
  7591                                  .no_rdtsc_supported@@@@@:
  7592 000057FB C3                                      retn
  7593                                  
  7594                                  ; =============== S U B R O U T I N E =======================================
  7595                                  
  7596                                  
  7597                                  mp3_synth_filter_this_8bit_shift_2_slow:
  7598 000057FC A1[84B20000]                            mov     eax, [mp3_curr_syn_index]
  7599 00005801 A9E0010000                              test    eax, 1E0h       ; 1FFh-1Fh ; offset
  7600 00005806 0F8477010000                            jz      .append_copy_to_window
  7601 0000580C 90                                      nop
  7602                                  
  7603                                  .append_copy_to_window_back:
  7604 0000580D 89C5                                    mov     ebp, eax        ; @@win1
  7605 0000580F 81E5C0010000                            and     ebp, 1C0h       ; 1FFh-1Fh-20h
  7606 00005815 2520040000                              and     eax, 420h       ; 20h+(1 shl 10) ; bit5 and channel
  7607 0000581A 8D7010                                  lea     esi, [eax+10h]  ; @@syn1
  7608 0000581D 8D7830                                  lea     edi, [eax+30h]  ; @@syn2
  7609 00005820 F7DD                                    neg     ebp
  7610 00005822 81E5C0010000                            and     ebp, 1C0h       ; 1FFh-1Fh-20h
  7611 00005828 8B0D[88B20000]                          mov     ecx, [mp3_curr_syn_dst] ; @@dst
  7612                                  
  7613                                  .samples_lop:
  7614 0000582E BB00101000                              mov     ebx, 101000h    ; mov @@sum,(80h SHL (@@out_shift))+(1 SHL (@@out_shift-1))
  7615                                                                          ; @@out_shift equ (OUT_SHIFT_slow+(8*force_8bit))
  7616                                                                          ; @@out_shift = 13 ; OUT_SHIFT_slow = 5
  7617 00005833 8B14B5[A0B20000]                        mov     edx, [mp3_synth_buf+esi*4] ; @@SUM8 @@sum,@@win1,0,@@syn1
  7618                                                                          ; @@SUM8 macro sum,win,ww, syn
  7619                                                                          ; IRP nn,0,1,2,3,4,5,6,7
  7620                                                                          ; [mp3_synth_buf+syn*4+(nn*64*4)]
  7621 0000583A 8B04AD[58040500]                        mov     eax, [mp3_synth_win+ebp*4] ; [mp3_synth_win+win*4+(nn*64*4)+ww*4]
  7622 00005841 F7EA                                    imul    edx             ; 64bit = 32bit * 32bit
  7623 00005843 01D3                                    add     ebx, edx        ; add sum,edx ; sum from MSW of result
  7624 00005845 8B14B5[A0B30000]                        mov     edx, [(mp3_synth_buf+100h)+esi*4] ;
  7625                                                                          ; [mp3_synth_buf+syn*4+(nn*64*4)] ; nn=1
  7626 0000584C 8B04AD[58050500]                        mov     eax, [(mp3_synth_win+100h)+ebp*4] ;
  7627                                                                          ; [mp3_synth_win+win*4+(nn*64*4)+ww*4] ; nn=1
  7628 00005853 F7EA                                    imul    edx
  7629 00005855 01D3                                    add     ebx, edx
  7630 00005857 8B14B5[A0B40000]                        mov     edx, [(mp3_synth_buf+200h)+esi*4]
  7631 0000585E 8B04AD[58060500]                        mov     eax, [(mp3_synth_win+200h)+ebp*4]
  7632 00005865 F7EA                                    imul    edx
  7633 00005867 01D3                                    add     ebx, edx
  7634 00005869 8B14B5[A0B50000]                        mov     edx, [(mp3_synth_buf+300h)+esi*4]
  7635 00005870 8B04AD[58070500]                        mov     eax, [(mp3_synth_win+300h)+ebp*4]
  7636 00005877 F7EA                                    imul    edx
  7637 00005879 01D3                                    add     ebx, edx
  7638 0000587B 8B14B5[A0B60000]                        mov     edx, [(mp3_synth_buf+400h)+esi*4] ;
  7639                                                                          ; [mp3_synth_buf+syn*4+(nn*64*4)] ; nn=4
  7640 00005882 8B04AD[58080500]                        mov     eax, [(mp3_synth_win+400h)+ebp*4] ;
  7641                                                                          ; [mp3_synth_win+win*4+(nn*64*4)+ww*4] ; nn=4
  7642 00005889 F7EA                                    imul    edx
  7643 0000588B 01D3                                    add     ebx, edx
  7644 0000588D 8B14B5[A0B70000]                        mov     edx, [(mp3_synth_buf+500h)+esi*4]
  7645 00005894 8B04AD[58090500]                        mov     eax, [(mp3_synth_win+500h)+ebp*4]
  7646 0000589B F7EA                                    imul    edx
  7647 0000589D 01D3                                    add     ebx, edx
  7648 0000589F 8B14B5[A0B80000]                        mov     edx, [(mp3_synth_buf+600h)+esi*4]
  7649 000058A6 8B04AD[580A0500]                        mov     eax, [(mp3_synth_win+600h)+ebp*4]
  7650 000058AD F7EA                                    imul    edx
  7651 000058AF 01D3                                    add     ebx, edx
  7652 000058B1 8B14B5[A0B90000]                        mov     edx, [(mp3_synth_buf+700h)+esi*4]
  7653 000058B8 8B04AD[580B0500]                        mov     eax, [(mp3_synth_win+700h)+ebp*4]
  7654 000058BF F7EA                                    imul    edx
  7655 000058C1 01D3                                    add     ebx, edx
  7656 000058C3 8B14BD[A0B20000]                        mov     edx, [mp3_synth_buf+edi*4] ; @@SUM8 @@sum,@@win1,32,@@syn2
  7657 000058CA 8B04AD[D8040500]                        mov     eax, [(mp3_synth_win+80h)+ebp*4]
  7658 000058D1 F7EA                                    imul    edx
  7659 000058D3 01D3                                    add     ebx, edx
  7660 000058D5 8B14BD[A0B30000]                        mov     edx, [(mp3_synth_buf+100h)+edi*4]
  7661 000058DC 8B04AD[D8050500]                        mov     eax, [(mp3_synth_win+180h)+ebp*4]
  7662 000058E3 F7EA                                    imul    edx
  7663 000058E5 01D3                                    add     ebx, edx
  7664 000058E7 8B14BD[A0B40000]                        mov     edx, [(mp3_synth_buf+200h)+edi*4]
  7665 000058EE 8B04AD[D8060500]                        mov     eax, [(mp3_synth_win+280h)+ebp*4]
  7666 000058F5 F7EA                                    imul    edx
  7667 000058F7 01D3                                    add     ebx, edx
  7668 000058F9 8B14BD[A0B50000]                        mov     edx, [(mp3_synth_buf+300h)+edi*4]
  7669 00005900 8B04AD[D8070500]                        mov     eax, [(mp3_synth_win+380h)+ebp*4]
  7670 00005907 F7EA                                    imul    edx
  7671 00005909 01D3                                    add     ebx, edx
  7672 0000590B 8B14BD[A0B60000]                        mov     edx, [(mp3_synth_buf+400h)+edi*4]
  7673 00005912 8B04AD[D8080500]                        mov     eax, [(mp3_synth_win+480h)+ebp*4]
  7674 00005919 F7EA                                    imul    edx
  7675 0000591B 01D3                                    add     ebx, edx
  7676 0000591D 8B14BD[A0B70000]                        mov     edx, [(mp3_synth_buf+500h)+edi*4]
  7677 00005924 8B04AD[D8090500]                        mov     eax, [(mp3_synth_win+580h)+ebp*4]
  7678 0000592B F7EA                                    imul    edx
  7679 0000592D 01D3                                    add     ebx, edx
  7680 0000592F 8B14BD[A0B80000]                        mov     edx, [(mp3_synth_buf+600h)+edi*4]
  7681 00005936 8B04AD[D80A0500]                        mov     eax, [(mp3_synth_win+680h)+ebp*4]
  7682 0000593D F7EA                                    imul    edx
  7683 0000593F 01D3                                    add     ebx, edx
  7684 00005941 8B14BD[A0B90000]                        mov     edx, [(mp3_synth_buf+700h)+edi*4]
  7685                                                                          ; [mp3_synth_buf+syn*4+(nn*64*4)] ; nn=7
  7686 00005948 8B04AD[D80B0500]                        mov     eax, [(mp3_synth_win+780h)+ebp*4]
  7687                                                                          ; [mp3_synth_win+win*4+(nn*64*4)+ww*4] ; nn=7
  7688 0000594F F7EA                                    imul    edx
  7689 00005951 01D3                                    add     ebx, edx
  7690 00005953 81FB00002000                            cmp     ebx, 200000h    ; cmp @@sum,100h SHL (@@out_shift) ; out_shift=13
  7691 00005959 7321                                    jnb     short .sat
  7692 0000595B C1FB0D                                  sar     ebx, 13         ; sar @@sum,(@@out_shift)
  7693                                  
  7694                                  .sat_back:
  7695 0000595E 8819                                    mov     [ecx], bl       ; mov byte ptr [@@dst],@@sum_8bit
  7696 00005960 030D[44090100]                          add     ecx, [mp3_samples_dst_step]
  7697 00005966 83C604                                  add     esi, 4          ; add @@syn1,1 shl rate_shift ; rate_shift=2
  7698 00005969 83EF04                                  sub     edi, 4          ; add @@syn2,1 shl rate_shift
  7699 0000596C 83C504                                  add     ebp, 4          ; add @@win1,1 shl rate_shift
  7700 0000596F F7C51F000000                            test    ebp, 1Fh        ; test @@win1,1Fh
  7701 00005975 0F85B3FEFFFF                            jnz     .samples_lop
  7702 0000597B C3                                      retn
  7703                                  
  7704                                  .sat:
  7705 0000597C C1FB1F                                  sar     ebx, 31         ; sar  @@sum,31 ; FFFFFFFFh,00000000h
  7706 0000597F F7D3                                    not     ebx
  7707 00005981 EBDB                                    jmp     short .sat_back
  7708                                  
  7709                                  .append_copy_to_window:
  7710 00005983 8D3485[A0B20000]                        lea     esi, [mp3_synth_buf+eax*4] ; IF SYNTH32
  7711 0000598A 8DBE00080000                            lea     edi, [esi+2048] ; [esi+512*4]
  7712 00005990 B912000000                              mov     ecx, 18         ; (12h*4)/4
  7713 00005995 F3A5                                    rep movsd
  7714 00005997 E971FEFFFF                              jmp     .append_copy_to_window_back
  7715                                  
  7716                                  
  7717                                  ; =============== S U B R O U T I N E =======================================
  7718                                  
  7719                                  
  7720                                  mp3_any_init_synth_window:
  7721 0000599C 31D2                                    xor     edx, edx        ; index (0..100h)
  7722 0000599E 31C9                                    xor     ecx, ecx        ; delta.val
  7723 000059A0 898C12[58040500]                        mov     [mp3_synth_win+edx*2], ecx
  7724                                  
  7725                                  .synth_lop:
  7726 000059A7 0FBF9C12[4A8D0000]                      movsx   ebx, word [mp3_synth_win_src+edx*2]
  7727 000059AF 01D9                                    add     ecx, ebx
  7728 000059B1 89C8                                    mov     eax, ecx
  7729 000059B3 803D[FA8A0000]00                        cmp     byte [option_fast], 0
  7730 000059BA 7403                                    jz      short .not_fast
  7731 000059BC C1F805                                  sar     eax, 5
  7732                                  
  7733                                  .not_fast:
  7734 000059BF 803D[FA8A0000]00                        cmp	byte [option_fast], 0
  7735 000059C6 7503                                    jnz	short .not_slow
  7736 000059C8 C1E00E                                  shl	eax, 14         ; (WFRAC_BITS_slow-WFRAC_BITS_default)
  7737                                  
  7738                                  .not_slow:
  7739 000059CB 42                                      inc     edx             ; index (1..100h)
  7740 000059CC BB00020000                              mov     ebx, 200h
  7741 000059D1 29D3                                    sub     ebx, edx        ; 1FFh..100h
  7742 000059D3 89049D[58040500]                        mov     [mp3_synth_win+ebx*4], eax
  7743 000059DA F7C23F000000                            test    edx, 3Fh
  7744 000059E0 7402                                    jz      short .synth_keep_sign
  7745 000059E2 F7D8                                    neg     eax
  7746                                  
  7747                                  .synth_keep_sign:
  7748 000059E4 890495[58040500]                        mov     [mp3_synth_win+edx*4], eax
  7749 000059EB 81FA00010000                            cmp     edx, 100h
  7750 000059F1 72B4                                    jb      short .synth_lop
  7751 000059F3 31D2                                    xor     edx, edx
  7752                                  
  7753                                  .synth_neg_lop:
  7754 000059F5 F7C230000000                            test    edx, 30h        ; skip 0..0Fh (only negate 10h..3Fh)
  7755 000059FB 7407                                    jz      short .synth_neg_next
  7756 000059FD F71C95[58040500]                        neg     dword [mp3_synth_win+edx*4]
  7757                                  
  7758                                  .synth_neg_next:
  7759 00005A04 42                                      inc     edx
  7760 00005A05 81FA00020000                            cmp     edx, 200h
  7761 00005A0B 72E8                                    jb      short .synth_neg_lop
  7762 00005A0D 31D2                                    xor     edx, edx
  7763                                  
  7764                                  .synth_swap_lop:
  7765 00005A0F 89D0                                    mov     eax, edx
  7766 00005A11 83E03F                                  and     eax, 3Fh
  7767 00005A14 83E811                                  sub     eax, 17         ; swap win [(17..31)] with win[(17..31)+32)
  7768 00005A17 83F80E                                  cmp     eax, 14         ; 31-17
  7769 00005A1A 7715                                    ja      short .synth_swap_next
  7770 00005A1C 8B0495[58040500]                        mov     eax, [mp3_synth_win+edx*4]
  7771 00005A23 870495[D8040500]                        xchg    eax, [(mp3_synth_win+80h)+edx*4]
  7772 00005A2A 890495[58040500]                        mov     [mp3_synth_win+edx*4], eax
  7773                                  
  7774                                  .synth_swap_next:
  7775 00005A31 42                                      inc     edx
  7776 00005A32 81FA00020000                            cmp     edx, 200h
  7777 00005A38 72D5                                    jb      short .synth_swap_lop
  7778 00005A3A 31D2                                    xor     edx, edx
  7779                                  
  7780                                  .synth_zero_lop:
  7781 00005A3C C70495[98040500]00-                     mov	dword [(mp3_synth_win+40h)+edx*4], 0
  7781 00005A44 000000             
  7782 00005A47 83C240                                  add	edx, 40h
  7783 00005A4A 81FA00020000                            cmp	edx, 200h
  7784 00005A50 72EA                                    jb	short .synth_zero_lop
  7785 00005A52 BE[58040500]                            mov	esi, mp3_synth_win
  7786 00005A57 8DBE00080000                            lea	edi, [esi+2048] ; [esi+512*4]
  7787 00005A5D B900020000                              mov	ecx, 512        ; append another copy
  7788 00005A62 F3A5                                    rep movsd
  7789 00005A64 C3                                      retn
  7790                                  
  7791                                  
  7792                                  ; =============== S U B R O U T I N E =======================================
  7793                                  
  7794                                  
  7795                                  mp3_init_post_collapse:
  7796 00005A65 803D[FA8A0000]00                        cmp	byte [option_fast], 0
  7797 00005A6C 7411                                    jz	short .not_fast
  7798 00005A6E BE[58040500]                            mov	esi, mp3_synth_win
  7799 00005A73 89F7                                    mov	edi, esi
  7800 00005A75 B900040000                              mov	ecx, 1024       ; 512*(1+LONG_WINDOW)
  7801                                  
  7802                                  .collapse_lop:
  7803 00005A7A AD                                      lodsd                   ; collapse 32bit to 16bit
  7804                                                                          ; (that's slightly faster due to better caching)
  7805 00005A7B 66AB                                    stosw
  7806 00005A7D E2FB                                    loop    .collapse_lop
  7807                                  
  7808                                  .not_fast:
  7809 00005A7F C3                                      retn
  7810                                  
  7811                                  
  7812                                  ; =============== S U B R O U T I N E =======================================
  7813                                  
  7814                                  
  7815                                  mp3_any_init_band_indices:
  7816 00005A80 BE[7C950000]                            mov     esi, mp3_band_size_long
  7817 00005A85 BF[6CEC0100]                            mov     edi, mp3_band_index_long
  7818 00005A8A BB09000000                              mov     ebx, 9
  7819                                  
  7820                                  .band_index_lop_i:
  7821 00005A8F 31C0                                    xor     eax, eax
  7822 00005A91 B916000000                              mov     ecx, 22
  7823                                  
  7824                                  .band_index_lop_j:
  7825 00005A96 66AB                                    stosw
  7826 00005A98 0FB616                                  movzx   edx, byte [esi]
  7827 00005A9B 01D0                                    add     eax, edx
  7828 00005A9D 46                                      inc     esi
  7829 00005A9E E2F6                                    loop    .band_index_lop_j
  7830 00005AA0 83C10A                                  add     ecx, 10
  7831 00005AA3 F366AB                                  rep stosw
  7832 00005AA6 4B                                      dec     ebx
  7833 00005AA7 75E6                                    jnz     short .band_index_lop_i
  7834 00005AA9 C3                                      retn
  7835                                  
  7836                                  
  7837                                  ; =============== S U B R O U T I N E =======================================
  7838                                  
  7839                                  
  7840                                  mp3_any_init_lsf_sf_expand:
  7841 00005AAA BE[1A8D0000]                            mov     esi, mp3_lsf_sf_expand_init_table
  7842 00005AAF BF[58140500]                            mov     edi, mp3_lsf_sf_expand_exploded_table
  7843 00005AB4 31D2                                    xor     edx, edx        ; curr.index
  7844 00005AB6 31DB                                    xor     ebx, ebx        ; curr.base
  7845                                  
  7846                                  .lop:
  7847 00005AB8 663B5606                                cmp     dx, [esi+6]     ; nextbase
  7848 00005ABC 7207                                    jb      short .inrange
  7849 00005ABE 668B5E06                                mov     bx, [esi+6]
  7850 00005AC2 83C608                                  add     esi, 8          ; next entry
  7851                                  
  7852                                  .inrange:
  7853 00005AC5 89D0                                    mov     eax, edx
  7854 00005AC7 29D8                                    sub     eax, ebx
  7855 00005AC9 8A0E                                    mov     cl, [esi]
  7856 00005ACB D3E8                                    shr     eax, cl         ; div2
  7857 00005ACD F67603                                  div     byte [esi+3] ; mod3 ; [2]=slen[3]
  7858 00005AD0 886703                                  mov     [edi+3], ah
  7859 00005AD3 B400                                    mov     ah, 0           ; eax=div.result
  7860 00005AD5 F67602                                  div     byte [esi+2] ; mod2 ; [2]=slen[2]
  7861 00005AD8 886702                                  mov     [edi+2], ah     ; remainder
  7862 00005ADB B400                                    mov     ah, 0
  7863 00005ADD F67601                                  div     byte [esi+1] ; mod1 ; [1]=slen[1]
  7864 00005AE0 668907                                  mov     [edi], ax       ; [0]=slen[0]
  7865 00005AE3 668B4604                                mov     ax, [esi+4]     ; [4]=tindex2
  7866 00005AE7 66894704                                mov     [edi+4], ax     ; [5]=force_preflag
  7867 00005AEB 83C708                                  add     edi, 8
  7868 00005AEE 42                                      inc     edx             ; curr.index ; next
  7869 00005AEF 81FA00040000                            cmp     edx, 1024       ; 512+512
  7870 00005AF5 72C1                                    jb      short .lop
  7871 00005AF7 C3                                      retn
  7872                                  
  7873                                  
  7874                                  ; =============== S U B R O U T I N E =======================================
  7875                                  
  7876                                  
  7877                                  mp3_any_init_huff_tables:
  7878 00005AF8 BD[B48F0000]                            mov     ebp, huff_tree_list_data
  7879 00005AFD BE[349A0000]                            mov     esi, huff_tree_list_numbits
  7880 00005B02 BA01000000                              mov     edx, 1          ; idx (table 01h..11h)
  7881                                  
  7882                                  .huffman_table_lop:
  7883 00005B07 31C0                                    xor     eax, eax
  7884 00005B09 BF[843E0500]                            mov     edi, mp3_huff_tmp_bits
  7885 00005B0E B940000000                              mov     ecx, 40h        ; 100h/4 ; 100h x 8bit
  7886 00005B13 F3AB                                    rep stosd
  7887 00005B15 BF[843F0500]                            mov     edi, mp3_huff_tmp_codes
  7888 00005B1A B980000000                              mov     ecx, 80h        ; 100h/2 ; 100h x 16bit
  7889 00005B1F F3AB                                    rep stosd
  7890 00005B21 31DB                                    xor     ebx, ebx
  7891                                  
  7892                                  .huff_entry_lop:
  7893 00005B23 0FB67D00                                movzx   edi, byte [ebp+0]
  7894 00005B27 45                                      inc     ebp             ; dst=data
  7895 00005B28 AC                                      lodsb                   ; numbits
  7896 00005B29 8887[843E0500]                          mov     [mp3_huff_tmp_bits+edi], al
  7897 00005B2F B120                                    mov     cl, 32
  7898 00005B31 28C1                                    sub     cl, al          ; 32-numbits
  7899 00005B33 D3EB                                    shr     ebx, cl
  7900 00005B35 66899C3F[843F0500]                      mov     word [mp3_huff_tmp_codes+edi*2], bx
  7901 00005B3D 43                                      inc     ebx             ; next.code
  7902 00005B3E D3E3                                    shl     ebx, cl         ; shift back to MSBs
  7903 00005B40 75E1                                    jnz     short .huff_entry_lop
  7904 00005B42 60                                      pusha
  7905 00005B43 B800010000                              mov     eax, 100h       ; nb_codes
  7906 00005B48 BB[843E0500]                            mov     ebx, mp3_huff_tmp_bits ; bits
  7907 00005B4D BE[843F0500]                            mov     esi, mp3_huff_tmp_codes ; codes
  7908 00005B52 E837020000                              call    mp3_build_huff_table_root ; make table
  7909 00005B57 61                                      popa
  7910 00005B58 42                                      inc     edx             ; idx
  7911 00005B59 83FA12                                  cmp     edx, 12h
  7912 00005B5C 75A9                                    jnz     short .huffman_table_lop ; next table
  7913 00005B5E C3                                      retn
  7914                                  
  7915                                  
  7916                                  ; =============== S U B R O U T I N E =======================================
  7917                                  
  7918                                  
  7919                                  mp3_integer_init_is_stereo_lsf:
  7920 00005B5F 31FF                                    xor     edi, edi
  7921                                  
  7922                                  .lsf_lop:
  7923 00005B61 89FE                                    mov     esi, edi
  7924 00005B63 83E63F                                  and     esi, 3Fh
  7925 00005B66 46                                      inc     esi
  7926 00005B67 D1EE                                    shr     esi, 1
  7927 00005B69 F7C740000000                            test    edi, 40h
  7928 00005B6F 7402                                    jz      short .lsf_no_shift
  7929 00005B71 D1E6                                    shl     esi, 1
  7930                                  
  7931                                  .lsf_no_shift:
  7932 00005B73 BA00000040                              mov     edx, 40000000h  ; aka mul 1.000
  7933 00005B78 83C604                                  add     esi, 4
  7934 00005B7B F7C780000000                            test    edi, 80h        ; 2*40h
  7935 00005B81 7408                                    jz      short .no_ms_stereo
  7936 00005B83 BA9A79825A                              mov     edx, 5A82799Ah  ; 2D413CCDh*2 ; aka mul 1.414
  7937 00005B88 83EE02                                  sub     esi, 2
  7938                                  
  7939                                  .no_ms_stereo:
  7940 00005B8B 89F1                                    mov     ecx, esi
  7941 00005B8D C1E902                                  shr     ecx, 2          ; msbs
  7942 00005B90 83E603                                  and     esi, 3          ; lsbs
  7943 00005B93 8B04B5[74990000]                        mov     eax, [mp3_is_table_lsf_src+esi*4]
  7944 00005B9A D3E8                                    shr     eax, cl
  7945 00005B9C F7C701000000                            test    edi, 1
  7946 00005BA2 7501                                    jnz     short .lsf_no_swap
  7947 00005BA4 92                                      xchg    eax, edx
  7948                                  
  7949                                  .lsf_no_swap:
  7950 00005BA5 8904FD[58FC0400]                        mov     [mp3_is_table_lsf+edi*8], eax
  7951 00005BAC 8914FD[5CFC0400]                        mov     [(mp3_is_table_lsf+4)+edi*8], edx
  7952 00005BB3 47                                      inc     edi
  7953 00005BB4 81FF00010000                            cmp     edi, 100h
  7954 00005BBA 72A5                                    jb      short .lsf_lop
  7955 00005BBC C3                                      retn
  7956                                  
  7957                                  
  7958                                  ; =============== S U B R O U T I N E =======================================
  7959                                  
  7960                                  
  7961                                  mp3_integer_init_mdct_windows:
  7962 00005BBD BF[D8F70400]                            mov     edi, mp3_mdct_win
  7963 00005BC2 BE[FC960000]                            mov     esi, mp3_mdct_win_src
  7964 00005BC7 B990000000                              mov     ecx, 144        ; 36*4
  7965 00005BCC F3A5                                    rep movsd
  7966 00005BCE BE[D8F70400]                            mov     esi, mp3_mdct_win
  7967 00005BD3 BF[18FA0400]                            mov     edi, (mp3_mdct_win+240h)
  7968 00005BD8 B948000000                              mov     ecx, 72         ; 4*36/2 ; that is, 4*36 entry pairs
  7969                                  
  7970                                  .mdct_lop_dupe:                       
  7971 00005BDD A5                                      movsd                   ; copy normal, [4..7][even] = +[0..3][even
  7972 00005BDE AD                                      lodsd
  7973 00005BDF F7D8                                    neg     eax             ; copy negated, [4..7][odd] = -[0..3][odd]
  7974 00005BE1 AB                                      stosd
  7975 00005BE2 E2F9                                    loop    .mdct_lop_dupe
  7976 00005BE4 C3                                      retn
  7977                                  
  7978                                  
  7979                                  ; =============== S U B R O U T I N E =======================================
  7980                                  
  7981                                  
  7982                                  mp3_integer_init_table_4_3:
  7983 00005BE5 803D[FA8A0000]00                        cmp	byte [option_fast], 0
  7984 00005BEC B048                                    mov	al, 72          ; 100-6-VFRAC_BITS_slow
  7985 00005BEE 7402                                    jz	short .this_vfrac
  7986 00005BF0 B04C                                    mov	al, 76          ; 100-6-VFRAC_BITS_fast
  7987                                  
  7988                                  .this_vfrac:
  7989 00005BF2 A2[AC080100]                            mov     [mp3_curr_vfrac_bits], al
  7990 00005BF7 31FF                                    xor     edi, edi
  7991                                  
  7992                                  .table_4_3_lop:
  7993 00005BF9 57                                      push    edi             ; for i=1 to TABLE_4_3_SIZE-1
  7994 00005BFA 89F8                                    mov     eax, edi
  7995 00005BFC C1E802                                  shr     eax, 2
  7996 00005BFF F7E0                                    mul     eax
  7997 00005C01 F7E0                                    mul     eax
  7998 00005C03 31DB                                    xor     ebx, ebx
  7999 00005C05 E8A2000000                              call    cbrt96
  8000 00005C0A 020D[AC080100]                          add     cl, [mp3_curr_vfrac_bits]
  8001 00005C10 5F                                      pop     edi
  8002                                  
  8003                                  .inner_lop:
  8004 00005C11 89F8                                    mov     eax, edi
  8005 00005C13 83E003                                  and     eax, 3
  8006 00005C16 8B0485[84990000]                        mov     eax, [mp3_pow2_quarters+eax*4]
  8007 00005C1D F7E3                                    mul     ebx
  8008 00005C1F 88CD                                    mov     ch, cl
  8009 00005C21 09D2                                    or      edx, edx
  8010 00005C23 7904                                    jns     short .this
  8011 00005C25 D1EA                                    shr     edx, 1
  8012 00005C27 FECD                                    dec     ch
  8013                                  
  8014                                  .this:
  8015 00005C29 8914BD[E86E0200]                        mov     [mp3_table_4_3_value+edi*4], edx
  8016 00005C30 88AF[ACEE0100]                          mov     [mp3_table_4_3_exp+edi], ch
  8017 00005C36 47                                      inc     edi
  8018 00005C37 F7C703000000                            test    edi, 3
  8019 00005C3D 75D2                                    jnz     short .inner_lop
  8020 00005C3F 81FF3C800000                            cmp     edi, 803Ch
  8021 00005C45 72B2                                    jb      short .table_4_3_lop
  8022 00005C47 C3                                      retn
  8023                                  
  8024                                  
  8025                                  ; =============== S U B R O U T I N E =======================================
  8026                                  
  8027                                  
  8028                                  mp3_integer_init_exponent:
  8029 00005C48 BF[D8770400]                            mov     edi, mp3_expval_table
  8030 00005C4D 31D2                                    xor     edx, edx
  8031                                  
  8032                                  .exponent_lop:
  8033 00005C4F 89D0                                    mov     eax, edx        ; val=i
  8034 00005C51 89D3                                    mov     ebx, edx
  8035 00005C53 89D1                                    mov     ecx, edx
  8036 00005C55 C1EB04                                  shr     ebx, 4
  8037 00005C58 C1E906                                  shr     ecx, 6          ; 4+2
  8038 00005C5B 83E00F                                  and     eax, 0Fh        ; val=i AND 0Fh
  8039 00005C5E 83E303                                  and     ebx, 3
  8040 00005C61 8D1C83                                  lea     ebx, [ebx+eax*4] ; (0..0Fh)*4+(0..3)
  8041 00005C64 8B049D[E86E0200]                        mov     eax, [mp3_table_4_3_value+ebx*4]
  8042 00005C6B 09C0                                    or      eax, eax
  8043 00005C6D 741A                                    jz      short .this
  8044 00005C6F 2A8B[ACEE0100]                          sub     cl, [mp3_table_4_3_exp+ebx]
  8045 00005C75 770D                                    ja      short .left_shift
  8046 00005C77 F6D9                                    neg     cl
  8047 00005C79 D3E8                                    shr     eax, cl
  8048 00005C7B 80F91F                                  cmp     cl, 1Fh
  8049 00005C7E 7609                                    jbe     short .this
  8050 00005C80 31C0                                    xor     eax, eax
  8051 00005C82 EB05                                    jmp     short .this
  8052                                  
  8053                                  .left_shift:
  8054 00005C84 B8FFFFFF7F                              mov     eax, 7FFFFFFFh
  8055                                  
  8056                                  .this:
  8057 00005C89 AB                                      stosd
  8058 00005C8A 42                                      inc     edx
  8059 00005C8B 81FA00200000                            cmp     edx, 2000h
  8060 00005C91 72BC                                    jb      short .exponent_lop
  8061 00005C93 BE[D8770400]                            mov     esi, mp3_expval_table
  8062 00005C98 BF[D86F0400]                            mov     edi, mp3_exp_table
  8063 00005C9D B900020000                              mov     ecx, 200h
  8064                                  
  8065                                  .exponent_dupe_lop:
  8066 00005CA2 8B4604                                  mov     eax, [esi+4]
  8067 00005CA5 AB                                      stosd
  8068 00005CA6 83C640                                  add     esi, 40h
  8069 00005CA9 E2F7                                    loop    .exponent_dupe_lop
  8070 00005CAB C3                                      retn
  8071                                  
  8072                                  
  8073                                  ; =============== S U B R O U T I N E =======================================
  8074                                  
  8075                                  
  8076                                  cbrt96:
  8077 00005CAC 83EC18                                  sub     esp, 18h        ; cube root, val^(1/3), from https://gist.github.com/anonymous/729557
  8078                                                                          ; in:  ebx:edx:eax = unsigned 96bit input (integer)
  8079                                                                          ; out: ebx         = unsigned 32bit result (with fractional bits)
  8080                                                                          ; out: cl          = number of fractional bits
  8081 00005CAF 890424                                  mov     [esp], eax
  8082 00005CB2 89542404                                mov     [esp+4], edx
  8083 00005CB6 895C2408                                mov     [esp+8], ebx
  8084 00005CBA C744240C00000000                        mov     dword [esp+0Ch], 0
  8085 00005CC2 C744241000000000                        mov     dword [esp+10h], 0
  8086 00005CCA C744241400000000                        mov     dword [esp+14h], 0
  8087 00005CD2 31DB                                    xor     ebx, ebx        ; result.value
  8088 00005CD4 B100                                    mov     cl, 0           ; result.fraction
  8089 00005CD6 09D0                                    or      eax, edx        ; skip if zero
  8090 00005CD8 742F                                    jz      short .pre_shift_done
  8091                                  
  8092                                  .pre_shift_lop:
  8093 00005CDA F7442408000000E0                        test    dword [esp+8], 0E0000000h
  8094 00005CE2 7525                                    jnz     short .pre_shift_done
  8095 00005CE4 D12424                                  shl     dword [esp], 1
  8096 00005CE7 D1542404                                rcl     dword [esp+4], 1
  8097 00005CEB D1542408                                rcl     dword [esp+8], 1
  8098 00005CEF D12424                                  shl     dword [esp], 1
  8099 00005CF2 D1542404                                rcl     dword [esp+4], 1
  8100 00005CF6 D1542408                                rcl     dword [esp+8], 1
  8101 00005CFA D12424                                  shl     dword [esp], 1
  8102 00005CFD D1542404                                rcl     dword [esp+4], 1
  8103 00005D01 D1542408                                rcl     dword [esp+8], 1
  8104 00005D05 FEC1                                    inc     cl
  8105 00005D07 EBD1                                    jmp     short .pre_shift_lop
  8106                                  
  8107                                  .pre_shift_done:
  8108 00005D09 B520                                    mov     ch, 20h         ; loopcount
  8109                                  
  8110                                  .lop:
  8111 00005D0B 01DB                                    add     ebx, ebx        ; result*2
  8112 00005D0D 89D8                                    mov     eax, ebx        ; y
  8113 00005D0F 43                                      inc     ebx             ; result+1
  8114 00005D10 F7E3                                    mul     ebx             ; y*(y+1)
  8115 00005D12 89C6                                    mov     esi, eax
  8116 00005D14 89D7                                    mov     edi, edx
  8117 00005D16 31ED                                    xor     ebp, ebp
  8118 00005D18 F9                                      stc
  8119 00005D19 11F6                                    adc     esi, esi        ; y*(y+1)*2+1
  8120 00005D1B 11FF                                    adc     edi, edi
  8121 00005D1D 11ED                                    adc     ebp, ebp
  8122 00005D1F 01C6                                    add     esi, eax
  8123 00005D21 11D7                                    adc     edi, edx        ; y*(y+1)*3+1
  8124 00005D23 83D500                                  adc     ebp, 0
  8125 00005D26 D12424                                  shl     dword [esp], 1
  8126 00005D29 D1542404                                rcl     dword [esp+4], 1
  8127 00005D2D D1542408                                rcl     dword [esp+8], 1 ; shl 3
  8128 00005D31 D154240C                                rcl     dword [esp+0Ch], 1
  8129 00005D35 D1542410                                rcl     dword [esp+10h], 1
  8130 00005D39 D1542414                                rcl     dword [esp+14h], 1
  8131 00005D3D D12424                                  shl     dword [esp], 1
  8132 00005D40 D1542404                                rcl     dword [esp+4], 1
  8133 00005D44 D1542408                                rcl     dword [esp+8], 1
  8134 00005D48 D154240C                                rcl     dword [esp+0Ch], 1
  8135 00005D4C D1542410                                rcl     dword [esp+10h], 1
  8136 00005D50 D1542414                                rcl     dword [esp+14h], 1
  8137 00005D54 D12424                                  shl     dword [esp], 1
  8138 00005D57 D1542404                                rcl     dword [esp+4], 1
  8139 00005D5B D1542408                                rcl     dword [esp+8], 1
  8140 00005D5F D154240C                                rcl     dword [esp+0Ch], 1
  8141 00005D63 D1542410                                rcl     dword [esp+10h], 1
  8142 00005D67 D1542414                                rcl     dword [esp+14h], 1
  8143 00005D6B 2974240C                                sub     [esp+0Ch], esi
  8144 00005D6F 197C2410                                sbb     [esp+10h], edi  ; sub/compare
  8145 00005D73 196C2414                                sbb     [esp+14h], ebp
  8146 00005D77 730D                                    jnb     short .next
  8147 00005D79 4B                                      dec     ebx
  8148 00005D7A 0174240C                                add     [esp+0Ch], esi
  8149 00005D7E 117C2410                                adc     [esp+10h], edi  ; undo
  8150 00005D82 116C2414                                adc     [esp+14h], ebp
  8151                                  
  8152                                  .next:
  8153 00005D86 FECD                                    dec     ch
  8154 00005D88 7581                                    jnz     short .lop
  8155 00005D8A 83C418                                  add     esp, 18h
  8156                                  mp3_init_log_constants:
  8157 00005D8D C3                                      retn
  8158                                  
  8159                                  ;mp3_init_log_constants:
  8160                                  ;                retn
  8161                                  
  8162                                  ; =============== S U B R O U T I N E =======================================
  8163                                  
  8164                                  
  8165                                  mp3_build_huff_table_root:
  8166 00005D8E A3[88410500]                            mov     [_@@nb_codes], eax ; "init_vlc"
  8167 00005D93 C705[8C410500]0000-                     mov     dword [_@@prefix_numbits], 0
  8167 00005D9B 0000               
  8168 00005D9D C705[90410500]0000-                     mov     dword [_@@prefix_pattern], 0
  8168 00005DA5 0000               
  8169 00005DA7 60                                      pusha
  8170 00005DA8 89C1                                    mov     ecx, eax
  8171 00005DAA 31C0                                    xor     eax, eax
  8172                                  
  8173                                  .prescan_lop:
  8174 00005DAC 3A03                                    cmp     al, [ebx]
  8175 00005DAE 7702                                    ja      short .prescan_next
  8176 00005DB0 8A03                                    mov     al, [ebx]
  8177                                  
  8178                                  .prescan_next:
  8179 00005DB2 43                                      inc     ebx
  8180 00005DB3 E2F7                                    loop    .prescan_lop
  8181 00005DB5 3C09                                    cmp     al, 9           ; CHILD_BITS
  8182 00005DB7 7202                                    jb      short .prescan_this_limit
  8183 00005DB9 B009                                    mov     al, 9
  8184                                  
  8185                                  .prescan_this_limit:
  8186 00005DBB A3[84410500]                            mov     [_@@table_nb_bits], eax
  8187 00005DC0 61                                      popa
  8188                                  
  8189                                  mp3_build_huff_table_recursive_child:
  8190 00005DC1 8B0D[84410500]                          mov     ecx, [_@@table_nb_bits]
  8191 00005DC7 B801000000                              mov     eax, 1
  8192 00005DCC D3E0                                    shl     eax, cl
  8193 00005DCE A3[94410500]                            mov     [_@@curr_table_size], eax
  8194 00005DD3 48                                      dec     eax
  8195 00005DD4 A3[98410500]                            mov     [_@@curr_table_mask], eax
  8196 00005DD9 60                                      pusha
  8197 00005DDA 8B1D[98990000]                          mov     ebx, [mp3_huff_num_entries]
  8198 00005DE0 891D[9C410500]                          mov     [_@@curr_table_index], ebx
  8199 00005DE6 031D[94410500]                          add     ebx, [_@@curr_table_size]
  8200 00005DEC 891D[98990000]                          mov     [mp3_huff_num_entries], ebx
  8201 00005DF2 813D[98990000]002E-                     cmp     dword [mp3_huff_num_entries], 11776 ; HUFF_TREE_SIZE/4
  8201 00005DFA 0000               
  8202 00005DFC 0F8781AFFFFF                            ja      fatalunexpected
  8203 00005E02 61                                      popa
  8204 00005E03 BF[6C340100]                            mov     edi, huff_tree_buf
  8205 00005E08 A1[9C410500]                            mov     eax, [_@@curr_table_index]
  8206 00005E0D 66890497                                mov     [edi+edx*4], ax
  8207 00005E11 A1[84410500]                            mov     eax, [_@@table_nb_bits]
  8208 00005E16 F7D8                                    neg     eax
  8209 00005E18 6689449702                              mov     [edi+edx*4+2], ax
  8210 00005E1D BF[6C340100]                            mov     edi, huff_tree_buf
  8211 00005E22 8B15[9C410500]                          mov     edx, [_@@curr_table_index]
  8212 00005E28 8B0D[94410500]                          mov     ecx, [_@@curr_table_size]
  8213                                  
  8214                                  .clear_table_lop:
  8215 00005E2E 66C70497FFFF                            mov     word [edi+edx*4], 0FFFFh
  8216 00005E34 66C74497020000                          mov     word [edi+edx*4+2], 0
  8217 00005E3B 42                                      inc     edx
  8218 00005E3C E2F0                                    loop    .clear_table_lop
  8219 00005E3E 53                                      push    ebx
  8220 00005E3F 56                                      push    esi
  8221 00005E40 31D2                                    xor     edx, edx
  8222                                  
  8223                                  .make_table_lop:
  8224 00005E42 0FB60B                                  movzx   ecx, byte [ebx]
  8225 00005E45 0FB706                                  movzx   eax, word [esi]
  8226 00005E48 2B0D[8C410500]                          sub     ecx, [_@@prefix_numbits]
  8227 00005E4E 7E74                                    jle     short .make_table_lop_next
  8228 00005E50 D3E8                                    shr     eax, cl
  8229 00005E52 3B05[90410500]                          cmp     eax, [_@@prefix_pattern]
  8230 00005E58 756A                                    jnz     short .make_table_lop_next
  8231 00005E5A BF[6C340100]                            mov     edi, huff_tree_buf
  8232 00005E5F 0FB706                                  movzx   eax, word [esi]
  8233 00005E62 2B0D[84410500]                          sub     ecx, [_@@table_nb_bits]
  8234 00005E68 773E                                    ja      short .create_child_table
  8235 00005E6A F7D9                                    neg     ecx
  8236 00005E6C D3E0                                    shl     eax, cl
  8237 00005E6E 2305[98410500]                          and     eax, [_@@curr_table_mask]
  8238 00005E74 0305[9C410500]                          add     eax, [_@@curr_table_index]
  8239 00005E7A 8D3C87                                  lea     edi, [edi+eax*4]
  8240 00005E7D B801000000                              mov     eax, 1
  8241 00005E82 D3E0                                    shl     eax, cl
  8242 00005E84 89C1                                    mov     ecx, eax
  8243 00005E86 0FB603                                  movzx   eax, byte [ebx]
  8244 00005E89 2B05[8C410500]                          sub     eax, [_@@prefix_numbits]
  8245                                  
  8246                                  .make_rept_lop:
  8247 00005E8F 66837F0200                              cmp     word [edi+2], 0
  8248 00005E94 0F85E9AEFFFF                            jnz     fatalunexpected
  8249 00005E9A 668917                                  mov     [edi], dx
  8250 00005E9D 66894702                                mov     [edi+2], ax
  8251 00005EA1 83C704                                  add     edi, 4
  8252 00005EA4 E2E9                                    loop    .make_rept_lop
  8253 00005EA6 EB1C                                    jmp     short .make_table_lop_next
  8254                                  
  8255                                  .create_child_table:
  8256 00005EA8 D3E8                                    shr     eax, cl
  8257 00005EAA 2305[98410500]                          and     eax, [_@@curr_table_mask]
  8258 00005EB0 0305[9C410500]                          add     eax, [_@@curr_table_index]
  8259 00005EB6 F7D9                                    neg     ecx
  8260 00005EB8 66394C8702                              cmp     [edi+eax*4+2], cx
  8261 00005EBD 7C05                                    jl      short .make_table_lop_next
  8262 00005EBF 66894C8702                              mov     [edi+eax*4+2], cx
  8263                                  
  8264                                  .make_table_lop_next:
  8265 00005EC4 83C602                                  add     esi, 2
  8266 00005EC7 43                                      inc     ebx
  8267 00005EC8 42                                      inc     edx
  8268 00005EC9 3B15[88410500]                          cmp     edx, [_@@nb_codes]
  8269 00005ECF 0F826DFFFFFF                            jb      .make_table_lop
  8270 00005ED5 5E                                      pop     esi
  8271 00005ED6 5B                                      pop     ebx
  8272 00005ED7 8B0D[94410500]                          mov     ecx, [_@@curr_table_size]
  8273 00005EDD 8B15[9C410500]                          mov     edx, [_@@curr_table_index]
  8274                                  
  8275                                  .make_child_tables_lop:
  8276 00005EE3 BF[6C340100]                            mov     edi, huff_tree_buf
  8277 00005EE8 0FBF449702                              movsx   eax, word [edi+edx*4+2]
  8278 00005EED 83F800                                  cmp     eax, 0
  8279 00005EF0 796D                                    jns     short .make_child_tables_lop_next
  8280 00005EF2 F7D8                                    neg     eax
  8281 00005EF4 3B05[84410500]                          cmp     eax, [_@@table_nb_bits]
  8282 00005EFA 7605                                    jbe     short .make_child_tables_this
  8283 00005EFC A1[84410500]                            mov     eax, [_@@table_nb_bits]
  8284                                  
  8285                                  .make_child_tables_this:
  8286 00005F01 51                                      push	ecx
  8287 00005F02 52                                      push	edx
  8288 00005F03 FF35[9C410500]                          push	dword [_@@curr_table_index]
  8289 00005F09 FF35[84410500]                          push	dword [_@@table_nb_bits]
  8290 00005F0F FF35[8C410500]                          push	dword [_@@prefix_numbits]
  8291 00005F15 FF35[90410500]                          push	dword [_@@prefix_pattern]
  8292 00005F1B 8B0D[84410500]                          mov	ecx, [_@@table_nb_bits]
  8293 00005F21 A3[84410500]                            mov	[_@@table_nb_bits], eax
  8294 00005F26 010D[8C410500]                          add	[_@@prefix_numbits], ecx
  8295 00005F2C D325[90410500]                          shl	dword [_@@prefix_pattern], cl
  8296 00005F32 89D0                                    mov	eax, edx
  8297 00005F34 2B05[9C410500]                          sub	eax, [_@@curr_table_index]
  8298 00005F3A 0905[90410500]                          or	[_@@prefix_pattern], eax
  8299 00005F40 E87CFEFFFF                              call	mp3_build_huff_table_recursive_child
  8300 00005F45 8F05[90410500]                          pop	dword [_@@prefix_pattern]
  8301 00005F4B 8F05[8C410500]                          pop	dword [_@@prefix_numbits]
  8302 00005F51 8F05[84410500]                          pop	dword [_@@table_nb_bits]
  8303 00005F57 8F05[9C410500]                          pop	dword [_@@curr_table_index]
  8304 00005F5D 5A                                      pop	edx
  8305 00005F5E 59                                      pop	ecx
  8306                                  
  8307                                  .make_child_tables_lop_next:
  8308 00005F5F 42                                      inc	edx
  8309 00005F60 E281                                    loop	.make_child_tables_lop
  8310 00005F62 C3                                      retn
  8311                                  
  8312                                  
  8313                                  ; =============== S U B R O U T I N E =======================================
  8314                                  
  8315                                  
  8316                                  mp3_exclude_id3_and_tag:
  8317 00005F63 8B35[AC410500]                          mov     esi, [stream_pos]
  8318 00005F69 8B0D[B0410500]                          mov     ecx, [bytes_left]
  8319 00005F6F 83F90A                                  cmp     ecx, 10
  8320 00005F72 7240                                    jb      short .no_id3
  8321 00005F74 8B06                                    mov     eax, [esi]
  8322 00005F76 25FFFFFF00                              and     eax, 0FFFFFFh
  8323                                                  ;cmp    eax, '3DI'     ; "ID3"
  8324                                                  ; 20/10/2024 
  8325 00005F7B 3D49443300                              cmp     eax, 'ID3'     ; FASM & NASM syntax
  8326 00005F80 7532                                    jnz     short .no_id3
  8327 00005F82 8B4606                                  mov     eax, [esi+6]
  8328 00005F85 A980808080                              test    eax, 80808080h
  8329 00005F8A 7528                                    jnz     short .no_id3
  8330                                  
  8331                                  .xlat_4x7bit_to_28bit:
  8332 00005F8C 86E0                                    xchg    al, ah
  8333 00005F8E D0E0                                    shl     al, 1
  8334 00005F90 66D1E0                                  shl     ax, 1
  8335 00005F93 66C1E802                                shr     ax, 2
  8336 00005F97 C1C810                                  ror     eax, 16
  8337 00005F9A 86E0                                    xchg    al, ah
  8338 00005F9C D0E0                                    shl     al, 1
  8339 00005F9E 66D1E0                                  shl     ax, 1
  8340 00005FA1 C1E802                                  shr     eax, 2
  8341 00005FA4 83C00A                                  add     eax, 10
  8342 00005FA7 39C1                                    cmp     ecx, eax
  8343 00005FA9 7209                                    jb      short .no_id3
  8344 00005FAB 01C6                                    add     esi, eax
  8345 00005FAD 29C1                                    sub     ecx, eax
  8346 00005FAF A3[2C090100]                            mov     [mp3_id3_size], eax
  8347                                  
  8348                                  .no_id3:
  8349 00005FB4 BA80000000                              mov     edx, 80h
  8350 00005FB9 39D1                                    cmp     ecx, edx
  8351 00005FBB 721F                                    jb      short .no_tag_or_ext
  8352 00005FBD 8B440E80                                mov     eax, [esi+ecx-80h]
  8353 00005FC1 25FFFFFF00                              and     eax, 0FFFFFFh
  8354                                                  ;cmp    eax, 'GAT'     ; "TAG"
  8355                                                  ; 20/10/2024
  8356 00005FC6 3D54414700                              cmp     eax, 'TAG'     ; FASM & NASM syntax
  8357 00005FCB 0F8421010000                            jz      .got_tag_size_edx
  8358                                                  ;cmp    eax, 'TXE'
  8359 00005FD1 3D45585400                              cmp     eax, 'EXT'
  8360 00005FD6 0F8416010000                            jz      .got_tag_size_edx
  8361                                  
  8362                                  .no_tag_or_ext:
  8363 00005FDC BAE3000000                              mov     edx, 0E3h
  8364 00005FE1 39D1                                    cmp     ecx, edx
  8365 00005FE3 7211                                    jb      short .no_tagplus
  8366                                                  ;cmp    dword [esi+ecx-0E3h], '+GAT' ; "TAG+"
  8367                                                  ; 20/10/2024
  8368 00005FE5 81BC0E1DFFFFFF5441-                     cmp     dword [esi+ecx-0E3h], 'TAG+'
  8368 00005FEE 472B               
  8369 00005FF0 0F84FC000000                            jz      .got_tag_size_edx
  8370                                  
  8371                                  .no_tagplus:
  8372 00005FF6 BA14000000                              mov     edx, 20        ; 10+10
  8373 00005FFB 39D1                                    cmp     ecx, edx
  8374 00005FFD 723C                                    jb      short .no_3di  ; "3DI",04h
  8375 00005FFF 817C0EF633444904                        cmp     dword [esi+ecx-10], 4494433h ; 'ID3'+04000000h
  8376 00006007 7532                                    jnz     short .no_3di
  8377 00006009 F6440EFB10                              test    byte [esi+ecx-5], 10h ; bit 4
  8378 0000600E 742B                                    jz      short .no_3di
  8379 00006010 8B440EFC                                mov     eax, [esi+ecx-4]
  8380 00006014 A980808080                              test    eax, 80808080h
  8381 00006019 7520                                    jnz     short .no_3di
  8382                                  
  8383                                  .@xlat_4x7bit_to_28bit:
  8384 0000601B 86E0                                    xchg    al, ah
  8385 0000601D D0E0                                    shl     al, 1
  8386 0000601F 66D1E0                                  shl     ax, 1
  8387 00006022 66C1E802                                shr     ax, 2
  8388 00006026 C1C810                                  ror     eax, 10h
  8389 00006029 86E0                                    xchg    al, ah
  8390 0000602B D0E0                                    shl     al, 1
  8391 0000602D 66D1E0                                  shl     ax, 1
  8392 00006030 C1E802                                  shr     eax, 2
  8393 00006033 8D5014                                  lea     edx, [eax+20]  ; [eax+10+10] ; hdr+footer siz
  8394 00006036 E9B7000000                              jmp     .got_tag_size_edx
  8395                                  
  8396                                  .no_3di:
  8397                                                  ;cmp    dword [esi+ecx-32], 'TEPA' ; [esi+ecx-32+0]
  8398                                                  ; 20/10/2024
  8399 0000603B 817C0EE041504554                        cmp     dword [esi+ecx-32], 'APET'
  8400                                                                         ; check "APETAGEX"
  8401 00006043 7520                                    jnz     short .no_ape
  8402                                                  ;cmp    dword [esi+ecx-28], 'XEGA' ; [esi+ecx-32+4]
  8403 00006045 817C0EE441474558                        cmp     dword [esi+ecx-28], 'AGEX'
  8404 0000604D 7516                                    jnz     short .no_ape
  8405 0000604F 8B540EEC                                mov     edx, [esi+ecx-20] ; [esi+ecx-32+12] ; get size
  8406 00006053 F7440EF400000080                        test    dword [esi+ecx-12], 80000000h ; [esi+ecx-32+20],1 shl 31
  8407 0000605B 7403                                    jz      short .no_ape_header
  8408 0000605D 83C220                                  add     edx, 32        ; hdr.size
  8409                                  
  8410                                  .no_ape_header: 
  8411 00006060 E98D000000                              jmp     .got_tag_size_edx
  8412                                  
  8413                                  .no_ape:
  8414 00006065 BA14000000                              mov     edx, 20        ; 11+9
  8415 0000606A 39D1                                    cmp     ecx, edx       ; "LYRICSEND" or "LYRICS200"
  8416                                                                         ; (11+N+9 bytes each)
  8417 0000606C 7258                                    jb      short .no_lyrics
  8418                                                  ;cmp    dword [esi+ecx-9], 'IRYL'
  8419                                                  ; 20/10/2024
  8420 0000606E 817C0EF74C595249                        cmp     dword [esi+ecx-9], 'LYRI' ; FASM & NASM syntax
  8421 00006076 754E                                    jnz     short .no_lyrics
  8422 00006078 807C0EFB43                              cmp     byte [esi+ecx-5], 'C'
  8423 0000607D 7547                                    jnz     short .no_lyrics
  8424                                                  ;cmp    dword [esi+ecx-4], 'DNES'
  8425 0000607F 817C0EFC53454E44                        cmp     dword [esi+ecx-4], 'SEND'
  8426 00006087 740C                                    jz      short .lyrics3_v1
  8427                                                  ;cmp    dword [esi+ecx-4], '002S'
  8428 00006089 817C0EFC53323030                        cmp     dword [esi+ecx-4], 'S200'
  8429 00006091 7440                                    jz      short .lyrics3_v2
  8430 00006093 7531                                    jnz     short .no_lyrics
  8431                                  
  8432                                  .lyrics3_v1:
  8433 00006095 BA14000000                              mov     edx, 20        ; 11+9
  8434                                  
  8435                                  .lyrics3_v1_size_lop:
  8436 0000609A 8D040E                                  lea     eax, [esi+ecx]
  8437 0000609D 29D0                                    sub     eax, edx
  8438                                                  ;cmp    dword [eax], 'IRYL' ; "LYRICSBEGIN"
  8439                                                  ; 20/10/2024
  8440 0000609F 81384C595249                            cmp     dword [eax], 'LYRI'
  8441 000060A5 7512                                    jnz     short .lyrics3_v1_size_next
  8442                                                  ;cmp    dword [eax+4], 'EBSC'
  8443 000060A7 81780443534245                          cmp     dword [eax+4], 'CSBE'
  8444 000060AE 7509                                    jnz     short .lyrics3_v1_size_next
  8445                                                  ;cmp    dword [eax+7], 'NIGE'
  8446 000060B0 8178074547494E                          cmp     dword [eax+7], 'EGIN'
  8447 000060B7 7439                                    jz      short .got_tag_size_edx
  8448                                  
  8449                                  .lyrics3_v1_size_next:
  8450 000060B9 42                                      inc     edx
  8451 000060BA 81FA00140000                            cmp     edx, 5120
  8452 000060C0 7704                                    ja      short .no_lyrics
  8453 000060C2 39CA                                    cmp     edx, ecx
  8454 000060C4 76D4                                    jbe     short .lyrics3_v1_size_lop
  8455                                                  ;jmp     short .no_lyrics
  8456                                  
  8457                                  .no_lyrics:
  8458                                                  ;jmp    short .footer_tag_all_done
  8459                                  		; 22/10/2024
  8460                                  .footer_tag_all_done:
  8461 000060C6 8935[AC410500]                          mov     [stream_pos], esi
  8462 000060CC 890D[B0410500]                          mov     [bytes_left], ecx
  8463 000060D2 C3                                      retn
  8464                                  
  8465                                  .lyrics3_v2:
  8466 000060D3 51                                      push    ecx
  8467 000060D4 56                                      push    esi
  8468 000060D5 8D740EF1                                lea     esi, [esi+ecx-15] ; [esi+ecx-6-9]
  8469 000060D9 B906000000                              mov     ecx, 6
  8470 000060DE 31D2                                    xor     edx, edx
  8471                                  
  8472                                  .lyrics3_v2_size_lop:
  8473 000060E0 6BD20A                                  imul    edx, 10
  8474 000060E3 0FB606                                  movzx   eax, byte [esi]
  8475 000060E6 46                                      inc     esi
  8476 000060E7 2C30                                    sub     al, 30h
  8477 000060E9 01C2                                    add     edx, eax
  8478 000060EB E2F3                                    loop    .lyrics3_v2_size_lop
  8479 000060ED 5E                                      pop     esi
  8480 000060EE 59                                      pop     ecx
  8481 000060EF 83C20F                                  add     edx, 0Fh       ; 6+9
  8482                                                  ;jmp    short .got_tag_size_edx
  8483                                  
  8484                                  .got_tag_size_edx:
  8485                                  		;;;
  8486                                  		; 22/10/2024
  8487 000060F2 29D1                                    sub    ecx, edx
  8488 000060F4 7311                                    jnb    short .cont
  8489                                  		;;;
  8490 000060F6 89D0                                    mov     eax, edx
  8491 000060F8 E853050000                              call    wr_decimal_eax
  8492 000060FD E822050000                              call    wrcrlf
  8493                                                  ;;;
  8494                                  		;sub    ecx, edx
  8495                                                  ;jb     fatalunexpected
  8496 00006102 E97CACFFFF              		jmp	fatalunexpected
  8497                                  .cont:
  8498                                  		;;;
  8499 00006107 0115[30090100]                          add     [mp3_tag_size], edx
  8500 0000610D E9A2FEFFFF                              jmp     .no_id3
  8501                                  
  8502                                  
  8503                                  ; =============== S U B R O U T I N E =======================================
  8504                                  
  8505                                  
  8506                                  mp3_detect_free_format_block_size:
  8507 00006112 833D[A8080100]00                        cmp     dword [mp3_free_format_frame_size], 0
  8508 00006119 0F85A5000000                            jnz     .already_detected
  8509 0000611F 31D2                                    xor     edx, edx
  8510                                  
  8511                                  .find_distance_lop:
  8512 00006121 3B15[58090100]                          cmp     edx, [mp3_src_remain]
  8513 00006127 742B                                    jz      short .match_eof
  8514 00006129 8D4204                                  lea     eax, [edx+4]
  8515 0000612C 3B05[58090100]                          cmp     eax, [mp3_src_remain]
  8516 00006132 771E                                    ja      short .find_distance_failed
  8517 00006134 8B0416                                  mov     eax, [esi+edx]
  8518 00006137 E8F2A0FFFF                              call    bswap_eax
  8519 0000613C 3305[58B20000]                          xor     eax, [mp3_hdr_32bit_header]
  8520 00006142 25000CFEFF                              and     eax, 0FFFE0C00h
  8521 00006147 740B                                    jz      short .match_eof
  8522                                  
  8523                                  .find_distance_next:
  8524 00006149 42                                      inc     edx
  8525 0000614A 81FA00100000                            cmp     edx, 1000h
  8526 00006150 76CF                                    jbe     short .find_distance_lop
  8527                                  
  8528                                  .find_distance_failed:
  8529 00006152 F9                                      stc
  8530 00006153 C3                                      retn
  8531                                  
  8532                                  .match_eof:
  8533 00006154 89D0                                    mov     eax, edx
  8534 00006156 2B05[64B20000]                          sub     eax, [mp3_hdr_flag_padding]
  8535 0000615C 83F804                                  cmp     eax, 4
  8536 0000615F 72E8                                    jb      short .find_distance_next
  8537 00006161 A3[A8080100]                            mov     [mp3_free_format_frame_size], eax
  8538 00006166 31DB                                    xor     ebx, ebx
  8539                                  
  8540                                  .confirm_distance_lop:
  8541 00006168 8B041E                                  mov     eax, [esi+ebx]
  8542 0000616B E8BEA0FFFF                              call    bswap_eax
  8543 00006170 C1E80A                                  shr     eax, 10         ; 9+1
  8544 00006173 131D[A8080100]                          adc     ebx, [mp3_free_format_frame_size]
  8545 00006179 3B1D[58090100]                          cmp     ebx, [mp3_src_remain]
  8546 0000617F 7422                                    jz      short .confirm_distance_match_eof
  8547 00006181 8D4304                                  lea     eax, [ebx+4]
  8548 00006184 3B05[58090100]                          cmp     eax, [mp3_src_remain]
  8549 0000618A 77BD                                    ja      short .find_distance_next
  8550 0000618C 8B041E                                  mov     eax, [esi+ebx]
  8551 0000618F E89AA0FFFF                              call    bswap_eax
  8552 00006194 3305[58B20000]                          xor     eax, [mp3_hdr_32bit_header]
  8553 0000619A 25000CFEFF                              and     eax, 0FFFE0C00h
  8554 0000619F 75A8                                    jnz     short .find_distance_next
  8555 000061A1 EBC5                                    jmp     short .confirm_distance_lop
  8556                                  
  8557                                  .confirm_distance_match_eof:
  8558 000061A3 A1[A8080100]                            mov     eax, [mp3_free_format_frame_size]
  8559 000061A8 C1E003                                  shl     eax, 3
  8560 000061AB F725[68B20000]                          mul     dword [mp3_sample_rate]
  8561 000061B1 8B0D[68090100]                          mov     ecx, [mp3_nb_granules]
  8562 000061B7 69C940020000                            imul    ecx, 240h
  8563 000061BD F7F1                                    div     ecx
  8564 000061BF A3[70B20000]                            mov     [mp3_bit_rate], eax
  8565                                  
  8566                                  .already_detected:
  8567 000061C4 F8                                      clc
  8568 000061C5 C3                                      retn
  8569                                  
  8570                                  
  8571                                  ; =============== S U B R O U T I N E =======================================
  8572                                  
  8573                                  
  8574                                  mp3_check_xing_info:
  8575 000061C6 C705[B0080100]0000-                     mov     dword [mp3_xing_id], 0
  8575 000061CE 0000               
  8576 000061D0 C705[B8080100]0000-                     mov     dword [mp3_xing_frames], 0
  8576 000061D8 0000               
  8577 000061DA C705[BC080100]0000-                     mov     dword [mp3_xing_filesize], 0
  8577 000061E2 0000               
  8578 000061E4 8B35[4CB20000]                          mov     esi, [mp3_src_data_location]
  8579 000061EA AD                                      lodsd
  8580                                                  ;cmp    eax, 'gniX'
  8581                                  		; 20/10/2024
  8582 000061EB 3D58696E67              		cmp	eax, 'Xing'     ; FASM & NASM syntax
  8583 000061F0 7401                                    jz      short .xing
  8584 000061F2 C3                                      retn
  8585                                  
  8586                                  .xing:
  8587 000061F3 A3[B0080100]                            mov     [mp3_xing_id], eax
  8588 000061F8 AD                                      lodsd
  8589 000061F9 E830A0FFFF                              call    bswap_eax
  8590 000061FE A3[B4080100]                            mov     [mp3_xing_flags], eax
  8591 00006203 89C2                                    mov     edx, eax
  8592 00006205 F7C201000000                            test    edx, 1
  8593 0000620B 740B                                    jz      short .no_xing_frames
  8594 0000620D AD                                      lodsd
  8595 0000620E E81BA0FFFF                              call    bswap_eax
  8596 00006213 A3[B8080100]                            mov     [mp3_xing_frames], eax
  8597                                  
  8598                                  .no_xing_frames:
  8599 00006218 F7C202000000                            test    edx, 2          ; 1 shl 1
  8600 0000621E 740B                                    jz      short .no_xing_filesize
  8601 00006220 AD                                      lodsd
  8602 00006221 E808A0FFFF                              call    bswap_eax
  8603 00006226 A3[BC080100]                            mov     [mp3_xing_filesize], eax
  8604                                  
  8605                                  .no_xing_filesize:
  8606 0000622B F7C204000000                            test    edx, 4          ; 1 shl 2
  8607 00006231 740C                                    jz      short .no_xing_toc
  8608 00006233 B964000000                              mov     ecx, 100
  8609 00006238 BF[C0080100]                            mov     edi, mp3_xing_toc
  8610 0000623D F3A4                                    rep movsb
  8611                                  
  8612                                  .no_xing_toc:
  8613 0000623F F7C208000000                            test    edx, 8          ; 1 shl 3
  8614 00006245 740B                                    jz      short .no_xing_vbr_scale
  8615 00006247 AD                                      lodsd
  8616 00006248 E8E19FFFFF                              call    bswap_eax
  8617 0000624D A3[24090100]                            mov     [mp3_xing_vbr_scale], eax
  8618                                  
  8619                                  .no_xing_vbr_scale:
  8620 00006252 C705[70B20000]0000-                     mov	dword [mp3_bit_rate], 0
  8620 0000625A 0000               
  8621 0000625C A1[68B20000]                            mov	eax, [mp3_sample_rate]
  8622 00006261 C1E003                                  shl	eax, 3
  8623 00006264 F725[BC080100]                          mul	dword [mp3_xing_filesize]
  8624 0000626A 8B0D[B8080100]                          mov	ecx, [mp3_xing_frames]
  8625 00006270 0FAF0D[68090100]                        imul	ecx, [mp3_nb_granules]
  8626 00006277 69C940020000                            imul	ecx, 576        ; 18*32
  8627 0000627D 39CA                                    cmp	edx, ecx
  8628 0000627F 7307                                    jnb	short .overflow
  8629 00006281 F7F1                                    div	ecx
  8630 00006283 A3[70B20000]                            mov	[mp3_bit_rate], eax
  8631                                  
  8632                                  .overflow:
  8633 00006288 C3                                      retn
  8634                                  
  8635                                  
  8636                                  ; =============== S U B R O U T I N E =======================================
  8637                                  
  8638                                  		; 20/10/2024
  8639                                  mp3_decode_frame:
  8640 00006289 890D[58090100]                          mov     [mp3_src_remain], ecx
  8641 0000628F 893D[3C090100]                          mov     [mp3_samples_dst], edi
  8642 00006295 F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
  8643 0000629C 740E                                    jz      short .no_rdtsc_supported@@@@
  8644 0000629E 0F31                                    rdtsc
  8645 000062A0 2905[BC8C0000]                          sub     [rdtsc_total], eax
  8646 000062A6 1915[C08C0000]                          sbb     [rdtsc_total+4], edx
  8647                                  
  8648                                  .no_rdtsc_supported@@@@:
  8649 000062AC E8E19FFFFF                              call    mp3_search_get_header
  8650 000062B1 0F8294010000                            jc      .error
  8651 000062B7 A1[50B20000]                            mov     eax, [mp3_src_frame_size]
  8652 000062BC 83F800                                  cmp     eax, 0
  8653 000062BF 0F8E86010000                            jle     .error
  8654 000062C5 3B05[58090100]                          cmp     eax, [mp3_src_remain]
  8655 000062CB 0F877A010000                            ja      .error
  8656 000062D1 8935[54090100]                          mov     [mp3_bitstream_start], esi
  8657                                  		; 11/01/2025
  8658                                  		;mov	eax, 32
  8659                                  
  8660                                  .mp3mac_bitstream_set_position:
  8661                                  		; 22/10/2024
  8662                                                  ;mov    esi, [mp3_bitstream_start]
  8663                                                  ;mov    cl, al
  8664                                                  ;shr    eax, 3
  8665                                                  ;and    cl, 7
  8666                                                  ;mov	eax, 4
  8667                                                  ;add    esi, eax
  8668 000062D7 83C604                                  add     esi, 4
  8669 000062DA E8579FFFFF                              call    mp3_recollect_bits
  8670                                  
  8671                                  .mp3mac_get_n_bits:
  8672                                                  ;mov    eax, ebp        ; mp3_col32
  8673                                                  ;shl    ebp, cl
  8674                                                  ;rol    eax, cl
  8675                                                  ;xor    eax, ebp        ; mp3_col32
  8676                                                  ;sub    ch, cl          ; sub mp3_colNN,num
  8677                                                  ;jns    short .cont
  8678                                                  ;mov    cl, ch          ; mov cl,mp3_colNN
  8679                                                  ;add    ch, 16
  8680                                                  ;rol    ebp, cl         ; rol mp3_col32,cl
  8681                                                  ;mov    bp, [esi]       ; mov mp3_col16,word ptr [esi]
  8682                                                  ;add    esi, 2
  8683                                                  ;ror    bp, 8           ; endianess
  8684                                                  ;ror    ebp, cl         ; ror mp3_col32,cl
  8685                                  
  8686                                  .cont:
  8687 000062DF E8B4A1FFFF                              call	mp3_bitstream_read_header_extra
  8688 000062E4 E839A3FFFF                              call	mp3_bitstream_read_granules
  8689 000062E9 0F825C010000                            jc	.error
  8690 000062EF E8929FFFFF                              call	mp3_uncollect_bits
  8691 000062F4 8935[4CB20000]                          mov	[mp3_src_data_location], esi
  8692 000062FA 833D[3C090100]00                        cmp	dword [mp3_samples_dst], 0
  8693 00006301 0F840F010000                            jz	.skip_decoding
  8694 00006307 E8ECA7FFFF                              call	mp3_bitstream_append_to_main_data_pool
  8695 0000630C 833D[40090100]00                        cmp	dword [mp3_samples_output_size], 0
  8696 00006313 0F84FD000000                            jz	.skip_decoding
  8697 00006319 C705[4C090100]0000-                     mov	dword [mp3_curr_granule], 0
  8697 00006321 0000               
  8698 00006323 BB[6C090100]                            mov	ebx, mp3_granules
  8699                                  
  8700                                  .body_granule_lop:
  8701 00006328 891D[A0410500]                          mov	[_@@granule_addr], ebx
  8702 0000632E C705[48090100]0000-                     mov	dword [mp3_curr_channel], 0
  8702 00006336 0000               
  8703                                  
  8704                                  .body_channel_lop:
  8705 00006338 8B4304                                  mov     eax, [ebx+4]    ; [ebx+$mp3gr_part2_3_start]
  8706 0000633B 8B35[54090100]                          mov     esi, [mp3_bitstream_start]
  8707 00006341 88C1                                    mov     cl, al          ; mp3mac_bitstream_set_position
  8708 00006343 C1E803                                  shr     eax, 3
  8709 00006346 80E107                                  and     cl, 7
  8710 00006349 01C6                                    add     esi, eax
  8711 0000634B E8E69EFFFF                              call    mp3_recollect_bits
  8712 00006350 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits cl
  8713 00006352 D3E5                                    shl     ebp, cl
  8714 00006354 D3C0                                    rol     eax, cl
  8715 00006356 31E8                                    xor     eax, ebp
  8716 00006358 28CD                                    sub     ch, cl
  8717 0000635A 7913                                    jns     short .cont@
  8718 0000635C 88E9                                    mov     cl, ch          ; mp3mac_collect_more
  8719 0000635E 80C510                                  add     ch, 16
  8720 00006361 D3C5                                    rol     ebp, cl
  8721 00006363 668B2E                                  mov     bp, [esi]
  8722 00006366 83C602                                  add     esi, 2
  8723 00006369 66C1CD08                                ror     bp, 8
  8724 0000636D D3CD                                    ror     ebp, cl
  8725                                  
  8726                                  .cont@:
  8727 0000636F E81AA8FFFF                              call    mp3_bitstream_read_scalefacs
  8728 00006374 E812AAFFFF                              call    mp3_get_exponents_from_scale_factors
  8729 00006379 E856ABFFFF                              call    mp3_huffman_decode ; reads up to $mp3gr_part2_3_end
  8730 0000637E 0F82C7000000                            jc      .error
  8731                                  
  8732                                  .body_channel_next:
  8733 00006384 81C340130000                            add	ebx, 4928       ; $mp3gr_entrysiz*2
  8734 0000638A FF05[48090100]                          inc	dword [mp3_curr_channel]
  8735 00006390 A1[48090100]                            mov	eax, [mp3_curr_channel]
  8736 00006395 3B05[78B20000]                          cmp	eax, [mp3_output_num_channels]
  8737 0000639B 729B                                    jb	short .body_channel_lop
  8738 0000639D 8B1D[A0410500]                          mov	ebx, [_@@granule_addr]
  8739                                  
  8740                                  .mp3mac_push_bitstream:
  8741 000063A3 51                                      push	ecx
  8742 000063A4 55                                      push	ebp
  8743 000063A5 56                                      push	esi
  8744 000063A6 E827B0FFFF                              call	mp3_compute_stereo
  8745 000063AB C705[48090100]0000-                     mov	dword [mp3_curr_channel], 0
  8745 000063B3 0000               
  8746                                  
  8747                                  .cast_channel_lop:
  8748 000063B5 E8F0B2FFFF                              call    mp3_reorder_block
  8749 000063BA E885B3FFFF                              call    mp3_compute_antialias
  8750 000063BF E870BCFFFF                              call    mp3_compute_imdct
  8751 000063C4 81C340130000                            add     ebx, 4928       ; $mp3gr_entrysiz*2
  8752 000063CA FF05[48090100]                          inc	dword [mp3_curr_channel]
  8753 000063D0 A1[48090100]                            mov     eax, [mp3_curr_channel]
  8754 000063D5 3B05[78B20000]                          cmp     eax, [mp3_output_num_channels]
  8755 000063DB 72D8                                    jc      short .cast_channel_lop
  8756                                  
  8757                                  .mp3mac_pop_bitstream:
  8758 000063DD 5E                                      pop	esi
  8759 000063DE 5D                                      pop	ebp
  8760 000063DF 59                                      pop	ecx
  8761 000063E0 8B1D[A0410500]                          mov	ebx, [_@@granule_addr]
  8762 000063E6 81C3A0090000                            add	ebx, 2464       ; $mp3gr_entrysiz
  8763 000063EC FF05[4C090100]                          inc	dword [mp3_curr_granule]
  8764 000063F2 A1[4C090100]                            mov	eax, [mp3_curr_granule]
  8765 000063F7 3B05[68090100]                          cmp	eax, [mp3_nb_granules]
  8766 000063FD 0F8225FFFFFF                            jc	.body_granule_lop
  8767 00006403 E87E9EFFFF                              call	mp3_uncollect_bits
  8768 00006408 3B35[48B20000]                          cmp	esi, [main_data_pool_wr_ptr]
  8769 0000640E 773B                                    ja	short .error
  8770 00006410 FF15[9CB20000]                          call	dword [mp3_synth_filter_proc] ; synth maths
  8771                                  
  8772                                  .skip_decoding:
  8773 00006416 A1[5C090100]                            mov     eax, [mp3_extra_bytes]
  8774 0000641B 0105[50B20000]                          add     [mp3_src_frame_size], eax
  8775 00006421 A1[40090100]                            mov     eax, [mp3_samples_output_size]
  8776 00006426 0105[38090100]                          add     [mp3_total_output_size], eax
  8777 0000642C FF05[34090100]                          inc     dword [mp3_num_frames_decoded]
  8778                                  
  8779                                  .timelog_end:                            ; timelog_end macro ttt
  8780 00006432 F605[FC8A0000]10                        test    byte [cpuid_flags], 10h
  8781 00006439 740F                                    jz      short .no_rdtsc_supported
  8782 0000643B 0F31                                    rdtsc                   ; read timestamp counter
  8783 0000643D 0105[BC8C0000]                          add     [rdtsc_total], eax
  8784 00006443 1115[C08C0000]                          adc     [rdtsc_total+4], edx
  8785                                  		; 22/10/2024
  8786 00006449 F8                      		clc	
  8787                                  		; 20/10/2024
  8788                                  .no_rdtsc_supported:
  8789                                                  ;clc
  8790 0000644A C3                                      retn
  8791                                  
  8792                                  .error:
  8793 0000644B F605[FC8A0000]10                        test    byte [cpuid_flags], 10h ; timelog_end rdtsc_total
  8794 00006452 740E                                    jz      short .no_rdtsc_supported@
  8795 00006454 0F31                                    rdtsc
  8796 00006456 0105[BC8C0000]                          add     [rdtsc_total], eax
  8797 0000645C 1115[C08C0000]                          adc     [rdtsc_total+4], edx
  8798                                  
  8799                                  		; 20/10/2024
  8800                                  .no_rdtsc_supported@:
  8801 00006462 A1[5C090100]                            mov     eax, [mp3_extra_bytes]
  8802 00006467 0105[50B20000]                          add     [mp3_src_frame_size], eax
  8803 0000646D F9                                      stc
  8804 0000646E C3                                      retn
  8805                                  
  8806                                  
  8807                                  ; =============== S U B R O U T I N E =======================================
  8808                                  
  8809                                  
  8810                                  mp3_init:
  8811 0000646F BF[48A20000]                            mov     edi, main_data_pool_start ; = mp3_context_start
  8812                                                  ;mov    ecx, 74916      ; (mp3_context_end-mp3_context_start)/4
  8813 00006474 B984240100                              mov     ecx, (mp3_context_end-mp3_context_start)/4
  8814 00006479 31C0                                    xor     eax, eax        ; ERRIF @@len AND 03h
  8815 0000647B F3AB                                    rep stosd               ; clear context
  8816 0000647D C705[48B20000]-                         mov	dword [main_data_pool_wr_ptr], main_data_pool_start
  8816 00006483 [48A20000]         
  8817 00006487 833D[94990000]00                        cmp     dword [mp3_initialized], 0
  8818 0000648E 753C                                    jnz     short .already_initialized
  8819 00006490 E8CAF6FFFF                              call    mp3_integer_init_is_stereo_lsf
  8820 00006495 E823F7FFFF                              call    mp3_integer_init_mdct_windows
  8821 0000649A E846F7FFFF                              call    mp3_integer_init_table_4_3
  8822 0000649F E8A4F7FFFF                              call    mp3_integer_init_exponent
  8823 000064A4 E8F3F4FFFF                              call    mp3_any_init_synth_window
  8824 000064A9 E8D2F5FFFF                              call    mp3_any_init_band_indices
  8825 000064AE E8F7F5FFFF                              call    mp3_any_init_lsf_sf_expand
  8826 000064B3 E840F6FFFF                              call    mp3_any_init_huff_tables
  8827 000064B8 E8D0F8FFFF                              call    mp3_init_log_constants
  8828 000064BD E8A3F5FFFF                              call    mp3_init_post_collapse
  8829 000064C2 C705[94990000]0100-                     mov     dword [mp3_initialized], 1
  8829 000064CA 0000               
  8830                                  
  8831                                  .already_initialized:
  8832 000064CC 0FB605[FA8A0000]                        movzx   eax, byte [option_fast]
  8833 000064D3 C705[80B20000]0200-                     mov     dword [mp3_bytes_per_sample], 2
  8833 000064DB 0000               
  8834 000064DD D1E0                                    shl     eax, 1
  8835 000064DF 0205[F88A0000]                          add     al, [option_8bit]
  8836 000064E5 A801                                    test    al, 1
  8837 000064E7 740A                                    jz      short .not_8bit
  8838 000064E9 C705[80B20000]0100-                     mov     dword [mp3_bytes_per_sample], 1
  8838 000064F1 0000               
  8839                                  
  8840                                  .not_8bit:
  8841 000064F3 6BC003                                  imul    eax, 3
  8842 000064F6 0205[F98A0000]                          add     al, [option_rate_shift]
  8843 000064FC 8B0485[BA9F0000]                        mov     eax, [mp3_synth_filter_procs+eax*4]
  8844 00006503 A3[9CB20000]                            mov     [mp3_synth_filter_proc], eax
  8845 00006508 C3                                      retn
  8846                                  
  8847                                  
  8848                                  ; =============== S U B R O U T I N E =======================================
  8849                                  
  8850                                  
  8851                                  mp3_check_1st_frame:
  8852 00006509 E855FAFFFF                              call    mp3_exclude_id3_and_tag
  8853 0000650E 8B35[AC410500]                          mov     esi, [stream_pos]
  8854 00006514 8B0D[B0410500]                          mov     ecx, [bytes_left]
  8855 0000651A 31FF                                    xor     edi, edi
  8856 0000651C 31ED                                    xor     ebp, ebp
  8857 0000651E E866FDFFFF                              call    mp3_decode_frame
  8858 00006523 0F82E9000000                            jc     .error
  8859 00006529 E898FCFFFF                              call    mp3_check_xing_info
  8860 0000652E BA[18A00000]                            mov     edx, txt_file_size ; "file size: "
  8861 00006533 E8DB000000                              call    wrstr_edx
  8862 00006538 A1[28090100]                            mov     eax, [mp3_file_size]
  8863 0000653D E807010000                              call    wr_decimal_eax_with_thousands_seperator
  8864 00006542 BA[24A00000]                            mov     edx, txt_id3_size ; ", id3 size: "
  8865 00006547 E8C7000000                              call    wrstr_edx
  8866 0000654C A1[2C090100]                            mov     eax, [mp3_id3_size]
  8867 00006551 E8F3000000                              call    wr_decimal_eax_with_thousands_seperator
  8868 00006556 BA[31A00000]                            mov     edx, txt_tag_size ; ", tag size: "
  8869 0000655B E8B3000000                              call    wrstr_edx
  8870 00006560 A1[30090100]                            mov     eax, [mp3_tag_size]
  8871 00006565 E8DF000000                              call    wr_decimal_eax_with_thousands_seperator
  8872 0000656A E8B5000000                              call    wrcrlf
  8873 0000656F BA[3EA00000]                            mov     edx, txt_input ; "input: "
  8874 00006574 E89A000000                              call    wrstr_edx
  8875 00006579 A1[68B20000]                            mov     eax, [mp3_sample_rate]
  8876 0000657E E8CD000000                              call    wr_decimal_eax
  8877 00006583 BA[4FA00000]                            mov     edx, txt_hz ; " hz, "
  8878 00006588 E886000000                              call    wrstr_edx
  8879 0000658D A1[74B20000]                            mov     eax, [mp3_src_num_channels]
  8880 00006592 E8B9000000                              call    wr_decimal_eax
  8881 00006597 BA[55A00000]                            mov     edx, txt_channels ; " channels, "
  8882 0000659C E872000000                              call    wrstr_edx
  8883 000065A1 A1[70B20000]                            mov     eax, [mp3_bit_rate]
  8884 000065A6 31D2                                    xor     edx, edx
  8885 000065A8 B9E8030000                              mov     ecx, 1000
  8886 000065AD F7F1                                    div     ecx
  8887 000065AF E89C000000                              call    wr_decimal_eax
  8888 000065B4 BA[66A00000]                            mov     edx, txt_kbit_s ; " kbit/s"
  8889 000065B9 E855000000                              call    wrstr_edx
  8890 000065BE E861000000                              call    wrcrlf
  8891 000065C3 BA[46A00000]                            mov     edx, txt_output ; "output: "
  8892 000065C8 E846000000                              call    wrstr_edx
  8893 000065CD A1[7CB20000]                            mov     eax, [mp3_output_sample_rate]
  8894 000065D2 E879000000                              call    wr_decimal_eax
  8895 000065D7 BA[4FA00000]                            mov     edx, txt_hz ; " hz, "
  8896 000065DC E832000000                              call    wrstr_edx
  8897 000065E1 A1[78B20000]                            mov     eax, [mp3_output_num_channels]
  8898 000065E6 E865000000                              call    wr_decimal_eax
  8899 000065EB BA[55A00000]                            mov     edx, txt_channels ; " channels, "
  8900 000065F0 E81E000000                              call    wrstr_edx
  8901 000065F5 A1[80B20000]                            mov     eax, [mp3_bytes_per_sample]
  8902 000065FA C1E003                                  shl     eax, 3
  8903 000065FD E84E000000                              call    wr_decimal_eax
  8904 00006602 BA[61A00000]                            mov     edx, txt_bit ; " bit"
  8905 00006607 E807000000                              call    wrstr_edx
  8906 0000660C E813000000                              call    wrcrlf
  8907 00006611 F8                                      clc
  8908                                  .error:
  8909 00006612 C3                                      retn
  8910                                  
  8911                                  ;.error:
  8912                                                  ;stc
  8913                                                  ;retn
  8914                                  
  8915                                  
  8916                                  ; =============== S U B R O U T I N E =======================================
  8917                                  
  8918                                  ;wrchr:
  8919                                                  ;pusha
  8920                                                  ;mov     [wrchr_buf], al
  8921                                                  ;push    0            ; lpOverlapped
  8922                                                  ;push    diskresult   ; lpNumberOfBytesWritten
  8923                                                  ;push    1            ; nNumberOfBytesToWrite
  8924                                                  ;push    wrchr_buf    ; lpBuffer
  8925                                                  ;push    [std_out]    ; hFile
  8926                                                  ;call    [WriteFile]
  8927                                                  ;popa
  8928                                                  ;retn
  8929                                  
  8930                                  
  8931                                  ; =============== S U B R O U T I N E =======================================
  8932                                  
  8933                                  
  8934                                  wrstr_edx:
  8935 00006613 50                                      push    eax
  8936                                  .lop:
  8937 00006614 8A02                                    mov     al, [edx]
  8938 00006616 42                                      inc     edx
  8939 00006617 3C00                                    cmp     al, 0
  8940 00006619 7407                                    jz      short .done
  8941 0000661B E801040000                              call    wrchr
  8942 00006620 EBF2                                    jmp     short .lop
  8943                                  .done:
  8944 00006622 58                                      pop     eax
  8945 00006623 C3                                      retn
  8946                                  
  8947                                  ; =============== S U B R O U T I N E =======================================
  8948                                  
  8949                                  
  8950                                  wrcrlf:
  8951 00006624 50                                      push    eax
  8952 00006625 B00D                                    mov     al, 0Dh
  8953 00006627 E8F5030000                              call    wrchr
  8954 0000662C B00A                                    mov     al, 0Ah
  8955 0000662E E8EE030000                              call    wrchr
  8956 00006633 58                                      pop     eax
  8957 00006634 C3                                      retn
  8958                                  
  8959                                  ; =============== S U B R O U T I N E =======================================
  8960                                  
  8961                                  
  8962                                  wrspc:
  8963 00006635 50                                      push    eax
  8964 00006636 B020                                    mov     al, 20h
  8965 00006638 E8E4030000                              call    wrchr
  8966 0000663D 58                                      pop     eax
  8967 0000663E C3                                      retn
  8968                                  
  8969                                  ; =============== S U B R O U T I N E =======================================
  8970                                  
  8971                                  
  8972                                  wrcomma:
  8973 0000663F 50                                      push    eax
  8974 00006640 B02C                                    mov     al, ','
  8975 00006642 E8DA030000                              call    wrchr
  8976 00006647 58                                      pop     eax
  8977 00006648 C3                                      retn
  8978                                  
  8979                                  ; =============== S U B R O U T I N E =======================================
  8980                                  
  8981                                  
  8982                                  wr_decimal_eax_with_thousands_seperator:
  8983 00006649 51                                      push    ecx
  8984 0000664A 66B90200                                mov     cx, 2
  8985 0000664E EB03                                    jmp     short wr_decimal_eax_inj
  8986                                  
  8987                                  ; =============== S U B R O U T I N E =======================================
  8988                                  
  8989                                  
  8990                                  wr_decimal_eax:
  8991 00006650 51                                      push    ecx
  8992 00006651 31C9                                    xor     ecx, ecx
  8993                                  
  8994                                  wr_decimal_eax_inj:
  8995 00006653 50                                      push    eax
  8996 00006654 53                                      push    ebx
  8997 00006655 52                                      push    edx
  8998 00006656 BB00CA9A3B                              mov     ebx, 1000000000 ; nine zeroes (32bit max 4.294.967.296)
  8999                                  
  9000                                  .dezlop:
  9001 0000665B FEC9                                    dec     cl
  9002 0000665D 750C                                    jnz     short .no_thousands
  9003 0000665F B103                                    mov     cl, 3
  9004 00006661 80FD00                                  cmp     ch, 0
  9005 00006664 7405                                    jz      short .no_thousands
  9006 00006666 E8D4FFFFFF                              call    wrcomma
  9007                                  
  9008                                  .no_thousands:
  9009 0000666B 31D2                                    xor     edx, edx
  9010 0000666D F7F3                                    div     ebx
  9011 0000666F 83FB01                                  cmp     ebx, 1
  9012 00006672 7404                                    jz      short .force_last_zero
  9013 00006674 08C5                                    or      ch, al
  9014 00006676 7407                                    jz      short .skip_lead_zero
  9015                                  
  9016                                  .force_last_zero:
  9017 00006678 0430                                    add     al, 30h
  9018 0000667A E8A2030000                              call    wrchr
  9019                                  
  9020                                  .skip_lead_zero:
  9021 0000667F 52                                      push    edx
  9022 00006680 89D8                                    mov     eax, ebx
  9023 00006682 BB0A000000                              mov     ebx, 10
  9024 00006687 31D2                                    xor     edx, edx
  9025 00006689 F7F3                                    div     ebx
  9026 0000668B 83F800                                  cmp     eax, 0
  9027 0000668E 89C3                                    mov     ebx, eax
  9028 00006690 58                                      pop     eax
  9029 00006691 75C8                                    jnz     short .dezlop
  9030 00006693 5A                                      pop     edx
  9031 00006694 5B                                      pop     ebx
  9032 00006695 58                                      pop     eax
  9033 00006696 59                                      pop     ecx
  9034 00006697 C3                                      retn
  9035                                  
  9036                                  ; =============== S U B R O U T I N E =======================================
  9037                                  
  9038                                  
  9039                                  wrdigital:
  9040 00006698 50                                      push    eax
  9041 00006699 240F                                    and     al, 0Fh
  9042 0000669B 3C09                                    cmp     al, 9
  9043 0000669D 7602                                    jbe     short .this
  9044 0000669F 0407                                    add     al, 7
  9045                                  
  9046                                  .this:
  9047 000066A1 0430                                    add     al, 30h
  9048 000066A3 E879030000                              call    wrchr
  9049 000066A8 58                                      pop     eax
  9050 000066A9 C3                                      retn
  9051                                  
  9052                                  ; =============== S U B R O U T I N E =======================================
  9053                                  
  9054                                  
  9055                                  wrhexal:
  9056 000066AA C0C804                                  ror     al, 4
  9057 000066AD E8E6FFFFFF                              call    wrdigital
  9058 000066B2 C0C804                                  ror     al, 4
  9059 000066B5 EBE1                                    jmp     short wrdigital
  9060                                  
  9061                                  ; =============== S U B R O U T I N E =======================================
  9062                                  
  9063                                  
  9064                                  wrhexax:
  9065 000066B7 66C1C808                                ror     ax, 8
  9066 000066BB E8EAFFFFFF                              call    wrhexal
  9067 000066C0 66C1C808                                ror     ax, 8
  9068 000066C4 EBE4                                    jmp     short wrhexal
  9069                                  
  9070                                  ; =============== S U B R O U T I N E =======================================
  9071                                  
  9072                                  
  9073                                  wrhexeax:
  9074 000066C6 C1C810                                  ror     eax, 10h
  9075 000066C9 E8E9FFFFFF                              call    wrhexax
  9076 000066CE C1C810                                  ror     eax, 10h
  9077 000066D1 EBE4                                    jmp     short wrhexax
  9078                                  
  9079                                  ; =============== S U B R O U T I N E =======================================
  9080                                  
  9081                                  %if 0
  9082                                  
  9083                                  get_commandline:
  9084                                                  call    [GetCommandLineA]
  9085                                                  mov     esi, eax
  9086                                                  mov     edi, cmdline_buf
  9087                                                  mov     ecx, 1024       ; cmdline_max
  9088                                  
  9089                                  .get_cmdline_lop:
  9090                                                  lodsb
  9091                                                  cmp     al, 0
  9092                                                  stosb
  9093                                                  loopne  .get_cmdline_lop
  9094                                                  mov     byte [edi-1], 0
  9095                                                  mov     esi, cmdline_buf
  9096                                                  mov     edi, cmdline_buf
  9097                                                  call    _@@get_item     ; get/skip name of the executable itself
  9098                                  
  9099                                  .get_items_lop:
  9100                                                  call    _@@get_item
  9101                                                  mov     al, [ebx]
  9102                                                  cmp     al, 0
  9103                                                  jz      .done
  9104                                                  cmp     al, '/'
  9105                                                  jz      short .switch
  9106                                                  cmp     al, '-'
  9107                                                  jz      short .switch
  9108                                                  mov     eax, [edi-5]
  9109                                                  or      eax, 20202000h
  9110                                                  ;cmp    eax, 'vaw.'     ; ".wav"
  9111                                                  cmp     eax, '.wav'     ; FASM & NASM syntax
  9112                                                  jnz     short .not_wav_name
  9113                                                  mov     [mp3_dst_fname], ebx
  9114                                                  jmp     short .get_items_lop
  9115                                  
  9116                                  .not_wav_name:
  9117                                                  mov     eax, [edi-5]
  9118                                                  or      eax, 20202000h
  9119                                                  ;cmp    eax, 'mcp.'     ; ".pcm"
  9120                                                  cmp     eax, '.pcm'     ; FASM & NASM syntax
  9121                                                  jnz     short .not_pcm_name
  9122                                                  mov     [mp3_pcm_fname], ebx
  9123                                                  jmp     short .get_items_lop
  9124                                  
  9125                                  .not_pcm_name:
  9126                                                  mov     [mp3_src_fname], ebx
  9127                                                  jmp     short .get_items_lop
  9128                                  
  9129                                  .switch:
  9130                                                  ;cmp	dword [ebx+1], 'onom' ; "mono"
  9131                                                  cmp	dword [ebx+1], 'mono'
  9132                                                  jnz     short .not_switch_mono
  9133                                                  mov	byte [option_mono], 1
  9134                                                  jmp	short .get_items_lop
  9135                                  
  9136                                  .not_switch_mono:
  9137                                                  ;cmp	dword [ebx+1], 'tsaf' ; "fast"
  9138                                                  cmp	dword [ebx+1], 'fast' ; FASM & NASM syntax
  9139                                                  jnz	short .not_fast_option
  9140                                                  mov	byte [option_fast], 1
  9141                                                  jmp	short .get_items_lop
  9142                                  
  9143                                  .not_fast_option:
  9144                                                  ;cmp    dword [ebx+1], 'tib8' ; "8bit"
  9145                                                  cmp     dword [ebx+1], '8bit'
  9146                                                  jnz     short .not_switch_8bit
  9147                                                  mov     [option_8bit], 1
  9148                                                  jmp     .get_items_lop
  9149                                  
  9150                                  .not_switch_8bit:
  9151                                                  ;cmp    dword [ebx+1], 'flah' ; "half"
  9152                                                  cmp     dword [ebx+1], 'half'
  9153                                                  jnz     short .not_switch_half
  9154                                                  mov     [option_rate_shift], 1
  9155                                                  jmp     .get_items_lop
  9156                                  
  9157                                  .not_switch_half:
  9158                                                  ;cmp    dword [ebx+1], 'rauq' ; "quar"
  9159                                                  cmp     dword [ebx+1], 'quar'
  9160                                                  jnz     short .not_switch_quarter
  9161                                                  mov     [option_rate_shift], 2
  9162                                                  jmp     .get_items_lop
  9163                                  
  9164                                  .not_switch_quarter:
  9165                                                  ;cmp    dword [ebx+1], 'tset' ; "test"
  9166                                                  cmp     dword [ebx+1], 'test'
  9167                                                  jnz     short .not_switch_test
  9168                                                  mov     byte [option_test], 1
  9169                                                  jmp     .get_items_lop
  9170                                  
  9171                                  .not_switch_test:
  9172                                                  jmp     short .help
  9173                                  
  9174                                  .done:
  9175                                                  cmp	dword [mp3_src_fname], 0
  9176                                                  jz      short .help
  9177                                                  ;;; Erdogan Tan - 17/10/2024
  9178                                                  mov     edx, txt_ctrlc
  9179                                                  call    wrstr_edx
  9180                                                  ;;;
  9181                                                  mov     edx, txt_file ; "file: "
  9182                                                  call    wrstr_edx
  9183                                                  mov     edx, [mp3_src_fname]
  9184                                                  call    wrstr_edx
  9185                                                  call    wrcrlf
  9186                                                  clc
  9187                                                  retn
  9188                                  
  9189                                  .help:
  9190                                                  ;;; Erdogan Tan - 17/10/2024
  9191                                                  mov     edx, txt_about
  9192                                                  call    wrstr_edx
  9193                                                  ;;;
  9194                                                  mov     edx, txt_help ; "usage: mp3play input.mp3 [output.wav] ["...
  9195                                                  call    wrstr_edx
  9196                                                  stc
  9197                                                  retn
  9198                                  
  9199                                  %endif
  9200                                  
  9201                                  ; =============== S U B R O U T I N E =======================================
  9202                                  
  9203                                  %if 0
  9204                                  
  9205                                  _@@get_item:
  9206                                                  lodsb
  9207                                                  dec     al
  9208                                                  cmp     al, 1Fh         ; 20-1
  9209                                                  jbe     short _@@get_item ; _@@skip_spc_lop
  9210                                                  dec     esi
  9211                                                  mov     ebx, edi
  9212                                                  mov     ah, 0           ; flag initially not quoted
  9213                                  
  9214                                  .char_lop:
  9215                                                  lodsb
  9216                                                  cmp     al, '"'
  9217                                                  jnz     short .no_quote
  9218                                                  xor     ah, 1
  9219                                                  jmp     short .char_lop
  9220                                  
  9221                                  .no_quote:
  9222                                                  stosb
  9223                                                  cmp     al, 0
  9224                                                  jz      short .src_end
  9225                                                  cmp     al, 20h
  9226                                                  ja      short .char_lop
  9227                                                  cmp     ah, 0           ; ignore spaces if inside "quoted area"
  9228                                                  jnz     short .char_lop
  9229                                                  mov     byte [edi-1], 0 ; eol (replace space by 00h)
  9230                                                  retn
  9231                                  
  9232                                  .src_end:
  9233                                                  dec     esi
  9234                                                  retn
  9235                                  
  9236                                  %endif
  9237                                  
  9238                                  ; =============== S U B R O U T I N E =======================================
  9239                                  
  9240                                  
  9241                                  %if 0
  9242                                  
  9243                                  open_and_mmap_the_file:
  9244                                                  push    0               ; hTemplateFile
  9245                                                  push    0               ; dwFlagsAndAttributes
  9246                                                  push    3               ; dwCreationDisposition
  9247                                                  push    0               ; lpSecurityAttributes
  9248                                                  push    1               ; dwShareMode
  9249                                                  push    80000000h       ; dwDesiredAccess
  9250                                                  push    [mp3_src_fname] ; lpFileName
  9251                                                  call    [CreateFileA]
  9252                                                  mov     [hFile], eax
  9253                                                  cmp     eax, 0FFFFFFFFh ; INVALID_HANDLE_VALUE
  9254                                                  jz      short .not_found
  9255                                                  push    0               ; lpFileSizeHigh
  9256                                                  push    [hFile]      ; hFile
  9257                                                  call    [GetFileSize]
  9258                                                  mov     [mp3_file_size], eax
  9259                                                  mov     [bytes_left], eax
  9260                                                  push    0               ; lpName
  9261                                                  push    0               ; dwMaximumSizeLow
  9262                                                  push    0               ; dwMaximumSizeHigh
  9263                                                  push    2               ; flProtect
  9264                                                  push    0               ; lpFileMappingAttributes
  9265                                                  push    [hFile]      ; hFile
  9266                                                  call    [CreateFileMappingA]
  9267                                                  mov     [hMap], eax
  9268                                                  push    0               ; dwNumberOfBytesToMap
  9269                                                  push    0               ; dwFileOffsetLow
  9270                                                  push    0               ; dwFileOffsetHigh
  9271                                                  push    4               ; dwDesiredAccess
  9272                                                  push    [hMap]       ; hFileMappingObject
  9273                                                  call    [MapViewOfFile]
  9274                                                  mov     [stream_start], eax
  9275                                                  mov     [stream_pos], eax
  9276                                                  mov     esi, [stream_start]
  9277                                                  mov     ecx, [bytes_left]
  9278                                  
  9279                                  .lll:
  9280                                                  lodsb
  9281                                                  loop    .lll
  9282                                                  clc
  9283                                                  retn
  9284                                  
  9285                                  .not_found:
  9286                                                  mov     edx, txt_not_found ; "cannot open source file\r\n"
  9287                                                  call    wrstr_edx
  9288                                                  stc
  9289                                                  retn
  9290                                  
  9291                                  %endif
  9292                                  
  9293                                  
  9294                                  ; =============== S U B R O U T I N E =======================================
  9295                                  
  9296                                  
  9297                                  mp3_plain_test_without_output:
  9298 000066D3 60                                      pusha
  9299 000066D4 8B35[AC410500]                          mov     esi, [stream_pos]
  9300 000066DA 8B0D[B0410500]                          mov     ecx, [bytes_left]
  9301 000066E0 BF[00D00500]                            mov     edi, sample_buffer
  9302 000066E5 31ED                                    xor     ebp, ebp
  9303 000066E7 E89DFBFFFF                              call    mp3_decode_frame
  9304 000066EC 61                                      popa
  9305 000066ED 7218                                    jc      short .exit
  9306 000066EF A1[50B20000]                            mov     eax, [mp3_src_frame_size]
  9307 000066F4 83F800                                  cmp     eax, 0
  9308 000066F7 740E                                    jz      short .exit
  9309 000066F9 0105[AC410500]                          add     [stream_pos], eax
  9310 000066FF 2905[B0410500]                          sub     [bytes_left], eax
  9311 00006705 EBCC                                    jmp     short mp3_plain_test_without_output
  9312                                  
  9313                                  .exit:
  9314 00006707 C3                                      retn
  9315                                  
  9316                                  
  9317                                  ; =============== S U B R O U T I N E =======================================
  9318                                  
  9319                                  		; 20/10/2024
  9320                                  mp3_cast_to_wav_file:
  9321 00006708 E86F000000                              call	mp3_create_wav_file
  9322                                  		; 20/10/2024
  9323 0000670D 730A                    		jnc	short .lop
  9324 0000670F BBFFFFFFFF              		mov	ebx, -1
  9325 00006714 E91D050000              		jmp	ExitProcess@ ; 13/01/2025
  9326                                  .lop:
  9327 00006719 60                                      pusha
  9328 0000671A 8B35[AC410500]                          mov	esi, [stream_pos]
  9329 00006720 8B0D[B0410500]                          mov	ecx, [bytes_left]
  9330 00006726 BF[00D00500]                            mov	edi, sample_buffer
  9331 0000672B 31ED                                    xor	ebp, ebp
  9332 0000672D E857FBFFFF                              call	mp3_decode_frame
  9333 00006732 61                                      popa
  9334 00006733 7241                                    jc	short .exit
  9335 00006735 A1[50B20000]                            mov	eax, [mp3_src_frame_size]
  9336 0000673A 83F800                                  cmp	eax, 0
  9337 0000673D 7437                                    jz	short .exit
  9338 0000673F 0105[AC410500]                          add	[stream_pos], eax
  9339 00006745 2905[B0410500]                          sub	[bytes_left], eax
  9340                                                  ;push	0          ; lpOverlapped
  9341                                                  ;push	diskresult ; lpNumberOfBytesWritten
  9342 0000674B FF35[40090100]                          push	dword [mp3_samples_output_size] ; nNumberOfBytesToWrite
  9343 00006751 68[00D00500]                            push	sample_buffer ; lpBuffer
  9344 00006756 FF35[34420500]                          push	dword [mp3_wav_handle] ; hFile
  9345                                                  ;call	[WriteFile]
  9346                                  		;;;
  9347                                  		; 20/10/2024
  9348 0000675C E8DC040000              		call	WriteFile
  9349 00006761 7213                    		jc	short .exit
  9350                                  		;;;
  9351 00006763 A1[40090100]                            mov	eax, [mp3_samples_output_size]
  9352 00006768 0105[B0990000]                          add	dword [mp3_wav_header+4], eax
  9353 0000676E 0105[D4990000]                          add	dword [mp3_wav_header+28h], eax
  9354 00006774 EBA3                                    jmp	short .lop
  9355                                  
  9356                                  .exit:
  9357 00006776 E860000000                              call	mp3_close_wav_file
  9358 0000677B C3                                      retn
  9359                                  
  9360                                  
  9361                                  ; =============== S U B R O U T I N E =======================================
  9362                                  
  9363                                  		; 20/10/2024
  9364                                  
  9365                                  mp3_create_wav_file:
  9366 0000677C A1[7CB20000]                            mov     eax, [mp3_output_sample_rate]
  9367 00006781 8B0D[78B20000]                          mov     ecx, [mp3_output_num_channels]
  9368 00006787 8B15[80B20000]                          mov     edx, [mp3_bytes_per_sample]
  9369 0000678D 66890D[C2990000]                        mov     word [mp3_wav_header+16h], cx
  9370 00006794 A3[C4990000]                            mov     dword [mp3_wav_header+18h], eax
  9371 00006799 0FAFCA                                  imul    ecx, edx
  9372 0000679C 0FAFC1                                  imul    eax, ecx
  9373 0000679F C1E203                                  shl     edx, 3
  9374 000067A2 A3[C8990000]                            mov     dword [mp3_wav_header+1Ch], eax
  9375 000067A7 66890D[CC990000]                        mov     word [mp3_wav_header+20h], cx
  9376 000067AE 668915[CE990000]                        mov     word [mp3_wav_header+22h], dx
  9377                                                  ;push   0               ; hTemplateFile
  9378                                                  ;push   80h             ; dwFlagsAndAttributes
  9379                                                  ;push   2               ; dwCreationDisposition
  9380                                                  ;push   0               ; lpSecurityAttributes
  9381                                                  ;push   0               ; dwShareMode
  9382                                                  ;push   0C0000000h      ; dwDesiredAccess
  9383 000067B5 FF35[A4990000]                          push    dword [mp3_dst_fname] ; lpFileName
  9384                                                  ;call   [CreateFileA]
  9385                                  		;;;
  9386                                  		; 20/10/2024
  9387 000067BB E8AF040000              		call	CreateFile
  9388 000067C0 7301                    		jnc	short .ok
  9389 000067C2 C3                      		retn
  9390                                  .ok:
  9391                                  		;;;
  9392 000067C3 A3[34420500]                            mov     [mp3_wav_handle], eax
  9393                                                  ; 20/10/2024
  9394                                  		;call   mp3_write_wav_header
  9395                                                  ;retn
  9396                                  
  9397                                  
  9398                                  ; =============== S U B R O U T I N E =======================================
  9399                                  
  9400                                  		; 20/10/2024
  9401                                  mp3_write_wav_header:
  9402                                                  ;push	0               ; lpOverlapped
  9403                                                  ;push	diskresult      ; lpNumberOfBytesWritten
  9404 000067C8 6A2C                                    push	44 ; 2Ch        ; nNumberOfBytesToWrite
  9405 000067CA 68[AC990000]                            push	mp3_wav_header  ; lpBuffer
  9406 000067CF FF35[34420500]                          push	dword [mp3_wav_handle] ; hFile
  9407                                                  ;call	[WriteFile]
  9408                                                  ;;;
  9409                                  		; 20/10/2024
  9410 000067D5 E863040000                              call	WriteFile
  9411                                                  ;;;
  9412 000067DA C3                      		retn
  9413                                  
  9414                                  
  9415                                  ; =============== S U B R O U T I N E =======================================
  9416                                  
  9417                                  		; 20/10/2024
  9418                                  mp3_close_wav_file:
  9419 000067DB 6A00                                    push	0               ; dwMoveMethod
  9420                                                  ;push	0               ; lpDistanceToMoveHigh
  9421 000067DD 6A00                                    push	0               ; lDistanceToMove
  9422 000067DF FF35[34420500]                          push	dword [mp3_wav_handle] ; hFile
  9423                                                  ;call	[SetFilePointer]
  9424                                  		;;;
  9425                                  		; 20/10/2024
  9426 000067E5 E8C1040000              		call	SetFilePointer
  9427                                  		;;;
  9428 000067EA E8D9FFFFFF                              call	mp3_write_wav_header
  9429 000067EF FF35[34420500]                          push	dword [mp3_wav_handle] ; hObject
  9430                                                  ;call	[CloseHandle]
  9431                                  		;;;
  9432                                  		; 20/10/2024
  9433 000067F5 E8EF040000              		call	CloseFile
  9434                                  		;;;
  9435 000067FA C3                                      retn
  9436                                  
  9437                                  
  9438                                  ; =============== S U B R O U T I N E =======================================
  9439                                  
  9440                                  		; 20/10/2024
  9441                                  mp3_verify_pcm_file:
  9442 000067FB E804020000                              call    mp3_open_pcm_file
  9443                                  		;;;
  9444                                  		; 20/10/2024
  9445 00006800 7301                    		jnc	short .verify
  9446 00006802 C3                      		retn	; nothing to do (return without error msg)
  9447                                  .verify:
  9448                                  		;;;
  9449 00006803 C705[3C420500]0000-                     mov	dword [_@@max_diff], 0
  9449 0000680B 0000               
  9450 0000680D C705[40420500]0000-                     mov	dword [_@@avg_diff], 0
  9450 00006815 0000               
  9451 00006817 C705[44420500]0000-                     mov	dword [_@@avg_diff+4], 0
  9451 0000681F 0000               
  9452 00006821 C705[48420500]0000-                     mov	dword [pcm_filepos], 0
  9452 00006829 0000               
  9453                                  
  9454                                  .lop:
  9455 0000682B 60                                      pusha
  9456 0000682C 8B35[AC410500]                          mov     esi, [stream_pos]
  9457 00006832 8B0D[B0410500]                          mov     ecx, [bytes_left]
  9458 00006838 BF[00D00500]                            mov     edi, sample_buffer
  9459 0000683D 31ED                                    xor     ebp, ebp
  9460 0000683F E845FAFFFF                              call    mp3_decode_frame
  9461 00006844 61                                      popa
  9462 00006845 0F824D010000                            jb      .exit
  9463 0000684B A1[50B20000]                            mov     eax, [mp3_src_frame_size]
  9464 00006850 83F800                                  cmp     eax, 0
  9465 00006853 0F843F010000                            jz      .exit
  9466 00006859 31C0                                    xor     eax, eax
  9467 0000685B 833D[78B20000]02                        cmp     dword [mp3_output_num_channels], 2
  9468 00006862 7207                                    jb      short .this_mono_convert
  9469 00006864 0FB605[F78A0000]                        movzx   eax, byte [option_mono]
  9470                                  
  9471                                  .this_mono_convert:
  9472 0000686B A3[4C420500]                            mov	[_@@mono_convert], eax
  9473 00006870 8A0D[F98A0000]                          mov	cl, [option_rate_shift]
  9474 00006876 B802000000                              mov	eax, 2
  9475 0000687B D3E0                                    shl	eax, cl
  9476 0000687D 66A3[50420500]                          mov	[_@@pcm_steps], ax
  9477 00006883 66A3[52420500]                          mov	[_@@pcm_steps+2], ax
  9478 00006889 833D[78B20000]02                        cmp	dword [mp3_output_num_channels], 2
  9479 00006890 7213                                    jb	short .these_steps
  9480 00006892 66C705[50420500]02-                     mov	word [_@@pcm_steps], 2
  9480 0000689A 00                 
  9481 0000689B 8D4400FE                                lea     eax, [eax*2-2] ; [0FFFFFFFEh+eax*2]
  9482 0000689F 66A3[52420500]                          mov     [_@@pcm_steps+2], ax
  9483                                  
  9484                                  .these_steps:
  9485 000068A5 A1[40090100]                            mov     eax, [mp3_samples_output_size]
  9486 000068AA 8A0D[F98A0000]                          mov     cl, [option_rate_shift]
  9487 000068B0 020D[F88A0000]                          add     cl, [option_8bit]
  9488 000068B6 020D[4C420500]                          add     cl, byte [_@@mono_convert]
  9489 000068BC D3E0                                    shl     eax, cl
  9490                                                  ;push   0               ; lpOverlapped
  9491                                                  ;push   diskresult      ; lpNumberOfBytesRead
  9492 000068BE 50                                      push    eax             ; nNumberOfBytesToRead
  9493 000068BF 68[00E20500]                            push    (sample_buffer+1200h) ; sample_buffer+MP3_MAX_OUTPUT_SIZE
  9494 000068C4 FF35[38420500]                          push    dword [mp3_pcm_handle] ; hFile
  9495                                                  ;call   [ReadFile]
  9496                                                  ;;;
  9497                                  		; 20/10/2024
  9498 000068CA E8E9030000              		call	ReadFile
  9499 000068CF 7306                    		jnc	short .pcm_read_ok
  9500                                  		; Note: File read error msg has been displayed
  9501 000068D1 E83F010000              		call	mp3_close_pcm_file
  9502 000068D6 C3                      		retn
  9503                                  .pcm_read_ok:
  9504                                  		;;;
  9505 000068D7 8B0D[40090100]          		mov     ecx, [mp3_samples_output_size]
  9506 000068DD D1E9                                    shr     ecx, 1
  9507 000068DF 0F849D000000                            jz      .compare_done
  9508 000068E5 BE[00D00500]                            mov     esi, sample_buffer ; decoded .mp3
  9509 000068EA BF[00E20500]                            mov     edi, (sample_buffer+1200h) ; loaded .pcm
  9510                                  
  9511                                  .compare_lop:
  9512 000068EF 0FBF17                                  movsx   edx, word [edi]
  9513 000068F2 833D[4C420500]00                        cmp     dword [_@@mono_convert], 0
  9514 000068F9 7408                                    jz      short .no_mono_convert
  9515 000068FB 0FBF4702                                movsx   eax, word [edi+2]
  9516 000068FF 01C2                                    add     edx, eax
  9517 00006901 D1FA                                    sar     edx, 1
  9518                                  
  9519                                  .no_mono_convert:
  9520 00006903 803D[F88A0000]00                        cmp	byte [option_8bit], 0
  9521 0000690A 7508                                    jnz	short .compare_8bit
  9522 0000690C 0FBF06                                  movsx	eax, word [esi] ; get 16bit from decoded .mp3
  9523 0000690F 83C602                                  add	esi, 2
  9524 00006912 EB13                                    jmp	short .compare_this
  9525                                  
  9526                                  .compare_8bit:
  9527 00006914 0FB606                                  movzx   eax, byte [esi]
  9528 00006917 46                                      inc     esi             ; convert .pcm
  9529 00006918 81C200800000                            add     edx, 8000h      ; make unsigned
  9530 0000691E C1FA08                                  sar     edx, 8          ; div 100h
  9531 00006921 80D200                                  adc     dl, 0           ; round up
  9532 00006924 80DA00                                  sbb     dl, 0           ; undo on unsigned overflow
  9533                                  
  9534                                  .compare_this:
  9535 00006927 29D0                                    sub     eax, edx
  9536 00006929 7902                                    jns     short .compare_abs ; calc difference
  9537 0000692B F7D8                                    neg     eax
  9538                                  
  9539                                  .compare_abs:
  9540 0000692D 0105[40420500]                          add     [_@@avg_diff], eax
  9541 00006933 8315[44420500]00                        adc     dword [_@@avg_diff+4], 0
  9542 0000693A 3B05[3C420500]                          cmp     eax, [_@@max_diff]
  9543 00006940 7223                                    jb      short .not_max
  9544 00006942 A3[3C420500]                            mov     [_@@max_diff], eax
  9545 00006947 8B15[48420500]                          mov     edx, [pcm_filepos]
  9546 0000694D 8915[54420500]                          mov     [_@@worst_pcm_filepos], edx
  9547 00006953 8B15[AC410500]                          mov     edx, [stream_pos]
  9548 00006959 2B15[A8410500]                          sub     edx, [stream_start]
  9549 0000695F 8915[58420500]                          mov     [_@@worst_mp3_filepos], edx
  9550                                  
  9551                                  .not_max:
  9552 00006965 0FB705[50420500]                        movzx   eax, word [_@@pcm_steps]
  9553 0000696C C10D[50420500]10                        ror     dword [_@@pcm_steps], 16 ; next .pcm addr
  9554 00006973 01C7                                    add     edi, eax
  9555 00006975 0105[48420500]                          add     [pcm_filepos], eax
  9556 0000697B 49                                      dec     ecx
  9557 0000697C 0F856DFFFFFF                            jnz    .compare_lop
  9558                                  
  9559                                  .compare_done:
  9560 00006982 A1[50B20000]                            mov     eax, [mp3_src_frame_size]
  9561 00006987 0105[AC410500]                          add     [stream_pos], eax
  9562 0000698D 2905[B0410500]                          sub     [bytes_left], eax
  9563 00006993 E993FEFFFF                              jmp     .lop
  9564                                  
  9565                                  .exit:
  9566 00006998 E878000000                              call    mp3_close_pcm_file
  9567 0000699D BA[08A10000]                            mov     edx, _@@txt_verify1 ; "verify max difference = "
  9568 000069A2 E86CFCFFFF                              call    wrstr_edx
  9569 000069A7 A1[3C420500]                            mov     eax, [_@@max_diff]
  9570 000069AC E89FFCFFFF                              call    wr_decimal_eax
  9571 000069B1 BA[21A10000]                            mov     edx, _@@txt_verify1_at_mp3 ; " at mp3:"
  9572 000069B6 E858FCFFFF                              call    wrstr_edx
  9573 000069BB A1[58420500]                            mov     eax, [_@@worst_mp3_filepos]
  9574 000069C0 E801FDFFFF                              call    wrhexeax
  9575 000069C5 BA[2AA10000]                            mov     edx, _@@txt_verify2 ; ", average difference = "
  9576 000069CA E844FCFFFF                              call    wrstr_edx
  9577 000069CF A1[40420500]                            mov     eax, [_@@avg_diff]
  9578 000069D4 8B15[44420500]                          mov     edx, [_@@avg_diff+4]
  9579 000069DA 8B0D[38090100]                          mov     ecx, [mp3_total_output_size]
  9580 000069E0 D1E9                                    shr     ecx, 1
  9581 000069E2 F7F1                                    div     ecx
  9582 000069E4 E867FCFFFF                              call    wr_decimal_eax
  9583 000069E9 B02E                                    mov     al, '.'
  9584 000069EB E831000000                              call    wrchr
  9585 000069F0 B80A000000                              mov     eax, 10
  9586 000069F5 F7E2                                    mul     edx             ; fraction*10
  9587 000069F7 F7F1                                    div     ecx
  9588 000069F9 E89AFCFFFF                              call    wrdigital       ; show fraction of average difference
  9589 000069FE E821FCFFFF                              call    wrcrlf
  9590 00006A03 C3                                      retn
  9591                                  
  9592                                  
  9593                                  ; =============== S U B R O U T I N E =======================================
  9594                                  
  9595                                  		; 20/10/2024
  9596                                  mp3_open_pcm_file:
  9597                                                  ;push	0               ; hTemplateFile
  9598                                                  ;push	80h             ; dwFlagsAndAttributes
  9599                                                  ;push	3               ; dwCreationDisposition
  9600                                                  ;push	0               ; lpSecurityAttributes
  9601                                                  ;push	0               ; dwShareMode
  9602                                                  ;push	80000000h       ; dwDesiredAccess
  9603 00006A04 FF35[A8990000]                          push	dword [mp3_pcm_fname] ; lpFileName
  9604                                                  ;call	[CreateFileA]
  9605                                  		;;;
  9606                                  		; 20/10/2024
  9607 00006A0A E88F020000              		call	OpenFile
  9608                                  		;jc	short .return
  9609                                  		;;;
  9610 00006A0F A3[38420500]                            mov	[mp3_pcm_handle], eax
  9611                                  ;.return:
  9612 00006A14 C3                                      retn
  9613                                  
  9614                                  
  9615                                  ; =============== S U B R O U T I N E =======================================
  9616                                  
  9617                                  		; 20/10/2024
  9618                                  mp3_close_pcm_file:
  9619 00006A15 FF35[38420500]                          push	dword [mp3_pcm_handle] ; hObject
  9620                                                  ;call	[CloseHandle]
  9621                                                  ;retn
  9622                                  		;;;
  9623                                  		; 20/10/2024
  9624 00006A1B E8C9020000              		call	CloseFile
  9625                                  		;;;
  9626 00006A20 C3                      		retn
  9627                                  
  9628                                  
  9629                                  ; ---------------------------------------------------------------------------
  9630                                  
  9631                                  ; =============== S U B R O U T I N E =======================================
  9632                                  
  9633                                  		; 20/10/2024
  9634                                  wrchr:
  9635                                  		; TRDOS 386 System Call
  9636                                  		; ebx = 2 -> write character onto STDOUT
  9637                                  		;push	ebx
  9638                                  		;push	ecx
  9639                                  		;push	eax
  9640 00006A21 60                      		pusha
  9641                                  		;;mov	dword [diskresult], 0
  9642                                  		sys	_stdio, 2, eax
   119                              <1> 
   120                              <1> 
   121                              <1> 
   122                              <1> 
   123                              <1>  %if %0 >= 2
   124 00006A22 BB02000000          <1>  mov ebx, %2
   125                              <1>  %if %0 >= 3
   126 00006A27 89C1                <1>  mov ecx, %3
   127                              <1>  %if %0 = 4
   128                              <1>  mov edx, %4
   129                              <1>  %endif
   130                              <1>  %endif
   131                              <1>  %endif
   132 00006A29 B82E000000          <1>  mov eax, %1
   133                              <1> 
   134 00006A2E CD40                <1>  int 40h
  9643                                  		;jnc	short .ok ; if EOF, eax = 0
  9644                                  		;xor	eax, eax ; 0
  9645                                  ;.ok:
  9646                                  		;mov	[diskresult], eax ; written byte count
  9647 00006A30 61                      		popa
  9648                                  		;pop	eax
  9649                                  		;pop	ecx
  9650                                  		;pop	ebx
  9651 00006A31 C3                      		retn
  9652                                  
  9653                                  
  9654                                  ; =============== S U B R O U T I N E =======================================
  9655                                  
  9656                                  		; 20/10/2024
  9657                                  get_commandline:
  9658                                  		; 21/10/2024
  9659 00006A32 5D                      		pop	ebp ; near call return address
  9660                                                 	; esp = command line start address
  9661                                  		;mov	[command_line],esp
  9662 00006A33 59                      		pop	ecx	; argc  ; number of arguments
  9663                                  		; esp = pointer to argument 1 ; argv[0]
  9664 00006A34 49                      		dec	ecx
  9665 00006A35 0F8405010000            		jz	.help
  9666 00006A3B 58                      		pop	eax ; argument 1 (PRG file name)
  9667 00006A3C 5E                      		pop	esi ; argument 2 (must be input file name)
  9668 00006A3D BF[B4410500]            		mov     edi, cmdline_buf
  9669                                  .get_item:
  9670 00006A42 89FB                    		mov	ebx, edi
  9671                                  .char_lop:
  9672 00006A44 AC                                      lodsb
  9673 00006A45 AA                      		stosb
  9674 00006A46 3C00                                    cmp     al, 0
  9675 00006A48 75FA                                    jnz 	short .char_lop
  9676                                  		
  9677 00006A4A 8A03                                    mov     al, [ebx]
  9678 00006A4C 3C2F                                    cmp     al, '/'
  9679 00006A4E 7442                                    jz      short .switch
  9680 00006A50 3C2D                                    cmp     al, '-'
  9681 00006A52 743E                                    jz      short .switch
  9682 00006A54 8B47FB                                  mov     eax, [edi-5]
  9683 00006A57 0D00202020                              or      eax, 20202000h
  9684 00006A5C 3D2E776176                              cmp     eax, '.wav'     ; FASM & NASM syntax
  9685 00006A61 7510                                    jnz     short .not_wav_name
  9686 00006A63 891D[A4990000]                          mov     [mp3_dst_fname], ebx
  9687                                  .get_items_lop:
  9688 00006A69 49                      		dec	ecx
  9689 00006A6A 0F8494000000            		jz	.done
  9690 00006A70 5E                      		pop	esi   ; next argument
  9691 00006A71 EBCF                    		jmp     short .get_item
  9692                                  
  9693                                  .not_wav_name:
  9694 00006A73 8B47FB                                  mov     eax, [edi-5]
  9695 00006A76 0D00202020                              or      eax, 20202000h
  9696 00006A7B 3D2E70636D                              cmp     eax, '.pcm'     ; FASM & NASM syntax
  9697 00006A80 7508                                    jnz     short .not_pcm_name
  9698 00006A82 891D[A8990000]                          mov     [mp3_pcm_fname], ebx
  9699 00006A88 EBDF                                    jmp     short .get_items_lop
  9700                                  
  9701                                  .not_pcm_name:
  9702 00006A8A 891D[A0990000]                          mov     [mp3_src_fname], ebx
  9703 00006A90 EBD7                                    jmp     short .get_items_lop
  9704                                  
  9705                                  .switch:
  9706 00006A92 817B016D6F6E6F                          cmp	dword [ebx+1], 'mono'
  9707 00006A99 7509                                    jnz	short .not_switch_mono
  9708 00006A9B C605[F78A0000]01                        mov	byte [option_mono], 1
  9709 00006AA2 EBC5                                    jmp	short .get_items_lop
  9710                                  
  9711                                  .not_switch_mono:
  9712 00006AA4 817B0166617374                          cmp	dword [ebx+1], 'fast' ; FASM & NASM syntax
  9713 00006AAB 7509                                    jnz	short .not_fast_option
  9714 00006AAD C605[FA8A0000]01                        mov	byte [option_fast], 1
  9715 00006AB4 EBB3                                    jmp	short .get_items_lop
  9716                                  
  9717                                  .not_fast_option:
  9718 00006AB6 817B0138626974                          cmp	dword [ebx+1], '8bit'
  9719 00006ABD 7509                                    jnz	short .not_switch_8bit
  9720 00006ABF C605[F88A0000]01                        mov	byte [option_8bit], 1
  9721 00006AC6 EBA1                                    jmp	short .get_items_lop
  9722                                  
  9723                                  .not_switch_8bit:
  9724 00006AC8 817B0168616C66                          cmp	dword [ebx+1], 'half'
  9725 00006ACF 7509                                    jnz	short .not_switch_half
  9726 00006AD1 C605[F98A0000]01                        mov	byte [option_rate_shift], 1
  9727 00006AD8 EB8F                                    jmp	short .get_items_lop
  9728                                  
  9729                                  .not_switch_half:
  9730 00006ADA 817B0171756172                          cmp	dword [ebx+1], 'quar'
  9731 00006AE1 750C                                    jnz	short .not_switch_quarter
  9732 00006AE3 C605[F98A0000]02                        mov	byte [option_rate_shift], 2
  9733 00006AEA E97AFFFFFF                              jmp	.get_items_lop
  9734                                  
  9735                                  .not_switch_quarter:
  9736 00006AEF 817B0174657374                          cmp	dword [ebx+1], 'test'
  9737 00006AF6 7548                                    jnz	short .not_switch_test
  9738 00006AF8 C605[F68A0000]01                        mov	byte [option_test], 1
  9739 00006AFF E965FFFFFF                              jmp	.get_items_lop
  9740                                  
  9741                                  .done:
  9742 00006B04 833D[A0990000]00                        cmp	dword [mp3_src_fname], 0
  9743 00006B0B 7433                                    jz	short .help
  9744                                                  ;;; Erdogan Tan - 17/10/2024
  9745                                                  ;mov	edx, txt_ctrlc
  9746                                                  ;call	wrstr_edx
  9747                                  		; 20/10/2024
  9748                                  		sys	_msg, txt_ctrlc, txt_ctrlc_size, 0Fh ; white
   119                              <1> 
   120                              <1> 
   121                              <1> 
   122                              <1> 
   123                              <1>  %if %0 >= 2
   124 00006B0D BB[42A10000]        <1>  mov ebx, %2
   125                              <1>  %if %0 >= 3
   126 00006B12 B919000000          <1>  mov ecx, %3
   127                              <1>  %if %0 = 4
   128 00006B17 BA0F000000          <1>  mov edx, %4
   129                              <1>  %endif
   130                              <1>  %endif
   131                              <1>  %endif
   132 00006B1C B823000000          <1>  mov eax, %1
   133                              <1> 
   134 00006B21 CD40                <1>  int 40h
  9749                                                  ;;;
  9750 00006B23 BA[11A00000]                            mov	edx, txt_file ; "file: "
  9751 00006B28 E8E6FAFFFF                              call	wrstr_edx
  9752 00006B2D 8B15[A0990000]                          mov	edx, [mp3_src_fname]
  9753 00006B33 E8DBFAFFFF                              call	wrstr_edx
  9754 00006B38 E8E7FAFFFF                              call	wrcrlf
  9755 00006B3D F8                                      clc
  9756 00006B3E 55                      		push	ebp	; return address
  9757 00006B3F C3                                      retn
  9758                                  
  9759                                  .not_switch_test:
  9760                                  .help:
  9761                                                  ;;; Erdogan Tan - 17/10/2024
  9762 00006B40 BA[5BA10000]                            mov	edx, txt_about
  9763 00006B45 E8C9FAFFFF                              call	wrstr_edx
  9764                                                  ;;;
  9765 00006B4A BA[88A00000]                            mov	edx, txt_help ; "usage: mp3play input.mp3 [output.wav] ["...
  9766 00006B4F E8BFFAFFFF                              call	wrstr_edx
  9767 00006B54 F9                                      stc
  9768 00006B55 55                      		push	ebp	; return address
  9769 00006B56 C3                                      retn
  9770                                  
  9771                                  ; =============== S U B R O U T I N E =======================================
  9772                                  
  9773                                  		; 21/10/2024
  9774                                  set_break:
  9775                                  		; set [u.break] -end of bss- address to
  9776                                  		; end_of_bss at first (mp3 file will be loaded
  9777                                  		; at the end of bss)
  9778                                  		; ([u.break] initially points to the end of PRG file
  9779                                  		; -code and data- except BSS section)
  9780                                  		;
  9781                                  		; TRDOS 386 system call
  9782                                  		; Set break address
  9783                                  		; ebx = new [u.break]
  9784                                  		;sys	_break, end_of_bss
  9785                                  		; eax = new break address (dword aligned)
  9786                                  
  9787                                  		; 10/01/2025
  9788                                  		sys	_break, 100000h ; end of 1st 1MB
   119                              <1> 
   120                              <1> 
   121                              <1> 
   122                              <1> 
   123                              <1>  %if %0 >= 2
   124 00006B57 BB00001000          <1>  mov ebx, %2
   125                              <1>  %if %0 >= 3
   126                              <1>  mov ecx, %3
   127                              <1>  %if %0 = 4
   128                              <1>  mov edx, %4
   129                              <1>  %endif
   130                              <1>  %endif
   131                              <1>  %endif
   132 00006B5C B811000000          <1>  mov eax, %1
   133                              <1> 
   134 00006B61 CD40                <1>  int 40h
  9789                                  
  9790 00006B63 A3[A8410500]                            mov	[stream_start], eax
  9791 00006B68 A3[AC410500]                            mov	[stream_pos], eax
  9792                                  
  9793 00006B6D C3                      		retn
  9794                                  
  9795                                  
  9796                                  ; =============== S U B R O U T I N E =======================================
  9797                                  
  9798                                  		; 20/10/2024
  9799                                  
  9800                                  open_and_mmap_the_file:
  9801                                  		; 21/10/2024
  9802                                  		; TRDOS 386 system call
  9803                                  		; Open File
  9804                                  		; ebx = pointer to filename
  9805                                  		; ecx = open mode, 0 = read
  9806                                               	sys	_open, [mp3_src_fname], 0
   119                              <1> 
   120                              <1> 
   121                              <1> 
   122                              <1> 
   123                              <1>  %if %0 >= 2
   124 00006B6E 8B1D[A0990000]      <1>  mov ebx, %2
   125                              <1>  %if %0 >= 3
   126 00006B74 B900000000          <1>  mov ecx, %3
   127                              <1>  %if %0 = 4
   128                              <1>  mov edx, %4
   129                              <1>  %endif
   130                              <1>  %endif
   131                              <1>  %endif
   132 00006B79 B805000000          <1>  mov eax, %1
   133                              <1> 
   134 00006B7E CD40                <1>  int 40h
  9807 00006B80 7270                    		jc	short .not_found
  9808                                  
  9809 00006B82 A3[A4410500]                            mov     [hFile], eax
  9810                                  
  9811                                                 	; get file size by using systell system call
  9812                                   		; (not applicable for TRDOS 386 Kernel v2.0.9 and earlier)
  9813                                  		; TRDOS 386 system call
  9814                                  		; Get current file (offset) pointer
  9815                                  		; ebx = file handle (file descriptor)
  9816                                  		; ecx = 0, offset
  9817                                  		; edx = 2, from the end of file
  9818                                  		;sys	_tell, eax, 0, 2
  9819                                                  ;mov     [mp3_file_size], eax
  9820                                  
  9821                                  		; *** get file size ***
  9822                                  		; TRDOS 386 system call
  9823                                  		; Set file (offset) pointer to file size 
  9824                                  		; (needed for TRDOS kernel v2.0.9 and earlier)
  9825                                  		; ebx = file handle (file descriptor)
  9826                                  		; ecx = 0, offset
  9827                                  		; edx = 2, from the end of file
  9828                                  		sys	_seek, eax, 0, 2
   119                              <1> 
   120                              <1> 
   121                              <1> 
   122                              <1> 
   123                              <1>  %if %0 >= 2
   124 00006B87 89C3                <1>  mov ebx, %2
   125                              <1>  %if %0 >= 3
   126 00006B89 B900000000          <1>  mov ecx, %3
   127                              <1>  %if %0 = 4
   128 00006B8E BA02000000          <1>  mov edx, %4
   129                              <1>  %endif
   130                              <1>  %endif
   131                              <1>  %endif
   132 00006B93 B813000000          <1>  mov eax, %1
   133                              <1> 
   134 00006B98 CD40                <1>  int 40h
  9829                                  		; TRDOS 386 system call
  9830                                  		; Get current file (offset) pointer
  9831                                  		; (needed for TRDOS 386 kernel version 2.0.9 and earlier)
  9832 00006B9A 31D2                    		xor	edx, edx ; 0
  9833                                  		; ecx = 0
  9834                                  		; ebx = file handle
  9835                                  		sys	_tell
   119                              <1> 
   120                              <1> 
   121                              <1> 
   122                              <1> 
   123                              <1>  %if %0 >= 2
   124                              <1>  mov ebx, %2
   125                              <1>  %if %0 >= 3
   126                              <1>  mov ecx, %3
   127                              <1>  %if %0 = 4
   128                              <1>  mov edx, %4
   129                              <1>  %endif
   130                              <1>  %endif
   131                              <1>  %endif
   132 00006B9C B814000000          <1>  mov eax, %1
   133                              <1> 
   134 00006BA1 CD40                <1>  int 40h
  9836 00006BA3 A3[28090100]            		mov     [mp3_file_size], eax
  9837                                  
  9838                                  		; *** set file offset pointer to 0 again ***
  9839                                  		; TRDOS 386 system call
  9840                                  		; Set file (offset) pointer
  9841                                  		; ebx = file handle (file descriptor)
  9842                                  		; ecx = 0, offset
  9843                                  		; edx = 0, from the beginning/start of file
  9844 00006BA8 50                      		push	eax
  9845                                  		sys	_seek
   119                              <1> 
   120                              <1> 
   121                              <1> 
   122                              <1> 
   123                              <1>  %if %0 >= 2
   124                              <1>  mov ebx, %2
   125                              <1>  %if %0 >= 3
   126                              <1>  mov ecx, %3
   127                              <1>  %if %0 = 4
   128                              <1>  mov edx, %4
   129                              <1>  %endif
   130                              <1>  %endif
   131                              <1>  %endif
   132 00006BA9 B813000000          <1>  mov eax, %1
   133                              <1> 
   134 00006BAE CD40                <1>  int 40h
  9846 00006BB0 58                      		pop	eax
  9847                                  
  9848                                  		; now, set [u.break] address to the end of mp3 file
  9849                                  		; at memory -in BSS section-
  9850                                  		; (not necessary for TRDOS 386 PRG files)
  9851                                  		; (this system call will allocate user memory pages
  9852                                  		;  before sysread system call.. early)
  9853                                  		;add	eax, end_of_bss
  9854                                  		; 13/01/2025
  9855 00006BB1 0500001000              		add	eax, 100000h ; + end of 1st 1MB
  9856                                  		; TRDOS 386 system call
  9857                                  		; Set break address
  9858                                  		; ebx = new [u.break]
  9859                                  		sys	_break, eax
   119                              <1> 
   120                              <1> 
   121                              <1> 
   122                              <1> 
   123                              <1>  %if %0 >= 2
   124 00006BB6 89C3                <1>  mov ebx, %2
   125                              <1>  %if %0 >= 3
   126                              <1>  mov ecx, %3
   127                              <1>  %if %0 = 4
   128                              <1>  mov edx, %4
   129                              <1>  %endif
   130                              <1>  %endif
   131                              <1>  %endif
   132 00006BB8 B811000000          <1>  mov eax, %1
   133                              <1> 
   134 00006BBD CD40                <1>  int 40h
  9860                                  
  9861                                  		; TRDOS 386 system call
  9862                                  		; Read file
  9863                                  		; ebx = file handle (file descriptor)
  9864                                  		; ecx = buffer address
  9865                                  		; edx = byte count
  9866                                  		sys	_read, [hFile], [stream_start], [mp3_file_size]
   119                              <1> 
   120                              <1> 
   121                              <1> 
   122                              <1> 
   123                              <1>  %if %0 >= 2
   124 00006BBF 8B1D[A4410500]      <1>  mov ebx, %2
   125                              <1>  %if %0 >= 3
   126 00006BC5 8B0D[A8410500]      <1>  mov ecx, %3
   127                              <1>  %if %0 = 4
   128 00006BCB 8B15[28090100]      <1>  mov edx, %4
   129                              <1>  %endif
   130                              <1>  %endif
   131                              <1>  %endif
   132 00006BD1 B803000000          <1>  mov eax, %1
   133                              <1> 
   134 00006BD6 CD40                <1>  int 40h
  9867 00006BD8 7204                    		jc	short .read_error
  9868 00006BDA 39D0                    		cmp	eax, edx
  9869 00006BDC 730E                    		jnb	short .ok
  9870                                  		;or	eax, eax
  9871                                  		;jnz	short .ok
  9872                                  .read_error:		
  9873                                  		; TRDOS 386 system call
  9874                                  		; Close file
  9875                                  		; ebx = file handle (file descriptor)
  9876                                  		;sys	_close, [hFile]
  9877                                   		sys	_close
   119                              <1> 
   120                              <1> 
   121                              <1> 
   122                              <1> 
   123                              <1>  %if %0 >= 2
   124                              <1>  mov ebx, %2
   125                              <1>  %if %0 >= 3
   126                              <1>  mov ecx, %3
   127                              <1>  %if %0 = 4
   128                              <1>  mov edx, %4
   129                              <1>  %endif
   130                              <1>  %endif
   131                              <1>  %endif
   132 00006BDE B806000000          <1>  mov eax, %1
   133                              <1> 
   134 00006BE3 CD40                <1>  int 40h
  9878                                  
  9879 00006BE5 BA[D66C0000]            		mov	edx, txt_read_err
  9880 00006BEA EB0B                    		jmp	short .r_err_msg
  9881                                  .ok:
  9882 00006BEC A3[B0410500]                            mov     [bytes_left], eax ; read count
  9883 00006BF1 C3                      		retn
  9884                                  .not_found:
  9885 00006BF2 BA[6EA00000]                            mov     edx, txt_not_found ; "cannot open source file\r\n"
  9886                                  .r_err_msg:
  9887 00006BF7 E817FAFFFF                              call    wrstr_edx
  9888 00006BFC F9                                      stc
  9889 00006BFD C3                                      retn
  9890                                  
  9891                                  ;txt_read_err	db 'File read error!',0Dh,0Ah,0
  9892                                  
  9893                                  
  9894                                  ; =============== S U B R O U T I N E =======================================
  9895                                  
  9896                                  		; 20/10/2024
  9897                                  print_msg:
  9898                                  		; TRDOS 386 system call
  9899                                  		; write/display message on screen
  9900                                  		; ebx = ASCIIZ message (text) address
  9901                                  		; ecx = max. message length (stop count before char zero)
  9902                                  		; edx = character color (CGA)
  9903 00006BFE B9FF000000              		mov	ecx, 255
  9904 00006C03 BA0B000000              		mov	edx, 0Bh ; DL ; cyan
  9905                                  		sys	_msg
   119                              <1> 
   120                              <1> 
   121                              <1> 
   122                              <1> 
   123                              <1>  %if %0 >= 2
   124                              <1>  mov ebx, %2
   125                              <1>  %if %0 >= 3
   126                              <1>  mov ecx, %3
   127                              <1>  %if %0 = 4
   128                              <1>  mov edx, %4
   129                              <1>  %endif
   130                              <1>  %endif
   131                              <1>  %endif
   132 00006C08 B823000000          <1>  mov eax, %1
   133                              <1> 
   134 00006C0D CD40                <1>  int 40h
  9906 00006C0F C3                      		retn
  9907                                  
  9908                                  
  9909                                  ; =============== S U B R O U T I N E =======================================
  9910                                  
  9911                                  		; 20/10/2024
  9912                                  GetTickCount:
  9913                                  		; TRDOS 386 system call
  9914                                  		; get current time, get tick count
  9915                                  		; ebx = 4 -> get count of system timer ticks
  9916                                  		sys	_time, 4
   119                              <1> 
   120                              <1> 
   121                              <1> 
   122                              <1> 
   123                              <1>  %if %0 >= 2
   124 00006C10 BB04000000          <1>  mov ebx, %2
   125                              <1>  %if %0 >= 3
   126                              <1>  mov ecx, %3
   127                              <1>  %if %0 = 4
   128                              <1>  mov edx, %4
   129                              <1>  %endif
   130                              <1>  %endif
   131                              <1>  %endif
   132 00006C15 B80D000000          <1>  mov eax, %1
   133                              <1> 
   134 00006C1A CD40                <1>  int 40h
  9917                                  		; eax = system timer ticks (18.2 ticks per second)
  9918 00006C1C BA15F4BC20              		mov	edx, 549254165	; 10^10/18.2
  9919 00006C21 F7E2                    		mul	edx
  9920                                  		; edx:eax = milliseconds * 10^7
  9921 00006C23 BB80969800              		mov	ebx, 10000000
  9922 00006C28 F7F3                    		div	ebx		; 10^7
  9923                                  		; eax = milliseconds
  9924 00006C2A 81FA404B4C00            		cmp	edx, 5000000	; 10^7/2
  9925 00006C30 7201                    		jb	short .ok
  9926 00006C32 40                      		inc	eax		; round up
  9927                                  .ok:
  9928 00006C33 C3                      		retn
  9929                                  
  9930                                  
  9931                                  ; =============== E X I T ===================================================
  9932                                  
  9933                                  		; 20/10/2024
  9934                                  ExitProcess:
  9935 00006C34 31DB                    		xor	ebx, ebx  ; mov ebx, 0  ; exit code
  9936                                  ExitProcess@:	; 13/01/2025
  9937                                  		sys	_exit
   119                              <1> 
   120                              <1> 
   121                              <1> 
   122                              <1> 
   123                              <1>  %if %0 >= 2
   124                              <1>  mov ebx, %2
   125                              <1>  %if %0 >= 3
   126                              <1>  mov ecx, %3
   127                              <1>  %if %0 = 4
   128                              <1>  mov edx, %4
   129                              <1>  %endif
   130                              <1>  %endif
   131                              <1>  %endif
   132 00006C36 B801000000          <1>  mov eax, %1
   133                              <1> 
   134 00006C3B CD40                <1>  int 40h
  9938                                  ;hang:
  9939                                  		;jmp	short hang
  9940                                  
  9941                                  
  9942                                  ; =============== S U B R O U T I N E =======================================
  9943                                  
  9944                                  		; 20/10/2024
  9945                                  WriteFile:
  9946 00006C3D 58                      		pop	eax ; near call return address
  9947 00006C3E 5B                      		pop	ebx
  9948 00006C3F 59                      		pop	ecx
  9949 00006C40 5A                      		pop	edx
  9950 00006C41 50                      		push	eax
  9951                                  		; TRDOS 386 system call
  9952                                  		; Write file
  9953                                  		; ebx = file handle (file descriptor)
  9954                                  		; ecx = buffer address
  9955                                  		; edx = byte count
  9956                                  		sys	_write
   119                              <1> 
   120                              <1> 
   121                              <1> 
   122                              <1> 
   123                              <1>  %if %0 >= 2
   124                              <1>  mov ebx, %2
   125                              <1>  %if %0 >= 3
   126                              <1>  mov ecx, %3
   127                              <1>  %if %0 = 4
   128                              <1>  mov edx, %4
   129                              <1>  %endif
   130                              <1>  %endif
   131                              <1>  %endif
   132 00006C42 B804000000          <1>  mov eax, %1
   133                              <1> 
   134 00006C47 CD40                <1>  int 40h
  9957 00006C49 730F                    		jnc	short .ok
  9958 00006C4B 39D0                    		cmp	eax, edx
  9959 00006C4D 730B                    		jnb	short .ok
  9960                                  		;or	eax, eax
  9961                                  		;jnz	short .ok
  9962                                  
  9963 00006C4F BA[5B6C0000]            		mov	edx, txt_write_err
  9964 00006C54 E8BAF9FFFF                              call    wrstr_edx
  9965 00006C59 F9                                      stc
  9966                                  .ok:
  9967 00006C5A C3                                      retn
  9968                                  
  9969 00006C5B 46696C652077726974-     txt_write_err	db 'File write error!',0Dh,0Ah,0
  9969 00006C64 65206572726F72210D-
  9969 00006C6D 0A00               
  9970                                  
  9971                                  
  9972                                  ; =============== S U B R O U T I N E =======================================
  9973                                  
  9974                                  		; 20/10/2024
  9975                                  CreateFile:
  9976 00006C6F 58                      		pop	eax ; near call return address
  9977 00006C70 5B                      		pop	ebx
  9978 00006C71 50                      		push	eax
  9979                                  		; TRDOS 386 system call
  9980                                  		; Create file
  9981                                  		; ebx = (ASCIIZ) file name address
  9982                                  		; ecx = mode
  9983 00006C72 31C9                    		xor	ecx, ecx ; CL ; mov ecx, 0 ; ordinary file
  9984                                  		sys	_creat
   119                              <1> 
   120                              <1> 
   121                              <1> 
   122                              <1> 
   123                              <1>  %if %0 >= 2
   124                              <1>  mov ebx, %2
   125                              <1>  %if %0 >= 3
   126                              <1>  mov ecx, %3
   127                              <1>  %if %0 = 4
   128                              <1>  mov edx, %4
   129                              <1>  %endif
   130                              <1>  %endif
   131                              <1>  %endif
   132 00006C74 B808000000          <1>  mov eax, %1
   133                              <1> 
   134 00006C79 CD40                <1>  int 40h
  9985 00006C7B 730B                    		jnc	short .ok ; eax = file handle
  9986                                  
  9987 00006C7D BA[896C0000]            		mov	edx, txt_create_err
  9988 00006C82 E88CF9FFFF                              call    wrstr_edx
  9989 00006C87 F9                                      stc
  9990                                  .ok:
  9991 00006C88 C3                      		retn
  9992                                  
  9993 00006C89 46696C652063726561-     txt_create_err	db 'File create error!',0Dh,0Ah,0
  9993 00006C92 7465206572726F7221-
  9993 00006C9B 0D0A00             
  9994                                  
  9995                                  
  9996                                  ; =============== S U B R O U T I N E =======================================
  9997                                  
  9998                                  		; 20/10/2024
  9999                                  OpenFile:
 10000 00006C9E 58                      		pop	eax ; near call return address
 10001 00006C9F 5B                      		pop	ebx
 10002 00006CA0 50                      		push	eax
 10003                                  		; TRDOS 386 system call
 10004                                  		; Open file
 10005                                  		; ebx = (ASCIIZ) file name address
 10006                                  		; ecx = mode
 10007 00006CA1 31C9                    		xor	ecx, ecx ; CL ; mov ecx, 0 ; ordinary file
 10008                                  		sys	_open
   119                              <1> 
   120                              <1> 
   121                              <1> 
   122                              <1> 
   123                              <1>  %if %0 >= 2
   124                              <1>  mov ebx, %2
   125                              <1>  %if %0 >= 3
   126                              <1>  mov ecx, %3
   127                              <1>  %if %0 = 4
   128                              <1>  mov edx, %4
   129                              <1>  %endif
   130                              <1>  %endif
   131                              <1>  %endif
   132 00006CA3 B805000000          <1>  mov eax, %1
   133                              <1> 
   134 00006CA8 CD40                <1>  int 40h
 10009                                  		;jnc	short .ok ; eax = file handle
 10010                                  		;
 10011                                  		;mov	edx, txt_open_err
 10012                                                  ;call   wrstr_edx
 10013                                                  ;stc
 10014                                  ;.ok:
 10015 00006CAA C3                      		retn
 10016                                  
 10017                                  ;txt_open_err	db 'File not found!',0Dh,0Ah,0
 10018                                  		;db 'File open error!',ODh,0Ah,0
 10019                                  	 
 10020                                  
 10021                                  ; =============== S U B R O U T I N E =======================================
 10022                                  
 10023                                  		; 20/10/2024
 10024                                  SetFilePointer:
 10025 00006CAB 58                      		pop	eax ; near call return address
 10026 00006CAC 5B                      		pop	ebx
 10027 00006CAD 59                      		pop	ecx
 10028 00006CAE 5A                      		pop	edx
 10029 00006CAF 50                      		push	eax
 10030                                  		; TRDOS 386 system call
 10031                                  		; Set file offset pointer  ; sysseek
 10032                                  		; ebx = file handle (file descriptor)
 10033                                  		; ecx = offset
 10034                                  		; edx = switch, DL = 0 = from the start of file
 10035                                  		;		     1 = from the current offset
 10036                                  		;		     2 = from the end of file
 10037                                  		sys	_seek
   119                              <1> 
   120                              <1> 
   121                              <1> 
   122                              <1> 
   123                              <1>  %if %0 >= 2
   124                              <1>  mov ebx, %2
   125                              <1>  %if %0 >= 3
   126                              <1>  mov ecx, %3
   127                              <1>  %if %0 = 4
   128                              <1>  mov edx, %4
   129                              <1>  %endif
   130                              <1>  %endif
   131                              <1>  %endif
   132 00006CB0 B813000000          <1>  mov eax, %1
   133                              <1> 
   134 00006CB5 CD40                <1>  int 40h
 10038                                  		; eax = (value of) new offset pointer
 10039                                  
 10040 00006CB7 C3                      		retn
 10041                                  
 10042                                  
 10043                                  ; =============== S U B R O U T I N E =======================================
 10044                                  
 10045                                  		; 20/10/2024
 10046                                  ReadFile:
 10047 00006CB8 58                      		pop	eax ; near call return address
 10048 00006CB9 5B                      		pop	ebx
 10049 00006CBA 59                      		pop	ecx
 10050 00006CBB 5A                      		pop	edx
 10051 00006CBC 50                      		push	eax
 10052                                  		; TRDOS 386 system call
 10053                                  		; Read file
 10054                                  		; ebx = file handle (file descriptor)
 10055                                  		; ecx = buffer address
 10056                                  		; edx = byte count
 10057                                  		sys	_read
   119                              <1> 
   120                              <1> 
   121                              <1> 
   122                              <1> 
   123                              <1>  %if %0 >= 2
   124                              <1>  mov ebx, %2
   125                              <1>  %if %0 >= 3
   126                              <1>  mov ecx, %3
   127                              <1>  %if %0 = 4
   128                              <1>  mov edx, %4
   129                              <1>  %endif
   130                              <1>  %endif
   131                              <1>  %endif
   132 00006CBD B803000000          <1>  mov eax, %1
   133                              <1> 
   134 00006CC2 CD40                <1>  int 40h
 10058 00006CC4 730F                    		jnc	short .ok
 10059 00006CC6 39D0                    		cmp	eax, edx
 10060 00006CC8 730B                    		jnb	short .ok
 10061                                  		;or	eax, eax
 10062                                  		;jnz	short .ok
 10063                                  
 10064 00006CCA BA[D66C0000]            		mov	edx, txt_read_err
 10065 00006CCF E83FF9FFFF                              call    wrstr_edx
 10066 00006CD4 F9                                      stc
 10067                                  .ok:
 10068 00006CD5 C3                                      retn
 10069                                  
 10070 00006CD6 46696C652072656164-     txt_read_err	db 'File read error!',0Dh,0Ah,0
 10070 00006CDF 206572726F72210D0A-
 10070 00006CE8 00                 
 10071                                  
 10072                                  
 10073                                  ; =============== S U B R O U T I N E =======================================
 10074                                  
 10075                                  		; 20/10/2024
 10076                                  CloseFile:
 10077 00006CE9 58                      		pop	eax ; near call return address
 10078 00006CEA 5B                      		pop	ebx
 10079 00006CEB 50                      		push	eax
 10080                                  		; TRDOS 386 system call
 10081                                  		; Close file
 10082                                  		; ebx = file handle (file descriptor)
 10083                                  		sys	_close
   119                              <1> 
   120                              <1> 
   121                              <1> 
   122                              <1> 
   123                              <1>  %if %0 >= 2
   124                              <1>  mov ebx, %2
   125                              <1>  %if %0 >= 3
   126                              <1>  mov ecx, %3
   127                              <1>  %if %0 = 4
   128                              <1>  mov edx, %4
   129                              <1>  %endif
   130                              <1>  %endif
   131                              <1>  %endif
   132 00006CEC B806000000          <1>  mov eax, %1
   133                              <1> 
   134 00006CF1 CD40                <1>  int 40h
 10084                                  
 10085 00006CF3 C3                      		retn
 10086                                  
 10087                                  
 10088                                  ; ---------------------------------------------------------------------------
 10089                                  ; TRDOS 386 Audio System Functions
 10090                                  ; ---------------------------------------------------------------------------
 10091                                  
 10092                                  ; =============== S U B R O U T I N E =======================================
 10093                                  
 10094                                  		; 10/01/2025
 10095                                  		; 20/10/2024
 10096                                  detect_enable_audio_device:
 10097 00006CF4 66C705[32A20000]80-     		mov	word [max_frequency], 48000
 10097 00006CFC BB                 
 10098                                  		; 10/01/2025
 10099                                  		;mov	byte [blocks], 8
 10100                                  
 10101                                  		; check AC'97 hardware at first
 10102                                  		; (48kHz support)
 10103                                  		; TRDOS 386 system call
 10104                                  		; sysaudio
 10105                                  		; Detect (BH=1) AC'97 (BL=2) Audio Device
 10106                                  .ac97:
 10107                                          	sys	_audio, 0102h
   119                              <1> 
   120                              <1> 
   121                              <1> 
   122                              <1> 
   123                              <1>  %if %0 >= 2
   124 00006CFD BB02010000          <1>  mov ebx, %2
   125                              <1>  %if %0 >= 3
   126                              <1>  mov ecx, %3
   127                              <1>  %if %0 = 4
   128                              <1>  mov edx, %4
   129                              <1>  %endif
   130                              <1>  %endif
   131                              <1>  %endif
   132 00006D02 B820000000          <1>  mov eax, %1
   133                              <1> 
   134 00006D07 CD40                <1>  int 40h
 10108 00006D09 7245                    		jc	short .sb16
 10109 00006D0B C605[30A20000]02        		mov	byte [audio_hardware], 2 ; AC97
 10110                                  
 10111                                  		;;;;
 10112                                  		; 12/01/2025 (ref: playwav9.s, 18/12/2024)
 10113                                  		sys	_audio, 0E00h ; get audio controller info
   119                              <1> 
   120                              <1> 
   121                              <1> 
   122                              <1> 
   123                              <1>  %if %0 >= 2
   124 00006D12 BB000E0000          <1>  mov ebx, %2
   125                              <1>  %if %0 >= 3
   126                              <1>  mov ecx, %3
   127                              <1>  %if %0 = 4
   128                              <1>  mov edx, %4
   129                              <1>  %endif
   130                              <1>  %endif
   131                              <1>  %endif
   132 00006D17 B820000000          <1>  mov eax, %1
   133                              <1> 
   134 00006D1C CD40                <1>  int 40h
 10114                                  		; EAX = IRQ Number in AL
 10115                                  		;	Audio Device Number in AH 
 10116                                  		; EBX = DEV/VENDOR ID
 10117                                  		;       (DDDDDDDDDDDDDDDDVVVVVVVVVVVVVVVV)
 10118                                  		; ECX = BUS/DEV/FN 
 10119                                  		;       (00000000BBBBBBBBDDDDDFFF00000000)
 10120                                  		; EDX = NABMBAR/NAMBAR (for AC97)
 10121                                  		;      (Low word, DX = NAMBAR address)
 10122                                  		; EDX = Base IO Addr (DX) for SB16 & VT8233
 10123                                  
 10124 00006D1E 891D[20A20000]          		mov	[dev_vendor], ebx
 10125 00006D24 890D[1CA20000]          		mov	[bus_dev_fn], ecx
 10126                                  
 10127 00006D2A 668915[24A20000]                	mov     [NAMBAR], dx	; save audio mixer base addr
 10128                                  		;shr	edx, 16
 10129                                          	;mov    [NABMBAR], dx	; save bus master base addr
 10130 00006D31 8915[24A20000]          		mov	[NAMBAR], edx
 10131                                  
 10132 00006D37 A2[2CA20000]            		mov	[ac97_int_ln_reg], al
 10133                                  		;;;;
 10134                                  		
 10135                                  		; TRDOS 386 system call
 10136                                  		; sysaudio
 10137                                  		; Get AC'97 Codec info
 10138                                  		; (Function 14, sub function 1)
 10139                                  		sys	_audio, 0E01h
   119                              <1> 
   120                              <1> 
   121                              <1> 
   122                              <1> 
   123                              <1>  %if %0 >= 2
   124 00006D3C BB010E0000          <1>  mov ebx, %2
   125                              <1>  %if %0 >= 3
   126                              <1>  mov ecx, %3
   127                              <1>  %if %0 = 4
   128                              <1>  mov edx, %4
   129                              <1>  %endif
   130                              <1>  %endif
   131                              <1>  %endif
   132 00006D41 B820000000          <1>  mov eax, %1
   133                              <1> 
   134 00006D46 CD40                <1>  int 40h
 10140                                  		; Save Variable Rate Audio support bit
 10141 00006D48 2401                    		and	al, 1
 10142 00006D4A A2[31A20000]            		mov	[vra], al
 10143 00006D4F C3                      		retn
 10144                                  .sb16:
 10145                                  		; check Sound Blaster 16 card at second
 10146                                  		; (44100Hz support, but 24kHz will be used)
 10147                                  		; TRDOS 386 system call
 10148                                  		; sysaudio
 10149                                  		; Detect (BH=1) SB16 (BL=1) Audio Card
 10150                                          	sys	_audio, 0101h
   119                              <1> 
   120                              <1> 
   121                              <1> 
   122                              <1> 
   123                              <1>  %if %0 >= 2
   124 00006D50 BB01010000          <1>  mov ebx, %2
   125                              <1>  %if %0 >= 3
   126                              <1>  mov ecx, %3
   127                              <1>  %if %0 = 4
   128                              <1>  mov edx, %4
   129                              <1>  %endif
   130                              <1>  %endif
   131                              <1>  %endif
   132 00006D55 B820000000          <1>  mov eax, %1
   133                              <1> 
   134 00006D5A CD40                <1>  int 40h
 10151 00006D5C 7228                    		jc	short .vt8233
 10152 00006D5E C605[30A20000]01        		mov	byte [audio_hardware], 1 ; SB16
 10153 00006D65 66C705[32A20000]44-     		mov	word [max_frequency], 44100
 10153 00006D6D AC                 
 10154                                  		; 10/01/2025
 10155                                  		;;mov	byte [blocks], 7
 10156                                  		;dec	byte [blocks]
 10157                                  
 10158                                  		;;;;
 10159                                  		; 12/01/2025 (ref: sb16play.s, 20/12/2024)
 10160                                  		sys	_audio, 0E00h ; get audio controller info
   119                              <1> 
   120                              <1> 
   121                              <1> 
   122                              <1> 
   123                              <1>  %if %0 >= 2
   124 00006D6E BB000E0000          <1>  mov ebx, %2
   125                              <1>  %if %0 >= 3
   126                              <1>  mov ecx, %3
   127                              <1>  %if %0 = 4
   128                              <1>  mov edx, %4
   129                              <1>  %endif
   130                              <1>  %endif
   131                              <1>  %endif
   132 00006D73 B820000000          <1>  mov eax, %1
   133                              <1> 
   134 00006D78 CD40                <1>  int 40h
 10161                                  	
 10162 00006D7A 8915[28A20000]          		mov	[audio_io_base], edx
 10163 00006D80 A2[2CA20000]            		mov	[audio_intr], al
 10164                                  		;;;;
 10165                                  
 10166 00006D85 C3                      		retn
 10167                                  .vt8233:
 10168                                  		; check VIA VT3237R (VT8233) hardware at third
 10169                                  		; (48kHz support)
 10170                                  		; TRDOS 386 system call
 10171                                  		; sysaudio
 10172                                  		; Detect (BH=1) VT8237R (BL=3) Audio Device
 10173                                  		sys	_audio, 0103h
   119                              <1> 
   120                              <1> 
   121                              <1> 
   122                              <1> 
   123                              <1>  %if %0 >= 2
   124 00006D86 BB03010000          <1>  mov ebx, %2
   125                              <1>  %if %0 >= 3
   126                              <1>  mov ecx, %3
   127                              <1>  %if %0 = 4
   128                              <1>  mov edx, %4
   129                              <1>  %endif
   130                              <1>  %endif
   131                              <1>  %endif
   132 00006D8B B820000000          <1>  mov eax, %1
   133                              <1> 
   134 00006D90 CD40                <1>  int 40h
 10174 00006D92 7208                    		jc	short .hda
 10175 00006D94 C605[30A20000]03        		mov	byte [audio_hardware], 3 ; VT8237R
 10176 00006D9B C3                      		retn
 10177                                  .hda:	
 10178                                  		; check Intel HDA hardware at last
 10179                                  		; (48kHz support)
 10180                                  		; TRDOS 386 system call
 10181                                  		; sysaudio
 10182                                  		; Detect (BH=1) Intel HDA (BL=4) Audio Device
 10183                                  		sys	_audio, 0104h
   119                              <1> 
   120                              <1> 
   121                              <1> 
   122                              <1> 
   123                              <1>  %if %0 >= 2
   124 00006D9C BB04010000          <1>  mov ebx, %2
   125                              <1>  %if %0 >= 3
   126                              <1>  mov ecx, %3
   127                              <1>  %if %0 = 4
   128                              <1>  mov edx, %4
   129                              <1>  %endif
   130                              <1>  %endif
   131                              <1>  %endif
   132 00006DA1 B820000000          <1>  mov eax, %1
   133                              <1> 
   134 00006DA6 CD40                <1>  int 40h
 10184 00006DA8 7208                    		jc	short .err
 10185 00006DAA C605[30A20000]04        		mov	byte [audio_hardware], 4 ; HDA
 10186 00006DB1 C3                      		retn
 10187                                  .err:
 10188 00006DB2 BA[BE6D0000]            		mov	edx, txt_audio_nf_err
 10189 00006DB7 E857F8FFFF                              call    wrstr_edx
 10190 00006DBC F9                                      stc
 10191 00006DBD C3                      		retn
 10192                                  
 10193 00006DBE 50726F706572206175-     txt_audio_nf_err: db 'Proper audio hardware not found!',0Dh,0Ah,0
 10193 00006DC7 64696F206861726477-
 10193 00006DD0 617265206E6F742066-
 10193 00006DD9 6F756E64210D0A00   
 10194                                  
 10195                                  
 10196                                  ; =============== CONSTANT ==================================================
 10197                                  
 10198                                  		; 21/10/2024
 10199                                  MP3_MAX_OUTPUT_SIZE equ 2*2*18*32*2
 10200                                      ; = 1200h = 4608 decimal = 2 channels, 2 granules, 18*32, 2 byte(16bit)
 10201                                  
 10202                                  
 10203                                  ; =============== S U B R O U T I N E =======================================
 10204                                  
 10205                                  		; 12/01/2025
 10206                                  audio_system_init:
 10207                                  		;mov	eax, sample_buffer_size
 10208                                  		; 10/01/2025
 10209                                  		;mov	byte [blocks], 16
 10210                                  		; 12/01/2025
 10211 00006DE1 C605[36A20000]08        		mov	byte [blocks], 8
 10212 00006DE8 A1[40090100]            		mov	eax, [mp3_samples_output_size]
 10213 00006DED C1E003                  		shl	eax, 3 ; * 8
 10214                                  		;shl	eax, 4 ; * 16
 10215                                  .asi@:		
 10216                                  		; 12/01/2025
 10217                                  		;cmp	eax, 65536
 10218                                  		;jna	short .asi@@
 10219                                  		;sub	eax, [mp3_samples_output_size]
 10220                                  		;dec	byte [blocks]
 10221                                  		;;;
 10222                                  		; 11/01/2025
 10223                                  		;test	byte [blocks], 1
 10224                                  		;jz	short .asi@
 10225                                  		;dec	byte [blocks] ; even number
 10226                                  		;sub	eax, [mp3_samples_output_size]
 10227                                  		;;;
 10228                                  		;jmp	short .asi@
 10229                                  .asi@@:
 10230 00006DF0 803D[30A20000]01        		cmp	byte [audio_hardware], 1 ; SB16
 10231 00006DF7 7515                    		jne	short .bufaloc
 10232                                  .asi@@@:
 10233                                  		; 10/01/2025
 10234 00006DF9 3D00800000              		cmp	eax, 32768
 10235 00006DFE 760E                    		jna	short .bufaloc
 10236                                  		; sample_buffer_size = 36864 bytes ; 8 blocks
 10237                                  		;sub	eax, MP3_MAX_OUTPUT_SIZE
 10238                                  		; eax = 32256 ; 7 blocks
 10239                                  		; 10/01/2025
 10240 00006E00 2B05[40090100]          		sub	eax, [mp3_samples_output_size]
 10241 00006E06 FE0D[36A20000]          		dec	byte [blocks]
 10242                                  		;;;
 10243                                  		; 11/01/2025
 10244                                  		;test	byte [blocks], 1
 10245                                  		;jz	short .asi@@@
 10246                                  		;dec	byte [blocks] ; even number
 10247                                  		;sub	eax, [mp3_samples_output_size]
 10248                                  		;;;
 10249 00006E0C EBEB                    		jmp	short .asi@@@
 10250                                  .bufaloc:
 10251                                  		; TRDOS 386 system call
 10252                                  		; sysaudio
 10253                                  		; Allocate audio buffer (for user)
 10254                                  		; ebx = 0200h (BH=2)
 10255                                  		; ecx = buffer size (in bytes)
 10256                                  		; edx = buffer address (virtual)
 10257 00006E0E A3[38A20000]            		mov	[buffer_size], eax
 10258                                  		sys	_audio, 0200h, eax, sample_buffer
   119                              <1> 
   120                              <1> 
   121                              <1> 
   122                              <1> 
   123                              <1>  %if %0 >= 2
   124 00006E13 BB00020000          <1>  mov ebx, %2
   125                              <1>  %if %0 >= 3
   126 00006E18 89C1                <1>  mov ecx, %3
   127                              <1>  %if %0 = 4
   128 00006E1A BA[00D00500]        <1>  mov edx, %4
   129                              <1>  %endif
   130                              <1>  %endif
   131                              <1>  %endif
   132 00006E1F B820000000          <1>  mov eax, %1
   133                              <1> 
   134 00006E24 CD40                <1>  int 40h
 10259 00006E26 7225                    		jc	short .init_err
 10260                                  
 10261                                  		; 12/01/2025
 10262                                  		; clear audio buffer (before playback)
 10263 00006E28 BF[00D00500]            		mov	edi, sample_buffer
 10264                                  		; ecx = buffer size in bytes
 10265 00006E2D C1E902                  		shr	ecx, 2 ; double word
 10266 00006E30 31C0                    		xor	eax, eax
 10267 00006E32 F3AB                    		rep	stosd
 10268                                  
 10269                                  		; TRDOS 386 system call
 10270                                  		; sysaudio
 10271                                  		; Initialize audio device (bh = 3)
 10272                                  		; bl = 01h -> CallBack method
 10273                                  		; edx = Callback service address (virtual)
 10274                                  		; ecx = 0 ; CL = srb value ; not used
 10275                                  		sys	_audio, 0301h, 0, audio_callback
   119                              <1> 
   120                              <1> 
   121                              <1> 
   122                              <1> 
   123                              <1>  %if %0 >= 2
   124 00006E34 BB01030000          <1>  mov ebx, %2
   125                              <1>  %if %0 >= 3
   126 00006E39 B900000000          <1>  mov ecx, %3
   127                              <1>  %if %0 = 4
   128 00006E3E BA[806E0000]        <1>  mov edx, %4
   129                              <1>  %endif
   130                              <1>  %endif
   131                              <1>  %endif
   132 00006E43 B820000000          <1>  mov eax, %1
   133                              <1> 
   134 00006E48 CD40                <1>  int 40h
 10276                                  		; 12/01/2025
 10277                                  		; SRB method (faster than callback method)
 10278                                  		; bl = 0 -> Signal Response Byte method
 10279                                  		; cl = 1 -> SRB set value 
 10280                                  		;     (will be set by audio IRQ service of the kernel)
 10281                                  		; edx = SRB address -one byte data-
 10282                                  		;sys	_audio, 0300h, 1, srb	
 10283 00006E4A 7201                    		jc	short .init_err
 10284 00006E4C C3                      		retn
 10285                                  .init_err:
 10286                                  init_error:	; 13/01/2025
 10287 00006E4D BA[596E0000]            		mov	edx, txt_audio_init_err
 10288 00006E52 E8BCF7FFFF                              call    wrstr_edx
 10289 00006E57 F9                                      stc
 10290 00006E58 C3                      		retn
 10291                                  
 10292 00006E59 417564696F20686172-     txt_audio_init_err: db 'Audio hardware initialization error!',0Dh,0Ah,0
 10292 00006E62 647761726520696E69-
 10292 00006E6B 7469616C697A617469-
 10292 00006E74 6F6E206572726F7221-
 10292 00006E7D 0D0A00             
 10293                                  
 10294                                  
 10295                                  ; =============== S U B R O U T I N E =======================================
 10296                                  
 10297                                  		; 21/10/2024
 10298                                  audio_callback:
 10299                                  		; Operating system has directed CPU here because of
 10300                                  		; user (2nd) stage of the audio hardware interrupt service.
 10301                                  		; This procedure must be short and return to operating
 10302                                  		; system again via sysrelease system call
 10303                                  		; (or any system call here will be handled as sysrelease).
 10304                                  
 10305 00006E80 C605[34A20000]01        		mov	byte [srb], 1
 10306                                  
 10307                                  		; 12/01/2025
 10308 00006E87 E884010000                              call	try_enqueue_all_blocks
 10309                                  
 10310                                  		sys	_rele ; return from callback service 
   119                              <1> 
   120                              <1> 
   121                              <1> 
   122                              <1> 
   123                              <1>  %if %0 >= 2
   124                              <1>  mov ebx, %2
   125                              <1>  %if %0 >= 3
   126                              <1>  mov ecx, %3
   127                              <1>  %if %0 = 4
   128                              <1>  mov edx, %4
   129                              <1>  %endif
   130                              <1>  %endif
   131                              <1>  %endif
   132 00006E8C B827000000          <1>  mov eax, %1
   133                              <1> 
   134 00006E91 CD40                <1>  int 40h
 10311                                  		
 10312                                  		; we must not come here !
 10313 00006E93 BBFFFFFFFF              		mov	ebx, -1
 10314                                  		sys	_exit
   119                              <1> 
   120                              <1> 
   121                              <1> 
   122                              <1> 
   123                              <1>  %if %0 >= 2
   124                              <1>  mov ebx, %2
   125                              <1>  %if %0 >= 3
   126                              <1>  mov ecx, %3
   127                              <1>  %if %0 = 4
   128                              <1>  mov edx, %4
   129                              <1>  %endif
   130                              <1>  %endif
   131                              <1>  %endif
   132 00006E98 B801000000          <1>  mov eax, %1
   133                              <1> 
   134 00006E9D CD40                <1>  int 40h
 10315                                  		;jmp	short audio_callback
 10316                                  
 10317                                  
 10318                                  ; =============== S U B R O U T I N E =======================================
 10319                                  
 10320                                  		; 13/01/2025
 10321                                  		; 12/01/2025
 10322                                  		; 10/01/2025
 10323                                  		; 21/10/2024
 10324                                  mp3_cast_to_speaker:
 10325                                  ; 13/01/2025
 10326                                  %if 1
 10327                                  		; Start	to play
 10328 00006E9F A1[80B20000]            		mov	eax, [mp3_bytes_per_sample]
 10329                                  		;shr	al, 1 ; 8 -> 0, 16 -> 1
 10330                                  		;shl	al, 1 ; 16 -> 2, 8 -> 0
 10331 00006EA4 2402                    		and	al, 2 ; 22/10/2024
 10332 00006EA6 8B1D[78B20000]          		mov	ebx, [mp3_output_num_channels]
 10333 00006EAC 4B                      		dec	ebx
 10334 00006EAD 08C3                    		or	bl, al
 10335 00006EAF 8B0D[7CB20000]          		mov	ecx, [mp3_output_sample_rate]
 10336 00006EB5 B704                    		mov	bh, 4 ; start to play
 10337                                  
 10338                                  		; 13/01/2025
 10339                                  mp3_cast_to_speaker_@:		
 10340 00006EB7 53                      		push	ebx
 10341 00006EB8 51                      		push	ecx
 10342                                  %endif
 10343                                                  ; 12/01/2025
 10344                                  		;call	try_enqueue_all_blocks
 10345                                  	
 10346                                  		; 12/01/2025
 10347                                  		;cmp	dword [bytes_left],0
 10348                                  		;jz	short .playback
 10349                                  		
 10350                                  		; 12/01/2025
 10351                                  		; (here audio buffer -sample_buffer- is empty)
 10352                                  		; (clear dma half buffer 1)
 10353                                  		sys	_audio, 1001h
   119                              <1> 
   120                              <1> 
   121                              <1> 
   122                              <1> 
   123                              <1>  %if %0 >= 2
   124 00006EB9 BB01100000          <1>  mov ebx, %2
   125                              <1>  %if %0 >= 3
   126                              <1>  mov ecx, %3
   127                              <1>  %if %0 = 4
   128                              <1>  mov edx, %4
   129                              <1>  %endif
   130                              <1>  %endif
   131                              <1>  %endif
   132 00006EBE B820000000          <1>  mov eax, %1
   133                              <1> 
   134 00006EC3 CD40                <1>  int 40h
 10354                                  		; (clear dma half buffer 2)
 10355                                  		;sys	_audio, 1002h
 10356                                  
 10357                                  		; TRDOS 386 system call
 10358                                  		; sysaudio
 10359                                  		; bh = 16 : update (current, first) dma half buffer
 10360                                  		; bl = 0  : then switch to the next (second) half buffer
 10361                                  		sys	_audio, 1000h
   119                              <1> 
   120                              <1> 
   121                              <1> 
   122                              <1> 
   123                              <1>  %if %0 >= 2
   124 00006EC5 BB00100000          <1>  mov ebx, %2
   125                              <1>  %if %0 >= 3
   126                              <1>  mov ecx, %3
   127                              <1>  %if %0 = 4
   128                              <1>  mov edx, %4
   129                              <1>  %endif
   130                              <1>  %endif
   131                              <1>  %endif
   132 00006ECA B820000000          <1>  mov eax, %1
   133                              <1> 
   134 00006ECF CD40                <1>  int 40h
 10362                                  
 10363                                  		; 12/01/2025
 10364                                  		; 22/10/2024
 10365                                  		;call	try_enqueue_all_blocks
 10366                                  .playback:
 10367                                  		; TRDOS 386 system call
 10368                                  		; sysaudio
 10369                                  		; Set Master Volume Level (BL=0 or 80h)
 10370                                  		; 	for next playing (BL>=80h)
 10371                                  		;sys	_audio, 0B80h, 1D1Dh
 10372                                  		sys	_audio, 0B00h, 1D1Dh
   119                              <1> 
   120                              <1> 
   121                              <1> 
   122                              <1> 
   123                              <1>  %if %0 >= 2
   124 00006ED1 BB000B0000          <1>  mov ebx, %2
   125                              <1>  %if %0 >= 3
   126 00006ED6 B91D1D0000          <1>  mov ecx, %3
   127                              <1>  %if %0 = 4
   128                              <1>  mov edx, %4
   129                              <1>  %endif
   130                              <1>  %endif
   131                              <1>  %endif
   132 00006EDB B820000000          <1>  mov eax, %1
   133                              <1> 
   134 00006EE0 CD40                <1>  int 40h
 10373                                  
 10374                                  		;mov	byte [volume_level], 1Dh
 10375 00006EE2 880D[35A20000]          		mov	[volume_level], cl
 10376                                  ; 13/01/2025
 10377                                  %if 0
 10378                                  		; Start	to play
 10379                                  		mov	eax, [mp3_bytes_per_sample]
 10380                                  		;shr	al, 1 ; 8 -> 0, 16 -> 1
 10381                                  		;shl	al, 1 ; 16 -> 2, 8 -> 0
 10382                                  		and	al, 2 ; 22/10/2024
 10383                                  		mov	ebx, [mp3_output_num_channels]
 10384                                  		dec	ebx
 10385                                  		or	bl, al
 10386                                  		mov	ecx, [mp3_output_sample_rate]
 10387                                  		mov	bh, 4 ; start to play
 10388                                  %else
 10389 00006EE8 59                      		pop	ecx ; sample rate (frequency)
 10390 00006EE9 5B                      		pop	ebx ; play mode (bl)
 10391                                  %endif
 10392                                  		; TRDOS 386 system call
 10393                                  		; sysaudio
 10394                                  		; bh = 4 -> start to play
 10395                                  		; bl = mode -> bit 0, 1 = stereo, 0 = mono
 10396                                  		;	       bit 1, 1 = 16 bit, 0 = 8 bit
 10397                                  		; cx = sample rate (hertz)
 10398                                  		sys	_audio
   119                              <1> 
   120                              <1> 
   121                              <1> 
   122                              <1> 
   123                              <1>  %if %0 >= 2
   124                              <1>  mov ebx, %2
   125                              <1>  %if %0 >= 3
   126                              <1>  mov ecx, %3
   127                              <1>  %if %0 = 4
   128                              <1>  mov edx, %4
   129                              <1>  %endif
   130                              <1>  %endif
   131                              <1>  %endif
   132 00006EEA B820000000          <1>  mov eax, %1
   133                              <1> 
   134 00006EEF CD40                <1>  int 40h
 10399                                  
 10400                                  		; 12/01/2025
 10401 00006EF1 C605[34A20000]00        		mov	byte [srb], 0
 10402                                  		;;;
 10403                                  
 10404                                  .playback_lop:
 10405 00006EF8 31C0                    		xor	eax, eax
 10406 00006EFA 3905[B0410500]          		cmp	[bytes_left], eax ; 0
 10407 00006F00 7508                    		jnz	short .playback_next
 10408                                  		; 22/10/2024
 10409 00006F02 3805[DC990000]          		cmp	byte [num_enqueued_frames], al ; 0
 10410 00006F08 7447                                    jz	short .playback_end
 10411                                  .playback_next:
 10412 00006F0A A2[DC990000]            		mov	[num_enqueued_frames], al ; 0
 10413 00006F0F 803D[34A20000]01        		cmp	byte [srb], 1	; audio interrupt status
 10414 00006F16 7274                    		jb	short .getchar
 10415                                  		;mov	byte [srb], 0	; reset
 10416 00006F18 A2[34A20000]            		mov	[srb], al ; 0
 10417                                  		; 12/01/2025
 10418                                  		;call	try_enqueue_all_blocks
 10419                                  		; 15/01/2025
 10420 00006F1D 803D[36A20000]00        		cmp	byte [blocks], 0 ; interpolation ?
 10421 00006F24 7618                    		jna	short .interpolated ; yes
 10422                                  
 10423                                  		; 15/01/2025
 10424 00006F26 B44E                    		mov	ah, 4Eh ; red backgroud, yellow font 
 10425                                  .indicator:
 10426                                  		;;; 10/01/2025
 10427 00006F28 A0[1AA20000]            		mov	al, [half_buffer]
 10428 00006F2D 8035[1AA20000]01        		xor	byte [half_buffer], 1
 10429                                  		;mov	ah, 4Eh
 10430 00006F34 0431                    		add	al, '1'
 10431 00006F36 66A300800B00            		mov	[0B8000h], ax
 10432                                  		;;;	
 10433 00006F3C EBBA                    		jmp	short .playback_lop
 10434                                  
 10435                                  .interpolated:
 10436                                  		; 15/01/2025
 10437                                  		; (a solution for very fast indicator digit change)
 10438                                  		; (8 to 1)
 10439 00006F3E FE05[45A20000]          		inc	byte [counter]
 10440 00006F44 A0[45A20000]            		mov	al, [counter]
 10441 00006F49 2407                    		and	al, 7
 10442 00006F4B 75AB                    		jnz	short .playback_lop
 10443 00006F4D B41E                    		mov	ah, 1Eh ; blue backgroud, yellow font
 10444 00006F4F EBD7                    		jmp	short .indicator
 10445                                  
 10446                                  .playback_end:
 10447                                  		;;; 10/01/2025
 10448 00006F51 66B8304E                		mov	ax, 4E30h
 10449 00006F55 66A300800B00            		mov	[0B8000h], ax 
 10450                                  		;;;
 10451                                  
 10452                                  		; TRDOS 386 system call
 10453                                  		; sysaudio
 10454                                  		; Stop playing
 10455                                  		sys	_audio, 0700h
   119                              <1> 
   120                              <1> 
   121                              <1> 
   122                              <1> 
   123                              <1>  %if %0 >= 2
   124 00006F5B BB00070000          <1>  mov ebx, %2
   125                              <1>  %if %0 >= 3
   126                              <1>  mov ecx, %3
   127                              <1>  %if %0 = 4
   128                              <1>  mov edx, %4
   129                              <1>  %endif
   130                              <1>  %endif
   131                              <1>  %endif
   132 00006F60 B820000000          <1>  mov eax, %1
   133                              <1> 
   134 00006F65 CD40                <1>  int 40h
 10456                                  		; Cancel callback service (for user)
 10457                                  		sys	_audio, 0900h
   119                              <1> 
   120                              <1> 
   121                              <1> 
   122                              <1> 
   123                              <1>  %if %0 >= 2
   124 00006F67 BB00090000          <1>  mov ebx, %2
   125                              <1>  %if %0 >= 3
   126                              <1>  mov ecx, %3
   127                              <1>  %if %0 = 4
   128                              <1>  mov edx, %4
   129                              <1>  %endif
   130                              <1>  %endif
   131                              <1>  %endif
   132 00006F6C B820000000          <1>  mov eax, %1
   133                              <1> 
   134 00006F71 CD40                <1>  int 40h
 10458                                  		; Deallocate audio buffer (for user)
 10459                                  		sys	_audio, 0A00h
   119                              <1> 
   120                              <1> 
   121                              <1> 
   122                              <1> 
   123                              <1>  %if %0 >= 2
   124 00006F73 BB000A0000          <1>  mov ebx, %2
   125                              <1>  %if %0 >= 3
   126                              <1>  mov ecx, %3
   127                              <1>  %if %0 = 4
   128                              <1>  mov edx, %4
   129                              <1>  %endif
   130                              <1>  %endif
   131                              <1>  %endif
   132 00006F78 B820000000          <1>  mov eax, %1
   133                              <1> 
   134 00006F7D CD40                <1>  int 40h
 10460                                  		; Disable audio device
 10461                                  		sys	_audio, 0C00h
   119                              <1> 
   120                              <1> 
   121                              <1> 
   122                              <1> 
   123                              <1>  %if %0 >= 2
   124 00006F7F BB000C0000          <1>  mov ebx, %2
   125                              <1>  %if %0 >= 3
   126                              <1>  mov ecx, %3
   127                              <1>  %if %0 = 4
   128                              <1>  mov edx, %4
   129                              <1>  %endif
   130                              <1>  %endif
   131                              <1>  %endif
   132 00006F84 B820000000          <1>  mov eax, %1
   133                              <1> 
   134 00006F89 CD40                <1>  int 40h
 10462 00006F8B C3                      		retn
 10463                                  
 10464                                  .getchar:
 10465                                  		; TRDOS 386 system call
 10466                                  		; sysstdio
 10467                                  		; BL = 1 -> read a character on stdin (no wait)
 10468                                  		sys	_stdio, 1
   119                              <1> 
   120                              <1> 
   121                              <1> 
   122                              <1> 
   123                              <1>  %if %0 >= 2
   124 00006F8C BB01000000          <1>  mov ebx, %2
   125                              <1>  %if %0 >= 3
   126                              <1>  mov ecx, %3
   127                              <1>  %if %0 = 4
   128                              <1>  mov edx, %4
   129                              <1>  %endif
   130                              <1>  %endif
   131                              <1>  %endif
   132 00006F91 B82E000000          <1>  mov eax, %1
   133                              <1> 
   134 00006F96 CD40                <1>  int 40h
 10469 00006F98 21C0                    		and	eax, eax
 10470 00006F9A 0F846AFFFFFF            		jz	.playback_next ; 15/01/2024
 10471                                  
 10472 00006FA0 3C2B                    		cmp	al, '+' ; increase sound volume
 10473 00006FA2 741B                    		je	short .inc_volume
 10474 00006FA4 3C2D                    		cmp	al, '-'
 10475 00006FA6 7441                    		je	short .dec_volume
 10476                                  
 10477                                  		;;;
 10478                                  		; 10/01/2025
 10479                                  		;cmp	ah, 01h
 10480 00006FA8 3C1B                    		cmp	al, 1Bh	; ESC
 10481 00006FAA 74A5                    		je	short .playback_end
 10482                                  		;cmp	ax, 2E03h
 10483 00006FAC 3C03                    		cmp	al, 03h	; CTRL+C
 10484 00006FAE 74A1                    		je	short .playback_end
 10485                                  		;;;
 10486                                  		; 12/01/2025
 10487 00006FB0 24DF                    		and	al, 0DFh
 10488 00006FB2 3C48                    		cmp	al, 'H'
 10489 00006FB4 7446                    		je	short .hw_info
 10490 00006FB6 3C42                    		cmp	al,'B'
 10491 00006FB8 744C                    		je	short .b_info
 10492 00006FBA E94BFFFFFF              		jmp	.playback_next
 10493                                  
 10494                                  .inc_volume:
 10495 00006FBF 8A0D[35A20000]          		mov	cl, [volume_level]
 10496 00006FC5 80F91F                  		cmp	cl, 1Fh ; 31
 10497 00006FC8 0F833CFFFFFF            		jnb	.playback_next
 10498 00006FCE FEC1                    		inc	cl
 10499                                  .chg_volume:
 10500 00006FD0 880D[35A20000]          		mov	[volume_level], cl
 10501 00006FD6 88CD                    		mov	ch, cl
 10502                                  		; TRDOS 386 system call
 10503                                  		; sysstdio
 10504                                  		; Set master volume level
 10505                                  		; bh = 11
 10506                                  		; cl = left channel volume (0 to 31 max)
 10507                                  		; ch = right channel volume (0 to 31 max)
 10508                                  		sys	_audio, 0B00h
   119                              <1> 
   120                              <1> 
   121                              <1> 
   122                              <1> 
   123                              <1>  %if %0 >= 2
   124 00006FD8 BB000B0000          <1>  mov ebx, %2
   125                              <1>  %if %0 >= 3
   126                              <1>  mov ecx, %3
   127                              <1>  %if %0 = 4
   128                              <1>  mov edx, %4
   129                              <1>  %endif
   130                              <1>  %endif
   131                              <1>  %endif
   132 00006FDD B820000000          <1>  mov eax, %1
   133                              <1> 
   134 00006FE2 CD40                <1>  int 40h
 10509 00006FE4 E921FFFFFF              		jmp	.playback_next
 10510                                  .dec_volume:
 10511 00006FE9 8A0D[35A20000]          		mov	cl, [volume_level]
 10512 00006FEF 80F901                  		cmp	cl, 1 ; 1
 10513 00006FF2 0F8612FFFFFF            		jna	.playback_next
 10514 00006FF8 FEC9                    		dec	cl
 10515 00006FFA EBD4                    		jmp	short .chg_volume
 10516                                  
 10517                                  		; 12/01/2025
 10518                                  .hw_info:
 10519 00006FFC E81A160000              		call	write_audio_dev_info
 10520 00007001 E904FFFFFF              		jmp	.playback_next
 10521                                  		; 12/01/2025
 10522                                  .b_info:
 10523 00007006 E8BB180000              		call	write_buffer_size
 10524 0000700B E9FAFEFFFF              		jmp	.playback_next
 10525                                  
 10526                                  
 10527                                  ; =============== S U B R O U T I N E =======================================
 10528                                  
 10529                                  		; 13/01/2025
 10530                                  		; 12/01/2025
 10531                                  		; 09/01/2025
 10532                                  		; 21/10/2024
 10533                                  try_enqueue_all_blocks:
 10534                                  		; 12/01/2025
 10535 00007010 60                      		pusha
 10536 00007011 BF[00D00500]             		mov	edi, sample_buffer
 10537                                  		; 10/01/2025
 10538                                  		;jmp	short .first_block
 10539                                  		; 13/01/2025
 10540 00007016 EB15                    		jmp	short try_enqueue_all_blocks_@
 10541                                  ;.next_block:
 10542                                  teab_next_block:
 10543 00007018 833D[B0410500]00                        cmp	dword [bytes_left], 0
 10544                                                  ;jle	short .enqueue_done
 10545                                  		; 13/01/2025
 10546 0000701F 7E56                    		jle	short teab_enqueue_done
 10547                                  		;
 10548 00007021 8B3D[3C090100]          		mov	edi, [mp3_samples_dst]
 10549 00007027 033D[40090100]          		add	edi, [mp3_samples_output_size]
 10550                                  
 10551                                  try_enqueue_all_blocks_@:
 10552                                  ;.first_block:
 10553                                  		;pusha
 10554 0000702D 8B35[AC410500]          		mov	esi, [stream_pos]
 10555 00007033 8B0D[B0410500]          		mov	ecx, [bytes_left]
 10556 00007039 31ED                    		xor	ebp, ebp
 10557 0000703B E849F2FFFF              		call	mp3_decode_frame
 10558                                  		;popa
 10559                                  		;jc	short .enqueue_done
 10560                                  		; 13/01/2025
 10561 00007040 7235                    		jc	short teab_enqueue_done
 10562 00007042 A1[50B20000]            		mov	eax, [mp3_src_frame_size]
 10563 00007047 83F800                  		cmp	eax, 0
 10564                                  		;jz	short .enqueue_done
 10565                                  		; 13/01/2025
 10566 0000704A 742B                    		jz	short teab_enqueue_done
 10567 0000704C 0105[AC410500]          		add	[stream_pos], eax
 10568 00007052 2905[B0410500]          		sub	[bytes_left], eax
 10569 00007058 A1[40090100]            		mov	eax, [mp3_samples_output_size]
 10570 0000705D 83F800                  		cmp	eax, 0
 10571                                  		;jz	short .next_block
 10572                                  		; 13/01/2025
 10573 00007060 74B6                    		jz	short teab_next_block
 10574                                  ;.no_error:
 10575 00007062 FE05[DC990000]          		inc	byte [num_enqueued_frames]
 10576 00007068 A0[DC990000]            		mov	al, [num_enqueued_frames]
 10577 0000706D 3A05[36A20000]          		cmp	al, [blocks]
 10578                                  		;jb	short .next_block
 10579                                  		; 13/01/2025
 10580 00007073 72A3                    		jb	short teab_next_block
 10581                                  teab_rtn:
 10582                                  ;.rtn:
 10583                                  		; 12/01/2025
 10584 00007075 61                      		popa
 10585 00007076 C3                      		retn
 10586                                  ;.enqueue_done:
 10587                                  teab_enqueue_done:
 10588 00007077 C705[B0410500]0000-                     mov	dword [bytes_left], 0
 10588 0000707F 0000               
 10589                                  		; 12/01/2025
 10590                                  		;jmp	short .rtn
 10591                                  		; 13/01/2025
 10592 00007081 EBF2                    		jmp	short teab_rtn
 10593                                  
 10594                                  
 10595                                  ; ---------------------------------------------------------------------------
 10596                                  ; 13/01/2025 - Interpolation procedures for non-VRA AC97 codecs
 10597                                  ; ---------------------------------------------------------------------------
 10598                                  
 10599                                  ; =============== S U B R O U T I N E =======================================
 10600                                  		
 10601                                  		; 15/01/2025
 10602                                  		; 14/01/2025
 10603                                  		; 13/01/2025
 10604                                  audio_system_init_x:
 10605 00007083 8B0D[40090100]          		mov	ecx, [mp3_samples_output_size]
 10606                                  		;;;
 10607                                  		; 15/01/2025
 10608 00007089 89C8                    		mov	eax, ecx
 10609                                  		;mov	[loadsize], ecx
 10610                                  		;;;
 10611                                  		; 15/01/2025
 10612                                  		;shl	ecx, 3 ; * 8 ; 8 blocks
 10613                                  		; 14/01/2025
 10614                                  		;mov	byte [blocks], 8
 10615                                  
 10616 0000708B 803D[44A20000]02        		cmp	byte [interpolation], 2
 10617 00007092 733B                    		jnb	short .chk_sample_rate	; interpolation needed
 10618                                  
 10619                                  		; 48 kHZ with 16 bit stereo conversion
 10620                                  		;
 10621                                  		; selected output is
 10622                                  		;	 8bit stereo or 16bit mono or 8bit mono
 10623                                  		; (but AC97 hardware needs 16bit stereo samples)
 10624                                  	
 10625                                  		; 15/01/2025
 10626                                  		;mov	eax, ecx
 10627 00007094 D1E0                    		shl	eax, 1 ; * 2 (mono to stereo)
 10628                                  
 10629 00007096 BB[CB730000]            		mov	ebx, convert_to_stereo
 10630 0000709B 803D[80B20000]02        		cmp	byte [mp3_bytes_per_sample], 2
 10631 000070A2 7415                    		je	short .set_sizes ; 16bit mono
 10632                                  		; 8bit output (16bit conversion is neeed)
 10633 000070A4 BB[FA730000]            		mov	ebx, convert_to_16bit
 10634 000070A9 803D[78B20000]02        		cmp	byte [mp3_output_num_channels], 2
 10635 000070B0 7407                    		je	short .set_sizes ; 8bit stereo
 10636                                  		; 8bit mono output
 10637                                  		;shr	ecx, 1 ; / 2 ; 4 blocks
 10638                                  		; 14/01/2025
 10639 000070B2 D1E0                    		shl	eax, 1
 10640                                  		; 14/01/2025
 10641                                  		;shr	byte [blocks], 1
 10642 000070B4 BB[16740000]            		mov	ebx, convert_to_stereo_16bit
 10643                                  .set_sizes:
 10644                                  .set_sizes_@:
 10645 000070B9 891D[3CA20000]          		mov	[conversion], ebx
 10646 000070BF 890D[40A20000]          		mov	[loadsize], ecx
 10647                                  		;;;
 10648                                  		; 14/01/2025
 10649                                  		; align to 16bit stereo (if there is a defect)
 10650                                  		; 15/01/2025
 10651                                  		;and	al, ~3
 10652 000070C5 A3[38A20000]            		mov	[buffer_size], eax
 10653 000070CA E90D020000              		jmp	.asix_@
 10654                                  
 10655                                  		; 13/01/2025
 10656                                  		; ----------------------------
 10657                                  		; ref: playwav9.s - 18/12/2024
 10658                                  .chk_sample_rate:
 10659                                  		; set interpolation parameters
 10660                                  		; (for 8, 11.025, 16, 22.050, 24, 32, 44.1 kHZ)
 10661 000070CF A1[7CB20000]            		mov	eax, [mp3_output_sample_rate]
 10662                                  		; ecx = 8 * [mp3_samples_output_size] ; 8 blocks
 10663                                  .chk_44khz:
 10664 000070D4 3D44AC0000              		cmp	eax, 44100
 10665 000070D9 7541                    		jne	short .chk_32khz
 10666 000070DB 803D[80B20000]01        		cmp	byte [mp3_bytes_per_sample], 1
 10667 000070E2 7615                    		jna	short .chk_44khz_1
 10668 000070E4 BB[74800000]            		mov	ebx, load_44khz_stereo_16_bit
 10669 000070E9 803D[78B20000]01        		cmp	byte [mp3_output_num_channels], 1
 10670 000070F0 751A                    		jne	short .chk_44khz_2
 10671 000070F2 BB[25800000]            		mov	ebx, load_44khz_mono_16_bit
 10672 000070F7 EB13                    		jmp	short .chk_44khz_2
 10673                                  .chk_44khz_1:
 10674 000070F9 BB[CD7F0000]            		mov	ebx, load_44khz_stereo_8_bit
 10675 000070FE 803D[78B20000]01        		cmp	byte [mp3_output_num_channels], 1
 10676 00007105 7505                    		jne	short .chk_44khz_2
 10677 00007107 BB[7D7F0000]            		mov	ebx, load_44khz_mono_8_bit
 10678                                  .chk_44khz_2:
 10679                                  		; 48000/44100 == 25/23
 10680 0000710C BD17000000              		mov	ebp, 23
 10681 00007111 B819000000              		mov	eax, 25
 10682 00007116 F7E1                    		mul	ecx  ; load (decoding buffer) size
 10683 00007118 F7F5                    		div	ebp
 10684                                  		;; eax = wav output buffer size
 10685                                  		; 15/01/2025
 10686                                  		; eax = 1 block output (converted) size
 10687 0000711A EB9D                    		jmp	short .set_sizes
 10688                                  
 10689                                  		; 15/01/2025
 10690                                  ;		;;;
 10691                                  ;		; 14/01/2025
 10692                                  ;.set_sizes_@:
 10693                                  ;		cmp	ecx, 4608
 10694                                  ;		;ja	short .set_sizes
 10695                                  ;		; 15/01/2025
 10696                                  ;		jnb	short .set_sizes
 10697                                  ;		;shl	ecx, 1
 10698                                  ;		; ecx = [mp3_samples_output_size]
 10699                                  ;		shl	byte [blocks], 1
 10700                                  ;		; 15/01/2025
 10701                                  ;		;shl	eax, 1
 10702                                  ;		;jmp	short .set_sizes_@
 10703                                  ;		jmp	.set_sizes
 10704                                  		;;;
 10705                                  .chk_32khz:
 10706 0000711C 3D007D0000              		cmp	eax, 32000
 10707 00007121 753F                    		jne	short .chk_24khz
 10708 00007123 803D[80B20000]01        		cmp	byte [mp3_bytes_per_sample], 1
 10709 0000712A 7615                    		jna	short .chk_32khz_1
 10710 0000712C BB[DF7B0000]            		mov	ebx, load_32khz_stereo_16_bit
 10711 00007131 803D[78B20000]01        		cmp	byte [mp3_output_num_channels], 1
 10712 00007138 751A                    		jne	short .chk_32khz_2
 10713 0000713A BB[9F7B0000]            		mov	ebx, load_32khz_mono_16_bit
 10714 0000713F EB13                    		jmp	short .chk_32khz_2
 10715                                  .chk_32khz_1:
 10716 00007141 BB[277B0000]            		mov	ebx, load_32khz_stereo_8_bit
 10717 00007146 803D[78B20000]01        		cmp	byte [mp3_output_num_channels], 1
 10718 0000714D 7505                    		jne	short .chk_32khz_2
 10719 0000714F BB[E07A0000]            		mov	ebx, load_32khz_mono_8_bit
 10720                                  .chk_32khz_2:
 10721                                  		; 48000/32000 = 3/2
 10722 00007154 B803000000              		mov	eax, 3
 10723 00007159 F7E1                    		mul	ecx	; *3
 10724                                  		;mov	eax, ecx
 10725                                  		;add	eax, eax
 10726                                  		;add	eax, ecx
 10727 0000715B D1E8                    		shr	eax, 1  ; /2
 10728 0000715D E957FFFFFF              		jmp	.set_sizes
 10729                                  .chk_24khz:
 10730 00007162 3DC05D0000              		cmp	eax, 24000
 10731 00007167 753A                    		jne	short .chk_22khz
 10732 00007169 803D[80B20000]01        		cmp	byte [mp3_bytes_per_sample], 1
 10733 00007170 7615                    		jna	short .chk_24khz_1
 10734                                  		; 14/01/2025 
 10735                                  		; bx -> ebx
 10736                                  		; (BugFix, 'playwav9.s' has a bug here) 
 10737 00007172 BB[7E7A0000]            		mov	ebx, load_24khz_stereo_16_bit
 10738 00007177 803D[78B20000]01        		cmp	byte [mp3_output_num_channels], 1
 10739 0000717E 751A                    		jne	short .chk_24khz_2
 10740 00007180 BB[457A0000]            		mov	ebx, load_24khz_mono_16_bit
 10741 00007185 EB13                    		jmp	short .chk_24khz_2
 10742                                  .chk_24khz_1:
 10743 00007187 BB[E0790000]            		mov	ebx, load_24khz_stereo_8_bit
 10744 0000718C 803D[78B20000]01        		cmp	byte [mp3_output_num_channels], 1
 10745 00007193 7505                    		jne	short .chk_24khz_2
 10746 00007195 BB[A5790000]            		mov	ebx, load_24khz_mono_8_bit
 10747                                  .chk_24khz_2:
 10748                                  		; 48000/24000 = 2/1
 10749 0000719A 89C8                    		mov	eax, ecx
 10750 0000719C D1E0                    		shl	eax, 1
 10751 0000719E E916FFFFFF              		jmp	.set_sizes_@
 10752                                  .chk_22khz:
 10753 000071A3 3D22560000              		cmp	eax, 22050
 10754 000071A8 7544                    		jne	short .chk_16khz
 10755 000071AA 803D[80B20000]01        		cmp	byte [mp3_bytes_per_sample], 1
 10756 000071B1 7615                    		jna	short .chk_22khz_1
 10757 000071B3 BB[6C7D0000]            		mov	ebx, load_22khz_stereo_16_bit
 10758 000071B8 803D[78B20000]01        		cmp	byte [mp3_output_num_channels], 1
 10759 000071BF 751A                    		jne	short .chk_22khz_2
 10760 000071C1 BB[097D0000]            		mov	ebx, load_22khz_mono_16_bit
 10761 000071C6 EB13                    		jmp	short .chk_22khz_2
 10762                                  .chk_22khz_1:
 10763 000071C8 BB[A77C0000]            		mov	ebx, load_22khz_stereo_8_bit
 10764 000071CD 803D[78B20000]01        		cmp	byte [mp3_output_num_channels], 1
 10765 000071D4 7505                    		jne	short .chk_22khz_2
 10766 000071D6 BB[4A7C0000]            		mov	ebx, load_22khz_mono_8_bit
 10767                                  .chk_22khz_2:
 10768                                  		; 48000/22050 == 37/17
 10769 000071DB BD11000000              		mov	ebp, 17
 10770 000071E0 B825000000              		mov	eax, 37
 10771 000071E5 F7E1                    		mul	ecx  ; load (decoding buffer) size
 10772 000071E7 F7F5                    		div	ebp
 10773                                  		;; eax = wav output buffer size
 10774                                  		; 15/01/2025
 10775                                  		; eax = 1 block output (converted) size
 10776 000071E9 E9CBFEFFFF              		jmp	.set_sizes_@
 10777                                  .chk_16khz:
 10778 000071EE 3D803E0000              		cmp	eax, 16000
 10779 000071F3 753C                    		jne	short .chk_11khz
 10780 000071F5 803D[80B20000]01        		cmp	byte [mp3_bytes_per_sample], 1
 10781 000071FC 7615                    		jna	short .chk_16khz_1
 10782 000071FE BB[F4780000]            		mov	ebx, load_16khz_stereo_16_bit
 10783 00007203 803D[78B20000]01        		cmp	byte [mp3_output_num_channels], 1
 10784 0000720A 751A                    		jne	short .chk_16khz_2
 10785 0000720C BB[9D780000]            		mov	ebx, load_16khz_mono_16_bit
 10786 00007211 EB13                    		jmp	short .chk_16khz_2
 10787                                  .chk_16khz_1:
 10788 00007213 BB[08780000]            		mov	ebx, load_16khz_stereo_8_bit
 10789 00007218 803D[78B20000]01        		cmp	byte [mp3_output_num_channels], 1
 10790 0000721F 7505                    		jne	short .chk_16khz_2
 10791 00007221 BB[B5770000]            		mov	ebx, load_16khz_mono_8_bit
 10792                                  .chk_16khz_2:
 10793                                  		; 48000/16000 = 3/1
 10794 00007226 89C8                    		mov	eax, ecx
 10795 00007228 D1E0                    		shl	eax, 1
 10796                                  		;add	eax, eax
 10797 0000722A 01C8                    		add	eax, ecx
 10798 0000722C E988FEFFFF              		jmp	.set_sizes_@
 10799                                  .chk_11khz:
 10800 00007231 3D112B0000              		cmp	eax, 11025
 10801 00007236 7544                    		jne	short .chk_8khz
 10802 00007238 803D[80B20000]01        		cmp	byte [mp3_bytes_per_sample], 1
 10803 0000723F 7615                    		jna	short .chk_11khz_1
 10804 00007241 BB[ED7E0000]            		mov	ebx, load_11khz_stereo_16_bit
 10805 00007246 803D[78B20000]01        		cmp	byte [mp3_output_num_channels], 1
 10806 0000724D 751A                    		jne	short .chk_11khz_2
 10807 0000724F BB[997E0000]            		mov	ebx, load_11khz_mono_16_bit
 10808 00007254 EB13                    		jmp	short .chk_11khz_2
 10809                                  .chk_11khz_1:
 10810 00007256 BB[3F7E0000]            		mov	ebx, load_11khz_stereo_8_bit
 10811 0000725B 803D[78B20000]01        		cmp	byte [mp3_output_num_channels], 1
 10812 00007262 7505                    		jne	short .chk_11khz_2
 10813 00007264 BB[F87D0000]            		mov	ebx, load_11khz_mono_8_bit
 10814                                  .chk_11khz_2:
 10815                                  		; 48000/11025 == 74/17
 10816                                  		; 14/01/2025
 10817                                  		;shr	ecx, 1	; 4 blocks
 10818                                  		;shr	byte [blocks], 1
 10819 00007269 BD11000000              		mov	ebp, 17
 10820 0000726E B84A000000              		mov	eax, 74
 10821 00007273 F7E1                    		mul	ecx  ; load (decoding buffer) size
 10822 00007275 F7F5                    		div	ebp
 10823                                  		;; eax = wav output buffer size
 10824                                  		; 15/01/2025
 10825                                  		; eax = 1 block output (converted) size
 10826 00007277 E93DFEFFFF              		jmp	.set_sizes_@
 10827                                  .chk_8khz:
 10828 0000727C 3D401F0000              		cmp	eax, 8000
 10829 00007281 753D                    		jne	short .vra_needed
 10830 00007283 803D[80B20000]01        		cmp	byte [mp3_bytes_per_sample], 1
 10831 0000728A 7615                    		jna	short .chk_8khz_1
 10832 0000728C BB[8F760000]            		mov	ebx, load_8khz_stereo_16_bit
 10833 00007291 803D[78B20000]01        		cmp	byte [mp3_output_num_channels], 1
 10834 00007298 751A                    		jne	short .chk_8khz_2
 10835 0000729A BB[ED750000]            		mov	ebx, load_8khz_mono_16_bit
 10836 0000729F EB13                    		jmp	short .chk_8khz_2
 10837                                  .chk_8khz_1:
 10838 000072A1 BB[DD740000]            		mov	ebx, load_8khz_stereo_8_bit
 10839 000072A6 803D[78B20000]01        		cmp	byte [mp3_output_num_channels], 1
 10840 000072AD 7505                    		jne	short .chk_8khz_2
 10841 000072AF BB[34740000]            		mov	ebx, load_8khz_mono_8_bit
 10842                                  .chk_8khz_2:
 10843 000072B4 B806000000              		mov	eax, 6
 10844 000072B9 F7E1                    		mul	ecx
 10845 000072BB E9F9FDFFFF              		jmp	.set_sizes_@
 10846                                  .vra_needed:
 10847 000072C0 58                      		pop	eax ; discard return address to the caller
 10848                                  .vra_err:
 10849                                  		sys	_msg, msg_no_vra, 255, 0Fh
   119                              <1> 
   120                              <1> 
   121                              <1> 
   122                              <1> 
   123                              <1>  %if %0 >= 2
   124 000072C1 BB[BD8A0000]        <1>  mov ebx, %2
   125                              <1>  %if %0 >= 3
   126 000072C6 B9FF000000          <1>  mov ecx, %3
   127                              <1>  %if %0 = 4
   128 000072CB BA0F000000          <1>  mov edx, %4
   129                              <1>  %endif
   130                              <1>  %endif
   131                              <1>  %endif
   132 000072D0 B823000000          <1>  mov eax, %1
   133                              <1> 
   134 000072D5 CD40                <1>  int 40h
 10850 000072D7 E958F9FFFF              		jmp	ExitProcess
 10851                                  
 10852                                  .asix_@:
 10853                                  		; TRDOS 386 system call
 10854                                  		; sysaudio
 10855                                  		; Allocate audio buffer (for user)
 10856                                  		; ebx = 0200h (BH=2)
 10857                                  		; ecx = buffer size (in bytes)
 10858                                  		; edx = buffer address (virtual)
 10859                                  
 10860                                  		sys	_audio, 0200h, [buffer_size], sample_buffer
   119                              <1> 
   120                              <1> 
   121                              <1> 
   122                              <1> 
   123                              <1>  %if %0 >= 2
   124 000072DC BB00020000          <1>  mov ebx, %2
   125                              <1>  %if %0 >= 3
   126 000072E1 8B0D[38A20000]      <1>  mov ecx, %3
   127                              <1>  %if %0 = 4
   128 000072E7 BA[00D00500]        <1>  mov edx, %4
   129                              <1>  %endif
   130                              <1>  %endif
   131                              <1>  %endif
   132 000072EC B820000000          <1>  mov eax, %1
   133                              <1> 
   134 000072F1 CD40                <1>  int 40h
 10861 000072F3 7228                    		jc	short .init_err
 10862                                  
 10863                                  		; 12/01/2025
 10864                                  		; clear audio buffer (before playback)
 10865 000072F5 BF[00D00500]            		mov	edi, sample_buffer
 10866                                  		; ecx = buffer size in bytes
 10867 000072FA 83C103                  		add	ecx, 3	; 13/01/2025
 10868 000072FD C1E902                  		shr	ecx, 2
 10869 00007300 31C0                    		xor	eax, eax
 10870 00007302 F3AB                    		rep	stosd
 10871                                  
 10872                                  		; TRDOS 386 system call
 10873                                  		; sysaudio
 10874                                  		; Initialize audio device (bh = 3)
 10875                                  		; bl = 01h -> CallBack method
 10876                                  		; edx = Callback service address (virtual)
 10877                                  		; ecx = 0 ; CL = srb value ; not used
 10878                                  		sys	_audio, 0301h, 0, audio_callback_x ; 13/01/2025
   119                              <1> 
   120                              <1> 
   121                              <1> 
   122                              <1> 
   123                              <1>  %if %0 >= 2
   124 00007304 BB01030000          <1>  mov ebx, %2
   125                              <1>  %if %0 >= 3
   126 00007309 B900000000          <1>  mov ecx, %3
   127                              <1>  %if %0 = 4
   128 0000730E BA[AC730000]        <1>  mov edx, %4
   129                              <1>  %endif
   130                              <1>  %endif
   131                              <1>  %endif
   132 00007313 B820000000          <1>  mov eax, %1
   133                              <1> 
   134 00007318 CD40                <1>  int 40h
 10879                                  		; 12/01/2025
 10880                                  		; SRB method (faster than callback method)
 10881                                  		; bl = 0 -> Signal Response Byte method
 10882                                  		; cl = 1 -> SRB set value 
 10883                                  		;     (will be set by audio IRQ service of the kernel)
 10884                                  		; edx = SRB address -one byte data-
 10885                                  		;sys	_audio, 0300h, 1, srb	
 10886 0000731A 7201                    		jc	short .init_err
 10887 0000731C C3                      		retn
 10888                                  .init_err:
 10889 0000731D E92BFBFFFF              		jmp	init_error
 10890                                  
 10891                                  
 10892                                  ; =============== S U B R O U T I N E =======================================
 10893                                  
 10894                                  		; 14/01/2025
 10895                                  		; 13/01/2025
 10896                                  mp3_cast_to_speaker_x:
 10897                                  ; 13/01/2025
 10898                                  %if 0
 10899                                  		; Start	to play
 10900                                  		mov	eax, [mp3_bytes_per_sample]
 10901                                  		;shr	al, 1 ; 8 -> 0, 16 -> 1
 10902                                  		;shl	al, 1 ; 16 -> 2, 8 -> 0
 10903                                  		and	al, 2
 10904                                  		mov	ebx, [mp3_output_num_channels]
 10905                                  		dec	ebx
 10906                                  		or	bl, al
 10907                                  		mov	ecx, [mp3_output_sample_rate]
 10908                                  		mov	bh, 4 ; start to play
 10909                                  %else
 10910                                  		; 48 kHZ, 16bit, stereo
 10911 00007322 BB03040000              		mov	ebx, 0403h
 10912 00007327 B980BB0000              		mov	ecx, 48000
 10913                                  		; 14/01/2025
 10914 0000732C 803D[31A20000]01        		cmp	byte [vra], 1
 10915 00007333 7206                    		jb	short short .jmpto@
 10916 00007335 8B0D[7CB20000]          		mov	ecx, [mp3_output_sample_rate] 
 10917                                  .jmpto@:
 10918                                  %endif
 10919 0000733B E977FBFFFF              		jmp	mp3_cast_to_speaker_@
 10920                                  
 10921                                  
 10922                                  ; =============== S U B R O U T I N E =======================================
 10923                                  
 10924                                  		; 15/01/2025
 10925                                  		; 13/01/2025
 10926                                  try_enqueue_all_blocks_x:
 10927                                  		; 12/01/2025
 10928 00007340 60                      		pusha
 10929 00007341 BF[00500500]             		mov	edi, decoding_buffer
 10930                                  		; 15/01/2025
 10931                                  		;jmp	try_enqueue_all_blocks_@
 10932 00007346 EB15                    		jmp	short .first_block
 10933                                  
 10934                                  		; 15/01/2025
 10935                                  .next_block:
 10936 00007348 833D[B0410500]00                        cmp	dword [bytes_left], 0
 10937 0000734F 7E4F                                    jle	short .enqueue_done
 10938                                  		;
 10939 00007351 8B3D[3C090100]          		mov	edi, [mp3_samples_dst]
 10940 00007357 033D[40090100]          		add	edi, [mp3_samples_output_size]
 10941                                  
 10942                                  ;try_enqueue_all_blocks_@:
 10943                                  .first_block:
 10944                                  		;pusha
 10945 0000735D 8B35[AC410500]          		mov	esi, [stream_pos]
 10946 00007363 8B0D[B0410500]          		mov	ecx, [bytes_left]
 10947 00007369 31ED                    		xor	ebp, ebp
 10948 0000736B E819EFFFFF              		call	mp3_decode_frame
 10949                                  		;popa
 10950 00007370 722E                    		jc	short .enqueue_done
 10951                                  
 10952 00007372 A1[50B20000]            		mov	eax, [mp3_src_frame_size]
 10953 00007377 83F800                  		cmp	eax, 0
 10954 0000737A 7424                    		jz	short .enqueue_done
 10955 0000737C 0105[AC410500]          		add	[stream_pos], eax
 10956 00007382 2905[B0410500]          		sub	[bytes_left], eax
 10957                                  
 10958 00007388 A1[40090100]            		mov	eax, [mp3_samples_output_size]
 10959 0000738D 83F800                  		cmp	eax, 0
 10960 00007390 74B6                    		jz	short .next_block
 10961                                  
 10962                                  		; 15/01/2025
 10963 00007392 FF15[3CA20000]          		call	dword [conversion]
 10964                                  .no_error:
 10965                                  		; 15/01/2025
 10966 00007398 FE05[DC990000]          		inc	byte [num_enqueued_frames]
 10967                                  .rtn:
 10968                                  		; 12/01/2025
 10969 0000739E 61                      		popa
 10970 0000739F C3                      		retn
 10971                                  .enqueue_done:
 10972 000073A0 C705[B0410500]0000-                     mov	dword [bytes_left], 0
 10972 000073A8 0000               
 10973                                  		; 12/01/2025
 10974 000073AA EBF2                    		jmp	short .rtn
 10975                                  
 10976                                  
 10977                                  ; =============== S U B R O U T I N E =======================================
 10978                                  
 10979                                  		; 13/01/2025
 10980                                  audio_callback_x:
 10981                                  		; Operating system has directed CPU here because of
 10982                                  		; user (2nd) stage of the audio hardware interrupt service.
 10983                                  		; This procedure must be short and return to operating
 10984                                  		; system again via sysrelease system call
 10985                                  		; (or any system call here will be handled as sysrelease).
 10986                                  
 10987 000073AC C605[34A20000]01        		mov	byte [srb], 1
 10988                                  
 10989 000073B3 E888FFFFFF              		call	try_enqueue_all_blocks_x
 10990                                  
 10991                                  		; 15/01/2025
 10992                                  		;call	dword [conversion]
 10993                                  
 10994                                  		sys	_rele ; return from callback service 
   119                              <1> 
   120                              <1> 
   121                              <1> 
   122                              <1> 
   123                              <1>  %if %0 >= 2
   124                              <1>  mov ebx, %2
   125                              <1>  %if %0 >= 3
   126                              <1>  mov ecx, %3
   127                              <1>  %if %0 = 4
   128                              <1>  mov edx, %4
   129                              <1>  %endif
   130                              <1>  %endif
   131                              <1>  %endif
   132 000073B8 B827000000          <1>  mov eax, %1
   133                              <1> 
   134 000073BD CD40                <1>  int 40h
 10995                                  		
 10996                                  		; we must not come here !
 10997 000073BF BBFFFFFFFF              		mov	ebx, -1
 10998                                  		sys	_exit
   119                              <1> 
   120                              <1> 
   121                              <1> 
   122                              <1> 
   123                              <1>  %if %0 >= 2
   124                              <1>  mov ebx, %2
   125                              <1>  %if %0 >= 3
   126                              <1>  mov ecx, %3
   127                              <1>  %if %0 = 4
   128                              <1>  mov edx, %4
   129                              <1>  %endif
   130                              <1>  %endif
   131                              <1>  %endif
   132 000073C4 B801000000          <1>  mov eax, %1
   133                              <1> 
   134 000073C9 CD40                <1>  int 40h
 10999                                  		;jmp	short audio_callback
 11000                                  
 11001                                  
 11002                                  ; ---------------------------------------------------------------------------
 11003                                  ; 13/01/2025 - Interpolation procedures for non-VRA AC97 codecs
 11004                                  ; ---------------------------------------------------------------------------
 11005                                  ; ref: playwav9.s - 18/12/2025
 11006                                  
 11007                                  
 11008                                  ; 13/01/2025
 11009                                  ; --------------------------------------------------------
 11010                                  ; 48 kHZ conversion procedures
 11011                                  ; --------------------------------------------------------
 11012                                  ; convert_to_stereo: convert 16bit mono samples to 16bit stereo
 11013                                  ; convert_to_16bit: convert 8bit stereo samples to 16bit stereo	
 11014                                  ; convert_to_stereo_16bit: convert 8bit mono samples to 16bit & stereo
 11015                                  ; [loadsize] = decoding buffer size
 11016                                  ; [buffer_size] = wav output buffer size (<= 64KB)
 11017                                  
 11018                                  ; /////
 11019                                  
 11020                                  	; 13/01/2025
 11021                                  convert_to_stereo:
 11022 000073CB BE[00500500]            	mov	esi, decoding_buffer ; (contains 16bit mono samples)
 11023 000073D0 BF[00D00500]            	mov	edi, sample_buffer ; wav output buffer
 11024 000073D5 8B0D[40A20000]          	mov	ecx, [loadsize]
 11025 000073DB D1E9                    	shr	ecx, 1 ; word count
 11026                                  cts_1:
 11027 000073DD 66AD                    	lodsw
 11028 000073DF 66AB                    	stosw	; left channel
 11029 000073E1 66AB                    	stosw	; right channel
 11030 000073E3 E2F8                    	loop	cts_1
 11031                                  cts_2:
 11032                                  	; padfill
 11033 000073E5 8B0D[38A20000]          	mov	ecx, [buffer_size] 
 11034 000073EB 81C1[00D00500]          	add	ecx, sample_buffer
 11035 000073F1 29F9                    	sub	ecx, edi
 11036 000073F3 7604                    	jna	short cts_3
 11037 000073F5 31C0                    	xor	eax, eax
 11038 000073F7 F3AA                    	rep	stosb
 11039                                  cts_3:
 11040 000073F9 C3                      	retn
 11041                                  
 11042                                  ; /////
 11043                                  
 11044                                  	; 13/01/2025
 11045                                  convert_to_16bit:
 11046 000073FA BE[00500500]            	mov	esi, decoding_buffer ; (contains 8bit stereo samples)
 11047 000073FF BF[00D00500]            	mov	edi, sample_buffer ; wav output buffer
 11048 00007404 8B0D[40A20000]          	mov	ecx, [loadsize]
 11049                                  ct16b_1:
 11050                                  	; stereo & 8 bit
 11051 0000740A AC                      	lodsb
 11052 0000740B 2C80                    	sub	al, 80h ; 08/11/2023
 11053 0000740D C1E008                  	shl	eax, 8 ; convert 8 bit sample to 16 bit sample
 11054 00007410 66AB                    	stosw
 11055 00007412 E2F6                    	loop	ct16b_1
 11056 00007414 EBCF                    	jmp	short cts_2
 11057                                  
 11058                                  ; /////
 11059                                  
 11060                                  	; 13/01/2025
 11061                                  convert_to_stereo_16bit:
 11062 00007416 BE[00500500]            	mov	esi, decoding_buffer ; (contains 8bit mono samples)
 11063 0000741B BF[00D00500]            	mov	edi, sample_buffer ; wav output buffer
 11064 00007420 8B0D[40A20000]          	mov	ecx, [loadsize]
 11065                                  cts16b_1:
 11066                                  	; mono & 8 bit
 11067 00007426 AC                      	lodsb
 11068 00007427 2C80                    	sub	al, 80h ; 08/11/2023
 11069 00007429 C1E008                  	shl	eax, 8 ; convert 8 bit sample to 16 bit sample
 11070 0000742C 66AB                    	stosw	; left channel
 11071 0000742E 66AB                    	stosw	; right channel
 11072 00007430 E2F4                    	loop	cts16b_1
 11073 00007432 EBB1                    	jmp	short cts_2
 11074                                  
 11075                                  ; /////
 11076                                  
 11077                                  ; --------------------------------------------------------
 11078                                  ; 13/01/2025
 11079                                  ; --------------------------------------------------------
 11080                                  
 11081                                  ; 13/01/2025 - mp3player modifications (mp3play3.s)
 11082                                  ; 07/12/2024 - playwav9.s
 11083                                  ; 01/12/2024 - ac97play.s
 11084                                  ; 29/05/2024
 11085                                  ; 26/11/2023
 11086                                  ; 25/11/2023 - playwav6.s (32 bit registers, TRDOS 386 adaption)
 11087                                  ; 15/11/2023 - PLAYWAV5.COM, ich_wav5.asm
 11088                                  ; 14/11/2023
 11089                                  ; 13/11/2023 - Erdogan Tan - (VRA, sample rate conversion)
 11090                                  ; --------------------------------------------------------
 11091                                  
 11092                                  ;;Note:	At the end of every buffer load,
 11093                                  ;;	during buffer switch/swap, there will be discontinuity
 11094                                  ;;	between the last converted sample and the 1st sample
 11095                                  ;;	of the next buffer.
 11096                                  ;;	(like as a dot noises vaguely between normal sound samples)
 11097                                  ;;	-To avoid this defect, the 1st sample of
 11098                                  ;;	the next buffer may be read from the wav file but
 11099                                  ;;	the file pointer would need to be set to 1 sample back
 11100                                  ;;	again via seek system call. Time comsumption problem! -
 11101                                  ;;
 11102                                  ;;	Erdogan Tan - 15/11/2023
 11103                                  ;;
 11104                                  ;;	((If entire wav data would be loaded at once.. conversion
 11105                                  ;;	defect/noise would disappear.. but for DOS, to keep
 11106                                  ;;	64KB buffer limit is important also it is important
 11107                                  ;;	for running under 1MB barrier without HIMEM.SYS or DPMI.
 11108                                  ;;	I have tested this program by using 2-30MB wav files.))
 11109                                  ;;
 11110                                  ;;	Test Computer:	ASUS desktop/mainboard, M2N4-SLI, 2010.
 11111                                  ;;			AMD Athlon 64 X2 2200 MHZ CPU.
 11112                                  ;;		       	NFORCE4 (CK804) AC97 audio hardware.
 11113                                  ;;			Realtek ALC850 codec.
 11114                                  ;;		       	Retro DOS v4.2 (MSDOS 6.22) operating system.
 11115                                  
 11116                                  load_8khz_mono_8_bit:
 11117                                  	; 13/01/2025 (mp3play3.s)
 11118 00007434 BE[00500500]            	mov	esi, decoding_buffer ; (contains 8bit stereo samples)
 11119 00007439 BF[00D00500]            	mov	edi, sample_buffer ; wav output buffer
 11120 0000743E 8B0D[40A20000]          	mov	ecx, [loadsize]
 11121                                  	; 13/01/2025
 11122                                  lff8m_1:
 11123 00007444 AC                      	lodsb
 11124 00007445 A2[12860000]            	mov	[previous_val], al
 11125 0000744A 2C80                    	sub	al, 80h
 11126 0000744C 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
 11127 00007450 66AB                    	stosw		; original sample (left channel)
 11128 00007452 66AB                    	stosw		; original sample (right channel)
 11129                                  	;xor	eax, eax
 11130 00007454 B080                    	mov	al, 80h
 11131 00007456 49                      	dec	ecx
 11132 00007457 7402                    	jz	short lff8m_2
 11133 00007459 8A06                    	mov	al, [esi]
 11134                                  lff8m_2:
 11135                                  	;mov	[next_val], ax
 11136 0000745B 88C7                    	mov	bh, al	; [next_val]
 11137 0000745D 8A25[12860000]          	mov	ah, [previous_val]
 11138 00007463 00E0                    	add	al, ah	; [previous_val]
 11139 00007465 D0D8                    	rcr	al, 1
 11140 00007467 88C2                    	mov	dl, al	; this is interpolated middle (3th) sample
 11141 00007469 00E0                    	add	al, ah	; [previous_val]
 11142 0000746B D0D8                    	rcr	al, 1	
 11143 0000746D 88C3                    	mov	bl, al 	; this is temporary interpolation value
 11144 0000746F 00E0                    	add	al, ah	; [previous_val]
 11145 00007471 D0D8                    	rcr	al, 1
 11146 00007473 2C80                    	sub	al, 80h
 11147 00007475 66C1E008                	shl	ax, 8	
 11148 00007479 66AB                    	stosw		; this is 1st interpolated sample (L)
 11149 0000747B 66AB                    	stosw		; this is 1st interpolated sample (R)
 11150 0000747D 88D8                    	mov	al, bl
 11151 0000747F 00D0                    	add	al, dl
 11152 00007481 D0D8                    	rcr	al, 1
 11153 00007483 2C80                    	sub	al, 80h
 11154 00007485 66C1E008                	shl	ax, 8
 11155 00007489 66AB                    	stosw		; this is 2nd interpolated sample (L)
 11156 0000748B 66AB                    	stosw		; this is 2nd interpolated sample (R)
 11157 0000748D 88D0                    	mov	al, dl
 11158 0000748F 2C80                    	sub	al, 80h
 11159 00007491 66C1E008                	shl	ax, 8
 11160 00007495 66AB                    	stosw		; this is middle (3th) interpolated sample (L)
 11161 00007497 66AB                    	stosw		; this is middle (3th) interpolated sample (R)
 11162                                  	;mov	al, [next_val]
 11163 00007499 88F8                    	mov	al, bh
 11164 0000749B 00D0                    	add	al, dl
 11165 0000749D D0D8                    	rcr	al, 1
 11166 0000749F 88C3                    	mov	bl, al	; this is temporary interpolation value
 11167 000074A1 00D0                    	add	al, dl
 11168 000074A3 D0D8                    	rcr	al, 1
 11169 000074A5 2C80                    	sub	al, 80h
 11170 000074A7 66C1E008                	shl	ax, 8
 11171 000074AB 66AB                    	stosw		; this is 4th interpolated sample (L)
 11172 000074AD 66AB                    	stosw		; this is 4th interpolated sample (R)
 11173                                  	;mov	al, [next_val]
 11174 000074AF 88F8                    	mov	al, bh
 11175 000074B1 00D8                    	add	al, bl
 11176 000074B3 D0D8                    	rcr	al, 1
 11177 000074B5 2C80                    	sub	al, 80h
 11178 000074B7 66C1E008                	shl	ax, 8
 11179 000074BB 66AB                    	stosw		; this is 5th interpolated sample (L)
 11180 000074BD 66AB                    	stosw		; this is 5th interpolated sample (R)
 11181                                  	; 8 kHZ mono to 48 kHZ stereo conversion of the sample is OK
 11182 000074BF 09C9                    	or	ecx, ecx
 11183 000074C1 7581                    	jnz	short lff8m_1
 11184                                  
 11185                                  	; --------------
 11186                                  
 11187                                  lff8s_3:
 11188                                  lff8m_3:
 11189                                  lff8s2_3:
 11190                                  lff8m2_3:
 11191                                  lff16s_3:
 11192                                  lff16m_3:
 11193                                  lff16s2_3:
 11194                                  lff16m2_3:
 11195                                  lff24_3:
 11196                                  lff32_3:
 11197                                  lff44_3:
 11198                                  lff22_3:
 11199                                  lff11_3:
 11200                                  	; 08/12/2024 (BugFix)
 11201                                  	; 31/05/2024 (BugFix)
 11202 000074C3 8B0D[38A20000]          	mov	ecx, [buffer_size] ; 16 bit (48 kHZ, stereo) samples
 11203                                  	;shl	ecx, 1	; byte count ; Bug !
 11204                                  	; 08/12/2024
 11205                                  	;add	ecx, audio_buffer
 11206                                  	; 13/01/2025 (mp3play3.s)
 11207 000074C9 81C1[00D00500]          	add	ecx, sample_buffer
 11208 000074CF 29F9                    	sub	ecx, edi
 11209 000074D1 7609                    	jna	short lff8m_4 ; jbe
 11210 000074D3 29F9                    	sub	ecx, edi
 11211                                  	;inc	ecx
 11212 000074D5 C1E902                  	shr	ecx, 2
 11213 000074D8 31C0                    	xor	eax, eax ; fill (remain part of) buffer with zeros
 11214 000074DA F3AB                    	rep	stosd
 11215                                  lff8m_4:
 11216                                  	; 31/05/2024 (BugFix)
 11217                                  	; cf=1 ; Bug !
 11218                                  	; 08/12/2024
 11219                                  	;clc
 11220 000074DC C3                      	retn
 11221                                  
 11222                                  ; --------------------------------------------------------
 11223                                  
 11224                                  load_8khz_stereo_8_bit:
 11225                                  	; 13/01/2025 (mp3play3.s)
 11226 000074DD BE[00500500]            	mov	esi, decoding_buffer ; (contains 8bit stereo samples)
 11227 000074E2 BF[00D00500]            	mov	edi, sample_buffer ; wav output buffer
 11228 000074E7 8B0D[40A20000]          	mov	ecx, [loadsize]
 11229                                  	; 13/01/2025
 11230 000074ED D1E9                    	shr	ecx, 1	; word count
 11231                                  lff8s_1:
 11232 000074EF AC                      	lodsb
 11233 000074F0 A2[12860000]            	mov	[previous_val_l], al
 11234 000074F5 2C80                    	sub	al, 80h
 11235 000074F7 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
 11236 000074FB 66AB                    	stosw		; original sample (L)
 11237 000074FD AC                      	lodsb
 11238 000074FE A2[14860000]            	mov	[previous_val_r], al
 11239 00007503 2C80                    	sub	al, 80h
 11240 00007505 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
 11241 00007509 66AB                    	stosw		; original sample (R)
 11242                                  
 11243                                  	;xor	eax, eax
 11244 0000750B 66B88080                	mov	ax, 8080h
 11245 0000750F 49                      	dec	ecx
 11246 00007510 7403                    	jz	short lff8s_2
 11247                                  		; convert 8 bit sample to 16 bit sample
 11248 00007512 668B06                  	mov	ax, [esi]
 11249                                  lff8s_2:
 11250 00007515 A2[16860000]            	mov	[next_val_l], al
 11251 0000751A 8825[18860000]          	mov	[next_val_r], ah
 11252 00007520 8A25[12860000]          	mov	ah, [previous_val_l]
 11253 00007526 00E0                    	add	al, ah
 11254 00007528 D0D8                    	rcr	al, 1
 11255 0000752A 88C2                    	mov	dl, al	; this is interpolated middle (3th) sample (L)
 11256 0000752C 00E0                    	add	al, ah
 11257 0000752E D0D8                    	rcr	al, 1
 11258 00007530 88C3                    	mov	bl, al	; this is temporary interpolation value (L)
 11259 00007532 00E0                    	add	al, ah
 11260 00007534 D0D8                    	rcr	al, 1
 11261 00007536 2C80                    	sub	al, 80h
 11262 00007538 66C1E008                	shl	ax, 8
 11263 0000753C 66AB                    	stosw		; this is 1st interpolated sample (L)
 11264 0000753E A0[18860000]            	mov	al, [next_val_r]
 11265 00007543 8A25[14860000]          	mov	ah, [previous_val_r]
 11266 00007549 00E0                    	add	al, ah
 11267 0000754B D0D8                    	rcr	al, 1
 11268 0000754D 88C6                    	mov	dh, al	; this is interpolated middle (3th) sample (R)
 11269 0000754F 00E0                    	add	al, ah
 11270 00007551 D0D8                    	rcr	al, 1
 11271 00007553 88C7                    	mov	bh, al	; this is temporary interpolation value (R)
 11272 00007555 00E0                    	add	al, ah
 11273 00007557 D0D8                    	rcr	al, 1
 11274 00007559 2C80                    	sub	al, 80h
 11275 0000755B 66C1E008                	shl	ax, 8
 11276 0000755F 66AB                    	stosw		; this is 1st interpolated sample (R)
 11277 00007561 88D8                    	mov	al, bl
 11278 00007563 00D0                    	add	al, dl
 11279 00007565 D0D8                    	rcr	al, 1
 11280 00007567 2C80                    	sub	al, 80h
 11281 00007569 66C1E008                	shl	ax, 8
 11282 0000756D 66AB                    	stosw		; this is 2nd interpolated sample (L)
 11283 0000756F 88F8                    	mov	al, bh
 11284 00007571 00F0                    	add	al, dh
 11285 00007573 D0D8                    	rcr	al, 1
 11286 00007575 2C80                    	sub	al, 80h
 11287 00007577 66C1E008                	shl	ax, 8
 11288 0000757B 66AB                    	stosw 		; this is 2nd interpolated sample (R)
 11289 0000757D 88D0                    	mov	al, dl
 11290 0000757F 2C80                    	sub	al, 80h
 11291 00007581 66C1E008                	shl	ax, 8
 11292 00007585 66AB                    	stosw		; this is middle (3th) interpolated sample (L)
 11293 00007587 88F0                    	mov	al, dh
 11294 00007589 2C80                    	sub	al, 80h
 11295 0000758B 66C1E008                	shl	ax, 8
 11296 0000758F 66AB                    	stosw		; this is middle (3th) interpolated sample (R)
 11297 00007591 A0[16860000]            	mov	al, [next_val_l]
 11298 00007596 00D0                    	add	al, dl
 11299 00007598 D0D8                    	rcr	al, 1
 11300 0000759A 88C3                    	mov	bl, al	; this is temporary interpolation value (L)
 11301 0000759C 00D0                    	add	al, dl
 11302 0000759E D0D8                    	rcr	al, 1
 11303 000075A0 2C80                    	sub	al, 80h
 11304 000075A2 66C1E008                	shl	ax, 8
 11305 000075A6 66AB                    	stosw		; this is 4th interpolated sample (L)
 11306 000075A8 A0[18860000]            	mov	al, [next_val_r]
 11307 000075AD 00F0                    	add	al, dh
 11308 000075AF D0D8                    	rcr	al, 1
 11309 000075B1 88C7                    	mov	bh, al	; this is temporary interpolation value (R)
 11310 000075B3 00F0                    	add	al, dh
 11311 000075B5 D0D8                    	rcr	al, 1
 11312 000075B7 2C80                    	sub	al, 80h
 11313 000075B9 66C1E008                	shl	ax, 8
 11314 000075BD 66AB                    	stosw		; this is 4th interpolated sample (R)
 11315 000075BF A0[16860000]            	mov	al, [next_val_l]
 11316 000075C4 00D8                    	add	al, bl
 11317 000075C6 D0D8                    	rcr	al, 1
 11318 000075C8 2C80                    	sub	al, 80h
 11319 000075CA 66C1E008                	shl	ax, 8
 11320 000075CE 66AB                    	stosw		; this is 5th interpolated sample (L)
 11321 000075D0 A0[18860000]            	mov	al, [next_val_r]
 11322 000075D5 00F8                    	add	al, bh
 11323 000075D7 D0D8                    	rcr	al, 1
 11324 000075D9 2C80                    	sub	al, 80h
 11325 000075DB 66C1E008                	shl	ax, 8
 11326 000075DF 66AB                    	stosw		; this is 5th interpolated sample (R)
 11327                                  	; 8 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
 11328 000075E1 E305                    	jecxz	lff8s_6
 11329 000075E3 E907FFFFFF              	jmp	lff8s_1
 11330                                  lff8s_6:
 11331 000075E8 E9D6FEFFFF              	jmp	lff8s_3
 11332                                  
 11333                                  ; --------------------------------------------------------
 11334                                  
 11335                                  load_8khz_mono_16_bit:
 11336                                  	; 13/01/2025 (mp3play3.s)
 11337 000075ED BE[00500500]            	mov	esi, decoding_buffer ; (contains 8bit stereo samples)
 11338 000075F2 BF[00D00500]            	mov	edi, sample_buffer ; wav output buffer
 11339 000075F7 8B0D[40A20000]          	mov	ecx, [loadsize]
 11340                                  	; 13/01/2025
 11341 000075FD D1E9                    	shr	ecx, 1	; word count
 11342                                  lff8m2_1:
 11343 000075FF 66AD                    	lodsw
 11344 00007601 66AB                    	stosw		; original sample (left channel)
 11345 00007603 66AB                    	stosw		; original sample (right channel)
 11346 00007605 80C480                  	add	ah, 80h	; convert sound level to 0-65535 format
 11347 00007608 66A3[12860000]          	mov	[previous_val], ax
 11348 0000760E 31C0                    	xor	eax, eax
 11349 00007610 49                      	dec	ecx
 11350 00007611 7403                    	jz	short lff8m2_2
 11351 00007613 668B06                  	mov	ax, [esi]
 11352                                  lff8m2_2:
 11353 00007616 80C480                  	add	ah, 80h ; convert sound level to 0-65535 format
 11354 00007619 89C5                    	mov	ebp, eax	; [next_val]
 11355 0000761B 660305[12860000]        	add	ax, [previous_val]
 11356 00007622 66D1D8                  	rcr	ax, 1
 11357 00007625 89C2                    	mov	edx, eax ; this is interpolated middle (3th) sample
 11358 00007627 660305[12860000]        	add	ax, [previous_val]
 11359 0000762E 66D1D8                  	rcr	ax, 1	; this is temporary interpolation value
 11360 00007631 89C3                    	mov	ebx, eax 		
 11361 00007633 660305[12860000]        	add	ax, [previous_val]
 11362 0000763A 66D1D8                  	rcr	ax, 1
 11363 0000763D 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
 11364 00007640 66AB                    	stosw		; this is 1st interpolated sample (L)
 11365 00007642 66AB                    	stosw		; this is 1st interpolated sample (R)
 11366 00007644 89D8                    	mov	eax, ebx
 11367 00007646 6601D0                  	add	ax, dx
 11368 00007649 66D1D8                  	rcr	ax, 1
 11369 0000764C 80EC80                  	sub	ah, 80h
 11370 0000764F 66AB                    	stosw		; this is 2nd interpolated sample (L)
 11371 00007651 66AB                    	stosw		; this is 2nd interpolated sample (R)
 11372 00007653 89D0                    	mov	eax, edx
 11373 00007655 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
 11374 00007658 66AB                    	stosw		; this is middle (3th) interpolated sample (L)
 11375 0000765A 66AB                    	stosw		; this is middle (3th) interpolated sample (R)
 11376 0000765C 89E8                    	mov	eax, ebp
 11377 0000765E 6601D0                  	add	ax, dx
 11378 00007661 66D1D8                  	rcr	ax, 1
 11379 00007664 89C3                    	mov	ebx, eax ; this is temporary interpolation value
 11380 00007666 6601D0                  	add	ax, dx
 11381 00007669 66D1D8                  	rcr	ax, 1
 11382 0000766C 80EC80                  	sub	ah, 80h
 11383 0000766F 66AB                    	stosw		; this is 4th interpolated sample (L)
 11384 00007671 66AB                    	stosw		; this is 4th interpolated sample (R)
 11385 00007673 89E8                    	mov	eax, ebp
 11386 00007675 6601D8                  	add	ax, bx
 11387 00007678 66D1D8                  	rcr	ax, 1
 11388 0000767B 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
 11389 0000767E 66AB                    	stosw		; this is 5th interpolated sample (L)
 11390 00007680 66AB                    	stosw		; this is 5th interpolated sample (R)
 11391                                  	; 8 kHZ mono to 48 kHZ stereo conversion of the sample is OK
 11392 00007682 09C9                    	or	ecx, ecx
 11393 00007684 0F8575FFFFFF            	jnz	lff8m2_1
 11394 0000768A E934FEFFFF              	jmp	lff8m2_3
 11395                                  
 11396                                  ; --------------------------------------------------------
 11397                                  
 11398                                  load_8khz_stereo_16_bit:
 11399                                  	; 13/01/2025 (mp3play3.s)
 11400 0000768F BE[00500500]            	mov	esi, decoding_buffer ; (contains 8bit stereo samples)
 11401 00007694 BF[00D00500]            	mov	edi, sample_buffer ; wav output buffer
 11402 00007699 8B0D[40A20000]          	mov	ecx, [loadsize]
 11403                                  	; 13/01/2025
 11404 0000769F C1E902                  	shr	ecx, 2	; dword count
 11405                                  lff8s2_1:
 11406 000076A2 66AD                    	lodsw
 11407 000076A4 66AB                    	stosw		; original sample (L)
 11408                                  	; 15/11/2023
 11409 000076A6 80C480                  	add	ah, 80h	; convert sound level to 0-65535 format
 11410 000076A9 66A3[12860000]          	mov	[previous_val_l], ax
 11411 000076AF 66AD                    	lodsw
 11412 000076B1 66AB                    	stosw		; original sample (R)
 11413 000076B3 80C480                  	add	ah, 80h	; convert sound level to 0-65535 format
 11414 000076B6 66A3[14860000]          	mov	[previous_val_r], ax
 11415 000076BC 31D2                    	xor	edx, edx
 11416 000076BE 31C0                    	xor	eax, eax
 11417                                  	; 16/11/2023
 11418 000076C0 49                      	dec	ecx
 11419 000076C1 7407                    	jz	short lff8s2_2
 11420 000076C3 668B06                  	mov	ax, [esi]
 11421 000076C6 668B5602                	mov	dx, [esi+2]
 11422                                  lff8s2_2:
 11423 000076CA 80C480                  	add	ah, 80h	; convert sound level to 0-65535 format
 11424 000076CD 66A3[16860000]          	mov	[next_val_l], ax
 11425 000076D3 80C680                  	add	dh, 80h	; convert sound level to 0-65535 format
 11426 000076D6 668915[18860000]        	mov	[next_val_r], dx
 11427 000076DD 660305[12860000]        	add	ax, [previous_val_l]
 11428 000076E4 66D1D8                  	rcr	ax, 1
 11429 000076E7 89C2                    	mov	edx, eax ; this is interpolated middle (3th) sample (L)
 11430 000076E9 660305[12860000]        	add	ax, [previous_val_l]
 11431 000076F0 66D1D8                  	rcr	ax, 1	
 11432 000076F3 89C3                    	mov	ebx, eax ; this is temporary interpolation value (L)
 11433 000076F5 660305[12860000]        	add	ax, [previous_val_l]
 11434 000076FC 66D1D8                  	rcr	ax, 1
 11435 000076FF 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
 11436 00007702 66AB                    	stosw		; this is 1st interpolated sample (L)
 11437 00007704 66A1[18860000]          	mov	ax, [next_val_r]
 11438 0000770A 660305[14860000]        	add	ax, [previous_val_r]
 11439 00007711 66D1D8                  	rcr	ax, 1
 11440 00007714 89C5                    	mov	ebp, eax ; this is interpolated middle (3th) sample (R)
 11441 00007716 660305[14860000]        	add	ax, [previous_val_r]
 11442 0000771D 66D1D8                  	rcr	ax, 1
 11443 00007720 50                      	push	eax ; *	; this is temporary interpolation value (R)
 11444 00007721 660305[14860000]        	add	ax, [previous_val_r]
 11445 00007728 66D1D8                  	rcr	ax, 1
 11446 0000772B 80EC80                  	sub	ah, 80h
 11447 0000772E 66AB                    	stosw		; this is 1st interpolated sample (R)
 11448 00007730 89D8                    	mov	eax, ebx
 11449 00007732 6601D0                  	add	ax, dx
 11450 00007735 66D1D8                  	rcr	ax, 1
 11451 00007738 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
 11452 0000773B 66AB                    	stosw		; this is 2nd interpolated sample (L)
 11453 0000773D 58                      	pop	eax ; *
 11454 0000773E 6601E8                  	add	ax, bp
 11455 00007741 66D1D8                  	rcr	ax, 1
 11456 00007744 80EC80                  	sub	ah, 80h
 11457 00007747 66AB                    	stosw 		; this is 2nd interpolated sample (R)
 11458 00007749 89D0                    	mov	eax, edx
 11459 0000774B 80EC80                  	sub	ah, 80h
 11460 0000774E 66AB                    	stosw		; this is middle (3th) interpolated sample (L)
 11461 00007750 89E8                    	mov	eax, ebp
 11462 00007752 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
 11463 00007755 66AB                    	stosw		; this is middle (3th) interpolated sample (R)
 11464 00007757 66A1[16860000]          	mov	ax, [next_val_l]
 11465 0000775D 6601D0                  	add	ax, dx
 11466 00007760 66D1D8                  	rcr	ax, 1
 11467 00007763 89C3                    	mov	ebx, eax ; this is temporary interpolation value (L)
 11468 00007765 6601D0                  	add	ax, dx
 11469 00007768 66D1D8                  	rcr	ax, 1
 11470 0000776B 80EC80                  	sub	ah, 80h
 11471 0000776E 66AB                    	stosw		; this is 4th interpolated sample (L)
 11472 00007770 66A1[18860000]          	mov	ax, [next_val_r]
 11473 00007776 6601E8                  	add	ax, bp
 11474 00007779 66D1D8                  	rcr	ax, 1
 11475 0000777C 50                      	push	eax ; ** ; this is temporary interpolation value (R)
 11476 0000777D 6601E8                  	add	ax, bp
 11477 00007780 66D1D8                  	rcr	ax, 1
 11478 00007783 80EC80                  	sub	ah, 80h
 11479 00007786 66AB                    	stosw		; this is 4th interpolated sample (R)
 11480 00007788 66A1[16860000]          	mov	ax, [next_val_l]
 11481 0000778E 6601D8                  	add	ax, bx
 11482 00007791 66D1D8                  	rcr	ax, 1
 11483 00007794 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
 11484 00007797 66AB                    	stosw		; this is 5th interpolated sample (L)
 11485 00007799 58                      	pop	eax ; **
 11486 0000779A 660305[18860000]        	add	ax, [next_val_r]
 11487 000077A1 66D1D8                  	rcr	ax, 1
 11488 000077A4 80EC80                  	sub	ah, 80h
 11489 000077A7 66AB                    	stosw		; this is 5th interpolated sample (R)
 11490                                  	; 8 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
 11491 000077A9 E305                    	jecxz	lff8_s2_9
 11492 000077AB E9F2FEFFFF              	jmp	lff8s2_1
 11493                                  lff8_s2_9:
 11494 000077B0 E90EFDFFFF              	jmp	lff8s2_3
 11495                                  
 11496                                  ; --------------------------------------------------------
 11497                                  
 11498                                  load_16khz_mono_8_bit:
 11499                                  	; 13/01/2025 (mp3play3.s)
 11500 000077B5 BE[00500500]            	mov	esi, decoding_buffer ; (contains 8bit stereo samples)
 11501 000077BA BF[00D00500]            	mov	edi, sample_buffer ; wav output buffer
 11502 000077BF 8B0D[40A20000]          	mov	ecx, [loadsize]
 11503                                  	; 13/01/2025
 11504                                  lff16m_1:
 11505 000077C5 AC                      	lodsb
 11506                                  	;mov	[previous_val], al
 11507 000077C6 88C3                    	mov	bl, al
 11508 000077C8 2C80                    	sub	al, 80h
 11509 000077CA 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
 11510 000077CE 66AB                    	stosw		; original sample (left channel)
 11511 000077D0 66AB                    	stosw		; original sample (right channel)
 11512                                  	;xor	ax, ax
 11513                                  	; 14/11/22023
 11514 000077D2 B080                    	mov	al, 80h
 11515 000077D4 49                      	dec	ecx
 11516 000077D5 7402                    	jz	short lff16m_2
 11517 000077D7 8A06                    	mov	al, [esi]
 11518                                  lff16m_2:
 11519                                  	;mov	[next_val], al
 11520 000077D9 88C7                    	mov	bh, al
 11521                                  	;add	al, [previous_val]
 11522 000077DB 00D8                    	add	al, bl
 11523 000077DD D0D8                    	rcr	al, 1
 11524 000077DF 88C2                    	mov	dl, al	; this is interpolated middle (temp) sample
 11525                                  	;add	al, [previous_val]
 11526 000077E1 00D8                    	add	al, bl
 11527 000077E3 D0D8                    	rcr	al, 1
 11528 000077E5 2C80                    	sub	al, 80h
 11529 000077E7 66C1E008                	shl	ax, 8
 11530 000077EB 66AB                    	stosw		; this is 1st interpolated sample (L)
 11531 000077ED 66AB                    	stosw		; this is 1st interpolated sample (R)
 11532                                  	;mov	al, [next_val]
 11533 000077EF 88F8                    	mov	al, bh
 11534 000077F1 00D0                    	add	al, dl
 11535 000077F3 D0D8                    	rcr	al, 1
 11536 000077F5 2C80                    	sub	al, 80h
 11537 000077F7 66C1E008                	shl	ax, 8
 11538 000077FB 66AB                    	stosw		; this is 2nd interpolated sample (L)
 11539 000077FD 66AB                    	stosw		; this is 2nd interpolated sample (R)
 11540                                  	
 11541                                  	; 16 kHZ mono to 48 kHZ stereo conversion of the sample is OK
 11542 000077FF 09C9                    	or	ecx, ecx
 11543 00007801 75C2                    	jnz	short lff16m_1
 11544 00007803 E9BBFCFFFF              	jmp	lff16m_3
 11545                                  
 11546                                  ; --------------------------------------------------------
 11547                                  
 11548                                  load_16khz_stereo_8_bit:
 11549                                  	; 13/01/2025 (mp3play3.s)
 11550 00007808 BE[00500500]            	mov	esi, decoding_buffer ; (contains 8bit stereo samples)
 11551 0000780D BF[00D00500]            	mov	edi, sample_buffer ; wav output buffer
 11552 00007812 8B0D[40A20000]          	mov	ecx, [loadsize]
 11553                                  	; 13/01/2025
 11554 00007818 D1E9                    	shr	ecx, 1	; word count
 11555                                  lff16s_1:
 11556 0000781A AC                      	lodsb
 11557 0000781B A2[12860000]            	mov	[previous_val_l], al
 11558 00007820 2C80                    	sub	al, 80h
 11559 00007822 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
 11560 00007826 66AB                    	stosw		; original sample (L)
 11561 00007828 AC                      	lodsb
 11562 00007829 A2[14860000]            	mov	[previous_val_r], al
 11563 0000782E 2C80                    	sub	al, 80h
 11564 00007830 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
 11565 00007834 66AB                    	stosw		; original sample (R)
 11566                                  
 11567                                  	;xor	eax, eax
 11568 00007836 66B88080                	mov	ax, 8080h
 11569 0000783A 49                      	dec	ecx
 11570 0000783B 7403                    	jz	short lff16s_2
 11571                                  		; convert 8 bit sample to 16 bit sample
 11572 0000783D 668B06                  	mov	ax, [esi]
 11573                                  lff16s_2:
 11574                                  	;mov	[next_val_l], al
 11575                                  	;mov	[next_val_r], ah
 11576 00007840 89C3                    	mov	ebx, eax
 11577 00007842 0205[12860000]          	add	al, [previous_val_l]
 11578 00007848 D0D8                    	rcr	al, 1
 11579 0000784A 88C2                    	mov	dl, al	; this is temporary interpolation value (L)
 11580 0000784C 0205[12860000]          	add	al, [previous_val_l]
 11581 00007852 D0D8                    	rcr	al, 1
 11582 00007854 2C80                    	sub	al, 80h
 11583 00007856 66C1E008                	shl	ax, 8
 11584 0000785A 66AB                    	stosw		; this is 1st interpolated sample (L)
 11585 0000785C 88F8                    	mov	al, bh	; [next_val_r]
 11586 0000785E 0205[14860000]          	add	al, [previous_val_r]
 11587 00007864 D0D8                    	rcr	al, 1
 11588 00007866 88C6                    	mov	dh, al	; this is temporary interpolation value (R)
 11589 00007868 0205[14860000]          	add	al, [previous_val_r]
 11590 0000786E D0D8                    	rcr	al, 1
 11591 00007870 2C80                    	sub	al, 80h
 11592 00007872 66C1E008                	shl	ax, 8
 11593 00007876 66AB                    	stosw		; this is 1st interpolated sample (R)
 11594 00007878 88D0                    	mov	al, dl
 11595 0000787A 00D8                    	add	al, bl	; [next_val_l]
 11596 0000787C D0D8                    	rcr	al, 1
 11597 0000787E 2C80                    	sub	al, 80h
 11598 00007880 66C1E008                	shl	ax, 8
 11599 00007884 66AB                    	stosw		; this is 2nd interpolated sample (L)
 11600 00007886 88F0                    	mov	al, dh
 11601 00007888 00F8                    	add	al, bh	; [next_val_r]
 11602 0000788A D0D8                    	rcr	al, 1
 11603 0000788C 2C80                    	sub	al, 80h
 11604 0000788E 66C1E008                	shl	ax, 8
 11605 00007892 66AB                    	stosw 		; this is 2nd interpolated sample (R)
 11606                                  	
 11607                                  	; 16 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
 11608 00007894 09C9                    	or	ecx, ecx
 11609 00007896 7582                    	jnz	short lff16s_1
 11610 00007898 E926FCFFFF              	jmp	lff16s_3
 11611                                  
 11612                                  ; --------------------------------------------------------
 11613                                  
 11614                                  load_16khz_mono_16_bit:
 11615                                  	; 13/01/2025 (mp3play3.s)
 11616 0000789D BE[00500500]            	mov	esi, decoding_buffer ; (contains 8bit stereo samples)
 11617 000078A2 BF[00D00500]            	mov	edi, sample_buffer ; wav output buffer
 11618 000078A7 8B0D[40A20000]          	mov	ecx, [loadsize]
 11619                                  	; 13/01/2025
 11620 000078AD D1E9                    	shr	ecx, 1	; word count
 11621                                  lff16m2_1:
 11622 000078AF 66AD                    	lodsw
 11623 000078B1 66AB                    	stosw		; original sample (left channel)
 11624 000078B3 66AB                    	stosw		; original sample (right channel)
 11625 000078B5 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
 11626                                  	;mov	[previous_val], ax
 11627 000078B8 89C3                    	mov	ebx, eax
 11628 000078BA 31C0                    	xor	eax, eax
 11629 000078BC 49                      	dec	ecx
 11630 000078BD 7403                    	jz	short lff16m2_2
 11631 000078BF 668B06                  	mov	ax, [esi]
 11632                                  lff16m2_2:
 11633 000078C2 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
 11634 000078C5 89C5                    	mov	ebp, eax	; [next_val]
 11635                                  	;add	ax, [previous_val]
 11636 000078C7 6601D8                  	add	ax, bx
 11637 000078CA 66D1D8                  	rcr	ax, 1
 11638 000078CD 89C2                    	mov	edx, eax ; this is temporary interpolation value
 11639                                  	;add	ax, [previous_val]
 11640 000078CF 6601D8                  	add	ax, bx
 11641 000078D2 66D1D8                  	rcr	ax, 1
 11642 000078D5 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
 11643 000078D8 66AB                    	stosw		; this is 1st interpolated sample (L)
 11644 000078DA 66AB                    	stosw		; this is 1st interpolated sample (R)
 11645 000078DC 89E8                    	mov	eax, ebp
 11646 000078DE 6601D0                  	add	ax, dx
 11647 000078E1 66D1D8                  	rcr	ax, 1
 11648 000078E4 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
 11649 000078E7 66AB                    	stosw		; this is 2nd interpolated sample (L)
 11650 000078E9 66AB                    	stosw		; this is 2nd interpolated sample (R)
 11651                                  	; 16 kHZ mono to 48 kHZ stereo conversion of the sample is OK
 11652 000078EB 09C9                    	or	ecx, ecx
 11653 000078ED 75C0                    	jnz	short lff16m2_1
 11654 000078EF E9CFFBFFFF              	jmp	lff16m2_3
 11655                                  
 11656                                  ; --------------------------------------------------------
 11657                                  
 11658                                  load_16khz_stereo_16_bit:
 11659                                  	; 13/01/2025 (mp3play3.s)
 11660 000078F4 BE[00500500]            	mov	esi, decoding_buffer ; (contains 8bit stereo samples)
 11661 000078F9 BF[00D00500]            	mov	edi, sample_buffer ; wav output buffer
 11662 000078FE 8B0D[40A20000]          	mov	ecx, [loadsize]
 11663                                  	; 13/01/2025
 11664 00007904 C1E902                  	shr	ecx, 2	; dword count
 11665                                  lff16s2_1:
 11666 00007907 66AD                    	lodsw
 11667 00007909 66AB                    	stosw		; original sample (L)
 11668 0000790B 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
 11669 0000790E 66A3[12860000]          	mov	[previous_val_l], ax
 11670 00007914 66AD                    	lodsw
 11671 00007916 66AB                    	stosw		; original sample (R)
 11672 00007918 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
 11673 0000791B 66A3[14860000]          	mov	[previous_val_r], ax
 11674 00007921 31D2                    	xor	edx, edx
 11675 00007923 31C0                    	xor	eax, eax
 11676                                  	; 16/11/2023
 11677 00007925 49                      	dec	ecx
 11678 00007926 7407                    	jz	short lff16s2_2
 11679 00007928 668B06                  	mov	ax, [esi]
 11680 0000792B 668B5602                	mov	dx, [esi+2]
 11681                                  lff16s2_2:
 11682 0000792F 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
 11683                                  	;mov	[next_val_l], ax
 11684 00007932 89C5                    	mov	ebp, eax
 11685 00007934 80C680                  	add	dh, 80h	; convert sound level 0 to 65535 format
 11686 00007937 668915[18860000]        	mov	[next_val_r], dx
 11687 0000793E 660305[12860000]        	add	ax, [previous_val_l]
 11688 00007945 66D1D8                  	rcr	ax, 1
 11689 00007948 89C2                    	mov	edx, eax ; this is temporary interpolation value (L)
 11690 0000794A 660305[12860000]        	add	ax, [previous_val_l]
 11691 00007951 66D1D8                  	rcr	ax, 1
 11692 00007954 80EC80                  	sub	ah, 80h ; -32768 to +32767 format again
 11693 00007957 66AB                    	stosw		; this is 1st interpolated sample (L)
 11694 00007959 66A1[18860000]          	mov	ax, [next_val_r]
 11695 0000795F 660305[14860000]        	add	ax, [previous_val_r]
 11696 00007966 66D1D8                  	rcr	ax, 1
 11697 00007969 89C3                    	mov	ebx, eax ; this is temporary interpolation value (R)
 11698 0000796B 660305[14860000]        	add	ax, [previous_val_r]
 11699 00007972 66D1D8                  	rcr	ax, 1
 11700 00007975 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
 11701 00007978 66AB                    	stosw		; this is 1st interpolated sample (R)
 11702                                  	;mov	ax, [next_val_l]
 11703 0000797A 89E8                    	mov	eax, ebp
 11704 0000797C 6601D0                  	add	ax, dx
 11705 0000797F 66D1D8                  	rcr	ax, 1
 11706 00007982 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
 11707 00007985 66AB                    	stosw		; this is 2nd interpolated sample (L)
 11708 00007987 66A1[18860000]          	mov	ax, [next_val_r]
 11709 0000798D 6601D8                  	add	ax, bx
 11710 00007990 66D1D8                  	rcr	ax, 1
 11711 00007993 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
 11712 00007996 66AB                    	stosw 		; this is 2nd interpolated sample (R)
 11713                                  	
 11714                                  	; 16 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
 11715 00007998 09C9                    	or	ecx, ecx
 11716 0000799A 0F8567FFFFFF            	jnz	lff16s2_1
 11717 000079A0 E91EFBFFFF              	jmp	lff16s2_3
 11718                                  
 11719                                  ; --------------------------------------------------------
 11720                                  
 11721                                  load_24khz_mono_8_bit:
 11722                                  	; 13/01/2025 (mp3play3.s)
 11723 000079A5 BE[00500500]            	mov	esi, decoding_buffer ; (contains 8bit stereo samples)
 11724 000079AA BF[00D00500]            	mov	edi, sample_buffer ; wav output buffer
 11725 000079AF 8B0D[40A20000]          	mov	ecx, [loadsize]
 11726                                  	; 13/01/2025
 11727                                  lff24m_1:
 11728 000079B5 AC                      	lodsb
 11729                                  	;mov	[previous_val], al
 11730 000079B6 88C3                    	mov	bl, al
 11731 000079B8 2C80                    	sub	al, 80h
 11732 000079BA 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
 11733 000079BE 66AB                    	stosw		; original sample (left channel)
 11734 000079C0 66AB                    	stosw		; original sample (right channel)
 11735                                  	;xor	eax, eax
 11736 000079C2 B080                    	mov	al, 80h
 11737 000079C4 49                      	dec	ecx
 11738 000079C5 7402                    	jz	short lff24m_2
 11739 000079C7 8A06                    	mov	al, [esi]
 11740                                  lff24m_2:
 11741                                  	;;mov	[next_val], al
 11742                                  	;mov	bh, al
 11743                                  	;add	al, [previous_val]
 11744 000079C9 00D8                    	add	al, bl
 11745 000079CB D0D8                    	rcr	al, 1
 11746 000079CD 2C80                    	sub	al, 80h
 11747 000079CF 66C1E008                	shl	ax, 8
 11748 000079D3 66AB                    	stosw		; this is interpolated sample (L)
 11749 000079D5 66AB                    	stosw		; this is interpolated sample (R)
 11750                                  	
 11751                                  	; 24 kHZ mono to 48 kHZ stereo conversion of the sample is OK
 11752 000079D7 09C9                    	or	ecx, ecx
 11753 000079D9 75DA                    	jnz	short lff24m_1
 11754 000079DB E9E3FAFFFF              	jmp	lff24_3
 11755                                  
 11756                                  ; --------------------------------------------------------
 11757                                  
 11758                                  load_24khz_stereo_8_bit:
 11759                                  	; 13/01/2025 (mp3play3.s)
 11760 000079E0 BE[00500500]            	mov	esi, decoding_buffer ; (contains 8bit stereo samples)
 11761 000079E5 BF[00D00500]            	mov	edi, sample_buffer ; wav output buffer
 11762 000079EA 8B0D[40A20000]          	mov	ecx, [loadsize]
 11763                                  	; 13/01/2025
 11764 000079F0 D1E9                    	shr	ecx, 1	; word count
 11765                                  lff24s_1:
 11766 000079F2 AC                      	lodsb
 11767 000079F3 A2[12860000]            	mov	[previous_val_l], al
 11768 000079F8 2C80                    	sub	al, 80h
 11769 000079FA 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
 11770 000079FE 66AB                    	stosw		; original sample (L)
 11771 00007A00 AC                      	lodsb
 11772 00007A01 A2[14860000]            	mov	[previous_val_r], al
 11773 00007A06 2C80                    	sub	al, 80h
 11774 00007A08 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
 11775 00007A0C 66AB                    	stosw		; original sample (R)
 11776                                  
 11777                                  	;xor	eax, eax
 11778 00007A0E 66B88080                	mov	ax, 8080h
 11779 00007A12 49                      	dec	ecx
 11780 00007A13 7403                    	jz	short lff24s_2
 11781                                  		; convert 8 bit sample to 16 bit sample
 11782 00007A15 668B06                  	mov	ax, [esi]
 11783                                  lff24s_2:
 11784                                  	;;mov	[next_val_l], al
 11785                                  	;;mov	[next_val_r], ah
 11786                                  	;mov	bx, ax
 11787 00007A18 88E7                    	mov	bh, ah
 11788 00007A1A 0205[12860000]          	add	al, [previous_val_l]
 11789 00007A20 D0D8                    	rcr	al, 1
 11790                                  	;mov	dl, al
 11791 00007A22 2C80                    	sub	al, 80h
 11792 00007A24 66C1E008                	shl	ax, 8
 11793 00007A28 66AB                    	stosw		; this is interpolated sample (L)
 11794 00007A2A 88F8                    	mov	al, bh	; [next_val_r]
 11795 00007A2C 0205[14860000]          	add	al, [previous_val_r]
 11796 00007A32 D0D8                    	rcr	al, 1
 11797                                  	;mov	dh, al
 11798 00007A34 2C80                    	sub	al, 80h
 11799 00007A36 66C1E008                	shl	ax, 8
 11800 00007A3A 66AB                    	stosw		; this is interpolated sample (R)
 11801                                  		
 11802                                  	; 24 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
 11803 00007A3C 09C9                    	or	ecx, ecx
 11804 00007A3E 75B2                    	jnz	short lff24s_1
 11805 00007A40 E97EFAFFFF              	jmp	lff24_3
 11806                                  
 11807                                  ; --------------------------------------------------------
 11808                                  
 11809                                  load_24khz_mono_16_bit:
 11810                                  	; 13/01/2025 (mp3play3.s)
 11811 00007A45 BE[00500500]            	mov	esi, decoding_buffer ; (contains 8bit stereo samples)
 11812 00007A4A BF[00D00500]            	mov	edi, sample_buffer ; wav output buffer
 11813 00007A4F 8B0D[40A20000]          	mov	ecx, [loadsize]
 11814                                  	; 13/01/2025
 11815 00007A55 D1E9                    	shr	ecx, 1	; word count
 11816                                  lff24m2_1:
 11817 00007A57 66AD                    	lodsw
 11818 00007A59 66AB                    	stosw		; original sample (left channel)
 11819 00007A5B 66AB                    	stosw		; original sample (right channel)
 11820 00007A5D 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
 11821                                  	;mov	[previous_val], ax
 11822                                  	;mov	ebx, eax
 11823                                  	;xor	eax, eax
 11824 00007A60 31DB                    	xor	ebx, ebx
 11825 00007A62 49                      	dec	ecx
 11826 00007A63 7403                    	jz	short lff24m2_2
 11827                                  	;mov	ax, [esi]
 11828 00007A65 668B1E                  	mov	bx, [esi]
 11829                                  lff24m2_2:
 11830                                  	;add	ah, 80h ; convert sound level 0 to 65535 format
 11831                                  	;mov	ebp, eax	; [next_val]
 11832                                  	;add	ax, [previous_val]
 11833                                  	; ax = [previous_val]
 11834                                  	; bx = [next_val]
 11835 00007A68 6601D8                  	add	ax, bx
 11836 00007A6B 66D1D8                  	rcr	ax, 1
 11837 00007A6E 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
 11838 00007A71 66AB                    	stosw		; this is interpolated sample (L)
 11839 00007A73 66AB                    	stosw		; this is interpolated sample (R)
 11840                                  	; 24 kHZ mono to 48 kHZ stereo conversion of the sample is OK
 11841 00007A75 09C9                    	or	ecx, ecx
 11842 00007A77 75DE                    	jnz	short lff24m2_1
 11843 00007A79 E945FAFFFF              	jmp	lff24_3
 11844                                  
 11845                                  ; --------------------------------------------------------
 11846                                  
 11847                                  load_24khz_stereo_16_bit:
 11848                                  	; 13/01/2025 (mp3play3.s)
 11849 00007A7E BE[00500500]            	mov	esi, decoding_buffer ; (contains 8bit stereo samples)
 11850 00007A83 BF[00D00500]            	mov	edi, sample_buffer ; wav output buffer
 11851 00007A88 8B0D[40A20000]          	mov	ecx, [loadsize]
 11852                                  	; 13/01/2025
 11853 00007A8E C1E902                  	shr	ecx, 2	; dword count
 11854                                  lff24s2_1:
 11855 00007A91 66AD                    	lodsw
 11856 00007A93 66AB                    	stosw		; original sample (L)
 11857 00007A95 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
 11858 00007A98 66A3[12860000]          	mov	[previous_val_l], ax
 11859 00007A9E 66AD                    	lodsw
 11860 00007AA0 66AB                    	stosw		; original sample (R)
 11861 00007AA2 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
 11862                                  	;mov	[previous_val_r], ax
 11863 00007AA5 89C3                    	mov	ebx, eax
 11864 00007AA7 31D2                    	xor	edx, edx
 11865 00007AA9 31C0                    	xor	eax, eax
 11866                                  	; 16/11/2023
 11867 00007AAB 49                      	dec	ecx
 11868 00007AAC 7407                    	jz	short lff24s2_2
 11869 00007AAE 668B06                  	mov	ax, [esi]
 11870 00007AB1 668B5602                	mov	dx, [esi+2]
 11871                                  lff24s2_2:
 11872 00007AB5 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
 11873                                  	;;mov	[next_val_l], ax
 11874                                  	;mov	ebp, eax
 11875 00007AB8 80C680                  	add	dh, 80h	; convert sound level 0 to 65535 format
 11876                                  	;mov	[next_val_r], dx
 11877 00007ABB 660305[12860000]        	add	ax, [previous_val_l]
 11878 00007AC2 66D1D8                  	rcr	ax, 1
 11879 00007AC5 80EC80                  	sub	ah, 80h ; -32768 to +32767 format again
 11880 00007AC8 66AB                    	stosw		; this is interpolated sample (L)
 11881                                  	;mov	ax, [next_val_r]
 11882 00007ACA 89D0                    	mov	eax, edx
 11883                                  	;add	ax, [previous_val_r]
 11884 00007ACC 6601D8                  	add	ax, bx
 11885 00007ACF 66D1D8                  	rcr	ax, 1
 11886 00007AD2 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
 11887 00007AD5 66AB                    	stosw		; this is interpolated sample (R)
 11888                                  	
 11889                                  	; 24 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
 11890 00007AD7 09C9                    	or	ecx, ecx
 11891 00007AD9 75B6                    	jnz	short lff24s2_1
 11892 00007ADB E9E3F9FFFF              	jmp	lff24_3
 11893                                  
 11894                                  ; --------------------------------------------------------
 11895                                  
 11896                                  load_32khz_mono_8_bit:
 11897                                  	; 13/01/2025 (mp3play3.s)
 11898 00007AE0 BE[00500500]            	mov	esi, decoding_buffer ; (contains 8bit stereo samples)
 11899 00007AE5 BF[00D00500]            	mov	edi, sample_buffer ; wav output buffer
 11900 00007AEA 8B0D[40A20000]          	mov	ecx, [loadsize]
 11901                                  	; 13/01/2025
 11902                                  lff32m_1:
 11903 00007AF0 AC                      	lodsb
 11904                                  	;mov	[previous_val], al
 11905 00007AF1 88C3                    	mov	bl, al
 11906 00007AF3 2C80                    	sub	al, 80h
 11907 00007AF5 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
 11908 00007AF9 66AB                    	stosw		; original sample (left channel)
 11909 00007AFB 66AB                    	stosw		; original sample (right channel)
 11910                                  	;xor	eax, eax
 11911 00007AFD B080                    	mov	al, 80h
 11912 00007AFF 49                      	dec	ecx
 11913 00007B00 7402                    	jz	short lff32m_2
 11914 00007B02 8A06                    	mov	al, [esi]
 11915                                  lff32m_2:
 11916                                  	;;mov	[next_val], al
 11917                                  	;mov	bh, al
 11918                                  	;add	al, [previous_val]
 11919 00007B04 00D8                    	add	al, bl
 11920 00007B06 D0D8                    	rcr	al, 1
 11921 00007B08 2C80                    	sub	al, 80h
 11922 00007B0A 66C1E008                	shl	ax, 8
 11923 00007B0E 66AB                    	stosw		; this is interpolated sample (L)
 11924 00007B10 66AB                    	stosw		; this is interpolated sample (R)
 11925                                  	
 11926                                  	; different than 8-16-24 kHZ !
 11927                                  	; 'original-interpolated-original' trio samples
 11928 00007B12 E30E                    	jecxz	lff32m_3
 11929                                  
 11930 00007B14 AC                      	lodsb
 11931 00007B15 2C80                    	sub	al, 80h
 11932 00007B17 66C1E008                	shl	ax, 8
 11933 00007B1B 66AB                    	stosw		; original sample (left channel)
 11934 00007B1D 66AB                    	stosw		; original sample (right channel)
 11935                                  
 11936                                  	; 32 kHZ mono to 48 kHZ stereo conversion of the sample is OK
 11937 00007B1F 49                      	dec	ecx
 11938 00007B20 75CE                    	jnz	short lff32m_1
 11939                                  lff32m_3:
 11940 00007B22 E99CF9FFFF              	jmp	lff32_3
 11941                                  
 11942                                  ; --------------------------------------------------------
 11943                                  
 11944                                  load_32khz_stereo_8_bit:
 11945                                  	; 13/01/2025 (mp3play3.s)
 11946 00007B27 BE[00500500]            	mov	esi, decoding_buffer ; (contains 8bit stereo samples)
 11947 00007B2C BF[00D00500]            	mov	edi, sample_buffer ; wav output buffer
 11948 00007B31 8B0D[40A20000]          	mov	ecx, [loadsize]
 11949                                  	; 13/01/2025
 11950 00007B37 D1E9                    	shr	ecx, 1	; word count
 11951                                  lff32s_1:
 11952 00007B39 AC                      	lodsb
 11953 00007B3A A2[12860000]            	mov	[previous_val_l], al
 11954 00007B3F 2C80                    	sub	al, 80h
 11955 00007B41 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
 11956 00007B45 66AB                    	stosw		; original sample (L)
 11957 00007B47 AC                      	lodsb
 11958 00007B48 A2[14860000]            	mov	[previous_val_r], al
 11959 00007B4D 2C80                    	sub	al, 80h
 11960 00007B4F 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
 11961 00007B53 66AB                    	stosw		; original sample (R)
 11962                                  
 11963                                  	;xor	eax, eax
 11964 00007B55 66B88080                	mov	ax, 8080h
 11965 00007B59 49                      	dec	ecx
 11966 00007B5A 7403                    	jz	short lff32s_2
 11967                                  		; convert 8 bit sample to 16 bit sample
 11968 00007B5C 668B06                  	mov	ax, [esi]
 11969                                  lff32s_2:
 11970                                  	;;mov	[next_val_l], al
 11971                                  	;;mov	[next_val_r], ah
 11972                                  	;mov	bx, ax
 11973 00007B5F 88E7                    	mov	bh, ah
 11974 00007B61 0205[12860000]          	add	al, [previous_val_l]
 11975 00007B67 D0D8                    	rcr	al, 1
 11976                                  	;mov	dl, al
 11977 00007B69 2C80                    	sub	al, 80h
 11978 00007B6B 66C1E008                	shl	ax, 8
 11979 00007B6F 66AB                    	stosw		; this is interpolated sample (L)
 11980 00007B71 88F8                    	mov	al, bh	; [next_val_r]
 11981 00007B73 0205[14860000]          	add	al, [previous_val_r]
 11982 00007B79 D0D8                    	rcr	al, 1
 11983                                  	;mov	dh, al
 11984 00007B7B 2C80                    	sub	al, 80h
 11985 00007B7D 66C1E008                	shl	ax, 8
 11986 00007B81 66AB                    	stosw		; this is interpolated sample (R)
 11987                                  
 11988                                  	; different than 8-16-24 kHZ !
 11989                                  	; 'original-interpolated-original' trio samples
 11990 00007B83 E315                    	jecxz	lff32s_3
 11991                                  
 11992 00007B85 AC                      	lodsb
 11993 00007B86 2C80                    	sub	al, 80h
 11994 00007B88 66C1E008                	shl	ax, 8
 11995 00007B8C 66AB                    	stosw		; original sample (left channel)
 11996                                  
 11997 00007B8E AC                      	lodsb
 11998 00007B8F 2C80                    	sub	al, 80h
 11999 00007B91 66C1E008                	shl	ax, 8
 12000 00007B95 66AB                    	stosw		; original sample (right channel)
 12001                                  		
 12002                                  	; 32 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
 12003 00007B97 49                      	dec	ecx
 12004 00007B98 759F                    	jnz	short lff32s_1
 12005                                  lff32s_3:
 12006 00007B9A E924F9FFFF              	jmp	lff32_3
 12007                                  
 12008                                  ; --------------------------------------------------------
 12009                                  
 12010                                  load_32khz_mono_16_bit:
 12011                                  	; 13/01/2025 (mp3play3.s)
 12012 00007B9F BE[00500500]            	mov	esi, decoding_buffer ; (contains 8bit stereo samples)
 12013 00007BA4 BF[00D00500]            	mov	edi, sample_buffer ; wav output buffer
 12014 00007BA9 8B0D[40A20000]          	mov	ecx, [loadsize]
 12015                                  	; 13/01/2025
 12016 00007BAF D1E9                    	shr	ecx, 1	; word count
 12017                                  lff32m2_1:
 12018 00007BB1 66AD                    	lodsw
 12019 00007BB3 66AB                    	stosw		; original sample (left channel)
 12020 00007BB5 66AB                    	stosw		; original sample (right channel)
 12021 00007BB7 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
 12022                                  	;mov	[previous_val], ax
 12023                                  	;mov	ebx, eax
 12024                                  	;xor	eax, eax
 12025 00007BBA 31DB                    	xor	ebx, ebx
 12026 00007BBC 49                      	dec	ecx
 12027 00007BBD 7403                    	jz	short lff32m2_2
 12028                                  	;mov	ax, [esi]
 12029 00007BBF 668B1E                  	mov	bx, [esi]
 12030                                  lff32m2_2:
 12031                                  	;add	ah, 80h ; convert sound level 0 to 65535 format
 12032                                  	;mov	ebp, eax	; [next_val]
 12033                                  	;add	ax, [previous_val]
 12034                                  	; ax = [previous_val]
 12035                                  	; bx = [next_val]
 12036 00007BC2 6601D8                  	add	ax, bx
 12037 00007BC5 66D1D8                  	rcr	ax, 1
 12038 00007BC8 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
 12039 00007BCB 66AB                    	stosw		; this is interpolated sample (L)
 12040 00007BCD 66AB                    	stosw		; this is interpolated sample (R)
 12041                                  
 12042                                  	; different than 8-16-24 kHZ !
 12043                                  	; 'original-interpolated-original' trio samples 
 12044 00007BCF E309                    	jecxz	lff32m2_3
 12045                                  
 12046 00007BD1 66AD                    	lodsw
 12047 00007BD3 66AB                    	stosw		; original sample (left channel)
 12048 00007BD5 66AB                    	stosw		; original sample (right channel)
 12049                                  
 12050                                  	; 32 kHZ mono to 48 kHZ stereo conversion of the sample is OK
 12051 00007BD7 49                      	dec	ecx
 12052 00007BD8 75D7                    	jnz	short lff32m2_1
 12053                                  lff32m2_3:
 12054 00007BDA E9E4F8FFFF              	jmp	lff32_3
 12055                                  
 12056                                  ; --------------------------------------------------------
 12057                                  
 12058                                  load_32khz_stereo_16_bit:
 12059                                  	; 13/01/2025 (mp3play3.s)
 12060 00007BDF BE[00500500]            	mov	esi, decoding_buffer ; (contains 8bit stereo samples)
 12061 00007BE4 BF[00D00500]            	mov	edi, sample_buffer ; wav output buffer
 12062 00007BE9 8B0D[40A20000]          	mov	ecx, [loadsize]
 12063                                  	; 13/01/2025
 12064 00007BEF C1E902                  	shr	ecx, 2	; dword count
 12065                                  lff32s2_1:
 12066 00007BF2 66AD                    	lodsw
 12067 00007BF4 66AB                    	stosw		; original sample (L)
 12068 00007BF6 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format 
 12069 00007BF9 66A3[12860000]          	mov	[previous_val_l], ax
 12070 00007BFF 66AD                    	lodsw
 12071 00007C01 66AB                    	stosw		; original sample (R)
 12072 00007C03 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format 
 12073                                  	;mov	[previous_val_r], ax
 12074 00007C06 89C3                    	mov	ebx, eax
 12075 00007C08 31D2                    	xor	edx, edx
 12076 00007C0A 31C0                    	xor	eax, eax
 12077                                  	; 16/11/2023
 12078 00007C0C 49                      	dec	ecx
 12079 00007C0D 7407                    	jz	short lff32s2_2
 12080 00007C0F 668B06                  	mov	ax, [esi]
 12081 00007C12 668B5602                	mov	dx, [esi+2]
 12082                                  lff32s2_2:
 12083 00007C16 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
 12084                                  	;;mov	[next_val_l], ax
 12085                                  	;mov	ebp, eax
 12086 00007C19 80C680                  	add	dh, 80h	; convert sound level 0 to 65535 format
 12087                                  	;mov	[next_val_r], dx
 12088 00007C1C 660305[12860000]        	add	ax, [previous_val_l]
 12089 00007C23 66D1D8                  	rcr	ax, 1
 12090 00007C26 80EC80                  	sub	ah, 80h ; -32768 to +32767 format again
 12091 00007C29 66AB                    	stosw		; this is interpolated sample (L)
 12092                                  	;mov	ax, [next_val_r]
 12093 00007C2B 89D0                    	mov	eax, edx
 12094                                  	;add	ax, [previous_val_r]
 12095 00007C2D 6601D8                  	add	ax, bx
 12096 00007C30 66D1D8                  	rcr	ax, 1
 12097 00007C33 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
 12098 00007C36 66AB                    	stosw		; this is interpolated sample (R)
 12099                                  
 12100                                  	; different than 8-16-24 kHZ !
 12101                                  	; 'original-interpolated-original' trio samples
 12102 00007C38 E30B                    	jecxz	lff32s2_3
 12103                                  
 12104 00007C3A 66AD                    	lodsw
 12105 00007C3C 66AB                    	stosw	; original sample (L)
 12106 00007C3E 66AD                    	lodsw
 12107 00007C40 66AB                    	stosw	; original sample (R)
 12108                                  	
 12109                                  	; 32 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
 12110 00007C42 49                      	dec	ecx
 12111 00007C43 75AD                    	jnz	short lff32s2_1
 12112                                  lff32s2_3:
 12113 00007C45 E979F8FFFF              	jmp	lff32_3
 12114                                  
 12115                                  ; --------------------------------------------------------
 12116                                  
 12117                                  load_22khz_mono_8_bit:
 12118                                  	; 13/01/2025 (mp3play3.s)
 12119 00007C4A BE[00500500]            	mov	esi, decoding_buffer ; (contains 8bit stereo samples)
 12120 00007C4F BF[00D00500]            	mov	edi, sample_buffer ; wav output buffer
 12121 00007C54 8B0D[40A20000]          	mov	ecx, [loadsize]
 12122                                  	; 13/01/2025
 12123                                  lff22m_9:
 12124 00007C5A BD05000000              	mov	ebp, 5	; interpolation (one step) loop count
 12125 00007C5F C605[1A860000]03        	mov	byte [faz], 3  ; 3 steps/phases
 12126                                  lff22m_1:
 12127                                  	; 3:2:2:2:2:2::3:2:2:2:2::3:2:2:2:2:2  ; 37/17
 12128 00007C66 AC                      	lodsb
 12129 00007C67 B280                    	mov	dl, 80h
 12130 00007C69 49                      	dec	ecx
 12131 00007C6A 7402                    	jz	short lff22m_2_1
 12132 00007C6C 8A16                    	mov	dl, [esi]
 12133                                  lff22m_2_1:	
 12134                                  	; al = [previous_val]
 12135                                  	; dl = [next_val]
 12136 00007C6E E85B040000              	call	interpolating_3_8bit_mono ; 1 of 17
 12137 00007C73 E32D                    	jecxz	lff22m_3
 12138                                  lff22m_2_2:
 12139 00007C75 AC                      	lodsb
 12140 00007C76 B280                    	mov	dl, 80h
 12141 00007C78 49                      	dec	ecx
 12142 00007C79 7402                    	jz	short lff22m_2_3
 12143 00007C7B 8A16                    	mov	dl, [esi]
 12144                                  lff22m_2_3:
 12145 00007C7D E8D0040000               	call	interpolating_2_8bit_mono ; 2 of 17 .. 6 of 17
 12146 00007C82 E31E                    	jecxz	lff22m_3
 12147 00007C84 4D                      	dec	ebp
 12148 00007C85 75EE                    	jnz	short lff22m_2_2
 12149                                  
 12150 00007C87 A0[1A860000]            	mov	al, [faz]
 12151 00007C8C FEC8                    	dec	al
 12152 00007C8E 74CA                    	jz	short lff22m_9
 12153 00007C90 FE0D[1A860000]          	dec	byte [faz]
 12154 00007C96 BD04000000              	mov	ebp, 4
 12155 00007C9B FEC8                    	dec	al
 12156 00007C9D 75C7                    	jnz	short lff22m_1 ; 3:2:2:2:2 ; 7-11 of 17
 12157 00007C9F 45                      	inc	ebp ; 5
 12158 00007CA0 EBC4                    	jmp	short lff22m_1 ; 3:2:2:2:2:2 ; 12-17 of 17
 12159                                  
 12160                                  lff22m_3:
 12161                                  lff22s_3:
 12162 00007CA2 E91CF8FFFF              	jmp	lff22_3	; padfill
 12163                                  		; (put zeros in the remain words of the buffer)
 12164                                  
 12165                                  ; --------------------------------------------------------
 12166                                  
 12167                                  load_22khz_stereo_8_bit:
 12168                                  	; 13/01/2025 (mp3play3.s)
 12169 00007CA7 BE[00500500]            	mov	esi, decoding_buffer ; (contains 8bit stereo samples)
 12170 00007CAC BF[00D00500]            	mov	edi, sample_buffer ; wav output buffer
 12171 00007CB1 8B0D[40A20000]          	mov	ecx, [loadsize]
 12172                                  	; 13/01/2025
 12173 00007CB7 D1E9                    	shr	ecx, 1	; word count
 12174                                  lff22s_9:
 12175 00007CB9 BD05000000              	mov	ebp, 5	; interpolation (one step) loop count
 12176 00007CBE C605[1A860000]03        	mov	byte [faz], 3  ; 3 steps/phase
 12177                                  lff22s_1:
 12178                                  	; 3:2:2:2:2:2::3:2:2:2:2::3:2:2:2:2:2  ; 37/17
 12179 00007CC5 66AD                    	lodsw
 12180 00007CC7 66BA8080                	mov	dx, 8080h
 12181 00007CCB 49                      	dec	ecx
 12182 00007CCC 7403                    	jz	short lff22s_2_1
 12183 00007CCE 668B16                  	mov	dx, [esi]
 12184                                  lff22s_2_1:	
 12185                                  	; al = [previous_val_l]
 12186                                  	; ah = [previous_val_r]
 12187                                  	; dl = [next_val_l]
 12188                                  	; dh = [next_val_r]
 12189 00007CD1 E829040000              	call	interpolating_3_8bit_stereo ; 1 of 17
 12190 00007CD6 E3CA                    	jecxz	lff22s_3
 12191                                  lff22s_2_2:
 12192 00007CD8 66AD                    	lodsw
 12193 00007CDA 66BA8080                	mov	dx, 8080h
 12194 00007CDE 49                      	dec	ecx
 12195 00007CDF 7403                    	jz	short lff22s_2_3
 12196 00007CE1 668B16                  	mov	dx, [esi]
 12197                                  lff22s_2_3:
 12198 00007CE4 E886040000               	call	interpolating_2_8bit_stereo ; 2 of 17 .. 6 of 17
 12199 00007CE9 E3B7                    	jecxz	lff22s_3
 12200 00007CEB 4D                      	dec	ebp
 12201 00007CEC 75EA                    	jnz	short lff22s_2_2
 12202                                  
 12203 00007CEE A0[1A860000]            	mov	al, [faz]
 12204 00007CF3 FEC8                    	dec	al
 12205 00007CF5 74C2                    	jz	short lff22s_9
 12206 00007CF7 FE0D[1A860000]          	dec	byte [faz]
 12207 00007CFD BD04000000              	mov	ebp, 4
 12208 00007D02 FEC8                    	dec	al
 12209 00007D04 75BF                    	jnz	short lff22s_1 ; 3:2:2:2:2 ; 7-11 of 17
 12210 00007D06 45                      	inc	ebp ; 5
 12211 00007D07 EBBC                    	jmp	short lff22s_1 ; 3:2:2:2:2:2 ; 12-17 of 17
 12212                                  
 12213                                  ; --------------------------------------------------------
 12214                                  
 12215                                  load_22khz_mono_16_bit:
 12216                                  	; 13/01/2025 (mp3play3.s)
 12217 00007D09 BE[00500500]            	mov	esi, decoding_buffer ; (contains 8bit stereo samples)
 12218 00007D0E BF[00D00500]            	mov	edi, sample_buffer ; wav output buffer
 12219 00007D13 8B0D[40A20000]          	mov	ecx, [loadsize]
 12220                                  	; 13/01/2025
 12221 00007D19 D1E9                    	shr	ecx, 1	; word count
 12222                                  lff22m2_9:
 12223 00007D1B BD05000000              	mov	ebp, 5	; interpolation (one step) loop count
 12224 00007D20 C605[1A860000]03        	mov	byte [faz], 3  ; 3 steps/phases
 12225                                  lff22m2_1:
 12226                                  	; 3:2:2:2:2:2::3:2:2:2:2::3:2:2:2:2:2  ; 37/17
 12227 00007D27 66AD                    	lodsw
 12228 00007D29 31D2                    	xor	edx, edx
 12229 00007D2B 49                      	dec	ecx
 12230 00007D2C 7403                    	jz	short lff22m2_2_1
 12231 00007D2E 668B16                  	mov	dx, [esi]
 12232                                  lff22m2_2_1:	
 12233                                  	; ax = [previous_val]
 12234                                  	; dx = [next_val]
 12235 00007D31 E86A040000              	call	interpolating_3_16bit_mono ; 1 of 17
 12236 00007D36 E32F                    	jecxz	lff22m2_3
 12237                                  lff22m2_2_2:
 12238 00007D38 66AD                    	lodsw
 12239 00007D3A 31D2                    	xor	edx, edx
 12240 00007D3C 49                      	dec	ecx
 12241 00007D3D 7403                    	jz	short lff22m2_2_3
 12242 00007D3F 668B16                  	mov	dx, [esi]
 12243                                  lff22m2_2_3:
 12244 00007D42 E8EC040000               	call	interpolating_2_16bit_mono ; 2 of 17 .. 6 of 17
 12245 00007D47 E31E                    	jecxz	lff22m2_3
 12246 00007D49 4D                      	dec	ebp
 12247 00007D4A 75EC                    	jnz	short lff22m2_2_2
 12248                                  
 12249 00007D4C A0[1A860000]            	mov	al, [faz]
 12250 00007D51 FEC8                    	dec	al
 12251 00007D53 74C6                    	jz	short lff22m2_9
 12252 00007D55 FE0D[1A860000]          	dec	byte [faz]
 12253 00007D5B BD04000000              	mov	ebp, 4
 12254 00007D60 FEC8                    	dec	al
 12255 00007D62 75C3                    	jnz	short lff22m2_1 ; 3:2:2:2:2 ; 7-11 of 17
 12256 00007D64 45                      	inc	ebp ; 5
 12257 00007D65 EBC0                    	jmp	short lff22m2_1 ; 3:2:2:2:2:2 ; 12-17 of 17
 12258                                  
 12259                                  lff22m2_3:
 12260                                  lff22s2_3:
 12261 00007D67 E957F7FFFF              	jmp	lff22_3	; padfill
 12262                                  		; (put zeros in the remain words of the buffer)
 12263                                  
 12264                                  ; --------------------------------------------------------
 12265                                  
 12266                                  load_22khz_stereo_16_bit:
 12267                                  	; 13/01/2025 (mp3play3.s)
 12268 00007D6C BE[00500500]            	mov	esi, decoding_buffer ; (contains 8bit stereo samples)
 12269 00007D71 BF[00D00500]            	mov	edi, sample_buffer ; wav output buffer
 12270 00007D76 8B0D[40A20000]          	mov	ecx, [loadsize]
 12271                                  	; 13/01/2025
 12272 00007D7C C1E902                  	shr	ecx, 2	; dword count
 12273                                  lff22s2_9:
 12274 00007D7F BD05000000              	mov	ebp, 5	; interpolation (one step) loop count
 12275 00007D84 C605[1A860000]03        	mov	byte [faz], 3  ; 3 steps/phase
 12276                                  lff22s2_1:
 12277                                  	; 3:2:2:2:2:2::3:2:2:2:2::3:2:2:2:2:2  ; 37/17
 12278 00007D8B 66AD                    	lodsw
 12279 00007D8D 89C3                    	mov	ebx, eax
 12280 00007D8F 66AD                    	lodsw
 12281 00007D91 8B16                    	mov	edx, [esi]
 12282 00007D93 668915[16860000]        	mov	[next_val_l], dx
 12283                                  	; 26/11/2023
 12284 00007D9A C1EA10                  	shr	edx, 16
 12285 00007D9D 49                      	dec	ecx
 12286 00007D9E 7509                    	jnz	short lff22s2_2_1
 12287 00007DA0 31D2                    	xor	edx, edx ; 0
 12288 00007DA2 668915[16860000]        	mov	[next_val_l], dx
 12289                                  lff22s2_2_1:
 12290                                  	; bx = [previous_val_l]
 12291                                  	; ax = [previous_val_r]
 12292                                  	; [next_val_l]
 12293                                  	; dx = [next_val_r]
 12294 00007DA9 E822040000              	call	interpolating_3_16bit_stereo ; 1 of 17 
 12295 00007DAE E3B7                    	jecxz	lff22s2_3
 12296                                  lff22s2_2_2:
 12297 00007DB0 66AD                    	lodsw
 12298 00007DB2 89C3                    	mov	ebx, eax
 12299 00007DB4 66AD                    	lodsw
 12300 00007DB6 8B16                    	mov	edx, [esi]
 12301 00007DB8 668915[16860000]        	mov	[next_val_l], dx
 12302                                  	; 26/11/2023
 12303 00007DBF C1EA10                  	shr	edx, 16
 12304 00007DC2 49                      	dec	ecx
 12305 00007DC3 7509                    	jnz	short lff22s2_2_3
 12306 00007DC5 31D2                    	xor	edx, edx ; 0
 12307 00007DC7 668915[16860000]        	mov	[next_val_l], dx
 12308                                  lff22s2_2_3:
 12309 00007DCE E878040000               	call	interpolating_2_16bit_stereo ; 2 of 17 .. 6 of 17
 12310 00007DD3 E31E                    	jecxz	lff22s2_2_4
 12311                                  
 12312 00007DD5 4D                      	dec	ebp
 12313 00007DD6 75D8                    	jnz	short lff22s2_2_2
 12314                                  
 12315 00007DD8 A0[1A860000]            	mov	al, [faz]
 12316 00007DDD FEC8                    	dec	al
 12317 00007DDF 749E                    	jz	short lff22s2_9
 12318 00007DE1 FE0D[1A860000]          	dec	byte [faz]
 12319 00007DE7 BD04000000              	mov	ebp, 4
 12320 00007DEC FEC8                    	dec	al
 12321 00007DEE 759B                    	jnz	short lff22s2_1 ; 3:2:2:2:2 ; 7-11 of 17
 12322 00007DF0 45                      	inc	ebp ; 5
 12323 00007DF1 EB98                    	jmp	short lff22s2_1 ; 3:2:2:2:2:2 ; 12-17 of 17
 12324                                  
 12325                                  lff22s2_2_4:
 12326                                  	; 26/11/2023
 12327 00007DF3 E9CBF6FFFF              	jmp	lff22_3	; padfill
 12328                                  
 12329                                  ; --------------------------------------------------------
 12330                                  
 12331                                  load_11khz_mono_8_bit:
 12332                                  	; 13/01/2025 (mp3play3.s)
 12333 00007DF8 BE[00500500]            	mov	esi, decoding_buffer ; (contains 8bit stereo samples)
 12334 00007DFD BF[00D00500]            	mov	edi, sample_buffer ; wav output buffer
 12335 00007E02 8B0D[40A20000]          	mov	ecx, [loadsize]
 12336                                  	; 13/01/2025
 12337                                  lff11m_9:
 12338 00007E08 BD06000000              	mov	ebp, 6	; interpolation (one step) loop count
 12339                                  lff11m_1:
 12340                                  	; 5:4:4::5:4:4::5:4:4::5:4:4::5:4:4::5:4  ; 74/17
 12341 00007E0D AC                      	lodsb
 12342 00007E0E B280                    	mov	dl, 80h
 12343 00007E10 49                      	dec	ecx
 12344 00007E11 7402                    	jz	short lff11m_2_1
 12345 00007E13 8A16                    	mov	dl, [esi]
 12346                                  lff11m_2_1:	
 12347                                  	; al = [previous_val]
 12348                                  	; dl = [next_val]
 12349 00007E15 E860040000              	call	interpolating_5_8bit_mono
 12350 00007E1A E378                    	jecxz	lff11m_3
 12351                                  lff11m_2_2:
 12352 00007E1C AC                      	lodsb
 12353 00007E1D B280                    	mov	dl, 80h
 12354 00007E1F 49                      	dec	ecx
 12355 00007E20 7402                    	jz	short lff11m_2_3
 12356 00007E22 8A16                    	mov	dl, [esi]
 12357                                  lff11m_2_3:
 12358 00007E24 E85D050000               	call	interpolating_4_8bit_mono
 12359 00007E29 E369                    	jecxz	lff11m_3
 12360                                  
 12361 00007E2B 4D                      	dec	ebp
 12362 00007E2C 74DA                    	jz	short lff11m_9
 12363                                  
 12364 00007E2E AC                      	lodsb
 12365 00007E2F B280                    	mov	dl, 80h
 12366 00007E31 49                      	dec	ecx
 12367 00007E32 7402                    	jz	short lff11m_2_4
 12368 00007E34 8A16                    	mov	dl, [esi]
 12369                                  lff11m_2_4:
 12370 00007E36 E84B050000              	call	interpolating_4_8bit_mono
 12371 00007E3B E357                    	jecxz	lff11m_3
 12372 00007E3D EBCE                    	jmp	short lff11m_1
 12373                                  
 12374                                  ; --------------------------------------------------------
 12375                                  
 12376                                  load_11khz_stereo_8_bit:
 12377                                  	; 13/01/2025 (mp3play3.s)
 12378 00007E3F BE[00500500]            	mov	esi, decoding_buffer ; (contains 8bit stereo samples)
 12379 00007E44 BF[00D00500]            	mov	edi, sample_buffer ; wav output buffer
 12380 00007E49 8B0D[40A20000]          	mov	ecx, [loadsize]
 12381                                  	; 13/01/2025
 12382 00007E4F D1E9                    	shr	ecx, 1	; word count
 12383                                  lff11s_9:
 12384 00007E51 BD06000000              	mov	ebp, 6	; interpolation (one step) loop count
 12385                                  lff11s_1:
 12386                                  	; 5:4:4::5:4:4::5:4:4::5:4:4::5:4:4::5:4  ; 74/17
 12387 00007E56 66AD                    	lodsw
 12388 00007E58 66BA8080                	mov	dx, 8080h
 12389 00007E5C 49                      	dec	ecx
 12390 00007E5D 7403                    	jz	short lff11s_2_1
 12391 00007E5F 668B16                  	mov	dx, [esi]
 12392                                  lff11s_2_1:	
 12393                                  	; al = [previous_val_l]
 12394                                  	; ah = [previous_val_r]
 12395                                  	; dl = [next_val_l]
 12396                                  	; dh = [next_val_r]
 12397 00007E62 E872040000              	call	interpolating_5_8bit_stereo
 12398 00007E67 E32B                    	jecxz	lff11s_3
 12399                                  lff11s_2_2:
 12400 00007E69 66AD                    	lodsw
 12401 00007E6B 66BA8080                	mov	dx, 8080h
 12402 00007E6F 49                      	dec	ecx
 12403 00007E70 7403                    	jz	short lff11s_2_3
 12404 00007E72 668B16                  	mov	dx, [esi]
 12405                                  lff11s_2_3:
 12406 00007E75 E84B050000               	call	interpolating_4_8bit_stereo
 12407 00007E7A E318                    	jecxz	lff11s_3
 12408                                  	
 12409 00007E7C 4D                      	dec	ebp
 12410 00007E7D 74D2                    	jz	short lff11s_9
 12411                                  
 12412 00007E7F 66AD                    	lodsw
 12413 00007E81 66BA8080                	mov	dx, 8080h
 12414 00007E85 49                      	dec	ecx
 12415 00007E86 7403                    	jz	short lff11s_2_4
 12416 00007E88 668B16                  	mov	dx, [esi]
 12417                                  lff11s_2_4:
 12418 00007E8B E835050000              	call	interpolating_4_8bit_stereo
 12419 00007E90 E302                    	jecxz	lff11s_3
 12420 00007E92 EBC2                    	jmp	short lff11s_1
 12421                                  
 12422                                  lff11m_3:
 12423                                  lff11s_3:
 12424 00007E94 E92AF6FFFF              	jmp	lff11_3	; padfill
 12425                                  		; (put zeros in the remain words of the buffer)
 12426                                  
 12427                                  ; --------------------------------------------------------
 12428                                  
 12429                                  load_11khz_mono_16_bit:
 12430                                  	; 13/01/2025 (mp3play3.s)
 12431 00007E99 BE[00500500]            	mov	esi, decoding_buffer ; (contains 8bit stereo samples)
 12432 00007E9E BF[00D00500]            	mov	edi, sample_buffer ; wav output buffer
 12433 00007EA3 8B0D[40A20000]          	mov	ecx, [loadsize]
 12434                                  	; 13/01/2025
 12435 00007EA9 D1E9                    	shr	ecx, 1	; word count
 12436                                  lff11m2_9:
 12437 00007EAB BD06000000              	mov	ebp, 6	; interpolation (one step) loop count
 12438                                  lff11m2_1:
 12439                                  	; 5:4:4::5:4:4::5:4:4::5:4:4::5:4:4::5:4  ; 74/17
 12440 00007EB0 66AD                    	lodsw
 12441 00007EB2 31D2                    	xor	edx, edx
 12442 00007EB4 49                      	dec	ecx
 12443 00007EB5 7403                    	jz	short lff11m2_2_1
 12444 00007EB7 668B16                  	mov	dx, [esi]
 12445                                  lff11m2_2_1:	
 12446                                  	; ax = [previous_val]
 12447                                  	; dx = [next_val]
 12448 00007EBA E873050000              	call	interpolating_5_16bit_mono
 12449 00007EBF E327                    	jecxz	lff11m2_3
 12450                                  lff11m2_2_2:
 12451 00007EC1 66AD                    	lodsw
 12452 00007EC3 31D2                    	xor	edx, edx
 12453 00007EC5 49                      	dec	ecx
 12454 00007EC6 7403                    	jz	short lff11m2_2_3
 12455 00007EC8 668B16                  	mov	dx, [esi]
 12456                                  lff11m2_2_3:
 12457 00007ECB E88C060000               	call	interpolating_4_16bit_mono
 12458 00007ED0 E316                    	jecxz	lff11m2_3
 12459                                  
 12460 00007ED2 4D                      	dec	ebp
 12461 00007ED3 74D6                    	jz	short lff11m2_9
 12462                                  
 12463 00007ED5 66AD                    	lodsw
 12464 00007ED7 31D2                    	xor	edx, edx
 12465 00007ED9 49                      	dec	ecx
 12466 00007EDA 7403                    	jz	short lff11m2_2_4
 12467 00007EDC 668B16                  	mov	dx, [esi]
 12468                                  lff11m2_2_4:
 12469 00007EDF E878060000               	call	interpolating_4_16bit_mono
 12470 00007EE4 E302                    	jecxz	lff11m2_3
 12471 00007EE6 EBC8                    	jmp	short lff11m2_1
 12472                                  
 12473                                  lff11m2_3:
 12474 00007EE8 E9D6F5FFFF              	jmp	lff11_3	; padfill
 12475                                  		; (put zeros in the remain words of the buffer)
 12476                                  
 12477                                  ; --------------------------------------------------------
 12478                                  
 12479                                  load_11khz_stereo_16_bit:
 12480                                  	; 13/01/2025 (mp3play3.s)
 12481 00007EED BE[00500500]            	mov	esi, decoding_buffer ; (contains 8bit stereo samples)
 12482 00007EF2 BF[00D00500]            	mov	edi, sample_buffer ; wav output buffer
 12483 00007EF7 8B0D[40A20000]          	mov	ecx, [loadsize]
 12484                                  	; 13/01/2025
 12485 00007EFD C1E902                  	shr	ecx, 2	; dword count
 12486                                  lff11s2_9:
 12487 00007F00 BD06000000              	mov	ebp, 6	; interpolation (one step) loop count
 12488                                  lff11s2_1:
 12489                                  	; 5:4:4::5:4:4::5:4:4::5:4:4::5:4:4::5:4  ; 74/17
 12490 00007F05 66AD                    	lodsw
 12491 00007F07 89C3                    	mov	ebx, eax
 12492 00007F09 66AD                    	lodsw
 12493 00007F0B 8B16                    	mov	edx, [esi]
 12494 00007F0D 8915[16860000]          	mov	[next_val_l], edx
 12495                                  	; 26/11/2023
 12496 00007F13 C1EA10                  	shr	edx, 16
 12497                                  	;mov	[next_val_r], dx
 12498 00007F16 49                      	dec	ecx
 12499 00007F17 7509                    	jnz	short lff11s2_2_1
 12500 00007F19 31D2                    	xor	edx, edx ; 0
 12501 00007F1B 668915[16860000]        	mov	[next_val_l], dx
 12502                                  	;mov	[next_val_r], dx
 12503                                  lff11s2_2_1:
 12504                                  	; bx = [previous_val_l]
 12505                                  	; ax = [previous_val_r]
 12506                                  	; [next_val_l]
 12507                                  	; dx = [next_val_r]
 12508 00007F22 E866050000              	call	interpolating_5_16bit_stereo
 12509 00007F27 E34F                    	jecxz	lff11s2_3
 12510                                  lff11s2_2_2:
 12511 00007F29 66AD                    	lodsw
 12512 00007F2B 89C3                    	mov	ebx, eax
 12513 00007F2D 66AD                    	lodsw
 12514 00007F2F 8B16                    	mov	edx, [esi]
 12515 00007F31 668915[16860000]        	mov	[next_val_l], dx
 12516                                  	; 26/11/2023
 12517 00007F38 C1EA10                  	shr	edx, 16
 12518                                  	;mov	[next_val_r], dx
 12519 00007F3B 49                      	dec	ecx
 12520 00007F3C 7509                    	jnz	short lff11s2_2_3
 12521 00007F3E 31D2                    	xor	edx, edx ; 0
 12522 00007F40 668915[16860000]        	mov	[next_val_l], dx
 12523                                  	;mov	[next_val_r], dx
 12524                                  lff11s2_2_3:
 12525 00007F47 E849060000               	call	interpolating_4_16bit_stereo
 12526 00007F4C E32A                    	jecxz	lff11s2_3
 12527                                  	
 12528 00007F4E 4D                      	dec	ebp
 12529 00007F4F 74AF                    	jz	short lff11s2_9
 12530                                  
 12531 00007F51 66AD                    	lodsw
 12532 00007F53 89C3                    	mov	ebx, eax
 12533 00007F55 66AD                    	lodsw
 12534 00007F57 8B16                    	mov	edx, [esi]
 12535 00007F59 668915[16860000]        	mov	[next_val_l], dx
 12536                                  	; 26/11/2023
 12537 00007F60 C1EA10                  	shr	edx, 16
 12538                                  	;mov	[next_val_r], dx
 12539 00007F63 49                      	dec	ecx
 12540 00007F64 7509                    	jnz	short lff11s2_2_4
 12541 00007F66 31D2                    	xor	edx, edx ; 0
 12542 00007F68 668915[16860000]        	mov	[next_val_l], dx
 12543                                  	;mov	[next_val_r], dx
 12544                                  lff11s2_2_4:
 12545 00007F6F E821060000               	call	interpolating_4_16bit_stereo
 12546 00007F74 E302                    	jecxz	lff11s2_3
 12547 00007F76 EB8D                    	jmp	short lff11s2_1
 12548                                  
 12549                                  lff11s2_3:
 12550 00007F78 E946F5FFFF              	jmp	lff11_3	; padfill
 12551                                  		; (put zeros in the remain words of the buffer)
 12552                                  
 12553                                  ; --------------------------------------------------------
 12554                                  
 12555                                  load_44khz_mono_8_bit:
 12556                                  	; 13/01/2025 (mp3play3.s)
 12557 00007F7D BE[00500500]            	mov	esi, decoding_buffer ; (contains 8bit stereo samples)
 12558 00007F82 BF[00D00500]            	mov	edi, sample_buffer ; wav output buffer
 12559 00007F87 8B0D[40A20000]          	mov	ecx, [loadsize]
 12560                                  	; 13/01/2025
 12561                                  lff44m_9:
 12562 00007F8D BD0A000000              	mov	ebp, 10	; interpolation (one step) loop count
 12563 00007F92 C605[1A860000]02        	mov	byte [faz], 2  ; 2 steps/phases
 12564                                  lff44m_1:
 12565                                  	; 2:1:1:1:1:1:1:1:1:1:1::	; 25/23
 12566                                  	; 2:1:1:1:1:1:1:1:1:1:1:1
 12567 00007F99 AC                      	lodsb
 12568 00007F9A B280                    	mov	dl, 80h
 12569 00007F9C 49                      	dec	ecx
 12570 00007F9D 7402                    	jz	short lff44m_2_1
 12571 00007F9F 8A16                    	mov	dl, [esi]
 12572                                  lff44m_2_1:	
 12573                                  	; al = [previous_val]
 12574                                  	; dl = [next_val]
 12575 00007FA1 E8AC010000              	call	interpolating_2_8bit_mono
 12576 00007FA6 E320                    	jecxz	lff44m_3
 12577                                  lff44m_2_2:
 12578 00007FA8 AC                      	lodsb
 12579 00007FA9 2C80                    	sub	al, 80h
 12580 00007FAB 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
 12581 00007FAF 66AB                    	stosw		; (L)
 12582 00007FB1 66AB                    	stosw		; (R)
 12583                                  
 12584 00007FB3 49                      	dec	ecx
 12585 00007FB4 7412                    	jz	short lff44m_3
 12586 00007FB6 4D                      	dec	ebp
 12587 00007FB7 75EF                    	jnz	short lff44m_2_2
 12588                                  	
 12589 00007FB9 FE0D[1A860000]          	dec	byte [faz]
 12590 00007FBF 74CC                    	jz	short lff44m_9 
 12591 00007FC1 BD0B000000              	mov	ebp, 11
 12592 00007FC6 EBD1                    	jmp	short lff44m_1
 12593                                  
 12594                                  lff44m_3:
 12595                                  lff44s_3:
 12596 00007FC8 E9F6F4FFFF              	jmp	lff44_3	; padfill
 12597                                  		; (put zeros in the remain words of the buffer)
 12598                                  
 12599                                  ; --------------------------------------------------------
 12600                                  
 12601                                  load_44khz_stereo_8_bit:
 12602                                  	; 13/01/2025 (mp3play3.s)
 12603 00007FCD BE[00500500]            	mov	esi, decoding_buffer ; (contains 8bit stereo samples)
 12604 00007FD2 BF[00D00500]            	mov	edi, sample_buffer ; wav output buffer
 12605 00007FD7 8B0D[40A20000]          	mov	ecx, [loadsize]
 12606                                  	; 13/01/2025
 12607 00007FDD D1E9                    	shr	ecx, 1	; word count
 12608                                  lff44s_9:
 12609 00007FDF BD0A000000              	mov	ebp, 10 ; interpolation (one step) loop count
 12610 00007FE4 C605[1A860000]02        	mov	byte [faz], 2  ; 2 steps/phase
 12611                                  lff44s_1:
 12612                                  	; 2:1:1:1:1:1:1:1:1:1:1::	; 25/23
 12613                                  	; 2:1:1:1:1:1:1:1:1:1:1:1
 12614 00007FEB 66AD                    	lodsw
 12615 00007FED 66BA8080                	mov	dx, 8080h
 12616 00007FF1 49                      	dec	ecx
 12617 00007FF2 7403                    	jz	short lff44s_2_1
 12618 00007FF4 668B16                  	mov	dx, [esi]
 12619                                  lff44s_2_1:	
 12620                                  	; al = [previous_val_l]
 12621                                  	; ah = [previous_val_r]
 12622                                  	; dl = [next_val_l]
 12623                                  	; dh = [next_val_r]
 12624 00007FF7 E873010000              	call	interpolating_2_8bit_stereo
 12625 00007FFC E3CA                    	jecxz	lff44s_3
 12626                                  lff44s_2_2:
 12627 00007FFE AC                      	lodsb
 12628 00007FFF 2C80                    	sub	al, 80h
 12629 00008001 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
 12630 00008005 66AB                    	stosw		; (L)
 12631 00008007 AC                      	lodsb
 12632 00008008 2C80                    	sub	al, 80h
 12633 0000800A 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
 12634 0000800E 66AB                    	stosw		; (R)
 12635                                  
 12636 00008010 49                      	dec	ecx
 12637 00008011 74B5                    	jz	short lff44s_3	
 12638 00008013 4D                      	dec	ebp
 12639 00008014 75E8                    	jnz	short lff44s_2_2
 12640                                  	
 12641 00008016 FE0D[1A860000]          	dec	byte [faz]
 12642 0000801C 74C1                    	jz	short lff44s_9 
 12643 0000801E BD0B000000              	mov	ebp, 11
 12644 00008023 EBC6                    	jmp	short lff44s_1
 12645                                  
 12646                                  ; --------------------------------------------------------
 12647                                  
 12648                                  load_44khz_mono_16_bit:
 12649                                  	; 13/01/2025 (mp3play3.s)
 12650 00008025 BE[00500500]            	mov	esi, decoding_buffer ; (contains 8bit stereo samples)
 12651 0000802A BF[00D00500]            	mov	edi, sample_buffer ; wav output buffer
 12652 0000802F 8B0D[40A20000]          	mov	ecx, [loadsize]
 12653                                  	; 13/01/2025
 12654 00008035 D1E9                    	shr	ecx, 1	; word count
 12655                                  lff44m2_9:
 12656 00008037 BD0A000000              	mov	ebp, 10 ; interpolation (one step) loop count
 12657 0000803C C605[1A860000]02        	mov	byte [faz], 2  ; 2 steps/phases
 12658                                  lff44m2_1:
 12659                                  	; 2:1:1:1:1:1:1:1:1:1:1::	; 25/23
 12660                                  	; 2:1:1:1:1:1:1:1:1:1:1:1
 12661 00008043 66AD                    	lodsw
 12662 00008045 31D2                    	xor	edx, edx
 12663 00008047 49                      	dec	ecx
 12664 00008048 7403                    	jz	short lff44m2_2_1
 12665 0000804A 668B16                  	mov	dx, [esi]
 12666                                  lff44m2_2_1:	
 12667                                  	; ax = [previous_val]
 12668                                  	; dx = [next_val]
 12669 0000804D E8E1010000              	call	interpolating_2_16bit_mono
 12670 00008052 E31B                    	jecxz	lff44m2_3
 12671                                  lff44m2_2_2:
 12672 00008054 66AD                    	lodsw
 12673 00008056 66AB                    	stosw		; (L)eft Channel
 12674 00008058 66AB                    	stosw		; (R)ight Channel
 12675                                  
 12676 0000805A 49                      	dec	ecx
 12677 0000805B 7412                    	jz	short lff44m2_3	
 12678 0000805D 4D                      	dec	ebp
 12679 0000805E 75F4                    	jnz	short lff44m2_2_2
 12680                                  	
 12681 00008060 FE0D[1A860000]          	dec	byte [faz]
 12682 00008066 74CF                    	jz	short lff44m2_9 
 12683 00008068 BD0B000000              	mov	ebp, 11
 12684 0000806D EBD4                    	jmp	short lff44m2_1
 12685                                  
 12686                                  lff44m2_3:
 12687                                  lff44s2_3:
 12688 0000806F E94FF4FFFF              	jmp	lff44_3	; padfill
 12689                                  		; (put zeros in the remain words of the buffer)
 12690                                  
 12691                                  ; --------------------------------------------------------
 12692                                  
 12693                                  load_44khz_stereo_16_bit:
 12694                                  	; 13/01/2025 (mp3play3.s)
 12695 00008074 BE[00500500]            	mov	esi, decoding_buffer ; (contains 8bit stereo samples)
 12696 00008079 BF[00D00500]            	mov	edi, sample_buffer ; wav output buffer
 12697 0000807E 8B0D[40A20000]          	mov	ecx, [loadsize]
 12698                                  	; 13/01/2025
 12699 00008084 C1E902                  	shr	ecx, 2	; dword count
 12700                                  lff44s2_9:
 12701 00008087 BD0A000000              	mov	ebp, 10 ; interpolation (one step) loop count
 12702 0000808C C605[1A860000]02        	mov	byte [faz], 2  ; 2 steps/phase
 12703                                  lff44s2_1:
 12704                                  	; 2:1:1:1:1:1:1:1:1:1:1::	; 25/23
 12705                                  	; 2:1:1:1:1:1:1:1:1:1:1:1
 12706 00008093 66AD                    	lodsw
 12707 00008095 89C3                    	mov	ebx, eax
 12708 00008097 66AD                    	lodsw
 12709                                  	;mov	dx, [esi]
 12710                                  	;mov	[next_val_l], dx
 12711                                  	;mov	dx, [esi+2]
 12712                                  	; 26/11/2023
 12713 00008099 8B16                    	mov	edx, [esi]
 12714 0000809B 668915[16860000]        	mov	[next_val_l], dx
 12715 000080A2 C1EA10                  	shr	edx, 16
 12716 000080A5 49                      	dec	ecx
 12717 000080A6 7509                    	jnz	short lff44s2_2_1
 12718 000080A8 31D2                    	xor	edx, edx ; 0
 12719 000080AA 668915[16860000]        	mov	[next_val_l], dx
 12720                                  lff44s2_2_1:
 12721                                  	; bx = [previous_val_l]
 12722                                  	; ax = [previous_val_r]
 12723                                  	; [next_val_l]
 12724                                  	; dx = [next_val_r]
 12725 000080B1 E895010000              	call	interpolating_2_16bit_stereo
 12726 000080B6 E3B7                    	jecxz	lff44s2_3
 12727                                  lff44s2_2_2:
 12728                                  	;movsw		; (L)eft Channel
 12729                                  	;movsw		; (R)ight Channel
 12730 000080B8 A5                      	movsd
 12731                                  
 12732 000080B9 49                      	dec	ecx
 12733 000080BA 74B3                    	jz	short lff44s2_3	
 12734 000080BC 4D                      	dec	ebp
 12735 000080BD 75F9                    	jnz	short lff44s2_2_2
 12736                                  	
 12737 000080BF FE0D[1A860000]          	dec	byte [faz]
 12738 000080C5 74C0                    	jz	short lff44s2_9 
 12739 000080C7 BD0B000000              	mov	ebp, 11
 12740 000080CC EBC5                    	jmp	short lff44s2_1
 12741                                  
 12742                                  ; --------------------------------------------------------
 12743                                  
 12744                                  interpolating_3_8bit_mono:
 12745                                  	; 16/11/2023
 12746                                  	; al = [previous_val]
 12747                                  	; dl = [next_val]
 12748                                  	; original-interpolated-interpolated
 12749 000080CE 88C3                    	mov	bl, al
 12750 000080D0 2C80                    	sub	al, 80h
 12751 000080D2 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
 12752 000080D6 66AB                    	stosw		; original sample (L)
 12753 000080D8 66AB                    	stosw		; original sample (R)
 12754 000080DA 88D8                    	mov	al, bl
 12755 000080DC 00D0                    	add	al, dl
 12756 000080DE D0D8                    	rcr	al, 1
 12757 000080E0 88C7                    	mov	bh, al	; interpolated middle (temporary)
 12758 000080E2 00D8                    	add	al, bl
 12759 000080E4 D0D8                    	rcr	al, 1
 12760 000080E6 2C80                    	sub	al, 80h
 12761 000080E8 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
 12762 000080EC 66AB                    	stosw		; interpolated sample 1 (L)
 12763 000080EE 66AB                    	stosw		; interpolated sample 1 (R)
 12764 000080F0 88F8                    	mov	al, bh
 12765 000080F2 00D0                    	add	al, dl	; [next_val]
 12766 000080F4 D0D8                    	rcr	al, 1
 12767 000080F6 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
 12768 000080FA 66AB                    	stosw		; interpolated sample 2 (L)
 12769 000080FC 66AB                    	stosw		; interpolated sample 2 (R)
 12770 000080FE C3                      	retn
 12771                                  
 12772                                  interpolating_3_8bit_stereo:
 12773                                  	; 16/11/2023
 12774                                  	; al = [previous_val_l]
 12775                                  	; ah = [previous_val_r]
 12776                                  	; dl = [next_val_l]
 12777                                  	; dh = [next_val_r]
 12778                                  	; original-interpolated-interpolated
 12779 000080FF 89C3                    	mov	ebx, eax
 12780 00008101 2C80                    	sub	al, 80h
 12781 00008103 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
 12782 00008107 66AB                    	stosw		; original sample (L)
 12783 00008109 88F8                    	mov	al, bh
 12784 0000810B 2C80                    	sub	al, 80h
 12785 0000810D 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
 12786 00008111 66AB                    	stosw		; original sample (R)
 12787 00008113 88D8                    	mov	al, bl
 12788 00008115 00D0                    	add	al, dl	; [next_val_l]
 12789 00008117 D0D8                    	rcr	al, 1
 12790 00008119 50                      	push	eax ; *	; al = interpolated middle (L) (temporary)
 12791 0000811A 00D8                    	add	al, bl	; [previous_val_l]
 12792 0000811C D0D8                    	rcr	al, 1
 12793 0000811E 2C80                    	sub	al, 80h
 12794 00008120 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
 12795 00008124 66AB                    	stosw		; interpolated sample 1 (L)
 12796 00008126 88F8                    	mov	al, bh
 12797 00008128 00F0                    	add	al, dh	; [next_val_r]
 12798 0000812A D0D8                    	rcr	al, 1
 12799 0000812C 50                      	push	eax ; ** ; al = interpolated middle (R) (temporary)
 12800 0000812D 00F8                    	add	al, bh	; [previous_val_r]
 12801 0000812F D0D8                    	rcr	al, 1
 12802 00008131 2C80                    	sub	al, 80h
 12803 00008133 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
 12804 00008137 66AB                    	stosw		; interpolated sample 1 (R)
 12805 00008139 5B                      	pop	ebx ; **
 12806 0000813A 58                      	pop	eax ; *
 12807 0000813B 00D0                    	add	al, dl	; [next_val_l]
 12808 0000813D D0D8                    	rcr	al, 1
 12809 0000813F 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
 12810 00008143 66AB                    	stosw		; interpolated sample 2 (L)
 12811 00008145 88D8                    	mov	al, bl
 12812 00008147 00F0                    	add	al, dh	; [next_val_r]
 12813 00008149 D0D8                    	rcr	al, 1
 12814 0000814B 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
 12815 0000814F 66AB                    	stosw		; interpolated sample 2 (R)
 12816 00008151 C3                      	retn
 12817                                  
 12818                                  interpolating_2_8bit_mono:
 12819                                  	; 16/11/2023
 12820                                  	; al = [previous_val]
 12821                                  	; dl = [next_val]
 12822                                  	; original-interpolated
 12823 00008152 88C3                    	mov	bl, al
 12824 00008154 2C80                    	sub	al, 80h
 12825 00008156 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
 12826 0000815A 66AB                    	stosw		; original sample (L)
 12827 0000815C 66AB                    	stosw		; original sample (R)
 12828 0000815E 88D8                    	mov	al, bl
 12829 00008160 00D0                    	add	al, dl
 12830 00008162 D0D8                    	rcr	al, 1
 12831 00008164 2C80                    	sub	al, 80h
 12832 00008166 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
 12833 0000816A 66AB                    	stosw		; interpolated sample (L)
 12834 0000816C 66AB                    	stosw		; interpolated sample (R)
 12835 0000816E C3                      	retn
 12836                                  
 12837                                  interpolating_2_8bit_stereo:
 12838                                  	; 16/11/2023
 12839                                  	; al = [previous_val_l]
 12840                                  	; ah = [previous_val_r]
 12841                                  	; dl = [next_val_l]
 12842                                  	; dh = [next_val_r]
 12843                                  	; original-interpolated
 12844 0000816F 89C3                    	mov	ebx, eax
 12845 00008171 2C80                    	sub	al, 80h
 12846 00008173 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
 12847 00008177 66AB                    	stosw		; original sample (L)
 12848 00008179 88F8                    	mov	al, bh
 12849 0000817B 2C80                    	sub	al, 80h
 12850 0000817D 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
 12851 00008181 66AB                    	stosw		; original sample (R)
 12852 00008183 88D8                    	mov	al, bl	; [previous_val_l]
 12853 00008185 00D0                    	add	al, dl	; [next_val_l]
 12854 00008187 D0D8                    	rcr	al, 1
 12855 00008189 2C80                    	sub	al, 80h
 12856 0000818B 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
 12857 0000818F 66AB                    	stosw		; interpolated sample (L)
 12858 00008191 88F8                    	mov	al, bh
 12859 00008193 00F0                    	add	al, dh	; [next_val_r]
 12860 00008195 D0D8                    	rcr	al, 1
 12861 00008197 2C80                    	sub	al, 80h
 12862 00008199 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
 12863 0000819D 66AB                    	stosw		; interpolated sample (R)
 12864 0000819F C3                      	retn
 12865                                  
 12866                                  interpolating_3_16bit_mono:
 12867                                  	; 16/11/2023
 12868                                  	; ax = [previous_val]
 12869                                  	; dx = [next_val]
 12870                                  	; original-interpolated-interpolated
 12871                                  
 12872 000081A0 66AB                    	stosw		; original sample (L)
 12873 000081A2 66AB                    	stosw		; original sample (R)
 12874 000081A4 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
 12875 000081A7 50                      	push	eax ; *	; [previous_val]
 12876 000081A8 80C680                  	add	dh, 80h
 12877 000081AB 6601D0                  	add	ax, dx
 12878 000081AE 66D1D8                  	rcr	ax, 1
 12879 000081B1 5B                      	pop	ebx ; *
 12880 000081B2 93                      	xchg	ebx, eax ; bx  = interpolated middle (temporary)
 12881 000081B3 6601D8                  	add	ax, bx	; [previous_val] + interpolated middle
 12882 000081B6 66D1D8                  	rcr	ax, 1
 12883 000081B9 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
 12884 000081BC 66AB                    	stosw 		; interpolated sample 1 (L)
 12885 000081BE 66AB                    	stosw		; interpolated sample 1 (R)
 12886 000081C0 89D8                    	mov	eax, ebx
 12887 000081C2 6601D0                  	add	ax, dx	; interpolated middle + [next_val]
 12888 000081C5 66D1D8                  	rcr	ax, 1
 12889 000081C8 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
 12890 000081CB 66AB                    	stosw		; interpolated sample 2 (L)
 12891 000081CD 66AB                    	stosw		; interpolated sample 2 (R)
 12892 000081CF C3                      	retn
 12893                                  
 12894                                  interpolating_3_16bit_stereo:
 12895                                  	; 16/11/2023
 12896                                  	; bx = [previous_val_l]
 12897                                  	; ax = [previous_val_r]
 12898                                  	; [next_val_l]
 12899                                  	; dx = [next_val_r]
 12900                                  	; original-interpolated-interpolated
 12901                                  
 12902 000081D0 93                      	xchg	eax, ebx
 12903 000081D1 66AB                    	stosw		; original sample (L)
 12904 000081D3 93                      	xchg	eax, ebx
 12905 000081D4 66AB                    	stosw		; original sample (R)
 12906 000081D6 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
 12907 000081D9 50                      	push	eax ; *	; [previous_val_r]
 12908 000081DA 80C780                  	add	bh, 80h
 12909 000081DD 8005[17860000]80        	add	byte [next_val_l+1], 80h
 12910 000081E4 66A1[16860000]          	mov	ax, [next_val_l]
 12911 000081EA 6601D8                  	add	ax, bx	; [previous_val_l]
 12912 000081ED 66D1D8                  	rcr	ax, 1
 12913 000081F0 93                      	xchg	eax, ebx ; ax = [previous_val_l]
 12914 000081F1 6601D8                  	add	ax, bx	; bx = interpolated middle (L)
 12915 000081F4 66D1D8                  	rcr	ax, 1
 12916 000081F7 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
 12917 000081FA 66AB                    	stosw 		; interpolated sample 1 (L)
 12918 000081FC 58                      	pop	eax  ; *
 12919 000081FD 80C680                  	add	dh, 80h ; convert sound level 0 to 65535 format
 12920 00008200 52                      	push	edx  ; * ; [next_val_r]
 12921 00008201 92                      	xchg	eax, edx
 12922 00008202 6601D0                  	add	ax, dx	; [next_val_r] + [previous_val_r]
 12923 00008205 66D1D8                  	rcr	ax, 1	; / 2
 12924 00008208 50                      	push	eax ; ** ; interpolated middle (R)
 12925 00008209 6601D0                  	add	ax, dx	; + [previous_val_r]
 12926 0000820C 66D1D8                  	rcr	ax, 1
 12927 0000820F 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
 12928 00008212 66AB                    	stosw 		; interpolated sample 1 (R)
 12929 00008214 66A1[16860000]          	mov	ax, [next_val_l]
 12930 0000821A 6601D8                  	add	ax, bx	; + interpolated middle (L)
 12931 0000821D 66D1D8                  	rcr	ax, 1
 12932 00008220 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
 12933 00008223 66AB                    	stosw 		; interpolated sample 2 (L)
 12934 00008225 58                      	pop	eax ; **
 12935 00008226 5A                      	pop	edx ; *
 12936 00008227 6601D0                  	add	ax, dx	; interpolated middle + [next_val_r]
 12937 0000822A 66D1D8                  	rcr	ax, 1	; / 2
 12938 0000822D 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
 12939 00008230 66AB                    	stosw 		; interpolated sample 2 (L)
 12940 00008232 C3                      	retn
 12941                                  
 12942                                  interpolating_2_16bit_mono:
 12943                                  	; 16/11/2023
 12944                                  	; ax = [previous_val]
 12945                                  	; dx = [next_val]
 12946                                  	; original-interpolated
 12947                                  
 12948 00008233 66AB                    	stosw		; original sample (L)
 12949 00008235 66AB                    	stosw		; original sample (R)
 12950 00008237 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
 12951 0000823A 80C680                  	add	dh, 80h
 12952 0000823D 6601D0                  	add	ax, dx
 12953 00008240 66D1D8                  	rcr	ax, 1
 12954 00008243 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
 12955 00008246 66AB                    	stosw		; interpolated sample (L)
 12956 00008248 66AB                    	stosw		; interpolated sample (R)
 12957 0000824A C3                      	retn
 12958                                  
 12959                                  interpolating_2_16bit_stereo:
 12960                                  	; 16/11/2023
 12961                                  	; bx = [previous_val_l]
 12962                                  	; ax = [previous_val_r]
 12963                                  	; [next_val_l]
 12964                                  	; dx = [next_val_r]
 12965                                  	; original-interpolated
 12966                                  
 12967 0000824B 93                      	xchg	eax, ebx
 12968 0000824C 66AB                    	stosw		; original sample (L)
 12969 0000824E 93                      	xchg	eax, ebx
 12970 0000824F 66AB                    	stosw		; original sample (R)
 12971 00008251 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
 12972 00008254 80C680                  	add	dh, 80h
 12973 00008257 6601D0                  	add	ax, dx	; [previous_val_r] + [next_val_r]
 12974 0000825A 66D1D8                  	rcr	ax, 1	; / 2
 12975                                  	; 14/01/2025
 12976 0000825D 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
 12977                                  	;push	eax ; *	; interpolated sample (R)
 12978                                  	; 14/01/2025
 12979 00008260 C1E010                  	shl	eax, 16
 12980 00008263 66A1[16860000]          	mov	ax, [next_val_l]
 12981 00008269 80C480                  	add	ah, 80h
 12982 0000826C 80C780                  	add	bh, 80h
 12983 0000826F 6601D8                  	add	ax, bx	; [next_val_l] + [previous_val_l]
 12984 00008272 66D1D8                  	rcr	ax, 1	; / 2
 12985 00008275 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
 12986                                  	; 14/01/2025
 12987                                  	;stosw 		; interpolated sample (L)
 12988                                  	;pop	eax ; *	
 12989                                  	;sub	ah, 80h	; -32768 to +32767 format again
 12990                                  	;stosw 		; interpolated sample (R)
 12991                                  	; 14/01/2025
 12992 00008278 AB                      	stosd
 12993 00008279 C3                      	retn
 12994                                  
 12995                                  interpolating_5_8bit_mono:
 12996                                  	; 17/11/2023
 12997                                  	; al = [previous_val]
 12998                                  	; dl = [next_val]
 12999                                  	; original-interpltd-interpltd-interpltd-interpltd
 13000 0000827A 88C3                    	mov	bl, al
 13001 0000827C 2C80                    	sub	al, 80h
 13002 0000827E 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
 13003 00008282 66AB                    	stosw		; original sample (L)
 13004 00008284 66AB                    	stosw		; original sample (R)
 13005 00008286 88D8                    	mov	al, bl
 13006 00008288 00D0                    	add	al, dl
 13007 0000828A D0D8                    	rcr	al, 1
 13008 0000828C 88C7                    	mov	bh, al	; interpolated middle (temporary)
 13009 0000828E 00D8                    	add	al, bl  ; [previous_val]
 13010 00008290 D0D8                    	rcr	al, 1 	
 13011 00008292 88C6                    	mov	dh, al	; interpolated 1st quarter (temporary)
 13012 00008294 00D8                    	add	al, bl
 13013 00008296 D0D8                    	rcr	al, 1
 13014 00008298 2C80                    	sub	al, 80h
 13015 0000829A 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
 13016 0000829E 66AB                    	stosw		; interpolated sample 1 (L)
 13017 000082A0 66AB                    	stosw		; interpolated sample 1 (R)
 13018 000082A2 88F8                    	mov	al, bh
 13019 000082A4 00F0                    	add	al, dh
 13020 000082A6 D0D8                    	rcr	al, 1
 13021 000082A8 2C80                    	sub	al, 80h
 13022 000082AA 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
 13023 000082AE 66AB                    	stosw		; interpolated sample 2 (L)
 13024 000082B0 66AB                    	stosw		; interpolated sample 2 (R)
 13025 000082B2 88F8                    	mov	al, bh
 13026 000082B4 00D0                    	add	al, dl	; [next_val]
 13027 000082B6 D0D8                    	rcr	al, 1
 13028 000082B8 88C6                    	mov	dh, al	; interpolated 3rd quarter (temporary)
 13029 000082BA 00F8                    	add	al, bh
 13030 000082BC D0D8                    	rcr	al, 1
 13031 000082BE 2C80                    	sub	al, 80h
 13032 000082C0 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
 13033 000082C4 66AB                    	stosw		; interpolated sample 3 (L)
 13034 000082C6 66AB                    	stosw		; interpolated sample 3 (R)
 13035 000082C8 88F0                    	mov	al, dh
 13036 000082CA 00D0                    	add	al, dl
 13037 000082CC D0D8                    	rcr	al, 1
 13038 000082CE 2C80                    	sub	al, 80h
 13039 000082D0 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
 13040 000082D4 66AB                    	stosw		; interpolated sample 4 (L)
 13041 000082D6 66AB                    	stosw		; interpolated sample 4 (R)
 13042 000082D8 C3                      	retn
 13043                                  
 13044                                  interpolating_5_8bit_stereo:
 13045                                  	; 17/11/2023
 13046                                  	; al = [previous_val_l]
 13047                                  	; ah = [previous_val_r]
 13048                                  	; dl = [next_val_l]
 13049                                  	; dh = [next_val_r]
 13050                                  	; original-interpltd-interpltd-interpltd-interpltd
 13051 000082D9 89C3                    	mov	ebx, eax
 13052 000082DB 2C80                    	sub	al, 80h
 13053 000082DD 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
 13054 000082E1 66AB                    	stosw		; original sample (L)
 13055 000082E3 88F8                    	mov	al, bh
 13056 000082E5 2C80                    	sub	al, 80h
 13057 000082E7 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
 13058 000082EB 66AB                    	stosw		; original sample (R)
 13059 000082ED 52                      	push	edx ; *
 13060 000082EE 88D8                    	mov	al, bl
 13061 000082F0 00D0                    	add	al, dl	; [next_val_l]
 13062 000082F2 D0D8                    	rcr	al, 1
 13063 000082F4 50                      	push	eax ; **	; al = interpolated middle (L) (temporary)
 13064 000082F5 00D8                    	add	al, bl	; [previous_val_l]
 13065 000082F7 D0D8                    	rcr	al, 1
 13066 000082F9 86D8                    	xchg	al, bl
 13067 000082FB 00D8                    	add	al, bl	; bl = interpolated 1st quarter (L) (temp)
 13068 000082FD D0D8                    	rcr	al, 1
 13069 000082FF 2C80                    	sub	al, 80h
 13070 00008301 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
 13071 00008305 66AB                    	stosw		; interpolated sample 1 (L)
 13072 00008307 88F8                    	mov	al, bh
 13073 00008309 00F0                    	add	al, dh	; [next_val_r]
 13074 0000830B D0D8                    	rcr	al, 1
 13075 0000830D 50                      	push	eax ; *** ; al = interpolated middle (R) (temporary)
 13076 0000830E 00F8                    	add	al, bh	; [previous_val_r]
 13077 00008310 D0D8                    	rcr	al, 1
 13078 00008312 86F8                    	xchg	al, bh
 13079 00008314 00F8                    	add	al, bh	; bh = interpolated 1st quarter (R) (temp)
 13080 00008316 D0D8                    	rcr	al, 1
 13081 00008318 2C80                    	sub	al, 80h
 13082 0000831A 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
 13083 0000831E 66AB                    	stosw		; interpolated sample 1 (R)
 13084 00008320 5A                      	pop	edx ; ***
 13085 00008321 58                      	pop	eax ; **	; al = interpolated middle (L) (temporary)
 13086 00008322 86D8                    	xchg	al, bl	; al = interpolated 1st quarter (L) (temp)
 13087 00008324 00D8                    	add	al, bl	; bl = interpolated middle (L) (temporary)
 13088 00008326 D0D8                    	rcr	al, 1
 13089 00008328 2C80                    	sub	al, 80h
 13090 0000832A 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
 13091 0000832E 66AB                    	stosw		; interpolated sample 2 (L)
 13092 00008330 88D0                    	mov	al, dl 	; interpolated middle (R) (temporary)
 13093 00008332 86F8                    	xchg	al, bh	; al = interpolated 1st quarter (R) (temp)
 13094 00008334 00F8                    	add	al, bh	; bh = interpolated middle (R) (temporary)
 13095 00008336 D0D8                    	rcr	al, 1
 13096 00008338 2C80                    	sub	al, 80h
 13097 0000833A 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
 13098 0000833E 66AB                    	stosw		; interpolated sample 2 (R)
 13099 00008340 5A                      	pop	edx ; *
 13100 00008341 88D8                    	mov	al, bl	; interpolated middle (L) (temporary)
 13101 00008343 00D0                    	add	al, dl	; [next_val_l]
 13102 00008345 D0D8                    	rcr	al, 1
 13103 00008347 86D8                    	xchg	al, bl	; al = interpolated middle (R) (temporary)
 13104 00008349 00D8                    	add	al, bl	; bl = interpolated 3rd quarter (L) (temp)
 13105 0000834B D0D8                    	rcr	al, 1
 13106 0000834D 2C80                    	sub	al, 80h
 13107 0000834F 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
 13108 00008353 66AB                    	stosw		; interpolated sample 3 (L)
 13109 00008355 88F8                    	mov	al, bh	
 13110 00008357 00F0                    	add	al, dh	; interpolated middle (R) + [next_val_r]
 13111 00008359 D0D8                    	rcr	al, 1
 13112 0000835B 86F8                    	xchg	al, bh	; al = interpolated middle (R)
 13113 0000835D 00F8                    	add	al, bh	; bh = interpolated 3rd quarter (R) (temp)
 13114 0000835F D0D8                    	rcr	al, 1
 13115 00008361 2C80                    	sub	al, 80h
 13116 00008363 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
 13117 00008367 66AB                    	stosw		; interpolated sample 3 (R)
 13118 00008369 88D8                    	mov	al, bl
 13119 0000836B 00D0                    	add	al, dl	; [next_val_l]
 13120 0000836D D0D8                    	rcr	al, 1
 13121 0000836F 2C80                    	sub	al, 80h
 13122 00008371 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
 13123 00008375 66AB                    	stosw		; interpolated sample 4 (L)
 13124 00008377 88F8                    	mov	al, bh
 13125 00008379 00F0                    	add	al, dh	; [next_val_r]
 13126 0000837B D0D8                    	rcr	al, 1
 13127 0000837D 2C80                    	sub	al, 80h
 13128 0000837F 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
 13129 00008383 66AB                    	stosw		; interpolated sample 4 (R)
 13130 00008385 C3                      	retn
 13131                                  
 13132                                  interpolating_4_8bit_mono:
 13133                                  	; 17/11/2023
 13134                                  	; al = [previous_val]
 13135                                  	; dl = [next_val]
 13136                                  	; original-interpolated-interpolated-interpolated
 13137 00008386 88C3                    	mov	bl, al
 13138 00008388 2C80                    	sub	al, 80h
 13139 0000838A 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
 13140 0000838E 66AB                    	stosw		; original sample (L)
 13141 00008390 66AB                    	stosw		; original sample (R)
 13142 00008392 88D8                    	mov	al, bl
 13143 00008394 00D0                    	add	al, dl	
 13144 00008396 D0D8                    	rcr	al, 1
 13145 00008398 86D8                    	xchg	al, bl  ; al = [previous_val]
 13146 0000839A 00D8                    	add	al, bl	; bl = interpolated middle (sample 2)
 13147 0000839C D0D8                    	rcr	al, 1 	
 13148 0000839E 2C80                    	sub	al, 80h
 13149 000083A0 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
 13150 000083A4 66AB                    	stosw		; interpolated sample 1 (L)
 13151 000083A6 66AB                    	stosw		; interpolated sample 1 (R)
 13152 000083A8 88D8                    	mov	al, bl	; interpolated middle (sample 2)
 13153 000083AA 2C80                    	sub	al, 80h
 13154 000083AC 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
 13155 000083B0 66AB                    	stosw		; interpolated sample 2 (L)
 13156 000083B2 66AB                    	stosw		; interpolated sample 2 (R)
 13157 000083B4 88D8                    	mov	al, bl
 13158 000083B6 00D0                    	add	al, dl	; [next_val]
 13159 000083B8 D0D8                    	rcr	al, 1
 13160 000083BA 2C80                    	sub	al, 80h
 13161 000083BC 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
 13162 000083C0 66AB                    	stosw		; interpolated sample 3 (L)
 13163 000083C2 66AB                    	stosw		; interpolated sample 3 (R)
 13164 000083C4 C3                      	retn
 13165                                  
 13166                                  interpolating_4_8bit_stereo:
 13167                                  	; 17/11/2023
 13168                                  	; al = [previous_val_l]
 13169                                  	; ah = [previous_val_r]
 13170                                  	; dl = [next_val_l]
 13171                                  	; dh = [next_val_r]	
 13172                                  	; original-interpolated-interpolated-interpolated
 13173 000083C5 89C3                    	mov	ebx, eax
 13174 000083C7 2C80                    	sub	al, 80h
 13175 000083C9 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
 13176 000083CD 66AB                    	stosw		; original sample (L)
 13177 000083CF 88F8                    	mov	al, bh
 13178 000083D1 2C80                    	sub	al, 80h
 13179 000083D3 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
 13180 000083D7 66AB                    	stosw		; original sample (R)
 13181 000083D9 88D8                    	mov	al, bl
 13182 000083DB 00D0                    	add	al, dl	; [next_val_l]
 13183 000083DD D0D8                    	rcr	al, 1
 13184 000083DF 86D8                    	xchg	al, bl	; al = [previous_val_l]
 13185 000083E1 00D8                    	add	al, bl	; bl = interpolated middle (L) (sample 2)
 13186 000083E3 D0D8                    	rcr	al, 1
 13187 000083E5 2C80                    	sub	al, 80h
 13188 000083E7 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
 13189 000083EB 66AB                    	stosw		; interpolated sample 1 (L)
 13190 000083ED 88F8                    	mov	al, bh
 13191 000083EF 00F0                    	add	al, dh	; [next_val_r]
 13192 000083F1 D0D8                    	rcr	al, 1
 13193 000083F3 86F8                    	xchg	al, bh	; al = [previous_val_h]
 13194 000083F5 00F8                    	add	al, bh	; bh = interpolated middle (R) (sample 2)
 13195 000083F7 D0D8                    	rcr	al, 1
 13196 000083F9 2C80                    	sub	al, 80h
 13197 000083FB 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
 13198 000083FF 66AB                    	stosw		; interpolated sample 1 (R)
 13199 00008401 88D8                    	mov	al, bl	; interpolated middle (L) (sample 2)
 13200 00008403 2C80                    	sub	al, 80h
 13201 00008405 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
 13202 00008409 66AB                    	stosw		; interpolated sample 2 (L)
 13203 0000840B 88F8                    	mov	al, bh	; interpolated middle (L) (sample 2)
 13204 0000840D 2C80                    	sub	al, 80h
 13205 0000840F 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
 13206 00008413 66AB                    	stosw		; interpolated sample 2 (L)
 13207 00008415 88D8                    	mov	al, bl
 13208 00008417 00D0                    	add	al, dl	; [next_val_l]
 13209 00008419 D0D8                    	rcr	al, 1
 13210 0000841B 2C80                    	sub	al, 80h
 13211 0000841D 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
 13212 00008421 66AB                    	stosw		; interpolated sample 3 (L)
 13213 00008423 88F8                    	mov	al, bh
 13214 00008425 00F0                    	add	al, dh	; [next_val_r]
 13215 00008427 D0D8                    	rcr	al, 1
 13216 00008429 2C80                    	sub	al, 80h
 13217 0000842B 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
 13218 0000842F 66AB                    	stosw		; interpolated sample 3 (R)
 13219 00008431 C3                      	retn
 13220                                  
 13221                                  interpolating_5_16bit_mono:
 13222                                  	; 18/11/2023
 13223                                  	; ax = [previous_val]
 13224                                  	; dx = [next_val]
 13225                                  	; original-interpltd-interpltd-interpltd-interpltd
 13226 00008432 66AB                    	stosw		; original sample (L)
 13227 00008434 66AB                    	stosw		; original sample (R)
 13228 00008436 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
 13229 00008439 89C3                    	mov	ebx, eax ; [previous_val]
 13230 0000843B 80C680                  	add	dh, 80h
 13231 0000843E 6601D0                  	add	ax, dx
 13232 00008441 66D1D8                  	rcr	ax, 1
 13233 00008444 50                      	push	eax ; *	; interpolated middle (temporary)
 13234 00008445 6601D8                  	add	ax, bx	; interpolated middle + [previous_val] 
 13235 00008448 66D1D8                  	rcr	ax, 1
 13236 0000844B 50                      	push	eax ; **	; interpolated 1st quarter (temporary)
 13237 0000844C 6601D8                  	add	ax, bx	; 1st quarter + [previous_val]
 13238 0000844F 66D1D8                  	rcr	ax, 1	
 13239 00008452 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
 13240 00008455 66AB                    	stosw 		; interpolated sample 1 (L)
 13241 00008457 66AB                    	stosw		; interpolated sample 1 (R)
 13242 00008459 58                      	pop	eax ; **
 13243 0000845A 5B                      	pop	ebx ; *
 13244 0000845B 6601D8                  	add	ax, bx	; 1st quarter + middle
 13245 0000845E 66D1D8                  	rcr	ax, 1	; / 2
 13246 00008461 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again	
 13247 00008464 66AB                    	stosw		; interpolated sample 2 (L)
 13248 00008466 66AB                    	stosw		; interpolated sample 2 (R)
 13249 00008468 89D8                    	mov	eax, ebx
 13250 0000846A 6601D0                  	add	ax, dx	; interpolated middle + [next_val]
 13251 0000846D 66D1D8                  	rcr	ax, 1
 13252 00008470 50                      	push	eax ; *	; interpolated 3rd quarter (temporary)
 13253 00008471 6601D8                  	add	ax, bx	; + interpolated middle
 13254 00008474 66D1D8                  	rcr	ax, 1
 13255 00008477 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
 13256 0000847A 66AB                    	stosw		; interpolated sample 3 (L)
 13257 0000847C 66AB                    	stosw		; interpolated sample 3 (R)
 13258 0000847E 58                      	pop	eax ; *	
 13259 0000847F 6601D0                  	add	ax, dx	; 3rd quarter + [next_val]
 13260 00008482 66D1D8                  	rcr	ax, 1	; / 2
 13261 00008485 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
 13262 00008488 66AB                    	stosw		; interpolated sample 4 (L)
 13263 0000848A 66AB                    	stosw		; interpolated sample 4 (R)
 13264 0000848C C3                      	retn
 13265                                  
 13266                                  interpolating_5_16bit_stereo:
 13267                                  	; 18/11/2023
 13268                                  	; bx = [previous_val_l]
 13269                                  	; ax = [previous_val_r]
 13270                                  	; [next_val_l]
 13271                                  	; [next_val_r]
 13272                                  	; original-interpltd-interpltd-interpltd-interpltd
 13273 0000848D 51                      	push	ecx ; !
 13274 0000848E 93                      	xchg	eax, ebx
 13275 0000848F 66AB                    	stosw		; original sample (L)
 13276 00008491 93                      	xchg	eax, ebx
 13277 00008492 66AB                    	stosw		; original sample (R)
 13278 00008494 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
 13279 00008497 50                      	push	eax ; *	; [previous_val_r]
 13280 00008498 80C780                  	add	bh, 80h
 13281 0000849B 8005[17860000]80        	add	byte [next_val_l+1], 80h
 13282 000084A2 66A1[16860000]          	mov	ax, [next_val_l]
 13283 000084A8 6601D8                  	add	ax, bx	; [previous_val_l]
 13284 000084AB 66D1D8                  	rcr	ax, 1
 13285 000084AE 89C1                    	mov	ecx, eax ; interpolated middle (L)
 13286 000084B0 6601D8                  	add	ax, bx	
 13287 000084B3 66D1D8                  	rcr	ax, 1
 13288 000084B6 89C2                    	mov	edx, eax ; interpolated 1st quarter (L)
 13289 000084B8 6601D8                  	add	ax, bx	; [previous_val_l]
 13290 000084BB 66D1D8                  	rcr	ax, 1
 13291 000084BE 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
 13292 000084C1 66AB                    	stosw 		; interpolated sample 1 (L)
 13293 000084C3 89C8                    	mov	eax, ecx
 13294 000084C5 6601D0                  	add	ax, dx	; middle (L) + 1st quarter (L)
 13295 000084C8 66D1D8                  	rcr	ax, 1	; / 2
 13296 000084CB 89C3                    	mov	ebx, eax  ; interpolated sample 2 (L)
 13297 000084CD 5A                      	pop	edx ; *	; [previous_val_r]
 13298 000084CE 89D0                    	mov	eax, edx
 13299 000084D0 8005[19860000]80        	add	byte [next_val_r+1], 80h
 13300 000084D7 660305[18860000]        	add	ax, [next_val_r]
 13301 000084DE 66D1D8                  	rcr	ax, 1
 13302 000084E1 50                      	push	eax ; *	; interpolated middle (R)
 13303 000084E2 6601D0                  	add	ax, dx
 13304 000084E5 66D1D8                  	rcr	ax, 1
 13305 000084E8 50                      	push	eax ; ** ; interpolated 1st quarter (R)
 13306 000084E9 6601D0                  	add	ax, dx	; [previous_val_r]
 13307 000084EC 66D1D8                  	rcr	ax, 1
 13308 000084EF 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
 13309 000084F2 66AB                    	stosw 		; interpolated sample 1 (R)
 13310 000084F4 89D8                    	mov	eax, ebx
 13311 000084F6 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
 13312 000084F9 66AB                    	stosw 		; interpolated sample 2 (L)
 13313 000084FB 58                      	pop	eax ; **
 13314 000084FC 5A                      	pop	edx ; *
 13315 000084FD 6601D0                  	add	ax, dx	; 1st quarter (R) + middle (R)
 13316 00008500 66D1D8                  	rcr	ax, 1	; / 2
 13317 00008503 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
 13318 00008506 66AB                    	stosw 		; interpolated sample 2 (R)
 13319 00008508 89C8                    	mov	eax, ecx
 13320 0000850A 660305[16860000]        	add	ax, [next_val_l]
 13321 00008511 66D1D8                  	rcr	ax, 1
 13322 00008514 50                      	push	eax ; * ; interpolated 3rd quarter (L)
 13323 00008515 6601C8                  	add	ax, cx	; interpolated middle (L)
 13324 00008518 66D1D8                  	rcr	ax, 1
 13325 0000851B 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
 13326 0000851E 66AB                    	stosw 		; interpolated sample 3 (L)
 13327 00008520 89D0                    	mov	eax, edx
 13328 00008522 660305[18860000]        	add	ax, [next_val_r]
 13329 00008529 66D1D8                  	rcr	ax, 1
 13330 0000852C 50                      	push	eax ; ** ; interpolated 3rd quarter (R)
 13331 0000852D 6601D0                  	add	ax, dx	; interpolated middle (R)
 13332 00008530 66D1D8                  	rcr	ax, 1
 13333 00008533 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
 13334 00008536 66AB                    	stosw 		; interpolated sample 3 (R)
 13335 00008538 5B                      	pop	ebx ; **
 13336 00008539 58                      	pop	eax ; *
 13337 0000853A 660305[16860000]        	add	ax, [next_val_l]
 13338 00008541 66D1D8                  	rcr	ax, 1
 13339 00008544 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
 13340 00008547 66AB                    	stosw 		; interpolated sample 4 (L)
 13341 00008549 89D8                    	mov	eax, ebx
 13342 0000854B 660305[18860000]        	add	ax, [next_val_r]
 13343 00008552 66D1D8                  	rcr	ax, 1
 13344 00008555 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
 13345 00008558 66AB                    	stosw 		; interpolated sample 4 (R)
 13346 0000855A 59                      	pop	ecx ; !
 13347 0000855B C3                      	retn
 13348                                  
 13349                                  interpolating_4_16bit_mono:
 13350                                  	; 18/11/2023
 13351                                  	; ax = [previous_val]
 13352                                  	; dx = [next_val]
 13353                                  	; original-interpolated
 13354                                  
 13355 0000855C 66AB                    	stosw		; original sample (L)
 13356 0000855E 66AB                    	stosw		; original sample (R)
 13357 00008560 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
 13358 00008563 89C3                    	mov	ebx, eax ; [previous_val]
 13359 00008565 80C680                  	add	dh, 80h
 13360 00008568 6601D0                  	add	ax, dx	; [previous_val] + [next_val]
 13361 0000856B 66D1D8                  	rcr	ax, 1
 13362 0000856E 93                      	xchg	eax, ebx
 13363 0000856F 6601D8                  	add	ax, bx	; [previous_val] + interpolated middle
 13364 00008572 66D1D8                  	rcr	ax, 1
 13365 00008575 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
 13366 00008578 66AB                    	stosw 		; interpolated sample 1 (L)
 13367 0000857A 66AB                    	stosw		; interpolated sample 1 (R)
 13368 0000857C 89D8                    	mov	eax, ebx ; interpolated middle
 13369 0000857E 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
 13370 00008581 66AB                    	stosw 		; interpolated sample 2 (L)
 13371 00008583 66AB                    	stosw		; interpolated sample 2 (R)
 13372 00008585 89D8                    	mov	eax, ebx
 13373 00008587 6601D0                  	add	ax, dx	; interpolated middle + [next_val]
 13374 0000858A 66D1D8                  	rcr	ax, 1
 13375 0000858D 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
 13376 00008590 66AB                    	stosw		; interpolated sample 3 (L)
 13377 00008592 66AB                    	stosw		; interpolated sample 3 (R)
 13378 00008594 C3                      	retn
 13379                                  
 13380                                  interpolating_4_16bit_stereo:
 13381                                  	; 18/11/2023
 13382                                  	; bx = [previous_val_l]
 13383                                  	; ax = [previous_val_r]
 13384                                  	; [next_val_l]
 13385                                  	; [next_val_r]
 13386                                  	; original-interpolated-interpolated-interpolated
 13387 00008595 93                      	xchg	eax, ebx
 13388 00008596 66AB                    	stosw		; original sample (L)
 13389 00008598 93                      	xchg	eax, ebx
 13390 00008599 66AB                    	stosw		; original sample (R)
 13391 0000859B 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
 13392 0000859E 89C2                    	mov	edx, eax ; [previous_val_r]
 13393 000085A0 80C780                  	add	bh, 80h
 13394 000085A3 8005[17860000]80        	add	byte [next_val_l+1], 80h
 13395 000085AA 66A1[16860000]          	mov	ax, [next_val_l]
 13396 000085B0 6601D8                  	add	ax, bx	; [previous_val_l]
 13397 000085B3 66D1D8                  	rcr	ax, 1
 13398 000085B6 93                      	xchg	eax, ebx
 13399 000085B7 6601D8                  	add	ax, bx	; bx = interpolated middle (L)
 13400 000085BA 66D1D8                  	rcr	ax, 1
 13401 000085BD 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
 13402 000085C0 66AB                    	stosw 		; interpolated sample 1 (L)
 13403 000085C2 8005[19860000]80        	add	byte [next_val_r+1], 80h
 13404 000085C9 89D0                    	mov	eax, edx ; [previous_val_r]
 13405 000085CB 660305[18860000]        	add	ax, [next_val_r]
 13406 000085D2 66D1D8                  	rcr	ax, 1
 13407 000085D5 92                      	xchg	eax, edx
 13408 000085D6 6601D0                  	add	ax, dx	; dx = interpolated middle (R)
 13409 000085D9 66D1D8                  	rcr	ax, 1
 13410 000085DC 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
 13411 000085DF 66AB                    	stosw 		; interpolated sample 1 (R)
 13412 000085E1 89D8                    	mov	eax, ebx
 13413 000085E3 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
 13414 000085E6 66AB                    	stosw 		; interpolated sample 2 (L)
 13415 000085E8 89D0                    	mov	eax, edx
 13416 000085EA 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
 13417 000085ED 66AB                    	stosw 		; interpolated sample 2 (R)
 13418 000085EF 89D8                    	mov	eax, ebx
 13419 000085F1 660305[16860000]        	add	ax, [next_val_l]
 13420 000085F8 66D1D8                  	rcr	ax, 1
 13421 000085FB 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
 13422 000085FE 66AB                    	stosw 		; interpolated sample 3 (L)
 13423 00008600 89D0                    	mov	eax, edx
 13424 00008602 660305[18860000]        	add	ax, [next_val_r]
 13425 00008609 66D1D8                  	rcr	ax, 1
 13426 0000860C 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
 13427 0000860F 66AB                    	stosw 		; interpolated sample 3 (R)
 13428 00008611 C3                      	retn
 13429                                  
 13430                                  ; 13/11/2023
 13431                                  previous_val:
 13432 00008612 0000                    previous_val_l: dw 0
 13433 00008614 0000                    previous_val_r: dw 0
 13434                                  next_val:
 13435 00008616 0000                    next_val_l: dw 0
 13436 00008618 0000                    next_val_r: dw 0
 13437                                  
 13438                                  ; 16/11/2023
 13439 0000861A 00                      faz:	db 0
 13440                                  
 13441                                  ; ---------------------------------------------------------------------------
 13442                                  ; 12/01/2025- Hardware Info display/write procedures.
 13443                                  ; ---------------------------------------------------------------------------
 13444                                  ; ref: playwav9.s (18/12/2024) - sb16play.s (20/12/2024)
 13445                                  
 13446                                  	; 12/01/2025
 13447                                  write_audio_dev_info:
 13448 0000861B 803D[30A20000]02        	cmp	byte [audio_hardware], 2
 13449 00008622 7203                    	jb	short write_sb16_dev_info  ; SB16
 13450 00008624 745A                    	je	short write_ac97_pci_dev_info ; AC97
 13451 00008626 C3                      	retn
 13452                                  
 13453                                  	; 20/12/2024 (playwavx.s, sb16play.s)
 13454                                  write_sb16_dev_info:
 13455                                  	; 27/11/2024
 13456                                  	; 24/11/2024 (sb16play.asm)
 13457                                  
 13458 00008627 A1[28A20000]            	mov	eax, [audio_io_base]
 13459 0000862C 31DB                    	xor	ebx, ebx
 13460 0000862E 88C3                    	mov	bl, al
 13461 00008630 88DA                    	mov	dl, bl
 13462 00008632 80E30F                  	and	bl, 0Fh
 13463 00008635 8A83[91890000]          	mov	al, [ebx+hex_chars]
 13464 0000863B A2[A48A0000]            	mov	[msgBasePort+2], al
 13465 00008640 88D3                    	mov	bl, dl
 13466 00008642 C0EB04                  	shr	bl, 4
 13467 00008645 8A83[91890000]          	mov	al, [ebx+hex_chars]
 13468 0000864B A2[A38A0000]            	mov	[msgBasePort+1], al
 13469 00008650 88E3                    	mov	bl, ah
 13470                                  	;and	bl, 0Fh
 13471 00008652 8A83[91890000]          	mov	al, [ebx+hex_chars]
 13472 00008658 A2[A28A0000]            	mov	[msgBasePort], al
 13473                                  
 13474                                  	;xor	eax, eax
 13475                                  	; 27/11/2024
 13476 0000865D A0[2CA20000]            	mov	al, [audio_intr]
 13477                                  	;mov	cl, 10
 13478                                  	;div	cl
 13479                                  	;add	ah, 30h
 13480                                  	;mov	[msgIRQnum], ah
 13481                                  	; 25/11/2024
 13482 00008662 0430                    	add	al, 30h
 13483 00008664 A2[B98A0000]            	mov	[msgIRQnum], al	; 12/01/2025
 13484                                  
 13485                                  	; 12/01/2025	
 13486                                  	; 20/12/2024
 13487                                  	sys	_msg, msgSB16Info, 255, 07h
   119                              <1> 
   120                              <1> 
   121                              <1> 
   122                              <1> 
   123                              <1>  %if %0 >= 2
   124 00008669 BB[6C8A0000]        <1>  mov ebx, %2
   125                              <1>  %if %0 >= 3
   126 0000866E B9FF000000          <1>  mov ecx, %3
   127                              <1>  %if %0 = 4
   128 00008673 BA07000000          <1>  mov edx, %4
   129                              <1>  %endif
   130                              <1>  %endif
   131                              <1>  %endif
   132 00008678 B823000000          <1>  mov eax, %1
   133                              <1> 
   134 0000867D CD40                <1>  int 40h
 13488                                  
 13489 0000867F C3                      	retn
 13490                                  	
 13491                                  write_ac97_pci_dev_info:
 13492                                  	; 19/11/2024
 13493                                  	; 30/05/2024
 13494                                  	; 06/06/2017
 13495                                  	; 03/06/2017
 13496                                  	; BUS/DEV/FN
 13497                                  	;	00000000BBBBBBBBDDDDDFFF00000000
 13498                                  	; DEV/VENDOR
 13499                                  	;	DDDDDDDDDDDDDDDDVVVVVVVVVVVVVVVV
 13500                                  
 13501 00008680 A1[20A20000]            	mov	eax, [dev_vendor]
 13502 00008685 31DB                    	xor	ebx, ebx
 13503 00008687 88C3                    	mov	bl, al
 13504 00008689 88DA                    	mov	dl, bl
 13505 0000868B 80E30F                  	and	bl, 0Fh
 13506 0000868E 8A83[91890000]          	mov	al, [ebx+hex_chars]
 13507 00008694 A2[D8890000]            	mov	[msgVendorId+3], al
 13508 00008699 88D3                    	mov	bl, dl
 13509 0000869B C0EB04                  	shr	bl, 4
 13510 0000869E 8A83[91890000]          	mov	al, [ebx+hex_chars]
 13511 000086A4 A2[D7890000]            	mov	[msgVendorId+2], al
 13512 000086A9 88E3                    	mov	bl, ah
 13513 000086AB 88DA                    	mov	dl, bl
 13514 000086AD 80E30F                  	and	bl, 0Fh
 13515 000086B0 8A83[91890000]          	mov	al, [ebx+hex_chars]
 13516 000086B6 A2[D6890000]            	mov	[msgVendorId+1], al
 13517 000086BB 88D3                    	mov	bl, dl
 13518 000086BD C0EB04                  	shr	bl, 4
 13519 000086C0 8A83[91890000]          	mov	al, [ebx+hex_chars]
 13520 000086C6 A2[D5890000]            	mov	[msgVendorId], al
 13521 000086CB C1E810                  	shr	eax, 16
 13522 000086CE 88C3                    	mov	bl, al
 13523 000086D0 88DA                    	mov	dl, bl
 13524 000086D2 80E30F                  	and	bl, 0Fh
 13525 000086D5 8A83[91890000]          	mov	al, [ebx+hex_chars]
 13526 000086DB A2[E9890000]            	mov	[msgDevId+3], al
 13527 000086E0 88D3                    	mov	bl, dl
 13528 000086E2 C0EB04                  	shr	bl, 4
 13529 000086E5 8A83[91890000]          	mov	al, [ebx+hex_chars]
 13530 000086EB A2[E8890000]            	mov	[msgDevId+2], al
 13531 000086F0 88E3                    	mov	bl, ah
 13532 000086F2 88DA                    	mov	dl, bl
 13533 000086F4 80E30F                  	and	bl, 0Fh
 13534 000086F7 8A83[91890000]          	mov	al, [ebx+hex_chars]
 13535 000086FD A2[E7890000]            	mov	[msgDevId+1], al
 13536 00008702 88D3                    	mov	bl, dl
 13537 00008704 C0EB04                  	shr	bl, 4
 13538 00008707 8A83[91890000]          	mov	al, [ebx+hex_chars]
 13539 0000870D A2[E6890000]            	mov	[msgDevId], al
 13540                                  
 13541 00008712 A1[1CA20000]            	mov	eax, [bus_dev_fn]
 13542 00008717 C1E808                  	shr	eax, 8
 13543 0000871A 88C3                    	mov	bl, al
 13544 0000871C 88DA                    	mov	dl, bl
 13545 0000871E 80E307                  	and	bl, 7 ; bit 0,1,2
 13546 00008721 8A83[91890000]          	mov	al, [ebx+hex_chars]
 13547 00008727 A2[0E8A0000]            	mov	[msgFncNo+1], al
 13548 0000872C 88D3                    	mov	bl, dl
 13549 0000872E C0EB03                  	shr	bl, 3
 13550 00008731 88DA                    	mov	dl, bl
 13551 00008733 80E30F                  	and	bl, 0Fh
 13552 00008736 8A83[91890000]          	mov	al, [ebx+hex_chars]
 13553 0000873C A2[008A0000]            	mov	[msgDevNo+1], al
 13554 00008741 88D3                    	mov	bl, dl
 13555 00008743 C0EB04                  	shr	bl, 4
 13556 00008746 8A83[91890000]          	mov	al, [ebx+hex_chars]
 13557 0000874C A2[FF890000]            	mov	[msgDevNo], al
 13558 00008751 88E3                    	mov	bl, ah
 13559 00008753 88DA                    	mov	dl, bl
 13560 00008755 80E30F                  	and	bl, 0Fh
 13561 00008758 8A83[91890000]          	mov	al, [ebx+hex_chars]
 13562 0000875E A2[F4890000]            	mov	[msgBusNo+1], al
 13563 00008763 88D3                    	mov	bl, dl
 13564 00008765 C0EB04                  	shr	bl, 4
 13565 00008768 8A83[91890000]          	mov	al, [ebx+hex_chars]
 13566 0000876E A2[F3890000]            	mov	[msgBusNo], al
 13567                                  
 13568                                  	;mov	ax, [ac97_NamBar]
 13569 00008773 66A1[24A20000]          	mov	ax, [NAMBAR]
 13570 00008779 88C3                    	mov	bl, al
 13571 0000877B 88DA                    	mov	dl, bl
 13572 0000877D 80E30F                  	and	bl, 0Fh
 13573 00008780 8A83[91890000]          	mov	al, [ebx+hex_chars]
 13574 00008786 A2[1E8A0000]            	mov	[msgNamBar+3], al
 13575 0000878B 88D3                    	mov	bl, dl
 13576 0000878D C0EB04                  	shr	bl, 4
 13577 00008790 8A83[91890000]          	mov	al, [ebx+hex_chars]
 13578 00008796 A2[1D8A0000]            	mov	[msgNamBar+2], al
 13579 0000879B 88E3                    	mov	bl, ah
 13580 0000879D 88DA                    	mov	dl, bl
 13581 0000879F 80E30F                  	and	bl, 0Fh
 13582 000087A2 8A83[91890000]          	mov	al, [ebx+hex_chars]
 13583 000087A8 A2[1C8A0000]            	mov	[msgNamBar+1], al
 13584 000087AD 88D3                    	mov	bl, dl
 13585 000087AF C0EB04                  	shr	bl, 4
 13586 000087B2 8A83[91890000]          	mov	al, [ebx+hex_chars]
 13587 000087B8 A2[1B8A0000]            	mov	[msgNamBar], al
 13588                                  
 13589                                  	;mov	ax, [ac97_NabmBar]
 13590 000087BD 66A1[26A20000]          	mov	ax, [NABMBAR]
 13591 000087C3 88C3                    	mov	bl, al
 13592 000087C5 88DA                    	mov	dl, bl
 13593 000087C7 80E30F                  	and	bl, 0Fh
 13594 000087CA 8A83[91890000]          	mov	al, [ebx+hex_chars]
 13595 000087D0 A2[2E8A0000]            	mov	[msgNabmBar+3], al
 13596 000087D5 88D3                    	mov	bl, dl
 13597 000087D7 C0EB04                  	shr	bl, 4
 13598 000087DA 8A83[91890000]          	mov	al, [ebx+hex_chars]
 13599 000087E0 A2[2D8A0000]            	mov	[msgNabmBar+2], al
 13600 000087E5 88E3                    	mov	bl, ah
 13601 000087E7 88DA                    	mov	dl, bl
 13602 000087E9 80E30F                  	and	bl, 0Fh
 13603 000087EC 8A83[91890000]          	mov	al, [ebx+hex_chars]
 13604 000087F2 A2[2C8A0000]            	mov	[msgNabmBar+1], al
 13605 000087F7 88D3                    	mov	bl, dl
 13606 000087F9 C0EB04                  	shr	bl, 4
 13607 000087FC 8A83[91890000]          	mov	al, [ebx+hex_chars]
 13608 00008802 A2[2B8A0000]            	mov	[msgNabmBar], al
 13609                                  
 13610 00008807 31C0                    	xor	eax, eax
 13611 00008809 A0[2CA20000]            	mov	al, [ac97_int_ln_reg]
 13612 0000880E B10A                    	mov	cl, 10
 13613 00008810 F6F1                    	div	cl
 13614                                  	; 23/11/2024
 13615                                  	;add	[msgIRQ], ax
 13616 00008812 66053030                	add	ax, 3030h
 13617 00008816 66A3[378A0000]          	mov	[msgIRQ], ax
 13618                                  	;and	al, al
 13619 0000881C 3C30                    	cmp	al, 30h
 13620 0000881E 750D                    	jnz	short _w_ac97imsg_
 13621 00008820 A0[388A0000]            	mov	al, byte [msgIRQ+1]
 13622 00008825 B420                    	mov	ah, ' '
 13623 00008827 66A3[378A0000]          	mov	[msgIRQ], ax
 13624                                  _w_ac97imsg_:
 13625                                  	; 12/01/2025
 13626                                  	; 01/12/2024
 13627                                  	sys	_msg, msgAC97Info, 255, 07h
   119                              <1> 
   120                              <1> 
   121                              <1> 
   122                              <1> 
   123                              <1>  %if %0 >= 2
   124 0000882D BB[A2890000]        <1>  mov ebx, %2
   125                              <1>  %if %0 >= 3
   126 00008832 B9FF000000          <1>  mov ecx, %3
   127                              <1>  %if %0 = 4
   128 00008837 BA07000000          <1>  mov edx, %4
   129                              <1>  %endif
   130                              <1>  %endif
   131                              <1>  %endif
   132 0000883C B823000000          <1>  mov eax, %1
   133                              <1> 
   134 00008841 CD40                <1>  int 40h
 13628                                  
 13629                                  	; 19/11/2024
 13630                                          ;retn
 13631                                  
 13632                                  	; 30/05/2024
 13633                                  write_VRA_info:
 13634                                  	; 12/01/2025
 13635                                  	; 01/12/2024
 13636                                  	sys	_msg, msgVRAheader, 255, 07h
   119                              <1> 
   120                              <1> 
   121                              <1> 
   122                              <1> 
   123                              <1>  %if %0 >= 2
   124 00008843 BB[3C8A0000]        <1>  mov ebx, %2
   125                              <1>  %if %0 >= 3
   126 00008848 B9FF000000          <1>  mov ecx, %3
   127                              <1>  %if %0 = 4
   128 0000884D BA07000000          <1>  mov edx, %4
   129                              <1>  %endif
   130                              <1>  %endif
   131                              <1>  %endif
   132 00008852 B823000000          <1>  mov eax, %1
   133                              <1> 
   134 00008857 CD40                <1>  int 40h
 13637 00008859 803D[31A20000]00        	cmp	byte [vra], 0
 13638 00008860 7617                    	jna	short _w_VRAi_no
 13639                                  _w_VRAi_yes:
 13640                                  	sys	_msg, msgVRAyes, 255, 07h
   119                              <1> 
   120                              <1> 
   121                              <1> 
   122                              <1> 
   123                              <1>  %if %0 >= 2
   124 00008862 BB[4B8A0000]        <1>  mov ebx, %2
   125                              <1>  %if %0 >= 3
   126 00008867 B9FF000000          <1>  mov ecx, %3
   127                              <1>  %if %0 = 4
   128 0000886C BA07000000          <1>  mov edx, %4
   129                              <1>  %endif
   130                              <1>  %endif
   131                              <1>  %endif
   132 00008871 B823000000          <1>  mov eax, %1
   133                              <1> 
   134 00008876 CD40                <1>  int 40h
 13641 00008878 C3                      	retn
 13642                                  _w_VRAi_no:
 13643                                  	sys	_msg, msgVRAno, 255, 07h
   119                              <1> 
   120                              <1> 
   121                              <1> 
   122                              <1> 
   123                              <1>  %if %0 >= 2
   124 00008879 BB[518A0000]        <1>  mov ebx, %2
   125                              <1>  %if %0 >= 3
   126 0000887E B9FF000000          <1>  mov ecx, %3
   127                              <1>  %if %0 = 4
   128 00008883 BA07000000          <1>  mov edx, %4
   129                              <1>  %endif
   130                              <1>  %endif
   131                              <1>  %endif
   132 00008888 B823000000          <1>  mov eax, %1
   133                              <1> 
   134 0000888D CD40                <1>  int 40h
 13644                                  	
 13645                                  	; 13/01/2025
 13646 0000888F 803D[44A20000]00        	cmp	byte [interpolation], 0
 13647 00008896 7717                    	ja	short _w_VRAi_no_yes
 13648                                  
 13649                                  	sys	_msg, crlf, 2, 07h
   119                              <1> 
   120                              <1> 
   121                              <1> 
   122                              <1> 
   123                              <1>  %if %0 >= 2
   124 00008898 BB[BA8A0000]        <1>  mov ebx, %2
   125                              <1>  %if %0 >= 3
   126 0000889D B902000000          <1>  mov ecx, %3
   127                              <1>  %if %0 = 4
   128 000088A2 BA07000000          <1>  mov edx, %4
   129                              <1>  %endif
   130                              <1>  %endif
   131                              <1>  %endif
   132 000088A7 B823000000          <1>  mov eax, %1
   133                              <1> 
   134 000088AC CD40                <1>  int 40h
 13650                                  
 13651 000088AE C3                      	retn
 13652                                  
 13653                                  _w_VRAi_no_yes:
 13654                                  	sys	_msg, msgInterp, 255, 07h
   119                              <1> 
   120                              <1> 
   121                              <1> 
   122                              <1> 
   123                              <1>  %if %0 >= 2
   124 000088AF BB[558A0000]        <1>  mov ebx, %2
   125                              <1>  %if %0 >= 3
   126 000088B4 B9FF000000          <1>  mov ecx, %3
   127                              <1>  %if %0 = 4
   128 000088B9 BA07000000          <1>  mov edx, %4
   129                              <1>  %endif
   130                              <1>  %endif
   131                              <1>  %endif
   132 000088BE B823000000          <1>  mov eax, %1
   133                              <1> 
   134 000088C3 CD40                <1>  int 40h
 13655 000088C5 C3                      	retn
 13656                                  
 13657                                  ; ---------------------------------------------------------------------------
 13658                                  
 13659                                  	; 13/01/2025
 13660                                  	; 12/01/2025
 13661                                  write_buffer_size:
 13662                                  	;;;	
 13663 000088C6 A0[36A20000]            	mov	al, [blocks]	; (must be less than 10) 
 13664 000088CB 0430                    	add	al, '0'
 13665 000088CD A2[45890000]            	mov	byte [blocks_txt], al
 13666                                  	;;;
 13667 000088D2 803D[44A20000]01        	cmp	byte [interpolation], 1
 13668 000088D9 731F                    	jnb	short write_buffer_size_x
 13669                                  	;;;
 13670 000088DB BA[2D890000]            	mov	edx, buffersize_txt
 13671 000088E0 E82EDDFFFF              	call	wrstr_edx
 13672 000088E5 A1[38A20000]            	mov	eax, [buffer_size]
 13673                                  w_dbuff_size:
 13674 000088EA E85ADDFFFF              	call	wr_decimal_eax_with_thousands_seperator
 13675 000088EF BA[3D890000]            	mov	edx, bytes_txt
 13676 000088F4 E81ADDFFFF              	call	wrstr_edx
 13677 000088F9 C3                      	retn
 13678                                  
 13679                                  	; 13/01/2025 (Indirect interpolation info)
 13680                                  write_buffer_size_x:
 13681 000088FA BA[52890000]            	mov	edx, buffers1_txt
 13682 000088FF E80FDDFFFF              	call	wrstr_edx
 13683 00008904 A1[40A20000]            	mov	eax, [loadsize] ; decoding buffer size
 13684 00008909 E8DCFFFFFF              	call	w_dbuff_size
 13685 0000890E BA[76890000]            	mov	edx, buffers2_txt
 13686 00008913 E8FBDCFFFF              	call	wrstr_edx
 13687 00008918 A1[38A20000]            	mov	eax, [buffer_size] ; wav buffer size
 13688 0000891D E827DDFFFF              	call	wr_decimal_eax_with_thousands_seperator
 13689 00008922 BA[87890000]            	mov	edx, bytes2_txt
 13690 00008927 E8E7DCFFFF              	call	wrstr_edx
 13691 0000892C C3                      	retn
 13692                                  
 13693                                  ; 11/01/2025
 13694 0000892D 0D0A                    buffersize_txt	db 0Dh, 0Ah
 13695 0000892F 427566666572205369-     		db 'Buffer Size: ', 0
 13695 00008938 7A653A2000         
 13696                                  ; 12/01/2025
 13697                                  ;bytes_txt:	db ' bytes ', 0Dh, 0Ah, 0
 13698 0000893D 2062797465732028        bytes_txt:	db ' bytes ('
 13699 00008945 3020626C6F636B7329-     blocks_txt	db '0 blocks) ', 0Dh, 0Ah, 0
 13699 0000894E 200D0A00           
 13700                                  
 13701                                  ; 13/01/2025
 13702 00008952 0D0A                    buffers1_txt	db 0Dh, 0Ah
 13703 00008954 427566666572207369-     		db 'Buffer size for', 0Dh, 0Ah
 13703 0000895D 7A6520666F720D0A   
 13704 00008965 202020206465636F64-     		db '    decoding is ', 0
 13704 0000896E 696E672069732000   
 13705 00008976 2020776176206F7574-     buffers2_txt	db '  wav output is ', 0
 13705 0000897F 7075742069732000   
 13706 00008987 206279746573200D0A-     bytes2_txt:	db ' bytes ', 0Dh, 0Ah, 0		
 13706 00008990 00                 
 13707                                  
 13708                                  ; ---------------------------------------------------------------------------
 13709                                  
 13710                                  ; 19/11/2024
 13711                                  ; 03/06/2017
 13712 00008991 303132333435363738-     hex_chars	db "0123456789ABCDEF", 0
 13712 0000899A 3941424344454600   
 13713 000089A2 0D0A                    msgAC97Info	db 0Dh, 0Ah
 13714 000089A4 204143393720417564-     		db " AC97 Audio Controller & Codec Info", 0Dh, 0Ah
 13714 000089AD 696F20436F6E74726F-
 13714 000089B6 6C6C6572202620436F-
 13714 000089BF 64656320496E666F0D-
 13714 000089C8 0A                 
 13715 000089C9 2056656E646F722049-     		db " Vendor ID: "
 13715 000089D2 443A20             
 13716 000089D5 303030306820446576-     msgVendorId	db "0000h Device ID: "
 13716 000089DE 6963652049443A20   
 13717 000089E6 30303030680D0A          msgDevId	db "0000h", 0Dh, 0Ah
 13718 000089ED 204275733A20            		db " Bus: "
 13719 000089F3 303068204465766963-     msgBusNo	db "00h Device: "
 13719 000089FC 653A20             
 13720 000089FF 3030682046756E6374-     msgDevNo	db "00h Function: "
 13720 00008A08 696F6E3A20         
 13721 00008A0D 303068                  msgFncNo	db "00h"
 13722 00008A10 0D0A                    		db 0Dh, 0Ah
 13723 00008A12 204E414D4241523A20      		db " NAMBAR: "
 13724 00008A1B 30303030682020          msgNamBar	db "0000h  "
 13725 00008A22 4E41424D4241523A20      		db "NABMBAR: "
 13726 00008A2B 303030306820204952-     msgNabmBar	db "0000h  IRQ: "
 13726 00008A34 513A20             
 13727 00008A37 3030                    msgIRQ		dw 3030h
 13728 00008A39 0D0A00                  		db 0Dh, 0Ah, 0
 13729                                  ; 25/11/2023
 13730 00008A3C 205652412073757070-     msgVRAheader	db " VRA support: "
 13730 00008A45 6F72743A20         
 13731 00008A4A 00                      		db 0	
 13732 00008A4B 5945530D0A00            msgVRAyes	db "YES", 0Dh, 0Ah, 0
 13733 00008A51 4E4F20                  msgVRAno	db "NO " ; 13/01/2025	
 13734                                  		;db "NO ", 0Dh, 0Ah
 13735                                  		; 12/01/2025
 13736                                  		;db " (Interpolated sample rate playing method)"
 13737 00008A54 00                      		db 0
 13738                                  		;db 0Dh, 0Ah, 0
 13739                                  
 13740                                  		; 13/01/2025
 13741 00008A55 28494E544552504F4C-     msgInterp	db "(INTERPOLATION: YES)"
 13741 00008A5E 4154494F4E3A205945-
 13741 00008A67 5329               
 13742 00008A69 0D0A00                  		db 0Dh, 0Ah, 0	
 13743                                  
 13744                                  ; ----------------------------------
 13745                                  
 13746                                  ; 24/11/2024
 13747 00008A6C 0D0A                    msgSB16Info	db 0Dh, 0Ah
 13748 00008A6E 20417564696F204861-     		db " Audio Hardware: Sound Blaster 16", 0Dh, 0Ah 
 13748 00008A77 7264776172653A2053-
 13748 00008A80 6F756E6420426C6173-
 13748 00008A89 7465722031360D0A   
 13749 00008A91 202020202020426173-     		db "      Base Port: "
 13749 00008A9A 6520506F72743A20   
 13750 00008AA2 303030680D0A            msgBasePort	db "000h", 0Dh, 0Ah 
 13751 00008AA8 202020202020202020-     		db "            IRQ: "
 13751 00008AB1 2020204952513A20   
 13752 00008AB9 30                      msgIRQnum	db 30h		; 12/01/2025
 13753                                  crlf:		; 13/01/2025
 13754 00008ABA 0D0A00                  		db 0Dh, 0Ah, 0
 13755                                  
 13756                                  
 13757                                  ; 13/01/2025
 13758                                  ; ----------------------------------
 13759                                  ; 25/11/2023
 13760                                  msg_no_vra:
 13761 00008ABD 0A0D                    		db 10, 13
 13762 00008ABF 4E6F20565241207375-     		db "No VRA support ! Only 48 kHZ sample rate supported !"
 13762 00008AC8 70706F72742021204F-
 13762 00008AD1 6E6C79203438206B48-
 13762 00008ADA 5A2073616D706C6520-
 13762 00008AE3 726174652073757070-
 13762 00008AEC 6F727465642021     
 13763 00008AF3 0A0D00                  		db 10, 13, 0
 13764                                  
 13765                                  ; ===========================================================================
 13766                                  ; end of TRDOS 386 specific procedures.
 13767                                  ; ---------------------------------------------------------------------------
 13768                                  
 13769                                  ; ===========================================================================
 13770                                  ; Initialized DATA
 13771                                  ; ===========================================================================
 13772                                  
 13773 00008AF6 00                      option_test     db 0                   
 13774 00008AF7 00                      option_mono     db 0                   
 13775 00008AF8 00                      option_8bit     db 0                   
 13776 00008AF9 00                      option_rate_shift db 0                 
 13777 00008AFA 00                      option_fast     db 0                   
 13778 00008AFB 90                                      align 4
 13779 00008AFC 00000000                cpuid_flags     dd 0                   
 13780 00008B00 00                      cpuid_exists    db 0                   
 13781 00008B01 00                      detected_cpu    db 0                   
 13782 00008B02 90<rep 2h>                              align 4
 13783 00008B04 00000000                mp3_output_milliseconds dd 0           
 13784 00008B08 00000000                millisecond_count dd 0
 13785                                  
 13786                                  ; 20/10/2024                 
 13787                                  ; HANDLE hProcess
 13788                                  ;hProcess       dd 0                   
 13789                                  ; HANDLE hThread
 13790                                  ;hThread        dd 0                   
 13791                                  ; DWORD dwPriorityClass
 13792                                  ;dwPriorityClass dd 0                   
 13793                                  ; int nPriority
 13794                                  ;nPriority      dd 0
 13795                                                     
 13796 00008B0C 0000000000000000        ttt             dd 2 dup(0)            
 13797 00008B14 726561642068656164-     rdtsc_read_header db 'read header    ',0
 13797 00008B1D 65722020202000     
 13798 00008B24 0000000000000000        rdtsc_read_header_extra dd  0, 0       
 13799 00008B2C 726561642065787472-                     db 'read extra     ',0
 13799 00008B35 61202020202000     
 13800 00008B3C 0000000000000000        rdtsc_read_granule dd 0, 0             
 13801 00008B44 72656164206772616E-                     db 'read granule   ',0
 13801 00008B4D 756C6520202000     
 13802 00008B54 0000000000000000        rdtsc_append_main dd 2 dup(0)          
 13803 00008B5C 617070656E64206D61-                     db 'append main    ',0
 13803 00008B65 696E2020202000     
 13804 00008B6C 0000000000000000        rdtsc_read_scalefac dd 2 dup(0)        
 13805 00008B74 72656164207363616C-                     db 'read scalefac  ',0
 13805 00008B7D 65666163202000     
 13806 00008B84 0000000000000000        rdtsc_xlat_scalefac dd 2 dup(0)        
 13807 00008B8C 786C6174207363616C-                     db 'xlat scalefac  ',0
 13807 00008B95 65666163202000     
 13808 00008B9C 0000000000000000        rdtsc_read_huffman dd 2 dup(0)         
 13809 00008BA4 726561642068756666-                     db 'read huffman   ',0
 13809 00008BAD 6D616E20202000     
 13810 00008BB4 0000000000000000        rdtsc_ms_stereo dd 2 dup(0)            
 13811 00008BBC 6D732073746572656F-                     db 'ms stereo      ',0
 13811 00008BC5 20202020202000     
 13812 00008BCC 0000000000000000        rdtsc_i_stereo  dd 2 dup(0)            
 13813 00008BD4 692073746572656F20-                     db 'i stereo       ',0
 13813 00008BDD 20202020202000     
 13814 00008BE4 0000000000000000        rdtsc_reorder   dd 2 dup(0)            
 13815 00008BEC 72656F726465722020-                     db 'reorder        ',0
 13815 00008BF5 20202020202000     
 13816 00008BFC 0000000000000000        rdtsc_antialias dd 2 dup(0)            
 13817 00008C04 616E7469616C696173-                     db 'antialias      ',0
 13817 00008C0D 20202020202000     
 13818 00008C14 0000000000000000        rdtsc_imdct     dd 2 dup(0)            
 13819 00008C1C 696D64637420202020-                     db 'imdct          ',0
 13819 00008C25 20202020202000     
 13820 00008C2C 0000000000000000        rdtsc_imdct36   dd 2 dup(0)            
 13821 00008C34 20696D646374333620-                     db ' imdct36       ',0
 13821 00008C3D 20202020202000     
 13822 00008C44 0000000000000000        rdtsc_imdct12   dd 2 dup(0)            
 13823 00008C4C 20696D646374313220-                     db ' imdct12       ',0
 13823 00008C55 20202020202000     
 13824 00008C5C 0000000000000000        rdtsc_imdct0    dd 2 dup(0)            
 13825 00008C64 20696D646374302020-                     db ' imdct0        ',0
 13825 00008C6D 20202020202000     
 13826 00008C74 0000000000000000        rdtsc_synth_dct dd 2 dup(0)            
 13827 00008C7C 73796E74682F646374-                     db 'synth/dct      ',0
 13827 00008C85 20202020202000     
 13828 00008C8C 0000000000000000        rdtsc_dct32     dd 2 dup(0)            
 13829 00008C94 2073796E74682E6463-                     db ' synth.dct32   ',0
 13829 00008C9D 74333220202000     
 13830 00008CA4 0000000000000000        rdtsc_synth     dd 2 dup(0)            
 13831 00008CAC 2073796E74682E6F75-                     db ' synth.output  ',0
 13831 00008CB5 74707574202000     
 13832 00008CBC 0000000000000000        rdtsc_total     dd 2 dup(0)            
 13833 00008CC4 746F74616C20202020-                     db 'total          ',0
 13833 00008CCD 20202020202000     
 13834 00008CD4 000020002800300038-     mp3_bitrate_tab dw  0,32,40,48,56,64,80,96,112,128,160,192,224,256,320, 0
 13834 00008CDD 004000500060007000-
 13834 00008CE6 8000A000C000E00000-
 13834 00008CEF 0140010000         
 13835 00008CF4 000008001000180020-                     dw  0, 8,16,24,32,40,48,56,64,80,96,112,128,144,160, 0
 13835 00008CFD 002800300038004000-
 13835 00008D06 500060007000800090-
 13835 00008D0F 00A0000000         
 13836 00008D14 44AC80BB007D            mp3_freq_tab    dw 44100,48000,32000   
 13837 00008D1A 000504040000            mp3_lsf_sf_expand_init_table db 0, 5, 4, 4, 0, 0
 13838 00008D20 9001                                    dw 400                  ; 0..399 ; normal case
 13839 00008D22 000504010C00                            db 0, 5, 4, 1, 0Ch, 0
 13840 00008D28 F401                                    dw 500                  ; 400..499
 13841 00008D2A 000301011801                            db 0, 3, 1, 1, 18h, 1
 13842 00008D30 0002                                    dw 512                  ; 500..511
 13843 00008D32 010606012400                            db 1, 6, 6, 1, 24h, 0
 13844 00008D38 6803                                    dw 872                  ; 512+360 ; 0..359 for 2nd channel of intensity stereo
 13845 00008D3A 010404013000                            db 1, 4, 4, 1, 30h, 0
 13846 00008D40 E803                                    dw 1000                 ; 512+488 ; 360..487
 13847 00008D42 010301013C00                            db 1, 3, 1, 1, 3Ch, 0
 13848 00008D48 0004                                    dw 1024                 ; 512+512 ; 488..511
 13849 00008D4A 010000000000000000-     mp3_synth_win_src dw      1,     0,     0,     0,     0,     0,     1,     0
 13849 00008D53 00000001000000     
 13850 00008D5A 000000000100000001-                     dw      0,     0,     1,     0,     1,     0,     1,     0
 13850 00008D63 00000001000000     
 13851 00008D6A 010001000000010001-                     dw      1,     1,     0,     1,     1,     1,     1,     2
 13851 00008D73 00010001000200     
 13852 00008D7A 010002000100020002-                     dw      1,     2,     1,     2,     2,     3,     2,     3
 13852 00008D83 00030002000300     
 13853 00008D8A 020004000300030004-                     dw      2,     4,     3,     3,     4,     4,     4,     5
 13853 00008D93 00040004000500     
 13854 00008D9A 050005000500060006-                     dw      5,     5,     5,     6,     6,     6,     6,     7
 13854 00008DA3 00060006000700     
 13855 00008DAA 070006000800070007-                     dw      7,     6,     8,     7,     7,     8,     7,     7
 13855 00008DB3 00080007000700     
 13856 00008DBA 080007000700070006-                     dw      8,     7,     7,     7,     6,     6,     6,     5
 13856 00008DC3 00060006000500     
 13857 00008DCA 51FEFCFFFDFFFEFFFF-                     dw 0FE51h,0FFFCh,0FFFDh,0FFFEh,0FFFFh,     0,     1,     3
 13857 00008DD3 FF000001000300     
 13858 00008DDA 03000600070008000B-                     dw      3,     6,     7,     8,   0Bh,   0Ch,   0Eh,   11h
 13858 00008DE3 000C000E001100     
 13859 00008DEA 1300150017001A001C-                     dw    13h,   15h,   17h,   1Ah,   1Ch,   1Fh,   22h,   24h
 13859 00008DF3 001F0022002400     
 13860 00008DFA 27002A002C002F0032-                     dw    27h,   2Ah,   2Ch,   2Fh,   32h,   35h,   36h,   3Ah
 13860 00008E03 00350036003A00     
 13861 00008E0A 3C003E004000420044-                     dw    3Ch,   3Eh,   40h,   42h,   44h,   45h,   47h,   48h
 13861 00008E13 00450047004800     
 13862 00008E1A 490049004900490049-                     dw    49h,   49h,   49h,   49h,   49h,   48h,   46h,   45h
 13862 00008E23 00480046004500     
 13863 00008E2A 430040003D003A0035-                     dw    43h,   40h,   3Dh,   3Ah,   35h,   31h,   2Bh,   27h
 13863 00008E33 0031002B002700     
 13864 00008E3A 1F00190012000A0002-                     dw    1Fh,   19h,   12h,   0Ah,     2,0FFF9h,0FFEFh,0FFE6h
 13864 00008E43 00F9FFEFFFE6FF     
 13865 00008E4A 3BF030003B00470053-                     dw 0F03Bh,   30h,   3Bh,   47h,   53h,   5Fh,   6Dh,   79h
 13865 00008E53 005F006D007900     
 13866 00008E5A 86009500A100B000BD-                     dw    86h,   95h,  0A1h,  0B0h,  0BDh,  0CBh,  0D9h,  0E6h
 13866 00008E63 00CB00D900E600     
 13867 00008E6A F30001010D01190125-                     dw   0F3h,  101h,  10Dh,  119h,  125h,  130h,  13Ah,  144h
 13867 00008E73 0130013A014401     
 13868 00008E7A 4D0155015B01620166-                     dw   14Dh,  155h,  15Bh,  162h,  166h,  16Ah,  16Bh,  16Dh
 13868 00008E83 016A016B016D01     
 13869 00008E8A 6C016A01660160015A-                     dw   16Ch,  16Ah,  166h,  160h,  15Ah,  150h,  146h,  139h
 13869 00008E93 01500146013901     
 13870 00008E9A 2B011A010801F300DD-                     dw   12Bh,  11Ah,  108h,  0F3h,  0DDh,  0C5h,  0A9h,   8Eh
 13870 00008EA3 00C500A9008E00     
 13871 00008EAA 6F004E002B000700E1-                     dw    6Fh,   4Eh,   2Bh,     7,0FFE1h,0FFB8h,0FF8Fh,0FF62h
 13871 00008EB3 FFB8FF8FFF62FF     
 13872 00008EBA 35FF06FFD5FEA4FE70-                     dw 0FF35h,0FF06h,0FED5h,0FEA4h,0FE70h,0FE3Ch,0FE06h,0FDD0h
 13872 00008EC3 FE3CFE06FED0FD     
 13873 00008ECA 0BCF9F02D702110349-                     dw 0CF0Bh,  29Fh,  2D7h,  311h,  349h,  382h,  3BBh,  3F4h
 13873 00008ED3 038203BB03F403     
 13874 00008EDA 2C0464049A04D10405-                     dw   42Ch,  464h,  49Ah,  4D1h,  505h,  538h,  56Ah,  59Bh
 13874 00008EE3 0538056A059B05     
 13875 00008EEA C805F505200647066C-                     dw   5C8h,  5F5h,  620h,  647h,  66Ch,  68Fh,  6AFh,  6CCh
 13875 00008EF3 068F06AF06CC06     
 13876 00008EFA E506FC060F071F072B-                     dw   6E5h,  6FCh,  70Fh,  71Fh,  72Bh,  734h,  739h,  739h
 13876 00008F03 07340739073907     
 13877 00008F0A 370730072607170704-                     dw   737h,  730h,  726h,  717h,  704h,  6EDh,  6D3h,  6B4h
 13877 00008F13 07ED06D306B406     
 13878 00008F1A 91066C0640061306E1-                     dw   691h,  66Ch,  640h,  613h,  5E1h,  5ABh,  573h,  537h
 13878 00008F23 05AB0573053705     
 13879 00008F2A F704B4046F042704DB-                     dw   4F7h,  4B4h,  46Fh,  427h,  3DBh,  38Fh,  33Eh,  2EDh
 13879 00008F33 038F033E03ED02     
 13880 00008F3A 9A024402ED0195013D-                     dw   29Ah,  244h,  1EDh,  195h,  13Dh,  0E2h,   88h,   2Eh
 13880 00008F43 01E20088002E00     
 13881 00008F4A 00                                      db    0
 13882 00008F4B 00                                      db    0
 13883 00008F4C 000000010002000303-     mp3_slen_table  dw  0000h, 0100h, 0200h, 0300h, 0003h, 0101h, 0201h, 0301h
 13883 00008F55 00010101020103     
 13884 00008F5C 020102020203030103-                     dw  0102h, 0202h, 0302h, 0103h, 0203h, 0303h, 0204h, 0304h
 13884 00008F65 02030304020403     
 13885 00008F6C 060505050909090906-     mp3_lsf_nsf_table dd  05050506h, 09090909h, 09090906h
 13885 00008F75 090909             
 13886 00008F78 0605070309090C0606-                     dd  03070506h, 060C0909h, 060C0906h
 13886 00008F81 090C06             
 13887 00008F84 0B0A0000121200000F-                     dd  00000A0Bh, 00001212h, 0000120Fh
 13887 00008F8D 120000             
 13888 00008F90 070707000C0C0C0006-                     dd  00070707h, 000C0C0Ch, 000C0F06h
 13888 00008F99 0F0C00             
 13889 00008F9C 060606030C09090606-                     dd  03060606h, 0609090Ch, 06090C06h
 13889 00008FA5 0C0906             
 13890 00008FA8 080805000F0C090006-                     dd  00050808h, 00090C0Fh, 00091206h
 13890 00008FB1 120900             
 13891 00008FB4 1101100022021221        huff_tree_list_data db  11h,   1, 10h,   0, 22h,   2, 12h, 21h
 13892 00008FBC 2011011000220212                        db  20h, 11h,   1, 10h,   0, 22h,   2, 12h
 13893 00008FC4 2120101101003323                        db  21h, 20h, 10h, 11h,   1,   0, 33h, 23h
 13894 00008FCC 3231130330221221                        db  32h, 31h, 13h,   3, 30h, 22h, 12h, 21h
 13895 00008FD4 0220110110003303                        db    2, 20h, 11h,   1, 10h,   0, 33h,   3
 13896 00008FDC 2332301331220212                        db  23h, 32h, 30h, 13h, 31h, 22h,   2, 12h
 13897 00008FE4 2120011110005545                        db  21h, 20h,   1, 11h, 10h,   0, 55h, 45h
 13898 00008FEC 5453354425521551                        db  54h, 53h, 35h, 44h, 25h, 52h, 15h, 51h
 13899 00008FF4 0534504333244214                        db    5, 34h, 50h, 43h, 33h, 24h, 42h, 14h
 13900 00008FFC 4140042332031331                        db  41h, 40h,   4, 23h, 32h,   3, 13h, 31h
 13901 00009004 3022122102201101                        db  30h, 22h, 12h, 21h,   2, 20h, 11h,   1
 13902 0000900C 1000555445533544                        db  10h,   0, 55h, 54h, 45h, 53h, 35h, 44h
 13903 00009014 2552051551344350                        db  25h, 52h,   5, 15h, 51h, 34h, 43h, 50h
 13904 0000901C 3324421441044023                        db  33h, 24h, 42h, 14h, 41h,   4, 40h, 23h
 13905 00009024 3213310330220220                        db  32h, 13h, 31h,   3, 30h, 22h,   2, 20h
 13906 0000902C 1221110110005545                        db  12h, 21h, 11h,   1, 10h,   0, 55h, 45h
 13907 00009034 3553540544255215                        db  35h, 53h, 54h,   5, 44h, 25h, 52h, 15h
 13908 0000903C 5134435004244233                        db  51h, 34h, 43h, 50h,   4, 24h, 42h, 33h
 13909 00009044 4014412332133103                        db  40h, 14h, 41h, 23h, 32h, 13h, 31h,   3
 13910 0000904C 3022021221201101                        db  30h, 22h,   2, 12h, 21h, 20h, 11h,   1
 13911 00009054 1000776776577566                        db  10h,   0, 77h, 67h, 76h, 57h, 75h, 66h
 13912 0000905C 4774566537734655                        db  47h, 74h, 56h, 65h, 37h, 73h, 46h, 55h
 13913 00009064 5463277264077062                        db  54h, 63h, 27h, 72h, 64h,   7, 70h, 62h
 13914 0000906C 4535065344177136                        db  45h, 35h,   6, 53h, 44h, 17h, 71h, 36h
 13915 00009074 2625521551344316                        db  26h, 25h, 52h, 15h, 51h, 34h, 43h, 16h
 13916 0000907C 6160055024423304                        db  61h, 60h,   5, 50h, 24h, 42h, 33h,   4
 13917 00009084 1441402332031331                        db  14h, 41h, 40h, 23h, 32h,   3, 13h, 31h
 13918 0000908C 3022122102201101                        db  30h, 22h, 12h, 21h,   2, 20h, 11h,   1
 13919 00009094 1000776776756647                        db  10h,   0, 77h, 67h, 76h, 75h, 66h, 47h
 13920 0000909C 7457555665377346                        db  74h, 57h, 55h, 56h, 65h, 37h, 73h, 46h
 13921 000090A4 4554355327726407                        db  45h, 54h, 35h, 53h, 27h, 72h, 64h,   7
 13922 000090AC 7117703663604425                        db  71h, 17h, 70h, 36h, 63h, 60h, 44h, 25h
 13923 000090B4 5205156226061661                        db  52h,   5, 15h, 62h, 26h,   6, 16h, 61h
 13924 000090BC 5134504333244214                        db  51h, 34h, 50h, 43h, 33h, 24h, 42h, 14h
 13925 000090C4 4104402332133103                        db  41h,   4, 40h, 23h, 32h, 13h, 31h,   3
 13926 000090CC 3022211202201101                        db  30h, 22h, 21h, 12h,   2, 20h, 11h,   1
 13927 000090D4 1000776776577566                        db  10h,   0, 77h, 67h, 76h, 57h, 75h, 66h
 13928 000090DC 4774655637735527                        db  47h, 74h, 65h, 56h, 37h, 73h, 55h, 27h
 13929 000090E4 7246641771077036                        db  72h, 46h, 64h, 17h, 71h,   7, 70h, 36h
 13930 000090EC 6345544406052662                        db  63h, 45h, 54h, 44h,   6,   5, 26h, 62h
 13931 000090F4 6116603553255215                        db  61h, 16h, 60h, 35h, 53h, 25h, 52h, 15h
 13932 000090FC 5134435004244214                        db  51h, 34h, 43h, 50h,   4, 24h, 42h, 14h
 13933 00009104 3341233240033013                        db  33h, 41h, 23h, 32h, 40h,   3, 30h, 13h
 13934 0000910C 3122122102200011                        db  31h, 22h, 12h, 21h,   2, 20h,   0, 11h
 13935 00009114 0110FEFCFDEDFFEF                        db    1, 10h,0FEh,0FCh,0FDh,0EDh,0FFh,0EFh
 13936 0000911C DFEECFDEBFFBCEDC                        db 0DFh,0EEh,0CFh,0DEh,0BFh,0FBh,0CEh,0DCh
 13937 00009124 AFE9ECDDFACDBEEB                        db 0AFh,0E9h,0ECh,0DDh,0FAh,0CDh,0BEh,0EBh
 13938 0000912C 9FF9EABDDB8FF8CC                        db  9Fh,0F9h,0EAh,0BDh,0DBh, 8Fh,0F8h,0CCh
 13939 00009134 AE9E8E7F7EF7DAAD                        db 0AEh, 9Eh, 8Eh, 7Fh, 7Eh,0F7h,0DAh,0ADh
 13940 0000913C BCCBF66FE85F9DD9                        db 0BCh,0CBh,0F6h, 6Fh,0E8h, 5Fh, 9Dh,0D9h
 13941 00009144 F5E7ACBB4FF4CAE6                        db 0F5h,0E7h,0ACh,0BBh, 4Fh,0F4h,0CAh,0E6h
 13942 0000914C F33F8DD82FF26E9C                        db 0F3h, 3Fh, 8Dh,0D8h, 2Fh,0F2h, 6Eh, 9Ch
 13943 00009154 0FC95EAB7DD74EC8                        db  0Fh,0C9h, 5Eh,0ABh, 7Dh,0D7h, 4Eh,0C8h
 13944 0000915C D63EB99BAA1FF1F0                        db 0D6h, 3Eh,0B9h, 9Bh,0AAh, 1Fh,0F1h,0F0h
 13945 00009164 BAE5E48C6DE3E22E                        db 0BAh,0E5h,0E4h, 8Ch, 6Dh,0E3h,0E2h, 2Eh
 13946 0000916C 0E1EE1E05DD57CC7                        db  0Eh, 1Eh,0E1h,0E0h, 5Dh,0D5h, 7Ch,0C7h
 13947 00009174 4D8BB8D49AA96CC6                        db  4Dh, 8Bh,0B8h,0D4h, 9Ah,0A9h, 6Ch,0C6h
 13948 0000917C 3DD37B2DD21DB75C                        db  3Dh,0D3h, 7Bh, 2Dh,0D2h, 1Dh,0B7h, 5Ch
 13949 00009184 C5997AC3A7974BD1                        db 0C5h, 99h, 7Ah,0C3h,0A7h, 97h, 4Bh,0D1h
 13950 0000918C 0DD08AA84CC46BB6                        db  0Dh,0D0h, 8Ah,0A8h, 4Ch,0C4h, 6Bh,0B6h
 13951 00009194 3C2CC25BB5891CC1                        db  3Ch, 2Ch,0C2h, 5Bh,0B5h, 89h, 1Ch,0C1h
 13952 0000919C 980CC0B46AA6793B                        db  98h, 0Ch,0C0h,0B4h, 6Ah,0A6h, 79h, 3Bh
 13953 000091A4 B3885A2BA569A478                        db 0B3h, 88h, 5Ah, 2Bh,0A5h, 69h,0A4h, 78h
 13954 000091AC 87947776B21BB10B                        db  87h, 94h, 77h, 76h,0B2h, 1Bh,0B1h, 0Bh
 13955 000091B4 B0964A3AA359952A                        db 0B0h, 96h, 4Ah, 3Ah,0A3h, 59h, 95h, 2Ah
 13956 000091BC A21AA10A68A08649                        db 0A2h, 1Ah,0A1h, 0Ah, 68h,0A0h, 86h, 49h
 13957 000091C4 9339588567299257                        db  93h, 39h, 58h, 85h, 67h, 29h, 92h, 57h
 13958 000091CC 7538836647745665                        db  75h, 38h, 83h, 66h, 47h, 74h, 56h, 65h
 13959 000091D4 7319910990488472                        db  73h, 19h, 91h,   9, 90h, 48h, 84h, 72h
 13960 000091DC 4664288218372717                        db  46h, 64h, 28h, 82h, 18h, 37h, 27h, 17h
 13961 000091E4 7155077036634554                        db  71h, 55h,   7, 70h, 36h, 63h, 45h, 54h
 13962 000091EC 2662358108801661                        db  26h, 62h, 35h, 81h,   8, 80h, 16h, 61h
 13963 000091F4 0660534425520515                        db    6, 60h, 53h, 44h, 25h, 52h,   5, 15h
 13964 000091FC 5134435024423314                        db  51h, 34h, 43h, 50h, 24h, 42h, 33h, 14h
 13965 00009204 4104402332133103                        db  41h,   4, 40h, 23h, 32h, 13h, 31h,   3
 13966 0000920C 3022122102201101                        db  30h, 22h, 12h, 21h,   2, 20h, 11h,   1
 13967 00009214 1000FFEFFEDFEEFD                        db  10h,   0,0FFh,0EFh,0FEh,0DFh,0EEh,0FDh
 13968 0000921C CFFCDEEDBFFBCEEC                        db 0CFh,0FCh,0DEh,0EDh,0BFh,0FBh,0CEh,0ECh
 13969 00009224 DDAFFABEEBCDDC9F                        db 0DDh,0AFh,0FAh,0BEh,0EBh,0CDh,0DCh, 9Fh
 13970 0000922C F9EABDDB8FF8CC9E                        db 0F9h,0EAh,0BDh,0DBh, 8Fh,0F8h,0CCh, 9Eh
 13971 00009234 E97FF7ADDABC6FAE                        db 0E9h, 7Fh,0F7h,0ADh,0DAh,0BCh, 6Fh,0AEh
 13972 0000923C 0FCBF68EE85F9DF5                        db  0Fh,0CBh,0F6h, 8Eh,0E8h, 5Fh, 9Dh,0F5h
 13973 00009244 7EE7ACCABBD98D4F                        db  7Eh,0E7h,0ACh,0CAh,0BBh,0D9h, 8Dh, 4Fh
 13974 0000924C F43FF3D8E62FF26E                        db 0F4h, 3Fh,0F3h,0D8h,0E6h, 2Fh,0F2h, 6Eh
 13975 00009254 F01FF19CC95EABBA                        db 0F0h, 1Fh,0F1h, 9Ch,0C9h, 5Eh,0ABh,0BAh
 13976 0000925C E57DD74EE48CC83E                        db 0E5h, 7Dh,0D7h, 4Eh,0E4h, 8Ch,0C8h, 3Eh
 13977 00009264 6DD6E39BB92EAAE2                        db  6Dh,0D6h,0E3h, 9Bh,0B9h, 2Eh,0AAh,0E2h
 13978 0000926C 1EE10EE05DD57CC7                        db  1Eh,0E1h, 0Eh,0E0h, 5Dh,0D5h, 7Ch,0C7h
 13979 00009274 4D8BD4B89AA96CC6                        db  4Dh, 8Bh,0D4h,0B8h, 9Ah,0A9h, 6Ch,0C6h
 13980 0000927C 3DD3D22D0D1D7BB7                        db  3Dh,0D3h,0D2h, 2Dh, 0Dh, 1Dh, 7Bh,0B7h
 13981 00009284 D15CD0C58AA84CC4                        db 0D1h, 5Ch,0D0h,0C5h, 8Ah,0A8h, 4Ch,0C4h
 13982 0000928C 6BB6990C3CC37AA7                        db  6Bh,0B6h, 99h, 0Ch, 3Ch,0C3h, 7Ah,0A7h
 13983 00009294 A6C00BC22C5BB51C                        db 0A6h,0C0h, 0Bh,0C2h, 2Ch, 5Bh,0B5h, 1Ch
 13984 0000929C 8998C14BB46A3B79                        db  89h, 98h,0C1h, 4Bh,0B4h, 6Ah, 3Bh, 79h
 13985 000092A4 B397882B5AB2A51B                        db 0B3h, 97h, 88h, 2Bh, 5Ah,0B2h,0A5h, 1Bh
 13986 000092AC B1B069964AA47887                        db 0B1h,0B0h, 69h, 96h, 4Ah,0A4h, 78h, 87h
 13987 000092B4 3AA359952AA21AA1                        db  3Ah,0A3h, 59h, 95h, 2Ah,0A2h, 1Ah,0A1h
 13988 000092BC 0AA0688649943993                        db  0Ah,0A0h, 68h, 86h, 49h, 94h, 39h, 93h
 13989 000092C4 7709588529677692                        db  77h,   9, 58h, 85h, 29h, 67h, 76h, 92h
 13990 000092CC 9119904884577538                        db  91h, 19h, 90h, 48h, 84h, 57h, 75h, 38h
 13991 000092D4 8366472882188174                        db  83h, 66h, 47h, 28h, 82h, 18h, 81h, 74h
 13992 000092DC 0880566537734627                        db    8, 80h, 56h, 65h, 37h, 73h, 46h, 27h
 13993 000092E4 7264175571077036                        db  72h, 64h, 17h, 55h, 71h,   7, 70h, 36h
 13994 000092EC 6345542662160660                        db  63h, 45h, 54h, 26h, 62h, 16h,   6, 60h
 13995 000092F4 3561534425521551                        db  35h, 61h, 53h, 44h, 25h, 52h, 15h, 51h
 13996 000092FC 0550344324423341                        db    5, 50h, 34h, 43h, 24h, 42h, 33h, 41h
 13997 00009304 1404233240031331                        db  14h,   4, 23h, 32h, 40h,   3, 13h, 31h
 13998 0000930C 3022122102201101                        db  30h, 22h, 12h, 21h,   2, 20h, 11h,   1
 13999 00009314 1000EFFEDFFDCFFC                        db  10h,   0,0EFh,0FEh,0DFh,0FDh,0CFh,0FCh
 14000 0000931C BFFBAFFA9FF9F88F                        db 0BFh,0FBh,0AFh,0FAh, 9Fh,0F9h,0F8h, 8Fh
 14001 00009324 7FF76FF6FF5FF54F                        db  7Fh,0F7h, 6Fh,0F6h,0FFh, 5Fh,0F5h, 4Fh
 14002 0000932C F4F3F03FCEECDDDE                        db 0F4h,0F3h,0F0h, 3Fh,0CEh,0ECh,0DDh,0DEh
 14003 00009334 E9EAD9EEEDEBBECD                        db 0E9h,0EAh,0D9h,0EEh,0EDh,0EBh,0BEh,0CDh
 14004 0000933C DCDBAECCADDA7EAC                        db 0DCh,0DBh,0AEh,0CCh,0ADh,0DAh, 7Eh,0ACh
 14005 00009344 CAC97D5EBDF22F0F                        db 0CAh,0C9h, 7Dh, 5Eh,0BDh,0F2h, 2Fh, 0Fh
 14006 0000934C 1FF19EBCCB8EE89D                        db  1Fh,0F1h, 9Eh,0BCh,0CBh, 8Eh,0E8h, 9Dh
 14007 00009354 E7BB8DD86EE69CAB                        db 0E7h,0BBh, 8Dh,0D8h, 6Eh,0E6h, 9Ch,0ABh
 14008 0000935C BAE5D74EE48CC83E                        db 0BAh,0E5h,0D7h, 4Eh,0E4h, 8Ch,0C8h, 3Eh
 14009 00009364 6DD69BB9AAE1D4B8                        db  6Dh,0D6h, 9Bh,0B9h,0AAh,0E1h,0D4h,0B8h
 14010 0000936C A97BB7D0E30EE05D                        db 0A9h, 7Bh,0B7h,0D0h,0E3h, 0Eh,0E0h, 5Dh
 14011 00009374 D57CC74D8B9A6CC6                        db 0D5h, 7Ch,0C7h, 4Dh, 8Bh, 9Ah, 6Ch,0C6h
 14012 0000937C 3D5CC50D8AA8994C                        db  3Dh, 5Ch,0C5h, 0Dh, 8Ah,0A8h, 99h, 4Ch
 14013 00009384 B67A3C5B891CC098                        db 0B6h, 7Ah, 3Ch, 5Bh, 89h, 1Ch,0C0h, 98h
 14014 0000938C 79E22E1ED32DD2D1                        db  79h,0E2h, 2Eh, 1Eh,0D3h, 2Dh,0D2h,0D1h
 14015 00009394 3B97881DC46BC3A7                        db  3Bh, 97h, 88h, 1Dh,0C4h, 6Bh,0C3h,0A7h
 14016 0000939C 2CC2B5C10C4BB46A                        db  2Ch,0C2h,0B5h,0C1h, 0Ch, 4Bh,0B4h, 6Ah
 14017 000093A4 A6B35AA52BB21BB1                        db 0A6h,0B3h, 5Ah,0A5h, 2Bh,0B2h, 1Bh,0B1h
 14018 000093AC 0BB069964AA47887                        db  0Bh,0B0h, 69h, 96h, 4Ah,0A4h, 78h, 87h
 14019 000093B4 A33A592A9568A186                        db 0A3h, 3Ah, 59h, 2Ah, 95h, 68h,0A1h, 86h
 14020 000093BC 7794495767A21A0A                        db  77h, 94h, 49h, 57h, 67h,0A2h, 1Ah, 0Ah
 14021 000093C4 A039935885299276                        db 0A0h, 39h, 93h, 58h, 85h, 29h, 92h, 76h
 14022 000093CC 0919919048847538                        db    9, 19h, 91h, 90h, 48h, 84h, 75h, 38h
 14023 000093D4 8366288247741881                        db  83h, 66h, 28h, 82h, 47h, 74h, 18h, 81h
 14024 000093DC 8008563773654627                        db  80h,   8, 56h, 37h, 73h, 65h, 46h, 27h
 14025 000093E4 7264550717717036                        db  72h, 64h, 55h,   7, 17h, 71h, 70h, 36h
 14026 000093EC 6345542662166106                        db  63h, 45h, 54h, 26h, 62h, 16h, 61h,   6
 14027 000093F4 6053354425525115                        db  60h, 53h, 35h, 44h, 25h, 52h, 51h, 15h
 14028 000093FC 0534435024423314                        db    5, 34h, 43h, 50h, 24h, 42h, 33h, 14h
 14029 00009404 4104402332133103                        db  41h,   4, 40h, 23h, 32h, 13h, 31h,   3
 14030 0000940C 3022122102201101                        db  30h, 22h, 12h, 21h,   2, 20h, 11h,   1
 14031 00009414 1000EFFEDFFDCFFC                        db  10h,   0,0EFh,0FEh,0DFh,0FDh,0CFh,0FCh
 14032 0000941C BFFBFAAF9FF9F88F                        db 0BFh,0FBh,0FAh,0AFh, 9Fh,0F9h,0F8h, 8Fh
 14033 00009424 7FF76FF65FF54FF4                        db  7Fh,0F7h, 6Fh,0F6h, 5Fh,0F5h, 4Fh,0F4h
 14034 0000942C 3FF32FF2F11FF00F                        db  3Fh,0F3h, 2Fh,0F2h,0F1h, 1Fh,0F0h, 0Fh
 14035 00009434 EEDEEDCEECDDBEEB                        db 0EEh,0DEh,0EDh,0CEh,0ECh,0DDh,0BEh,0EBh
 14036 0000943C CDDCAEEABDDBCC9E                        db 0CDh,0DCh,0AEh,0EAh,0BDh,0DBh,0CCh, 9Eh
 14037 00009444 E9ADDABCCB8EE89D                        db 0E9h,0ADh,0DAh,0BCh,0CBh, 8Eh,0E8h, 9Dh
 14038 0000944C D97EE7ACFFCABB8D                        db 0D9h, 7Eh,0E7h,0ACh,0FFh,0CAh,0BBh, 8Dh
 14039 00009454 D80EE00DE66E9CC9                        db 0D8h, 0Eh,0E0h, 0Dh,0E6h, 6Eh, 9Ch,0C9h
 14040 0000945C 5EBAE5AB7DD7E48C                        db  5Eh,0BAh,0E5h,0ABh, 7Dh,0D7h,0E4h, 8Ch
 14041 00009464 C84E2E3E6DD6E39B                        db 0C8h, 4Eh, 2Eh, 3Eh, 6Dh,0D6h,0E3h, 9Bh
 14042 0000946C B9AAE21EE15DD57C                        db 0B9h,0AAh,0E2h, 1Eh,0E1h, 5Dh,0D5h, 7Ch
 14043 00009474 C74D8BB8D49AA96C                        db 0C7h, 4Dh, 8Bh,0B8h,0D4h, 9Ah,0A9h, 6Ch
 14044 0000947C C63DD32DD21D7BB7                        db 0C6h, 3Dh,0D3h, 2Dh,0D2h, 1Dh, 7Bh,0B7h
 14045 00009484 D15CC58AA8994CC4                        db 0D1h, 5Ch,0C5h, 8Ah,0A8h, 99h, 4Ch,0C4h
 14046 0000948C 6BB6D00C3CC37AA7                        db  6Bh,0B6h,0D0h, 0Ch, 3Ch,0C3h, 7Ah,0A7h
 14047 00009494 2CC25BB51C8998C1                        db  2Ch,0C2h, 5Bh,0B5h, 1Ch, 89h, 98h,0C1h
 14048 0000949C 4BC00B3BB00A1AB4                        db  4Bh,0C0h, 0Bh, 3Bh,0B0h, 0Ah, 1Ah,0B4h
 14049 000094A4 6AA67997A00990B3                        db  6Ah,0A6h, 79h, 97h,0A0h,   9, 90h,0B3h
 14050 000094AC 882B5AB2A51BB169                        db  88h, 2Bh, 5Ah,0B2h,0A5h, 1Bh,0B1h, 69h
 14051 000094B4 96A44A78873AA359                        db  96h,0A4h, 4Ah, 78h, 87h, 3Ah,0A3h, 59h
 14052 000094BC 952AA2A168867749                        db  95h, 2Ah,0A2h,0A1h, 68h, 86h, 77h, 49h
 14053 000094C4 9439935885296776                        db  94h, 39h, 93h, 58h, 85h, 29h, 67h, 76h
 14054 000094CC 9219914884577538                        db  92h, 19h, 91h, 48h, 84h, 57h, 75h, 38h
 14055 000094D4 8366288218477481                        db  83h, 66h, 28h, 82h, 18h, 47h, 74h, 81h
 14056 000094DC 0880566517077073                        db    8, 80h, 56h, 65h, 17h,   7, 70h, 73h
 14057 000094E4 3727724664557136                        db  37h, 27h, 72h, 46h, 64h, 55h, 71h, 36h
 14058 000094EC 6345542662166106                        db  63h, 45h, 54h, 26h, 62h, 16h, 61h,   6
 14059 000094F4 6035534425521505                        db  60h, 35h, 53h, 44h, 25h, 52h, 15h,   5
 14060 000094FC 5051344324423314                        db  50h, 51h, 34h, 43h, 24h, 42h, 33h, 14h
 14061 00009504 4104402332133103                        db  41h,   4, 40h, 23h, 32h, 13h, 31h,   3
 14062 0000950C 3022122102201101                        db  30h, 22h, 12h, 21h,   2, 20h, 11h,   1
 14063 00009514 10000B0F0D0E0705                        db  10h,   0, 0Bh, 0Fh, 0Dh, 0Eh,   7,   5
 14064 0000951C 0906030A0C020104                        db    9,   6,   3, 0Ah, 0Ch,   2,   1,   4
 14065 00009524 08000F0E0D0C0B0A                        db    8,   0, 0Fh, 0Eh, 0Dh, 0Ch, 0Bh, 0Ah
 14066 0000952C 0908070605040302                        db    9,   8,   7,   6,   5,   4,   3,   2
 14067 00009534 0100                                    db    1,   0
 14068 00009536 000000000000                            db 6 dup(0)
 14069 0000953C 0000                    mp3_huff_data   db   0,  0             
 14070 0000953E 0100                                    db   1,  0              ; byte[32][2] ; table,linbits
 14071 00009540 0200                                    db   2,  0
 14072 00009542 0300                                    db   3,  0
 14073 00009544 0000                                    db   0,  0
 14074 00009546 0400                                    db   4,  0
 14075 00009548 0500                                    db   5,  0
 14076 0000954A 0600                                    db   6,  0
 14077 0000954C 0700                                    db   7,  0
 14078 0000954E 0800                                    db   8,  0
 14079 00009550 0900                                    db   9,  0
 14080 00009552 0A00                                    db  10,  0
 14081 00009554 0B00                                    db  11,  0
 14082 00009556 0C00                                    db  12,  0
 14083 00009558 0000                                    db   0,  0
 14084 0000955A 0D00                                    db  13,  0
 14085 0000955C 0E01                                    db  14,  1
 14086 0000955E 0E02                                    db  14,  2
 14087 00009560 0E03                                    db  14,  3
 14088 00009562 0E04                                    db  14,  4
 14089 00009564 0E06                                    db  14,  6
 14090 00009566 0E08                                    db  14,  8
 14091 00009568 0E0A                                    db  14, 10
 14092 0000956A 0E0D                                    db  14, 13
 14093 0000956C 0F04                                    db  15,  4
 14094 0000956E 0F05                                    db  15,  5
 14095 00009570 0F06                                    db  15,  6
 14096 00009572 0F07                                    db  15,  7
 14097 00009574 0F08                                    db  15,  8
 14098 00009576 0F09                                    db  15,  9
 14099 00009578 0F0B                                    db  15, 11
 14100 0000957A 0F0D                                    db  15, 13
 14101 0000957C 040404040404060608-     mp3_band_size_long db    4,   4,   4,   4,   4,   4,   6,   6,   8,   8, 0Ah
 14101 00009585 080A               
 14102 00009587 0C1014181C222A3236-                     db  0Ch, 10h, 14h, 18h, 1Ch, 22h, 2Ah, 32h, 36h, 4Ch, 9Eh ; byte[9][22]
 14102 00009590 4C9E               
 14103 00009592 040404040404060606-                     db    4,   4,   4,   4,   4,   4,   6,   6,   6,   8, 0Ah
 14103 0000959B 080A               
 14104 0000959D 0C1012161C22282E36-                     db  0Ch, 10h, 12h, 16h, 1Ch, 22h, 28h, 2Eh, 36h, 36h,0C0h
 14104 000095A6 36C0               
 14105 000095A8 040404040404060608-                     db    4,   4,   4,   4,   4,   4,   6,   6,   8, 0Ah, 0Ch
 14105 000095B1 0A0C               
 14106 000095B3 1014181E262E384454-                     db  10h, 14h, 18h, 1Eh, 26h, 2Eh, 38h, 44h, 54h, 66h, 1Ah
 14106 000095BC 661A               
 14107 000095BE 060606060606080A0C-                     db    6,   6,   6,   6,   6,   6,   8, 0Ah, 0Ch, 0Eh, 10h
 14107 000095C7 0E10               
 14108 000095C9 14181C20262E343C44-                     db  14h, 18h, 1Ch, 20h, 26h, 2Eh, 34h, 3Ch, 44h, 3Ah, 36h
 14108 000095D2 3A36               
 14109 000095D4 060606060606080A0C-                     db    6,   6,   6,   6,   6,   6,   8, 0Ah, 0Ch, 0Eh, 10h
 14109 000095DD 0E10               
 14110 000095DF 12161A20262E344046-                     db  12h, 16h, 1Ah, 20h, 26h, 2Eh, 34h, 40h, 46h, 4Ch, 24h
 14110 000095E8 4C24               
 14111 000095EA 060606060606080A0C-                     db    6,   6,   6,   6,   6,   6,   8, 0Ah, 0Ch, 0Eh, 10h
 14111 000095F3 0E10               
 14112 000095F5 14181C20262E343C44-                     db  14h, 18h, 1Ch, 20h, 26h, 2Eh, 34h, 3Ch, 44h, 3Ah, 36h
 14112 000095FE 3A36               
 14113 00009600 060606060606080A0C-                     db    6,   6,   6,   6,   6,   6,   8, 0Ah, 0Ch, 0Eh, 10h
 14113 00009609 0E10               
 14114 0000960B 14181C20262E343C44-                     db  14h, 18h, 1Ch, 20h, 26h, 2Eh, 34h, 3Ch, 44h, 3Ah, 36h
 14114 00009614 3A36               
 14115 00009616 060606060606080A0C-                     db    6,   6,   6,   6,   6,   6,   8, 0Ah, 0Ch, 0Eh, 10h
 14115 0000961F 0E10               
 14116 00009621 14181C20262E343C44-                     db  14h, 18h, 1Ch, 20h, 26h, 2Eh, 34h, 3Ch, 44h, 3Ah, 36h
 14116 0000962A 3A36               
 14117 0000962C 0C0C0C0C0C0C101418-                     db  0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 10h, 14h, 18h, 1Ch, 20h
 14117 00009635 1C20               
 14118 00009637 283038404C5A020202-                     db  28h, 30h, 38h, 40h, 4Ch, 5Ah,   2,   2,   2,   2,   2
 14118 00009640 0202               
 14119 00009642 000000000000000000-                     db 10 dup(0)            ; data align
 14119 0000964B 00                 
 14120 0000964C 0404040406080A0C0E-     mp3_band_size_short db    4,   4,   4,   4,   6,   8, 0Ah, 0Ch, 0Eh, 12h, 16h, 1Eh, 38h
 14120 00009655 12161E38           
 14121 00009659 0404040406060A0C0E-                     db    4,   4,   4,   4,   6,   6, 0Ah, 0Ch, 0Eh, 10h, 14h, 1Ah, 42h ; byte[9][16] ? ; byte [9][13]
 14121 00009662 10141A42           
 14122 00009666 0404040406080C1014-                     db    4,   4,   4,   4,   6,   8, 0Ch, 10h, 14h, 1Ah, 22h, 2Ah, 0Ch
 14122 0000966F 1A222A0C           
 14123 00009673 0404040606080A0E12-                     db    4,   4,   4,   6,   6,   8, 0Ah, 0Eh, 12h, 1Ah, 20h, 2Ah, 12h
 14123 0000967C 1A202A12           
 14124 00009680 04040406080A0C0E12-                     db    4,   4,   4,   6,   8, 0Ah, 0Ch, 0Eh, 12h, 18h, 20h, 2Ch, 0Ch
 14124 00009689 18202C0C           
 14125 0000968D 04040406080A0C0E12-                     db    4,   4,   4,   6,   8, 0Ah, 0Ch, 0Eh, 12h, 18h, 1Eh, 28h, 12h
 14125 00009696 181E2812           
 14126 0000969A 04040406080A0C0E12-                     db    4,   4,   4,   6,   8, 0Ah, 0Ch, 0Eh, 12h, 18h, 1Eh, 28h, 12h
 14126 000096A3 181E2812           
 14127 000096A7 04040406080A0C0E12-                     db    4,   4,   4,   6,   8, 0Ah, 0Ch, 0Eh, 12h, 18h, 1Eh, 28h, 12h
 14127 000096B0 181E2812           
 14128 000096B4 0808080C1014181C24-                     db    8,   8,   8, 0Ch, 10h, 14h, 18h, 1Ch, 24h,   2,   2,   2, 1Ah
 14128 000096BD 0202021A           
 14129 000096C1 000000000000000000-                     db 11 dup(0)            ; data align
 14129 000096CA 0000               
 14130 000096CC 000000000000000000-     mp3_pretab      db    0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0
 14130 000096D5 0000               
 14131 000096D7 000000000000000000-                     db    0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0
 14131 000096E0 0000               
 14132 000096E2 000000000000000000-                     db    0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0
 14132 000096EB 0000               
 14133 000096ED 010101010202030303-                     db    1,   1,   1,   1,   2,   2,   3,   3,   3,   2,   0
 14133 000096F6 0200               
 14134 000096F8 00000000                                db 4 dup(0)             ; data align
 14135 000096FC 4B1D4200028FDB0016-     mp3_mdct_win_src dd  00421D4Bh, 00DB8F02h, 019C7F16h, 029ADCC0h, 04000001h, 06246711h
 14135 00009705 7F9C01C0DC9A020100-
 14135 0000970E 000411672406       
 14136 00009714 4506EE090CD6A71238-                     dd  09EE0645h, 12A7D60Ch, 3DF40538h,0BC63D32Fh,0E7B0025Bh,0F069D222h ; these are sine values divided by cosine values...
 14136 0000971D 05F43D2FD363BC5B02-
 14136 00009726 B0E722D269F0       
 14137 0000972C 567133F467D857F6A8-                     dd 0F4337156h,0F657D867h,0F7BCFBA8h,0F8BB5952h,0F97C4965h,0FA15BB1Ch
 14137 00009735 FBBCF75259BBF86549-
 14137 0000973E 7CF91CBB15FA       
 14138 00009744 936D94FA8E5100FB70-                     dd 0FA946D93h,0FB00518Eh,0FB5EA270h,0FBB2FDEAh,0FC000000h,0FC479F38h
 14138 0000974D A25EFBEAFDB2FB0000-
 14138 00009756 00FC389F47FC       
 14139 0000975C 09668BFC9898CCFC0B-                     dd 0FC8B6609h,0FCCC9898h,0FD0C4F0Bh,0FD4B895Ch,0FD8B3FCFh,0FDCC725Eh
 14139 00009765 4F0CFD5C894BFDCF3F-
 14139 0000976E 8BFD5E72CCFD       
 14140 00009774 2F3910FE67D857FE7D-                     dd 0FE10392Fh,0FE57D867h,0FEA4DA7Dh,0FEF935F7h,0FF5786D9h,0FFC36AD5h
 14140 0000977D DAA4FEF735F9FED986-
 14140 00009786 57FFD56AC3FF       
 14141 0000978C 4B1D4200028FDB0016-                     dd  00421D4Bh, 00DB8F02h, 019C7F16h, 029ADCC0h, 04000001h, 06246711h
 14141 00009795 7F9C01C0DC9A020100-
 14141 0000979E 000411672406       
 14142 000097A4 4506EE090CD6A71238-                     dd  09EE0645h, 12A7D60Ch, 3DF40538h,0BC63D32Fh,0E7B0025Bh,0F069D222h
 14142 000097AD 05F43D2FD363BC5B02-
 14142 000097B6 B0E722D269F0       
 14143 000097BC 567133F467D857F6A8-                     dd 0F4337156h,0F657D867h,0F7BCFBA8h,0F8BB5952h,0F97C4965h,0FA15BB1Ch
 14143 000097C5 FBBCF75259BBF86549-
 14143 000097CE 7CF91CBB15FA       
 14144 000097D4 291B93FAB946F5FABB-                     dd 0FA931B29h,0FAF546B9h,0FB41DABBh,0FB7D8F97h,0FBABA162h,0FBCE4E62h
 14144 000097DD DA41FB978F7DFB62A1-
 14144 000097E6 ABFB624ECEFB       
 14145 000097EC 671CF0FBAFC845FC0D-                     dd 0FBF01C67h,0FC45C8AFh,0FCD2D50Dh,0FD9008D0h,0FE74C032h,0FF771894h
 14145 000097F5 D5D2FCD00890FD32C0-
 14145 000097FE 74FE941877FF       
 14146 00009804 000000000000000000-                     dd  00000000h, 00000000h, 00000000h, 00000000h, 00000000h, 00000000h
 14146 0000980D 000000000000000000-
 14146 00009816 000000000000       
 14147 0000981C 028FDB00010000040C-                     dd  00DB8F02h, 04000001h, 12A7D60Ch,0E7B0025Bh,0F657D867h,0F97C4965h
 14147 00009825 D6A7125B02B0E767D8-
 14147 0000982E 57F665497CF9       
 14148 00009834 8E5100FB000000FC98-                     dd 0FB00518Eh,0FC000000h,0FCCC9898h,0FD8B3FCFh,0FE57D867h,0FF5786D9h
 14148 0000983D 98CCFCCF3F8BFD67D8-
 14148 00009846 57FED98657FF       
 14149 0000984C 000000000000000000-                     dd  00000000h, 00000000h, 00000000h, 00000000h, 00000000h, 00000000h
 14149 00009855 000000000000000000-
 14149 0000985E 000000000000       
 14150 00009864 000000000000000000-                     dd  00000000h, 00000000h, 00000000h, 00000000h, 00000000h, 00000000h
 14150 0000986D 000000000000000000-
 14150 00009876 000000000000       
 14151 0000987C 000000000000000000-                     dd  00000000h, 00000000h, 00000000h, 00000000h, 00000000h, 00000000h
 14151 00009885 000000000000000000-
 14151 0000988E 000000000000       
 14152 00009894 000000000000000000-                     dd  00000000h, 00000000h, 00000000h, 00000000h, 00000000h, 00000000h
 14152 0000989D 000000000000000000-
 14152 000098A6 000000000000       
 14153 000098AC 000000000000000000-                     dd  00000000h, 00000000h, 00000000h, 00000000h, 00000000h, 00000000h
 14153 000098B5 000000000000000000-
 14153 000098BE 000000000000       
 14154 000098C4 B58869025237BA0B4F-                     dd  026988B5h, 0BBA3752h, 37D3294Fh,0B73F655Bh,0E3B0025Bh,0EDAD5D13h
 14154 000098CD 29D3375B653FB75B02-
 14154 000098D6 B0E3135DADED       
 14155 000098DC A2ADB2F2B8288CF5D6-                     dd 0F2B2ADA2h,0F58C28B8h,0F75657D6h,0F88E2C57h,0F96DE565h,0FA1449CDh
 14155 000098E5 5756F7572C8EF865E5-
 14155 000098EE 6DF9CD4914FA       
 14156 000098F4 936D94FA8E5100FB70-                     dd 0FA946D93h,0FB00518Eh,0FB5EA270h,0FBB2FDEAh,0FC000000h,0FC479F38h
 14156 000098FD A25EFBEAFDB2FB0000-
 14156 00009906 00FC389F47FC       
 14157 0000990C 09668BFC9898CCFC0B-                     dd 0FC8B6609h,0FCCC9898h,0FD0C4F0Bh,0FD4B895Ch,0FD8B3FCFh,0FDCC725Eh
 14157 00009915 4F0CFD5C894BFDCF3F-
 14157 0000991E 8BFD5E72CCFD       
 14158 00009924 2F3910FE67D857FE7D-                     dd 0FE10392Fh,0FE57D867h,0FEA4DA7Dh,0FEF935F7h,0FF5786D9h,0FFC36AD5h
 14158 0000992D DAA4FEF735F9FED986-
 14158 00009936 57FFD56AC3FF       
 14159 0000993C 0000000000000040        mp3_is_table_normal dd  00000000h, 40000000h
 14160 00009944 BB58860D46A77932                        dd  0D8658BBh, 3279A746h
 14161 0000994C D1F56C17300A9328                        dd  176CF5D1h, 28930A30h
 14162 00009954 0000002000000020                        dd  20000000h, 20000000h
 14163 0000995C 300A9328D1F56C17                        dd  28930A30h, 176CF5D1h
 14164 00009964 46A77932BB58860D                        dd  3279A746h, 0D8658BBh
 14165 0000996C 0000004000000000                        dd  40000000h, 00000000h
 14166 00009974 00000080                mp3_is_table_lsf_src dd 80000000h      
 14167                                                                          ; sqrt based constants...
 14168                                                                          ; 40000000h*2 ; 2.0  (2^1.00) aka 2
 14169 00009978 667EA26B                                dd 6BA27E66h            ; 35D13F33h*2 ; 1.681 (2^0.75)
 14170 0000997C 9A79825A                                dd 5A82799Ah            ; 2D413CCDh*2 ; 1.414 (2^0.50) aka sqrt(2)
 14171 00009980 2AF81B4C                                dd 4C1BF82Ah            ; 260DFC15h*2 ; 1.189 (2^0.25) aka sqrt(sqrt(2))
 14172 00009984 00000080                mp3_pow2_quarters dd 80000000h         
 14173                                                                          ; 40000000h*2 ; 2^(0/4)
 14174 00009988 52F03798                                dd 9837F052h            ; 4C1BF829h*2 ; 2^(1/4)
 14175 0000998C 34F304B5                                dd 0B504F334h           ; 5A82799Ah*2 ; 2^(2/4)
 14176 00009990 CCFC44D7                                dd 0D744FCCCh           ; 6BA27E66h*2 ; 2^(3/4)
 14177 00009994 00000000                mp3_initialized dd 0                   
 14178 00009998 12000000                mp3_huff_num_entries dd 12h            
 14179 0000999C 00                      wrchr_buf       db 0                   
 14180 0000999D 90<rep 3h>                              align 4
 14181                                  ; LPCSTR mp3_src_fname
 14182 000099A0 00000000                mp3_src_fname   dd 0                   
 14183                                  ; LPCSTR mp3_dst_fname
 14184 000099A4 00000000                mp3_dst_fname   dd 0                   
 14185                                  ; LPCSTR mp3_pcm_fname
 14186 000099A8 00000000                mp3_pcm_fname   dd 0                   
 14187 000099AC 524946462400000057-     mp3_wav_header  db 'RIFF$',0,0,0,'WAVEfmt ',10h,0,0,0,1,0,2,0,0,0,0,0,0,0,0,0,4,0,10h,0,'data',0,0,0,0
 14187 000099B5 415645666D74201000-
 14187 000099BE 000001000200000000-
 14187 000099C7 000000000004001000-
 14187 000099D0 6461746100000000   
 14188                                  ; 21/10/2024                   
 14189 000099D8 00000000                zero		dd 0  
 14190 000099DC 00                      num_enqueued_frames db 0
 14191 000099DD 617564696F20647572-     txt_decode_timing1 db 'audio duration ',0
 14191 000099E6 6174696F6E2000     
 14192 000099ED 206D696C6C69736563-     txt_decode_timing2 db ' milliseconds, decoded in ',0
 14192 000099F6 6F6E64732C20646563-
 14192 000099FF 6F64656420696E2000 
 14193 00009A08 206D696C6C69736563-     txt_decode_timing3 db ' milliseconds',0Dh,0Ah,0
 14193 00009A11 6F6E64730D0A00     
 14194 00009A18 20636C6F636B206379-     txt_clks_per_second db ' clock cycles per second:',0Dh,0Ah,0
 14194 00009A21 636C65732070657220-
 14194 00009A2A 7365636F6E643A0D0A-
 14194 00009A33 00                 
 14195 00009A34 0303020106060505        huff_tree_list_numbits db    3,   3,   2,   1,   6,   6,   5,   5
 14196 00009A3C 0503030301060605                        db    5,   3,   3,   3,   1,   6,   6,   5
 14197 00009A44 0505030202020808                        db    5,   5,   3,   2,   2,   2,   8,   8
 14198 00009A4C 0706070707070606                        db    7,   6,   7,   7,   7,   7,   6,   6
 14199 00009A54 0606030303010707                        db    6,   6,   3,   3,   3,   1,   7,   7
 14200 00009A5C 0606060505050504                        db    6,   6,   6,   5,   5,   5,   5,   4
 14201 00009A64 0404030203030A0A                        db    4,   4,   3,   2,   3,   3, 0Ah, 0Ah
 14202 00009A6C 0A0A090909090808                        db  0Ah, 0Ah,   9,   9,   9,   9,   8,   8
 14203 00009A74 0909080909080807                        db    9,   9,   8,   9,   9,   8,   8,   7
 14204 00009A7C 0707080808080707                        db    7,   7,   8,   8,   8,   8,   7,   7
 14205 00009A84 0707060506060403                        db    7,   7,   6,   5,   6,   6,   4,   3
 14206 00009A8C 03010B0B0A090A0A                        db    3,   1, 0Bh, 0Bh, 0Ah,   9, 0Ah, 0Ah
 14207 00009A94 0909090808090909                        db    9,   9,   9,   8,   8,   9,   9,   9
 14208 00009A9C 0908080807080808                        db    9,   8,   8,   8,   7,   8,   8,   8
 14209 00009AA4 0808080808060606                        db    8,   8,   8,   8,   8,   6,   6,   6
 14210 00009AAC 0404020303020909                        db    4,   4,   2,   3,   3,   2,   9,   9
 14211 00009AB4 0808090908080808                        db    8,   8,   9,   9,   8,   8,   8,   8
 14212 00009ABC 0707070808070707                        db    7,   7,   7,   8,   8,   7,   7,   7
 14213 00009AC4 0706060606050506                        db    7,   6,   6,   6,   6,   5,   5,   6
 14214 00009ACC 0605050404040303                        db    6,   5,   5,   4,   4,   4,   3,   3
 14215 00009AD4 03030B0B0B0B0B0B                        db    3,   3, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh
 14216 00009ADC 0A0A0A0A0A0A0A0B                        db  0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Bh
 14217 00009AE4 0B0A09090A0A0909                        db  0Bh, 0Ah,   9,   9, 0Ah, 0Ah,   9,   9
 14218 00009AEC 0A0A090A0A080809                        db  0Ah, 0Ah,   9, 0Ah, 0Ah,   8,   8,   9
 14219 00009AF4 090A0A09090A0A08                        db    9, 0Ah, 0Ah,   9,   9, 0Ah, 0Ah,   8
 14220 00009AFC 0808090909090909                        db    8,   8,   9,   9,   9,   9,   9,   9
 14221 00009B04 0808080808080707                        db    8,   8,   8,   8,   8,   8,   7,   7
 14222 00009B0C 0707060606060403                        db    7,   7,   6,   6,   6,   6,   4,   3
 14223 00009B14 03010A0A0A0A0A0A                        db    3,   1, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah
 14224 00009B1C 0A0B0B0A0A090909                        db  0Ah, 0Bh, 0Bh, 0Ah, 0Ah,   9,   9,   9
 14225 00009B24 0A0A0A0A08080909                        db  0Ah, 0Ah, 0Ah, 0Ah,   8,   8,   9,   9
 14226 00009B2C 0708080808080909                        db    7,   8,   8,   8,   8,   8,   9,   9
 14227 00009B34 0909080708080707                        db    9,   9,   8,   7,   8,   8,   7,   7
 14228 00009B3C 0808080909080808                        db    8,   8,   8,   9,   9,   8,   8,   8
 14229 00009B44 0808080707060607                        db    8,   8,   8,   7,   7,   6,   6,   7
 14230 00009B4C 0706050405050303                        db    7,   6,   5,   4,   5,   5,   3,   3
 14231 00009B54 03020A0A09090909                        db    3,   2, 0Ah, 0Ah,   9,   9,   9,   9
 14232 00009B5C 0909090808090908                        db    9,   9,   9,   8,   8,   9,   9,   8
 14233 00009B64 0808080808090908                        db    8,   8,   8,   8,   8,   9,   9,   8
 14234 00009B6C 0808080809090707                        db    8,   8,   8,   8,   9,   9,   7,   7
 14235 00009B74 0708080808080807                        db    7,   8,   8,   8,   8,   8,   8,   7
 14236 00009B7C 0707070808070707                        db    7,   7,   7,   8,   8,   7,   7,   7
 14237 00009B84 0606060607070605                        db    6,   6,   6,   6,   7,   7,   6,   5
 14238 00009B8C 0505040405050403                        db    5,   5,   4,   4,   5,   5,   4,   3
 14239 00009B94 0303131312111010                        db    3,   3, 13h, 13h, 12h, 11h, 10h, 10h
 14240 00009B9C 1010101010101010                        db  10h, 10h, 10h, 10h, 10h, 10h, 10h, 10h
 14241 00009BA4 11110F0F10100F0F                        db  11h, 11h, 0Fh, 0Fh, 10h, 10h, 0Fh, 0Fh
 14242 00009BAC 0F0F0F0F0F0F0F0F                        db  0Fh, 0Fh, 0Fh, 0Fh, 0Fh, 0Fh, 0Fh, 0Fh
 14243 00009BB4 10100F10100E0E0F                        db  10h, 10h, 0Fh, 10h, 10h, 0Eh, 0Eh, 0Fh
 14244 00009BBC 0F0F0F0E0E0E0E0E                        db  0Fh, 0Fh, 0Fh, 0Eh, 0Eh, 0Eh, 0Eh, 0Eh
 14245 00009BC4 0E0E0E0E0E0E0F0F                        db  0Eh, 0Eh, 0Eh, 0Eh, 0Eh, 0Eh, 0Fh, 0Fh
 14246 00009BCC 0E0D0E0E0D0D0E0E                        db  0Eh, 0Dh, 0Eh, 0Eh, 0Dh, 0Dh, 0Eh, 0Eh
 14247 00009BD4 0D0E0E0D0E0E0D0E                        db  0Dh, 0Eh, 0Eh, 0Dh, 0Eh, 0Eh, 0Dh, 0Eh
 14248 00009BDC 0E0D0D0E0E0C0C0C                        db  0Eh, 0Dh, 0Dh, 0Eh, 0Eh, 0Ch, 0Ch, 0Ch
 14249 00009BE4 0D0D0D0D0D0D0C0D                        db  0Dh, 0Dh, 0Dh, 0Dh, 0Dh, 0Dh, 0Ch, 0Dh
 14250 00009BEC 0D0C0C0D0D0D0D0D                        db  0Dh, 0Ch, 0Ch, 0Dh, 0Dh, 0Dh, 0Dh, 0Dh
 14251 00009BF4 0D0D0D0D0D0D0D0C                        db  0Dh, 0Dh, 0Dh, 0Dh, 0Dh, 0Dh, 0Dh, 0Ch
 14252 00009BFC 0C0D0D0C0C0C0C0D                        db  0Ch, 0Dh, 0Dh, 0Ch, 0Ch, 0Ch, 0Ch, 0Dh
 14253 00009C04 0D0D0D0C0D0D0C0B                        db  0Dh, 0Dh, 0Dh, 0Ch, 0Dh, 0Dh, 0Ch, 0Bh
 14254 00009C0C 0C0C0C0C0C0C0C0C                        db  0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch
 14255 00009C14 0B0B0B0B0C0C0B0B                        db  0Bh, 0Bh, 0Bh, 0Bh, 0Ch, 0Ch, 0Bh, 0Bh
 14256 00009C1C 0C0C0B0C0C0C0C0B                        db  0Ch, 0Ch, 0Bh, 0Ch, 0Ch, 0Ch, 0Ch, 0Bh
 14257 00009C24 0B0C0C0B0C0C0B0C                        db  0Bh, 0Ch, 0Ch, 0Bh, 0Ch, 0Ch, 0Bh, 0Ch
 14258 00009C2C 0C0B0C0C0A0A0A0B                        db  0Ch, 0Bh, 0Ch, 0Ch, 0Ah, 0Ah, 0Ah, 0Bh
 14259 00009C34 0B0B0B0B0B0B0B0A                        db  0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Ah
 14260 00009C3C 0A0A0A0B0B0A0B0B                        db  0Ah, 0Ah, 0Ah, 0Bh, 0Bh, 0Ah, 0Bh, 0Bh
 14261 00009C44 0A0B0B0B0B0A0A0B                        db  0Ah, 0Bh, 0Bh, 0Bh, 0Bh, 0Ah, 0Ah, 0Bh
 14262 00009C4C 0B0A0A0B0B0B0B0B                        db  0Bh, 0Ah, 0Ah, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh
 14263 00009C54 0B09090A0A0A0A0A                        db  0Bh,   9,   9, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah
 14264 00009C5C 0B0B0909090A0A09                        db  0Bh, 0Bh,   9,   9,   9, 0Ah, 0Ah,   9
 14265 00009C64 090A0A0A0A0A0A0A                        db    9, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah
 14266 00009C6C 0A0A0A0809090909                        db  0Ah, 0Ah, 0Ah,   8,   9,   9,   9,   9
 14267 00009C74 09090A0A09090908                        db    9,   9, 0Ah, 0Ah,   9,   9,   9,   8
 14268 00009C7C 0809090909090908                        db    8,   9,   9,   9,   9,   9,   9,   8
 14269 00009C84 0708080808070707                        db    7,   8,   8,   8,   8,   7,   7,   7
 14270 00009C8C 0707060606060404                        db    7,   7,   6,   6,   6,   6,   4,   4
 14271 00009C94 03010D0D0D0D0C0D                        db    3,   1, 0Dh, 0Dh, 0Dh, 0Dh, 0Ch, 0Dh
 14272 00009C9C 0D0D0D0D0D0C0D0D                        db  0Dh, 0Dh, 0Dh, 0Dh, 0Dh, 0Ch, 0Dh, 0Dh
 14273 00009CA4 0C0C0C0C0C0C0C0C                        db  0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch
 14274 00009CAC 0C0C0C0C0C0C0C0C                        db  0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch
 14275 00009CB4 0C0C0C0C0C0C0C0D                        db  0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Dh
 14276 00009CBC 0D0B0B0C0C0C0C0B                        db  0Dh, 0Bh, 0Bh, 0Ch, 0Ch, 0Ch, 0Ch, 0Bh
 14277 00009CC4 0B0B0B0B0B0C0C0B                        db  0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Ch, 0Ch, 0Bh
 14278 00009CCC 0B0B0B0B0B0B0B0C                        db  0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Ch
 14279 00009CD4 0C0B0B0B0B0B0B0B                        db  0Ch, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh
 14280 00009CDC 0B0B0B0B0B0B0B0B                        db  0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh
 14281 00009CE4 0B0B0B0B0B0B0B0B                        db  0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh
 14282 00009CEC 0B0B0C0C0B0B0B0B                        db  0Bh, 0Bh, 0Ch, 0Ch, 0Bh, 0Bh, 0Bh, 0Bh
 14283 00009CF4 0B0B0A0B0B0B0B0B                        db  0Bh, 0Bh, 0Ah, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh
 14284 00009CFC 0B0A0A0B0B0A0A0A                        db  0Bh, 0Ah, 0Ah, 0Bh, 0Bh, 0Ah, 0Ah, 0Ah
 14285 00009D04 0A0B0B0A0A0A0A0A                        db  0Ah, 0Bh, 0Bh, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah
 14286 00009D0C 0A0A0B0B0A0A0A0A                        db  0Ah, 0Ah, 0Bh, 0Bh, 0Ah, 0Ah, 0Ah, 0Ah
 14287 00009D14 0A0B0B090A0A0A0A                        db  0Ah, 0Bh, 0Bh,   9, 0Ah, 0Ah, 0Ah, 0Ah
 14288 00009D1C 0A0A0A0A0A0A0A0A                        db  0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah
 14289 00009D24 090A0A0A0A090A0A                        db    9, 0Ah, 0Ah, 0Ah, 0Ah,   9, 0Ah, 0Ah
 14290 00009D2C 090A0A0A0A0A0A0A                        db    9, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah
 14291 00009D34 0A09090909090909                        db  0Ah,   9,   9,   9,   9,   9,   9,   9
 14292 00009D3C 0A0A090909090909                        db  0Ah, 0Ah,   9,   9,   9,   9,   9,   9
 14293 00009D44 0A0A090909090909                        db  0Ah, 0Ah,   9,   9,   9,   9,   9,   9
 14294 00009D4C 0809090909090909                        db    8,   9,   9,   9,   9,   9,   9,   9
 14295 00009D54 0909090808080809                        db    9,   9,   9,   8,   8,   8,   8,   9
 14296 00009D5C 0909090909090908                        db    9,   9,   9,   9,   9,   9,   9,   8
 14297 00009D64 0808080808090908                        db    8,   8,   8,   8,   8,   9,   9,   8
 14298 00009D6C 0808080808080909                        db    8,   8,   8,   8,   8,   8,   9,   9
 14299 00009D74 0807080807070707                        db    8,   7,   8,   8,   7,   7,   7,   7
 14300 00009D7C 0808070707070706                        db    8,   8,   7,   7,   7,   7,   7,   6
 14301 00009D84 0707060607070606                        db    7,   7,   6,   6,   7,   7,   6,   6
 14302 00009D8C 0605050505050304                        db    6,   5,   5,   5,   5,   5,   3,   4
 14303 00009D94 04030B0B0B0B0B0B                        db    4,   3, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh
 14304 00009D9C 0B0B0A0B0B0B0B0A                        db  0Bh, 0Bh, 0Ah, 0Bh, 0Bh, 0Bh, 0Bh, 0Ah
 14305 00009DA4 0A0A0A0A080A0A09                        db  0Ah, 0Ah, 0Ah, 0Ah,   8, 0Ah, 0Ah,   9
 14306 00009DAC 0909090A1011110F                        db    9,   9,   9, 0Ah, 10h, 11h, 11h, 0Fh
 14307 00009DB4 0F10100E0F0F0E0E                        db  0Fh, 10h, 10h, 0Eh, 0Fh, 0Fh, 0Eh, 0Eh
 14308 00009DBC 0F0F0E0E0F0F0F0F                        db  0Fh, 0Fh, 0Eh, 0Eh, 0Fh, 0Fh, 0Fh, 0Fh
 14309 00009DC4 0E0F0F0E0D080909                        db  0Eh, 0Fh, 0Fh, 0Eh, 0Dh,   8,   9,   9
 14310 00009DCC 08080D0E0E0E0E0E                        db    8,   8, 0Dh, 0Eh, 0Eh, 0Eh, 0Eh, 0Eh
 14311 00009DD4 0E0E0E0E0E0D0D0E                        db  0Eh, 0Eh, 0Eh, 0Eh, 0Eh, 0Dh, 0Dh, 0Eh
 14312 00009DDC 0E0E0E0D0E0E0D0D                        db  0Eh, 0Eh, 0Eh, 0Dh, 0Eh, 0Eh, 0Dh, 0Dh
 14313 00009DE4 0D0E0E0E0E0D0D0E                        db  0Dh, 0Eh, 0Eh, 0Eh, 0Eh, 0Dh, 0Dh, 0Eh
 14314 00009DEC 0E0D0E0E0C0D0D0D                        db  0Eh, 0Dh, 0Eh, 0Eh, 0Ch, 0Dh, 0Dh, 0Dh
 14315 00009DF4 0D0D0D0D0D0D0D0D                        db  0Dh, 0Dh, 0Dh, 0Dh, 0Dh, 0Dh, 0Dh, 0Dh
 14316 00009DFC 0D0D0D0C0D0D0D0D                        db  0Dh, 0Dh, 0Dh, 0Ch, 0Dh, 0Dh, 0Dh, 0Dh
 14317 00009E04 0D0D0C0D0D0C0C0D                        db  0Dh, 0Dh, 0Ch, 0Dh, 0Dh, 0Ch, 0Ch, 0Dh
 14318 00009E0C 0D0B0C0C0C0C0C0C                        db  0Dh, 0Bh, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch
 14319 00009E14 0C0D0D0B0C0C0C0C                        db  0Ch, 0Dh, 0Dh, 0Bh, 0Ch, 0Ch, 0Ch, 0Ch
 14320 00009E1C 0B0C0C0C0C0C0C0C                        db  0Bh, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch
 14321 00009E24 0C0B0C0C0B0B0B0B                        db  0Ch, 0Bh, 0Ch, 0Ch, 0Bh, 0Bh, 0Bh, 0Bh
 14322 00009E2C 0C0C0C0C0C0C0C0C                        db  0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch
 14323 00009E34 0B0C0C0B0C0C0B0C                        db  0Bh, 0Ch, 0Ch, 0Bh, 0Ch, 0Ch, 0Bh, 0Ch
 14324 00009E3C 0C0B0C0C0B0A0A0B                        db  0Ch, 0Bh, 0Ch, 0Ch, 0Bh, 0Ah, 0Ah, 0Bh
 14325 00009E44 0B0B0B0B0B0A0A0B                        db  0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Ah, 0Ah, 0Bh
 14326 00009E4C 0B0A0A0B0B0B0B0B                        db  0Bh, 0Ah, 0Ah, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh
 14327 00009E54 0B0B0B0A0B0B0A0A                        db  0Bh, 0Bh, 0Bh, 0Ah, 0Bh, 0Bh, 0Ah, 0Ah
 14328 00009E5C 0A0B0B0A0A0B0B0A                        db  0Ah, 0Bh, 0Bh, 0Ah, 0Ah, 0Bh, 0Bh, 0Ah
 14329 00009E64 0A0B0B0A09090A0A                        db  0Ah, 0Bh, 0Bh, 0Ah,   9,   9, 0Ah, 0Ah
 14330 00009E6C 0A0A0A0A0909090A                        db  0Ah, 0Ah, 0Ah, 0Ah,   9,   9,   9, 0Ah
 14331 00009E74 0A090A0A09090809                        db  0Ah,   9, 0Ah, 0Ah,   9,   9,   8,   9
 14332 00009E7C 0909090909090908                        db    9,   9,   9,   9,   9,   9,   9,   8
 14333 00009E84 0809090808070708                        db    8,   9,   9,   8,   8,   7,   7,   8
 14334 00009E8C 0807060606060404                        db    8,   7,   6,   6,   6,   6,   4,   4
 14335 00009E94 0301080808080808                        db    3,   1,   8,   8,   8,   8,   8,   8
 14336 00009E9C 0808070808070708                        db    8,   8,   7,   8,   8,   7,   7,   8
 14337 00009EA4 0807070707070707                        db    8,   7,   7,   7,   7,   7,   7,   7
 14338 00009EAC 0707070707080809                        db    7,   7,   7,   7,   7,   8,   8,   9
 14339 00009EB4 0B0B0B0B0B0B0B0B                        db  0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh
 14340 00009EBC 0B0B0B0B0B0B0B0B                        db  0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh
 14341 00009EC4 0B0B0B0B0B0B0B0B                        db  0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh
 14342 00009ECC 0B0B0B0B040B0B0B                        db  0Bh, 0Bh, 0Bh, 0Bh,   4, 0Bh, 0Bh, 0Bh
 14343 00009ED4 0B0C0C0B0A0B0B0A                        db  0Bh, 0Ch, 0Ch, 0Bh, 0Ah, 0Bh, 0Bh, 0Ah
 14344 00009EDC 0A0A0A0B0B0A0A0A                        db  0Ah, 0Ah, 0Ah, 0Bh, 0Bh, 0Ah, 0Ah, 0Ah
 14345 00009EE4 0A0B0B0A0A0A0A0A                        db  0Ah, 0Bh, 0Bh, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah
 14346 00009EEC 0A0A0A0A0A0A0A0A                        db  0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah
 14347 00009EF4 0A0A0A0A0A0A0A0A                        db  0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah
 14348 00009EFC 0A0A0A0A0A0A0A0A                        db  0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah
 14349 00009F04 0A0A0A0A0A0A0A0A                        db  0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah
 14350 00009F0C 0A0A0B0B0A0A0A0A                        db  0Ah, 0Ah, 0Bh, 0Bh, 0Ah, 0Ah, 0Ah, 0Ah
 14351 00009F14 0A0A0A0A0A0A0A0A                        db  0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah
 14352 00009F1C 0A0B0B0A0B0B0A09                        db  0Ah, 0Bh, 0Bh, 0Ah, 0Bh, 0Bh, 0Ah,   9
 14353 00009F24 0A0A0A0A0B0B0A09                        db  0Ah, 0Ah, 0Ah, 0Ah, 0Bh, 0Bh, 0Ah,   9
 14354 00009F2C 090A0A090A0A0A0A                        db    9, 0Ah, 0Ah,   9, 0Ah, 0Ah, 0Ah, 0Ah
 14355 00009F34 09090A0A09090909                        db    9,   9, 0Ah, 0Ah,   9,   9,   9,   9
 14356 00009F3C 0909090909090909                        db    9,   9,   9,   9,   9,   9,   9,   9
 14357 00009F44 0909090909090909                        db    9,   9,   9,   9,   9,   9,   9,   9
 14358 00009F4C 0909090909090909                        db    9,   9,   9,   9,   9,   9,   9,   9
 14359 00009F54 0909090909090909                        db    9,   9,   9,   9,   9,   9,   9,   9
 14360 00009F5C 0A0A0909090A0A08                        db  0Ah, 0Ah,   9,   9,   9, 0Ah, 0Ah,   8
 14361 00009F64 0909080808080808                        db    9,   9,   8,   8,   8,   8,   8,   8
 14362 00009F6C 0808080808080809                        db    8,   8,   8,   8,   8,   8,   8,   9
 14363 00009F74 0908080808080809                        db    9,   8,   8,   8,   8,   8,   8,   9
 14364 00009F7C 0907080807070707                        db    9,   7,   8,   8,   7,   7,   7,   7
 14365 00009F84 0708080707060607                        db    7,   8,   8,   7,   7,   6,   6,   7
 14366 00009F8C 0706050506060404                        db    7,   6,   5,   5,   6,   6,   4,   4
 14367 00009F94 0404060606060606                        db    4,   4,   6,   6,   6,   6,   6,   6
 14368 00009F9C 0505050505040404                        db    5,   5,   5,   5,   5,   4,   4,   4
 14369 00009FA4 0401040404040404                        db    4,   1,   4,   4,   4,   4,   4,   4
 14370 00009FAC 0404040404040404                        db    4,   4,   4,   4,   4,   4,   4,   4
 14371 00009FB4 0404                                    db    4,   4
 14372 00009FB6 03                      _@@const_3      db 3                   
 14373 00009FB7 000000                                  db 3 dup(0)
 14374 00009FBA [1D480000]              mp3_synth_filter_procs dd synth_16bit_shift_0_slow ; SYNTH_MACRO 0,0,0
 14375 00009FBE [094B0000]                              dd synth_16bit_shift_1_slow ; SYNTH_MACRO 0,1,0
 14376 00009FC2 [FB4D0000]                              dd synth_16bit_shift_2_slow ; SYNTH_MACRO 0,2,0
 14377 00009FC6 [ED500000]                              dd synth_8bit_shift_0_slow ; SYNTH_MACRO 1,0,0
 14378 00009FCA [CE530000]                              dd synth_8bit_shift_1_slow ; SYNTH_MACRO 1,1,0
 14379 00009FCE [B5560000]                              dd synth_8bit_shift_2_slow ; SYNTH_MACRO 1,2,0
 14380 00009FD2 [DE350000]                              dd synth_16bit_shift_0_fast ; SYNTH_MACRO 0,0,1
 14381 00009FD6 [EA380000]                              dd synth_16bit_shift_1_fast ; SYNTH_MACRO 0,1,1
 14382 00009FDA [FC3B0000]                              dd synth_16bit_shift_2_fast ; SYNTH_MACRO 0,2,1
 14383 00009FDE [0E3F0000]                              dd synth_8bit_shift_0_fast ; SYNTH_MACRO 1,0,1
 14384 00009FE2 [0F420000]                              dd synth_8bit_shift_1_fast ; SYNTH_MACRO 1,1,1
 14385 00009FE6 [16450000]                              dd synth_8bit_shift_2_fast ; SYNTH_MACRO 1,2,1
 14386                                  ;txt_hello      db 'nocash mp3 decoder v1.4, 2024 martin korth, press ctrl+c to quit,'
 14387                                  ;               db ' BDS now',0Dh,0Ah,0
 14388                                  ; Erdogan Tan - 17/10/2024
 14389 00009FEA 0D0A                    txt_hello       db 13,10
 14390                                  		;db 'NOCASH MP3 PLAYER v1.4 for Windows ',0
 14391                                  		; 09/01/2025
 14392 00009FEC 4E4F43415348204D50-     		db 'NOCASH MP3 PLAYER v1.0 for TRDOS386 ',0
 14392 00009FF5 3320504C4159455220-
 14392 00009FFE 76312E3020666F7220-
 14392 0000A007 5452444F5333383620-
 14392 0000A010 00                 
 14393                                  		 
 14394 0000A011 66696C653A2000          txt_file        db 'file: ',0          
 14395 0000A018 66696C652073697A65-     txt_file_size   db 'file size: ',0     
 14395 0000A021 3A2000             
 14396 0000A024 2C206964332073697A-     txt_id3_size    db ', id3 size: ',0    
 14396 0000A02D 653A2000           
 14397 0000A031 2C207461672073697A-     txt_tag_size    db ', tag size: ',0    
 14397 0000A03A 653A2000           
 14398 0000A03E 696E7075743A2000        txt_input       db 'input: ',0         
 14399 0000A046 6F75747075743A2000      txt_output      db 'output: ',0        
 14400 0000A04F 20687A2C2000            txt_hz          db ' hz, ',0           
 14401 0000A055 206368616E6E656C73-     txt_channels    db ' channels, ',0     
 14401 0000A05E 2C2000             
 14402 0000A061 2062697400              txt_bit         db ' bit',0            
 14403 0000A066 206B6269742F7300        txt_kbit_s      db ' kbit/s',0         
 14404 0000A06E 63616E6E6F74206F70-     txt_not_found   db 'cannot open source file',0Dh,0Ah,0
 14404 0000A077 656E20736F75726365-
 14404 0000A080 2066696C650D0A00   
 14405 0000A088 75736167653A206D70-     txt_help        db 'usage: mp3play input.mp3 [output.wav] [verify.pcm] [/test]', 0Dh,0Ah
 14405 0000A091 33706C617920696E70-
 14405 0000A09A 75742E6D7033205B6F-
 14405 0000A0A3 75747075742E776176-
 14405 0000A0AC 5D205B766572696679-
 14405 0000A0B5 2E70636D5D205B2F74-
 14405 0000A0BE 6573745D0D0A       
 14406 0000A0C4 202020202020202020-                     db '                         [/mono] [/8bit] [/fast] [/half|/quarter]',0Dh,0Ah,0
 14406 0000A0CD 202020202020202020-
 14406 0000A0D6 202020202020205B2F-
 14406 0000A0DF 6D6F6E6F5D205B2F38-
 14406 0000A0E8 6269745D205B2F6661-
 14406 0000A0F1 73745D205B2F68616C-
 14406 0000A0FA 667C2F717561727465-
 14406 0000A103 725D0D0A00         
 14407 0000A108 766572696679206D61-     _@@txt_verify1  db 'verify max difference = ',0
 14407 0000A111 782064696666657265-
 14407 0000A11A 6E6365203D2000     
 14408 0000A121 206174206D70333A00      _@@txt_verify1_at_mp3 db ' at mp3:',0  
 14409 0000A12A 2C2061766572616765-     _@@txt_verify2  db ', average difference = ',0
 14409 0000A133 20646966666572656E-
 14409 0000A13C 6365203D2000       
 14410                                  
 14411                                  ; Erdogan Tan - 17/10/2024
 14412                                                 ;db 'NOCASH MP3 PLAYER v1.4 for Windows ',0
 14413 0000A142 287072657373204354-     txt_ctrlc       db '(press CTRL+C to quit)', 13,10,0
 14413 0000A14B 524C2B4320746F2071-
 14413 0000A154 756974290D0A00     
 14414                                  txt_ctrlc_size equ $ - txt_ctrlc
 14415 0000A15B 0D0A                    txt_about       db 13,10
 14416                                                  ;db '----------------------------------',13,10
 14417 0000A15D 2D2D2D2D2D2D2D2D2D-                     db '-----------------------------------',13,10
 14417 0000A166 2D2D2D2D2D2D2D2D2D-
 14417 0000A16F 2D2D2D2D2D2D2D2D2D-
 14417 0000A178 2D2D2D2D2D2D2D2D0D-
 14417 0000A181 0A                 
 14418 0000A182 4572646F67616E2054-                     db 'Erdogan Tan - 15/01/2025 (Assembler: NASM)', 13,10
 14418 0000A18B 616E202D2031352F30-
 14418 0000A194 312F32303235202841-
 14418 0000A19D 7373656D626C65723A-
 14418 0000A1A6 204E41534D290D0A   
 14419 0000A1AE 4F726967696E616C20-                     db 'Original code: MP3PLAYER.EXE v1.4 (20/09/2024)', 13,10
 14419 0000A1B7 636F64653A204D5033-
 14419 0000A1C0 504C415945522E4558-
 14419 0000A1C9 452076312E34202832-
 14419 0000A1D2 302F30392F32303234-
 14419 0000A1DB 290D0A             
 14420 0000A1DE 202020202020202020-                     db '               by Martin Korth (TASM source code)'
 14420 0000A1E7 202020202020627920-
 14420 0000A1F0 4D617274696E204B6F-
 14420 0000A1F9 72746820285441534D-
 14420 0000A202 20736F757263652063-
 14420 0000A20B 6F646529           
 14421 0000A20F 0D0A0D0A00                              db 13,10,13,10,0
 14422 0000A214 76312E342E30                            db 'v1.4.0'
 14423                                  ; 10/01/2025
 14424 0000A21A 00                      half_buffer	db 0
 14425                                  
 14426                                  ; ===========================================================================
 14427                                  ; Uninitialized DATA (BSS)
 14428                                  ; ===========================================================================
 14429                                  
 14430 0000A21B 90                      align 4
 14431                                  
 14432                                  bss_start:
 14433                                  
 14434                                  ; 10/01/2025
 14435                                  ABSOLUTE bss_start
 14436                                  
 14437                                  ; 12/01/2025
 14438                                  ;;;;
 14439                                  ; AC97 specific
 14440 0000A21C ????????                bus_dev_fn	resd 1
 14441 0000A220 ????????                dev_vendor	resd 1
 14442 0000A224 ????                    NAMBAR		resw 1
 14443 0000A226 ????                    NABMBAR		resw 1
 14444                                  ; SB16 specific
 14445 0000A228 ????????                audio_io_base	resd 1
 14446                                  ac97_int_ln_reg:
 14447 0000A22C ??                      audio_intr	resb 1
 14448                                  ;;;;
 14449                                  
 14450 0000A22D ??????                  alignb 4
 14451                                  
 14452                                  ;;;
 14453                                  ; 20/10/2024 (TRDOS 386 specific parameters)
 14454 0000A230 ??                      audio_hardware	resb 1
 14455 0000A231 ??                      vra		resb 1
 14456 0000A232 ????                    max_frequency	resw 1
 14457 0000A234 ??                      srb		resb 1
 14458 0000A235 ??                      volume_level	resb 1
 14459 0000A236 ??                      blocks		resb 1
 14460 0000A237 ??                      		resb 1
 14461 0000A238 ????????                buffer_size	resd 1
 14462                                  ;;;
 14463                                  
 14464                                  ;;;;
 14465                                  ; 13/01/2025 (Interpolation parameters)
 14466 0000A23C ????????                conversion	resd 1	; pointer to convers(t)ion
 14467                                  			; or interpolation proc address
 14468 0000A240 ????????                loadsize	resd 1	; decoding buffer size
 14469 0000A244 ??                      interpolation	resb 1	; interpolation status
 14470 0000A245 ??                      counter		resb 1  ; 15/01/2025
 14471 0000A246 ????                    		resw 1
 14472                                  ;;;;
 14473                                  
 14474                                  mp3_context_start:
 14475 0000A248 <res 1000h>             main_data_pool_start	resb 4096
 14476 0000B248 ????????                main_data_pool_wr_ptr	resd 1
 14477 0000B24C ????????                mp3_src_data_location	resd 1
 14478 0000B250 ????????                mp3_src_frame_size	resd 1
 14479 0000B254 ????????                mp3_src_frame_end	resd 1
 14480 0000B258 ????????                mp3_hdr_32bit_header	resd 1
 14481 0000B25C ????????                mp3_hdr_flag_crc	resd 1
 14482 0000B260 ????????                mp3_hdr_flag_mpeg25	resd 1
 14483 0000B264 ????????                mp3_hdr_flag_padding	resd 1
 14484 0000B268 ????????                mp3_sample_rate		resd 1
 14485 0000B26C ????????                mp3_hdr_sample_rate_index resd 1
 14486 0000B270 ????????                mp3_bit_rate		resd 1
 14487 0000B274 ????????                mp3_src_num_channels	resd 1
 14488 0000B278 ????????                mp3_output_num_channels resd 1
 14489 0000B27C ????????                mp3_output_sample_rate	resd 1
 14490 0000B280 ????????                mp3_bytes_per_sample	resd 1
 14491 0000B284 ????????                mp3_curr_syn_index	resd 1
 14492 0000B288 ????????                mp3_curr_syn_dst	resd 1
 14493 0000B28C ????????                mp3_nb_frames		resd 1
 14494 0000B290 ????????                mp3_hdr_mode_val	resd 1
 14495 0000B294 ????????                mp3_hdr_mode_ext	resd 1
 14496 0000B298 ????????                mp3_hdr_flag_lsf	resd 1
 14497 0000B29C ????????                mp3_synth_filter_proc	resd 1
 14498                                  
 14499 0000B2A0 <res 2000h>             mp3_synth_buf   resd 2048
 14500 0000D2A0 ????????????????        mp3_synth_index resd 2
 14501 0000D2A8 <res 2400h>             mp3_sb_samples  resd 2304
 14502                                  	                           ; MP3_MAX_CHANNELS*36*SBLIMIT
 14503 0000F6A8 <res 1200h>             mp3_mdct_buf    resd 1152
 14504                                                                     ; MP3_MAX_CHANNELS*SBLIMIT*18
 14505 000108A8 ????????                mp3_free_format_frame_size resd 1
 14506                                  
 14507 000108AC ??                      mp3_curr_vfrac_bits resb 1
 14508                                  
 14509 000108AD ??????                  alignb 4
 14510                                  
 14511 000108B0 ????????                mp3_xing_id     resd 1
 14512 000108B4 ????????                mp3_xing_flags  resd 1
 14513 000108B8 ????????                mp3_xing_frames resd 1
 14514 000108BC ????????                mp3_xing_filesize resd 1
 14515 000108C0 <res 64h>               mp3_xing_toc    resb 100
 14516 00010924 ????????                mp3_xing_vbr_scale resd 1
 14517 00010928 ????????                mp3_file_size   resd 1
 14518 0001092C ????????                mp3_id3_size    resd 1
 14519 00010930 ????????                mp3_tag_size    resd 1
 14520                                  
 14521 00010934 ????????                mp3_num_frames_decoded	resd 1
 14522 00010938 ????????                mp3_total_output_size	resd 1
 14523 0001093C ????????                mp3_samples_dst		resd 1
 14524                                  ; DWORD mp3_samples_output_size
 14525 00010940 ????????                mp3_samples_output_size	resd 1
 14526 00010944 ????????                mp3_samples_dst_step	resd 1
 14527                                  
 14528 00010948 ????????                mp3_curr_channel	resd 1
 14529 0001094C ????????                mp3_curr_granule	resd 1
 14530 00010950 ????????                mp3_curr_frame		resd 1
 14531                                  
 14532 00010954 ????????                mp3_bitstream_start	resd 1
 14533 00010958 ????????                mp3_src_remain		resd 1
 14534 0001095C ????????                mp3_extra_bytes		resd 1
 14535 00010960 ????????                mp3_main_data_begin	resd 1
 14536 00010964 ????????                mp3_num_compress_bits	resd 1
 14537                                  
 14538 00010968 ????????                mp3_nb_granules resd 1
 14539                                  
 14540 0001096C <res 2680h>             mp3_granules		resb 9856
 14541 00012FEC <res 480h>              mp3_exponents		resw 576
 14542 0001346C <res B800h>             huff_tree_buf		resb 0B800h
 14543 0001EC6C <res 240h>              mp3_band_index_long	resw 288
 14544 0001EEAC <res 803Ch>             mp3_table_4_3_exp	resb 32828
 14545                                  
 14546 00026EE8 <res 200F0h>            mp3_table_4_3_value	resd 32828
 14547 00046FD8 <res 800h>              mp3_exp_table		resd 512
 14548 000477D8 <res 8000h>             mp3_expval_table	resd 8192
 14549 0004F7D8 <res 480h>              mp3_mdct_win		resd 288
 14550 0004FC58 <res 800h>              mp3_is_table_lsf	resd 512
 14551 00050458 <res 1000h>             mp3_synth_win		resd 1024
 14552 00051458 <res 2000h>             mp3_lsf_sf_expand_exploded_table resb 8192
 14553                                  mp3_context_end:
 14554 00053458 ????????                _@@region_address0	resd 1
 14555 0005345C ????????                _@@region_address1	resd 1
 14556 00053460 ????????                _@@saved_sp		resd 1
 14557 00053464 ????????                mp3_main_data_siz	resd 1
 14558 00053468 ????????                _@@scfsi        resd 1
 14559 0005346C <res Ch>                _@@gains        resd 3
 14560 00053478 ????????                _@@rle_point    resd 1
 14561 0005347C ????????                _@@III          resd 1
 14562 00053480 ????????                _@@JJJ          resd 1
 14563 00053484 ????????                _@@linbits      resd 1
 14564 00053488 ????????                _@@vlc_table    resd 1
 14565 0005348C ????????                _@@coarse_end   resd 1
 14566                                  
 14567 00053490 ????????                _@rle_point     resd 1
 14568 00053494 ????????                _@@rle_ptr      resd 1
 14569 00053498 ????????                _@@rle_val      resd 1
 14570 0005349C ????????                _@@rle_val_x_40h resd 1
 14571 000534A0 ????????                _@@max_bands    resb 4
 14572 000534A4 ????????                _@@max_blocks   resd 1
 14573 000534A8 ????????                _@@max_pos      resd 1
 14574 000534AC <res 28h>               _@@sfb_array    resb 40
 14575 000534D4 ????????                _@@is_tab       resd 1
 14576 000534D8 ????????                _@@n_long_sfb   resd 1
 14577 000534DC ????????                _@@n_short_sfb  resd 1
 14578 000534E0 ????????                _@@n_sfb        resd 1
 14579 000534E4 <res 900h>              _@@tmp          resb 2304
 14580 00053DE4 ????????                _@@s0           resd 1
 14581 00053DE8 ????????                _@@s2           resd 1
 14582 00053DEC ????????                _@@s3           resd 1
 14583                                  
 14584 00053DF0 <res 48h>               _@@@tmp         resd 18 ; resb 72
 14585 00053E38 ????????                _@@tmp0         resd 1
 14586 00053E3C ????????                _@@tmp1         resd 1
 14587 00053E40 ????????                _@@tmp2         resd 1
 14588 00053E44 ????????                _@@tmp3         resd 1
 14589 00053E48 ????????                _@@tmp4         resd 1
 14590 00053E4C ????????                _@@tmp5         resd 1
 14591 00053E50 ????????                mp3_out2_a0     resd 1
 14592 00053E54 ????????                mp3_out2_a1     resd 1
 14593 00053E58 ????????                mp3_out2_a2     resd 1
 14594 00053E5C ????????                mp3_out2_b0     resd 1
 14595 00053E60 ????????                mp3_out2_b1     resd 1
 14596 00053E64 ????????                mp3_out2_b2     resd 1
 14597 00053E68 ????????                                resd 1
 14598 00053E6C ????????                                resd 1
 14599 00053E70 ????????                _@@@JJJ         resd 1
 14600 00053E74 ????????                _@@www          resd 1
 14601 00053E78 ????????                _@@mdct_long_end resd 1
 14602 00053E7C ????????                _@@sblimit      resd 1
 14603 00053E80 ????????                _@@switch_point resd 1
 14604 00053E84 <res 100h>              mp3_huff_tmp_bits	resb 256
 14605 00053F84 <res 200h>              mp3_huff_tmp_codes	resb 512
 14606 00054184 ????????                _@@table_nb_bits	resd 1
 14607 00054188 ????????                _@@nb_codes		resd 1
 14608 0005418C ????????                _@@prefix_numbits	resd 1
 14609 00054190 ????????                _@@prefix_pattern	resd 1
 14610 00054194 ????????                _@@curr_table_size	resd 1
 14611 00054198 ????????                _@@curr_table_mask	resd 1
 14612 0005419C ????????                _@@curr_table_index	resd 1
 14613 000541A0 ????????                _@@granule_addr		resd 1
 14614                                  ; HANDLE hFile
 14615 000541A4 ????????                hFile           resd 1
 14616                                  ; HANDLE hMap
 14617                                  ;hMap           resd 1
 14618 000541A8 ????????                stream_start    resd 1
 14619 000541AC ????????                stream_pos      resd 1
 14620 000541B0 ????????                bytes_left      resd 1
 14621                                  
 14622                                  ; 20/10/2024
 14623                                  ; DWORD diskresult
 14624                                  ;diskresult     resd 1
 14625                                  ; HANDLE std_out
 14626                                  ;std_out        resd 1
 14627                                  ;cmdline_buf    resb 1024
 14628 000541B4 <res 80h>               cmdline_buf	resb 128
 14629                                  ; HANDLE mp3_wav_handle
 14630 00054234 ????????                mp3_wav_handle  resd 1
 14631                                  ; HANDLE mp3_pcm_handle
 14632 00054238 ????????                mp3_pcm_handle  resd 1
 14633 0005423C ????????                _@@max_diff     resd 1
 14634 00054240 ????????????????        _@@avg_diff     resd 2
 14635 00054248 ????????                pcm_filepos     resd 1
 14636 0005424C ????????                _@@mono_convert resd 1
 14637 00054250 ????????                _@@pcm_steps    resw 2
 14638 00054254 ????????                _@@worst_pcm_filepos resd 1
 14639 00054258 ????????                _@@worst_mp3_filepos resd 1
 14640 0005425C ????????                		resd 1
 14641                                  ;alignb 4
 14642                                  
 14643                                  ; 10/01/2025
 14644 00054260 <res DA0h>              alignb 4096
 14645                                  
 14646                                  ; 12/01/2025
 14647                                  ; 09/01/2025
 14648                                  ;sample_buffer	resb 36864
 14649                                  ;sample_buffer	resb 8*MP3_MAX_OUTPUT_SIZE
 14650                                  ;sample_buffer_size equ $-sample_buffer
 14651                                  
 14652                                  ; 15/01/2025
 14653 00055000 <res 8000h>             decoding_buffer	resb 32768
 14654 0005D000 <res 8000h>             sample_buffer	resb 32768
 14655                                  
 14656                                  ;alignb 4096
 14657                                  
 14658                                  end_of_bss:
 14659                                  
 14660                                  ; ===========================================================================
 14661                                  ; end

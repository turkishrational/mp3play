     1                                  ; ****************************************************************************
     2                                  ; MP3PLAY.PRG - MP3 DECODER/PLAYER 1.0 for TRDOS 386 Operating System
     3                                  ; ----------------------------------------------------------------------------
     4                                  ; Based on 
     5                                  ; NOCASH MP3PLAY.EXE 1.4 (Windows) ASM source code (Martin Korth, 20/09/2024)
     6                                  ;
     7                                  ; FASM Source Code: Erdogan Tan - 19/10/2024 - 22/10/2024
     8                                  ; NASM Source Code: Erdogan Tan - 09/01/2025
     9                                  ;
    10                                  ; [ Last Modification: 13/01/2025 ]
    11                                  ;
    12                                  ; ----------------------------------------------------------------------------
    13                                  ; Modified from on MP3PLAY.ASM (for Windows console) source code - 17/10/2024
    14                                  ; ****************************************************************************
    15                                  ; Modified from Martin Korth's 'mp3play.asm' (TASM32) source code... (v1.4)
    16                                  ; Applied development method:
    17                                  ;         Disassembling 'mp3play.exe' v1.4 by using HEX-RAYS disassembler;
    18                                  ;         then... converting disassembled code to FASM syntax,
    19                                  ;                 adding '.idata' code (by help of FASM examples) to the raw
    20                                  ;                        asm file. Converting 'proc' procedures to labels.
    21                                  ;               and Finally: assembling mp3play.asm (single) file by using
    22                                  ;                           'fasm mp3play.asm' command.
    23                                  ;
    24                                  ; NOTE:
    25                                  ; Martin Korth's MP3PLAY.EXE (v1.4, 20/09/2024) file size is 45056 bytes.
    26                                  ; (This) modified MP3PLAY.EXE (v1.4.0, 17/10/2024) is 37888 bytes.
    27                                  ;
    28                                  ; ---------------------------------------------------------------------------
    29                                  ; nasm mp3play.s -l mp3play.txt -o MP3PLAY.PRG -Z error.txt
    30                                  
    31                                  
    32                                  ; ===========================================================================
    33                                  ; CODE
    34                                  ; ===========================================================================
    35                                  
    36                                  		[BITS 32] ; 32-bit intructions
    37                                  
    38                                  		[ORG 0]
    39                                  
    40                                  ; ===========================================================================
    41                                  
    42                                  		; 20/10/2024
    43                                  start:
    44                                  		; 21/10/2024
    45 00000000 E8E16A0000              		call	set_break	; set and clear bss section
    46                                  					; also set stream_start position
    47                                  
    48                                                  ;mov    edx, txt_hello  ; "nocash mp3 decoder v1.4, 2024" ...
    49                                                  ;call   wrstr_edx
    50 00000005 BB[3A840000]            		mov	ebx, txt_hello
    51 0000000A E87E6B0000              		call	print_msg
    52                                  
    53 0000000F E8AD690000                              call    get_commandline
    54 00000014 0F8230010000                            jc      .exit
    55                                  
    56 0000001A 31ED                                    xor     ebp, ebp
    57 0000001C E8DD630000                              call    mp3_init
    58 00000021 E8D76A0000                              call    open_and_mmap_the_file
    59 00000026 0F821E010000                            jc      .exit
    60 0000002C E81E010000                              call    detect_cpu_386_and_up
    61 00000031 E8696B0000                              call    GetTickCount
    62 00000036 F7D8                                    neg     eax
    63 00000038 A3[586F0000]                            mov     [millisecond_count], eax
    64                                  
    65                                  		;;;
    66                                  		; 11/01/2025
    67 0000003D E8416C0000              		call	detect_enable_audio_device
    68 00000042 0F8202010000            		jc	.exit
    69                                  		;;;
    70                                  
    71 00000048 E84B640000                              call    mp3_check_1st_frame
    72 0000004D 0F82F7000000                            jc      .exit
    73 00000053 803D[456F0000]00                        cmp     byte [option_test], 0
    74 0000005A 7407                                    jz      short .no_benchmark_test
    75 0000005C E801660000                              call    mp3_plain_test_without_output
    76 00000061 EB33                                    jmp     short .decode_done
    77                                  
    78                                  .no_benchmark_test:
    79 00000063 833D[F87D0000]00                        cmp     dword [mp3_pcm_fname], 0
    80 0000006A 740A                                    jz      short .no_pcm_verify
    81 0000006C E819670000                              call    mp3_verify_pcm_file
    82 00000071 E9D4000000                              jmp     .exit
    83                                  
    84                                  .no_pcm_verify:
    85 00000076 833D[F47D0000]00                        cmp     dword [mp3_dst_fname], 0
    86 0000007D 7407                                    jz      short .no_wav_output
    87 0000007F E813660000                              call    mp3_cast_to_wav_file
    88 00000084 EB10                                    jmp     short .decode_done
    89                                  
    90                                  .no_wav_output:
    91                                  		;;; 
    92                                  		; 20/10/2024
    93                                  		;call	detect_enable_audio_device
    94                                  		;jc	.exit
    95 00000086 E8A46C0000              		call	audio_system_init
    96 0000008B 0F82B9000000            		jc	.exit
    97                                  		;;;
    98                                  
    99 00000091 E8386D0000                              call    mp3_cast_to_speaker
   100                                  
   101                                  .decode_done:
   102 00000096 E8046B0000                              call    GetTickCount
   103 0000009B 0105[586F0000]                          add     [millisecond_count], eax
   104 000000A1 BA[2D7E0000]                            mov     edx, txt_decode_timing1 ; "audio duration "
   105 000000A6 E8F7640000                              call    wrstr_edx
   106 000000AB A1[68ED0000]                            mov     eax, [mp3_total_output_size]
   107 000000B0 BAE8030000                              mov     edx, 1000
   108 000000B5 F7E2                                    mul     edx
   109 000000B7 F735[AE960000]                          div     dword [mp3_output_sample_rate]
   110 000000BD 31D2                                    xor     edx, edx
   111 000000BF F735[AA960000]                          div     dword [mp3_output_num_channels]
   112 000000C5 31D2                                    xor     edx, edx
   113 000000C7 F735[B2960000]                          div     dword [mp3_bytes_per_sample]
   114 000000CD A3[546F0000]                            mov     [mp3_output_milliseconds], eax
   115 000000D2 E801650000                              call    wr_decimal_eax_with_thousands_seperator
   116 000000D7 BA[3D7E0000]                            mov     edx, txt_decode_timing2 ; " milliseconds, decoded in "
   117 000000DC E8C1640000                              call    wrstr_edx
   118 000000E1 A1[586F0000]                            mov     eax, [millisecond_count]
   119 000000E6 E8ED640000                              call    wr_decimal_eax_with_thousands_seperator
   120 000000EB BA[587E0000]                            mov     edx, txt_decode_timing3 ; " milliseconds\r\n"
   121 000000F0 E8AD640000                              call    wrstr_edx
   122 000000F5 BA[687E0000]                            mov     edx, txt_clks_per_second ; " clock cycles per second:\r\n"
   123 000000FA E8A3640000                              call    wrstr_edx
   124 000000FF BE[5C6F0000]                            mov     esi, ttt ; rdtsc_list_start
   125                                  
   126                                  .timelog_lop:
   127 00000104 E8BB640000                              call    wrspc
   128 00000109 8D5608                                  lea     edx, [esi+8]
   129 0000010C E891640000                              call    wrstr_edx
   130 00000111 E8AE640000                              call    wrspc
   131 00000116 8B06                                    mov     eax, [esi]
   132 00000118 8B5E04                                  mov     ebx, [esi+4]
   133 0000011B BAE8030000                              mov     edx, 1000
   134 00000120 0FAFDA                                  imul    ebx, edx
   135 00000123 F7E2                                    mul     edx
   136 00000125 01DA                                    add     edx, ebx
   137 00000127 3B15[546F0000]                          cmp     edx, [mp3_output_milliseconds]
   138 0000012D 730B                                    jnb     short .timelog_oops
   139 0000012F F735[546F0000]                          div     dword [mp3_output_milliseconds]
   140 00000135 E89E640000                              call    wr_decimal_eax_with_thousands_seperator
   141                                  
   142                                  .timelog_oops:
   143 0000013A E874640000                              call    wrcrlf
   144 0000013F 83C618                                  add     esi, 24
   145 00000142 81FE[24710000]                          cmp     esi, mp3_bitrate_tab
   146 00000148 75BA                                    jnz     short .timelog_lop
   147                                  
   148                                  .exit:
   149                                  		;push   0               ; uExitCode
   150                                                  ;call   ExitProcess
   151 0000014A E9746A0000              		jmp	ExitProcess
   152                                  
   153                                  
   154                                  ; =============== S U B R O U T I N E =======================================
   155                                  
   156                                  
   157                                  detect_cpu_386_and_up:
   158 0000014F C605[516F0000]03                        mov     byte [detected_cpu], 3
   159 00000156 89E3                                    mov     ebx, esp
   160 00000158 83E4FC                                  and     esp, ~3 ; not 3
   161 0000015B 9C                                      pushf
   162 0000015C 58                                      pop     eax
   163 0000015D 89C1                                    mov     ecx, eax
   164 0000015F 3500000400                              xor     eax, 40000h
   165 00000164 50                                      push    eax
   166 00000165 9D                                      popf
   167 00000166 9C                                      pushf
   168 00000167 58                                      pop     eax
   169 00000168 31C8                                    xor     eax, ecx
   170 0000016A 51                                      push    ecx
   171 0000016B 9D                                      popf
   172 0000016C 89DC                                    mov     esp, ebx
   173 0000016E A900000400                              test    eax, 40000h
   174 00000173 7431                                    jz      short .no_id
   175 00000175 FE05[516F0000]                          inc	byte [detected_cpu]
   176 0000017B E827000000                              call    @@get_id_flag
   177 00000180 7507                                    jnz     short .yep_id
   178 00000182 E820000000                              call    @@get_id_flag
   179 00000187 741D                                    jz      short .no_id
   180                                  
   181                                  .yep_id:
   182 00000189 B801000000                              mov     eax, 1
   183 0000018E 0FA2                                    cpuid
   184 00000190 80E40F                                  and     ah, 0Fh
   185 00000193 8825[516F0000]                          mov     [detected_cpu], ah
   186 00000199 C605[506F0000]01                        mov	byte [cpuid_exists], 1
   187 000001A0 8915[4C6F0000]                          mov     [cpuid_flags], edx
   188                                  
   189                                  .no_id:
   190 000001A6 C3                                      retn
   191                                  
   192                                  ; =============== S U B R O U T I N E =======================================
   193                                  
   194                                  
   195                                  @@get_id_flag:
   196 000001A7 9C                                      pushf
   197 000001A8 58                                      pop     eax
   198 000001A9 0D00002000                              or      eax, 200000h
   199 000001AE 50                                      push    eax
   200 000001AF 9D                                      popf
   201 000001B0 9C                                      pushf
   202 000001B1 58                                      pop     eax
   203 000001B2 A900002000                              test    eax, 200000h
   204 000001B7 C3                                      retn
   205                                  
   206                                  ; =============== S U B R O U T I N E =======================================
   207                                  
   208                                  bswap_eax:
   209 000001B8 86E0                                    xchg    al, ah
   210 000001BA C1C810                                  ror     eax, 10h
   211 000001BD 86E0                                    xchg    al, ah
   212 000001BF C3                                      retn
   213                                  
   214                                  ; =============== S U B R O U T I N E =======================================
   215                                  
   216                                  mp3_recollect_bits:
   217 000001C0 F7C601000000                            test    esi, 1
   218 000001C6 7510                                    jnz     short .odd
   219 000001C8 668B2E                                  mov     bp, [esi]
   220 000001CB 83C602                                  add     esi, 2
   221 000001CE 66C1CD08                                ror     bp, 8
   222 000001D2 C1E510                                  shl     ebp, 16
   223 000001D5 B500                                    mov     ch, 0
   224 000001D7 C3                                      retn
   225                                  
   226                                  .odd:
   227 000001D8 0FB62E                                  movzx   ebp, byte [esi]
   228 000001DB 46                                      inc     esi
   229 000001DC C1E510                                  shl     ebp, 16
   230 000001DF 668B2E                                  mov     bp, [esi]
   231 000001E2 83C602                                  add     esi, 2
   232 000001E5 66C1CD08                                ror     bp, 8
   233 000001E9 C1E508                                  shl     ebp, 8
   234 000001EC B508                                    mov     ch, 8
   235 000001EE C3                                      retn
   236                                  
   237                                  ; =============== S U B R O U T I N E =======================================
   238                                  
   239                                  
   240                                  mp3_get_bits:
   241 000001EF 89E8                                    mov     eax, ebp
   242 000001F1 D3E5                                    shl     ebp, cl
   243 000001F3 D3C0                                    rol     eax, cl
   244 000001F5 31E8                                    xor     eax, ebp
   245 000001F7 28CD                                    sub     ch, cl
   246 000001F9 7801                                    js      short mp3_collect_more
   247 000001FB C3                                      retn
   248                                  
   249                                  mp3_collect_more:
   250 000001FC 88E9                                    mov     cl, ch
   251 000001FE 80C510                                  add     ch, 10h
   252 00000201 D3C5                                    rol     ebp, cl
   253 00000203 668B2E                                  mov     bp, [esi]
   254 00000206 83C602                                  add     esi, 2
   255 00000209 66C1CD08                                ror     bp, 8
   256 0000020D D3CD                                    ror     ebp, cl
   257 0000020F C3                                      retn
   258                                  
   259                                  ; =============== S U B R O U T I N E =======================================
   260                                  
   261                                  
   262                                  mp3_uncollect_bits:
   263 00000210 83EE02                                  sub     esi, 2
   264 00000213 C0ED03                                  shr     ch, 3
   265 00000216 0FB6CD                                  movzx   ecx, ch
   266 00000219 29CE                                    sub     esi, ecx
   267 0000021B C3                                      retn
   268                                  
   269                                  ; =============== S U B R O U T I N E =======================================
   270                                  
   271                                  
   272                                  mp3_search_get_header:
   273 0000021C F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
   274 00000223 740E                                    jz      short .no_rdtsc_supported
   275 00000225 0F31                                    rdtsc
   276 00000227 2905[5C6F0000]                          sub     [ttt], eax
   277 0000022D 1915[606F0000]                          sbb     [ttt+4], edx
   278                                  
   279                                  .no_rdtsc_supported:
   280 00000233 C705[8CED0000]0000-                     mov	dword [mp3_extra_bytes], 0
   280 0000023B 0000               
   281                                  
   282                                  .retry_header:
   283 0000023D 833D[88ED0000]04                        cmp	dword [mp3_src_remain], 4
   284 00000244 0F82B5010000                            jb      .fail_no_header
   285 0000024A 803EFF                                  cmp     byte [esi], 0FFh
   286 0000024D 7516                                    jnz     short .bad_header
   287 0000024F 8A4601                                  mov     al, [esi+1]
   288 00000252 24E6                                    and     al, 0E6h
   289 00000254 3CE2                                    cmp     al, 0E2h
   290 00000256 750D                                    jnz     short .bad_header
   291 00000258 8A4602                                  mov     al, [esi+2]
   292 0000025B 3CF0                                    cmp     al, 0F0h
   293 0000025D 7306                                    jnb     short .bad_header
   294 0000025F 240C                                    and     al, 0Ch
   295 00000261 3C0C                                    cmp     al, 0Ch
   296 00000263 7519                                    jnz     short .good_header
   297                                  
   298                                  .bad_header:
   299 00000265 46                                      inc	esi
   300 00000266 FF0D[88ED0000]                          dec	dword [mp3_src_remain]
   301 0000026C FF05[8CED0000]                          inc	dword [mp3_extra_bytes]
   302 00000272 C705[7A960000]-                         mov	dword [main_data_pool_wr_ptr], main_data_pool_start
   302 00000278 [7A860000]         
   303 0000027C EBBF                                    jmp	short .retry_header
   304                                  
   305                                  .good_header:
   306 0000027E 8B06                                    mov	eax, [esi]
   307 00000280 E833FFFFFF                              call	bswap_eax
   308 00000285 A3[8A960000]                            mov	[mp3_hdr_32bit_header], eax
   309 0000028A C705[CA960000]0000-                     mov	dword [mp3_hdr_flag_lsf], 0
   309 00000292 0000               
   310 00000294 C705[92960000]0000-                     mov	dword [mp3_hdr_flag_mpeg25], 0
   310 0000029C 0000               
   311 0000029E C705[98ED0000]0200-                     mov	dword [mp3_nb_granules], 2
   311 000002A6 0000               
   312 000002A8 A900000800                              test	eax, 80000h
   313 000002AD 7525                                    jnz	short .lsf_this
   314 000002AF C705[CA960000]0100-                     mov	dword [mp3_hdr_flag_lsf], 1
   314 000002B7 0000               
   315 000002B9 C705[98ED0000]0100-                     mov	dword [mp3_nb_granules], 1
   315 000002C1 0000               
   316 000002C3 A900001000                              test	eax, 100000h
   317 000002C8 750A                                    jnz	short .lsf_this
   318 000002CA C705[92960000]0100-                     mov	dword [mp3_hdr_flag_mpeg25], 1
   318 000002D2 0000               
   319                                  
   320                                  .lsf_this:
   321 000002D4 C1E80A                                  shr     eax, 10
   322 000002D7 83E003                                  and     eax, 3
   323 000002DA 8B0D[CA960000]                          mov     ecx, [mp3_hdr_flag_lsf]
   324 000002E0 030D[92960000]                          add     ecx, [mp3_hdr_flag_mpeg25]
   325 000002E6 0FB79400[64710000]                      movzx   edx, word [mp3_freq_tab+eax*2]
   326 000002EE D3EA                                    shr     edx, cl
   327 000002F0 8D0C49                                  lea     ecx, [ecx+ecx*2]
   328 000002F3 01C8                                    add     eax, ecx
   329 000002F5 A3[9E960000]                            mov     [mp3_hdr_sample_rate_index], eax
   330 000002FA 8915[9A960000]                          mov     [mp3_sample_rate], edx
   331                                  
   332 00000300 8A0D[486F0000]                          mov     cl, [option_rate_shift]
   333 00000306 D3EA                                    shr     edx, cl
   334                                  
   335 00000308 8915[AE960000]                          mov     [mp3_output_sample_rate], edx
   336 0000030E A1[8A960000]                            mov     eax, [mp3_hdr_32bit_header]
   337 00000313 C1E810                                  shr     eax, 10h
   338 00000316 F7D0                                    not     eax
   339 00000318 83E001                                  and     eax, 1
   340 0000031B A3[8E960000]                            mov     [mp3_hdr_flag_crc], eax
   341 00000320 A1[8A960000]                            mov     eax, [mp3_hdr_32bit_header]
   342 00000325 C1E809                                  shr     eax, 9
   343 00000328 83E001                                  and     eax, 1
   344 0000032B A3[96960000]                            mov     [mp3_hdr_flag_padding], eax
   345 00000330 A1[8A960000]                            mov     eax, [mp3_hdr_32bit_header]
   346 00000335 C1E80C                                  shr     eax, 12
   347 00000338 83E00F                                  and     eax, 0Fh
   348 0000033B 7512                                    jnz     short .not_free_format
   349 0000033D E85F5D0000                              call    mp3_detect_free_format_block_size
   350 00000342 0F821DFFFFFF                            jb      .bad_header
   351 00000348 A1[DAEC0000]                            mov     eax, [mp3_free_format_frame_size]
   352 0000034D EB34                                    jmp     short .this_frame_size_plus_padding
   353                                  
   354                                  .not_free_format:
   355 0000034F 8B15[CA960000]                          mov     edx, [mp3_hdr_flag_lsf]
   356 00000355 C1E204                                  shl     edx, 4
   357 00000358 01D0                                    add     eax, edx
   358 0000035A 0FB78400[24710000]                      movzx   eax, word [mp3_bitrate_tab+eax*2] ; kbit/s
   359 00000362 69C0E8030000                            imul    eax, 1000       ; bit/s
   360 00000368 A3[A2960000]                            mov     [mp3_bit_rate], eax
   361 0000036D 69C090000000                            imul    eax, 144        ; 144=90h=8*18
   362 00000373 31D2                                    xor     edx, edx
   363 00000375 F735[9A960000]                          div     dword [mp3_sample_rate]
   364 0000037B 8B0D[CA960000]                          mov     ecx, [mp3_hdr_flag_lsf]
   365 00000381 D3E8                                    shr     eax, cl
   366                                  
   367                                  .this_frame_size_plus_padding:
   368 00000383 0305[96960000]                          add     eax, [mp3_hdr_flag_padding]
   369 00000389 A3[82960000]                            mov     [mp3_src_frame_size], eax
   370 0000038E 01F0                                    add     eax, esi
   371 00000390 A3[86960000]                            mov     [mp3_src_frame_end], eax
   372 00000395 A1[8A960000]                            mov     eax, [mp3_hdr_32bit_header]
   373 0000039A C1E806                                  shr     eax, 6
   374 0000039D 83E003                                  and     eax, 3
   375 000003A0 A3[C2960000]                            mov     [mp3_hdr_mode_val], eax
   376 000003A5 BA01000000                              mov     edx, 1
   377                                  
   378 000003AA 3C03                    		cmp     al, 3
   379 000003AC 7401                                    jz      short .this_channels
   380                                  
   381                                                  ;mov    edx, 2
   382                                  		; 10/01/2025
   383 000003AE 42                      		inc	edx
   384                                  .this_channels:
   385 000003AF 8915[A6960000]                          mov	[mp3_src_num_channels], edx
   386 000003B5 803D[466F0000]00                        cmp	byte [option_mono], 0
   387 000003BC 7405                                    jz	short .allow_stereo
   388 000003BE BA01000000                              mov	edx, 1
   389                                  .allow_stereo:
   390 000003C3 8915[AA960000]                          mov     [mp3_output_num_channels], edx
   391 000003C9 0FAF15[B2960000]                        imul    edx, [mp3_bytes_per_sample]
   392 000003D0 8915[74ED0000]                          mov     [mp3_samples_dst_step], edx
   393 000003D6 A1[8A960000]                            mov     eax, [mp3_hdr_32bit_header]
   394 000003DB C1E804                                  shr     eax, 4
   395 000003DE 83E003                                  and     eax, 3
   396 000003E1 A3[C6960000]                            mov     [mp3_hdr_mode_ext], eax
   397 000003E6 F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
   398 000003ED 740E                                    jz      short .no_rdtsc_supported@
   399 000003EF 0F31                                    rdtsc
   400 000003F1 0105[5C6F0000]                          add     [ttt], eax
   401 000003F7 1115[606F0000]                          adc     [ttt+4], edx
   402                                  
   403                                  .no_rdtsc_supported@:
   404 000003FD F8                                      clc
   405 000003FE C3                                      retn
   406                                  
   407                                  .fail_no_header:
   408 000003FF F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
   409 00000406 740E                                    jz      short .no_rdtsc_supported@@
   410 00000408 0F31                                    rdtsc
   411 0000040A 0105[5C6F0000]                          add     [ttt], eax
   412 00000410 1115[606F0000]                          adc     [ttt+4], edx
   413                                  
   414                                  .no_rdtsc_supported@@:
   415 00000416 C705[82960000]0000-                     mov     dword [mp3_src_frame_size], 0
   415 0000041E 0000               
   416 00000420 F9                                      stc
   417 00000421 C3                                      retn
   418                                  
   419                                  
   420                                  ; =============== S U B R O U T I N E =======================================
   421                                  
   422                                  
   423                                  mp3_bitstream_read_header_extra:
   424 00000422 F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
   425 00000429 740E                                    jz      short .no_rdtsc_supported
   426 0000042B 0F31                                    rdtsc
   427 0000042D 2905[746F0000]                          sub     [rdtsc_read_header_extra], eax
   428 00000433 1915[786F0000]                          sbb     [rdtsc_read_header_extra+4], edx
   429                                  
   430                                  .no_rdtsc_supported:
   431 00000439 833D[8E960000]00                        cmp     dword [mp3_hdr_flag_crc], 0
   432 00000440 7422                                    jz      short .without_crc
   433 00000442 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 16
   434 00000444 C1E510                                  shl     ebp, 10h
   435 00000447 C1C010                                  rol     eax, 10h
   436 0000044A 31E8                                    xor     eax, ebp
   437 0000044C 80ED10                                  sub     ch, 10h
   438 0000044F 7913                                    jns     short .without_crc
   439 00000451 88E9                                    mov     cl, ch          ; mp3mac_collect_more
   440 00000453 80C510                                  add     ch, 10h
   441 00000456 D3C5                                    rol     ebp, cl
   442 00000458 668B2E                                  mov     bp, [esi]
   443 0000045B 83C602                                  add     esi, 2
   444 0000045E 66C1CD08                                ror     bp, 8
   445 00000462 D3CD                                    ror     ebp, cl
   446                                  
   447                                  .without_crc:
   448 00000464 833D[CA960000]00                        cmp     dword [mp3_hdr_flag_lsf], 0
   449 0000046B 745B                                    jz      short .pre_lsf_zero
   450 0000046D C705[94ED0000]0900-                     mov     dword [mp3_num_compress_bits], 9
   450 00000475 0000               
   451 00000477 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 8
   452 00000479 C1E508                                  shl     ebp, 8
   453 0000047C C1C008                                  rol     eax, 8
   454 0000047F 31E8                                    xor     eax, ebp
   455 00000481 80ED08                                  sub     ch, 8
   456 00000484 7913                                    jns     short .without_crc@
   457 00000486 88E9                                    mov     cl, ch
   458 00000488 80C510                                  add     ch, 10h
   459 0000048B D3C5                                    rol     ebp, cl
   460 0000048D 668B2E                                  mov     bp, [esi]
   461 00000490 83C602                                  add     esi, 2
   462 00000493 66C1CD08                                ror     bp, 8
   463 00000497 D3CD                                    ror     ebp, cl
   464                                  
   465                                  .without_crc@:
   466 00000499 A3[90ED0000]                            mov     [mp3_main_data_begin], eax
   467 0000049E 8A0D[A6960000]                          mov     cl, byte [mp3_src_num_channels]
   468 000004A4 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits cl
   469 000004A6 D3E5                                    shl     ebp, cl
   470 000004A8 D3C0                                    rol     eax, cl
   471 000004AA 31E8                                    xor     eax, ebp
   472 000004AC 28CD                                    sub     ch, cl
   473 000004AE 7913                                    jns     short .without_crc@@
   474 000004B0 88E9                                    mov     cl, ch
   475 000004B2 80C510                                  add     ch, 10h
   476 000004B5 D3C5                                    rol     ebp, cl
   477 000004B7 668B2E                                  mov     bp, [esi]
   478 000004BA 83C602                                  add     esi, 2
   479 000004BD 66C1CD08                                ror     bp, 8
   480 000004C1 D3CD                                    ror     ebp, cl
   481                                  
   482                                  .without_crc@@:
   483 000004C3 E9A1000000                              jmp     .pre_lsf_done
   484                                  
   485                                  .pre_lsf_zero:
   486 000004C8 C705[94ED0000]0400-                     mov     dword [mp3_num_compress_bits], 4
   486 000004D0 0000               
   487 000004D2 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 9
   488 000004D4 C1E509                                  shl     ebp, 9
   489 000004D7 C1C009                                  rol     eax, 9
   490 000004DA 31E8                                    xor     eax, ebp
   491 000004DC 80ED09                                  sub     ch, 9
   492 000004DF 7913                                    jns     short .without_crc@@@
   493 000004E1 88E9                                    mov     cl, ch
   494 000004E3 80C510                                  add     ch, 10h
   495 000004E6 D3C5                                    rol     ebp, cl
   496 000004E8 668B2E                                  mov     bp, [esi]
   497 000004EB 83C602                                  add     esi, 2
   498 000004EE 66C1CD08                                ror     bp, 8
   499 000004F2 D3CD                                    ror     ebp, cl
   500                                  
   501                                  .without_crc@@@:
   502 000004F4 A3[90ED0000]                            mov     [mp3_main_data_begin], eax
   503 000004F9 8A0D[A6960000]                          mov     cl, byte [mp3_src_num_channels]
   504 000004FF D0E1                                    shl     cl, 1           ; 1,2 --> 2,4
   505 00000501 80F107                                  xor     cl, 7           ;     --> 5,3
   506 00000504 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits cl
   507 00000506 D3E5                                    shl     ebp, cl
   508 00000508 D3C0                                    rol     eax, cl
   509 0000050A 31E8                                    xor     eax, ebp
   510 0000050C 28CD                                    sub     ch, cl
   511 0000050E 7913                                    jns     short .without_crc@@@@
   512 00000510 88E9                                    mov     cl, ch
   513 00000512 80C510                                  add     ch, 10h
   514 00000515 D3C5                                    rol     ebp, cl
   515 00000517 668B2E                                  mov     bp, [esi]
   516 0000051A 83C602                                  add     esi, 2
   517 0000051D 66C1CD08                                ror     bp, 8
   518 00000521 D3CD                                    ror     ebp, cl
   519                                  
   520                                  .without_crc@@@@:
   521 00000523 8B15[A6960000]                          mov     edx, [mp3_src_num_channels]
   522 00000529 BB[9CED0000]                            mov     ebx, mp3_granules
   523                                  
   524                                  .pre_channel_lop:
   525 0000052E C7432800000000                          mov     dword [ebx+40], 0 ; [ebx+$mp3gr_scfsi]
   526 00000535 81C3A0090000                            add     ebx, 2464       ; $mp3gr_entrysiz
   527 0000053B 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 4
   528 0000053D C1E504                                  shl     ebp, 4
   529 00000540 C1C004                                  rol     eax, 4
   530 00000543 31E8                                    xor     eax, ebp
   531 00000545 80ED04                                  sub     ch, 4
   532 00000548 7913                                    jns     short .without_crc@@@@@
   533 0000054A 88E9                                    mov     cl, ch
   534 0000054C 80C510                                  add     ch, 10h
   535 0000054F D3C5                                    rol     ebp, cl
   536 00000551 668B2E                                  mov     bp, [esi]
   537 00000554 83C602                                  add     esi, 2
   538 00000557 66C1CD08                                ror     bp, 8
   539 0000055B D3CD                                    ror     ebp, cl
   540                                  
   541                                  .without_crc@@@@@:
   542 0000055D 894328                                  mov     [ebx+28h], eax  ; [ebx+$mp3gr_scfsi]
   543 00000560 81C3A0090000                            add     ebx, 2464       ; $mp3gr_entrysiz
   544 00000566 4A                                      dec     edx
   545 00000567 75C5                                    jnz     short .pre_channel_lop
   546                                  
   547                                  .pre_lsf_done:
   548 00000569 A1[98ED0000]                            mov     eax, [mp3_nb_granules]
   549 0000056E 6BC012                                  imul    eax, 12h
   550 00000571 A3[BE960000]                            mov     [mp3_nb_frames], eax
   551 00000576 A1[BE960000]                            mov     eax, [mp3_nb_frames]
   552 0000057B 0FAF05[AA960000]                        imul    eax, [mp3_output_num_channels]
   553 00000582 0FAF05[B2960000]                        imul    eax, [mp3_bytes_per_sample]
   554 00000589 C1E005                                  shl     eax, 5
   555 0000058C 8A0D[486F0000]                          mov     cl, [option_rate_shift]
   556 00000592 D3E8                                    shr     eax, cl
   557 00000594 A3[70ED0000]                            mov     [mp3_samples_output_size], eax
   558 00000599 F605[4C6F0000]10                        test    byte [cpuid_flags], 10h ; timelog_end rdtsc_read_header_extra
   559 000005A0 740E                                    jz      short .no_rdtsc_supported@
   560 000005A2 0F31                                    rdtsc
   561 000005A4 0105[746F0000]                          add     [rdtsc_read_header_extra], eax
   562 000005AA 1115[786F0000]                          adc     [rdtsc_read_header_extra+4], edx
   563                                  
   564                                  .no_rdtsc_supported@:
   565 000005B0 C3                                      retn
   566                                  
   567                                  
   568                                  ; =============== S U B R O U T I N E =======================================
   569                                  
   570                                  
   571                                  mp3_bitstream_read_granules:
   572 000005B1 F605[4C6F0000]10                        test    byte [cpuid_flags], 10h ; timelog_start rdtsc_read_granule
   573 000005B8 740E                                    jz      short .no_rdtsc_supported
   574 000005BA 0F31                                    rdtsc
   575 000005BC 2905[8C6F0000]                          sub     [rdtsc_read_granule], eax
   576 000005C2 1915[906F0000]                          sbb     [rdtsc_read_granule+4], edx
   577                                  
   578                                  .no_rdtsc_supported:
   579 000005C8 8925[90180500]                          mov	[_@@saved_sp], esp
   580 000005CE C705[94180500]0000-                     mov	dword [mp3_main_data_siz], 0
   580 000005D6 0000               
   581 000005D8 C705[7CED0000]0000-                     mov	dword [mp3_curr_granule], 0
   581 000005E0 0000               
   582 000005E2 BB[9CED0000]                            mov	ebx, mp3_granules
   583                                  
   584                                  .hdr_granule_lop:
   585 000005E7 53                                      push    ebx
   586 000005E8 C705[78ED0000]0000-                     mov     dword [mp3_curr_channel], 0
   586 000005F0 0000               
   587                                  
   588                                  .hdr_channel_lop:
   589 000005F2 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 12
   590 000005F4 C1E50C                                  shl     ebp, 12
   591 000005F7 C1C00C                                  rol     eax, 12
   592 000005FA 31E8                                    xor     eax, ebp
   593 000005FC 80ED0C                                  sub     ch, 12
   594 000005FF 7913                                    jns     short .without_crc
   595 00000601 88E9                                    mov     cl, ch
   596 00000603 80C510                                  add     ch, 16
   597 00000606 D3C5                                    rol     ebp, cl
   598 00000608 668B2E                                  mov     bp, [esi]
   599 0000060B 83C602                                  add     esi, 2
   600 0000060E 66C1CD08                                ror     bp, 8
   601 00000612 D3CD                                    ror     ebp, cl
   602                                  
   603                                  .without_crc:
   604 00000614 8B15[94180500]                          mov     edx, [mp3_main_data_siz]
   605 0000061A 8903                                    mov     [ebx], eax
   606 0000061C 895304                                  mov     [ebx+4], edx
   607 0000061F 01D0                                    add     eax, edx
   608 00000621 894308                                  mov     [ebx+8], eax
   609 00000624 A3[94180500]                            mov     [mp3_main_data_siz], eax
   610 00000629 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 9
   611 0000062B C1E509                                  shl     ebp, 9
   612 0000062E C1C009                                  rol     eax, 9
   613 00000631 31E8                                    xor     eax, ebp
   614 00000633 80ED09                                  sub     ch, 9
   615 00000636 7913                                    jns     short .without_crc@
   616 00000638 88E9                                    mov     cl, ch
   617 0000063A 80C510                                  add     ch, 10h
   618 0000063D D3C5                                    rol     ebp, cl
   619 0000063F 668B2E                                  mov     bp, [esi]
   620 00000642 83C602                                  add     esi, 2
   621 00000645 66C1CD08                                ror     bp, 8
   622 00000649 D3CD                                    ror     ebp, cl
   623                                  
   624                                  .without_crc@:
   625 0000064B 89430C                                  mov     [ebx+12], eax   ; [ebx+$mp3gr_big_values]
   626 0000064E 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 8
   627 00000650 C1E508                                  shl     ebp, 8
   628 00000653 C1C008                                  rol     eax, 8
   629 00000656 31E8                                    xor     eax, ebp
   630 00000658 80ED08                                  sub     ch, 8
   631 0000065B 7913                                    jns     short .without_crc@@
   632 0000065D 88E9                                    mov     cl, ch
   633 0000065F 80C510                                  add     ch, 10h
   634 00000662 D3C5                                    rol     ebp, cl
   635 00000664 668B2E                                  mov     bp, [esi]
   636 00000667 83C602                                  add     esi, 2
   637 0000066A 66C1CD08                                ror     bp, 8
   638 0000066E D3CD                                    ror     ebp, cl
   639                                  
   640                                  .without_crc@@:
   641 00000670 05BE000000                              add	eax, 190        ; 400-210
   642 00000675 833D[C2960000]01                        cmp	dword [mp3_hdr_mode_val], 1
   643 0000067C 750F                                    jnz	short .not_ms_stereo
   644 0000067E F705[C6960000]0200-                     test	dword [mp3_hdr_mode_ext], 2
   644 00000686 0000               
   645 00000688 7403                                    jz	short .not_ms_stereo
   646 0000068A 83E802                                  sub	eax, 2
   647                                  
   648                                  .not_ms_stereo:
   649 0000068D 894310                                  mov     [ebx+16], eax   ; [ebx+$mp3gr_global_gain]
   650 00000690 8A0D[94ED0000]                          mov     cl, byte [mp3_num_compress_bits]
   651 00000696 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits cl
   652 00000698 D3E5                                    shl     ebp, cl
   653 0000069A D3C0                                    rol     eax, cl
   654 0000069C 31E8                                    xor     eax, ebp
   655 0000069E 28CD                                    sub     ch, cl
   656 000006A0 7913                                    jns     short .without_crc@@@
   657 000006A2 88E9                                    mov     cl, ch
   658 000006A4 80C510                                  add     ch, 10h
   659 000006A7 D3C5                                    rol     ebp, cl
   660 000006A9 668B2E                                  mov     bp, [esi]
   661 000006AC 83C602                                  add     esi, 2
   662 000006AF 66C1CD08                                ror     bp, 8
   663 000006B3 D3CD                                    ror     ebp, cl
   664                                  
   665                                  .without_crc@@@:
   666 000006B5 894314                                  mov     [ebx+20], eax   ; [ebx+$mp3gr_scalefac_compress]
   667 000006B8 FECD                                    dec     ch              ; mp3mac_get_bit_to_cy
   668                                                                          ; dec mp3_colNN
   669 000006BA D1E5                                    shl     ebp, 1          ; shl mp3_col32,1 ; cy=data
   670 000006BC 0F834F010000                            jnb     .no_blocksplit
   671 000006C2 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 2
   672 000006C4 C1E502                                  shl     ebp, 2
   673 000006C7 C1C002                                  rol     eax, 2
   674 000006CA 31E8                                    xor     eax, ebp
   675 000006CC 80ED02                                  sub     ch, 2
   676 000006CF 7913                                    jns     short .without_crc@@@@
   677 000006D1 88E9                                    mov     cl, ch
   678 000006D3 80C510                                  add     ch, 10h
   679 000006D6 D3C5                                    rol     ebp, cl
   680 000006D8 668B2E                                  mov     bp, [esi]
   681 000006DB 83C602                                  add     esi, 2
   682 000006DE 66C1CD08                                ror     bp, 8
   683 000006E2 D3CD                                    ror     ebp, cl
   684                                  
   685                                  .without_crc@@@@:
   686 000006E4 83F800                                  cmp     eax, 0
   687 000006E7 0F847B030000                            jz      .error
   688 000006ED 89432C                                  mov     [ebx+44], eax   ; [ebx+$mp3gr_block_type]
   689 000006F0 83F802                                  cmp     eax, 2
   690 000006F3 B812000000                              mov     eax, 18         ; 36/2 ; region_size (default)
   691 000006F8 741C                                    jz      short .this_region_size
   692 000006FA 833D[9E960000]02                        cmp     dword [mp3_hdr_sample_rate_index], 2
   693 00000701 7613                                    jbe     short .this_region_size
   694 00000703 B81B000000                              mov     eax, 27         ; 54/2 ; region_size
   695 00000708 833D[9E960000]08                        cmp     dword [mp3_hdr_sample_rate_index], 8
   696 0000070F 7505                                    jnz     short .this_region_size
   697 00000711 B836000000                              mov     eax, 54         ; 108/2 ; region_size (for rate=8)
   698                                  
   699                                  .this_region_size:
   700 00000716 894350                                  mov     [ebx+80], eax   ; [ebx+$mp3gr_region_size+0*4]
   701 00000719 C7435420010000                          mov     dword [ebx+84], 288 ; [ebx+$mp3gr_region_size+1*4],576/2
   702 00000720 C7435820010000                          mov     dword [ebx+88], 288 ; [ebx+$mp3gr_region_size+2*4],576/2
   703 00000727 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 1
   704 00000729 D1E5                                    shl     ebp, 1
   705 0000072B D1C0                                    rol     eax, 1
   706 0000072D 31E8                                    xor     eax, ebp
   707 0000072F 80ED01                                  sub     ch, 1
   708 00000732 7913                                    jns     short .without_crc@@@@@
   709 00000734 88E9                                    mov     cl, ch
   710 00000736 80C510                                  add     ch, 10h
   711 00000739 D3C5                                    rol     ebp, cl
   712 0000073B 668B2E                                  mov     bp, [esi]
   713 0000073E 83C602                                  add     esi, 2
   714 00000741 66C1CD08                                ror     bp, 8
   715 00000745 D3CD                                    ror     ebp, cl
   716                                  
   717                                  .without_crc@@@@@:
   718 00000747 894330                                  mov     [ebx+48], eax   ; [ebx+$mp3gr_switch_point]
   719 0000074A 89E8                                    mov     eax, ebp        ; IRP nn,0,1 ; only 0..1 for blocksplit
   720 0000074C C1E505                                  shl     ebp, 5          ; mp3mac_get_n_bits 5
   721 0000074F C1C005                                  rol     eax, 5
   722 00000752 31E8                                    xor     eax, ebp
   723 00000754 80ED05                                  sub     ch, 5
   724 00000757 7913                                    jns     short .without_crc@@@@@@
   725 00000759 88E9                                    mov     cl, ch
   726 0000075B 80C510                                  add     ch, 10h
   727 0000075E D3C5                                    rol     ebp, cl
   728 00000760 668B2E                                  mov     bp, [esi]
   729 00000763 83C602                                  add     esi, 2
   730 00000766 66C1CD08                                ror     bp, 8
   731 0000076A D3CD                                    ror     ebp, cl
   732                                  
   733                                  .without_crc@@@@@@:
   734 0000076C 894338                                  mov     [ebx+56], eax   ; [ebx+$mp3gr_table_select+nn*4] ; nn=0
   735 0000076F 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 5
   736 00000771 C1E505                                  shl     ebp, 5
   737 00000774 C1C005                                  rol     eax, 5
   738 00000777 31E8                                    xor     eax, ebp
   739 00000779 80ED05                                  sub     ch, 5
   740 0000077C 7913                                    jns     short .without_crc_@@@@
   741 0000077E 88E9                                    mov     cl, ch
   742 00000780 80C510                                  add     ch, 10h
   743 00000783 D3C5                                    rol     ebp, cl
   744 00000785 668B2E                                  mov     bp, [esi]
   745 00000788 83C602                                  add     esi, 2
   746 0000078B 66C1CD08                                ror     bp, 8
   747 0000078F D3CD                                    ror     ebp, cl
   748                                  
   749                                  .without_crc_@@@@:
   750 00000791 89433C                                  mov     [ebx+60], eax   ; [ebx+$mp3gr_table_select+nn*4] ; nn=1
   751 00000794 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 5
   752 00000796 C1E503                                  shl     ebp, 3          ; IRP nn,0,1,2
   753 00000799 C1C003                                  rol     eax, 3          ; mp3mac_get_n_bits 3
   754 0000079C 31E8                                    xor     eax, ebp
   755 0000079E 80ED03                                  sub     ch, 3
   756 000007A1 7913                                    jns     short .without_crc_@@@@@
   757 000007A3 88E9                                    mov     cl, ch
   758 000007A5 80C510                                  add     ch, 10h
   759 000007A8 D3C5                                    rol     ebp, cl
   760 000007AA 668B2E                                  mov     bp, [esi]
   761 000007AD 83C602                                  add     esi, 2
   762 000007B0 66C1CD08                                ror     bp, 8
   763 000007B4 D3CD                                    ror     ebp, cl
   764                                  
   765                                  .without_crc_@@@@@:
   766 000007B6 C1E003                                  shl     eax, 3
   767 000007B9 894344                                  mov     [ebx+68], eax   ; [ebx+$mp3gr_subblock_gain+nn*4] ; nn=0
   768 000007BC 89E8                                    mov     eax, ebp
   769 000007BE C1E503                                  shl     ebp, 3
   770 000007C1 C1C003                                  rol     eax, 3
   771 000007C4 31E8                                    xor     eax, ebp
   772 000007C6 80ED03                                  sub     ch, 3
   773 000007C9 7913                                    jns     short .without_crc_@@@@@@
   774 000007CB 88E9                                    mov     cl, ch
   775 000007CD 80C510                                  add     ch, 10h
   776 000007D0 D3C5                                    rol     ebp, cl
   777 000007D2 668B2E                                  mov     bp, [esi]
   778 000007D5 83C602                                  add     esi, 2
   779 000007D8 66C1CD08                                ror     bp, 8
   780 000007DC D3CD                                    ror     ebp, cl
   781                                  
   782                                  .without_crc_@@@@@@:
   783 000007DE C1E003                                  shl     eax, 3
   784 000007E1 894348                                  mov     [ebx+72], eax   ; [ebx+$mp3gr_subblock_gain+nn*4] ; nn=1
   785 000007E4 89E8                                    mov     eax, ebp
   786 000007E6 C1E503                                  shl     ebp, 3
   787 000007E9 C1C003                                  rol     eax, 3
   788 000007EC 31E8                                    xor     eax, ebp
   789 000007EE 80ED03                                  sub     ch, 3
   790 000007F1 7913                                    jns     short .without_crc_@@@@@@@
   791 000007F3 88E9                                    mov     cl, ch
   792 000007F5 80C510                                  add     ch, 10h
   793 000007F8 D3C5                                    rol     ebp, cl
   794 000007FA 668B2E                                  mov     bp, [esi]
   795 000007FD 83C602                                  add     esi, 2
   796 00000800 66C1CD08                                ror     bp, 8
   797 00000804 D3CD                                    ror     ebp, cl
   798                                  
   799                                  .without_crc_@@@@@@@:
   800 00000806 C1E003                                  shl     eax, 3
   801 00000809 89434C                                  mov     [ebx+76], eax   ; [ebx+$mp3gr_subblock_gain+nn*4] ; nn=2
   802 0000080C E910010000                              jmp     .blocksplit_done
   803                                  
   804                                  .no_blocksplit:                       
   805 00000811 C7432C00000000                          mov     dword [ebx+44], 0 ; [ebx+$mp3gr_block_type]
   806 00000818 C7433000000000                          mov     dword [ebx+48], 0 ; [ebx+$mp3gr_switch_point]
   807 0000081F 89E8                                    mov     eax, ebp        ; IRP nn,0,1,2 ; range 0..2 when non-blocksplit
   808 00000821 C1E505                                  shl     ebp, 5          ; mp3mac_get_n_bits 5
   809 00000824 C1C005                                  rol     eax, 5
   810 00000827 31E8                                    xor     eax, ebp
   811 00000829 80ED05                                  sub     ch, 5
   812 0000082C 7913                                    jns     short .@_without_crc
   813 0000082E 88E9                                    mov     cl, ch
   814 00000830 80C510                                  add     ch, 10h
   815 00000833 D3C5                                    rol     ebp, cl
   816 00000835 668B2E                                  mov     bp, [esi]
   817 00000838 83C602                                  add     esi, 2
   818 0000083B 66C1CD08                                ror     bp, 8
   819 0000083F D3CD                                    ror     ebp, cl
   820                                  
   821                                  .@_without_crc:
   822 00000841 894338                                  mov     [ebx+56], eax   ; [ebx+$mp3gr_table_select+nn*4] ; nn=0
   823 00000844 89E8                                    mov     eax, ebp
   824 00000846 C1E505                                  shl     ebp, 5
   825 00000849 C1C005                                  rol     eax, 5
   826 0000084C 31E8                                    xor     eax, ebp
   827 0000084E 80ED05                                  sub     ch, 5
   828 00000851 7913                                    jns     short .@_without_crc_@
   829 00000853 88E9                                    mov     cl, ch
   830 00000855 80C510                                  add     ch, 10h
   831 00000858 D3C5                                    rol     ebp, cl
   832 0000085A 668B2E                                  mov     bp, [esi]
   833 0000085D 83C602                                  add     esi, 2
   834 00000860 66C1CD08                                ror     bp, 8
   835 00000864 D3CD                                    ror     ebp, cl
   836                                  
   837                                  .@_without_crc_@:
   838 00000866 89433C                                  mov     [ebx+60], eax   ; [ebx+$mp3gr_table_select+nn*4] ; nn=1
   839 00000869 89E8                                    mov     eax, ebp
   840 0000086B C1E505                                  shl     ebp, 5
   841 0000086E C1C005                                  rol     eax, 5
   842 00000871 31E8                                    xor     eax, ebp
   843 00000873 80ED05                                  sub     ch, 5
   844 00000876 7913                                    jns     short .@_without_crc_@@
   845 00000878 88E9                                    mov     cl, ch
   846 0000087A 80C510                                  add     ch, 10h
   847 0000087D D3C5                                    rol     ebp, cl
   848 0000087F 668B2E                                  mov     bp, [esi]
   849 00000882 83C602                                  add     esi, 2
   850 00000885 66C1CD08                                ror     bp, 8
   851 00000889 D3CD                                    ror     ebp, cl
   852                                  
   853                                  .@_without_crc_@@:
   854 0000088B 894340                                  mov     [ebx+64], eax   ; [ebx+$mp3gr_table_select+nn*4] ; nn=2
   855 0000088E 89E8                                    mov     eax, ebp
   856 00000890 C1E504                                  shl     ebp, 4
   857 00000893 C1C004                                  rol     eax, 4
   858 00000896 31E8                                    xor     eax, ebp
   859 00000898 80ED04                                  sub     ch, 4
   860 0000089B 7913                                    jns     short .@_without_crc@@@
   861 0000089D 88E9                                    mov     cl, ch
   862 0000089F 80C510                                  add     ch, 10h
   863 000008A2 D3C5                                    rol     ebp, cl
   864 000008A4 668B2E                                  mov     bp, [esi]
   865 000008A7 83C602                                  add     esi, 2
   866 000008AA 66C1CD08                                ror     bp, 8
   867 000008AE D3CD                                    ror     ebp, cl
   868                                  
   869                                  .@_without_crc@@@:
   870 000008B0 40                                      inc     eax
   871 000008B1 A3[88180500]                            mov     [_@@region_address0], eax
   872 000008B6 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 3
   873 000008B8 C1E503                                  shl     ebp, 3
   874 000008BB C1C003                                  rol     eax, 3
   875 000008BE 31E8                                    xor     eax, ebp
   876 000008C0 80ED03                                  sub     ch, 3
   877 000008C3 7913                                    jns     short .@_without_crc@@@@
   878 000008C5 88E9                                    mov     cl, ch
   879 000008C7 80C510                                  add     ch, 10h
   880 000008CA D3C5                                    rol     ebp, cl
   881 000008CC 668B2E                                  mov     bp, [esi]
   882 000008CF 83C602                                  add     esi, 2
   883 000008D2 66C1CD08                                ror     bp, 8
   884 000008D6 D3CD                                    ror     ebp, cl
   885                                  
   886                                  .@_without_crc@@@@:
   887 000008D8 40                                      inc     eax
   888 000008D9 0305[88180500]                          add     eax, [_@@region_address0]
   889 000008DF A3[8C180500]                            mov     [_@@region_address1], eax
   890 000008E4 A1[9E960000]                            mov     eax, [mp3_hdr_sample_rate_index]
   891 000008E9 C1E005                                  shl     eax, 5
   892 000008EC 0305[88180500]                          add     eax, [_@@region_address0]
   893 000008F2 0FB78400[9CD00100]                      movzx   eax, word [mp3_band_index_long+eax*2]
   894 000008FA D1E8                                    shr     eax, 1
   895 000008FC 894350                                  mov     [ebx+80], eax   ; [ebx+$mp3gr_region_size+0*4]
   896 000008FF A1[9E960000]                            mov     eax, [mp3_hdr_sample_rate_index]
   897 00000904 C1E005                                  shl     eax, 5
   898 00000907 0305[8C180500]                          add     eax, [_@@region_address1]
   899 0000090D 0FB78400[9CD00100]                      movzx   eax, word [mp3_band_index_long+eax*2]
   900 00000915 D1E8                                    shr     eax, 1
   901 00000917 894354                                  mov     [ebx+84], eax   ; [ebx+$mp3gr_region_size+1*4]
   902 0000091A C7435820010000                          mov     dword [ebx+88], 288 ; [ebx+$mp3gr_region_size+2*4],576/2
   903                                  
   904                                  .blocksplit_done:
   905 00000921 8D7B50                                  lea     edi, [ebx+80]   ; [ebx+$mp3gr_region_size+0]
   906 00000924 31D2                                    xor     edx, edx
   907 00000926 B103                                    mov     cl, 3
   908                                  
   909                                  .trunc_region_size_lop:
   910 00000928 8B07                                    mov     eax, [edi]
   911 0000092A 3B430C                                  cmp     eax, [ebx+12]   ; [ebx+$mp3gr_big_values]
   912 0000092D 7603                                    jbe     short .trunc_region_size_this
   913 0000092F 8B430C                                  mov     eax, [ebx+12]
   914                                  
   915                                  .trunc_region_size_this:
   916 00000932 29D0                                    sub     eax, edx
   917 00000934 8907                                    mov     [edi], eax
   918 00000936 01C2                                    add     edx, eax
   919 00000938 83C704                                  add     edi, 4
   920 0000093B FEC9                                    dec     cl
   921 0000093D 75E9                                    jnz     short .trunc_region_size_lop
   922 0000093F C7431C0D000000                          mov     dword [ebx+28], 13 ; [ebx+$mp3gr_short_start]
   923 00000946 C7432016000000                          mov     dword [ebx+32], 22 ; [ebx+$mp3gr_long_end]
   924 0000094D 837B2C02                                cmp     dword [ebx+44], 2 ; [ebx+$mp3gr_block_type]
   925 00000951 7549                                    jnz     short .these_band_indices
   926 00000953 C7431C00000000                          mov     dword [ebx+28], 0 ; [ebx+$mp3gr_short_start]
   927 0000095A C7432000000000                          mov     dword [ebx+32], 0 ; [ebx+$mp3gr_long_end]
   928 00000961 837B3000                                cmp     dword [ebx+48], 0 ; [ebx+$mp3gr_switch_point]
   929 00000965 7435                                    jz      short .these_band_indices
   930 00000967 C7431C02000000                          mov     dword [ebx+28], 2 ; [ebx+$mp3gr_short_start]
   931 0000096E C7432004000000                          mov     dword [ebx+32], 4 ; [ebx+$mp3gr_long_end]
   932 00000975 833D[9E960000]08                        cmp     dword [mp3_hdr_sample_rate_index], 8
   933 0000097C 741E                                    jz      short .these_band_indices
   934 0000097E 833D[9E960000]02                        cmp     dword [mp3_hdr_sample_rate_index], 2
   935 00000985 C7431C03000000                          mov     dword [ebx+28], 3 ; [ebx+$mp3gr_short_start]
   936 0000098C C7432008000000                          mov     dword [ebx+32], 8 ; [ebx+$mp3gr_long_end]
   937 00000993 7607                                    jbe     short .these_band_indices
   938 00000995 C7432006000000                          mov     dword [ebx+32], 6 ; [ebx+$mp3gr_long_end]
   939                                  
   940                                  .these_band_indices:
   941 0000099C 31C0                                    xor     eax, eax
   942 0000099E 833D[CA960000]00                        cmp     dword [mp3_hdr_flag_lsf], 0
   943 000009A5 7520                                    jnz     short .no_preflag
   944 000009A7 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 1
   945 000009A9 D1E5                                    shl     ebp, 1
   946 000009AB D1C0                                    rol     eax, 1
   947 000009AD 31E8                                    xor     eax, ebp
   948 000009AF 80ED01                                  sub     ch, 1
   949 000009B2 7913                                    jns     short .no_preflag
   950 000009B4 88E9                                    mov     cl, ch
   951 000009B6 80C510                                  add     ch, 10h
   952 000009B9 D3C5                                    rol     ebp, cl
   953 000009BB 668B2E                                  mov     bp, [esi]
   954 000009BE 83C602                                  add     esi, 2
   955 000009C1 66C1CD08                                ror     bp, 8
   956 000009C5 D3CD                                    ror     ebp, cl
   957                                  
   958                                  .no_preflag:
   959 000009C7 894318                                  mov     [ebx+24], eax   ; [ebx+$mp3gr_preflag]
   960 000009CA 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 1
   961 000009CC D1E5                                    shl     ebp, 1
   962 000009CE D1C0                                    rol     eax, 1
   963 000009D0 31E8                                    xor     eax, ebp
   964 000009D2 80ED01                                  sub     ch, 1
   965 000009D5 7913                                    jns     short .@_without_crc@@@@@
   966 000009D7 88E9                                    mov     cl, ch
   967 000009D9 80C510                                  add     ch, 10h
   968 000009DC D3C5                                    rol     ebp, cl
   969 000009DE 668B2E                                  mov     bp, [esi]
   970 000009E1 83C602                                  add     esi, 2
   971 000009E4 66C1CD08                                ror     bp, 8
   972 000009E8 D3CD                                    ror     ebp, cl
   973                                  
   974                                  .@_without_crc@@@@@:
   975 000009EA 40                                      inc     eax
   976 000009EB 894334                                  mov     [ebx+52], eax   ; [ebx+$mp3gr_scalefac_scale]
   977 000009EE 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 1
   978 000009F0 D1E5                                    shl     ebp, 1
   979 000009F2 D1C0                                    rol     eax, 1
   980 000009F4 31E8                                    xor     eax, ebp
   981 000009F6 80ED01                                  sub     ch, 1
   982 000009F9 7913                                    jns     short .@_without_crc@@@@@@
   983 000009FB 88E9                                    mov     cl, ch
   984 000009FD 80C510                                  add     ch, 10h
   985 00000A00 D3C5                                    rol     ebp, cl
   986 00000A02 668B2E                                  mov     bp, [esi]
   987 00000A05 83C602                                  add     esi, 2
   988 00000A08 66C1CD08                                ror     bp, 8
   989 00000A0C D3CD                                    ror     ebp, cl
   990                                  
   991                                  .@_without_crc@@@@@@: 
   992 00000A0E 83C010                                  add     eax, 10h        ; table 10h..11h (quad_vlc)
   993 00000A11 894324                                  mov     [ebx+36], eax   ; [ebx+$mp3gr_count1table_select]
   994 00000A14 81C340130000                            add     ebx, 4928       ; $mp3gr_entrysiz*2
   995 00000A1A FF05[78ED0000]                          inc     dword [mp3_curr_channel]
   996 00000A20 A1[78ED0000]                            mov     eax, [mp3_curr_channel]
   997 00000A25 3B05[A6960000]                          cmp     eax, [mp3_src_num_channels]
   998 00000A2B 0F82C1FBFFFF                            jb      .hdr_channel_lop
   999 00000A31 5B                                      pop     ebx
  1000 00000A32 81C3A0090000                            add     ebx, 2464       ; $mp3gr_entrysiz
  1001 00000A38 FF05[7CED0000]                          inc     dword [mp3_curr_granule]
  1002 00000A3E A1[7CED0000]                            mov     eax, [mp3_curr_granule]
  1003 00000A43 3B05[98ED0000]                          cmp     eax, [mp3_nb_granules]
  1004 00000A49 0F8298FBFFFF                            jb      .hdr_granule_lop
  1005 00000A4F F605[4C6F0000]10                        test    byte [cpuid_flags], 10h ; timelog_end rdtsc_read_granule
  1006 00000A56 740E                                    jz      short .no_rdtsc_supported@
  1007 00000A58 0F31                                    rdtsc
  1008 00000A5A 0105[8C6F0000]                          add     [rdtsc_read_granule], eax
  1009 00000A60 1115[906F0000]                          adc     [rdtsc_read_granule+4], edx
  1010                                  
  1011                                  .no_rdtsc_supported@:
  1012 00000A66 F8                                      clc
  1013 00000A67 C3                                      retn
  1014                                  
  1015                                  .error:
  1016 00000A68 F605[4C6F0000]10                        test    byte [cpuid_flags], 10h ; timelog_end rdtsc_read_granule
  1017 00000A6F 740E                                    jz      short .no_rdtsc_supported@@
  1018 00000A71 0F31                                    rdtsc
  1019 00000A73 0105[8C6F0000]                          add     [rdtsc_read_granule], eax
  1020 00000A79 1115[906F0000]                          adc     [rdtsc_read_granule+4], edx
  1021                                  
  1022                                  .no_rdtsc_supported@@:
  1023 00000A7F 8B25[90180500]                          mov     esp, [_@@saved_sp]
  1024 00000A85 F9                                      stc
  1025 00000A86 C3                                      retn
  1026                                  
  1027                                  
  1028                                  ; =============== S U B R O U T I N E =======================================
  1029                                  
  1030                                  
  1031                                  mp3_bitstream_append_to_main_data_pool:
  1032 00000A87 F605[4C6F0000]10                        test    byte [cpuid_flags], 10h ; timelog_start rdtsc_append_main
  1033 00000A8E 740E                                    jz      short .no_rdtsc_supported
  1034 00000A90 0F31                                    rdtsc
  1035 00000A92 2905[A46F0000]                          sub     [rdtsc_append_main], eax
  1036 00000A98 1915[A86F0000]                          sbb     [rdtsc_append_main+4], edx
  1037                                  
  1038                                  .no_rdtsc_supported:
  1039 00000A9E 8B0D[86960000]                          mov     ecx, [mp3_src_frame_end]
  1040 00000AA4 29F1                                    sub     ecx, esi
  1041 00000AA6 0F8266020000                            jb      fatalunexpected
  1042 00000AAC 8B3D[7A960000]                          mov     edi, [main_data_pool_wr_ptr]
  1043 00000AB2 8D040F                                  lea     eax, [edi+ecx]
  1044 00000AB5 3D[7A960000]                            cmp     eax, main_data_pool_wr_ptr
  1045 00000ABA 7616                                    jbe     short .pool_inrange
  1046 00000ABC 51                                      push    ecx
  1047 00000ABD 56                                      push    esi
  1048 00000ABE 8DB700FEFFFF                            lea     esi, [edi-200h]
  1049 00000AC4 BF[7A860000]                            mov     edi, main_data_pool_start
  1050 00000AC9 B980000000                              mov     ecx, 128
  1051 00000ACE F3A5                                    rep movsd
  1052 00000AD0 5E                                      pop     esi
  1053 00000AD1 59                                      pop     ecx
  1054                                  
  1055                                  .pool_inrange:
  1056 00000AD2 89F8                                    mov     eax, edi
  1057 00000AD4 2B05[90ED0000]                          sub     eax, [mp3_main_data_begin]
  1058 00000ADA F3A4                                    rep movsb
  1059 00000ADC 893D[7A960000]                          mov     [main_data_pool_wr_ptr], edi
  1060 00000AE2 3D[7A860000]                            cmp     eax, main_data_pool_start
  1061 00000AE7 7828                                    js      short .below_pool_start
  1062 00000AE9 A3[84ED0000]                            mov     [mp3_bitstream_start], eax
  1063                                                  ; 22/10/2024
  1064                                  		;mov    eax, 0
  1065 00000AEE 8B35[84ED0000]                          mov     esi, [mp3_bitstream_start] ; mp3mac_bitstream_set_position
  1066                                                  ;mov    cl, al
  1067                                                  ;shr    eax, 3
  1068                                                  ;and    cl, 7
  1069                                                  ;add    esi, eax
  1070 00000AF4 E8C7F6FFFF                              call    mp3_recollect_bits
  1071                                                  ;mov    eax, ebp        ; mp3mac_get_n_bits cl
  1072                                                  ;shl    ebp, cl
  1073                                                  ;rol    eax, cl
  1074                                                  ;xor    eax, ebp
  1075                                                  ;sub    ch, cl
  1076                                                  ;jns    short .cont
  1077                                                  ;mov    cl, ch          ; mp3mac_collect_more
  1078                                                  ;add    ch, 10h
  1079                                                  ;rol    ebp, cl
  1080                                                  ;mov    bp, [esi]
  1081                                                  ;add    esi, 2
  1082                                                  ;ror    bp, 8
  1083                                                  ;ror    ebp, cl
  1084                                  
  1085                                  .cont:
  1086 00000AF9 F605[4C6F0000]10                        test    byte [cpuid_flags], 10h ; timelog_end rdtsc_append_main
  1087 00000B00 740E                                    jz      short .no_rdtsc_supported@
  1088 00000B02 0F31                                    rdtsc
  1089 00000B04 0105[A46F0000]                          add     [rdtsc_append_main], eax
  1090 00000B0A 1115[A86F0000]                          adc     [rdtsc_append_main+4], edx
  1091                                  
  1092                                  .no_rdtsc_supported@:
  1093 00000B10 C3                                      retn
  1094                                  
  1095                                  .below_pool_start:
  1096 00000B11 C705[70ED0000]0000-                     mov     dword [mp3_samples_output_size], 0
  1096 00000B19 0000               
  1097 00000B1B EBDC                                    jmp     short .cont
  1098                                  
  1099                                  
  1100                                  ; =============== S U B R O U T I N E =======================================
  1101                                  
  1102                                  
  1103                                  mp3_bitstream_read_scalefacs:
  1104 00000B1D F605[4C6F0000]10                        test    byte [cpuid_flags], 10h ; timelog_start rdtsc_read_scalefac
  1105 00000B24 740E                                    jz      short .no_rdtsc_supported
  1106 00000B26 0F31                                    rdtsc
  1107 00000B28 2905[BC6F0000]                          sub     [rdtsc_read_scalefac], eax
  1108 00000B2E 1915[C06F0000]                          sbb     [rdtsc_read_scalefac+4], edx
  1109                                  
  1110                                  .no_rdtsc_supported:
  1111 00000B34 8D7B70                                  lea     edi, [ebx+112]  ; [ebx+$mp3gr_scale_factors]
  1112 00000B37 833D[CA960000]00                        cmp     dword [mp3_hdr_flag_lsf], 0
  1113 00000B3E 0F850D010000                            jnz     .body_lsf_nonzero
  1114 00000B44 8B4314                                  mov     eax, [ebx+20]   ; [ebx+$mp3gr_scalefac_compress]
  1115 00000B47 668B9400[9C730000]                      mov     dx, [mp3_slen_table+eax*2] ; slen[0,1]
  1116 00000B4F 837B2C02                                cmp     dword [ebx+44], 2 ; [ebx+$mp3gr_block_type]
  1117 00000B53 757F                                    jnz     short .body_lsf_zero_non_type2
  1118 00000B55 53                                      push    ebx
  1119 00000B56 B012                                    mov     al, 18
  1120 00000B58 2A4330                                  sub     al, [ebx+48]    ; [ebx+$mp3gr_switch_point]
  1121 00000B5B 88C3                                    mov     bl, al          ; @@get_bl_scalefacs_with_dl_bits 0
  1122 00000B5D 80FA00                                  cmp     dl, 0
  1123 00000B60 7428                                    jz      short .quickfill
  1124                                  
  1125                                  .scalefac_get_lop:
  1126 00000B62 88D1                                    mov     cl, dl          ; LSB of edx, slen[i]
  1127 00000B64 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits cl
  1128 00000B66 D3E5                                    shl     ebp, cl
  1129 00000B68 D3C0                                    rol     eax, cl
  1130 00000B6A 31E8                                    xor     eax, ebp
  1131 00000B6C 28CD                                    sub     ch, cl
  1132 00000B6E 7913                                    jns     short .cont@
  1133 00000B70 88E9                                    mov     cl, ch          ; mp3mac_collect_more
  1134 00000B72 80C510                                  add     ch, 10h
  1135 00000B75 D3C5                                    rol     ebp, cl
  1136 00000B77 668B2E                                  mov     bp, [esi]
  1137 00000B7A 83C602                                  add     esi, 2
  1138 00000B7D 66C1CD08                                ror     bp, 8
  1139 00000B81 D3CD                                    ror     ebp, cl
  1140                                  
  1141                                  .cont@:
  1142 00000B83 AA                                      stosb
  1143 00000B84 FECB                                    dec     bl
  1144 00000B86 75DA                                    jnz     short .scalefac_get_lop
  1145 00000B88 EB09                                    jmp     short .skip_quickfill
  1146                                  
  1147                                  .quickfill:
  1148 00000B8A 51                                      push    ecx
  1149 00000B8B 0FB6CB                                  movzx   ecx, bl
  1150 00000B8E B000                                    mov     al, 0           ; NO_INTENSITY_FLAG
  1151 00000B90 F3AA                                    rep stosb
  1152 00000B92 59                                      pop     ecx
  1153                                  
  1154                                  .skip_quickfill:
  1155 00000B93 C1EA08                                  shr     edx, 8
  1156 00000B96 B312                                    mov     bl, 18
  1157 00000B98 80FA00                                  cmp     dl, 0           ; @@get_bl_scalefacs_with_dl_bits 0
  1158 00000B9B 7428                                    jz      short .quickfill@
  1159                                  
  1160                                  .scalefac_get_lop@:
  1161 00000B9D 88D1                                    mov     cl, dl
  1162 00000B9F 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits cl
  1163 00000BA1 D3E5                                    shl     ebp, cl
  1164 00000BA3 D3C0                                    rol     eax, cl
  1165 00000BA5 31E8                                    xor     eax, ebp
  1166 00000BA7 28CD                                    sub     ch, cl
  1167 00000BA9 7913                                    jns     short .cont@@
  1168 00000BAB 88E9                                    mov     cl, ch          ; mp3mac_collect_more
  1169 00000BAD 80C510                                  add     ch, 10h
  1170 00000BB0 D3C5                                    rol     ebp, cl
  1171 00000BB2 668B2E                                  mov     bp, [esi]
  1172 00000BB5 83C602                                  add     esi, 2
  1173 00000BB8 66C1CD08                                ror     bp, 8
  1174 00000BBC D3CD                                    ror     ebp, cl
  1175                                  
  1176                                  .cont@@:
  1177 00000BBE AA                                      stosb
  1178 00000BBF FECB                                    dec     bl
  1179 00000BC1 75DA                                    jnz     short .scalefac_get_lop@
  1180 00000BC3 EB09                                    jmp     short .skip_quickfill@
  1181                                  
  1182                                  .quickfill@:
  1183 00000BC5 51                                      push    ecx
  1184 00000BC6 0FB6CB                                  movzx   ecx, bl
  1185 00000BC9 B000                                    mov     al, 0
  1186 00000BCB F3AA                                    rep stosb
  1187 00000BCD 59                                      pop     ecx
  1188                                  
  1189                                  .skip_quickfill@:
  1190 00000BCE 5B                                      pop     ebx
  1191 00000BCF E914010000                              jmp     .body_lsf_zeropad
  1192                                  
  1193                                  .body_lsf_zero_non_type2:
  1194 00000BD4 53                                      push    ebx
  1195 00000BD5 C1CA08                                  ror     edx, 8
  1196 00000BD8 88D6                                    mov     dh, dl          ; slen[0,1,2,3] = slen[0,0,1,1]
  1197 00000BDA C1C210                                  rol     edx, 16
  1198 00000BDD 88F2                                    mov     dl, dh
  1199 00000BDF 8A4328                                  mov     al, [ebx+40]    ; [ebx+$mp3gr_scfsi]
  1200 00000BE2 C0E004                                  shl     al, 4           ; move to upper 4bit
  1201 00000BE5 A2[98180500]                            mov     byte [_@@scfsi], al
  1202 00000BEA BB06050505                              mov     ebx, 5050506h   ; num[0..3]
  1203                                  
  1204                                  .body_lsf_zero_non_type2_lop:
  1205 00000BEF D025[98180500]                          shl     byte [_@@scfsi], 1
  1206 00000BF5 7238                                    jb      short .body_lsf_zero_non_type2_copy
  1207 00000BF7 80FA00                                  cmp     dl, 0           ; @@get_bl_scalefacs_with_dl_bits 0
  1208 00000BFA 7428                                    jz      short .quickfill@@
  1209                                  
  1210                                  .scalefac_get_lop@@:
  1211 00000BFC 88D1                                    mov     cl, dl
  1212 00000BFE 89E8                                    mov     eax, ebp
  1213 00000C00 D3E5                                    shl     ebp, cl
  1214 00000C02 D3C0                                    rol     eax, cl
  1215 00000C04 31E8                                    xor     eax, ebp
  1216 00000C06 28CD                                    sub     ch, cl
  1217 00000C08 7913                                    jns     short .cont@@@
  1218 00000C0A 88E9                                    mov     cl, ch
  1219 00000C0C 80C510                                  add     ch, 10h
  1220 00000C0F D3C5                                    rol     ebp, cl
  1221 00000C11 668B2E                                  mov     bp, [esi]
  1222 00000C14 83C602                                  add     esi, 2
  1223 00000C17 66C1CD08                                ror     bp, 8
  1224 00000C1B D3CD                                    ror     ebp, cl
  1225                                  
  1226                                  .cont@@@:
  1227 00000C1D AA                                      stosb
  1228 00000C1E FECB                                    dec     bl
  1229 00000C20 75DA                                    jnz     short .scalefac_get_lop@@
  1230 00000C22 EB09                                    jmp     short .skip_quickfill@@
  1231                                  
  1232                                  .quickfill@@:
  1233 00000C24 51                                      push    ecx
  1234 00000C25 0FB6CB                                  movzx   ecx, bl
  1235 00000C28 B000                                    mov     al, 0
  1236 00000C2A F3AA                                    rep stosb
  1237 00000C2C 59                                      pop     ecx
  1238                                  
  1239                                  .skip_quickfill@@:
  1240 00000C2D EB11                                    jmp     short .body_lsf_zero_non_type2_next
  1241                                  
  1242                                  .body_lsf_zero_non_type2_copy:
  1243 00000C2F 51                                      push    ecx
  1244 00000C30 89F0                                    mov     eax, esi
  1245 00000C32 0FB6CB                                  movzx   ecx, bl         ; copy
  1246 00000C35 8DB760F6FFFF                            lea     esi, [edi-2464] ; [edi-$mp3gr_entrysiz] ; src=granule[0] ; from
  1247 00000C3B F3A4                                    rep movsb               ; prev
  1248 00000C3D 89C6                                    mov     esi, eax
  1249 00000C3F 59                                      pop     ecx
  1250                                  
  1251                                  .body_lsf_zero_non_type2_next:
  1252 00000C40 C1EA08                                  shr     edx, 8          ; dl=next slen
  1253 00000C43 C1EB08                                  shr     ebx, 8          ; bl=next numfacs
  1254 00000C46 75A7                                    jnz     short .body_lsf_zero_non_type2_lop
  1255 00000C48 5B                                      pop     ebx
  1256 00000C49 B000                                    mov     al, 0
  1257 00000C4B AA                                      stosb
  1258 00000C4C E9A9000000                              jmp     .body_lsf_done
  1259                                  
  1260                                  .body_lsf_nonzero:
  1261 00000C51 8B5314                                  mov     edx, [ebx+14h]  ; [ebx+$mp3gr_scalefac_compress]
  1262 00000C54 F705[C6960000]0100-                     test    dword [mp3_hdr_mode_ext], 1 ; MODE_EXT_I_STEREO
  1262 00000C5C 0000               
  1263 00000C5E 740F                                    jz      short .normal_scalefac
  1264 00000C60 833D[78ED0000]00                        cmp     dword [mp3_curr_channel], 0
  1265 00000C67 7406                                    jz      short .normal_scalefac
  1266 00000C69 81C200020000                            add     edx, 512        ; for 2nd channel of intensity_stereo
  1267                                  
  1268                                  .normal_scalefac:
  1269 00000C6F 8A04D5[8DF80400]                        mov     al, [(mp3_lsf_sf_expand_exploded_table+5)+edx*8]
  1270 00000C76 084318                                  or      [ebx+24], al    ; [ebx+$mp3gr_preflag]
  1271 00000C79 53                                      push    ebx
  1272 00000C7A 0FB604D5[8CF80400]                      movzx   eax, byte [(mp3_lsf_sf_expand_exploded_table+4)+edx*8]
  1273 00000C82 837B2C02                                cmp     dword [ebx+44], 2 ;  [ebx+$mp3gr_block_type]
  1274 00000C86 7507                                    jnz     short .this_tindex1
  1275 00000C88 8B5B30                                  mov     ebx, [ebx+48]   ; [ebx+$mp3gr_switch_point]
  1276 00000C8B 8D449804                                lea     eax, [eax+ebx*4+4]
  1277                                  
  1278                                  .this_tindex1:
  1279 00000C8F 8B98[BC730000]                          mov     ebx, [mp3_lsf_nsf_table+eax]
  1280 00000C95 8B14D5[88F80400]                        mov     edx, dword [mp3_lsf_sf_expand_exploded_table+edx*8]
  1281                                  
  1282                                  .scalefax_outer_lop:
  1283 00000C9C 80FA00                                  cmp     dl, 0           ; @@get_bl_scalefacs_with_dl_bits 1
  1284 00000C9F 7435                                    jz      short .@quickfil
  1285                                  
  1286                                  .@scalefac_get_lop:
  1287 00000CA1 88D1                                    mov     cl, dl
  1288 00000CA3 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits cl
  1289 00000CA5 D3E5                                    shl     ebp, cl
  1290 00000CA7 D3C0                                    rol     eax, cl
  1291 00000CA9 31E8                                    xor     eax, ebp
  1292 00000CAB 28CD                                    sub     ch, cl
  1293 00000CAD 7913                                    jns     short .cont
  1294 00000CAF 88E9                                    mov     cl, ch
  1295 00000CB1 80C510                                  add     ch, 10h
  1296 00000CB4 D3C5                                    rol     ebp, cl
  1297 00000CB6 668B2E                                  mov     bp, [esi]
  1298 00000CB9 83C602                                  add     esi, 2
  1299 00000CBC 66C1CD08                                ror     bp, 8
  1300 00000CC0 D3CD                                    ror     ebp, cl
  1301                                  
  1302                                  .cont:
  1303 00000CC2 88D1                                    mov     cl, dl          ; numbits
  1304 00000CC4 88C4                                    mov     ah, al
  1305 00000CC6 FEC4                                    inc     ah              ; val+1
  1306 00000CC8 D2EC                                    shr     ah, cl          ; bit0=is.max.value
  1307 00000CCA C0E407                                  shl     ah, 7           ; bit7=is.max.value
  1308 00000CCD 08E0                                    or      al, ah          ; apply NO_INTENSITY_FLAG
  1309 00000CCF AA                                      stosb
  1310 00000CD0 FECB                                    dec     bl
  1311 00000CD2 75CD                                    jnz     short .@scalefac_get_lop
  1312 00000CD4 EB09                                    jmp     short .@skip_quickfill
  1313                                  
  1314                                  .@quickfil:
  1315 00000CD6 51                                      push    ecx
  1316 00000CD7 0FB6CB                                  movzx   ecx, bl
  1317 00000CDA B080                                    mov     al, 80h
  1318 00000CDC F3AA                                    rep stosb
  1319 00000CDE 59                                      pop     ecx
  1320                                  
  1321                                  .@skip_quickfill:
  1322 00000CDF C1EA08                                  shr     edx, 8
  1323 00000CE2 C1EB08                                  shr     ebx, 8
  1324 00000CE5 75B5                                    jnz     short .scalefax_outer_lop
  1325 00000CE7 5B                                      pop     ebx
  1326                                  
  1327                                  .body_lsf_zeropad:
  1328 00000CE8 89CA                                    mov     edx, ecx
  1329 00000CEA 8D8B98000000                            lea     ecx, [ebx+152]  ; [ebx+$mp3gr_scale_factors+40]
  1330 00000CF0 29F9                                    sub     ecx, edi
  1331                                                  ;jb     short fatal_scalefactors
  1332                                  		; 21/10/2024
  1333 00000CF2 721E                    		jb	short fatalunexpected
  1334 00000CF4 B000                                    mov     al, 0
  1335 00000CF6 F3AA                                    rep stosb
  1336 00000CF8 89D1                                    mov     ecx, edx
  1337                                  
  1338                                  .body_lsf_done:
  1339 00000CFA F605[4C6F0000]10                        test    byte [cpuid_flags], 10h ; timelog_end rdtsc_read_scalefac
  1340 00000D01 740E                                    jz      short .no_rdtsc_supported@@@
  1341 00000D03 0F31                                    rdtsc
  1342 00000D05 0105[BC6F0000]                          add     [rdtsc_read_scalefac], eax
  1343 00000D0B 1115[C06F0000]                          adc     [rdtsc_read_scalefac+4], edx
  1344                                  
  1345                                  .no_rdtsc_supported@@@:
  1346 00000D11 C3                                      retn
  1347                                  
  1348                                  		; 21/10/2024
  1349                                  ;fatal_scalefactors:
  1350                                                  ;jmp    fatalunexpected
  1351                                  
  1352                                  ; ---------------------------------------------------------------------------
  1353                                  
  1354                                  		; 21/10/2024
  1355                                  fatalunexpected:                       
  1356 00000D12 F735[287E0000]                          div	dword [zero]
  1357                                  hang:
  1358 00000D18 EBFE                                    jmp     short hang
  1359                                  
  1360                                  
  1361                                  ; =============== S U B R O U T I N E =======================================
  1362                                  
  1363                                  
  1364                                  mp3_get_exponents_from_scale_factors:
  1365 00000D1A F605[4C6F0000]10                        test    byte [cpuid_flags], 10h ; timelog_start rdtsc_xlat_scalefac
  1366 00000D21 740E                                    jz      short .no_rdtsc_supported
  1367 00000D23 0F31                                    rdtsc
  1368 00000D25 2905[D46F0000]                          sub     [rdtsc_xlat_scalefac], eax
  1369 00000D2B 1915[D86F0000]                          sbb     [rdtsc_xlat_scalefac+4], edx
  1370                                  
  1371                                  .no_rdtsc_supported:
  1372 00000D31 51                                      push    ecx             ; mp3mac_push_bitstream
  1373 00000D32 55                                      push    ebp
  1374 00000D33 56                                      push    esi
  1375 00000D34 C705[A8180500]0000-                     mov     dword [_@@rle_point], 0
  1375 00000D3C 0000               
  1376 00000D3E 8A4B34                                  mov     cl, [ebx+52]    ; [ebx+$mp3gr_scalefac_scale]
  1377 00000D41 BF[1C140100]                            mov     edi, mp3_exponents
  1378 00000D46 31D2                                    xor     edx, edx
  1379 00000D48 3B5320                                  cmp     edx, [ebx+32]   ; [ebx+$mp3gr_long_end]
  1380 00000D4B 7345                                    jnb     short .long_done
  1381 00000D4D A1[9E960000]                            mov     eax, [mp3_hdr_sample_rate_index]
  1382 00000D52 6BC016                                  imul    eax, 22
  1383 00000D55 8DA8[CC790000]                          lea     ebp, [mp3_band_size_long+eax]
  1384 00000D5B 8B4318                                  mov     eax, [ebx+24]   ; [ebx+$mp3gr_preflag]
  1385 00000D5E 6BC016                                  imul    eax, 22
  1386 00000D61 8DB0[1C7B0000]                          lea     esi, [mp3_pretab+eax]
  1387                                  
  1388                                  .long_lop:
  1389 00000D67 0FB6441370                              movzx   eax, byte [ebx+edx+112] ; [ebx+$mp3gr_scale_factors+edx]
  1390 00000D6C 247F                                    and     al, 7Fh         ; strip NO_INTENSITY_FLAG
  1391 00000D6E 020416                                  add     al, [esi+edx]
  1392 00000D71 D3E0                                    shl     eax, cl
  1393 00000D73 F7D8                                    neg     eax
  1394 00000D75 034310                                  add     eax, [ebx+16]   ; [ebx+$mp3gr_global_gain]
  1395 00000D78 C1E010                                  shl     eax, 16
  1396 00000D7B 8A441500                                mov     al, [ebp+edx+0]
  1397 00000D7F 0305[A8180500]                          add     eax, [_@@rle_point]
  1398 00000D85 66A3[A8180500]                          mov     word [_@@rle_point], ax
  1399 00000D8B AB                                      stosd
  1400 00000D8C 42                                      inc     edx
  1401 00000D8D 3B5320                                  cmp     edx, [ebx+32]   ; [ebx+$mp3gr_long_end]
  1402 00000D90 72D5                                    jb      short .long_lop
  1403                                  
  1404                                  .long_done:
  1405 00000D92 8B531C                                  mov     edx, [ebx+28]   ; [ebx+$mp3gr_short_start]
  1406 00000D95 83FA0D                                  cmp     edx, 13
  1407 00000D98 0F83AA000000                            jnb     .skip_shorts
  1408 00000D9E A1[9E960000]                            mov     eax, [mp3_hdr_sample_rate_index]
  1409 00000DA3 6BC00D                                  imul    eax, 13
  1410 00000DA6 8DA8[9C7A0000]                          lea     ebp, [mp3_band_size_short+eax]
  1411 00000DAC 8B7320                                  mov     esi, [ebx+32]   ; [ebx+$mp3gr_long_end]
  1412 00000DAF 8B4310                                  mov     eax, [ebx+16]   ; [ebx+$mp3gr_global_gain]
  1413                                                                          ; IRP nn,0,1,2
  1414 00000DB2 2B4344                                  sub     eax, [ebx+68]   ; [ebx+$mp3gr_subblock_gain+nn*4]
  1415 00000DB5 A3[9C180500]                            mov     [_@@gains], eax ; [@@gains+nn*4]
  1416 00000DBA 8B4310                                  mov     eax, [ebx+16]
  1417 00000DBD 2B4348                                  sub     eax, [ebx+72]
  1418 00000DC0 A3[A0180500]                            mov     [_@@gains+4], eax ; [@@gains+nn*4]
  1419 00000DC5 8B4310                                  mov     eax, [ebx+16]
  1420 00000DC8 2B434C                                  sub     eax, [ebx+76]   ; [ebx+$mp3gr_subblock_gain+nn*4]
  1421 00000DCB A3[A4180500]                            mov     [_@@gains+8], eax ; [@@gains+nn*4]
  1422                                  
  1423                                  .short_lop:
  1424 00000DD0 0FB6443370                              movzx   eax, byte [ebx+esi+112] ; [ebx+$mp3gr_scale_factors+esi]
  1425                                                                          ; IRP nn,0,1,2
  1426 00000DD5 247F                                    and     al, 7Fh         ; strip NO_INTENSITY_FLAG
  1427 00000DD7 46                                      inc     esi
  1428 00000DD8 D3E0                                    shl     eax, cl
  1429 00000DDA F7D8                                    neg     eax
  1430 00000DDC 0305[9C180500]                          add     eax, [_@@gains] ; [@@gains+nn*4] ; nn=0
  1431 00000DE2 C1E010                                  shl     eax, 16
  1432 00000DE5 8A441500                                mov     al, [ebp+edx+0] ; bstab[edx]
  1433 00000DE9 0305[A8180500]                          add     eax, [_@@rle_point]
  1434 00000DEF 66A3[A8180500]                          mov     word [_@@rle_point], ax
  1435 00000DF5 AB                                      stosd                   ; msw=val, lsw=point
  1436 00000DF6 0FB6443370                              movzx   eax, byte [ebx+esi+112] ; [ebx+$mp3gr_scalefac_scale]
  1437 00000DFB 247F                                    and     al, 7Fh
  1438 00000DFD 46                                      inc     esi
  1439 00000DFE D3E0                                    shl     eax, cl
  1440 00000E00 F7D8                                    neg     eax
  1441 00000E02 0305[A0180500]                          add     eax, [_@@gains+4] ; [@@gains+nn*4] ; nn = 1
  1442 00000E08 C1E010                                  shl     eax, 16
  1443 00000E0B 8A441500                                mov     al, [ebp+edx+0]
  1444 00000E0F 0305[A8180500]                          add     eax, [_@@rle_point]
  1445 00000E15 66A3[A8180500]                          mov     word [_@@rle_point], ax
  1446 00000E1B AB                                      stosd
  1447 00000E1C 0FB6443370                              movzx   eax, byte [ebx+esi+70h]
  1448 00000E21 247F                                    and     al, 7Fh
  1449 00000E23 46                                      inc     esi
  1450 00000E24 D3E0                                    shl     eax, cl
  1451 00000E26 F7D8                                    neg     eax
  1452 00000E28 0305[A4180500]                          add     eax, [_@@gains+8] ; [@@gains+nn*4] ; nn=2
  1453 00000E2E C1E010                                  shl     eax, 10h
  1454 00000E31 8A441500                                mov     al, [ebp+edx+0]
  1455 00000E35 0305[A8180500]                          add     eax, [_@@rle_point]
  1456 00000E3B 66A3[A8180500]                          mov     word [_@@rle_point], ax
  1457 00000E41 AB                                      stosd
  1458 00000E42 42                                      inc     edx
  1459 00000E43 83FA0D                                  cmp     edx, 13
  1460 00000E46 7288                                    jb      short .short_lop
  1461                                  
  1462                                  .skip_shorts:
  1463 00000E48 5E                                      pop     esi             ; mp3mac_pop_bitstream
  1464 00000E49 5D                                      pop     ebp
  1465 00000E4A 59                                      pop     ecx
  1466 00000E4B F605[4C6F0000]10                        test    byte [cpuid_flags], 10h ; timelog_end rdtsc_xlat_scalefac
  1467 00000E52 740E                                    jz      short .no_rdtsc_supported@
  1468 00000E54 0F31                                    rdtsc
  1469 00000E56 0105[D46F0000]                          add     [rdtsc_xlat_scalefac], eax
  1470 00000E5C 1115[D86F0000]                          adc     [rdtsc_xlat_scalefac+4], edx
  1471                                  
  1472                                  .no_rdtsc_supported@:
  1473 00000E62 C3                                      retn
  1474                                  
  1475                                  
  1476                                  ; =============== S U B R O U T I N E =======================================
  1477                                  
  1478                                  
  1479                                  mp3_huffman_decode:
  1480 00000E63 F605[4C6F0000]10                        test    byte [cpuid_flags], 10h ; in: ebx=granule, out: [sb_hybrid..]
  1481                                                                          ; timelog_start rdtsc_read_huffman
  1482 00000E6A 740E                                    jz      short .no_rdtsc_supported
  1483 00000E6C 0F31                                    rdtsc
  1484 00000E6E 2905[EC6F0000]                          sub     [rdtsc_read_huffman], eax
  1485 00000E74 1915[F06F0000]                          sbb     [rdtsc_read_huffman+4], edx
  1486                                  
  1487                                  .no_rdtsc_supported:
  1488 00000E7A 8B4308                                  mov	eax, [ebx+8]    ; [ebx+$mp3gr_part2_3_end]
  1489 00000E7D C1E803                                  shr	eax, 3
  1490 00000E80 0305[84ED0000]                          add	eax, [mp3_bitstream_start]
  1491 00000E86 A3[BC180500]                            mov	[_@@coarse_end], eax
  1492 00000E8B 31FF                                    xor	edi, edi
  1493 00000E8D C705[C4180500]-                         mov	dword [_@@rle_ptr], mp3_exponents
  1493 00000E93 [1C140100]         
  1494 00000E97 C705[C0180500]0000-                     mov	dword [_@rle_point], 0
  1494 00000E9F 0000               
  1495 00000EA1 C705[AC180500]0000-                     mov	dword [_@@III], 0  ; i=0
  1495 00000EA9 0000               
  1496                                  
  1497                                  .low_freq_lop_i:
  1498 00000EAB 8B15[AC180500]                          mov     edx, [_@@III] ; for i=0 to 2
  1499                                                                          ; low frequencies (called big_values)...
  1500 00000EB1 8B449350                                mov     eax, [ebx+edx*4+80] ; [ebx+$mp3gr_region_size+edx*4]
  1501 00000EB5 83F800                                  cmp     eax, 0
  1502 00000EB8 0F84D9020000                            jz      .low_freq_next_i
  1503 00000EBE A3[B0180500]                            mov     [_@@JJJ], eax
  1504 00000EC3 8B549338                                mov     edx, [ebx+edx*4+56] ; [ebx+$mp3gr_table_select+edx*4]
  1505                                                                          ; select vlc table
  1506 00000EC7 0FB68412[8C790000]                      movzx   eax, byte [mp3_huff_data+edx*2] ; get huff.table number
  1507 00000ECF 83F800                                  cmp     eax, 0          ; huff.table
  1508 00000ED2 7528                                    jnz     short .low_freq_nonzero
  1509 00000ED4 51                                      push    ecx
  1510 00000ED5 57                                      push    edi
  1511 00000ED6 8DBCBBA0000000                          lea     edi, [ebx+edi*4+160] ; [ebx+$mp3gr_sb_hybrid+edi*4]
  1512 00000EDD 8B0D[B0180500]                          mov     ecx, [_@@JJJ]
  1513 00000EE3 D1E1                                    shl     ecx, 1
  1514 00000EE5 31C0                                    xor     eax, eax        ; when huff.table=0,
  1515                                                                          ; simply set NUM*2 entries to zero
  1516 00000EE7 F3AB                                    rep stosd
  1517 00000EE9 5F                                      pop     edi
  1518 00000EEA 59                                      pop     ecx
  1519 00000EEB 033D[B0180500]                          add     edi, [_@@JJJ] ; raise index accordingly (by num*2)
  1520 00000EF1 033D[B0180500]                          add     edi, [_@@JJJ]
  1521 00000EF7 E99B020000                              jmp     .low_freq_next_i
  1522                                  
  1523                                  .low_freq_nonzero:
  1524 00000EFC A3[B8180500]                            mov     [_@@vlc_table], eax ; =1..15
  1525 00000F01 83F80E                                  cmp     eax, 14         ; only table 14..15 have linbits
  1526 00000F04 0F83FA000000                            jnb     .with_linbits  ; so table 0..13 can use faster code...
  1527                                  
  1528                                  .low_freq_lop_j_small:
  1529 00000F0A 3B35[BC180500]                          cmp     esi, [_@@coarse_end] ; loop @@JJJ times..
  1530 00000F10 0F87CF000000                            ja      .small_near_end
  1531                                  
  1532                                  .small_not_end:
  1533 00000F16 3B3D[C0180500]                          cmp     edi, [_@rle_point] ; @@get_runlength small
  1534 00000F1C 0F839E030000                            jnb     .rle_fetch_next_small
  1535                                  
  1536                                  .rle_back_small:
  1537 00000F22 8B15[B8180500]                          mov     edx, [_@@vlc_table] ; get huffcode
  1538                                  
  1539                                  .get_child_lop:
  1540 00000F28 8A0C95[9E180100]                        mov     cl, [(huff_tree_buf+2)+edx*4] ; mp3mac_get_huffcode
  1541                                                                          ; in: edx=table, out: eax=data
  1542                                                                          ; bits (table size) (-7..-1)
  1543 00000F2F 668B1495[9C180100]                      mov     dx, word [huff_tree_buf+edx*4] ; code (child table)
  1544 00000F37 89E8                                    mov     eax, ebp        ; mov eax,mp3_col32 ; peek bitstream
  1545 00000F39 D3E8                                    shr     eax, cl
  1546 00000F3B 01C2                                    add     edx, eax
  1547 00000F3D 8A0C95[9E180100]                        mov     cl, [(huff_tree_buf+2)+edx*4] ; bits (of entry)
  1548 00000F44 80F900                                  cmp     cl, 0
  1549 00000F47 7823                                    js      short .got_child
  1550 00000F49 0FB70495[9C180100]                      movzx   eax, word [huff_tree_buf+edx*4] ; return data value
  1551 00000F51 D3E5                                    shl     ebp, cl         ; shl mp3_col32,cl ; discard cl bits
  1552 00000F53 28CD                                    sub     ch, cl          ; sub mp3_colNN,cl
  1553 00000F55 7932                                    jns     short .got_done
  1554 00000F57 88E9                                    mov     cl, ch          ; mp3mac_collect_more
  1555                                                                          ; mov cl,mp3_colNN ; byte ptr [mp3_numbits_collected]
  1556 00000F59 80C510                                  add     ch, 16          ; byte ptr [mp3_numbits_collected]
  1557 00000F5C D3C5                                    rol     ebp, cl         ; dword ptr [mp3_collected_data]
  1558 00000F5E 668B2E                                  mov     bp, [esi]
  1559 00000F61 83C602                                  add     esi, 2
  1560 00000F64 66C1CD08                                ror     bp, 8           ; ror mp3_col16,8 ; endianess
  1561 00000F68 D3CD                                    ror     ebp, cl         ; ror mp3_col32,cl ; dword ptr [mp3_collected_data]
  1562 00000F6A EB1D                                    jmp     short .got_done
  1563                                  
  1564                                  .got_child:
  1565 00000F6C C1E509                                  shl     ebp, 9          ; shl mp3_col32,CHILD_BITS
  1566                                                                          ; discard 7 bits
  1567                                                                          ; (assuming that parents are always 7bit wide)
  1568 00000F6F 80ED09                                  sub     ch, 9
  1569 00000F72 79B4                                    jns     short .get_child_lop
  1570 00000F74 88E9                                    mov     cl, ch          ; mp3mac_collect_more
  1571 00000F76 80C510                                  add     ch, 10h
  1572 00000F79 D3C5                                    rol     ebp, cl
  1573 00000F7B 668B2E                                  mov     bp, [esi]
  1574 00000F7E 83C602                                  add     esi, 2
  1575 00000F81 66C1CD08                                ror     bp, 8
  1576 00000F85 D3CD                                    ror     ebp, cl
  1577 00000F87 EB9F                                    jmp     short .get_child_lop
  1578                                  
  1579                                  .got_done:
  1580 00000F89 50                                      push    eax
  1581 00000F8A C1E804                                  shr     eax, 4          ; x
  1582 00000F8D 7417                                    jz      short .this_sign ; @@getexpval 0 ; @@getexpval macro has_linbits
  1583                                                                          ; eax=0 (without sign) ; when x=0
  1584 00000F8F 8B15[CC180500]                          mov     edx, [_@@rle_val_x_40h]
  1585 00000F95 8B8482[085C0400]                        mov     eax, [mp3_expval_table+edx+eax*4]
  1586 00000F9C FECD                                    dec     ch              ; mp3mac_get_bit_to_cy
  1587                                                                          ; ;jnc short @@this_sign
  1588                                                                          ; ;neg  eax
  1589 00000F9E D1E5                                    shl     ebp, 1          ; dec mp3_colNN ; shl mp3_col32,1 ; cy=data
  1590 00000FA0 19D2                                    sbb     edx, edx        ; cy=0,1 --> 0,FFFFFFFF
  1591 00000FA2 31D0                                    xor     eax, edx        ; invert if cy was 1 ; get sign (negate if sign=1)
  1592 00000FA4 29D0                                    sub     eax, edx        ; add 1 if cy was 1
  1593                                  
  1594                                  .this_sign:
  1595 00000FA6 8984BBA0000000                          mov     [ebx+edi*4+160], eax ; [ebx+$mp3gr_sb_hybrid+edi*4+0]
  1596 00000FAD 58                                      pop     eax
  1597 00000FAE 83E00F                                  and     eax, 0Fh        ; y
  1598 00000FB1 7417                                    jz      short .this_sign@ ; @@getexpval 0
  1599 00000FB3 8B15[CC180500]                          mov     edx, [_@@rle_val_x_40h]
  1600 00000FB9 8B8482[085C0400]                        mov     eax, [mp3_expval_table+edx+eax*4]
  1601 00000FC0 FECD                                    dec     ch
  1602 00000FC2 D1E5                                    shl     ebp, 1
  1603 00000FC4 19D2                                    sbb     edx, edx
  1604 00000FC6 31D0                                    xor     eax, edx
  1605 00000FC8 29D0                                    sub     eax, edx
  1606                                  
  1607                                  .this_sign@:
  1608 00000FCA 8984BBA4000000                          mov     [ebx+edi*4+164], eax ; [ebx+$mp3gr_sb_hybrid+edi*4+4]
  1609 00000FD1 83C702                                  add     edi, 2
  1610 00000FD4 FF0D[B0180500]                          dec     dword [_@@JJJ]
  1611 00000FDA 0F852AFFFFFF                            jnz     .low_freq_lop_j_small
  1612 00000FE0 E9B2010000                              jmp     .low_freq_next_i
  1613                                  
  1614                                  .small_near_end:
  1615 00000FE5 89F0                                    mov     eax, esi        ; mp3mac_bitstream_get_position
  1616 00000FE7 2B05[84ED0000]                          sub     eax, [mp3_bitstream_start]
  1617 00000FED 0FBED5                                  movsx   edx, ch         ; mp3_colNN
  1618 00000FF0 F7DA                                    neg     edx
  1619 00000FF2 8D44C2F0                                lea     eax, [edx+eax*8-16]
  1620 00000FF6 3B4308                                  cmp     eax, [ebx+8]    ; [ebx+$mp3gr_part2_3_end]
  1621 00000FF9 0F8217FFFFFF                            jb      .small_not_end
  1622 00000FFF E993010000                              jmp     .low_freq_next_i
  1623                                  
  1624                                  .with_linbits:
  1625 00001004 0FB68412[8D790000]                      movzx   eax, byte [(mp3_huff_data+1)+edx*2]
  1626 0000100C A3[B4180500]                            mov     [_@@linbits], eax
  1627                                  
  1628                                  .low_freq_lop_j:
  1629 00001011 3B35[BC180500]                          cmp     esi, [_@@coarse_end] ; mp3mac_bitstream_get_position
  1630                                                                          ; loop @@JJJ times...
  1631 00001017 0F8725030000                            ja      .lop_j_near_end
  1632                                  
  1633                                  .small_not_end@:
  1634 0000101D 3B3D[C0180500]                          cmp     edi, [_@rle_point] ; @@get_runlength small
  1635 00001023 0F83C5020000                            jnb     .rle_fetch_next_full
  1636                                  
  1637                                  .rle_back_full:
  1638 00001029 8B15[B8180500]                          mov     edx, [_@@vlc_table] ; get huffcode
  1639                                  
  1640                                  .get_child_lop@:
  1641 0000102F 8A0C95[9E180100]                        mov     cl, [(huff_tree_buf+2)+edx*4] ; mp3mac_get_huffcode
  1642                                                                          ; in: edx=table, out: eax=data
  1643                                                                          ; bits (table size) (-7..-1)
  1644 00001036 668B1495[9C180100]                      mov     dx, word [huff_tree_buf+edx*4] ; code (child table)
  1645 0000103E 89E8                                    mov     eax, ebp
  1646 00001040 D3E8                                    shr     eax, cl
  1647 00001042 01C2                                    add     edx, eax
  1648 00001044 8A0C95[9E180100]                        mov     cl, [(huff_tree_buf+2)+edx*4] ; bits (of entry)
  1649 0000104B 80F900                                  cmp     cl, 0
  1650 0000104E 7823                                    js      short .got_child@
  1651 00001050 0FB70495[9C180100]                      movzx   eax, word [huff_tree_buf+edx*4] ; return data value
  1652 00001058 D3E5                                    shl     ebp, cl         ; discard cl bits
  1653 0000105A 28CD                                    sub     ch, cl
  1654 0000105C 7932                                    jns     short .got_done@
  1655 0000105E 88E9                                    mov     cl, ch          ; mp3mac_collect_more
  1656 00001060 80C510                                  add     ch, 10h
  1657 00001063 D3C5                                    rol     ebp, cl
  1658 00001065 668B2E                                  mov     bp, [esi]
  1659 00001068 83C602                                  add     esi, 2
  1660 0000106B 66C1CD08                                ror     bp, 8
  1661 0000106F D3CD                                    ror     ebp, cl
  1662 00001071 EB1D                                    jmp     short .got_done@
  1663                                  
  1664                                  .got_child@:
  1665 00001073 C1E509                                  shl     ebp, 9
  1666 00001076 80ED09                                  sub     ch, 9
  1667 00001079 79B4                                    jns     short .get_child_lop@
  1668 0000107B 88E9                                    mov     cl, ch
  1669 0000107D 80C510                                  add     ch, 10h
  1670 00001080 D3C5                                    rol     ebp, cl
  1671 00001082 668B2E                                  mov     bp, [esi]
  1672 00001085 83C602                                  add     esi, 2
  1673 00001088 66C1CD08                                ror     bp, 8
  1674 0000108C D3CD                                    ror     ebp, cl
  1675 0000108E EB9F                                    jmp     short .get_child_lop@
  1676                                  
  1677                                  .got_done@:
  1678 00001090 50                                      push    eax
  1679 00001091 C1E804                                  shr     eax, 4          ; x
  1680 00001094 746F                                    jz      short .@this_sign ; @@getexpval 1
  1681 00001096 8B15[C8180500]                          mov     edx, [_@@rle_val]
  1682 0000109C 83F80F                                  cmp     eax, 15
  1683 0000109F 7250                                    jb      short .small    ; when x=1..14
  1684 000010A1 8A0D[B4180500]                          mov     cl, byte [_@@linbits] ; =0..13 ; when x=15, with linbits
  1685 000010A7 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits cl ; value = 0..1FFFh
  1686 000010A9 D3E5                                    shl     ebp, cl         ; mp3mac_collect_more
  1687 000010AB D3C0                                    rol     eax, cl
  1688 000010AD 31E8                                    xor     eax, ebp
  1689 000010AF 28CD                                    sub     ch, cl
  1690 000010B1 7913                                    jns     short .cont
  1691 000010B3 88E9                                    mov     cl, ch          ; mp3mac_collect_more
  1692 000010B5 80C510                                  add     ch, 16
  1693 000010B8 D3C5                                    rol     ebp, cl
  1694 000010BA 668B2E                                  mov     bp, [esi]
  1695 000010BD 83C602                                  add     esi, 2
  1696 000010C0 66C1CD08                                ror     bp, 8
  1697 000010C4 D3CD                                    ror     ebp, cl
  1698                                  
  1699                                  .cont:
  1700 000010C6 88D1                                    mov     cl, dl          ; exponent.lsb
  1701 000010C8 80E103                                  and     cl, 3           ; exponent.lsb
  1702 000010CB C1EA02                                  shr     edx, 2          ; exponent.msb
  1703 000010CE 8D04853C000000                          lea     eax, [eax*4+60] ; (value+15)*4
  1704 000010D5 08C8                                    or      al, cl          ; exponent.lsb+(value+15)*4
  1705 000010D7 8A88[DCD20100]                          mov     cl, [mp3_table_4_3_exp+eax]
  1706 000010DD 8B0485[18530200]                        mov     eax, [mp3_table_4_3_value+eax*4]
  1707 000010E4 28D1                                    sub     cl, dl          ; sub exponent.msb
  1708 000010E6 D3E8                                    shr     eax, cl
  1709 000010E8 80F91F                                  cmp     cl, 31
  1710 000010EB 760E                                    jbe     short .get_sign
  1711 000010ED 31C0                                    xor     eax, eax
  1712 000010EF EB0A                                    jmp     short .get_sign
  1713                                  
  1714                                  .small:
  1715 000010F1 C1E206                                  shl     edx, 6          ; shl edx,4+2 ; mul16*4 ; when x<15 aka x=1..14
  1716 000010F4 8B8482[085C0400]                        mov     eax, [mp3_expval_table+edx+eax*4]
  1717                                  
  1718                                  .get_sign:
  1719 000010FB FECD                                    dec     ch              ; mp3mac_get_bit_to_cy
  1720 000010FD D1E5                                    shl     ebp, 1
  1721 000010FF 19D2                                    sbb     edx, edx        ; get sign (negate if sign=1)
  1722 00001101 31D0                                    xor     eax, edx
  1723 00001103 29D0                                    sub     eax, edx
  1724                                  
  1725                                  .@this_sign:
  1726 00001105 8984BBA0000000                          mov     [ebx+edi*4+160], eax ; [ebx+$mp3gr_sb_hybrid+edi*4+0]
  1727 0000110C 58                                      pop     eax
  1728 0000110D 83E00F                                  and     eax, 0Fh        ; y
  1729 00001110 746F                                    jz      short .@this_sign@ ; @@getexpval 1
  1730 00001112 8B15[C8180500]                          mov     edx, [_@@rle_val]
  1731 00001118 83F80F                                  cmp     eax, 0Fh
  1732 0000111B 7250                                    jb      short .small@
  1733 0000111D 8A0D[B4180500]                          mov     cl, byte [_@@linbits]
  1734 00001123 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits cl
  1735 00001125 D3E5                                    shl     ebp, cl
  1736 00001127 D3C0                                    rol     eax, cl
  1737 00001129 31E8                                    xor     eax, ebp
  1738 0000112B 28CD                                    sub     ch, cl
  1739 0000112D 7913                                    jns     short .cont@
  1740 0000112F 88E9                                    mov     cl, ch          ; mp3mac_collect_more
  1741 00001131 80C510                                  add     ch, 10h
  1742 00001134 D3C5                                    rol     ebp, cl
  1743 00001136 668B2E                                  mov     bp, [esi]
  1744 00001139 83C602                                  add     esi, 2
  1745 0000113C 66C1CD08                                ror     bp, 8
  1746 00001140 D3CD                                    ror     ebp, cl
  1747                                  
  1748                                  .cont@:
  1749 00001142 88D1                                    mov     cl, dl
  1750 00001144 80E103                                  and     cl, 3
  1751 00001147 C1EA02                                  shr     edx, 2
  1752 0000114A 8D04853C000000                          lea     eax, [eax*4+60]
  1753 00001151 08C8                                    or      al, cl
  1754 00001153 8A88[DCD20100]                          mov     cl, [mp3_table_4_3_exp+eax]
  1755 00001159 8B0485[18530200]                        mov     eax, [mp3_table_4_3_value+eax*4]
  1756 00001160 28D1                                    sub     cl, dl
  1757 00001162 D3E8                                    shr     eax, cl
  1758 00001164 80F91F                                  cmp     cl, 31
  1759 00001167 760E                                    jbe     short .get_sign@
  1760 00001169 31C0                                    xor     eax, eax
  1761 0000116B EB0A                                    jmp     short .get_sign@
  1762                                  
  1763                                  .small@:
  1764 0000116D C1E206                                  shl     edx, 6
  1765 00001170 8B8482[085C0400]                        mov     eax, [mp3_expval_table+edx+eax*4]
  1766                                  
  1767                                  .get_sign@:                           
  1768 00001177 FECD                                    dec     ch              ; dec mp3_colNN
  1769 00001179 D1E5                                    shl     ebp, 1          ; shl mp3_col32,1 ; cy=data
  1770 0000117B 19D2                                    sbb     edx, edx        ; cy=0,1 --> 0,FFFFFFFF
  1771 0000117D 31D0                                    xor     eax, edx        ; invert if cy was 1
  1772 0000117F 29D0                                    sub     eax, edx        ; add 1 if cy was 1
  1773                                  
  1774                                  .@this_sign@:
  1775 00001181 8984BBA4000000                          mov	[ebx+edi*4+164], eax ; [ebx+$mp3gr_sb_hybrid+edi*4+4]
  1776 00001188 83C702                                  add	edi, 2          ; next j
  1777 0000118B FF0D[B0180500]                          dec	dword [_@@JJJ]
  1778 00001191 0F857AFEFFFF                            jnz	.low_freq_lop_j
  1779                                  
  1780                                  .low_freq_next_i:
  1781 00001197 FF05[AC180500]                          inc	dword [_@@III]	; next i
  1782 0000119D 833D[AC180500]03                        cmp	dword [_@@III], 3
  1783 000011A4 0F8201FDFFFF                            jb	.low_freq_lop_i
  1784 000011AA 81FF3C020000                            cmp	edi, 572	; aka 576-4 ; skip if less than 4 entries left
  1785 000011B0 0F87DA000000                            ja	.high_freq_done
  1786                                  
  1787                                  .high_freq_lop:
  1788 000011B6 3B35[BC180500]                          cmp     esi, [_@@coarse_end]
  1789 000011BC 7629                                    jbe     short .high_freq_inrange
  1790 000011BE 89F0                                    mov     eax, esi        ; mp3mac_bitstream_get_position
  1791 000011C0 2B05[84ED0000]                          sub     eax, [mp3_bitstream_start]
  1792 000011C6 0FBED5                                  movsx   edx, ch         ; mp3_colNN
  1793 000011C9 F7DA                                    neg     edx
  1794 000011CB 8D44C2F0                                lea     eax, [edx+eax*8-16]
  1795 000011CF 3B4308                                  cmp     eax, [ebx+8]    ; [ebx+$mp3gr_part2_3_end] ; check end
  1796 000011D2 7213                                    jb      short .high_freq_inrange ; not yet end
  1797 000011D4 0F84B6000000                            jz      .high_freq_done ; okay, exact end
  1798 000011DA 83FF04                                  cmp     edi, 4
  1799 000011DD 7203                                    jb      short .high_freq_cannot_stepback
  1800 000011DF 83EF04                                  sub     edi, 4          ; stepback, s_index-4 ; dst stepback
  1801                                  
  1802                                  .high_freq_cannot_stepback:
  1803 000011E2 E9A9000000                              jmp     .high_freq_done
  1804                                  
  1805                                  .high_freq_inrange:
  1806 000011E7 8B5324                                  mov     edx, [ebx+24h]  ; [ebx+$mp3gr_count1table_select]
  1807                                                                          ; get huffcode (quad_vlc)
  1808                                  
  1809                                  .get_child_lop@@:
  1810 000011EA 8A0C95[9E180100]                        mov     cl, [(huff_tree_buf+2)+edx*4] ; mp3mac_get_huffcode
  1811 000011F1 668B1495[9C180100]                      mov     dx, word [huff_tree_buf+edx*4]
  1812 000011F9 89E8                                    mov     eax, ebp
  1813 000011FB D3E8                                    shr     eax, cl
  1814 000011FD 01C2                                    add     edx, eax
  1815 000011FF 8A0C95[9E180100]                        mov     cl, [(huff_tree_buf+2)+edx*4]
  1816 00001206 80F900                                  cmp     cl, 0
  1817 00001209 7823                                    js      short .got_child@@
  1818 0000120B 0FB70495[9C180100]                      movzx   eax, word [huff_tree_buf+edx*4]
  1819 00001213 D3E5                                    shl     ebp, cl
  1820 00001215 28CD                                    sub     ch, cl
  1821 00001217 7932                                    jns     short .got_done@@
  1822 00001219 88E9                                    mov     cl, ch
  1823 0000121B 80C510                                  add     ch, 10h
  1824 0000121E D3C5                                    rol     ebp, cl
  1825 00001220 668B2E                                  mov     bp, [esi]
  1826 00001223 83C602                                  add     esi, 2
  1827 00001226 66C1CD08                                ror     bp, 8
  1828 0000122A D3CD                                    ror     ebp, cl
  1829 0000122C EB1D                                    jmp     short .got_done@@
  1830                                  
  1831                                  .got_child@@:
  1832 0000122E C1E509                                  shl     ebp, 9
  1833 00001231 80ED09                                  sub     ch, 9
  1834 00001234 79B4                                    jns     short .get_child_lop@@
  1835 00001236 88E9                                    mov     cl, ch
  1836 00001238 80C510                                  add     ch, 10h
  1837 0000123B D3C5                                    rol     ebp, cl
  1838 0000123D 668B2E                                  mov     bp, [esi]
  1839 00001240 83C602                                  add     esi, 2
  1840 00001243 66C1CD08                                ror     bp, 8
  1841 00001247 D3CD                                    ror     ebp, cl
  1842 00001249 EB9F                                    jmp     short .get_child_lop@@
  1843                                  
  1844                                  .got_done@@:
  1845 0000124B 88C2                                    mov     dl, al          ; flags
  1846 0000124D C0E204                                  shl     dl, 4           ; flags, to upper 4bit
  1847 00001250 B604                                    mov     dh, 4           ; lopcount
  1848                                  
  1849                                  .high_freq_flag_lop:
  1850 00001252 31C0                                    xor     eax, eax
  1851 00001254 D0E2                                    shl     dl, 1           ; flag
  1852 00001256 7320                                    jnb     short .high_freq_flag_this
  1853 00001258 3B3D[C0180500]                          cmp     edi, [_@rle_point] ; @@get_runlength quads
  1854 0000125E 0F83B8000000                            jnb     .rle_fetch_next_quads
  1855                                  
  1856                                  .rle_back_quads:
  1857 00001264 A1[C8180500]                            mov     eax, [_@@rle_val]
  1858 00001269 8B0485[08540400]                        mov     eax, [mp3_exp_table+eax*4] ; xlat and get sign
  1859 00001270 FECD                                    dec     ch              ; mp3mac_get_bit_to_cy
  1860 00001272 D1E5                                    shl     ebp, 1
  1861 00001274 7302                                    jnb     short .high_freq_flag_this ;
  1862                                                                          ; sbb edx, edx ; cy=0,1 --> 0,FFFFFFFF
  1863                                                                          ; xor eax, edx ; invert if cy was 1
  1864                                                                          ; sub eax, edx ; add 1 if cy was 1
  1865 00001276 F7D8                                    neg     eax
  1866                                  
  1867                                  .high_freq_flag_this:
  1868 00001278 8984BBA0000000                          mov     [ebx+edi*4+160], eax ; [ebx+$mp3gr_sb_hybrid+edi*4+0]
  1869 0000127F 47                                      inc     edi
  1870 00001280 FECE                                    dec     dh
  1871 00001282 75CE                                    jnz     short .high_freq_flag_lop
  1872 00001284 81FF3C020000                            cmp     edi, 572        ; aka 576-4 ; loop while space for another 4 values
  1873 0000128A 0F8626FFFFFF                            jbe     .high_freq_lop
  1874                                  
  1875                                  .high_freq_done:
  1876 00001290 897B5C                                  mov     [ebx+92], edi   ; [ebx+$mp3gr_num_nonzero_hybrids]
  1877 00001293 51                                      push    ecx
  1878 00001294 B940020000                              mov     ecx, 576        ; end
  1879 00001299 29F9                                    sub     ecx, edi        ; remain = end-curr
  1880                                                                          ; zeropad remaining entries (can be 0 or 2 dwords,
  1881                                                                          ; or more. If above loop was aborted)
  1882 0000129B 8DBCBBA0000000                          lea     edi, [ebx+edi*4+160] ; [ebx+$mp3gr_sb_hybrid+edi*4]
  1883 000012A2 31C0                                    xor     eax, eax
  1884 000012A4 F3AB                                    rep stosd
  1885 000012A6 59                                      pop     ecx
  1886 000012A7 F605[4C6F0000]10                        test    byte [cpuid_flags], 10h ; timelog_end rdtsc_read_huffman
  1887 000012AE 740E                                    jz      short .no_rdtsc_supported@
  1888 000012B0 0F31                                    rdtsc
  1889 000012B2 0105[EC6F0000]                          add     [rdtsc_read_huffman], eax
  1890 000012B8 1115[F06F0000]                          adc     [rdtsc_read_huffman+4], edx
  1891                                  
  1892                                  .no_rdtsc_supported@:
  1893 000012BE F8                                      clc                     ; out: cy=0=okay
  1894 000012BF C3                                      retn
  1895                                  
  1896                                  .rle_fetch_next_small:
  1897 000012C0 A1[C4180500]                            mov     eax, [_@@rle_ptr] ; @@next_runlength small
  1898 000012C5 8305[C4180500]04                        add     dword [_@@rle_ptr], 4
  1899 000012CC 8B00                                    mov     eax, [eax]
  1900 000012CE 6639C7                                  cmp     di, ax
  1901 000012D1 73ED                                    jnb     short .rle_fetch_next_small
  1902 000012D3 66A3[C0180500]                          mov     word [_@rle_point], ax
  1903 000012D9 C1E810                                  shr     eax, 16
  1904 000012DC A3[C8180500]                            mov     [_@@rle_val], eax
  1905 000012E1 C1E006                                  shl     eax, 6
  1906 000012E4 A3[CC180500]                            mov     [_@@rle_val_x_40h], eax
  1907 000012E9 E934FCFFFF                              jmp     .rle_back_small
  1908                                  
  1909                                  .rle_fetch_next_full:
  1910 000012EE A1[C4180500]                            mov     eax, [_@@rle_ptr] ; @@next_runlength full
  1911 000012F3 8305[C4180500]04                        add	dword [_@@rle_ptr], 4
  1912 000012FA 8B00                                    mov     eax, [eax]
  1913 000012FC 6639C7                                  cmp     di, ax
  1914 000012FF 73ED                                    jnb     short .rle_fetch_next_full
  1915 00001301 66A3[C0180500]                          mov     word [_@rle_point], ax
  1916 00001307 C1E810                                  shr     eax, 16
  1917 0000130A A3[C8180500]                            mov     [_@@rle_val], eax
  1918 0000130F C1E006                                  shl     eax, 6
  1919 00001312 A3[CC180500]                            mov     [_@@rle_val_x_40h], eax
  1920 00001317 E90DFDFFFF                              jmp     .rle_back_full
  1921                                  
  1922                                  .rle_fetch_next_quads:
  1923 0000131C A1[C4180500]                            mov	eax, [_@@rle_ptr] ; msw=val, lsw=point
  1924 00001321 8305[C4180500]04                        add	dword [_@@rle_ptr], 4 ; 2+2
  1925 00001328 8B00                                    mov	eax, [eax]
  1926 0000132A 6639C7                                  cmp	di, ax          ; needed if rle fetching was skipped
  1927 0000132D 73ED                                    jnb	short .rle_fetch_next_quads
  1928 0000132F 66A3[C0180500]                          mov	word [_@rle_point], ax
  1929 00001335 C1E810                                  shr	eax, 16
  1930 00001338 A3[C8180500]                            mov	[_@@rle_val], eax
  1931 0000133D E922FFFFFF                              jmp	.rle_back_quads
  1932                                  
  1933                                  .lop_j_near_end:
  1934 00001342 89F0                                    mov     eax, esi
  1935 00001344 2B05[84ED0000]                          sub     eax, [mp3_bitstream_start]
  1936 0000134A 0FBED5                                  movsx   edx, ch
  1937 0000134D F7DA                                    neg     edx
  1938 0000134F 8D44C2F0                                lea     eax, [edx+eax*8-16]
  1939 00001353 3B4308                                  cmp     eax, [ebx+8]
  1940 00001356 0F82C1FCFFFF                            jb      .small_not_end@
  1941 0000135C E936FEFFFF                              jmp     .low_freq_next_i
  1942                                  
  1943                                  
  1944                                  ; =============== S U B R O U T I N E =======================================
  1945                                  
  1946                                  
  1947                                  mp3_compute_stereo:
  1948 00001361 833D[AA960000]02                        cmp	dword [mp3_output_num_channels], 2 ; in: ebx=granule(s)
  1949 00001368 7515                                    jnz	short .no_stereo
  1950 0000136A 833D[C6960000]02                        cmp	dword [mp3_hdr_mode_ext], 2 ; MODE_EXT_MS_STEREO
  1951                                                                          ; only MS stereo
  1952 00001371 740D                                    jz	short mp3_compute_ms_stereo
  1953 00001373 F705[C6960000]0100-                     test	dword [mp3_hdr_mode_ext], 1 ; MODE_EXT_I_STEREO
  1953 0000137B 0000               
  1954                                                                          ; intensity stereo (optionally with MS stereo)
  1955 0000137D 7567                                    jnz	short mp3_compute_i_stereo
  1956                                  
  1957                                  .no_stereo:
  1958 0000137F C3                                      retn
  1959                                  
  1960                                  mp3_compute_ms_stereo:
  1961 00001380 F605[4C6F0000]10                        test    byte [cpuid_flags], 10h ; ms_stereo is most commonly used
  1962                                                                          ; the 1/sqrt(2) normalization factor is included
  1963                                                                          ; in the global gain
  1964 00001387 740E                                    jz      short .no_rdtsc_supported ; timelog_start rdtsc_ms_stereo
  1965 00001389 0F31                                    rdtsc
  1966 0000138B 2905[04700000]                          sub     [rdtsc_ms_stereo], eax
  1967 00001391 1915[08700000]                          sbb     [rdtsc_ms_stereo+4], edx
  1968                                  
  1969                                  .no_rdtsc_supported:
  1970 00001397 8DBBE0130000                            lea     edi, [ebx+5088] ; [ebx+$mp3gr_sb_hybrid+$mp3gr_entrysiz*2]
  1971                                                                          ; for ch1 (2nd channel)
  1972 0000139D 8B4B5C                                  mov     ecx, [ebx+92]   ; [ebx+$mp3gr_num_nonzero_hybrids] ; ch0
  1973 000013A0 8B839C130000                            mov     eax, [ebx+5020] ; [ebx+$mp3gr_num_nonzero_hybrids+($mp3gr_entrysiz*2)] ; ch1
  1974 000013A6 39C1                                    cmp     ecx, eax
  1975 000013A8 7702                                    ja      short .this_len
  1976 000013AA 89C1                                    mov     ecx, eax
  1977                                  
  1978                                  .this_len:
  1979 000013AC E320                                    jecxz   .ms_stereo_done
  1980 000013AE 894B5C                                  mov     [ebx+92], ecx   ; [ebx+$mp3gr_num_nonzero_hybrids] ; ch0
  1981 000013B1 898B9C130000                            mov     [ebx+5020], ecx ; [ebx+$mp3gr_num_nonzero_hybrids+($mp3gr_entrysiz*2)] ; ch1
  1982                                  
  1983                                  .ms_stereo_lop:
  1984 000013B7 8B87C0ECFFFF                            mov     eax, [edi-4928] ; for i=0 to 576-1
  1985                                                                          ; [edi+@@ch0]
  1986                                                                          ; @@ch0 equ (-$mp3gr_entrysiz*2) ; granule for channel=0
  1987                                                                          ; tmp0 = granule.ch0.sb_hybrid[i]
  1988 000013BD 8B17                                    mov     edx, [edi]      ; @@ch1 equ 0 ; granule for channel=1
  1989                                                                          ; [edi+@@ch1]
  1990                                                                          ; tmp1 = granule.ch1.sb_hybrid[i]
  1991 000013BF 29D0                                    sub     eax, edx        ; tmp0 - tmp1
  1992 000013C1 8D1450                                  lea     edx, [eax+edx*2] ; tmp0 + tmp1
  1993 000013C4 8997C0ECFFFF                            mov     [edi-4928], edx ; [edi+@@ch0]
  1994                                                                          ; granule.ch0.sb_hybrid[i] = tmp0 + tmp1
  1995 000013CA AB                                      stosd                   ; [edi+@@ch1]
  1996                                                                          ; granule.ch1.sb_hybrid[i] = tmp0 - tmp1
  1997 000013CB 49                                      dec     ecx
  1998 000013CC 75E9                                    jnz     short .ms_stereo_lop
  1999                                  
  2000                                  .ms_stereo_done:
  2001 000013CE F605[4C6F0000]10                        test    byte [cpuid_flags], 10h ; timelog_end rdtsc_ms_stereo
  2002 000013D5 740E                                    jz      short .no_rdtsc_supported@
  2003 000013D7 0F31                                    rdtsc
  2004 000013D9 0105[04700000]                          add     [rdtsc_ms_stereo], eax
  2005 000013DF 1115[08700000]                          adc     [rdtsc_ms_stereo+4], edx
  2006                                  
  2007                                  .no_rdtsc_supported@:
  2008 000013E5 C3                                      retn
  2009                                  
  2010                                  mp3_compute_i_stereo:
  2011 000013E6 F605[4C6F0000]10                        test    byte [cpuid_flags], 10h ; timelog_start rdtsc_i_stereo
  2012 000013ED 740E                                    jz      short .no_rdtsc_supported@@@
  2013 000013EF 0F31                                    rdtsc
  2014 000013F1 2905[1C700000]                          sub     [rdtsc_i_stereo], eax
  2015 000013F7 1915[20700000]                          sbb     [rdtsc_i_stereo+4], edx
  2016                                  
  2017                                  .no_rdtsc_supported@@@:
  2018 000013FD C7435C40020000                          mov     dword [ebx+92], 576 ; ch0
  2019                                                                          ; [ebx+$mp3gr_num_nonzero_hybrids]
  2020 00001404 C7839C130000400200-                     mov     dword [ebx+5020], 576 ; ch1
  2020 0000140D 00                 
  2021                                                                          ; [ebx+$mp3gr_num_nonzero_hybrids+($mp3gr_entrysiz*2)]
  2022 0000140E 8B4320                                  mov     eax, [ebx+32]   ; [ebx+$mp3gr_long_end]
  2023 00001411 A3[08190500]                            mov     [_@@n_long_sfb], eax
  2024 00001416 B80D000000                              mov     eax, 13         ; 39/3
  2025 0000141B 2B431C                                  sub     eax, [ebx+28]   ; [ebx+$mp3gr_short_start]
  2026 0000141E 8D0440                                  lea     eax, [eax+eax*2] ; mul3
  2027 00001421 A3[0C190500]                            mov     [_@@n_short_sfb], eax
  2028 00001426 0305[08190500]                          add     eax, [_@@n_long_sfb]
  2029 0000142C A3[10190500]                            mov     [_@@n_sfb], eax ;
  2030                                                                          ; n_sfb = gr->n_long_sfb + gr->n_short_sfb;
  2031 00001431 803D[0C190500]00                        cmp     byte [_@@n_short_sfb], 0
  2032 00001438 B801000000                              mov     eax, 1
  2033 0000143D 7405                                    jz      short .without_short
  2034 0000143F B803000000                              mov     eax, 3          ; max_blocks = gr->n_short_sfb ? 3 : 1;
  2035                                  
  2036                                  .without_short:
  2037 00001444 A3[D4180500]                            mov     [_@@max_blocks], eax
  2038 00001449 BF[DC180500]                            mov     edi, _@@sfb_array
  2039 0000144E A1[9E960000]                            mov     eax, [mp3_hdr_sample_rate_index] ; bstab
  2040 00001453 6BC016                                  imul    eax, 22
  2041 00001456 8DB0[CC790000]                          lea     esi, [mp3_band_size_long+eax]
  2042 0000145C 8B0D[08190500]                          mov     ecx, [_@@n_long_sfb]
  2043 00001462 F3A4                                    rep movsb
  2044 00001464 A1[9E960000]                            mov     eax, [mp3_hdr_sample_rate_index]
  2045 00001469 6BC00D                                  imul    eax, 13
  2046 0000146C 8DB0[9C7A0000]                          lea     esi, [mp3_band_size_short+eax] ; merge lieff-style
  2047 00001472 8B0D[0C190500]                          mov     ecx, [_@@n_short_sfb]
  2048 00001478 E30C                                    jecxz   .make_sfb_done ; doing that here is a bit slow,
  2049                                                                          ; it would be better to pre-compute
  2050                                                                          ; all merged-combinations
  2051 0000147A 03731C                                  add     esi, [ebx+28]   ; [ebx+$mp3gr_short_start]
  2052                                  
  2053                                  .make_sfb_lop:
  2054 0000147D AC                                      lodsb
  2055 0000147E AA                                      stosb
  2056 0000147F AA                                      stosb
  2057 00001480 AA                                      stosb
  2058 00001481 83E903                                  sub     ecx, 3
  2059 00001484 75F7                                    jnz     short .make_sfb_lop
  2060                                  
  2061                                  .make_sfb_done:
  2062 00001486 E888000000                              call    _@@find_top_bands ;
  2063                                                                          ; L3_stereo_top_band(left+576,gr->sfbtab,n_sfb,max_band);
  2064 0000148B 803D[08190500]00                        cmp     byte [_@@n_long_sfb], 0
  2065 00001492 7420                                    jz      short .without_long
  2066 00001494 A1[D0180500]                            mov     eax, dword [_@@max_bands]
  2067 00001499 38C4                                    cmp     ah, al          ; if (gr->n_long_sfb)
  2068 0000149B 7F02                                    jg      short .not_max1 ; max_band[0] = max_band[1] = max_band[2] = MINIMP3_MAX
  2069                                                                          ; (MINIMP3_MAX(max_band[0], max_band[1]), max_band[2]);
  2070 0000149D 88C4                                    mov     ah, al
  2071                                  
  2072                                  .not_max1:
  2073 0000149F C1E808                                  shr     eax, 8
  2074 000014A2 38C4                                    cmp     ah, al
  2075 000014A4 7F02                                    jg      short .not_max2
  2076 000014A6 88C4                                    mov     ah, al
  2077                                  
  2078                                  .not_max2:
  2079 000014A8 88E0                                    mov     al, ah
  2080 000014AA C1E008                                  shl     eax, 8
  2081 000014AD 88E0                                    mov     al, ah
  2082 000014AF A3[D0180500]                            mov     dword [_@@max_bands], eax
  2083                                  
  2084                                  .without_long:
  2085 000014B4 31ED                                    xor     ebp, ebp        ; blk
  2086                                  
  2087                                  .adjust_last_prev_lop:
  2088 000014B6 8B15[10190500]                          mov     edx, [_@@n_sfb]
  2089 000014BC 2B15[D4180500]                          sub     edx, [_@@max_blocks] ; itop = n_sfb - max_blocks + blk
  2090 000014C2 01EA                                    add     edx, ebp
  2091 000014C4 89D1                                    mov     ecx, edx
  2092 000014C6 2B0D[D4180500]                          sub     ecx, [_@@max_blocks] ; prev = itop - max_blocks;
  2093 000014CC A1[CA960000]                            mov     eax, [mp3_hdr_flag_lsf]
  2094 000014D1 8D0440                                  lea     eax, [eax+eax*2] ; 0,1 --> 0,3
  2095                                                                          ; default_pos = HDR_TEST_MPEG1(hdr) ? 3
  2096 000014D4 3403                                    xor     al, 3           ; 0,3 --> 3,0
  2097 000014D6 363A8D[D0180500]                        cmp     cl, [ss:_@@max_bands+ebp]
  2098 000014DD 7E07                                    jle     short .use_default_pos ; ist_pos[itop] = max_band[blk] >=
  2099                                                                          ; prev ? default_pos : ist_pos[prev]
  2100 000014DF 8A840BB0130000                          mov     al, [ebx+ecx+5040] ; [ebx+@@right+$mp3gr_scale_factors+ecx]
  2101                                  
  2102                                  .use_default_pos:
  2103 000014E6 888413B0130000                          mov     [ebx+edx+5040], al ; [ebx+@@right+$mp3gr_scale_factors+edx]
  2104 000014ED 45                                      inc     ebp             ; blk
  2105 000014EE 3B2D[D4180500]                          cmp     ebp, [_@@max_blocks]
  2106 000014F4 72C0                                    jb      short .adjust_last_prev_lop
  2107 000014F6 E867000000                              call    _@@apply_i_stereo
  2108 000014FB F605[4C6F0000]10                        test    byte [cpuid_flags], 10h ; timelog_end rdtsc_i_stereo
  2109 00001502 740E                                    jz      short .no_rdtsc_supported@@@@
  2110 00001504 0F31                                    rdtsc
  2111 00001506 0105[1C700000]                          add     [rdtsc_i_stereo], eax
  2112 0000150C 1115[20700000]                          adc     [rdtsc_i_stereo+4], edx
  2113                                  
  2114                                  .no_rdtsc_supported@@@@:
  2115 00001512 C3                                      retn
  2116                                  
  2117                                  
  2118                                  ; =============== S U B R O U T I N E =======================================
  2119                                  
  2120                                  
  2121                                  _@@find_top_bands:
  2122 00001513 C705[D0180500]FFFF-                     mov     dword [_@@max_bands], 0FFFFFFh ; set maxband[0..2]=(-1)
  2122 0000151B FF00               
  2123 0000151D 8DB3E0130000                            lea     esi, [ebx+5088] ; [ebx+@@right+$mp3gr_sb_hybrid]
  2124 00001523 31D2                                    xor     edx, edx
  2125                                  
  2126                                  .find_top_lop_iii:                    
  2127 00001525 31C9                                    xor     ecx, ecx        ; for (i = 0; i < nbands; i++)
  2128                                  
  2129                                  .find_top_lop_kkk:                    
  2130 00001527 8B048E                                  mov     eax, [esi+ecx*4] ; for (k = 0; k < sfb[i]; k += 2)
  2131 0000152A 0B448E04                                or      eax, [esi+ecx*4+4]
  2132 0000152E 750D                                    jnz     short .found_nonzero
  2133 00001530 83C102                                  add     ecx, 2
  2134 00001533 3A8A[DC180500]                          cmp     cl, [_@@sfb_array+edx]
  2135 00001539 72EC                                    jb      short .find_top_lop_kkk
  2136 0000153B EB11                                    jmp     short .find_top_next
  2137                                  
  2138                                  .found_nonzero:
  2139 0000153D 89D0                                    mov     eax, edx
  2140 0000153F F635[06840000]                          div     byte [_@@const_3]
  2141 00001545 0FB6C4                                  movzx   eax, ah         ; remainder (mod 3)
  2142 00001548 8890[D0180500]                          mov     [_@@max_bands+eax], dl ; max_bands[0..2]=i
  2143                                  
  2144                                  .find_top_next:
  2145 0000154E 0FB682[DC180500]                        movzx   eax, byte [_@@sfb_array+edx]
  2146 00001555 8D3486                                  lea     esi, [esi+eax*4]
  2147 00001558 42                                      inc     edx             ; next
  2148 00001559 3B15[10190500]                          cmp     edx, [_@@n_sfb]
  2149 0000155F 72C4                                    jb      short .find_top_lop_iii
  2150 00001561 C3                                      retn
  2151                                  
  2152                                  ; =============== S U B R O U T I N E =======================================
  2153                                  
  2154                                  
  2155                                  _@@apply_i_stereo:
  2156 00001562 B8[8C7D0000]                            mov     eax, mp3_is_table_normal
  2157 00001567 B907000000                              mov     ecx, 7
  2158 0000156C 833D[CA960000]00                        cmp     dword [mp3_hdr_flag_lsf], 0
  2159 00001573 7425                                    jz      short .this_lsf
  2160 00001575 8B8354130000                            mov     eax, [ebx+4948] ; [ebx+@@right+$mp3gr_scalefac_compress]
  2161 0000157B 83E001                                  and     eax, 1          ; bit0
  2162 0000157E F705[C6960000]0200-                     test    dword [mp3_hdr_mode_ext], 2 ; MODE_EXT_MS_STEREO
  2162 00001586 0000               
  2163 00001588 7403                                    jz      short .no_ms
  2164 0000158A 83C802                                  or      eax, 2          ; bit1=mul_1.414
  2165                                  
  2166                                  .no_ms:
  2167 0000158D C1E009                                  shl     eax, 9          ; N*40h*2*4
  2168 00001590 05[88E00400]                            add     eax, mp3_is_table_lsf
  2169 00001595 B940000000                              mov     ecx, 64         ; max (must be below NO_INTENSITY_FLAG)
  2170                                  
  2171                                  .this_lsf:
  2172 0000159A 890D[D8180500]                          mov     [_@@max_pos], ecx ; 7 or 64
  2173 000015A0 A3[04190500]                            mov     [_@@is_tab], eax ; table
  2174 000015A5 8DB3A0000000                            lea     esi, [ebx+160]  ; [ebx+$mp3gr_sb_hybrid]
  2175 000015AB 31C9                                    xor     ecx, ecx        ; iii ; for (i = 0; sfb[i]; i++)
  2176                                  
  2177                                  .apply_lop_i:
  2178 000015AD 0FB6A9[DC180500]                        movzx   ebp, byte [_@@sfb_array+ecx] ; if ((int)i > max_band[i % 3]
  2179                                                                          ; && ipos < max_pos)
  2180 000015B4 89C8                                    mov     eax, ecx
  2181 000015B6 F635[06840000]                          div     byte [_@@const_3] ; max_band[i % 3]
  2182 000015BC 0FB6C4                                  movzx   eax, ah         ; remainder (mod 3)
  2183 000015BF 3A88[D0180500]                          cmp     cl, [_@@max_bands+eax] ; iii,max_bands[0..2];
  2184 000015C5 7E38                                    jle     short .apply_ms_stereo
  2185 000015C7 0FB6BC0BB0130000                        movzx   edi, byte [ebx+ecx+5040] ; [ebx+@@right+$mp3gr_scale_factors+ecx]
  2186                                                                          ; @@right = $mp3gr_entrysiz*2 = 4928
  2187                                                                          ; $mp3gr_scale_factors = 112
  2188 000015CF 3B3D[D8180500]                          cmp     edi, [_@@max_pos] ; check ipos
  2189 000015D5 7328                                    jnb     short .apply_ms_stereo
  2190 000015D7 C1E703                                  shl     edi, 3          ; mul 2*4
  2191 000015DA 033D[04190500]                          add     edi, [_@@is_tab]
  2192                                  
  2193                                  .apply_pan_lop:
  2194 000015E0 8B06                                    mov     eax, [esi]      ; tmp = granule.ch0.sb_hybrid
  2195 000015E2 C1E002                                  shl     eax, 2
  2196 000015E5 F76F04                                  imul    dword [edi+4] ; v1
  2197 000015E8 899640130000                            mov     [esi+4928], edx ; [esi+@@right]
  2198                                                                          ; granule.ch1.sb_hybrid = tmp*v1
  2199 000015EE 8B06                                    mov     eax, [esi]      ; tmp = granule.ch0.sb_hybrid
  2200 000015F0 C1E002                                  shl     eax, 2
  2201 000015F3 F72F                                    imul    dword [edi] ; v0
  2202 000015F5 8916                                    mov     [esi], edx      ; granule.ch0.sb_hybrid = tmp*v0
  2203 000015F7 83C604                                  add     esi, 4
  2204 000015FA 4D                                      dec     ebp
  2205 000015FB 75E3                                    jnz     short .apply_pan_lop
  2206 000015FD EB2C                                    jmp     short .apply_next
  2207                                  
  2208                                  .apply_ms_stereo:
  2209 000015FF F705[C6960000]0200-                     test	dword [mp3_hdr_mode_ext], 2 ; MODE_EXT_MS_STEREO
  2209 00001607 0000               
  2210 00001609 741D                                    jz	short .apply_none
  2211                                  
  2212                                  .ms_stereo_lop:
  2213 0000160B 8B06                                    mov     eax, [esi]      ; tmp0 = granule.ch0.sb_hybrid[i]
  2214 0000160D 8B9640130000                            mov     edx, [esi+4928] ; [esi+@@right]
  2215                                                                          ; tmp1 = granule.ch1.sb_hybrid[i]
  2216 00001613 29D0                                    sub     eax, edx        ; tmp0 - tmp1
  2217 00001615 8D1450                                  lea     edx, [eax+edx*2] ; tmp0 + tmp1
  2218 00001618 8916                                    mov     [esi], edx      ; granule.ch0.sb_hybrid[i] = tmp0 + tmp1
  2219 0000161A 898640130000                            mov     [esi+4928], eax ; [esi+@@right]
  2220                                                                          ; granule.ch1.sb_hybrid[i] = tmp0 - tmp1
  2221 00001620 83C604                                  add     esi, 4
  2222 00001623 4D                                      dec     ebp
  2223 00001624 75E5                                    jnz     short .ms_stereo_lop
  2224 00001626 EB03                                    jmp     short .apply_next
  2225                                  
  2226                                  .apply_none:
  2227 00001628 8D34AE                                  lea     esi, [esi+ebp*4] ; skip, keep unchanged
  2228                                  
  2229                                  .apply_next:
  2230 0000162B 41                                      inc     ecx             ; iii
  2231 0000162C 3B0D[10190500]                          cmp     ecx, [_@@n_sfb]
  2232 00001632 0F8275FFFFFF                            jb      .apply_lop_i   ; next
  2233 00001638 C3                                      retn
  2234                                  
  2235                                  ; =============== S U B R O U T I N E =======================================
  2236                                  
  2237                                  
  2238                                  mp3_reorder_block:
  2239 00001639 F605[4C6F0000]10                        test    byte [cpuid_flags], 10h ; timelog_start rdtsc_reorder
  2240 00001640 740E                                    jz      short .no_rdtsc_supported
  2241 00001642 0F31                                    rdtsc
  2242 00001644 2905[34700000]                          sub     [rdtsc_reorder], eax
  2243 0000164A 1915[38700000]                          sbb     [rdtsc_reorder+4], edx
  2244                                  
  2245                                  .no_rdtsc_supported:
  2246 00001650 807B2C02                                cmp	byte [ebx+44], 2 ; ebx+$mp3gr_block_type] ; only for type 2
  2247 00001654 7565                                    jnz	short .no_reorder
  2248 00001656 8DB3A0000000                            lea	esi, [ebx+160]  ; [ebx+$mp3gr_sb_hybrid] ; ptr+0
  2249 0000165C 807B3000                                cmp	byte [ebx+48], 0 ; [ebx+$mp3gr_switch_point]
  2250 00001660 7412                                    jz	short .this_src
  2251 00001662 81C690000000                            add	esi, 144        ; 36*4 ; ptr+36*4
  2252 00001668 833D[9E960000]08                        cmp	dword [mp3_hdr_sample_rate_index], 8
  2253 0000166F 7503                                    jnz	short .this_src
  2254 00001671 83C630                                  add	esi, 48         ; 12*4 ; additionally to above 36*4 ; ptr+48*4
  2255                                  
  2256                                  .this_src:
  2257 00001674 8B531C                                  mov     edx, [ebx+28]   ; [ebx+$mp3gr_short_start] ; can be 13
  2258 00001677 83FA0D                                  cmp     edx, 13
  2259 0000167A 733F                                    jnb     short .no_reorder
  2260 0000167C C7435C40020000                          mov     dword [ebx+92], 576 ; [ebx+$mp3gr_num_nonzero_hybrids]
  2261                                  
  2262                                  .outer_lop:
  2263 00001683 A1[9E960000]                            mov     eax, [mp3_hdr_sample_rate_index]
  2264 00001688 6BC00D                                  imul    eax, 13         ; X*13
  2265 0000168B 0FB68C10[9C7A0000]                      movzx   ecx, byte [mp3_band_size_short+eax+edx] ; [X*13+Y]
  2266 00001693 BF[14190500]                            mov     edi, _@@tmp
  2267 00001698 60                                      pusha
  2268 00001699 89CA                                    mov     edx, ecx        ; step=len (4..44) ; copy LEN*3 dwords to tmp
  2269                                  
  2270                                  .inner_lop:
  2271 0000169B 8B06                                    mov     eax, [esi]
  2272 0000169D AB                                      stosd
  2273 0000169E 8B0496                                  mov     eax, [esi+edx*4] ; copy 3 dwords
  2274 000016A1 AB                                      stosd
  2275 000016A2 8B04D6                                  mov     eax, [esi+edx*8]
  2276 000016A5 AB                                      stosd
  2277 000016A6 83C604                                  add     esi, 4
  2278 000016A9 E2F0                                    loop    .inner_lop
  2279 000016AB 61                                      popa
  2280 000016AC 8D0C49                                  lea     ecx, [ecx+ecx*2] ; len*3
  2281 000016AF 87FE                                    xchg    esi, edi        ; copy LEN*3 dwords back from tmp
  2282 000016B1 F3A5                                    rep movsd
  2283 000016B3 87FE                                    xchg    esi, edi
  2284 000016B5 42                                      inc     edx
  2285 000016B6 83FA0D                                  cmp     edx, 13
  2286 000016B9 72C8                                    jb      short .outer_lop ; next
  2287                                  
  2288                                  .no_reorder:
  2289 000016BB F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
  2290 000016C2 740E                                    jz      short .no_rdtsc_supported@ ; timelog_end rdtsc_reorder
  2291 000016C4 0F31                                    rdtsc
  2292 000016C6 0105[34700000]                          add     [rdtsc_reorder], eax
  2293 000016CC 1115[38700000]                          adc     [rdtsc_reorder+4], edx
  2294                                  
  2295                                  .no_rdtsc_supported@:
  2296 000016D2 C3                                      retn
  2297                                  
  2298                                  
  2299                                  ; =============== S U B R O U T I N E =======================================
  2300                                  
  2301                                  
  2302                                  mp3_compute_antialias:
  2303 000016D3 F605[4C6F0000]10                        test    byte [cpuid_flags], 10h ; in: ebx=granule
  2304 000016DA 740E                                    jz      short .no_rdtsc_supported ; timelog_start rdtsc_antialias
  2305 000016DC 0F31                                    rdtsc
  2306 000016DE 2905[4C700000]                          sub     [rdtsc_antialias], eax
  2307 000016E4 1915[50700000]                          sbb     [rdtsc_antialias+4], edx
  2308                                  
  2309                                  .no_rdtsc_supported:
  2310 000016EA 8B435C                                  mov     eax, [ebx+92]   ; [ebx+$mp3gr_num_nonzero_hybrids]
  2311 000016ED 83C008                                  add     eax, 8          ; 9-1 ; 0..576+8
  2312 000016F0 31D2                                    xor     edx, edx
  2313 000016F2 B909000000                              mov     ecx, 9
  2314 000016F7 F7F1                                    div     ecx             ; (num/9) ; 0..64
  2315 000016F9 894360                                  mov     [ebx+60h], eax
  2316 000016FC D1E8                                    shr     eax, 1          ; (num/18) ; 0..32
  2317 000016FE 0F84B8010000                            jz      .no_antialias  ; 0 (when num/9 = 0..1)
  2318 00001704 89C1                                    mov     ecx, eax        ; 1..32
  2319 00001706 C1E805                                  shr     eax, 5          ; 0..1
  2320 00001709 29C1                                    sub     ecx, eax        ; 1..31 ; len excluding zeropadding
  2321 0000170B 807B2C02                                cmp     byte [ebx+44], 2 ; [ebx+$mp3gr_block_type]
  2322 0000170F 750F                                    jnz     short .this_len ; antialias only "long" bands
  2323 00001711 807B3000                                cmp     byte [ebx+48], 0 ; [ebx+$mp3gr_switch_point]
  2324 00001715 0F84A1010000                            jz      .no_antialias
  2325 0000171B B901000000                              mov     ecx, 1          ; check this for 8000Hz case
  2326                                  
  2327                                  .this_len:
  2328 00001720 8D440901                                lea     eax, [1+ecx*2]
  2329 00001724 394360                                  cmp     [ebx+96], eax   ; [ebx+$mp3gr_num_nonzero_hybrids_div9]
  2330 00001727 7703                                    ja      short .is_bigger
  2331 00001729 894360                                  mov     [ebx+96], eax   ; opdate highest
  2332                                                                          ; (nonzero required for l3-si_huff.bit)
  2333                                  
  2334                                  .is_bigger:
  2335 0000172C 53                                      push    ebx
  2336 0000172D 8D9BA0000000                            lea     ebx, [ebx+160]  ; [ebx+$mp3gr_sb_hybrid]
  2337                                  
  2338                                  .lop:
  2339 00001733 83C348                                  add     ebx, 72         ; 18*4
  2340 00001736 8B73FC                                  mov     esi, [ebx-4]    ; IRP nn,0,1,2,3,4,5,6,7 ; INT_AA(nn=0..7)
  2341 00001739 8B3B                                    mov     edi, [ebx]      ; @@def_csa macro nn,cs,ca
  2342                                                                          ;   mp3_csa_&nn&_cs equ cs
  2343                                                                          ;   mp3_csa_&nn&_ca equ ca
  2344                                                                          ;  endm
  2345                                                                          ; constants for mp3_csa_table
  2346 0000173B C1E602                                  shl     esi, 2          ; tmp0 = ptr[-nn-1]*4
  2347 0000173E C1E702                                  shl     edi, 2          ; tmp1 = ptr[+nn]*4
  2348 00001741 8D043E                                  lea     eax, [esi+edi]  ; tmp2 = tmp0+tmp1
  2349 00001744 BD032AE136                              mov     ebp, 36E12A03h  ; @@def_csa 0,36E12A03h,-20ED7F9Ah  ;-0.6
  2350                                                                          ; mp3_csa_&nn&_cs
  2351 00001749 F7ED                                    imul    ebp             ; tmp2 = (tmp2*csa[0])
  2352 0000174B 89D5                                    mov     ebp, edx
  2353 0000174D B8635631A8                              mov     eax, -57CEA99Dh ; mp3_csa_&nn&_ca-mp3_csa_&nn&_cs
  2354 00001752 F7EE                                    imul    esi             ; tmp0 = (tmp2+(tmp0*csa[3]))
  2355 00001754 01EA                                    add     edx, ebp
  2356 00001756 8913                                    mov     [ebx], edx      ; [ebx+(nn)*4]
  2357 00001758 B869AAF315                              mov     eax, 15F3AA69h  ; mp3_csa_&nn&_ca+mp3_csa_&nn&_cs
  2358 0000175D F7EF                                    imul    edi             ; tmp1 = (tmp2-(tmp1*csa[2]))
  2359 0000175F 29D5                                    sub     ebp, edx
  2360 00001761 896BFC                                  mov     [ebx-4], ebp    ; [ebx-(nn+1)*4]
  2361 00001764 8B73F8                                  mov     esi, [ebx-8]
  2362 00001767 8B7B04                                  mov     edi, [ebx+4]
  2363 0000176A C1E602                                  shl     esi, 2
  2364 0000176D C1E702                                  shl     edi, 2
  2365 00001770 8D043E                                  lea     eax, [esi+edi]
  2366 00001773 BDFD756E38                              mov     ebp, 386E75FDh  ; @@def_csa 1,386E75FDh,-1E30DB48h  ;-0.535
  2367 00001778 F7ED                                    imul    ebp
  2368 0000177A 89D5                                    mov     ebp, edx
  2369 0000177C B8BBAE60A9                              mov     eax, -569F5145h
  2370 00001781 F7EE                                    imul    esi
  2371 00001783 01EA                                    add     edx, ebp
  2372 00001785 895304                                  mov     [ebx+4], edx    ; [ebx+(nn)*4]
  2373 00001788 B8B59A3D1A                              mov     eax, 1A3D9AB5h
  2374 0000178D F7EF                                    imul    edi
  2375 0000178F 29D5                                    sub     ebp, edx
  2376 00001791 896BF8                                  mov     [ebx-8], ebp    ; [ebx-(nn+1)*4]
  2377 00001794 8B73F4                                  mov     esi, [ebx-12]
  2378 00001797 8B7B08                                  mov     edi, [ebx+8]
  2379 0000179A C1E602                                  shl     esi, 2
  2380 0000179D C1E702                                  shl     edi, 2
  2381 000017A0 8D043E                                  lea     eax, [esi+edi]
  2382 000017A3 BD3EB7C63C                              mov     ebp, 3CC6B73Eh  ;  @@def_csa 2,3CC6B73Eh,-140E604Fh  ;-0.33
  2383 000017A8 F7ED                                    imul    ebp
  2384 000017AA 89D5                                    mov     ebp, edx
  2385 000017AC B873E82AAF                              mov     eax, -50D5178Dh
  2386 000017B1 F7EE                                    imul    esi
  2387 000017B3 01EA                                    add     edx, ebp
  2388 000017B5 895308                                  mov     [ebx+8], edx    ; [ebx+(nn)*4]
  2389 000017B8 B8EF56B828                              mov     eax, 28B856EFh
  2390 000017BD F7EF                                    imul    edi
  2391 000017BF 29D5                                    sub     ebp, edx
  2392 000017C1 896BF4                                  mov     [ebx-12], ebp   ; [ebx-(nn+1)*4]
  2393 000017C4 8B73F0                                  mov     esi, [ebx-16]
  2394 000017C7 8B7B0C                                  mov     edi, [ebx+12]
  2395 000017CA C1E602                                  shl     esi, 2
  2396 000017CD C1E702                                  shl     edi, 2
  2397 000017D0 8D043E                                  lea     eax, [esi+edi]
  2398 000017D3 BD55A0EE3E                              mov     ebp, 3EEEA055h  ; @@def_csa 3,3EEEA055h,-0BA47742h  ;-0.185
  2399 000017D8 F7ED                                    imul    ebp
  2400 000017DA 89D5                                    mov     ebp, edx
  2401 000017DC B869E86CB5                              mov     eax, -4A931797h
  2402 000017E1 F7EE                                    imul    esi
  2403 000017E3 01EA                                    add     edx, ebp
  2404 000017E5 89530C                                  mov     [ebx+12], edx   ; [ebx+(nn)*4]
  2405 000017E8 B813294A33                              mov     eax, 334A2913h
  2406 000017ED F7EF                                    imul    edi
  2407 000017EF 29D5                                    sub     ebp, edx
  2408 000017F1 896BF0                                  mov     [ebx-16], ebp   ; [ebx-(nn+1)*4]
  2409 000017F4 8B73EC                                  mov     esi, [ebx-20]   ; ebx-(nn+1)*4] ; tmp0 = ptr[-nn-1]
  2410 000017F7 8B7B10                                  mov     edi, [ebx+16]   ; [ebx+(nn)*4] ; tmp1 = ptr[+nn]
  2411 000017FA C1E602                                  shl     esi, 2
  2412 000017FD C1E702                                  shl     edi, 2
  2413 00001800 8D043E                                  lea     eax, [esi+edi]  ; tmp2 = tmp0+tmp1
  2414 00001803 BD5C90B63F                              mov     ebp, 3FB6905Ch  ; @@def_csa 4,3FB6905Ch,-060D80E9h  ;-0.095
  2415 00001808 F7ED                                    imul    ebp             ; tmp2 = (tmp2*csa[0])
  2416 0000180A 89D5                                    mov     ebp, edx
  2417 0000180C B8BBEE3BBA                              mov     eax, -45C41145h
  2418 00001811 F7EE                                    imul    esi             ; tmp0 = (tmp2+(tmp0*csa[3]))
  2419 00001813 01EA                                    add     edx, ebp
  2420 00001815 895310                                  mov     [ebx+16], edx   ; [ebx+(nn)*4]
  2421 00001818 B8730FA939                              mov     eax, 39A90F73h
  2422 0000181D F7EF                                    imul    edi             ; tmp1 = (tmp2-(tmp1*csa[2]))
  2423 0000181F 29D5                                    sub     ebp, edx
  2424 00001821 896BEC                                  mov     [ebx-20], ebp   ; [ebx-(nn+1)*4]
  2425 00001824 8B73E8                                  mov     esi, [ebx-24]
  2426 00001827 8B7B14                                  mov     edi, [ebx+20]
  2427 0000182A C1E602                                  shl     esi, 2
  2428 0000182D C1E702                                  shl     edi, 2
  2429 00001830 8D043E                                  lea     eax, [esi+edi]
  2430 00001833 BD213FF23F                              mov     ebp, 3FF23F21h  ; @@def_csa 5,3FF23F21h,-029F2E1Bh  ;-0.041
  2431 00001838 F7ED                                    imul    ebp
  2432 0000183A 89D5                                    mov     ebp, edx
  2433 0000183C B8C4926EBD                              mov     eax, -42916D3Ch
  2434 00001841 F7EE                                    imul    esi
  2435 00001843 01EA                                    add     edx, ebp
  2436 00001845 895314                                  mov     [ebx+20], edx   ; [ebx+(nn)*4]
  2437 00001848 B80611533D                              mov     eax, 3D531106h
  2438 0000184D F7EF                                    imul    edi
  2439 0000184F 29D5                                    sub     ebp, edx
  2440 00001851 896BE8                                  mov     [ebx-24], ebp   ; [ebx-(nn+1)*4]
  2441 00001854 8B73E4                                  mov     esi, [ebx-28]
  2442 00001857 8B7B18                                  mov     edi, [ebx+24]
  2443 0000185A C1E602                                  shl     esi, 2
  2444 0000185D C1E702                                  shl     edi, 2
  2445 00001860 8D043E                                  lea     eax, [esi+edi]
  2446 00001863 BD3259FE3F                              mov     ebp, 3FFE5932h  ; @@def_csa 6,3FFE5932h,-00E8A11Ch  ;-0.0142
  2447 00001868 F7ED                                    imul    ebp
  2448 0000186A 89D5                                    mov     ebp, edx
  2449 0000186C B8B20519BF                              mov     eax, -40E6FA4Eh
  2450 00001871 F7EE                                    imul    esi
  2451 00001873 01EA                                    add     edx, ebp
  2452 00001875 895318                                  mov     [ebx+24], edx   ; [ebx+(nn)*4]
  2453 00001878 B816B8153F                              mov     eax, 3F15B816h
  2454 0000187D F7EF                                    imul    edi
  2455 0000187F 29D5                                    sub     ebp, edx
  2456 00001881 896BE4                                  mov     [ebx-28], ebp   ; [ebx-(nn+1)*4]
  2457 00001884 8B73E0                                  mov     esi, [ebx-32]
  2458 00001887 8B7B1C                                  mov     edi, [ebx+28]
  2459 0000188A C1E602                                  shl     esi, 2
  2460 0000188D C1E702                                  shl     edi, 2
  2461 00001890 8D043E                                  lea     eax, [esi+edi]
  2462 00001893 BD4BE3FF3F                              mov     ebp, 3FFFE34Bh  ; @@def_csa 7,3FFFE34Bh,-003C9ED1h  ;-0.0037
  2463 00001898 F7ED                                    imul    ebp
  2464 0000189A 89D5                                    mov     ebp, edx
  2465 0000189C B8E47DC3BF                              mov     eax, -403C821Ch
  2466 000018A1 F7EE                                    imul    esi
  2467 000018A3 01EA                                    add     edx, ebp
  2468 000018A5 89531C                                  mov     [ebx+28], edx   ; [ebx+(nn)*4]
  2469 000018A8 B87A44C33F                              mov     eax, 3FC3447Ah
  2470 000018AD F7EF                                    imul    edi
  2471 000018AF 29D5                                    sub     ebp, edx
  2472 000018B1 896BE0                                  mov     [ebx-32], ebp   ; [ebx-(nn+1)*4]
  2473 000018B4 49                                      dec     ecx
  2474 000018B5 0F8578FEFFFF                            jnz     .lop
  2475 000018BB 5B                                      pop     ebx
  2476                                  
  2477                                  .no_antialias:
  2478 000018BC F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
  2479 000018C3 740E                                    jz      short .no_rdtsc_supported@
  2480 000018C5 0F31                                    rdtsc
  2481 000018C7 0105[4C700000]                          add     [rdtsc_antialias], eax
  2482 000018CD 1115[50700000]                          adc     [rdtsc_antialias+4], edx
  2483                                  
  2484                                  .no_rdtsc_supported@:
  2485 000018D3 C3                                      retn
  2486                                  
  2487                                  
  2488                                  ; =============== S U B R O U T I N E =======================================
  2489                                  
  2490                                  
  2491                                  mp3_imdct36:
  2492 000018D4 8B06                                    mov     eax, [esi]      ; in: esi=src (sb_hybrid)
  2493                                                                          ; in: edi=dst (sb_samples)
  2494                                                                          ; in: ebx=buf (mdct_buf)
  2495                                                                          ; in: ebp=win (mdct_win)
  2496                                                                          ;
  2497                                                                          ; [esi+0*4]
  2498 000018D6 8B5604                                  mov     edx, [esi+4]    ; IRP i,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17
  2499 000018D9 01D0                                    add     eax, edx        ; IF i AND 1 (*) ; mov edx,[esi+i*4] ; val[i]
  2500                                                                          ;  add val[i-1]
  2501 000018DB 894604                                  mov     [esi+4], eax    ;  IF i GT 1
  2502                                                                          ;   add  ecx,eax ; add val[i-2]
  2503                                                                          ;   mov  [esi+(i)*4],ecx
  2504                                                                          ;  ELSE
  2505                                                                          ;   mov  [esi+(i)*4],eax
  2506 000018DE 89C1                                    mov     ecx, eax        ;  memorize as val[i-2]
  2507 000018E0 8B4608                                  mov     eax, [esi+8]    ; ELSE (*) ; [esi+i*4] ; val[i]
  2508 000018E3 01C2                                    add     edx, eax        ;  add val[i-1]
  2509 000018E5 895608                                  mov     [esi+8], edx    ; [esi+(i)*4
  2510 000018E8 8B560C                                  mov     edx, [esi+12]
  2511 000018EB 01D0                                    add     eax, edx
  2512 000018ED 01C1                                    add     ecx, eax
  2513 000018EF 894E0C                                  mov     [esi+12], ecx
  2514 000018F2 89C1                                    mov     ecx, eax
  2515 000018F4 8B4610                                  mov     eax, [esi+16]
  2516 000018F7 01C2                                    add     edx, eax
  2517 000018F9 895610                                  mov     [esi+16], edx
  2518 000018FC 8B5614                                  mov     edx, [esi+20]
  2519 000018FF 01D0                                    add     eax, edx
  2520 00001901 01C1                                    add     ecx, eax
  2521 00001903 894E14                                  mov     [esi+20], ecx
  2522 00001906 89C1                                    mov     ecx, eax
  2523 00001908 8B4618                                  mov     eax, [esi+24]
  2524 0000190B 01C2                                    add     edx, eax
  2525 0000190D 895618                                  mov     [esi+24], edx
  2526 00001910 8B561C                                  mov     edx, [esi+28]
  2527 00001913 01D0                                    add     eax, edx
  2528 00001915 01C1                                    add     ecx, eax
  2529 00001917 894E1C                                  mov     [esi+28], ecx
  2530 0000191A 89C1                                    mov     ecx, eax
  2531 0000191C 8B4620                                  mov     eax, [esi+32]
  2532 0000191F 01C2                                    add     edx, eax
  2533 00001921 895620                                  mov     [esi+32], edx
  2534 00001924 8B5624                                  mov     edx, [esi+36]
  2535 00001927 01D0                                    add     eax, edx
  2536 00001929 01C1                                    add     ecx, eax
  2537 0000192B 894E24                                  mov     [esi+36], ecx
  2538 0000192E 89C1                                    mov     ecx, eax
  2539 00001930 8B4628                                  mov     eax, [esi+40]
  2540 00001933 01C2                                    add     edx, eax
  2541 00001935 895628                                  mov     [esi+40], edx
  2542 00001938 8B562C                                  mov     edx, [esi+44]
  2543 0000193B 01D0                                    add     eax, edx
  2544 0000193D 01C1                                    add     ecx, eax
  2545 0000193F 894E2C                                  mov     [esi+44], ecx
  2546 00001942 89C1                                    mov     ecx, eax
  2547 00001944 8B4630                                  mov     eax, [esi+48]
  2548 00001947 01C2                                    add     edx, eax
  2549 00001949 895630                                  mov     [esi+48], edx
  2550 0000194C 8B5634                                  mov     edx, [esi+52]
  2551 0000194F 01D0                                    add     eax, edx
  2552 00001951 01C1                                    add     ecx, eax
  2553 00001953 894E34                                  mov     [esi+52], ecx
  2554 00001956 89C1                                    mov     ecx, eax
  2555 00001958 8B4638                                  mov     eax, [esi+56]
  2556 0000195B 01C2                                    add     edx, eax
  2557 0000195D 895638                                  mov     [esi+56], edx
  2558 00001960 8B563C                                  mov     edx, [esi+60]
  2559 00001963 01D0                                    add     eax, edx
  2560 00001965 01C1                                    add     ecx, eax
  2561 00001967 894E3C                                  mov     [esi+60], ecx
  2562 0000196A 89C1                                    mov     ecx, eax
  2563 0000196C 8B4640                                  mov     eax, [esi+64]
  2564 0000196F 01C2                                    add     edx, eax
  2565 00001971 895640                                  mov     [esi+64], edx
  2566 00001974 8B5644                                  mov     edx, [esi+68]
  2567 00001977 01D0                                    add     eax, edx
  2568 00001979 01C1                                    add     ecx, eax
  2569 0000197B 894E44                                  mov     [esi+68], ecx
  2570 0000197E 89C1                                    mov     ecx, eax
  2571 00001980 53                                      push    ebx
  2572 00001981 55                                      push    ebp
  2573 00001982 57                                      push    edi
  2574 00001983 8B0E                                    mov     ecx, [esi]      ; IRP j,0,1
  2575 00001985 8B5E30                                  mov     ebx, [esi+48]   ; t1 = [esi+(0*2+j)*4], t0 = [esi+(6*2+j)*4]
  2576 00001988 8B7E20                                  mov     edi, [esi+32]   ; t2 = [esi+(4*2+j)*4]
  2577 0000198B 037E40                                  add     edi, [esi+64]   ; + [esi+(8*2+j)*4]
  2578 0000198E 2B7E10                                  sub     edi, [esi+16]   ; - [esi+(2*2+j)*4]
  2579 00001991 8D2C4B                                  lea     ebp, [ebx+ecx*2] ; t2 = src[4*2+j] + src[8*2+j] - src[2*2+j]
  2580                                                                          ; t3 = [t1*2+t0]
  2581 00001994 D1FD                                    sar     ebp, 1          ; sar @@t3,1
  2582 00001996 29D9                                    sub     ecx, ebx        ; sub @@t1,@@t0
  2583 00001998 89C8                                    mov     eax, ecx        ; @@SUM [@@tmp+(16+j)*4],@@t1,add,@@t2
  2584 0000199A 01F8                                    add     eax, edi
  2585 0000199C A3[60220500]                            mov     [_@@@tmp+40h], eax ; [@@tmp+(16+j)*4]
  2586 000019A1 D1FF                                    sar     edi, 1          ; sar @@t2,1
  2587 000019A3 89C8                                    mov     eax, ecx        ; @@SUM [@@tmp+(6+j)*4],@@t1,sub,@@t2
  2588 000019A5 29F8                                    sub     eax, edi
  2589 000019A7 A3[38220500]                            mov     [_@@@tmp+18h], eax ; [@@tmp+(6+j)*4]
  2590 000019AC 8B4610                                  mov     eax, [esi+16]   ; [esi+(4*2+j)*4]
  2591 000019AF 034620                                  add     eax, [esi+32]   ; [esi+(2*2+j)*4]
  2592 000019B2 D1E0                                    shl     eax, 1
  2593 000019B4 BA0AD94778                              mov     edx, 7847D90Ah  ; C2
  2594 000019B9 F7EA                                    imul    edx
  2595 000019BB 89D3                                    mov     ebx, edx
  2596 000019BD 8B4620                                  mov     eax, [esi+32]
  2597 000019C0 2B4640                                  sub     eax, [esi+64]
  2598 000019C3 BA04CB8BD3                              mov     edx, 0D38BCB04h ; negC8
  2599 000019C8 F7EA                                    imul    edx
  2600 000019CA 89D1                                    mov     ecx, edx
  2601 000019CC 8B4610                                  mov     eax, [esi+16]
  2602 000019CF 034640                                  add     eax, [esi+64]
  2603 000019D2 D1E0                                    shl     eax, 1
  2604 000019D4 BA7541F29D                              mov     edx, 9DF24175h  ; negC4
  2605 000019D9 F7EA                                    imul    edx
  2606 000019DB 89E8                                    mov     eax, ebp
  2607 000019DD 01D8                                    add     eax, ebx
  2608 000019DF 01C8                                    add     eax, ecx
  2609 000019E1 A3[28220500]                            mov     [_@@@tmp+8], eax
  2610 000019E6 89E8                                    mov     eax, ebp
  2611 000019E8 29D8                                    sub     eax, ebx
  2612 000019EA 29D0                                    sub     eax, edx
  2613 000019EC A3[48220500]                            mov     [_@@@tmp+28h], eax
  2614 000019F1 89E8                                    mov     eax, ebp
  2615 000019F3 01D0                                    add     eax, edx
  2616 000019F5 29C8                                    sub     eax, ecx
  2617 000019F7 A3[58220500]                            mov     [_@@@tmp+38h], eax
  2618 000019FC 8B4628                                  mov     eax, [esi+40]
  2619 000019FF 034638                                  add     eax, [esi+56]
  2620 00001A02 2B4608                                  sub     eax, [esi+8]
  2621 00001A05 D1E0                                    shl     eax, 1
  2622 00001A07 BA5F142691                              mov     edx, 9126145Fh  ; negC3
  2623 00001A0C F7EA                                    imul    edx
  2624 00001A0E 8915[30220500]                          mov     [_@@@tmp+10h], edx
  2625 00001A14 8B4608                                  mov     eax, [esi+8]
  2626 00001A17 034628                                  add     eax, [esi+40]
  2627 00001A1A D1E0                                    shl     eax, 1
  2628 00001A1C BA332E0E7E                              mov     edx, 7E0E2E33h  ; C1
  2629 00001A21 F7EA                                    imul    edx
  2630 00001A23 89D7                                    mov     edi, edx
  2631 00001A25 8B4628                                  mov     eax, [esi+40]
  2632 00001A28 2B4638                                  sub     eax, [esi+56]
  2633 00001A2B BA2E5E71A8                              mov     edx, 0A8715E2Eh ; negC7
  2634 00001A30 F7EA                                    imul    edx
  2635 00001A32 89D5                                    mov     ebp, edx
  2636 00001A34 8B4608                                  mov     eax, [esi+8]
  2637 00001A37 034638                                  add     eax, [esi+56]
  2638 00001A3A D1E0                                    shl     eax, 1
  2639 00001A3C BAB822B9AD                              mov     edx, 0ADB922B8h ; negC5
  2640 00001A41 F7EA                                    imul    edx
  2641 00001A43 89D1                                    mov     ecx, edx
  2642 00001A45 8B4618                                  mov     eax, [esi+24]
  2643 00001A48 D1E0                                    shl     eax, 1
  2644 00001A4A BAA2EBD96E                              mov     edx, 6ED9EBA2h  ; C3
  2645 00001A4F F7EA                                    imul    edx
  2646 00001A51 89E8                                    mov     eax, ebp
  2647 00001A53 01F8                                    add     eax, edi
  2648 00001A55 01D0                                    add     eax, edx
  2649 00001A57 A3[20220500]                            mov     [_@@@tmp], eax
  2650 00001A5C 89E8                                    mov     eax, ebp
  2651 00001A5E 29C8                                    sub     eax, ecx
  2652 00001A60 29D0                                    sub     eax, edx
  2653 00001A62 A3[40220500]                            mov     [_@@@tmp+20h], eax
  2654 00001A67 89F8                                    mov     eax, edi
  2655 00001A69 01C8                                    add     eax, ecx
  2656 00001A6B 29D0                                    sub     eax, edx
  2657 00001A6D A3[50220500]                            mov     [_@@@tmp+30h], eax
  2658 00001A72 8B4E04                                  mov     ecx, [esi+4]
  2659 00001A75 8B5E34                                  mov     ebx, [esi+52]
  2660 00001A78 8B7E24                                  mov     edi, [esi+36]
  2661 00001A7B 037E44                                  add     edi, [esi+68]
  2662 00001A7E 2B7E14                                  sub     edi, [esi+20]
  2663 00001A81 8D2C4B                                  lea     ebp, [ebx+ecx*2]
  2664 00001A84 D1FD                                    sar     ebp, 1
  2665 00001A86 29D9                                    sub     ecx, ebx
  2666 00001A88 89C8                                    mov     eax, ecx
  2667 00001A8A 01F8                                    add     eax, edi
  2668 00001A8C A3[64220500]                            mov     [_@@@tmp+44h], eax
  2669 00001A91 D1FF                                    sar     edi, 1
  2670 00001A93 89C8                                    mov     eax, ecx
  2671 00001A95 29F8                                    sub     eax, edi
  2672 00001A97 A3[3C220500]                            mov     [_@@@tmp+1Ch], eax
  2673 00001A9C 8B4614                                  mov     eax, [esi+20]   ; t0 = MULH(2*(src[2*2+j]+src[4*2+j]),C2)
  2674 00001A9F 034624                                  add     eax, [esi+36]
  2675 00001AA2 D1E0                                    shl     eax, 1
  2676 00001AA4 BA0AD94778                              mov     edx, 7847D90Ah  ; C2
  2677 00001AA9 F7EA                                    imul    edx
  2678 00001AAB 89D3                                    mov     ebx, edx
  2679 00001AAD 8B4624                                  mov     eax, [esi+36]   ; t1 = MULH(src[4*2+j]-src[8*2+j],negC8)
  2680 00001AB0 2B4644                                  sub     eax, [esi+68]
  2681 00001AB3 BA04CB8BD3                              mov     edx, 0D38BCB04h ; negC8
  2682 00001AB8 F7EA                                    imul    edx
  2683 00001ABA 89D1                                    mov     ecx, edx
  2684 00001ABC 8B4614                                  mov     eax, [esi+20]   ; t2 = MULH(2*(src[2*2+j]+src[8*2+j]),negC4)
  2685 00001ABF 034644                                  add     eax, [esi+68]
  2686 00001AC2 D1E0                                    shl     eax, 1
  2687 00001AC4 BA7541F29D                              mov     edx, 9DF24175h  ; negC4
  2688 00001AC9 F7EA                                    imul    edx
  2689 00001ACB 89E8                                    mov     eax, ebp        ; tmp[2+j] = t3+t0+t1
  2690 00001ACD 01D8                                    add     eax, ebx
  2691 00001ACF 01C8                                    add     eax, ecx
  2692 00001AD1 A3[2C220500]                            mov     [_@@@tmp+0Ch], eax
  2693 00001AD6 89E8                                    mov     eax, ebp        ; tmp[10+j] = t3-t0-t2
  2694 00001AD8 29D8                                    sub     eax, ebx
  2695 00001ADA 29D0                                    sub     eax, edx
  2696 00001ADC A3[4C220500]                            mov     [_@@@tmp+2Ch], eax
  2697 00001AE1 89E8                                    mov     eax, ebp        ; tmp[14+j] = t3+t2-t1
  2698 00001AE3 01D0                                    add     eax, edx
  2699 00001AE5 29C8                                    sub     eax, ecx
  2700 00001AE7 A3[5C220500]                            mov     [_@@@tmp+3Ch], eax
  2701 00001AEC 8B462C                                  mov     eax, [esi+44]   ; tmp[4+j] = MULH(2*(src[5*2+j]+src[7*2+j]-src[1*2+j]),negC3)
  2702 00001AEF 03463C                                  add     eax, [esi+60]
  2703 00001AF2 2B460C                                  sub     eax, [esi+12]
  2704 00001AF5 D1E0                                    shl     eax, 1
  2705 00001AF7 BA5F142691                              mov     edx, 9126145Fh  ; negC3
  2706 00001AFC F7EA                                    imul    edx
  2707 00001AFE 8915[34220500]                          mov     [_@@@tmp+14h], edx
  2708 00001B04 8B460C                                  mov     eax, [esi+12]   ; @@MULH @@t2,[esi+(1*2+j)*4],add,[esi+(5*2+j)*4],-,-              ,1,C1,-
  2709                                                                          ; t2 = MULH(2*(src[1*2+j],add,src[5*2+j]),-,-,1,C1)
  2710 00001B07 03462C                                  add     eax, [esi+44]
  2711 00001B0A D1E0                                    shl     eax, 1
  2712 00001B0C BA332E0E7E                              mov     edx, 7E0E2E33h  ; C1
  2713 00001B11 F7EA                                    imul    edx
  2714 00001B13 89D7                                    mov     edi, edx
  2715 00001B15 8B462C                                  mov     eax, [esi+44]   ; @@MULH @@t3,[esi+(5*2+j)*4],sub,[esi+(7*2+j)*4],-,-,
  2716                                                                          ; ,0,negC7,-
  2717                                                                          ;
  2718                                                                          ; t3 = MULH( src[5*2+j],sub,src[7*2+j],-,-,0,negC7)
  2719 00001B18 2B463C                                  sub     eax, [esi+60]
  2720 00001B1B BA2E5E71A8                              mov     edx, 0A8715E2Eh ; negC7
  2721 00001B20 F7EA                                    imul    edx
  2722 00001B22 89D5                                    mov     ebp, edx
  2723 00001B24 8B460C                                  mov     eax, [esi+12]   ; t1 = MULH(2*(src[1*2+j],add,src[7*2+j]),-,-,1,negC5)
  2724 00001B27 03463C                                  add     eax, [esi+60]
  2725 00001B2A D1E0                                    shl     eax, 1          ; shift = 1
  2726 00001B2C BAB822B9AD                              mov     edx, 0ADB922B8h ; negC5
  2727 00001B31 F7EA                                    imul    edx
  2728 00001B33 89D1                                    mov     ecx, edx
  2729 00001B35 8B461C                                  mov     eax, [esi+28]   ; t0 = MULH(2*src[3*2+j],-,-,-,-,1,C3)
  2730 00001B38 D1E0                                    shl     eax, 1
  2731 00001B3A BAA2EBD96E                              mov     edx, 6ED9EBA2h  ; C3
  2732 00001B3F F7EA                                    imul    edx
  2733 00001B41 89E8                                    mov     eax, ebp
  2734 00001B43 01F8                                    add     eax, edi
  2735 00001B45 01D0                                    add     eax, edx
  2736 00001B47 A3[24220500]                            mov     [_@@@tmp+4], eax
  2737 00001B4C 89E8                                    mov     eax, ebp
  2738 00001B4E 29C8                                    sub     eax, ecx
  2739 00001B50 29D0                                    sub     eax, edx
  2740 00001B52 A3[44220500]                            mov     [_@@@tmp+24h], eax
  2741 00001B57 89F8                                    mov     eax, edi        ; @@SUM [@@tmp+(12+j)*4],@@t2,add,@@t1,sub,edx
  2742 00001B59 01C8                                    add     eax, ecx
  2743 00001B5B 29D0                                    sub     eax, edx
  2744 00001B5D A3[54220500]                            mov     [_@@@tmp+34h], eax
  2745 00001B62 5F                                      pop     edi
  2746 00001B63 5D                                      pop     ebp
  2747 00001B64 5B                                      pop     ebx
  2748 00001B65 56                                      push    esi             ; IRP j,0,1,2,3 ; j = 0
  2749 00001B66 8B15[20220500]                          mov     edx, [_@@@tmp] ; t0 = [@@tmp+(j*4+0)*4]
  2750 00001B6C 8B35[24220500]                          mov     esi, [_@@@tmp+4] ; t1 = [@@tmp+(j*4+1)*4]
  2751 00001B72 A1[28220500]                            mov     eax, [_@@@tmp+8] ; t2 = [@@tmp+(j*4+2)*4]
  2752 00001B77 8B0D[2C220500]                          mov     ecx, [_@@@tmp+0Ch] ; t2 = [@@tmp+(j*4+3)*4]
  2753 00001B7D 29D0                                    sub     eax, edx        ; s2 = t2 - t0
  2754 00001B7F 8D1450                                  lea     edx, [eax+edx*2] ; s0 = t2 + t0
  2755 00001B82 A3[18220500]                            mov     [_@@s2], eax ; @@MULH esi,eax ,-,-,-,-,1,icos36h_&j,-
  2756                                                                          ; s2 = MULH(s2*2, icos36h[j])
  2757 00001B87 8915[14220500]                          mov     [_@@s0], edx
  2758 00001B8D 29F1                                    sub     ecx, esi
  2759 00001B8F 8D0471                                  lea     eax, [ecx+esi*2]
  2760 00001B92 D1E0                                    shl     eax, 1
  2761 00001B94 BA90953E40                              mov     edx, 403E9590h  ; icos36h_0
  2762 00001B99 F7EA                                    imul    edx
  2763 00001B9B 89D6                                    mov     esi, edx
  2764 00001B9D 89C8                                    mov     eax, ecx        ; @@MULH @@s3,ecx,-,-,-,-,shift_for_8minus&j,icos36h_8minus&j,-
  2765                                                                          ; s3 = MULL(s3,icos36[8-j]) ; <-- "MULL" with "icos36"
  2766 00001B9F C1E004                                  shl     eax, 4
  2767 00001BA2 BA2C2ACA5B                              mov     edx, 5BCA2A2Ch  ; icos36h_8 (8-0)
  2768 00001BA7 F7EA                                    imul    edx
  2769 00001BA9 8915[1C220500]                          mov     [_@@s3], edx
  2770 00001BAF 8B0D[14220500]                          mov     ecx, [_@@s0]
  2771 00001BB5 29F1                                    sub     ecx, esi
  2772 00001BB7 8D3471                                  lea     esi, [ecx+esi*2]
  2773 00001BBA 8B4524                                  mov     eax, [ebp+36]   ; @@MULH [edi+(9+j)*SBLIMIT*4],[ebp+(9+j)*4],
  2774                                                                          ; -,-,-,-,0,ecx,[ebx+(9+j)*4]
  2775                                                                          ; out[(9+j)*SBLIMIT] = MULH(t0, win[9+j])+buf[9+j]
  2776 00001BBD F7E9                                    imul    ecx
  2777 00001BBF 035324                                  add     edx, [ebx+36]   ; [ebx+(9+j)*4]
  2778 00001BC2 899780040000                            mov     [edi+1152], edx ; SBLIMIT=32 ; 9*SBLIMIT*4 = 1152
  2779 00001BC8 8B4520                                  mov     eax, [ebp+32]   ; @@MULH [edi+(8-j)*SBLIMIT*4],[ebp+(8-j)*4]
  2780                                                                          ; ,-,-,-,-,0,ecx,[ebx+(8-j)*4]
  2781 00001BCB F7E9                                    imul    ecx
  2782 00001BCD 035320                                  add     edx, [ebx+32]
  2783 00001BD0 899700040000                            mov     [edi+1024], edx ; SBLIMIT=32 ; 8*SBLIMIT*4 = 1024
  2784 00001BD6 8B456C                                  mov     eax, [ebp+108]
  2785 00001BD9 F7EE                                    imul    esi
  2786 00001BDB 895324                                  mov     [ebx+36], edx
  2787 00001BDE 8B4568                                  mov     eax, [ebp+104]  ; @@MULH [ebx+(8-j)*4],[ebp+(8-j+18)*4],-,-,-,-,0,esi,-
  2788 00001BE1 F7EE                                    imul    esi
  2789 00001BE3 895320                                  mov     [ebx+32], edx
  2790 00001BE6 8B0D[18220500]                          mov     ecx, [_@@s2]
  2791 00001BEC 8B35[1C220500]                          mov     esi, [_@@s3]
  2792 00001BF2 29F1                                    sub     ecx, esi        ; t2 = s2 - s3
  2793 00001BF4 8D3471                                  lea     esi, [ecx+esi*2] ; t3 = s2 + s3
  2794 00001BF7 8B4500                                  mov     eax, [ebp+0]    ; @@MULH [edi+(0+j)*SBLIMIT*4],[ebp+(0+j)*4],
  2795                                                                          ; -,-,-,-,0,ecx,[ebx+(0+j)*4]
  2796 00001BFA F7E9                                    imul    ecx
  2797 00001BFC 0313                                    add     edx, [ebx]
  2798 00001BFE 8917                                    mov     [edi], edx
  2799 00001C00 8B4544                                  mov     eax, [ebp+68]   ; @@MULH [edi+(17-j)*SBLIMIT*4],[ebp+(17-j)*4]
  2800                                                                          ; ,-,-,-,-,0,ecx,[ebx+(17-j)*4]
  2801 00001C03 F7E9                                    imul    ecx
  2802 00001C05 035344                                  add     edx, [ebx+68]
  2803 00001C08 899780080000                            mov     [edi+2176], edx ; 17*SBLIMIT*4 = 2176
  2804 00001C0E 8B4548                                  mov     eax, [ebp+72]   ; @@MULH [ebx+(0+j)*4],[ebp+(0+j+18)*4],-,-,-,-,0,esi,-
  2805 00001C11 F7EE                                    imul    esi
  2806 00001C13 8913                                    mov     [ebx], edx
  2807 00001C15 8B858C000000                            mov     eax, [ebp+140]  ; @@MULH [ebx+(17-j)*4],[ebp+(17-j+18)*4],-,-,-,-,0,esi,-
  2808 00001C1B F7EE                                    imul    esi
  2809 00001C1D 895344                                  mov     [ebx+68], edx
  2810 00001C20 8B15[30220500]                          mov     edx, [_@@@tmp+10h] ; IRP j,0,1,2,3 ; j = 1
  2811 00001C26 8B35[34220500]                          mov     esi, [_@@@tmp+14h]
  2812 00001C2C A1[38220500]                            mov     eax, [_@@@tmp+18h]
  2813 00001C31 8B0D[3C220500]                          mov     ecx, [_@@@tmp+1Ch]
  2814 00001C37 29D0                                    sub     eax, edx
  2815 00001C39 8D1450                                  lea     edx, [eax+edx*2]
  2816 00001C3C A3[18220500]                            mov     [_@@s2], eax
  2817 00001C41 8915[14220500]                          mov     [_@@s0], edx
  2818 00001C47 29F1                                    sub     ecx, esi
  2819 00001C49 8D0471                                  lea     eax, [ecx+esi*2]
  2820 00001C4C D1E0                                    shl     eax, 1
  2821 00001C4E BA07F74142                              mov     edx, 4241F707h  ; icos36h_1
  2822 00001C53 F7EA                                    imul    edx
  2823 00001C55 89D6                                    mov     esi, edx
  2824 00001C57 89C8                                    mov     eax, ecx
  2825 00001C59 C1E002                                  shl     eax, 2
  2826 00001C5C BA1E75A37B                              mov     edx, 7BA3751Eh  ; icos36h_7 (8-1)
  2827 00001C61 F7EA                                    imul    edx
  2828 00001C63 8915[1C220500]                          mov     [_@@s3], edx
  2829 00001C69 8B0D[14220500]                          mov     ecx, [_@@s0]
  2830 00001C6F 29F1                                    sub     ecx, esi
  2831 00001C71 8D3471                                  lea     esi, [ecx+esi*2]
  2832 00001C74 8B4528                                  mov     eax, [ebp+40]
  2833 00001C77 F7E9                                    imul    ecx
  2834 00001C79 035328                                  add     edx, [ebx+40]
  2835 00001C7C 899700050000                            mov     [edi+1280], edx
  2836 00001C82 8B451C                                  mov     eax, [ebp+28]
  2837 00001C85 F7E9                                    imul    ecx
  2838 00001C87 03531C                                  add     edx, [ebx+28]
  2839 00001C8A 899780030000                            mov     [edi+896], edx
  2840 00001C90 8B4570                                  mov     eax, [ebp+112]
  2841 00001C93 F7EE                                    imul    esi
  2842 00001C95 895328                                  mov     [ebx+40], edx
  2843 00001C98 8B4564                                  mov     eax, [ebp+100]
  2844 00001C9B F7EE                                    imul    esi
  2845 00001C9D 89531C                                  mov     [ebx+28], edx
  2846 00001CA0 8B0D[18220500]                          mov     ecx, [_@@s2]
  2847 00001CA6 8B35[1C220500]                          mov     esi, [_@@s3]
  2848 00001CAC 29F1                                    sub     ecx, esi
  2849 00001CAE 8D3471                                  lea     esi, [ecx+esi*2]
  2850 00001CB1 8B4504                                  mov     eax, [ebp+4]
  2851 00001CB4 F7E9                                    imul    ecx
  2852 00001CB6 035304                                  add     edx, [ebx+4]
  2853 00001CB9 899780000000                            mov     [edi+128], edx
  2854 00001CBF 8B4540                                  mov     eax, [ebp+64]
  2855 00001CC2 F7E9                                    imul    ecx
  2856 00001CC4 035340                                  add     edx, [ebx+64]
  2857 00001CC7 899700080000                            mov     [edi+2048], edx
  2858 00001CCD 8B454C                                  mov     eax, [ebp+76]
  2859 00001CD0 F7EE                                    imul    esi
  2860 00001CD2 895304                                  mov     [ebx+4], edx
  2861 00001CD5 8B8588000000                            mov     eax, [ebp+136]
  2862 00001CDB F7EE                                    imul    esi
  2863 00001CDD 895340                                  mov     [ebx+64], edx
  2864 00001CE0 8B15[40220500]                          mov     edx, [_@@@tmp+20h] ; IRP j,0,1,2,3 ; j = 2
  2865 00001CE6 8B35[44220500]                          mov     esi, [_@@@tmp+24h]
  2866 00001CEC A1[48220500]                            mov     eax, [_@@@tmp+28h]
  2867 00001CF1 8B0D[4C220500]                          mov     ecx, [_@@@tmp+2Ch]
  2868 00001CF7 29D0                                    sub     eax, edx
  2869 00001CF9 8D1450                                  lea     edx, [eax+edx*2]
  2870 00001CFC A3[18220500]                            mov     [_@@s2], eax
  2871 00001D01 8915[14220500]                          mov     [_@@s0], edx
  2872 00001D07 29F1                                    sub     ecx, esi
  2873 00001D09 8D0471                                  lea     eax, [ecx+esi*2]
  2874 00001D0C D1E0                                    shl     eax, 1
  2875 00001D0E BA6CBE9D46                              mov     edx, 469DBE6Ch  ; icos36h_2
  2876 00001D13 F7EA                                    imul    edx
  2877 00001D15 89D6                                    mov     esi, edx
  2878 00001D17 89C8                                    mov     eax, ecx
  2879 00001D19 C1E002                                  shl     eax, 2
  2880 00001D1C BA62ECB74B                              mov     edx, 4BB7EC62h  ; icos36h_6 (8-2)
  2881 00001D21 F7EA                                    imul    edx
  2882 00001D23 8915[1C220500]                          mov     [_@@s3], edx
  2883 00001D29 8B0D[14220500]                          mov     ecx, [_@@s0]
  2884 00001D2F 29F1                                    sub     ecx, esi
  2885 00001D31 8D3471                                  lea     esi, [ecx+esi*2]
  2886 00001D34 8B452C                                  mov     eax, [ebp+44]
  2887 00001D37 F7E9                                    imul    ecx
  2888 00001D39 03532C                                  add     edx, [ebx+44]
  2889 00001D3C 899780050000                            mov     [edi+1408], edx
  2890 00001D42 8B4518                                  mov     eax, [ebp+24]
  2891 00001D45 F7E9                                    imul    ecx
  2892 00001D47 035318                                  add     edx, [ebx+24]
  2893 00001D4A 899700030000                            mov     [edi+768], edx
  2894 00001D50 8B4574                                  mov     eax, [ebp+116]
  2895 00001D53 F7EE                                    imul    esi
  2896 00001D55 89532C                                  mov     [ebx+44], edx
  2897 00001D58 8B4560                                  mov     eax, [ebp+96]
  2898 00001D5B F7EE                                    imul    esi
  2899 00001D5D 895318                                  mov     [ebx+24], edx
  2900 00001D60 8B0D[18220500]                          mov     ecx, [_@@s2]
  2901 00001D66 8B35[1C220500]                          mov     esi, [_@@s3]
  2902 00001D6C 29F1                                    sub     ecx, esi
  2903 00001D6E 8D3471                                  lea     esi, [ecx+esi*2]
  2904 00001D71 8B4508                                  mov     eax, [ebp+8]
  2905 00001D74 F7E9                                    imul    ecx
  2906 00001D76 035308                                  add     edx, [ebx+8]
  2907 00001D79 899700010000                            mov     [edi+256], edx
  2908 00001D7F 8B453C                                  mov     eax, [ebp+60]
  2909 00001D82 F7E9                                    imul    ecx
  2910 00001D84 03533C                                  add     edx, [ebx+60]
  2911 00001D87 899780070000                            mov     [edi+1920], edx
  2912 00001D8D 8B4550                                  mov     eax, [ebp+80]
  2913 00001D90 F7EE                                    imul    esi
  2914 00001D92 895308                                  mov     [ebx+8], edx
  2915 00001D95 8B8584000000                            mov     eax, [ebp+132]
  2916 00001D9B F7EE                                    imul    esi
  2917 00001D9D 89533C                                  mov     [ebx+60], edx
  2918 00001DA0 8B15[50220500]                          mov     edx, [_@@@tmp+30h] ; IRP j,0,1,2,3 ; j = 3
  2919 00001DA6 8B35[54220500]                          mov     esi, [_@@@tmp+34h]
  2920 00001DAC A1[58220500]                            mov     eax, [_@@@tmp+38h]
  2921 00001DB1 8B0D[5C220500]                          mov     ecx, [_@@@tmp+3Ch]
  2922 00001DB7 29D0                                    sub     eax, edx
  2923 00001DB9 8D1450                                  lea     edx, [eax+edx*2]
  2924 00001DBC A3[18220500]                            mov     [_@@s2], eax
  2925 00001DC1 8915[14220500]                          mov     [_@@s0], edx
  2926 00001DC7 29F1                                    sub     ecx, esi
  2927 00001DC9 8D0471                                  lea     eax, [ecx+esi*2]
  2928 00001DCC D1E0                                    shl     eax, 1
  2929 00001DCE BABE2B214E                              mov     edx, 4E212BBEh  ; icos36h_3
  2930 00001DD3 F7EA                                    imul    edx
  2931 00001DD5 89D6                                    mov     esi, edx
  2932 00001DD7 89C8                                    mov     eax, ecx
  2933 00001DD9 D1E0                                    shl     eax, 1
  2934 00001DDB BADFA1946F                              mov     edx, 6F94A1DFh  ; icos36h_5 (8-3)
  2935 00001DE0 F7EA                                    imul    edx
  2936 00001DE2 8915[1C220500]                          mov     [_@@s3], edx
  2937 00001DE8 8B0D[14220500]                          mov     ecx, [_@@s0]
  2938 00001DEE 29F1                                    sub     ecx, esi
  2939 00001DF0 8D3471                                  lea     esi, [ecx+esi*2]
  2940 00001DF3 8B4530                                  mov     eax, [ebp+48]
  2941 00001DF6 F7E9                                    imul    ecx
  2942 00001DF8 035330                                  add     edx, [ebx+48]
  2943 00001DFB 899700060000                            mov     [edi+1536], edx
  2944 00001E01 8B4514                                  mov     eax, [ebp+20]
  2945 00001E04 F7E9                                    imul    ecx
  2946 00001E06 035314                                  add     edx, [ebx+20]
  2947 00001E09 899780020000                            mov     [edi+640], edx
  2948 00001E0F 8B4578                                  mov     eax, [ebp+120]
  2949 00001E12 F7EE                                    imul    esi
  2950 00001E14 895330                                  mov     [ebx+30h], edx
  2951 00001E17 8B455C                                  mov     eax, [ebp+92]
  2952 00001E1A F7EE                                    imul    esi
  2953 00001E1C 895314                                  mov     [ebx+20], edx
  2954 00001E1F 8B0D[18220500]                          mov     ecx, [_@@s2]
  2955 00001E25 8B35[1C220500]                          mov     esi, [_@@s3]
  2956 00001E2B 29F1                                    sub     ecx, esi
  2957 00001E2D 8D3471                                  lea     esi, [ecx+esi*2]
  2958 00001E30 8B450C                                  mov     eax, [ebp+12]
  2959 00001E33 F7E9                                    imul    ecx
  2960 00001E35 03530C                                  add     edx, [ebx+12]
  2961 00001E38 899780010000                            mov     [edi+384], edx
  2962 00001E3E 8B4538                                  mov     eax, [ebp+56]
  2963 00001E41 F7E9                                    imul    ecx
  2964 00001E43 035338                                  add     edx, [ebx+56]
  2965 00001E46 899700070000                            mov     [edi+1792], edx
  2966 00001E4C 8B4554                                  mov     eax, [ebp+84]
  2967 00001E4F F7EE                                    imul    esi
  2968 00001E51 89530C                                  mov     [ebx+12], edx
  2969 00001E54 8B8580000000                            mov     eax, [ebp+128]
  2970 00001E5A F7EE                                    imul    esi
  2971 00001E5C 895338                                  mov     [ebx+56], edx
  2972 00001E5F 8B0D[60220500]                          mov     ecx, [_@@@tmp+40h] ; IRP j,4
  2973                                                                          ; [@@tmp+(j*4+0)*4]
  2974 00001E65 A1[64220500]                            mov     eax, [_@@@tmp+44h] ; [@@tmp+(j*4+1)*4]
  2975 00001E6A D1E0                                    shl     eax, 1
  2976 00001E6C BA9A79825A                              mov     edx, 5A82799Ah  ; icos36h_4 (8-4)
  2977 00001E71 F7EA                                    imul    edx
  2978 00001E73 29D1                                    sub     ecx, edx
  2979 00001E75 8D3451                                  lea     esi, [ecx+edx*2]
  2980 00001E78 8B4534                                  mov     eax, [ebp+52]   ; @@MULH [edi+(9+j)*SBLIMIT*4],[ebp+(9+j)*4],
  2981                                                                          ; -,-,-,-,0,ecx,[ebx+(9+j)*4]
  2982                                                                          ; out[(9+4)*SBLIMIT] = MULH(t0,win[9+4])+buf[9+4]
  2983 00001E7B F7E9                                    imul    ecx
  2984 00001E7D 035334                                  add     edx, [ebx+52]
  2985 00001E80 899780060000                            mov     [edi+1664], edx ; 13*SBLIMIT*4 = 1664
  2986 00001E86 8B4510                                  mov     eax, [ebp+16]   ; @MULH [edi+(8-j)*SBLIMIT*4],[ebp+(8-j)*4],
  2987                                                                          ; -,-,-,-,0,ecx,[ebx+(8-j)*4]
  2988 00001E89 F7E9                                    imul    ecx
  2989 00001E8B 035310                                  add     edx, [ebx+16]
  2990 00001E8E 899700020000                            mov     [edi+512], edx
  2991 00001E94 8B457C                                  mov     eax, [ebp+124]  ; @@MULH [ebx+(9+j)*4],[ebp+(9+j+18)*4] ,-,-,-,-,0,esi,-
  2992 00001E97 F7EE                                    imul    esi
  2993 00001E99 895334                                  mov     [ebx+52], edx
  2994 00001E9C 8B4558                                  mov     eax, [ebp+88]   ; @@MULH [ebx+(8-j)*4],[ebp+(8-j+18)*4],-,-,-,-,0,esi,-
  2995 00001E9F F7EE                                    imul    esi
  2996 00001EA1 895310                                  mov     [ebx+16], edx
  2997 00001EA4 5E                                      pop     esi
  2998 00001EA5 C3                                      retn
  2999                                  
  3000                                  
  3001                                  ; =============== S U B R O U T I N E =======================================
  3002                                  
  3003                                  
  3004                                  mp3_imdct12:
  3005 00001EA6 8B06                                    mov     eax, [esi]      ; in: esi=src - out: [out2_...]
  3006 00001EA8 A3[68220500]                            mov     [_@@tmp0], eax  ; IRP nn,0,1,2,3,4,5
  3007                                                                          ;  @@tmp&nn rd 1
  3008                                                                          ; ENDM
  3009                                                                          ; mov  eax,[esi+0*3*4] ; = src[0*3]
  3010 00001EAD 8B560C                                  mov     edx, [esi+12]   ; [esi+1*3*4] ; = src[1*3]
  3011 00001EB0 01D0                                    add     eax, edx        ; = src[0*3]+src[1*3]
  3012 00001EB2 A3[6C220500]                            mov     [_@@tmp1], eax
  3013 00001EB7 8B4618                                  mov     eax, [esi+24]
  3014 00001EBA 01C2                                    add     edx, eax
  3015 00001EBC 8915[70220500]                          mov     [_@@tmp2], edx
  3016 00001EC2 8B5624                                  mov     edx, [esi+36]   ; [esi+3*3*4]
  3017 00001EC5 01D0                                    add     eax, edx
  3018 00001EC7 A3[74220500]                            mov     [_@@tmp3], eax
  3019 00001ECC 8B4630                                  mov     eax, [esi+48]
  3020 00001ECF 01C2                                    add     edx, eax
  3021 00001ED1 8915[78220500]                          mov     [_@@tmp4], edx
  3022 00001ED7 8B563C                                  mov     edx, [esi+60]   ; [esi+5*3*4]
  3023 00001EDA 01D0                                    add     eax, edx        ; = src[4*3]+src[5*3]
  3024 00001EDC 0305[74220500]                          add     eax, [_@@tmp3]
  3025 00001EE2 A3[7C220500]                            mov     [_@@tmp5], eax  ; tmp5 = src[4*3]+src[5*3]+tmp3
  3026 00001EE7 8B15[6C220500]                          mov     edx, [_@@tmp1]
  3027 00001EED 0115[74220500]                          add     [_@@tmp3], edx
  3028 00001EF3 A1[70220500]                            mov     eax, [_@@tmp2]  ; @@MULH @@tmp2,@@tmp2,-,-,-,-,1,C3,-
  3029                                                                          ; tmp2 = MULH(2*tmp2,C3)
  3030 00001EF8 D1E0                                    shl     eax, 1
  3031 00001EFA BAA2EBD96E                              mov     edx, 6ED9EBA2h  ; C3
  3032 00001EFF F7EA                                    imul    edx
  3033 00001F01 8915[70220500]                          mov     [_@@tmp2], edx
  3034 00001F07 A1[74220500]                            mov     eax, [_@@tmp3]  ; @@MULH @@tmp3,@@tmp3,-,-,-,-,2,C3,-
  3035                                                                          ; tmp3 = MULH(4*tmp3,C3)
  3036 00001F0C C1E002                                  shl     eax, 2
  3037 00001F0F BAA2EBD96E                              mov     edx, 6ED9EBA2h  ; C3
  3038 00001F14 F7EA                                    imul    edx
  3039 00001F16 8915[74220500]                          mov     [_@@tmp3], edx
  3040 00001F1C A1[6C220500]                            mov     eax, [_@@tmp1]  ; @@MULH edx,@@tmp1,sub,@@tmp5,-,-,1,icos36h_4,-
  3041 00001F21 2B05[7C220500]                          sub     eax, [_@@tmp5]  ; t2 = MULH(2*(tmp1-tmp5),icos36h_4)
  3042 00001F27 D1E0                                    shl     eax, 1
  3043 00001F29 BA9A79825A                              mov     edx, 5A82799Ah  ; icos36h_4
  3044 00001F2E F7EA                                    imul    edx
  3045 00001F30 A1[68220500]                            mov     eax, [_@@tmp0]  ; @@SUM eax,@@tmp0,sub,@@tmp4,-,-
  3046 00001F35 2B05[78220500]                          sub     eax, [_@@tmp4]  ; t1 = tmp0 - tmp4
  3047 00001F3B 29D0                                    sub     eax, edx        ; @@CAST macro t1,t2,dst0,dst1,dst2,dst3
  3048                                                                          ;   sub  t1,t2                           ;t1-t2
  3049                                                                          ;   lea  t2,[t1+t2*2]                    ;t1+t2
  3050                                                                          ;   mov  dword ptr [mp3_out2_a&dst0],t1  ;t1-t2
  3051                                                                          ;   mov  dword ptr [mp3_out2_b&dst0],t2  ;t1+t2
  3052                                                                          ; endm
  3053 00001F3D 8D1450                                  lea     edx, [eax+edx*2] ; @@CAST eax,edx,1,4,7,10
  3054                                                                          ; out2[1,4,7,10]=t1-t2,t1-t2,t1+t2,t1+t2
  3055 00001F40 A3[84220500]                            mov     [mp3_out2_a1], eax
  3056 00001F45 8915[90220500]                          mov     [mp3_out2_b1], edx
  3057 00001F4B A1[78220500]                            mov     eax, [_@@tmp4]
  3058 00001F50 8B15[6C220500]                          mov     edx, [_@@tmp1]
  3059 00001F56 D1F8                                    sar     eax, 1
  3060 00001F58 D1E2                                    shl     edx, 1
  3061 00001F5A 0105[68220500]                          add     [_@@tmp0], eax  ; tmp0 = tmp0 + tmp4/2
  3062 00001F60 0115[7C220500]                          add     [_@@tmp5], edx  ; tmp5 = tmp5 + tmp1*2
  3063 00001F66 A1[7C220500]                            mov     eax, [_@@tmp5]  ; @@MULH edx,@@tmp5,add,@@tmp3,-,-,0,icos36h_1,-
  3064 00001F6B 0305[74220500]                          add     eax, [_@@tmp3]
  3065 00001F71 BA07F74142                              mov     edx, 4241F707h  ; icos36h_1
  3066 00001F76 F7EA                                    imul    edx
  3067 00001F78 A1[68220500]                            mov     eax, [_@@tmp0]  ; @@SUM eax,@@tmp0,add,@@tmp2,-,-
  3068 00001F7D 0305[70220500]                          add     eax, [_@@tmp2]
  3069 00001F83 29D0                                    sub     eax, edx        ; @@CAST eax,edx,2,3,8,9
  3070 00001F85 8D1450                                  lea     edx, [eax+edx*2]
  3071 00001F88 A3[88220500]                            mov     [mp3_out2_a2], eax
  3072 00001F8D 8915[94220500]                          mov     [mp3_out2_b2], edx
  3073 00001F93 A1[7C220500]                            mov     eax, [_@@tmp5]  ; @@MULH edx,@@tmp5,sub,@@tmp3,-,-,1,icos36h_7,-
  3074 00001F98 2B05[74220500]                          sub     eax, [_@@tmp3]
  3075 00001F9E D1E0                                    shl     eax, 1
  3076 00001FA0 BA1E75A37B                              mov     edx, 7BA3751Eh  ; icos36h_7
  3077 00001FA5 F7EA                                    imul    edx
  3078 00001FA7 A1[68220500]                            mov     eax, [_@@tmp0]  ; @@SUM eax,@@tmp0,sub,@@tmp2,-,-
  3079 00001FAC 2B05[70220500]                          sub     eax, [_@@tmp2]
  3080 00001FB2 29D0                                    sub     eax, edx        ; @@CAST eax,edx,0,5,6,11
  3081 00001FB4 8D1450                                  lea     edx, [eax+edx*2]
  3082 00001FB7 A3[80220500]                            mov     [mp3_out2_a0], eax
  3083 00001FBC 8915[8C220500]                          mov     [mp3_out2_b0], edx
  3084 00001FC2 C3                                      retn
  3085                                  
  3086                                  
  3087                                  ; =============== S U B R O U T I N E =======================================
  3088                                  
  3089                                  
  3090                                  mp3_compute_imdct:
  3091 00001FC3 F605[4C6F0000]10                        test    byte [cpuid_flags], 10h ; in: ebx=granule
  3092 00001FCA 740E                                    jz      short .no_rdtsc_supported ; timelog_start rdtsc_imdct
  3093 00001FCC 0F31                                    rdtsc
  3094 00001FCE 2905[64700000]                          sub     [rdtsc_imdct], eax
  3095 00001FD4 1915[68700000]                          sbb     [rdtsc_imdct+4], edx
  3096                                  
  3097                                  .no_rdtsc_supported:
  3098 00001FDA 53                                      push    ebx
  3099 00001FDB 8B4B60                                  mov     ecx, [ebx+96]   ; [ebx+$mp3gr_num_nonzero_hybrids_div9]
  3100 00001FDE 6BC109                                  imul    eax, ecx, 9
  3101 00001FE1 8DBC83A0000000                          lea     edi, [ebx+eax*4+160] ; [ebx+$mp3gr_sb_hybrid+eax*4]
  3102 00001FE8 E322                                    jecxz   .breakout
  3103                                  
  3104                                  .scan_zero_lop:
  3105 00001FEA 83EF24                                  sub     edi, 36         ; index-9
  3106 00001FED 8B07                                    mov     eax, [edi]      ; [edi+0*4]
  3107 00001FEF 0B4704                                  or      eax, [edi+4]
  3108 00001FF2 0B4708                                  or      eax, [edi+8]
  3109 00001FF5 0B470C                                  or      eax, [edi+12]
  3110 00001FF8 0B4710                                  or      eax, [edi+16]
  3111 00001FFB 0B4714                                  or      eax, [edi+20]
  3112 00001FFE 0B4718                                  or      eax, [edi+24]
  3113 00002001 0B471C                                  or      eax, [edi+28]
  3114 00002004 0B4720                                  or      eax, [edi+32]   ; [edi+8*4]
  3115 00002007 7503                                    jnz     short .breakout
  3116 00002009 49                                      dec     ecx
  3117 0000200A 75DE                                    jnz     short .scan_zero_lop
  3118                                  
  3119                                  .breakout:
  3120 0000200C 41                                      inc     ecx             ; div9+1
  3121 0000200D D1E9                                    shr     ecx, 1          ; div18
  3122 0000200F 890D[AC220500]                          mov     [_@@sblimit], ecx
  3123 00002015 837B2C02                                cmp     dword [ebx+44], 2 ; [ebx+$mp3gr_block_type]
  3124 00002019 7505                                    jnz     short .this_long_end
  3125 0000201B 8B4B30                                  mov     ecx, [ebx+48]   ; [ebx+$mp3gr_switch_point]
  3126 0000201E D1E1                                    shl     ecx, 1          ; 0,1 --> 0,2
  3127                                  
  3128                                  .this_long_end:
  3129 00002020 890D[A8220500]                          mov     [_@@mdct_long_end], ecx
  3130 00002026 8B4330                                  mov     eax, [ebx+48]   ; [ebx+$mp3gr_switch_point]
  3131 00002029 A3[B0220500]                            mov     [_@@switch_point], eax
  3132 0000202E 8B432C                                  mov     eax, [ebx+44]   ; [ebx+$mp3gr_block_type]
  3133 00002031 69C090000000                            imul    eax, 144        ; 1*36*4
  3134 00002037 A3[A4220500]                            mov     [_@@www], eax
  3135 0000203C 8B0D[78ED0000]                          mov     ecx, [mp3_curr_channel]
  3136 00002042 A1[7CED0000]                            mov     eax, [mp3_curr_granule]
  3137 00002047 69C900120000                            imul    ecx, 4608       ; 36*SBLIMIT*4 ; channel ; sb_samples[ch][gr*18]
  3138 0000204D 69C000090000                            imul    eax, 2304       ; 18*SBLIMIT*4 ; frame=granule*18
  3139 00002053 8DBC01[DAB60000]                        lea     edi, [mp3_sb_samples+ecx+eax]
  3140 0000205A 8DB3A0000000                            lea     esi, [ebx+160]  ; [ebx+$mp3gr_sb_hybrid]
  3141 00002060 A1[78ED0000]                            mov     eax, [mp3_curr_channel]
  3142 00002065 69C000090000                            imul    eax, 2304       ; SBLIMIT*18*4
  3143 0000206B 8D98[DADA0000]                          lea     ebx, [mp3_mdct_buf+eax]
  3144 00002071 F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
  3145 00002078 740E                                    jz      short .no_rdtsc_supported@ ; timelog_start rdtsc_imdct36
  3146 0000207A 0F31                                    rdtsc
  3147 0000207C 2905[7C700000]                          sub     [rdtsc_imdct36], eax
  3148 00002082 1915[80700000]                          sbb     [rdtsc_imdct36+4], edx
  3149                                  
  3150                                  .no_rdtsc_supported@:
  3151 00002088 C705[A0220500]0000-                     mov	dword [_@@@JJJ], 0
  3151 00002090 0000               
  3152 00002092 833D[A8220500]00                        cmp	dword [_@@mdct_long_end], 0
  3153 00002099 744D                                    jz      short .imdct36_done
  3154                                  
  3155                                  .imdct36_lop:
  3156 0000209B BD[08DC0400]                            mov	ebp, mp3_mdct_win ; for j=0 to mdct_long_end-1
  3157 000020A0 833D[A0220500]02                        cmp	dword [_@@@JJJ], 2
  3158 000020A7 19C0                                    sbb	eax, eax
  3159 000020A9 2305[B0220500]                          and	eax, [_@@switch_point]
  3160 000020AF 7506                                    jnz	short .this_window ; force window 0
  3161 000020B1 032D[A4220500]                          add	ebp, [_@@www] ; mdct_win
  3162                                  
  3163                                  .this_window:
  3164 000020B7 A1[A0220500]                            mov	eax, [_@@@JJJ]
  3165 000020BC D1E8                                    shr	eax, 1          ; cy=0,1
  3166 000020BE 19C0                                    sbb	eax, eax        ; eax=0,FFFFFFFFh
  3167 000020C0 2540020000                              and	eax, 576        ; 4*36*4
  3168 000020C5 01C5                                    add	ebp, eax
  3169 000020C7 E808F8FFFF                              call	mp3_imdct36
  3170 000020CC 83C704                                  add	edi, 4          ; 1*4 ; dst
  3171 000020CF 83C648                                  add	esi, 72         ; 18*4 ; sb_hybrid
  3172 000020D2 83C348                                  add	ebx, 72         ; mdct_buf ; next
  3173 000020D5 FF05[A0220500]                          inc	dword [_@@@JJJ]
  3174 000020DB A1[A0220500]                            mov	eax, [_@@@JJJ]
  3175 000020E0 3B05[A8220500]                          cmp	eax, [_@@mdct_long_end]
  3176 000020E6 72B3                                    jb	short .imdct36_lop
  3177                                  
  3178                                  .imdct36_done:
  3179 000020E8 F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
  3180 000020EF 740E                                    jz      short .no_rdtsc_supported@@ ; timelog_end rdtsc_imdct36
  3181 000020F1 0F31                                    rdtsc
  3182 000020F3 0105[7C700000]                          add     [rdtsc_imdct36], eax
  3183 000020F9 1115[80700000]                          adc     [rdtsc_imdct36+4], edx
  3184                                  
  3185                                  .no_rdtsc_supported@@:
  3186 000020FF F605[4C6F0000]10                        test    byte [cpuid_flags], 10h ; timelog_start rdtsc_imdct12
  3187 00002106 740E                                    jz      short .no_rdtsc_supported@@@
  3188 00002108 0F31                                    rdtsc
  3189 0000210A 2905[94700000]                          sub     [rdtsc_imdct12], eax
  3190 00002110 1915[98700000]                          sbb     [rdtsc_imdct12+4], edx
  3191                                  
  3192                                  .no_rdtsc_supported@@@:
  3193 00002116 A1[A0220500]                            mov     eax, [_@@@JJJ]
  3194 0000211B 3B05[AC220500]                          cmp     eax, [_@@sblimit]
  3195 00002121 0F83D7020000                            jnb     .imdct12_done
  3196                                  
  3197                                  .imdct12_lop:
  3198 00002127 BD[28DD0400]                            mov     ebp, (mp3_mdct_win+120h) ; for j=mdct_long_end to sblimit-1
  3199 0000212C A1[A0220500]                            mov     eax, [_@@@JJJ]
  3200 00002131 D1E8                                    shr     eax, 1          ; cy=0,1
  3201 00002133 19C0                                    sbb     eax, eax        ; eax=0,FFFFFFFFh
  3202 00002135 2540020000                              and     eax, 576        ; 4*36*4
  3203 0000213A 01C5                                    add     ebp, eax        ; mdct_win
  3204 0000213C 8B03                                    mov     eax, [ebx]      ; IRP i,0,1,2,3,4,5
  3205 0000213E 8907                                    mov     [edi], eax      ; @@SUM [edi+i*SBLIMIT*4],[ebx+(i+0)*4],-,-,-,-
  3206 00002140 8B4304                                  mov     eax, [ebx+4]
  3207 00002143 898780000000                            mov     [edi+128], eax
  3208 00002149 8B4308                                  mov     eax, [ebx+8]
  3209 0000214C 898700010000                            mov     [edi+256], eax
  3210 00002152 8B430C                                  mov     eax, [ebx+12]
  3211 00002155 898780010000                            mov     [edi+384], eax
  3212 0000215B 8B4310                                  mov     eax, [ebx+16]
  3213 0000215E 898700020000                            mov     [edi+512], eax
  3214 00002164 8B4314                                  mov     eax, [ebx+20]
  3215 00002167 898780020000                            mov     [edi+640], eax  ; ENDM
  3216 0000216D 81C700030000                            add     edi, 768        ; 6*SBLIMIT*4
  3217 00002173 E82EFDFFFF                              call    mp3_imdct12
  3218 00002178 A1[80220500]                            mov     eax, [mp3_out2_a0] ; IRP i,0,1,2,3,4,5
  3219 0000217D 8B5500                                  mov     edx, [ebp+0]    ; @@MULH [edi+i*SBLIMIT*4],[mp3_out2_a&i],
  3220                                                                          ; -,-,-,-,0,[ebp+(i+0)*4],[ebx+(1*6+i)*4]
  3221 00002180 F7EA                                    imul    edx
  3222 00002182 035318                                  add     edx, [ebx+24]
  3223 00002185 8917                                    mov     [edi], edx
  3224 00002187 A1[8C220500]                            mov     eax, [mp3_out2_b0] ; @@MULH [ebx+(2*6+i)*4],[mp3_out2_b&i],
  3225                                                                          ; -,-,-,-,0,[ebp+(i+6)*4],-
  3226 0000218C 8B5518                                  mov     edx, [ebp+24]
  3227 0000218F F7EA                                    imul    edx
  3228 00002191 895330                                  mov     [ebx+48], edx
  3229 00002194 A1[84220500]                            mov     eax, [mp3_out2_a1] ; i = 1
  3230 00002199 8B5504                                  mov     edx, [ebp+4]
  3231 0000219C F7EA                                    imul    edx
  3232 0000219E 03531C                                  add     edx, [ebx+28]
  3233 000021A1 899780000000                            mov     [edi+128], edx
  3234 000021A7 A1[90220500]                            mov     eax, [mp3_out2_b1]
  3235 000021AC 8B551C                                  mov     edx, [ebp+28]
  3236 000021AF F7EA                                    imul    edx
  3237 000021B1 895334                                  mov     [ebx+52], edx
  3238 000021B4 A1[88220500]                            mov     eax, [mp3_out2_a2] ; i = 2
  3239 000021B9 8B5508                                  mov     edx, [ebp+8]
  3240 000021BC F7EA                                    imul    edx
  3241 000021BE 035320                                  add     edx, [ebx+32]
  3242 000021C1 899700010000                            mov     [edi+256], edx
  3243 000021C7 A1[94220500]                            mov     eax, [mp3_out2_b2]
  3244 000021CC 8B5520                                  mov     edx, [ebp+32]
  3245 000021CF F7EA                                    imul    edx
  3246 000021D1 895338                                  mov     [ebx+56], edx
  3247 000021D4 A1[88220500]                            mov     eax, [mp3_out2_a2] ; i = 3 ; mp3_out2_a3 equ mp3_out2_a2
  3248 000021D9 8B550C                                  mov     edx, [ebp+12]
  3249 000021DC F7EA                                    imul    edx
  3250 000021DE 035324                                  add     edx, [ebx+36]
  3251 000021E1 899780010000                            mov     [edi+384], edx
  3252 000021E7 A1[94220500]                            mov     eax, [mp3_out2_b2] ; mp3_out2_b3 equ mp3_out2_b2
  3253 000021EC 8B5524                                  mov     edx, [ebp+36]
  3254 000021EF F7EA                                    imul    edx
  3255 000021F1 89533C                                  mov     [ebx+60], edx
  3256 000021F4 A1[84220500]                            mov     eax, [mp3_out2_a1] ; i = 4 ; mp3_out2_a4 equ mp3_out2_a1
  3257 000021F9 8B5510                                  mov     edx, [ebp+16]
  3258 000021FC F7EA                                    imul    edx
  3259 000021FE 035328                                  add     edx, [ebx+40]
  3260 00002201 899700020000                            mov     [edi+512], edx
  3261 00002207 A1[90220500]                            mov     eax, [mp3_out2_b1] ; mp3_out2_b4 equ mp3_out2_b1
  3262 0000220C 8B5528                                  mov     edx, [ebp+40]
  3263 0000220F F7EA                                    imul    edx
  3264 00002211 895340                                  mov     [ebx+64], edx
  3265 00002214 A1[80220500]                            mov     eax, [mp3_out2_a0] ; i = 5 ; mp3_out2_a5 equ mp3_out2_a0
  3266 00002219 8B5514                                  mov     edx, [ebp+20]
  3267 0000221C F7EA                                    imul    edx
  3268 0000221E 03532C                                  add     edx, [ebx+44]
  3269 00002221 899780020000                            mov     [edi+640], edx
  3270 00002227 A1[8C220500]                            mov     eax, [mp3_out2_b0] ; mp3_out2_b5 equ mp3_out2_b0
  3271 0000222C 8B552C                                  mov     edx, [ebp+44]
  3272 0000222F F7EA                                    imul    edx
  3273 00002231 895344                                  mov     [ebx+68], edx   ; ENDM
  3274 00002234 81C700030000                            add     edi, 768        ; 6*SBLIMIT*4
  3275 0000223A 83C604                                  add     esi, 4          ; sb_hybrid
  3276 0000223D E864FCFFFF                              call    mp3_imdct12
  3277 00002242 A1[80220500]                            mov     eax, [mp3_out2_a0] ; IRP i,0,1,2,3,4,5
  3278 00002247 8B5500                                  mov     edx, [ebp+0]    ; @@MULH [edi+i*SBLIMIT*4],[mp3_out2_a&i],
  3279                                                                          ; -,-,-,-,0,[ebp+(i+0)*4],[ebx+(2*6+i)*4]
  3280 0000224A F7EA                                    imul    edx             ; @@MULH [ebx+(0*6+i)*4],[mp3_out2_b&i],
  3281                                                                          ; -,-,-,-,0,[ebp+(i+6)*4],-
  3282 0000224C 035330                                  add     edx, [ebx+48]
  3283 0000224F 8917                                    mov     [edi], edx
  3284 00002251 A1[8C220500]                            mov     eax, [mp3_out2_b0]
  3285 00002256 8B5518                                  mov     edx, [ebp+18h]
  3286 00002259 F7EA                                    imul    edx
  3287 0000225B 8913                                    mov     [ebx], edx
  3288 0000225D A1[84220500]                            mov     eax, [mp3_out2_a1] ; i = 1
  3289 00002262 8B5504                                  mov     edx, [ebp+4]
  3290 00002265 F7EA                                    imul    edx
  3291 00002267 035334                                  add     edx, [ebx+52]
  3292 0000226A 899780000000                            mov     [edi+128], edx
  3293 00002270 A1[90220500]                            mov     eax, [mp3_out2_b1]
  3294 00002275 8B551C                                  mov     edx, [ebp+28]
  3295 00002278 F7EA                                    imul    edx
  3296 0000227A 895304                                  mov     [ebx+4], edx
  3297 0000227D A1[88220500]                            mov     eax, [mp3_out2_a2] ; i = 2
  3298 00002282 8B5508                                  mov     edx, [ebp+8]
  3299 00002285 F7EA                                    imul    edx
  3300 00002287 035338                                  add     edx, [ebx+56]
  3301 0000228A 899700010000                            mov     [edi+256], edx
  3302 00002290 A1[94220500]                            mov     eax, [mp3_out2_b2]
  3303 00002295 8B5520                                  mov     edx, [ebp+32]
  3304 00002298 F7EA                                    imul    edx
  3305 0000229A 895308                                  mov     [ebx+8], edx
  3306 0000229D A1[88220500]                            mov     eax, [mp3_out2_a2] ; i = 3
  3307 000022A2 8B550C                                  mov     edx, [ebp+12]
  3308 000022A5 F7EA                                    imul    edx
  3309 000022A7 03533C                                  add     edx, [ebx+60]
  3310 000022AA 899780010000                            mov     [edi+384], edx
  3311 000022B0 A1[94220500]                            mov     eax, [mp3_out2_b2]
  3312 000022B5 8B5524                                  mov     edx, [ebp+36]
  3313 000022B8 F7EA                                    imul    edx
  3314 000022BA 89530C                                  mov     [ebx+12], edx
  3315 000022BD A1[84220500]                            mov     eax, [mp3_out2_a1] ; i = 4
  3316 000022C2 8B5510                                  mov     edx, [ebp+16]
  3317 000022C5 F7EA                                    imul    edx
  3318 000022C7 035340                                  add     edx, [ebx+64]
  3319 000022CA 899700020000                            mov     [edi+512], edx
  3320 000022D0 A1[90220500]                            mov     eax, [mp3_out2_b1]
  3321 000022D5 8B5528                                  mov     edx, [ebp+40]
  3322 000022D8 F7EA                                    imul    edx
  3323 000022DA 895310                                  mov     [ebx+16], edx
  3324 000022DD A1[80220500]                            mov     eax, [mp3_out2_a0] ; i = 5
  3325 000022E2 8B5514                                  mov     edx, [ebp+20]
  3326 000022E5 F7EA                                    imul    edx
  3327 000022E7 035344                                  add     edx, [ebx+68]
  3328 000022EA 899780020000                            mov     [edi+640], edx
  3329 000022F0 A1[8C220500]                            mov     eax, [mp3_out2_b0]
  3330 000022F5 8B552C                                  mov     edx, [ebp+44]
  3331 000022F8 F7EA                                    imul    edx
  3332 000022FA 895314                                  mov     [ebx+20], edx   ; ENDM
  3333 000022FD 83C604                                  add     esi, 4
  3334 00002300 E8A1FBFFFF                              call    mp3_imdct12
  3335 00002305 A1[80220500]                            mov     eax, [mp3_out2_a0] ; IRP i,0,1,2,3,4,5
  3336 0000230A 8B5500                                  mov     edx, [ebp+0]    ; @@MULH [ebx+(0*6+i)*4],[mp3_out2_a&i],
  3337                                                                          ; -,-,-,-,0,[ebp+(i+0)*4],[ebx+(0*6+i)*4]
  3338 0000230D F7EA                                    imul    edx
  3339 0000230F 0313                                    add     edx, [ebx]
  3340 00002311 8913                                    mov     [ebx], edx
  3341 00002313 A1[8C220500]                            mov     eax, [mp3_out2_b0] ; @@MULH [ebx+(1*6+i)*4],[mp3_out2_b&i],
  3342                                                                          ; -,-,-,-,0,[ebp+(i+6)*4],-
  3343 00002318 8B5518                                  mov     edx, [ebp+24]
  3344 0000231B F7EA                                    imul    edx
  3345 0000231D 895318                                  mov     [ebx+24], edx
  3346 00002320 C7433000000000                          mov     dword [ebx+48], 0 ; [ebx+(2*6+i)*4]
  3347 00002327 A1[84220500]                            mov     eax, [mp3_out2_a1] ; i = 1
  3348 0000232C 8B5504                                  mov     edx, [ebp+4]
  3349 0000232F F7EA                                    imul    edx
  3350 00002331 035304                                  add     edx, [ebx+4]
  3351 00002334 895304                                  mov     [ebx+4], edx
  3352 00002337 A1[90220500]                            mov     eax, [mp3_out2_b1]
  3353 0000233C 8B551C                                  mov     edx, [ebp+28]
  3354 0000233F F7EA                                    imul    edx
  3355 00002341 89531C                                  mov     [ebx+28], edx
  3356 00002344 C7433400000000                          mov     dword [ebx+52], 0 ; [ebx+(2*6+i)*4]
  3357 0000234B A1[88220500]                            mov     eax, [mp3_out2_a2] ; i = 2
  3358 00002350 8B5508                                  mov     edx, [ebp+8]
  3359 00002353 F7EA                                    imul    edx
  3360 00002355 035308                                  add     edx, [ebx+8]
  3361 00002358 895308                                  mov     [ebx+8], edx
  3362 0000235B A1[94220500]                            mov     eax, [mp3_out2_b2]
  3363 00002360 8B5520                                  mov     edx, [ebp+32]
  3364 00002363 F7EA                                    imul    edx
  3365 00002365 895320                                  mov     [ebx+32], edx
  3366 00002368 C7433800000000                          mov     dword [ebx+56], 0
  3367 0000236F A1[88220500]                            mov     eax, [mp3_out2_a2] ; i = 3
  3368 00002374 8B550C                                  mov     edx, [ebp+12]
  3369 00002377 F7EA                                    imul    edx
  3370 00002379 03530C                                  add     edx, [ebx+0Ch]
  3371 0000237C 89530C                                  mov     [ebx+12], edx
  3372 0000237F A1[94220500]                            mov     eax, [mp3_out2_b2]
  3373 00002384 8B5524                                  mov     edx, [ebp+36]
  3374 00002387 F7EA                                    imul    edx
  3375 00002389 895324                                  mov     [ebx+36], edx
  3376 0000238C C7433C00000000                          mov     dword [ebx+60], 0 ; [ebx+(2*6+i)*4]
  3377 00002393 A1[84220500]                            mov     eax, [mp3_out2_a1] ; i = 4
  3378 00002398 8B5510                                  mov     edx, [ebp+16]
  3379 0000239B F7EA                                    imul    edx
  3380 0000239D 035310                                  add     edx, [ebx+16]
  3381 000023A0 895310                                  mov     [ebx+16], edx
  3382 000023A3 A1[90220500]                            mov     eax, [mp3_out2_b1]
  3383 000023A8 8B5528                                  mov     edx, [ebp+40]
  3384 000023AB F7EA                                    imul    edx
  3385 000023AD 895328                                  mov     [ebx+40], edx
  3386 000023B0 C7434000000000                          mov     dword [ebx+64], 0
  3387 000023B7 A1[80220500]                            mov     eax, [mp3_out2_a0] ; i = 5
  3388 000023BC 8B5514                                  mov     edx, [ebp+20]
  3389 000023BF F7EA                                    imul    edx
  3390 000023C1 035314                                  add     edx, [ebx+20]
  3391 000023C4 895314                                  mov     [ebx+20], edx
  3392 000023C7 A1[8C220500]                            mov     eax, [mp3_out2_b0]
  3393 000023CC 8B552C                                  mov     edx, [ebp+44]
  3394 000023CF F7EA                                    imul    edx
  3395 000023D1 89532C                                  mov     [ebx+44], edx
  3396 000023D4 C7434400000000                          mov     dword [ebx+68], 0 ; [ebx+(2*6+i)*4]
  3397 000023DB 81C704FAFFFF                            add     edi, -1532      ; (1*4) - (2*6*SBLIMIT*4) ; dst
  3398 000023E1 83C640                                  add     esi, 64         ; 18*4 - (2*4) ; sb_hybrid
  3399 000023E4 83C348                                  add     ebx, 72         ; 18*4 ; mdct_buf
  3400 000023E7 FF05[A0220500]                          inc     dword [_@@@JJJ]	; next
  3401 000023ED A1[A0220500]                            mov     eax, [_@@@JJJ]
  3402 000023F2 3B05[AC220500]                          cmp     eax, [_@@sblimit]
  3403 000023F8 0F8229FDFFFF                            jb      .imdct12_lop
  3404                                  
  3405                                  .imdct12_done:
  3406 000023FE F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
  3407 00002405 740E                                    jz      short .no_rdtsc_supported@@@@ ; timelog_end rdtsc_imdct12
  3408 00002407 0F31                                    rdtsc
  3409 00002409 0105[94700000]                          add     [rdtsc_imdct12], eax
  3410 0000240F 1115[98700000]                          adc     [rdtsc_imdct12+4], edx
  3411                                  
  3412                                  .no_rdtsc_supported@@@@:
  3413 00002415 F605[4C6F0000]10                        test    byte [cpuid_flags], 10h ; timelog_start rdtsc_imdct0
  3414 0000241C 740E                                    jz      short .no_rdtsc_supported@@@@@
  3415 0000241E 0F31                                    rdtsc
  3416 00002420 2905[AC700000]                          sub     [rdtsc_imdct0], eax
  3417 00002426 1915[B0700000]                          sbb     [rdtsc_imdct0+4], edx
  3418                                  
  3419                                  .no_rdtsc_supported@@@@@:
  3420 0000242C 833D[A0220500]20                        cmp     dword [_@@@JJJ], 32 ; SBLIMIT
  3421 00002433 0F8333010000                            jnb     .zero_outer_done
  3422                                  
  3423                                  .zero_outer_lop:
  3424 00002439 8B03                                    mov     eax, [ebx]      ; zero bands
  3425                                                                          ; IRP nn,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17
  3426                                                                          ;  mov  eax,dword ptr [ebx+nn*4]
  3427                                                                          ;  mov  dword ptr [ebx+nn*4],0
  3428                                                                          ;  mov  dword ptr [edi+nn*SBLIMIT*4],eax ; [dst]
  3429                                                                          ; ENDM
  3430 0000243B C70300000000                            mov     dword [ebx], 0 ; nn = 0
  3431 00002441 8907                                    mov     [edi], eax
  3432 00002443 8B4304                                  mov     eax, [ebx+4]    ; nn = 1
  3433 00002446 C7430400000000                          mov     dword [ebx+4], 0
  3434 0000244D 898780000000                            mov     [edi+128], eax
  3435 00002453 8B4308                                  mov     eax, [ebx+8]
  3436 00002456 C7430800000000                          mov     dword [ebx+8], 0
  3437 0000245D 898700010000                            mov     [edi+256], eax
  3438 00002463 8B430C                                  mov     eax, [ebx+12]
  3439 00002466 C7430C00000000                          mov     dword [ebx+12], 0
  3440 0000246D 898780010000                            mov     [edi+384], eax
  3441 00002473 8B4310                                  mov     eax, [ebx+16]   ; nn = 4
  3442 00002476 C7431000000000                          mov     dword [ebx+16], 0
  3443 0000247D 898700020000                            mov     [edi+512], eax
  3444 00002483 8B4314                                  mov     eax, [ebx+20]
  3445 00002486 C7431400000000                          mov     dword [ebx+20], 0
  3446 0000248D 898780020000                            mov     [edi+640], eax  ; [edi+5*SBLIMIT*4]
  3447 00002493 8B4318                                  mov     eax, [ebx+24]
  3448 00002496 C7431800000000                          mov     dword [ebx+24], 0
  3449 0000249D 898700030000                            mov     [edi+768], eax
  3450 000024A3 8B431C                                  mov     eax, [ebx+28]   ; nn = 7
  3451 000024A6 C7431C00000000                          mov     dword [ebx+28], 0
  3452 000024AD 898780030000                            mov     [edi+896], eax
  3453 000024B3 8B4320                                  mov     eax, [ebx+32]
  3454 000024B6 C7432000000000                          mov     dword [ebx+32], 0
  3455 000024BD 898700040000                            mov     [edi+1024], eax ; [edi+8*SBLIMIT*4]
  3456 000024C3 8B4324                                  mov     eax, [ebx+36]
  3457 000024C6 C7432400000000                          mov     dword [ebx+36], 0
  3458 000024CD 898780040000                            mov     [edi+1152], eax
  3459 000024D3 8B4328                                  mov     eax, [ebx+40]
  3460 000024D6 C7432800000000                          mov     dword [ebx+40], 0
  3461 000024DD 898700050000                            mov     [edi+1280], eax
  3462 000024E3 8B432C                                  mov     eax, [ebx+44]
  3463 000024E6 C7432C00000000                          mov     dword [ebx+44], 0
  3464 000024ED 898780050000                            mov     [edi+1408], eax
  3465 000024F3 8B4330                                  mov     eax, [ebx+48]
  3466 000024F6 C7433000000000                          mov     dword [ebx+48], 0
  3467 000024FD 898700060000                            mov     [edi+1536], eax
  3468 00002503 8B4334                                  mov     eax, [ebx+52]
  3469 00002506 C7433400000000                          mov     dword [ebx+52], 0
  3470 0000250D 898780060000                            mov     [edi+1664], eax
  3471 00002513 8B4338                                  mov     eax, [ebx+56]
  3472 00002516 C7433800000000                          mov     dword [ebx+56], 0
  3473 0000251D 898700070000                            mov     [edi+1792], eax
  3474 00002523 8B433C                                  mov     eax, [ebx+60]
  3475 00002526 C7433C00000000                          mov     dword [ebx+60], 0
  3476 0000252D 898780070000                            mov     [edi+1920], eax
  3477 00002533 8B4340                                  mov     eax, [ebx+64]
  3478 00002536 C7434000000000                          mov     dword [ebx+64], 0 ; [edi+16*SBLIMIT*4]
  3479 0000253D 898700080000                            mov     [edi+2048], eax
  3480 00002543 8B4344                                  mov     eax, [ebx+68]   ; nn = 17
  3481 00002546 C7434400000000                          mov     dword [ebx+68], 0
  3482 0000254D 898780080000                            mov     [edi+2176], eax ; ENDM
  3483 00002553 83C348                                  add     ebx, 72         ; 18*4
  3484 00002556 83C704                                  add     edi, 4
  3485 00002559 FF05[A0220500]                          inc     dword [_@@@JJJ]
  3486 0000255F 833D[A0220500]20                        cmp     dword [_@@@JJJ], 32
  3487 00002566 0F82CDFEFFFF                            jb      .zero_outer_lop
  3488                                  
  3489                                  .zero_outer_done:
  3490 0000256C F605[4C6F0000]10                        test    byte [cpuid_flags], 10h ; timelog_end rdtsc_imdct0
  3491 00002573 740E                                    jz      short .no_rdtsc_supported@@@@@@
  3492 00002575 0F31                                    rdtsc
  3493 00002577 0105[AC700000]                          add     [rdtsc_imdct0], eax
  3494 0000257D 1115[B0700000]                          adc     [rdtsc_imdct0+4], edx
  3495                                  
  3496                                  .no_rdtsc_supported@@@@@@:
  3497 00002583 5B                                      pop     ebx
  3498 00002584 F605[4C6F0000]10                        test    byte [cpuid_flags], 10h ; timelog_end rdtsc_imdct
  3499 0000258B 740E                                    jz      short .no_rdtsc_supported@@@@@@@
  3500 0000258D 0F31                                    rdtsc
  3501 0000258F 0105[64700000]                          add     [rdtsc_imdct], eax
  3502 00002595 1115[68700000]                          adc     [rdtsc_imdct+4], edx
  3503                                  
  3504                                  .no_rdtsc_supported@@@@@@@:
  3505 0000259B C3                                      retn
  3506                                  
  3507                                  
  3508                                  ; =============== S U B R O U T I N E =======================================
  3509                                  
  3510                                  
  3511                                  mp3_dct32_shift_0:
  3512 0000259C 8B06                                    mov     eax, [esi]      ; mp3_dct32_macro macro rate_shift ; rate_shift = 0
  3513 0000259E 8B567C                                  mov     edx, [esi+124]  ; @@BF macro a,b,sign,cos,shift
  3514                                                                          ; @@BF 0,31,+,COS0_0,1
  3515                                                                          ; @@need_a equ (rate_shift EQ 0) or (a LT 16) ; a = 0
  3516                                                                          ; @@need_b equ (rate_shift EQ 0) or (b LT 16) ; b = 31
  3517                                                                          ; IF @@need_a AND @@need_b ; rate_shift = 0
  3518                                                                          ;    mov eax,dword ptr [esi+a*4]
  3519                                                                          ;    mov edx,dword ptr [esi+b*4]
  3520                                                                          ;    add dword ptr [esi+a*4],edx
  3521 000025A1 0116                                    add     [esi], edx
  3522 000025A3 29D0                                    sub     eax, edx
  3523 000025A5 D1E0                                    shl     eax, 1          ; shl  eax,shift
  3524                                                                          ; (needed when COS.fraction is less than 32bit)
  3525 000025A7 BA51C21340                              mov     edx, 4013C251h  ; sign&&cos ; +COS0_0 = 4013C251h
  3526 000025AC F7EA                                    imul    edx
  3527 000025AE 89567C                                  mov     [esi+124], edx  ; [esi+b*4] ; upper 32bit of multiply result
  3528 000025B1 8B463C                                  mov     eax, [esi+60]   ; @@BF 15,16,+,COS0_15,5
  3529                                                                          ; [esi+a*4]
  3530 000025B4 8B5640                                  mov     edx, [esi+64]   ; [esi+b*4]
  3531 000025B7 01563C                                  add     [esi+60], edx   ; [esi+a*4]
  3532 000025BA 29D0                                    sub     eax, edx
  3533 000025BC C1E005                                  shl     eax, 5          ; shl eax,shift
  3534 000025BF BAFB228551                              mov     edx, 518522FBh  ; sign&&cos ; +COS0_15 = 518522FBh
  3535 000025C4 F7EA                                    imul    edx
  3536 000025C6 895640                                  mov     [esi+64], edx   ; [esi+b*4]
  3537 000025C9 8B06                                    mov     eax, [esi]      ; @@BF 0,15,+,COS1_0,1
  3538 000025CB 8B563C                                  mov     edx, [esi+60]
  3539 000025CE 0116                                    add     [esi], edx
  3540 000025D0 29D0                                    sub     eax, edx
  3541 000025D2 D1E0                                    shl     eax, 1
  3542 000025D4 BA72464F40                              mov     edx, 404F4672h  ; +COS1_0
  3543 000025D9 F7EA                                    imul    edx
  3544 000025DB 89563C                                  mov     [esi+60], edx
  3545 000025DE 8B4640                                  mov     eax, [esi+64]   ; @@BF 16,31,-,COS1_0,1
  3546 000025E1 8B567C                                  mov     edx, [esi+124]
  3547 000025E4 015640                                  add     [esi+64], edx
  3548 000025E7 29D0                                    sub     eax, edx
  3549 000025E9 D1E0                                    shl     eax, 1
  3550 000025EB BA8EB9B0BF                              mov     edx, 0BFB0B98Eh ; -COS1_0
  3551 000025F0 F7EA                                    imul    edx
  3552 000025F2 89567C                                  mov     [esi+124], edx
  3553 000025F5 8B461C                                  mov     eax, [esi+28]   ; @@BF 7,24,+,COS0_7,1
  3554 000025F8 8B5660                                  mov     edx, [esi+96]
  3555 000025FB 01561C                                  add     [esi+28], edx
  3556 000025FE 29D0                                    sub     eax, edx
  3557 00002600 D1E0                                    shl     eax, 1
  3558 00002602 BAA71E6056                              mov     edx, 56601EA7h
  3559 00002607 F7EA                                    imul    edx
  3560 00002609 895660                                  mov     [esi+96], edx
  3561 0000260C 8B4620                                  mov     eax, [esi+32]   ; @@BF 8,23,+,COS0_8,1
  3562 0000260F 8B565C                                  mov     edx, [esi+92]
  3563 00002612 015620                                  add     [esi+32], edx
  3564 00002615 29D0                                    sub     eax, edx
  3565 00002617 D1E0                                    shl     eax, 1
  3566 00002619 BAECF64C5F                              mov     edx, 5F4CF6ECh
  3567 0000261E F7EA                                    imul    edx
  3568 00002620 89565C                                  mov     [esi+92], edx
  3569 00002623 8B461C                                  mov     eax, [esi+28]   ; @@BF 7,8,+,COS1_7,4
  3570 00002626 8B5620                                  mov     edx, [esi+32]
  3571 00002629 01561C                                  add     [esi+28], edx
  3572 0000262C 29D0                                    sub     eax, edx
  3573 0000262E C1E004                                  shl     eax, 4
  3574 00002631 BA044E9E51                              mov     edx, 519E4E04h
  3575 00002636 F7EA                                    imul    edx
  3576 00002638 895620                                  mov     [esi+32], edx
  3577 0000263B 8B465C                                  mov     eax, [esi+92]   ; @@BF 23,24,-,COS1_7,4
  3578 0000263E 8B5660                                  mov     edx, [esi+96]
  3579 00002641 01565C                                  add     [esi+92], edx
  3580 00002644 29D0                                    sub     eax, edx
  3581 00002646 C1E004                                  shl     eax, 4
  3582 00002649 BAFCB161AE                              mov     edx, 0AE61B1FCh
  3583 0000264E F7EA                                    imul    edx
  3584 00002650 895660                                  mov     [esi+96], edx
  3585 00002653 8B06                                    mov     eax, [esi]      ; @@BF 0,7,+,COS2_0,1
  3586 00002655 8B561C                                  mov     edx, [esi+28]
  3587 00002658 0116                                    add     [esi], edx
  3588 0000265A 29D0                                    sub     eax, edx
  3589 0000265C D1E0                                    shl     eax, 1
  3590 0000265E BA46FB4041                              mov     edx, 4140FB46h
  3591 00002663 F7EA                                    imul    edx
  3592 00002665 89561C                                  mov     [esi+28], edx
  3593 00002668 8B4620                                  mov     eax, [esi+32]   ; @@BF 8,15,-,COS2_0,1
  3594 0000266B 8B563C                                  mov     edx, [esi+60]
  3595 0000266E 015620                                  add     [esi+32], edx
  3596 00002671 29D0                                    sub     eax, edx
  3597 00002673 D1E0                                    shl     eax, 1
  3598 00002675 BABA04BFBE                              mov     edx, 0BEBF04BAh
  3599 0000267A F7EA                                    imul    edx
  3600 0000267C 89563C                                  mov     [esi+60], edx
  3601 0000267F 8B4640                                  mov     eax, [esi+64]   ; @@BF 16,23,+,COS2_0,1
  3602 00002682 8B565C                                  mov     edx, [esi+92]
  3603 00002685 015640                                  add     [esi+40h], edx
  3604 00002688 29D0                                    sub     eax, edx
  3605 0000268A D1E0                                    shl     eax, 1
  3606 0000268C BA46FB4041                              mov     edx, 4140FB46h
  3607 00002691 F7EA                                    imul    edx
  3608 00002693 89565C                                  mov     [esi+92], edx
  3609 00002696 8B4660                                  mov     eax, [esi+96]   ; @@BF 24,31,-,COS2_0,1
  3610 00002699 8B567C                                  mov     edx, [esi+124]
  3611 0000269C 015660                                  add     [esi+96], edx
  3612 0000269F 29D0                                    sub     eax, edx
  3613 000026A1 D1E0                                    shl     eax, 1
  3614 000026A3 BABA04BFBE                              mov     edx, 0BEBF04BAh
  3615 000026A8 F7EA                                    imul    edx
  3616 000026AA 89567C                                  mov     [esi+124], edx
  3617 000026AD 8B460C                                  mov     eax, [esi+12]   ; @@BF 3,28,+,COS0_3,1
  3618 000026B0 8B5670                                  mov     edx, [esi+112]
  3619 000026B3 01560C                                  add     [esi+12], edx
  3620 000026B6 29D0                                    sub     eax, edx
  3621 000026B8 D1E0                                    shl     eax, 1
  3622 000026BA BA2134F943                              mov     edx, 43F93421h
  3623 000026BF F7EA                                    imul    edx
  3624 000026C1 895670                                  mov     [esi+112], edx
  3625 000026C4 8B4630                                  mov     eax, [esi+48]   ; @@BF 12,19,+,COS0_12,2
  3626 000026C7 8B564C                                  mov     edx, [esi+76]
  3627 000026CA 015630                                  add     [esi+48], edx
  3628 000026CD 29D0                                    sub     eax, edx
  3629 000026CF C1E002                                  shl     eax, 2
  3630 000026D2 BA978DFC5E                              mov     edx, 5EFC8D97h
  3631 000026D7 F7EA                                    imul    edx
  3632 000026D9 89564C                                  mov     [esi+76], edx
  3633 000026DC 8B460C                                  mov     eax, [esi+12]   ; @@BF 3,12,+,COS1_3,1
  3634 000026DF 8B5630                                  mov     edx, [esi+48]
  3635 000026E2 01560C                                  add     [esi+12], edx
  3636 000026E5 29D0                                    sub     eax, edx
  3637 000026E7 D1E0                                    shl     eax, 1
  3638 000026E9 BA630ECB52                              mov     edx, 52CB0E63h
  3639 000026EE F7EA                                    imul    edx
  3640 000026F0 895630                                  mov     [esi+48], edx
  3641 000026F3 8B464C                                  mov     eax, [esi+76]   ; @@BF 19,28,-,COS1_3,1
  3642 000026F6 8B5670                                  mov     edx, [esi+112]
  3643 000026F9 01564C                                  add     [esi+76], edx
  3644 000026FC 29D0                                    sub     eax, edx
  3645 000026FE D1E0                                    shl     eax, 1
  3646 00002700 BA9DF134AD                              mov     edx, 0AD34F19Dh
  3647 00002705 F7EA                                    imul    edx
  3648 00002707 895670                                  mov     [esi+112], edx
  3649 0000270A 8B4610                                  mov     eax, [esi+16]   ; @@BF 4,27,+,COS0_4,1
  3650 0000270D 8B566C                                  mov     edx, [esi+108]
  3651 00002710 015610                                  add     [esi+16], edx
  3652 00002713 29D0                                    sub     eax, edx
  3653 00002715 D1E0                                    shl     eax, 1
  3654 00002717 BAC51BCC46                              mov     edx, 46CC1BC5h
  3655 0000271C F7EA                                    imul    edx
  3656 0000271E 89566C                                  mov     [esi+108], edx
  3657 00002721 8B462C                                  mov     eax, [esi+44]   ; @@BF 11,20,+,COS0_11,2
  3658 00002724 8B5650                                  mov     edx, [esi+80]
  3659 00002727 01562C                                  add     [esi+44], edx
  3660 0000272A 29D0                                    sub     eax, edx
  3661 0000272C C1E002                                  shl     eax, 2
  3662 0000272F BA981AD84A                              mov     edx, 4AD81A98h
  3663 00002734 F7EA                                    imul    edx
  3664 00002736 895650                                  mov     [esi+80], edx
  3665 00002739 8B4610                                  mov     eax, [esi+16]   ; @@BF 4,11,+,COS1_4,1
  3666 0000273C 8B562C                                  mov     edx, [esi+44]
  3667 0000273F 015610                                  add     [esi+16], edx
  3668 00002742 29D0                                    sub     eax, edx
  3669 00002744 D1E0                                    shl     eax, 1
  3670 00002746 BA2E40E264                              mov     edx, 64E2402Eh
  3671 0000274B F7EA                                    imul    edx
  3672 0000274D 89562C                                  mov     [esi+44], edx
  3673 00002750 8B4650                                  mov     eax, [esi+80]   ; @@BF 20,27,-,COS1_4,1
  3674 00002753 8B566C                                  mov     edx, [esi+108]
  3675 00002756 015650                                  add     [esi+80], edx
  3676 00002759 29D0                                    sub     eax, edx
  3677 0000275B D1E0                                    shl     eax, 1
  3678 0000275D BAD2BF1D9B                              mov     edx, 9B1DBFD2h
  3679 00002762 F7EA                                    imul    edx
  3680 00002764 89566C                                  mov     [esi+108], edx
  3681 00002767 8B460C                                  mov     eax, [esi+12]   ; @@BF 3,4,+,COS2_3,3
  3682 0000276A 8B5610                                  mov     edx, [esi+16]
  3683 0000276D 01560C                                  add     [esi+12], edx
  3684 00002770 29D0                                    sub     eax, edx
  3685 00002772 C1E003                                  shl     eax, 3
  3686 00002775 BA42670352                              mov     edx, 52036742h
  3687 0000277A F7EA                                    imul    edx
  3688 0000277C 895610                                  mov     [esi+16], edx
  3689 0000277F 8B462C                                  mov     eax, [esi+44]   ; @@BF 11,12,-,COS2_3,3
  3690 00002782 8B5630                                  mov     edx, [esi+48]
  3691 00002785 01562C                                  add     [esi+44], edx
  3692 00002788 29D0                                    sub     eax, edx
  3693 0000278A C1E003                                  shl     eax, 3
  3694 0000278D BABE98FCAD                              mov     edx, 0ADFC98BEh ; -COS2_3
  3695 00002792 F7EA                                    imul    edx
  3696 00002794 895630                                  mov     [esi+48], edx
  3697 00002797 8B464C                                  mov     eax, [esi+76]   ; @@BF 19,20,+,COS2_3,3
  3698 0000279A 8B5650                                  mov     edx, [esi+80]
  3699 0000279D 01564C                                  add     [esi+4Ch], edx
  3700 000027A0 29D0                                    sub     eax, edx
  3701 000027A2 C1E003                                  shl     eax, 3
  3702 000027A5 BA42670352                              mov     edx, 52036742h  ; +COS2_3
  3703 000027AA F7EA                                    imul    edx
  3704 000027AC 895650                                  mov     [esi+80], edx
  3705 000027AF 8B466C                                  mov     eax, [esi+108]  ; @@BF 27,28,-,COS2_3,3
  3706 000027B2 8B5670                                  mov     edx, [esi+112]
  3707 000027B5 01566C                                  add     [esi+108], edx
  3708 000027B8 29D0                                    sub     eax, edx
  3709 000027BA C1E003                                  shl     eax, 3
  3710 000027BD BABE98FCAD                              mov     edx, 0ADFC98BEh
  3711 000027C2 F7EA                                    imul    edx
  3712 000027C4 895670                                  mov     [esi+112], edx
  3713 000027C7 8B06                                    mov     eax, [esi]      ; @@BF 0,3,+,COS3_0,1
  3714 000027C9 8B560C                                  mov     edx, [esi+12]
  3715 000027CC 0116                                    add     [esi], edx
  3716 000027CE 29D0                                    sub     eax, edx
  3717 000027D0 D1E0                                    shl     eax, 1
  3718 000027D2 BAF0E94545                              mov     edx, 4545E9F0h
  3719 000027D7 F7EA                                    imul    edx
  3720 000027D9 89560C                                  mov     [esi+12], edx
  3721 000027DC 8B4610                                  mov     eax, [esi+16]   ; @@BF 4,7,-,COS3_0,1
  3722 000027DF 8B561C                                  mov     edx, [esi+28]
  3723 000027E2 015610                                  add     [esi+16], edx
  3724 000027E5 29D0                                    sub     eax, edx
  3725 000027E7 D1E0                                    shl     eax, 1
  3726 000027E9 BA1016BABA                              mov     edx, 0BABA1610h
  3727 000027EE F7EA                                    imul    edx
  3728 000027F0 89561C                                  mov     [esi+28], edx
  3729 000027F3 8B4620                                  mov     eax, [esi+32]   ; @@BF 8,11,+,COS3_0,1
  3730 000027F6 8B562C                                  mov     edx, [esi+44]
  3731 000027F9 015620                                  add     [esi+32], edx
  3732 000027FC 29D0                                    sub     eax, edx
  3733 000027FE D1E0                                    shl     eax, 1
  3734 00002800 BAF0E94545                              mov     edx, 4545E9F0h
  3735 00002805 F7EA                                    imul    edx
  3736 00002807 89562C                                  mov     [esi+44], edx
  3737 0000280A 8B4630                                  mov     eax, [esi+48]   ; @@BF 12,15,-,COS3_0,1
  3738 0000280D 8B563C                                  mov     edx, [esi+60]
  3739 00002810 015630                                  add     [esi+48], edx
  3740 00002813 29D0                                    sub     eax, edx
  3741 00002815 D1E0                                    shl     eax, 1
  3742 00002817 BA1016BABA                              mov     edx, 0BABA1610h
  3743 0000281C F7EA                                    imul    edx
  3744 0000281E 89563C                                  mov     [esi+60], edx
  3745 00002821 8B4640                                  mov     eax, [esi+64]   ; @@BF 16,19,+,COS3_0,1
  3746 00002824 8B564C                                  mov     edx, [esi+76]
  3747 00002827 015640                                  add     [esi+64], edx
  3748 0000282A 29D0                                    sub     eax, edx
  3749 0000282C D1E0                                    shl     eax, 1
  3750 0000282E BAF0E94545                              mov     edx, 4545E9F0h
  3751 00002833 F7EA                                    imul    edx
  3752 00002835 89564C                                  mov     [esi+76], edx
  3753 00002838 8B4650                                  mov     eax, [esi+80]   ; @@BF 20,23,-,COS3_0,1
  3754 0000283B 8B565C                                  mov     edx, [esi+92]
  3755 0000283E 015650                                  add     [esi+80], edx
  3756 00002841 29D0                                    sub     eax, edx
  3757 00002843 D1E0                                    shl     eax, 1
  3758 00002845 BA1016BABA                              mov     edx, 0BABA1610h ; -COS3_0
  3759 0000284A F7EA                                    imul    edx
  3760 0000284C 89565C                                  mov     [esi+92], edx
  3761 0000284F 8B4660                                  mov     eax, [esi+96]   ; @@BF 24,27,+,COS3_0,1
  3762 00002852 8B566C                                  mov     edx, [esi+108]
  3763 00002855 015660                                  add     [esi+96], edx
  3764 00002858 29D0                                    sub     eax, edx
  3765 0000285A D1E0                                    shl     eax, 1
  3766 0000285C BAF0E94545                              mov     edx, 4545E9F0h  ; +COS3_0
  3767 00002861 F7EA                                    imul    edx
  3768 00002863 89566C                                  mov     [esi+108], edx
  3769 00002866 8B4670                                  mov     eax, [esi+112]  ; @@BF 28,31,-,COS3_0,1
  3770 00002869 8B567C                                  mov     edx, [esi+124]
  3771 0000286C 015670                                  add     [esi+112], edx
  3772 0000286F 29D0                                    sub     eax, edx
  3773 00002871 D1E0                                    shl     eax, 1
  3774 00002873 BA1016BABA                              mov     edx, 0BABA1610h
  3775 00002878 F7EA                                    imul    edx
  3776 0000287A 89567C                                  mov     [esi+124], edx
  3777 0000287D 8B4604                                  mov     eax, [esi+4]    ; @@BF 1,30,+,COS0_1,1
  3778 00002880 8B5678                                  mov     edx, [esi+120]
  3779 00002883 015604                                  add     [esi+4], edx
  3780 00002886 29D0                                    sub     eax, edx
  3781 00002888 D1E0                                    shl     eax, 1
  3782 0000288A BABD45B340                              mov     edx, 40B345BDh
  3783 0000288F F7EA                                    imul    edx
  3784 00002891 895678                                  mov     [esi+120], edx
  3785 00002894 8B4638                                  mov     eax, [esi+56]   ; @@BF 14,17,+,COS0_14,3
  3786 00002897 8B5644                                  mov     edx, [esi+68]
  3787 0000289A 015638                                  add     [esi+56], edx
  3788 0000289D 29D0                                    sub     eax, edx
  3789 0000289F C1E003                                  shl     eax, 3
  3790 000028A2 BAD0200B6D                              mov     edx, 6D0B20D0h
  3791 000028A7 F7EA                                    imul    edx
  3792 000028A9 895644                                  mov     [esi+68], edx
  3793 000028AC 8B4604                                  mov     eax, [esi+4]    ; @@BF 1,14,+,COS1_1,1
  3794 000028AF 8B5638                                  mov     edx, [esi+56]
  3795 000028B2 015604                                  add     [esi+4], edx
  3796 000028B5 29D0                                    sub     eax, edx
  3797 000028B7 D1E0                                    shl     eax, 1
  3798 000028B9 BA103CE142                              mov     edx, 42E13C10h
  3799 000028BE F7EA                                    imul    edx
  3800 000028C0 895638                                  mov     [esi+56], edx
  3801 000028C3 8B4644                                  mov     eax, [esi+68]   ; @@BF 17,30,-,COS1_1,1
  3802 000028C6 8B5678                                  mov     edx, [esi+120]
  3803 000028C9 015644                                  add     [esi+68], edx
  3804 000028CC 29D0                                    sub     eax, edx
  3805 000028CE D1E0                                    shl     eax, 1
  3806 000028D0 BAF0C31EBD                              mov     edx, 0BD1EC3F0h
  3807 000028D5 F7EA                                    imul    edx
  3808 000028D7 895678                                  mov     [esi+120], edx
  3809 000028DA 8B4618                                  mov     eax, [esi+24]   ; @@BF 6,25,+,COS0_6,1
  3810 000028DD 8B5664                                  mov     edx, [esi+100]
  3811 000028E0 015618                                  add     [esi+24], edx
  3812 000028E3 29D0                                    sub     eax, edx
  3813 000028E5 D1E0                                    shl     eax, 1
  3814 000028E7 BA1237AE4F                              mov     edx, 4FAE3712h
  3815 000028EC F7EA                                    imul    edx
  3816 000028EE 895664                                  mov     [esi+100], edx
  3817 000028F1 8B4624                                  mov     eax, [esi+36]   ; @@BF 9,22,+,COS0_9,1
  3818 000028F4 8B5658                                  mov     edx, [esi+88]
  3819 000028F7 015624                                  add     [esi+36], edx
  3820 000028FA 29D0                                    sub     eax, edx
  3821 000028FC D1E0                                    shl     eax, 1
  3822 000028FE BA27CF6F6B                              mov     edx, 6B6FCF27h
  3823 00002903 F7EA                                    imul    edx
  3824 00002905 895658                                  mov     [esi+88], edx
  3825 00002908 8B4618                                  mov     eax, [esi+24]   ; @@BF 6, 9,+,COS1_6,2
  3826 0000290B 8B5624                                  mov     edx, [esi+36]
  3827 0000290E 015618                                  add     [esi+24], edx
  3828 00002911 29D0                                    sub     eax, edx
  3829 00002913 C1E002                                  shl     eax, 2
  3830 00002916 BAC2923C6E                              mov     edx, 6E3C92C2h
  3831 0000291B F7EA                                    imul    edx
  3832 0000291D 895624                                  mov     [esi+36], edx
  3833 00002920 8B4658                                  mov     eax, [esi+88]   ; @@BF 22,25,-,COS1_6,2
  3834 00002923 8B5664                                  mov     edx, [esi+100]
  3835 00002926 015658                                  add     [esi+88], edx
  3836 00002929 29D0                                    sub     eax, edx
  3837 0000292B C1E002                                  shl     eax, 2
  3838 0000292E BA3E6DC391                              mov     edx, 91C36D3Eh
  3839 00002933 F7EA                                    imul    edx
  3840 00002935 895664                                  mov     [esi+100], edx
  3841 00002938 8B4604                                  mov     eax, [esi+4]    ; @@BF 1, 6,+,COS2_1,1
  3842 0000293B 8B5618                                  mov     edx, [esi+24]
  3843 0000293E 015604                                  add     [esi+4], edx
  3844 00002941 29D0                                    sub     eax, edx
  3845 00002943 D1E0                                    shl     eax, 1
  3846 00002945 BA88DEF84C                              mov     edx, 4CF8DE88h
  3847 0000294A F7EA                                    imul    edx
  3848 0000294C 895618                                  mov     [esi+24], edx
  3849 0000294F 8B4624                                  mov     eax, [esi+36]   ; @@BF 9,14,-,COS2_1,1
  3850 00002952 8B5638                                  mov     edx, [esi+56]
  3851 00002955 015624                                  add     [esi+36], edx
  3852 00002958 29D0                                    sub     eax, edx
  3853 0000295A D1E0                                    shl     eax, 1
  3854 0000295C BA782107B3                              mov     edx, 0B3072178h
  3855 00002961 F7EA                                    imul    edx
  3856 00002963 895638                                  mov     [esi+56], edx
  3857 00002966 8B4644                                  mov     eax, [esi+68]   ; @@BF 17,22,+,COS2_1,1
  3858 00002969 8B5658                                  mov     edx, [esi+88]
  3859 0000296C 015644                                  add     [esi+68], edx
  3860 0000296F 29D0                                    sub     eax, edx
  3861 00002971 D1E0                                    shl     eax, 1
  3862 00002973 BA88DEF84C                              mov     edx, 4CF8DE88h
  3863 00002978 F7EA                                    imul    edx
  3864 0000297A 895658                                  mov     [esi+88], edx
  3865 0000297D 8B4664                                  mov     eax, [esi+100]  ; @@BF 25,30,-,COS2_1,1
  3866 00002980 8B5678                                  mov     edx, [esi+120]
  3867 00002983 015664                                  add     [esi+100], edx
  3868 00002986 29D0                                    sub     eax, edx
  3869 00002988 D1E0                                    shl     eax, 1
  3870 0000298A BA782107B3                              mov     edx, 0B3072178h
  3871 0000298F F7EA                                    imul    edx
  3872 00002991 895678                                  mov     [esi+120], edx
  3873 00002994 8B4608                                  mov     eax, [esi+8]    ; @@BF 2,29,+,COS0_2,1
  3874 00002997 8B5674                                  mov     edx, [esi+116]
  3875 0000299A 015608                                  add     [esi+8], edx
  3876 0000299D 29D0                                    sub     eax, edx
  3877 0000299F D1E0                                    shl     eax, 1
  3878 000029A1 BA6E2DFA41                              mov     edx, 41FA2D6Eh
  3879 000029A6 F7EA                                    imul    edx
  3880 000029A8 895674                                  mov     [esi+116], edx
  3881 000029AB 8B4634                                  mov     eax, [esi+52]   ; @@BF 13,18,+,COS0_13,3
  3882 000029AE 8B5648                                  mov     edx, [esi+72]
  3883 000029B1 015634                                  add     [esi+52], edx
  3884 000029B4 29D0                                    sub     eax, edx
  3885 000029B6 C1E003                                  shl     eax, 3
  3886 000029B9 BA9057D941                              mov     edx, 41D95790h
  3887 000029BE F7EA                                    imul    edx
  3888 000029C0 895648                                  mov     [esi+72], edx
  3889 000029C3 8B4608                                  mov     eax, [esi+8]    ; @@BF 2,13,+,COS1_2,1
  3890 000029C6 8B5634                                  mov     edx, [esi+52]
  3891 000029C9 015608                                  add     [esi+8], edx
  3892 000029CC 29D0                                    sub     eax, edx
  3893 000029CE D1E0                                    shl     eax, 1
  3894 000029D0 BA459F9148                              mov     edx, 48919F45h
  3895 000029D5 F7EA                                    imul    edx
  3896 000029D7 895634                                  mov     [esi+52], edx
  3897 000029DA 8B4648                                  mov     eax, [esi+72]   ; @@BF 18,29,-,COS1_2,1
  3898 000029DD 8B5674                                  mov     edx, [esi+116]
  3899 000029E0 015648                                  add     [esi+72], edx
  3900 000029E3 29D0                                    sub     eax, edx
  3901 000029E5 D1E0                                    shl     eax, 1
  3902 000029E7 BABB606EB7                              mov     edx, 0B76E60BBh
  3903 000029EC F7EA                                    imul    edx
  3904 000029EE 895674                                  mov     [esi+116], edx
  3905 000029F1 8B4614                                  mov     eax, [esi+20]   ; @@BF 5,26,+,COS0_5,1
  3906 000029F4 8B5668                                  mov     edx, [esi+104]
  3907 000029F7 015614                                  add     [esi+20], edx
  3908 000029FA 29D0                                    sub     eax, edx
  3909 000029FC D1E0                                    shl     eax, 1
  3910 000029FE BAF19C9D4A                              mov     edx, 4A9D9CF1h
  3911 00002A03 F7EA                                    imul    edx
  3912 00002A05 895668                                  mov     [esi+104], edx
  3913 00002A08 8B4628                                  mov     eax, [esi+40]   ; @@BF 10,21,+,COS0_10,1
  3914 00002A0B 8B5654                                  mov     edx, [esi+84]
  3915 00002A0E 015628                                  add     [esi+40], edx
  3916 00002A11 29D0                                    sub     eax, edx
  3917 00002A13 D1E0                                    shl     eax, 1
  3918 00002A15 BAB41D7D7C                              mov     edx, 7C7D1DB4h
  3919 00002A1A F7EA                                    imul    edx
  3920 00002A1C 895654                                  mov     [esi+84], edx
  3921 00002A1F 8B4614                                  mov     eax, [esi+20]   ; @@BF 5,10,+,COS1_5,2
  3922 00002A22 8B5628                                  mov     edx, [esi+40]
  3923 00002A25 015614                                  add     [esi+20], edx
  3924 00002A28 29D0                                    sub     eax, edx
  3925 00002A2A C1E002                                  shl     eax, 2
  3926 00002A2D BAAA24E243                              mov     edx, 43E224AAh
  3927 00002A32 F7EA                                    imul    edx
  3928 00002A34 895628                                  mov     [esi+40], edx
  3929 00002A37 8B4654                                  mov     eax, [esi+84]   ; @@BF 21,26,-,COS1_5,2
  3930 00002A3A 8B5668                                  mov     edx, [esi+104]
  3931 00002A3D 015654                                  add     [esi+84], edx
  3932 00002A40 29D0                                    sub     eax, edx
  3933 00002A42 C1E002                                  shl     eax, 2
  3934 00002A45 BA56DB1DBC                              mov     edx, 0BC1DDB56h
  3935 00002A4A F7EA                                    imul    edx
  3936 00002A4C 895668                                  mov     [esi+104], edx
  3937 00002A4F 8B4608                                  mov     eax, [esi+8]    ; @@BF 2,5,+,COS2_2,1
  3938 00002A52 8B5614                                  mov     edx, [esi+20]
  3939 00002A55 015608                                  add     [esi+8], edx
  3940 00002A58 29D0                                    sub     eax, edx
  3941 00002A5A D1E0                                    shl     eax, 1
  3942 00002A5C BABF6B3273                              mov     edx, 73326BBFh  ; +COS2_2
  3943 00002A61 F7EA                                    imul    edx
  3944 00002A63 895614                                  mov     [esi+20], edx
  3945 00002A66 8B4628                                  mov     eax, [esi+40]   ; @@BF 10,13,-,COS2_2,1
  3946 00002A69 8B5634                                  mov     edx, [esi+52]
  3947 00002A6C 015628                                  add     [esi+40], edx
  3948 00002A6F 29D0                                    sub     eax, edx
  3949 00002A71 D1E0                                    shl     eax, 1
  3950 00002A73 BA4194CD8C                              mov     edx, 8CCD9441h  ; -COS2_2
  3951 00002A78 F7EA                                    imul    edx
  3952 00002A7A 895634                                  mov     [esi+52], edx
  3953 00002A7D 8B4648                                  mov     eax, [esi+72]   ; @@BF 18,21,+,COS2_2,1
  3954 00002A80 8B5654                                  mov     edx, [esi+84]
  3955 00002A83 015648                                  add     [esi+72], edx
  3956 00002A86 29D0                                    sub     eax, edx
  3957 00002A88 D1E0                                    shl     eax, 1
  3958 00002A8A BABF6B3273                              mov     edx, 73326BBFh
  3959 00002A8F F7EA                                    imul    edx
  3960 00002A91 895654                                  mov     [esi+84], edx
  3961 00002A94 8B4668                                  mov     eax, [esi+104]  ; @@BF 26,29,-,COS2_2,1
  3962 00002A97 8B5674                                  mov     edx, [esi+116]
  3963 00002A9A 015668                                  add     [esi+104], edx
  3964 00002A9D 29D0                                    sub     eax, edx
  3965 00002A9F D1E0                                    shl     eax, 1
  3966 00002AA1 BA4194CD8C                              mov     edx, 8CCD9441h
  3967 00002AA6 F7EA                                    imul    edx
  3968 00002AA8 895674                                  mov     [esi+116], edx
  3969 00002AAB 8B4604                                  mov     eax, [esi+4]    ; @@BF 1,2,+,COS3_1,2
  3970 00002AAE 8B5608                                  mov     edx, [esi+8]
  3971 00002AB1 015604                                  add     [esi+4], edx
  3972 00002AB4 29D0                                    sub     eax, edx
  3973 00002AB6 C1E002                                  shl     eax, 2
  3974 00002AB9 BA46BA9E53                              mov     edx, 539EBA46h
  3975 00002ABE F7EA                                    imul    edx
  3976 00002AC0 895608                                  mov     [esi+8], edx
  3977 00002AC3 8B4614                                  mov     eax, [esi+20]   ; @@BF 5,6,-,COS3_1,2
  3978 00002AC6 8B5618                                  mov     edx, [esi+24]
  3979 00002AC9 015614                                  add     [esi+20], edx
  3980 00002ACC 29D0                                    sub     eax, edx
  3981 00002ACE C1E002                                  shl     eax, 2
  3982 00002AD1 BABA4561AC                              mov     edx, 0AC6145BAh
  3983 00002AD6 F7EA                                    imul    edx
  3984 00002AD8 895618                                  mov     [esi+24], edx
  3985 00002ADB 8B4624                                  mov     eax, [esi+36]   ; IF rate_shift LT 2
  3986                                                                          ; @@BF 9,10,+,COS3_1,2
  3987 00002ADE 8B5628                                  mov     edx, [esi+40]
  3988 00002AE1 015624                                  add     [esi+36], edx
  3989 00002AE4 29D0                                    sub     eax, edx
  3990 00002AE6 C1E002                                  shl     eax, 2
  3991 00002AE9 BA46BA9E53                              mov     edx, 539EBA46h
  3992 00002AEE F7EA                                    imul    edx
  3993 00002AF0 895628                                  mov     [esi+40], edx
  3994 00002AF3 8B4634                                  mov     eax, [esi+52]   ; @@BF 13,14,-,COS3_1,2
  3995 00002AF6 8B5638                                  mov     edx, [esi+56]
  3996 00002AF9 015634                                  add     [esi+52], edx
  3997 00002AFC 29D0                                    sub     eax, edx
  3998 00002AFE C1E002                                  shl     eax, 2
  3999 00002B01 BABA4561AC                              mov     edx, 0AC6145BAh
  4000 00002B06 F7EA                                    imul    edx
  4001 00002B08 895638                                  mov     [esi+56], edx   ; ENDIF
  4002 00002B0B 8B4644                                  mov     eax, [esi+68]   ; @@BF 17,18,+,COS3_1,2
  4003 00002B0E 8B5648                                  mov     edx, [esi+72]
  4004 00002B11 015644                                  add     [esi+68], edx
  4005 00002B14 29D0                                    sub     eax, edx
  4006 00002B16 C1E002                                  shl     eax, 2
  4007 00002B19 BA46BA9E53                              mov     edx, 539EBA46h
  4008 00002B1E F7EA                                    imul    edx
  4009 00002B20 895648                                  mov     [esi+72], edx
  4010 00002B23 8B4654                                  mov     eax, [esi+84]   ; @@BF 21,22,-,COS3_1,2
  4011 00002B26 8B5658                                  mov     edx, [esi+88]
  4012 00002B29 015654                                  add     [esi+84], edx
  4013 00002B2C 29D0                                    sub     eax, edx
  4014 00002B2E C1E002                                  shl     eax, 2
  4015 00002B31 BABA4561AC                              mov     edx, 0AC6145BAh
  4016 00002B36 F7EA                                    imul    edx
  4017 00002B38 895658                                  mov     [esi+88], edx
  4018 00002B3B 8B4664                                  mov     eax, [esi+100]  ; @@BF 25,26,+,COS3_1,2
  4019 00002B3E 8B5668                                  mov     edx, [esi+104]
  4020 00002B41 015664                                  add     [esi+100], edx
  4021 00002B44 29D0                                    sub     eax, edx
  4022 00002B46 C1E002                                  shl     eax, 2
  4023 00002B49 BA46BA9E53                              mov     edx, 539EBA46h
  4024 00002B4E F7EA                                    imul    edx
  4025 00002B50 895668                                  mov     [esi+104], edx
  4026 00002B53 8B4674                                  mov     eax, [esi+116]  ; @@BF 29,30,-,COS3_1,2
  4027 00002B56 8B5678                                  mov     edx, [esi+120]
  4028 00002B59 015674                                  add     [esi+116], edx
  4029 00002B5C 29D0                                    sub     eax, edx
  4030 00002B5E C1E002                                  shl     eax, 2
  4031 00002B61 BABA4561AC                              mov     edx, 0AC6145BAh
  4032 00002B66 F7EA                                    imul    edx
  4033 00002B68 895678                                  mov     [esi+120], edx
  4034 00002B6B 8B06                                    mov     eax, [esi]      ; @@BF1 macro a, b, c, d
  4035                                                                          ;   @@BF  a, b,+,COS4_0, 1
  4036                                                                          ;   @@BF  c, d,-,COS4_0, 1
  4037                                                                          ;   @@ADD c, d
  4038                                                                          ;  endm
  4039                                                                          ; @@BF1 0,1,2,3
  4040 00002B6D 8B5604                                  mov     edx, [esi+4]    ; @@BF 0,1,+,COS4_0,1
  4041 00002B70 0116                                    add     [esi], edx
  4042 00002B72 29D0                                    sub     eax, edx
  4043 00002B74 D1E0                                    shl     eax, 1
  4044 00002B76 BA9A79825A                              mov     edx, 5A82799Ah  ; +COS4_0
  4045 00002B7B F7EA                                    imul    edx
  4046 00002B7D 895604                                  mov     [esi+4], edx
  4047 00002B80 8B4608                                  mov     eax, [esi+8]    ; @@BF 2,3,-,COS4_0,1
  4048 00002B83 8B560C                                  mov     edx, [esi+12]
  4049 00002B86 015608                                  add     [esi+8], edx
  4050 00002B89 29D0                                    sub     eax, edx
  4051 00002B8B D1E0                                    shl     eax, 1
  4052 00002B8D BA66867DA5                              mov     edx, 0A57D8666h ; -COS4_0
  4053 00002B92 F7EA                                    imul    edx
  4054 00002B94 89560C                                  mov     [esi+12], edx
  4055 00002B97 8B460C                                  mov     eax, [esi+12]   ; @@ADD 2,3
  4056 00002B9A 014608                                  add     [esi+8], eax
  4057 00002B9D 8B4610                                  mov     eax, [esi+16]   ; @@BF2 macro a, b, c, d
  4058                                                                          ;   @@BF  a, b,+,COS4_0, 1
  4059                                                                          ;   @@BF  c, d,-,COS4_0, 1
  4060                                                                          ;   @@ADD c, d
  4061                                                                          ;   @@ADD a, c
  4062                                                                          ;   @@ADD c, b
  4063                                                                          ;   @@ADD b, d
  4064                                                                          ;  endm
  4065                                                                          ; @@BF2 4,5,6,7
  4066 00002BA0 8B5614                                  mov     edx, [esi+20]   ; @@BF 4,5,+,COS4_0,1
  4067 00002BA3 015610                                  add     [esi+16], edx
  4068 00002BA6 29D0                                    sub     eax, edx
  4069 00002BA8 D1E0                                    shl     eax, 1
  4070 00002BAA BA9A79825A                              mov     edx, 5A82799Ah
  4071 00002BAF F7EA                                    imul    edx
  4072 00002BB1 895614                                  mov     [esi+20], edx
  4073 00002BB4 8B4618                                  mov     eax, [esi+24]   ; @@BF 6,7,-,COS4_0,1
  4074 00002BB7 8B561C                                  mov     edx, [esi+28]
  4075 00002BBA 015618                                  add     [esi+24], edx
  4076 00002BBD 29D0                                    sub     eax, edx
  4077 00002BBF D1E0                                    shl     eax, 1
  4078 00002BC1 BA66867DA5                              mov     edx, 0A57D8666h
  4079 00002BC6 F7EA                                    imul    edx
  4080 00002BC8 89561C                                  mov     [esi+28], edx
  4081 00002BCB 8B461C                                  mov     eax, [esi+28]   ; @@ADD macro dst,src
  4082                                                                          ;   IF (rate_shift EQ 0) or (dst LT 16)
  4083                                                                          ;    ;tab[a] += tab[b]
  4084                                                                          ;    mov  eax,dword ptr [esi+src*4]
  4085                                                                          ;    add  dword ptr [esi+dst*4],eax
  4086                                                                          ;   ENDIF
  4087                                                                          ;  endm
  4088                                                                          ; @@ADD 6,7
  4089 00002BCE 014618                                  add     [esi+24], eax
  4090 00002BD1 8B4618                                  mov     eax, [esi+24]   ; @@ADD 4,6
  4091 00002BD4 014610                                  add     [esi+16], eax
  4092 00002BD7 8B4614                                  mov     eax, [esi+20]   ; @@ADD 6,5
  4093 00002BDA 014618                                  add     [esi+24], eax
  4094 00002BDD 8B461C                                  mov     eax, [esi+28]   ; @@ADD 5,7
  4095 00002BE0 014614                                  add     [esi+20], eax
  4096 00002BE3 8B4620                                  mov     eax, [esi+32]   ; IF rate_shift LT 2
  4097                                                                          ; @@BF1 8,9,10,11
  4098 00002BE6 8B5624                                  mov     edx, [esi+36]   ; @@BF 8,9,+,COS4_0,1
  4099 00002BE9 015620                                  add     [esi+32], edx
  4100 00002BEC 29D0                                    sub     eax, edx
  4101 00002BEE D1E0                                    shl     eax, 1
  4102 00002BF0 BA9A79825A                              mov     edx, 5A82799Ah
  4103 00002BF5 F7EA                                    imul    edx
  4104 00002BF7 895624                                  mov     [esi+36], edx
  4105 00002BFA 8B4628                                  mov     eax, [esi+40]   ; @@BF 10,11,-,COS4_0,1
  4106 00002BFD 8B562C                                  mov     edx, [esi+44]
  4107 00002C00 015628                                  add     [esi+40], edx
  4108 00002C03 29D0                                    sub     eax, edx
  4109 00002C05 D1E0                                    shl     eax, 1
  4110 00002C07 BA66867DA5                              mov     edx, 0A57D8666h
  4111 00002C0C F7EA                                    imul    edx
  4112 00002C0E 89562C                                  mov     [esi+44], edx
  4113 00002C11 8B462C                                  mov     eax, [esi+44]   ; @@ADD 10,11
  4114 00002C14 014628                                  add     [esi+40], eax
  4115 00002C17 8B4630                                  mov     eax, [esi+48]   ; @@BF2 12,13,14,15
  4116 00002C1A 8B5634                                  mov     edx, [esi+52]   ; @@BF 12,13,+,COS4_0,1
  4117 00002C1D 015630                                  add     [esi+48], edx
  4118 00002C20 29D0                                    sub     eax, edx
  4119 00002C22 D1E0                                    shl     eax, 1
  4120 00002C24 BA9A79825A                              mov     edx, 5A82799Ah
  4121 00002C29 F7EA                                    imul    edx
  4122 00002C2B 895634                                  mov     [esi+52], edx
  4123 00002C2E 8B4638                                  mov     eax, [esi+56]   ; @@BF 14,15,-,COS4_0,1
  4124 00002C31 8B563C                                  mov     edx, [esi+60]
  4125 00002C34 015638                                  add     [esi+56], edx
  4126 00002C37 29D0                                    sub     eax, edx
  4127 00002C39 D1E0                                    shl     eax, 1
  4128 00002C3B BA66867DA5                              mov     edx, 0A57D8666h
  4129 00002C40 F7EA                                    imul    edx
  4130 00002C42 89563C                                  mov     [esi+60], edx
  4131 00002C45 8B463C                                  mov     eax, [esi+60]   ; @@ADD 14,15
  4132 00002C48 014638                                  add     [esi+56], eax
  4133 00002C4B 8B4638                                  mov     eax, [esi+56]   ; @@ADD 12,14
  4134 00002C4E 014630                                  add     [esi+48], eax
  4135 00002C51 8B4634                                  mov     eax, [esi+52]   ; @@ADD 14,13
  4136 00002C54 014638                                  add     [esi+56], eax
  4137 00002C57 8B463C                                  mov     eax, [esi+60]   ; @@ADD 13,15
  4138 00002C5A 014634                                  add     [esi+52], eax   ; ENDIF
  4139 00002C5D 8B4640                                  mov     eax, [esi+64]   ; @@BF1 16,17,18,19
  4140 00002C60 8B5644                                  mov     edx, [esi+68]
  4141 00002C63 015640                                  add     [esi+64], edx
  4142 00002C66 29D0                                    sub     eax, edx
  4143 00002C68 D1E0                                    shl     eax, 1
  4144 00002C6A BA9A79825A                              mov     edx, 5A82799Ah  ; +COS4_0
  4145 00002C6F F7EA                                    imul    edx
  4146 00002C71 895644                                  mov     [esi+68], edx
  4147 00002C74 8B4648                                  mov     eax, [esi+72]
  4148 00002C77 8B564C                                  mov     edx, [esi+76]
  4149 00002C7A 015648                                  add     [esi+72], edx
  4150 00002C7D 29D0                                    sub     eax, edx
  4151 00002C7F D1E0                                    shl     eax, 1
  4152 00002C81 BA66867DA5                              mov     edx, 0A57D8666h ; -COS4_0
  4153 00002C86 F7EA                                    imul    edx
  4154 00002C88 89564C                                  mov     [esi+76], edx
  4155 00002C8B 8B464C                                  mov     eax, [esi+76]   ; @@ADD 18,19
  4156 00002C8E 014648                                  add     [esi+72], eax
  4157 00002C91 8B4650                                  mov     eax, [esi+80]   ; @@BF2 20,21,22,23
  4158 00002C94 8B5654                                  mov     edx, [esi+84]
  4159 00002C97 015650                                  add     [esi+80], edx
  4160 00002C9A 29D0                                    sub     eax, edx
  4161 00002C9C D1E0                                    shl     eax, 1
  4162 00002C9E BA9A79825A                              mov     edx, 5A82799Ah
  4163 00002CA3 F7EA                                    imul    edx
  4164 00002CA5 895654                                  mov     [esi+84], edx
  4165 00002CA8 8B4658                                  mov     eax, [esi+88]
  4166 00002CAB 8B565C                                  mov     edx, [esi+92]
  4167 00002CAE 015658                                  add     [esi+88], edx
  4168 00002CB1 29D0                                    sub     eax, edx
  4169 00002CB3 D1E0                                    shl     eax, 1
  4170 00002CB5 BA66867DA5                              mov     edx, 0A57D8666h
  4171 00002CBA F7EA                                    imul    edx
  4172 00002CBC 89565C                                  mov     [esi+92], edx
  4173 00002CBF 8B465C                                  mov     eax, [esi+92]   ; @@ADD 22,23
  4174 00002CC2 014658                                  add     [esi+88], eax
  4175 00002CC5 8B4658                                  mov     eax, [esi+88]   ; @@ADD 20,22
  4176 00002CC8 014650                                  add     [esi+80], eax
  4177 00002CCB 8B4654                                  mov     eax, [esi+84]
  4178 00002CCE 014658                                  add     [esi+88], eax
  4179 00002CD1 8B465C                                  mov     eax, [esi+92]
  4180 00002CD4 014654                                  add     [esi+84], eax
  4181 00002CD7 8B4660                                  mov     eax, [esi+96]   ; @@BF1 24,25,26,27
  4182 00002CDA 8B5664                                  mov     edx, [esi+100]
  4183 00002CDD 015660                                  add     [esi+96], edx
  4184 00002CE0 29D0                                    sub     eax, edx
  4185 00002CE2 D1E0                                    shl     eax, 1
  4186 00002CE4 BA9A79825A                              mov     edx, 5A82799Ah
  4187 00002CE9 F7EA                                    imul    edx
  4188 00002CEB 895664                                  mov     [esi+100], edx
  4189 00002CEE 8B4668                                  mov     eax, [esi+104]
  4190 00002CF1 8B566C                                  mov     edx, [esi+108]
  4191 00002CF4 015668                                  add     [esi+104], edx
  4192 00002CF7 29D0                                    sub     eax, edx
  4193 00002CF9 D1E0                                    shl     eax, 1
  4194 00002CFB BA66867DA5                              mov     edx, 0A57D8666h
  4195 00002D00 F7EA                                    imul    edx
  4196 00002D02 89566C                                  mov     [esi+108], edx
  4197 00002D05 8B466C                                  mov     eax, [esi+108]
  4198 00002D08 014668                                  add     [esi+104], eax
  4199 00002D0B 8B4670                                  mov     eax, [esi+112]  ; @@BF2 28,29,30,31
  4200 00002D0E 8B5674                                  mov     edx, [esi+116]
  4201 00002D11 015670                                  add     [esi+112], edx
  4202 00002D14 29D0                                    sub     eax, edx
  4203 00002D16 D1E0                                    shl     eax, 1
  4204 00002D18 BA9A79825A                              mov     edx, 5A82799Ah
  4205 00002D1D F7EA                                    imul    edx
  4206 00002D1F 895674                                  mov     [esi+116], edx
  4207 00002D22 8B4678                                  mov     eax, [esi+120]
  4208 00002D25 8B567C                                  mov     edx, [esi+124]
  4209 00002D28 015678                                  add     [esi+120], edx
  4210 00002D2B 29D0                                    sub     eax, edx
  4211 00002D2D D1E0                                    shl     eax, 1
  4212 00002D2F BA66867DA5                              mov     edx, 0A57D8666h
  4213 00002D34 F7EA                                    imul    edx
  4214 00002D36 89567C                                  mov     [esi+124], edx
  4215 00002D39 8B467C                                  mov     eax, [esi+124]
  4216 00002D3C 014678                                  add     [esi+120], eax
  4217 00002D3F 8B4678                                  mov     eax, [esi+120]
  4218 00002D42 014670                                  add     [esi+112], eax
  4219 00002D45 8B4674                                  mov     eax, [esi+116]
  4220 00002D48 014678                                  add     [esi+120], eax
  4221 00002D4B 8B467C                                  mov     eax, [esi+124]
  4222 00002D4E 014674                                  add     [esi+116], eax
  4223 00002D51 8B06                                    mov     eax, [esi]      ; @@OUT macro dst,src1,src2
  4224                                                                          ; IF ((dst AND ((1 SHL rate_shift)-1)) EQ 0)
  4225                                                                          ;    mov eax,dword ptr [esi+src1*4]
  4226                                                                          ;    IFDIFI <src2>,<->
  4227                                                                          ;      add eax,dword ptr [esi+src2*4]
  4228                                                                          ;    ENDIF
  4229                                                                          ;    IF SYNTH32
  4230                                                                          ;       mov dword ptr [edi+dst*4],eax
  4231                                                                          ;       IF (LONG_WINDOW EQ 0)
  4232                                                                          ;          mov dword ptr [edi+dst*4+512*4],eax
  4233                                                                          ;       ENDIF
  4234                                                                          ;    ELSE
  4235                                                                          ;        ......
  4236                                                                          ;    ENDIF
  4237                                                                          ; @@OUT 0,0,-
  4238 00002D53 8907                                    mov     [edi], eax      ; mov dword ptr [edi+dst*4],eax
  4239 00002D55 8B4604                                  mov     eax, [esi+4]    ; @@OUT 16,1, -
  4240                                                                          ; mov eax,dword ptr [esi+src1*4]
  4241 00002D58 894740                                  mov     [edi+64], eax   ; mov dword ptr [edi+dst*4],eax
  4242 00002D5B 8B4608                                  mov     eax, [esi+8]    ; @@OUT 8,2,-
  4243 00002D5E 894720                                  mov     [edi+32], eax
  4244 00002D61 8B460C                                  mov     eax, [esi+12]   ; @@OUT 24,3,-
  4245 00002D64 894760                                  mov     [edi+96], eax
  4246 00002D67 8B4610                                  mov     eax, [esi+16]   ; @@OUT 4,4,-
  4247 00002D6A 894710                                  mov     [edi+16], eax
  4248 00002D6D 8B4614                                  mov     eax, [esi+20]   ; @@OUT 20,5,-
  4249 00002D70 894750                                  mov     [edi+80], eax
  4250 00002D73 8B4618                                  mov     eax, [esi+24]   ; @@OUT 12,6,-
  4251 00002D76 894730                                  mov     [edi+48], eax
  4252 00002D79 8B461C                                  mov     eax, [esi+28]   ; @@OUT 28,7,-
  4253 00002D7C 894770                                  mov     [edi+112], eax
  4254 00002D7F 8B4620                                  mov     eax, [esi+32]   ; @@OUT 2,8,12
  4255 00002D82 034630                                  add     eax, [esi+48]   ; add eax,dword ptr [esi+src2*4]
  4256 00002D85 894708                                  mov     [edi+8], eax
  4257 00002D88 8B4624                                  mov     eax, [esi+36]   ; @@OUT 18,9,13
  4258 00002D8B 034634                                  add     eax, [esi+52]   ; add eax,dword ptr [esi+src2*4]
  4259 00002D8E 894748                                  mov     [edi+72], eax
  4260 00002D91 8B4628                                  mov     eax, [esi+40]   ; @@OUT 10,10,14
  4261 00002D94 034638                                  add     eax, [esi+56]
  4262 00002D97 894728                                  mov     [edi+40], eax
  4263 00002D9A 8B462C                                  mov     eax, [esi+44]   ; @@OUT 26,11,15
  4264 00002D9D 03463C                                  add     eax, [esi+60]
  4265 00002DA0 894768                                  mov     [edi+104], eax
  4266 00002DA3 8B4630                                  mov     eax, [esi+48]   ; @@OUT 6,12,10
  4267 00002DA6 034628                                  add     eax, [esi+40]
  4268 00002DA9 894718                                  mov     [edi+24], eax
  4269 00002DAC 8B4634                                  mov     eax, [esi+52]   ; @@OUT 22,13,11
  4270 00002DAF 03462C                                  add     eax, [esi+44]
  4271 00002DB2 894758                                  mov     [edi+88], eax
  4272 00002DB5 8B4638                                  mov     eax, [esi+56]   ; @@OUT 14,14,9
  4273 00002DB8 034624                                  add     eax, [esi+36]
  4274 00002DBB 894738                                  mov     [edi+56], eax
  4275 00002DBE 8B463C                                  mov     eax, [esi+60]   ; @@OUT 30,15,-
  4276 00002DC1 894778                                  mov     [edi+120], eax
  4277 00002DC4 8B4670                                  mov     eax, [esi+112]  ; @@ADD 24,28
  4278 00002DC7 014660                                  add     [esi+96], eax
  4279 00002DCA 8B4668                                  mov     eax, [esi+104]  ; @@ADD 28,26
  4280 00002DCD 014670                                  add     [esi+112], eax
  4281 00002DD0 8B4678                                  mov     eax, [esi+120]  ; @@ADD 26,30
  4282 00002DD3 014668                                  add     [esi+104], eax
  4283 00002DD6 8B4664                                  mov     eax, [esi+100]  ; @@ADD 30,25
  4284 00002DD9 014678                                  add     [esi+120], eax
  4285 00002DDC 8B4674                                  mov     eax, [esi+116]  ; @@ADD 25,29
  4286 00002DDF 014664                                  add     [esi+100], eax
  4287 00002DE2 8B466C                                  mov     eax, [esi+108]  ; @@ADD 29,27
  4288 00002DE5 014674                                  add     [esi+116], eax
  4289 00002DE8 8B467C                                  mov     eax, [esi+124]  ; @@ADD 27,31
  4290 00002DEB 01466C                                  add     [esi+108], eax
  4291 00002DEE 8B4640                                  mov     eax, [esi+64]   ; @@OUT 1,16,24
  4292 00002DF1 034660                                  add     eax, [esi+96]
  4293 00002DF4 894704                                  mov     [edi+4], eax
  4294 00002DF7 8B4644                                  mov     eax, [esi+68]   ; @@OUT 17,17,25
  4295 00002DFA 034664                                  add     eax, [esi+100]
  4296 00002DFD 894744                                  mov     [edi+68], eax
  4297 00002E00 8B4648                                  mov     eax, [esi+72]   ; @@OUT 9,18,26
  4298 00002E03 034668                                  add     eax, [esi+104]
  4299 00002E06 894724                                  mov     [edi+36], eax
  4300 00002E09 8B464C                                  mov     eax, [esi+76]   ; @@OUT 25,19,27
  4301 00002E0C 03466C                                  add     eax, [esi+108]
  4302 00002E0F 894764                                  mov     [edi+100], eax
  4303 00002E12 8B4650                                  mov     eax, [esi+80]   ; @@OUT 5,20,28
  4304 00002E15 034670                                  add     eax, [esi+112]
  4305 00002E18 894714                                  mov     [edi+20], eax
  4306 00002E1B 8B4654                                  mov     eax, [esi+84]   ; @@OUT 21,21,29
  4307 00002E1E 034674                                  add     eax, [esi+116]
  4308 00002E21 894754                                  mov     [edi+84], eax
  4309 00002E24 8B4658                                  mov     eax, [esi+88]   ; @@OUT 13,22,30
  4310 00002E27 034678                                  add     eax, [esi+120]
  4311 00002E2A 894734                                  mov     [edi+52], eax
  4312 00002E2D 8B465C                                  mov     eax, [esi+92]   ; @@OUT 29,23,31
  4313 00002E30 03467C                                  add     eax, [esi+124]
  4314 00002E33 894774                                  mov     [edi+116], eax
  4315 00002E36 8B4660                                  mov     eax, [esi+96]   ; @@OUT 3,24,20
  4316 00002E39 034650                                  add     eax, [esi+80]
  4317 00002E3C 89470C                                  mov     [edi+12], eax
  4318 00002E3F 8B4664                                  mov     eax, [esi+100]  ; @@OUT 19,25,21
  4319 00002E42 034654                                  add     eax, [esi+84]
  4320 00002E45 89474C                                  mov     [edi+76], eax
  4321 00002E48 8B4668                                  mov     eax, [esi+104]  ; @@OUT 11,26,22
  4322 00002E4B 034658                                  add     eax, [esi+88]
  4323 00002E4E 89472C                                  mov     [edi+44], eax
  4324 00002E51 8B466C                                  mov     eax, [esi+108]  ; @@OUT 27,27,23
  4325 00002E54 03465C                                  add     eax, [esi+92]
  4326 00002E57 89476C                                  mov     [edi+108], eax
  4327 00002E5A 8B4670                                  mov     eax, [esi+112]  ; @@OUT 7,28,18
  4328 00002E5D 034648                                  add     eax, [esi+72]
  4329 00002E60 89471C                                  mov     [edi+28], eax
  4330 00002E63 8B4674                                  mov     eax, [esi+116]  ; @@OUT 23,29,19
  4331 00002E66 03464C                                  add     eax, [esi+76]
  4332 00002E69 89475C                                  mov     [edi+92], eax
  4333 00002E6C 8B4678                                  mov     eax, [esi+120]  ; @@OUT 15,30,17
  4334 00002E6F 034644                                  add     eax, [esi+68]
  4335 00002E72 89473C                                  mov     [edi+60], eax
  4336 00002E75 8B467C                                  mov     eax, [esi+124]  ; @@OUT 31,31,-
  4337 00002E78 89477C                                  mov     [edi+124], eax
  4338 00002E7B C3                                      retn
  4339                                  
  4340                                  
  4341                                  ; =============== S U B R O U T I N E =======================================
  4342                                  
  4343                                  
  4344                                  mp3_dct32_shift_1:
  4345 00002E7C 8B467C                                  mov     eax, [esi+124]  ; mp3_dct32_macro macro rate_shift ; rate_shift = 1
  4346 00002E7F 0106                                    add     [esi], eax      ; @@BF macro a,b,sign,cos,shift
  4347                                                                          ; @@need_a equ (rate_shift EQ 0) or (a LT 16) ; a = 0
  4348                                                                          ; @@need_b equ (rate_shift EQ 0) or (b LT 16) ; b = 31
  4349                                                                          ; IF @@need_a AND @@need_b ; rate_shift = 0
  4350                                                                          ;    mov eax,dword ptr [esi+a*4]
  4351                                                                          ;    mov edx,dword ptr [esi+b*4]
  4352                                                                          ;    add dword ptr [esi+a*4],edx
  4353                                                                          ; ELSEIF @@need_a
  4354                                                                          ;    mov eax,dword ptr [esi+b*4]
  4355                                                                          ;    add dword ptr [esi+a*4],eax
  4356                                                                          ;
  4357                                                                          ; @@BF 0,31,+,COS0_0,1
  4358 00002E81 8B4640                                  mov     eax, [esi+64]   ; @@BF 15,16,+,COS0_15,5
  4359 00002E84 01463C                                  add     [esi+60], eax
  4360 00002E87 8B06                                    mov     eax, [esi]      ; @@BF 0,15,+,COS1_0,1
  4361 00002E89 8B563C                                  mov     edx, [esi+60]
  4362 00002E8C 0116                                    add     [esi], edx
  4363 00002E8E 29D0                                    sub     eax, edx
  4364 00002E90 D1E0                                    shl     eax, 1
  4365 00002E92 BA72464F40                              mov     edx, 404F4672h  ; COS1_0
  4366 00002E97 F7EA                                    imul    edx
  4367 00002E99 89563C                                  mov     [esi+60], edx
  4368 00002E9C 8B4660                                  mov     eax, [esi+96]   ; skip @@BF 16,31,-,COS1_0,1
  4369                                                                          ; @@BF 7,24,+,COS0_7,1
  4370 00002E9F 01461C                                  add     [esi+28], eax
  4371 00002EA2 8B465C                                  mov     eax, [esi+92]   ; @@BF 8,23,+,COS0_8,1
  4372 00002EA5 014620                                  add     [esi+32], eax
  4373 00002EA8 8B461C                                  mov     eax, [esi+28]   ; @@BF 7,8,+,COS1_7,4
  4374 00002EAB 8B5620                                  mov     edx, [esi+32]
  4375 00002EAE 01561C                                  add     [esi+28], edx
  4376 00002EB1 29D0                                    sub     eax, edx
  4377 00002EB3 C1E004                                  shl     eax, 4
  4378 00002EB6 BA044E9E51                              mov     edx, 519E4E04h  ; COS1_7
  4379 00002EBB F7EA                                    imul    edx
  4380 00002EBD 895620                                  mov     [esi+32], edx
  4381 00002EC0 8B06                                    mov     eax, [esi]      ; skip @@BF 23,24,-,COS1_7,4
  4382                                                                          ; @@BF 0,7,+,COS2_0,1
  4383 00002EC2 8B561C                                  mov     edx, [esi+28]
  4384 00002EC5 0116                                    add     [esi], edx
  4385 00002EC7 29D0                                    sub     eax, edx
  4386 00002EC9 D1E0                                    shl     eax, 1
  4387 00002ECB BA46FB4041                              mov     edx, 4140FB46h  ; COS2_0
  4388 00002ED0 F7EA                                    imul    edx
  4389 00002ED2 89561C                                  mov     [esi+28], edx
  4390 00002ED5 8B4620                                  mov     eax, [esi+32]   ; @@BF 8,15,-,COS2_0,1
  4391 00002ED8 8B563C                                  mov     edx, [esi+60]
  4392 00002EDB 015620                                  add     [esi+32], edx
  4393 00002EDE 29D0                                    sub     eax, edx
  4394 00002EE0 D1E0                                    shl     eax, 1
  4395 00002EE2 BABA04BFBE                              mov     edx, 0BEBF04BAh ; -COS2_0
  4396 00002EE7 F7EA                                    imul    edx
  4397 00002EE9 89563C                                  mov     [esi+60], edx
  4398 00002EEC 8B4670                                  mov     eax, [esi+112]  ; skip @@BF 16,23,+,COS2_0,1
  4399                                                                          ;      @@BF 24,31,-,COS2_0,1
  4400                                                                          ; @@BF 3,28,+,COS0_3,1
  4401 00002EEF 01460C                                  add     [esi+12], eax
  4402 00002EF2 8B464C                                  mov     eax, [esi+76]   ; @@BF 12,19,+,COS0_12,2
  4403 00002EF5 014630                                  add     [esi+48], eax
  4404 00002EF8 8B460C                                  mov     eax, [esi+12]   ; @@BF 3,12,+,COS1_3,1
  4405 00002EFB 8B5630                                  mov     edx, [esi+48]
  4406 00002EFE 01560C                                  add     [esi+12], edx
  4407 00002F01 29D0                                    sub     eax, edx
  4408 00002F03 D1E0                                    shl     eax, 1
  4409 00002F05 BA630ECB52                              mov     edx, 52CB0E63h
  4410 00002F0A F7EA                                    imul    edx
  4411 00002F0C 895630                                  mov     [esi+48], edx
  4412 00002F0F 8B466C                                  mov     eax, [esi+108]  ; @@BF 4,27,+,COS0_4,1
  4413 00002F12 014610                                  add     [esi+16], eax
  4414 00002F15 8B4650                                  mov     eax, [esi+80]   ; @@BF 11,20,+,COS0_11,2
  4415 00002F18 01462C                                  add     [esi+44], eax
  4416 00002F1B 8B4610                                  mov     eax, [esi+16]   ; @@BF 4,11,+,COS1_4,1
  4417 00002F1E 8B562C                                  mov     edx, [esi+44]
  4418 00002F21 015610                                  add     [esi+16], edx
  4419 00002F24 29D0                                    sub     eax, edx
  4420 00002F26 D1E0                                    shl     eax, 1
  4421 00002F28 BA2E40E264                              mov     edx, 64E2402Eh  ; COS1_4
  4422 00002F2D F7EA                                    imul    edx
  4423 00002F2F 89562C                                  mov     [esi+44], edx
  4424 00002F32 8B460C                                  mov     eax, [esi+12]   ; @@BF 3,4,+,COS2_3,3
  4425 00002F35 8B5610                                  mov     edx, [esi+16]
  4426 00002F38 01560C                                  add     [esi+12], edx
  4427 00002F3B 29D0                                    sub     eax, edx
  4428 00002F3D C1E003                                  shl     eax, 3
  4429 00002F40 BA42670352                              mov     edx, 52036742h
  4430 00002F45 F7EA                                    imul    edx
  4431 00002F47 895610                                  mov     [esi+16], edx
  4432 00002F4A 8B462C                                  mov     eax, [esi+44]   ; @@BF 11,12,-,COS2_3,3
  4433 00002F4D 8B5630                                  mov     edx, [esi+48]
  4434 00002F50 01562C                                  add     [esi+44], edx
  4435 00002F53 29D0                                    sub     eax, edx
  4436 00002F55 C1E003                                  shl     eax, 3
  4437 00002F58 BABE98FCAD                              mov     edx, 0ADFC98BEh ; -COS2_3
  4438 00002F5D F7EA                                    imul    edx
  4439 00002F5F 895630                                  mov     [esi+48], edx
  4440 00002F62 8B06                                    mov     eax, [esi]      ; @@BF 0,3,+,COS3_0,1
  4441 00002F64 8B560C                                  mov     edx, [esi+12]
  4442 00002F67 0116                                    add     [esi], edx
  4443 00002F69 29D0                                    sub     eax, edx
  4444 00002F6B D1E0                                    shl     eax, 1
  4445 00002F6D BAF0E94545                              mov     edx, 4545E9F0h
  4446 00002F72 F7EA                                    imul    edx
  4447 00002F74 89560C                                  mov     [esi+12], edx
  4448 00002F77 8B4610                                  mov     eax, [esi+16]   ; @@BF 4,7,-,COS3_0,1
  4449 00002F7A 8B561C                                  mov     edx, [esi+28]
  4450 00002F7D 015610                                  add     [esi+16], edx
  4451 00002F80 29D0                                    sub     eax, edx
  4452 00002F82 D1E0                                    shl     eax, 1
  4453 00002F84 BA1016BABA                              mov     edx, 0BABA1610h
  4454 00002F89 F7EA                                    imul    edx
  4455 00002F8B 89561C                                  mov     [esi+28], edx
  4456 00002F8E 8B4620                                  mov     eax, [esi+32]   ; @@BF 8,11,+,COS3_0,1
  4457 00002F91 8B562C                                  mov     edx, [esi+44]
  4458 00002F94 015620                                  add     [esi+32], edx
  4459 00002F97 29D0                                    sub     eax, edx
  4460 00002F99 D1E0                                    shl     eax, 1
  4461 00002F9B BAF0E94545                              mov     edx, 4545E9F0h
  4462 00002FA0 F7EA                                    imul    edx
  4463 00002FA2 89562C                                  mov     [esi+44], edx
  4464 00002FA5 8B4630                                  mov     eax, [esi+48]   ; @@BF 12,15,-,COS3_0,1
  4465 00002FA8 8B563C                                  mov     edx, [esi+60]
  4466 00002FAB 015630                                  add     [esi+48], edx
  4467 00002FAE 29D0                                    sub     eax, edx
  4468 00002FB0 D1E0                                    shl     eax, 1
  4469 00002FB2 BA1016BABA                              mov     edx, 0BABA1610h ; -COS3_0
  4470 00002FB7 F7EA                                    imul    edx
  4471 00002FB9 89563C                                  mov     [esi+60], edx
  4472 00002FBC 8B4678                                  mov     eax, [esi+120]  ; @@BF 1,30,+,COS0_1,1
  4473 00002FBF 014604                                  add     [esi+4], eax
  4474 00002FC2 8B4644                                  mov     eax, [esi+68]   ; @@BF 14,17,+,COS0_14,3
  4475 00002FC5 014638                                  add     [esi+56], eax
  4476 00002FC8 8B4604                                  mov     eax, [esi+4]    ; @@BF 1,14,+,COS1_1,1
  4477 00002FCB 8B5638                                  mov     edx, [esi+56]
  4478 00002FCE 015604                                  add     [esi+4], edx
  4479 00002FD1 29D0                                    sub     eax, edx
  4480 00002FD3 D1E0                                    shl     eax, 1
  4481 00002FD5 BA103CE142                              mov     edx, 42E13C10h
  4482 00002FDA F7EA                                    imul    edx
  4483 00002FDC 895638                                  mov     [esi+56], edx
  4484 00002FDF 8B4664                                  mov     eax, [esi+100]  ; @@BF 6,25,+,COS0_6,1
  4485 00002FE2 014618                                  add     [esi+24], eax
  4486 00002FE5 8B4658                                  mov     eax, [esi+88]   ; @@BF 9,22,+,COS0_9,1
  4487 00002FE8 014624                                  add     [esi+36], eax
  4488 00002FEB 8B4618                                  mov     eax, [esi+24]   ; @@BF 6,9,+,COS1_6,2
  4489 00002FEE 8B5624                                  mov     edx, [esi+36]
  4490 00002FF1 015618                                  add     [esi+24], edx
  4491 00002FF4 29D0                                    sub     eax, edx
  4492 00002FF6 C1E002                                  shl     eax, 2
  4493 00002FF9 BAC2923C6E                              mov     edx, 6E3C92C2h  ; +COS1_6
  4494 00002FFE F7EA                                    imul    edx
  4495 00003000 895624                                  mov     [esi+36], edx
  4496 00003003 8B4604                                  mov     eax, [esi+4]    ; @@BF 1,6,+,COS2_1,1
  4497 00003006 8B5618                                  mov     edx, [esi+24]
  4498 00003009 015604                                  add     [esi+4], edx
  4499 0000300C 29D0                                    sub     eax, edx
  4500 0000300E D1E0                                    shl     eax, 1
  4501 00003010 BA88DEF84C                              mov     edx, 4CF8DE88h
  4502 00003015 F7EA                                    imul    edx
  4503 00003017 895618                                  mov     [esi+24], edx
  4504 0000301A 8B4624                                  mov     eax, [esi+36]   ; @@BF 9,14,-,COS2_1,1
  4505 0000301D 8B5638                                  mov     edx, [esi+56]
  4506 00003020 015624                                  add     [esi+36], edx
  4507 00003023 29D0                                    sub     eax, edx
  4508 00003025 D1E0                                    shl     eax, 1
  4509 00003027 BA782107B3                              mov     edx, 0B3072178h ; -COS2_1
  4510 0000302C F7EA                                    imul    edx
  4511 0000302E 895638                                  mov     [esi+56], edx
  4512 00003031 8B4674                                  mov     eax, [esi+116]  ; @@BF 2,29,+,COS0_2,1
  4513 00003034 014608                                  add     [esi+8], eax
  4514 00003037 8B4648                                  mov     eax, [esi+72]   ; @@BF 13,18,+,COS0_13,3
  4515 0000303A 014634                                  add     [esi+52], eax
  4516 0000303D 8B4608                                  mov     eax, [esi+8]    ; @@BF 2,13,+,COS1_2,1
  4517 00003040 8B5634                                  mov     edx, [esi+52]
  4518 00003043 015608                                  add     [esi+8], edx
  4519 00003046 29D0                                    sub     eax, edx
  4520 00003048 D1E0                                    shl     eax, 1
  4521 0000304A BA459F9148                              mov     edx, 48919F45h
  4522 0000304F F7EA                                    imul    edx
  4523 00003051 895634                                  mov     [esi+52], edx
  4524 00003054 8B4668                                  mov     eax, [esi+104]  ; @@BF 5,26,+,COS0_5,1
  4525 00003057 014614                                  add     [esi+20], eax
  4526 0000305A 8B4654                                  mov     eax, [esi+84]   ; @@BF 10,21,+,COS0_10,1
  4527 0000305D 014628                                  add     [esi+40], eax
  4528 00003060 8B4614                                  mov     eax, [esi+20]   ; @@BF 5,10,+,COS1_5,2
  4529 00003063 8B5628                                  mov     edx, [esi+40]
  4530 00003066 015614                                  add     [esi+20], edx
  4531 00003069 29D0                                    sub     eax, edx
  4532 0000306B C1E002                                  shl     eax, 2
  4533 0000306E BAAA24E243                              mov     edx, 43E224AAh
  4534 00003073 F7EA                                    imul    edx
  4535 00003075 895628                                  mov     [esi+40], edx
  4536 00003078 8B4608                                  mov     eax, [esi+8]    ; @@BF 2,5,+,COS2_2,1
  4537 0000307B 8B5614                                  mov     edx, [esi+20]
  4538 0000307E 015608                                  add     [esi+8], edx
  4539 00003081 29D0                                    sub     eax, edx
  4540 00003083 D1E0                                    shl     eax, 1
  4541 00003085 BABF6B3273                              mov     edx, 73326BBFh  ; COS2_2
  4542 0000308A F7EA                                    imul    edx
  4543 0000308C 895614                                  mov     [esi+20], edx
  4544 0000308F 8B4628                                  mov     eax, [esi+40]   ; @@BF 10,13,-,COS2_2,1
  4545 00003092 8B5634                                  mov     edx, [esi+52]
  4546 00003095 015628                                  add     [esi+40], edx
  4547 00003098 29D0                                    sub     eax, edx
  4548 0000309A D1E0                                    shl     eax, 1
  4549 0000309C BA4194CD8C                              mov     edx, 8CCD9441h  ; -COS2_2
  4550 000030A1 F7EA                                    imul    edx
  4551 000030A3 895634                                  mov     [esi+52], edx
  4552 000030A6 8B4604                                  mov     eax, [esi+4]    ; @@BF 1,2,+,COS3_1,2
  4553 000030A9 8B5608                                  mov     edx, [esi+8]
  4554 000030AC 015604                                  add     [esi+4], edx
  4555 000030AF 29D0                                    sub     eax, edx
  4556 000030B1 C1E002                                  shl     eax, 2
  4557 000030B4 BA46BA9E53                              mov     edx, 539EBA46h
  4558 000030B9 F7EA                                    imul    edx
  4559 000030BB 895608                                  mov     [esi+8], edx
  4560 000030BE 8B4614                                  mov     eax, [esi+20]   ; @@BF 5,6,-,COS3_1,2
  4561 000030C1 8B5618                                  mov     edx, [esi+24]
  4562 000030C4 015614                                  add     [esi+20], edx
  4563 000030C7 29D0                                    sub     eax, edx
  4564 000030C9 C1E002                                  shl     eax, 2
  4565 000030CC BABA4561AC                              mov     edx, 0AC6145BAh
  4566 000030D1 F7EA                                    imul    edx
  4567 000030D3 895618                                  mov     [esi+24], edx
  4568 000030D6 8B4624                                  mov     eax, [esi+36]   ; IF rate_shift LT 2
  4569                                                                          ; @@BF 9,10,+,COS3_1,2
  4570 000030D9 8B5628                                  mov     edx, [esi+40]
  4571 000030DC 015624                                  add     [esi+36], edx
  4572 000030DF 29D0                                    sub     eax, edx
  4573 000030E1 C1E002                                  shl     eax, 2
  4574 000030E4 BA46BA9E53                              mov     edx, 539EBA46h  ; +COS3_1
  4575 000030E9 F7EA                                    imul    edx
  4576 000030EB 895628                                  mov     [esi+40], edx
  4577 000030EE 8B4634                                  mov     eax, [esi+52]   ; @@BF 13,14,-,COS3_1,2
  4578 000030F1 8B5638                                  mov     edx, [esi+56]
  4579 000030F4 015634                                  add     [esi+52], edx
  4580 000030F7 29D0                                    sub     eax, edx
  4581 000030F9 C1E002                                  shl     eax, 2
  4582 000030FC BABA4561AC                              mov     edx, 0AC6145BAh ; -COS3_1
  4583 00003101 F7EA                                    imul    edx
  4584 00003103 895638                                  mov     [esi+56], edx   ; ENDIF
  4585 00003106 8B06                                    mov     eax, [esi]      ; @@BF1 macro a, b, c, d
  4586                                                                          ;   @@BF  a, b,+,COS4_0, 1
  4587                                                                          ;   @@BF  c, d,-,COS4_0, 1
  4588                                                                          ;   @@ADD c, d
  4589                                                                          ;  endm
  4590                                                                          ; @@BF1 0,1,2,3
  4591 00003108 8B5604                                  mov     edx, [esi+4]    ; @@BF 0,1,+,COS4_0,1
  4592 0000310B 0116                                    add     [esi], edx
  4593 0000310D 29D0                                    sub     eax, edx
  4594 0000310F D1E0                                    shl     eax, 1
  4595 00003111 BA9A79825A                              mov     edx, 5A82799Ah
  4596 00003116 F7EA                                    imul    edx
  4597 00003118 895604                                  mov     [esi+4], edx
  4598 0000311B 8B4608                                  mov     eax, [esi+8]    ; @@BF 2,3,+,COS4_0,1
  4599 0000311E 8B560C                                  mov     edx, [esi+12]
  4600 00003121 015608                                  add     [esi+8], edx
  4601 00003124 29D0                                    sub     eax, edx
  4602 00003126 D1E0                                    shl     eax, 1
  4603 00003128 BA66867DA5                              mov     edx, 0A57D8666h
  4604 0000312D F7EA                                    imul    edx
  4605 0000312F 89560C                                  mov     [esi+12], edx
  4606 00003132 8B460C                                  mov     eax, [esi+12]   ; @@ADD 2,3
  4607 00003135 014608                                  add     [esi+8], eax
  4608 00003138 8B4610                                  mov     eax, [esi+16]   ; @@BF2 macro a, b, c, d
  4609                                                                          ;   @@BF  a, b,+,COS4_0, 1
  4610                                                                          ;   @@BF  c, d,-,COS4_0, 1
  4611                                                                          ;   @@ADD c, d
  4612                                                                          ;   @@ADD a, c
  4613                                                                          ;   @@ADD c, b
  4614                                                                          ;   @@ADD b, d
  4615                                                                          ;  endm
  4616                                                                          ; @@BF2 4,5,6,7
  4617 0000313B 8B5614                                  mov     edx, [esi+20]   ; @@BF 4,5,+,COS4_0,1
  4618 0000313E 015610                                  add     [esi+16], edx
  4619 00003141 29D0                                    sub     eax, edx
  4620 00003143 D1E0                                    shl     eax, 1
  4621 00003145 BA9A79825A                              mov     edx, 5A82799Ah  ; +COS4_0
  4622 0000314A F7EA                                    imul    edx
  4623 0000314C 895614                                  mov     [esi+20], edx
  4624 0000314F 8B4618                                  mov     eax, [esi+24]   ; @@BF 6,7,-,COS4_0,1
  4625 00003152 8B561C                                  mov     edx, [esi+28]
  4626 00003155 015618                                  add     [esi+24], edx
  4627 00003158 29D0                                    sub     eax, edx
  4628 0000315A D1E0                                    shl     eax, 1
  4629 0000315C BA66867DA5                              mov     edx, 0A57D8666h ; -COS4_0
  4630 00003161 F7EA                                    imul    edx
  4631 00003163 89561C                                  mov     [esi+28], edx
  4632 00003166 8B461C                                  mov     eax, [esi+28]   ; @@ADD macro dst,src
  4633                                                                          ;   IF (rate_shift EQ 0) or (dst LT 16)
  4634                                                                          ;    ;tab[a] += tab[b]
  4635                                                                          ;    mov  eax,dword ptr [esi+src*4]
  4636                                                                          ;    add  dword ptr [esi+dst*4],eax
  4637                                                                          ;   ENDIF
  4638                                                                          ;  endm
  4639                                                                          ; @@ADD 6,7
  4640 00003169 014618                                  add     [esi+24], eax
  4641 0000316C 8B4618                                  mov     eax, [esi+24]   ; @@ADD 4,6
  4642 0000316F 014610                                  add     [esi+16], eax
  4643 00003172 8B4614                                  mov     eax, [esi+20]   ; @@ADD 6,5
  4644 00003175 014618                                  add     [esi+24], eax
  4645 00003178 8B461C                                  mov     eax, [esi+28]   ; @@ADD 5,7
  4646 0000317B 014614                                  add     [esi+20], eax
  4647 0000317E 8B4620                                  mov     eax, [esi+32]   ; IF rate_shift LT 2
  4648                                                                          ; @@BF1 8,9,10,11
  4649 00003181 8B5624                                  mov     edx, [esi+36]
  4650 00003184 015620                                  add     [esi+32], edx
  4651 00003187 29D0                                    sub     eax, edx
  4652 00003189 D1E0                                    shl     eax, 1
  4653 0000318B BA9A79825A                              mov     edx, 5A82799Ah
  4654 00003190 F7EA                                    imul    edx
  4655 00003192 895624                                  mov     [esi+36], edx
  4656 00003195 8B4628                                  mov     eax, [esi+40]
  4657 00003198 8B562C                                  mov     edx, [esi+44]
  4658 0000319B 015628                                  add     [esi+40], edx
  4659 0000319E 29D0                                    sub     eax, edx
  4660 000031A0 D1E0                                    shl     eax, 1
  4661 000031A2 BA66867DA5                              mov     edx, 0A57D8666h
  4662 000031A7 F7EA                                    imul    edx
  4663 000031A9 89562C                                  mov     [esi+44], edx
  4664 000031AC 8B462C                                  mov     eax, [esi+44]
  4665 000031AF 014628                                  add     [esi+40], eax
  4666 000031B2 8B4630                                  mov     eax, [esi+48]   ; @@BF2 12,13,14,15
  4667 000031B5 8B5634                                  mov     edx, [esi+52]
  4668 000031B8 015630                                  add     [esi+48], edx
  4669 000031BB 29D0                                    sub     eax, edx
  4670 000031BD D1E0                                    shl     eax, 1
  4671 000031BF BA9A79825A                              mov     edx, 5A82799Ah
  4672 000031C4 F7EA                                    imul    edx
  4673 000031C6 895634                                  mov     [esi+52], edx
  4674 000031C9 8B4638                                  mov     eax, [esi+56]
  4675 000031CC 8B563C                                  mov     edx, [esi+60]
  4676 000031CF 015638                                  add     [esi+56], edx
  4677 000031D2 29D0                                    sub     eax, edx
  4678 000031D4 D1E0                                    shl     eax, 1
  4679 000031D6 BA66867DA5                              mov     edx, 0A57D8666h
  4680 000031DB F7EA                                    imul    edx
  4681 000031DD 89563C                                  mov     [esi+60], edx
  4682 000031E0 8B463C                                  mov     eax, [esi+60]
  4683 000031E3 014638                                  add     [esi+56], eax
  4684 000031E6 8B4638                                  mov     eax, [esi+56]
  4685 000031E9 014630                                  add     [esi+48], eax
  4686 000031EC 8B4634                                  mov     eax, [esi+52]
  4687 000031EF 014638                                  add     [esi+56], eax
  4688 000031F2 8B463C                                  mov     eax, [esi+60]
  4689 000031F5 014634                                  add     [esi+52], eax
  4690 000031F8 8B06                                    mov     eax, [esi]      ; @@OUT macro dst,src1,src2
  4691                                                                          ; IF ((dst AND ((1 SHL rate_shift)-1)) EQ 0)
  4692                                                                          ;    mov eax,dword ptr [esi+src1*4]
  4693                                                                          ;    IFDIFI <src2>,<->
  4694                                                                          ;      add eax,dword ptr [esi+src2*4]
  4695                                                                          ;    ENDIF
  4696                                                                          ;    IF SYNTH32
  4697                                                                          ;       mov dword ptr [edi+dst*4],eax
  4698                                                                          ;       IF (LONG_WINDOW EQ 0)
  4699                                                                          ;          mov dword ptr [edi+dst*4+512*4],eax
  4700                                                                          ;       ENDIF
  4701                                                                          ;    ELSE
  4702                                                                          ;        ......
  4703                                                                          ;    ENDIF
  4704                                                                          ; @@OUT 0,0,-
  4705 000031FA 8907                                    mov     [edi], eax
  4706 000031FC 8B4604                                  mov     eax, [esi+4]    ; @@OUT 16,1,-
  4707 000031FF 894740                                  mov     [edi+64], eax
  4708 00003202 8B4608                                  mov     eax, [esi+8]    ; @@OUT 8,2,-
  4709 00003205 894720                                  mov     [edi+32], eax
  4710 00003208 8B460C                                  mov     eax, [esi+12]   ; @@OUT 24,3,-
  4711 0000320B 894760                                  mov     [edi+96], eax
  4712 0000320E 8B4610                                  mov     eax, [esi+16]   ; @@OUT 4,4,-
  4713 00003211 894710                                  mov     [edi+16], eax
  4714 00003214 8B4614                                  mov     eax, [esi+20]   ; @@OUT 20,5,-
  4715 00003217 894750                                  mov     [edi+80], eax
  4716 0000321A 8B4618                                  mov     eax, [esi+24]   ; @@OUT 12,6,-
  4717 0000321D 894730                                  mov     [edi+48], eax
  4718 00003220 8B461C                                  mov     eax, [esi+28]   ; @@OUT 28,7,-
  4719 00003223 894770                                  mov     [edi+112], eax
  4720 00003226 8B4620                                  mov     eax, [esi+32]   ; @@OUT 2,8,12
  4721 00003229 034630                                  add     eax, [esi+48]
  4722 0000322C 894708                                  mov     [edi+8], eax
  4723 0000322F 8B4624                                  mov     eax, [esi+36]   ; @@OUT 18,9,13
  4724 00003232 034634                                  add     eax, [esi+52]
  4725 00003235 894748                                  mov     [edi+72], eax
  4726 00003238 8B4628                                  mov     eax, [esi+40]   ; @@OUT 10,10,14
  4727 0000323B 034638                                  add     eax, [esi+56]
  4728 0000323E 894728                                  mov     [edi+40], eax
  4729 00003241 8B462C                                  mov     eax, [esi+44]   ; @@OUT 26,11,15
  4730 00003244 03463C                                  add     eax, [esi+60]
  4731 00003247 894768                                  mov     [edi+104], eax
  4732 0000324A 8B4630                                  mov     eax, [esi+48]   ; @@OUT 6,12,10
  4733 0000324D 034628                                  add     eax, [esi+40]
  4734 00003250 894718                                  mov     [edi+24], eax
  4735 00003253 8B4634                                  mov     eax, [esi+52]   ; @@OUT 22,13,11
  4736 00003256 03462C                                  add     eax, [esi+44]
  4737 00003259 894758                                  mov     [edi+88], eax
  4738 0000325C 8B4638                                  mov     eax, [esi+56]   ; @@OUT 14,14,9
  4739 0000325F 034624                                  add     eax, [esi+36]
  4740 00003262 894738                                  mov     [edi+56], eax
  4741 00003265 8B463C                                  mov     eax, [esi+60]   ; @@OUT 30,15,-
  4742 00003268 894778                                  mov     [edi+120], eax
  4743 0000326B C3                                      retn
  4744                                  
  4745                                  
  4746                                  ; =============== S U B R O U T I N E =======================================
  4747                                  
  4748                                  
  4749                                  mp3_dct32_shift_2:
  4750 0000326C 8B467C                                  mov     eax, [esi+124]  ; mp3_dct32_macro macro rate_shift ; rate_shift = 2
  4751 0000326F 0106                                    add     [esi], eax      ; @@BF macro a,b,sign,cos,shift
  4752                                                                          ; @@need_a equ (rate_shift EQ 0) or (a LT 16) ; a = 0
  4753                                                                          ; @@need_b equ (rate_shift EQ 0) or (b LT 16) ; b = 31
  4754                                                                          ; IF @@need_a AND @@need_b ; rate_shift = 0
  4755                                                                          ;    mov eax,dword ptr [esi+a*4]
  4756                                                                          ;    mov edx,dword ptr [esi+b*4]
  4757                                                                          ;    add dword ptr [esi+a*4],edx
  4758                                                                          ; ELSEIF @@need_a
  4759                                                                          ;    mov eax,dword ptr [esi+b*4]
  4760                                                                          ;    add dword ptr [esi+a*4],eax
  4761                                                                          ;
  4762                                                                          ; @@BF 0,31,+,COS0_0,1
  4763 00003271 8B4640                                  mov     eax, [esi+64]   ; @@BF 15,16,+,COS0_15,5
  4764 00003274 01463C                                  add     [esi+60], eax
  4765 00003277 8B06                                    mov     eax, [esi]      ; @@BF 0,15,+,COS1_0,1
  4766 00003279 8B563C                                  mov     edx, [esi+60]
  4767 0000327C 0116                                    add     [esi], edx
  4768 0000327E 29D0                                    sub     eax, edx
  4769 00003280 D1E0                                    shl     eax, 1
  4770 00003282 BA72464F40                              mov     edx, 404F4672h  ; COS1_0
  4771 00003287 F7EA                                    imul    edx
  4772 00003289 89563C                                  mov     [esi+60], edx
  4773 0000328C 8B4660                                  mov     eax, [esi+96]   ; @@BF 7,24,+,COS0_7,1
  4774 0000328F 01461C                                  add     [esi+28], eax
  4775 00003292 8B465C                                  mov     eax, [esi+92]   ; @@BF 8,23,+,COS0_8,1
  4776 00003295 014620                                  add     [esi+32], eax
  4777 00003298 8B461C                                  mov     eax, [esi+28]   ; @@BF 7,8,+,COS1_7,4
  4778 0000329B 8B5620                                  mov     edx, [esi+32]
  4779 0000329E 01561C                                  add     [esi+28], edx
  4780 000032A1 29D0                                    sub     eax, edx
  4781 000032A3 C1E004                                  shl     eax, 4
  4782 000032A6 BA044E9E51                              mov     edx, 519E4E04h  ; COS1_7
  4783 000032AB F7EA                                    imul    edx
  4784 000032AD 895620                                  mov     [esi+32], edx
  4785 000032B0 8B06                                    mov     eax, [esi]      ; @@BF 0,7,+,COS2_0,1
  4786 000032B2 8B561C                                  mov     edx, [esi+28]
  4787 000032B5 0116                                    add     [esi], edx
  4788 000032B7 29D0                                    sub     eax, edx
  4789 000032B9 D1E0                                    shl     eax, 1
  4790 000032BB BA46FB4041                              mov     edx, 4140FB46h  ; COS2_0
  4791 000032C0 F7EA                                    imul    edx
  4792 000032C2 89561C                                  mov     [esi+28], edx
  4793 000032C5 8B4620                                  mov     eax, [esi+32]   ; @@BF 8,15,-,COS2_0,1
  4794 000032C8 8B563C                                  mov     edx, [esi+60]
  4795 000032CB 015620                                  add     [esi+32], edx
  4796 000032CE 29D0                                    sub     eax, edx
  4797 000032D0 D1E0                                    shl     eax, 1
  4798 000032D2 BABA04BFBE                              mov     edx, 0BEBF04BAh
  4799 000032D7 F7EA                                    imul    edx
  4800 000032D9 89563C                                  mov     [esi+60], edx
  4801 000032DC 8B4670                                  mov     eax, [esi+112]  ; @@BF 3,28,+,COS0_3,1
  4802 000032DF 01460C                                  add     [esi+12], eax
  4803 000032E2 8B464C                                  mov     eax, [esi+76]   ; @@BF 12,19,+,COS0_12,2
  4804 000032E5 014630                                  add     [esi+48], eax
  4805 000032E8 8B460C                                  mov     eax, [esi+12]   ; @@BF 3,12,+,COS1_3,1
  4806 000032EB 8B5630                                  mov     edx, [esi+48]
  4807 000032EE 01560C                                  add     [esi+12], edx
  4808 000032F1 29D0                                    sub     eax, edx
  4809 000032F3 D1E0                                    shl     eax, 1
  4810 000032F5 BA630ECB52                              mov     edx, 52CB0E63h  ; COS1_3
  4811 000032FA F7EA                                    imul    edx
  4812 000032FC 895630                                  mov     [esi+48], edx
  4813 000032FF 8B466C                                  mov     eax, [esi+108]  ; @@BF 4,27,+,COS0_4,1
  4814 00003302 014610                                  add     [esi+16], eax
  4815 00003305 8B4650                                  mov     eax, [esi+80]   ; @@BF 11,20,+,COS0_11,2
  4816 00003308 01462C                                  add     [esi+44], eax
  4817 0000330B 8B4610                                  mov     eax, [esi+16]   ; @@BF 4,11,+,COS1_4,1
  4818 0000330E 8B562C                                  mov     edx, [esi+44]
  4819 00003311 015610                                  add     [esi+16], edx
  4820 00003314 29D0                                    sub     eax, edx
  4821 00003316 D1E0                                    shl     eax, 1
  4822 00003318 BA2E40E264                              mov     edx, 64E2402Eh
  4823 0000331D F7EA                                    imul    edx
  4824 0000331F 89562C                                  mov     [esi+44], edx
  4825 00003322 8B460C                                  mov     eax, [esi+12]   ; @@BF 3,4,+,COS2_3,3
  4826 00003325 8B5610                                  mov     edx, [esi+16]
  4827 00003328 01560C                                  add     [esi+12], edx
  4828 0000332B 29D0                                    sub     eax, edx
  4829 0000332D C1E003                                  shl     eax, 3
  4830 00003330 BA42670352                              mov     edx, 52036742h
  4831 00003335 F7EA                                    imul    edx
  4832 00003337 895610                                  mov     [esi+16], edx
  4833 0000333A 8B462C                                  mov     eax, [esi+44]   ; @@BF 11,12,-,COS2_3,3
  4834 0000333D 8B5630                                  mov     edx, [esi+48]
  4835 00003340 01562C                                  add     [esi+44], edx
  4836 00003343 29D0                                    sub     eax, edx
  4837 00003345 C1E003                                  shl     eax, 3
  4838 00003348 BABE98FCAD                              mov     edx, 0ADFC98BEh ; -COS2_3
  4839 0000334D F7EA                                    imul    edx
  4840 0000334F 895630                                  mov     [esi+48], edx
  4841 00003352 8B06                                    mov     eax, [esi]      ; @@BF 0,3,+,COS3_0,1
  4842 00003354 8B560C                                  mov     edx, [esi+12]
  4843 00003357 0116                                    add     [esi], edx
  4844 00003359 29D0                                    sub     eax, edx
  4845 0000335B D1E0                                    shl     eax, 1
  4846 0000335D BAF0E94545                              mov     edx, 4545E9F0h
  4847 00003362 F7EA                                    imul    edx
  4848 00003364 89560C                                  mov     [esi+12], edx
  4849 00003367 8B4610                                  mov     eax, [esi+16]   ; @@BF 4,7,-,COS3_0,1
  4850 0000336A 8B561C                                  mov     edx, [esi+28]
  4851 0000336D 015610                                  add     [esi+16], edx
  4852 00003370 29D0                                    sub     eax, edx
  4853 00003372 D1E0                                    shl     eax, 1
  4854 00003374 BA1016BABA                              mov     edx, 0BABA1610h
  4855 00003379 F7EA                                    imul    edx
  4856 0000337B 89561C                                  mov     [esi+28], edx
  4857 0000337E 8B4620                                  mov     eax, [esi+32]   ; @@BF 8,11,+,COS3_0,1
  4858 00003381 8B562C                                  mov     edx, [esi+44]
  4859 00003384 015620                                  add     [esi+32], edx
  4860 00003387 29D0                                    sub     eax, edx
  4861 00003389 D1E0                                    shl     eax, 1
  4862 0000338B BAF0E94545                              mov     edx, 4545E9F0h
  4863 00003390 F7EA                                    imul    edx
  4864 00003392 89562C                                  mov     [esi+44], edx
  4865 00003395 8B4630                                  mov     eax, [esi+48]   ; @@BF 12,15,-,COS3_0,1
  4866 00003398 8B563C                                  mov     edx, [esi+60]
  4867 0000339B 015630                                  add     [esi+48], edx
  4868 0000339E 29D0                                    sub     eax, edx
  4869 000033A0 D1E0                                    shl     eax, 1
  4870 000033A2 BA1016BABA                              mov     edx, 0BABA1610h
  4871 000033A7 F7EA                                    imul    edx
  4872 000033A9 89563C                                  mov     [esi+60], edx
  4873 000033AC 8B4678                                  mov     eax, [esi+120]  ; @@BF 1,30,+,COS0_1,1
  4874 000033AF 014604                                  add     [esi+4], eax
  4875 000033B2 8B4644                                  mov     eax, [esi+68]   ; @@BF 14,17,+,COS0_14,3
  4876 000033B5 014638                                  add     [esi+56], eax
  4877 000033B8 8B4604                                  mov     eax, [esi+4]    ; @@BF 1,14,+,COS1_1,1
  4878 000033BB 8B5638                                  mov     edx, [esi+56]
  4879 000033BE 015604                                  add     [esi+4], edx
  4880 000033C1 29D0                                    sub     eax, edx
  4881 000033C3 D1E0                                    shl     eax, 1
  4882 000033C5 BA103CE142                              mov     edx, 42E13C10h  ; COS1_1
  4883 000033CA F7EA                                    imul    edx
  4884 000033CC 895638                                  mov     [esi+56], edx
  4885 000033CF 8B4664                                  mov     eax, [esi+100]  ; @@BF 6,25,+,COS0_6,1
  4886 000033D2 014618                                  add     [esi+24], eax
  4887 000033D5 8B4658                                  mov     eax, [esi+88]   ; @@BF 9,22,+,COS0_9,1
  4888 000033D8 014624                                  add     [esi+36], eax
  4889 000033DB 8B4618                                  mov     eax, [esi+24]   ; @@BF 6,9,+,COS1_6,2
  4890 000033DE 8B5624                                  mov     edx, [esi+36]
  4891 000033E1 015618                                  add     [esi+24], edx
  4892 000033E4 29D0                                    sub     eax, edx
  4893 000033E6 C1E002                                  shl     eax, 2
  4894 000033E9 BAC2923C6E                              mov     edx, 6E3C92C2h
  4895 000033EE F7EA                                    imul    edx
  4896 000033F0 895624                                  mov     [esi+36], edx
  4897 000033F3 8B4604                                  mov     eax, [esi+4]    ; @@BF 1,6,+,COS2_1,1
  4898 000033F6 8B5618                                  mov     edx, [esi+24]
  4899 000033F9 015604                                  add     [esi+4], edx
  4900 000033FC 29D0                                    sub     eax, edx
  4901 000033FE D1E0                                    shl     eax, 1
  4902 00003400 BA88DEF84C                              mov     edx, 4CF8DE88h  ; COS2_1
  4903 00003405 F7EA                                    imul    edx
  4904 00003407 895618                                  mov     [esi+24], edx
  4905 0000340A 8B4624                                  mov     eax, [esi+36]   ; @@BF 9,14,-,COS2_1,1
  4906 0000340D 8B5638                                  mov     edx, [esi+56]
  4907 00003410 015624                                  add     [esi+36], edx
  4908 00003413 29D0                                    sub     eax, edx
  4909 00003415 D1E0                                    shl     eax, 1
  4910 00003417 BA782107B3                              mov     edx, 0B3072178h ; -COS2_1
  4911 0000341C F7EA                                    imul    edx
  4912 0000341E 895638                                  mov     [esi+56], edx
  4913 00003421 8B4674                                  mov     eax, [esi+116]  ; @@BF 2,29,+,COS0_2,1
  4914 00003424 014608                                  add     [esi+8], eax
  4915 00003427 8B4648                                  mov     eax, [esi+72]   ; @@BF 13,18,+,COS0_13,3
  4916 0000342A 014634                                  add     [esi+52], eax
  4917 0000342D 8B4608                                  mov     eax, [esi+8]    ; @@BF 2,13,+,COS1_2,1
  4918 00003430 8B5634                                  mov     edx, [esi+52]
  4919 00003433 015608                                  add     [esi+8], edx
  4920 00003436 29D0                                    sub     eax, edx
  4921 00003438 D1E0                                    shl     eax, 1
  4922 0000343A BA459F9148                              mov     edx, 48919F45h
  4923 0000343F F7EA                                    imul    edx
  4924 00003441 895634                                  mov     [esi+52], edx
  4925 00003444 8B4668                                  mov     eax, [esi+104]  ; @@BF 5,26,+,COS0_5,1
  4926 00003447 014614                                  add     [esi+20], eax
  4927 0000344A 8B4654                                  mov     eax, [esi+84]   ; @@BF 10,21,+,COS0_10,1
  4928 0000344D 014628                                  add     [esi+40], eax
  4929 00003450 8B4614                                  mov     eax, [esi+20]   ; @@BF 5,10,+,COS1_5,2
  4930 00003453 8B5628                                  mov     edx, [esi+40]
  4931 00003456 015614                                  add     [esi+20], edx
  4932 00003459 29D0                                    sub     eax, edx
  4933 0000345B C1E002                                  shl     eax, 2
  4934 0000345E BAAA24E243                              mov     edx, 43E224AAh
  4935 00003463 F7EA                                    imul    edx
  4936 00003465 895628                                  mov     [esi+40], edx
  4937 00003468 8B4608                                  mov     eax, [esi+8]    ; @@BF 2,5,+,COS2_2,1
  4938 0000346B 8B5614                                  mov     edx, [esi+20]
  4939 0000346E 015608                                  add     [esi+8], edx
  4940 00003471 29D0                                    sub     eax, edx
  4941 00003473 D1E0                                    shl     eax, 1
  4942 00003475 BABF6B3273                              mov     edx, 73326BBFh  ; COS2_2
  4943 0000347A F7EA                                    imul    edx
  4944 0000347C 895614                                  mov     [esi+20], edx
  4945 0000347F 8B4628                                  mov     eax, [esi+40]   ; @@BF 10,13,-,COS2_2,1
  4946 00003482 8B5634                                  mov     edx, [esi+52]
  4947 00003485 015628                                  add     [esi+40], edx
  4948 00003488 29D0                                    sub     eax, edx
  4949 0000348A D1E0                                    shl     eax, 1
  4950 0000348C BA4194CD8C                              mov     edx, 8CCD9441h  ; -COS2_2
  4951 00003491 F7EA                                    imul    edx
  4952 00003493 895634                                  mov     [esi+52], edx
  4953 00003496 8B4604                                  mov     eax, [esi+4]    ; @@BF 1,2,+,COS3_1,2
  4954 00003499 8B5608                                  mov     edx, [esi+8]
  4955 0000349C 015604                                  add     [esi+4], edx
  4956 0000349F 29D0                                    sub     eax, edx
  4957 000034A1 C1E002                                  shl     eax, 2
  4958 000034A4 BA46BA9E53                              mov     edx, 539EBA46h  ; COS3_1
  4959 000034A9 F7EA                                    imul    edx
  4960 000034AB 895608                                  mov     [esi+8], edx
  4961 000034AE 8B4614                                  mov     eax, [esi+20]   ; @@BF 5,6,-,COS3_1,2
  4962 000034B1 8B5618                                  mov     edx, [esi+24]
  4963 000034B4 015614                                  add     [esi+14h], edx
  4964 000034B7 29D0                                    sub     eax, edx
  4965 000034B9 C1E002                                  shl     eax, 2
  4966 000034BC BABA4561AC                              mov     edx, 0AC6145BAh ; -COS3_1
  4967 000034C1 F7EA                                    imul    edx
  4968 000034C3 895618                                  mov     [esi+24], edx
  4969 000034C6 8B06                                    mov     eax, [esi]      ; @@BF1 macro a, b, c, d
  4970                                                                          ;   @@BF  a, b,+,COS4_0, 1
  4971                                                                          ;   @@BF  c, d,-,COS4_0, 1
  4972                                                                          ;   @@ADD c, d
  4973                                                                          ;  endm
  4974                                                                          ; @@BF1 0,1,2,3
  4975 000034C8 8B5604                                  mov     edx, [esi+4]    ; @@BF 0,1,+,COS4_0,1
  4976 000034CB 0116                                    add     [esi], edx
  4977 000034CD 29D0                                    sub     eax, edx
  4978 000034CF D1E0                                    shl     eax, 1
  4979 000034D1 BA9A79825A                              mov     edx, 5A82799Ah
  4980 000034D6 F7EA                                    imul    edx
  4981 000034D8 895604                                  mov     [esi+4], edx
  4982 000034DB 8B4608                                  mov     eax, [esi+8]    ; @@BF 2,3,-,COS4_0,1
  4983 000034DE 8B560C                                  mov     edx, [esi+12]
  4984 000034E1 015608                                  add     [esi+8], edx
  4985 000034E4 29D0                                    sub     eax, edx
  4986 000034E6 D1E0                                    shl     eax, 1
  4987 000034E8 BA66867DA5                              mov     edx, 0A57D8666h
  4988 000034ED F7EA                                    imul    edx
  4989 000034EF 89560C                                  mov     [esi+12], edx
  4990 000034F2 8B460C                                  mov     eax, [esi+12]   ; @@ADD 2,3
  4991 000034F5 014608                                  add     [esi+8], eax
  4992 000034F8 8B4610                                  mov     eax, [esi+16]   ; @@BF2 macro a, b, c, d
  4993                                                                          ;   @@BF  a, b,+,COS4_0, 1
  4994                                                                          ;   @@BF  c, d,-,COS4_0, 1
  4995                                                                          ;   @@ADD c, d
  4996                                                                          ;   @@ADD a, c
  4997                                                                          ;   @@ADD c, b
  4998                                                                          ;   @@ADD b, d
  4999                                                                          ;  endm
  5000                                                                          ; @@BF2 4,5,6,7
  5001 000034FB 8B5614                                  mov     edx, [esi+20]   ; @@BF 4,5,+,COS4_0,1
  5002 000034FE 015610                                  add     [esi+16], edx
  5003 00003501 29D0                                    sub     eax, edx
  5004 00003503 D1E0                                    shl     eax, 1
  5005 00003505 BA9A79825A                              mov     edx, 5A82799Ah  ; COS4_0
  5006 0000350A F7EA                                    imul    edx
  5007 0000350C 895614                                  mov     [esi+20], edx
  5008 0000350F 8B4618                                  mov     eax, [esi+24]   ; @@BF 6,7,-,COS4_0,1
  5009 00003512 8B561C                                  mov     edx, [esi+28]
  5010 00003515 015618                                  add     [esi+18h], edx
  5011 00003518 29D0                                    sub     eax, edx
  5012 0000351A D1E0                                    shl     eax, 1
  5013 0000351C BA66867DA5                              mov     edx, 0A57D8666h ; -COS4_0
  5014 00003521 F7EA                                    imul    edx
  5015 00003523 89561C                                  mov     [esi+28], edx
  5016 00003526 8B461C                                  mov     eax, [esi+28]   ; @@ADD 6,7
  5017 00003529 014618                                  add     [esi+24], eax
  5018 0000352C 8B4618                                  mov     eax, [esi+24]   ; @@ADD 4,6
  5019 0000352F 014610                                  add     [esi+16], eax
  5020 00003532 8B4614                                  mov     eax, [esi+20]   ; @@ADD 6,5
  5021 00003535 014618                                  add     [esi+24], eax
  5022 00003538 8B461C                                  mov     eax, [esi+28]   ; @@ADD 5,7
  5023 0000353B 014614                                  add     [esi+20], eax
  5024 0000353E 8B06                                    mov     eax, [esi]      ; @@OUT macro dst,src1,src2
  5025                                                                          ; IF ((dst AND ((1 SHL rate_shift)-1)) EQ 0)
  5026                                                                          ;    mov eax,dword ptr [esi+src1*4]
  5027                                                                          ;    IFDIFI <src2>,<->
  5028                                                                          ;      add eax,dword ptr [esi+src2*4]
  5029                                                                          ;    ENDIF
  5030                                                                          ;    IF SYNTH32
  5031                                                                          ;       mov dword ptr [edi+dst*4],eax
  5032                                                                          ;       IF (LONG_WINDOW EQ 0)
  5033                                                                          ;          mov dword ptr [edi+dst*4+512*4],eax
  5034                                                                          ;       ENDIF
  5035                                                                          ;    ELSE
  5036                                                                          ;        ......
  5037                                                                          ;    ENDIF
  5038                                                                          ; @@OUT 0,0,-
  5039 00003540 8907                                    mov     [edi], eax
  5040 00003542 8B4604                                  mov     eax, [esi+4]    ; @@OUT 16,1,-
  5041 00003545 894740                                  mov     [edi+64], eax
  5042 00003548 8B4608                                  mov     eax, [esi+8]    ; @@OUT 8,2,-
  5043 0000354B 894720                                  mov     [edi+32], eax
  5044 0000354E 8B460C                                  mov     eax, [esi+12]   ; @@OUT 24,3,-
  5045 00003551 894760                                  mov     [edi+96], eax
  5046 00003554 8B4610                                  mov     eax, [esi+16]   ; @@OUT 4,4,-
  5047 00003557 894710                                  mov     [edi+16], eax
  5048 0000355A 8B4614                                  mov     eax, [esi+20]   ; @@OUT 20,5,-
  5049 0000355D 894750                                  mov     [edi+80], eax
  5050 00003560 8B4618                                  mov     eax, [esi+24]   ; @@OUT 12,6,-
  5051 00003563 894730                                  mov     [edi+48], eax
  5052 00003566 8B461C                                  mov     eax, [esi+28]   ; @@OUT 28,7,-
  5053 00003569 894770                                  mov     [edi+112], eax
  5054 0000356C C3                                      retn
  5055                                  
  5056                                  
  5057                                  ; =============== S U B R O U T I N E =======================================
  5058                                  
  5059                                  
  5060                                  synth_16bit_shift_0_fast:
  5061 0000356D F605[4C6F0000]10                        test    byte [cpuid_flags], 10h ; SYNTH_MACRO 0,0,1
  5062 00003574 740E                                    jz      short .no_rdtsc_supported
  5063 00003576 0F31                                    rdtsc
  5064 00003578 2905[C4700000]                          sub     [rdtsc_synth_dct], eax
  5065 0000357E 1915[C8700000]                          sbb     [rdtsc_synth_dct+4], edx
  5066                                  
  5067                                  .no_rdtsc_supported:
  5068 00003584 BE[DAB60000]                            mov	esi, mp3_sb_samples
  5069 00003589 8B3D[6CED0000]                          mov	edi, [mp3_samples_dst]
  5070 0000358F C705[78ED0000]0000-                     mov	dword [mp3_curr_channel], 0
  5070 00003597 0000               
  5071                                  
  5072                                  .synth_channel_lop:
  5073 00003599 56                                      push	esi
  5074 0000359A 57                                      push	edi
  5075 0000359B 893D[BA960000]                          mov	[mp3_curr_syn_dst], edi
  5076 000035A1 C705[80ED0000]0000-                     mov	dword [mp3_curr_frame], 0
  5076 000035A9 0000               
  5077                                  
  5078                                  .synth_frame_lop:
  5079 000035AB 56                                      push    esi
  5080 000035AC F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
  5081 000035B3 740E                                    jz      short .no_rdtsc_supported@
  5082 000035B5 0F31                                    rdtsc
  5083 000035B7 2905[DC700000]                          sub     [rdtsc_dct32], eax
  5084 000035BD 1915[E0700000]                          sbb     [rdtsc_dct32+4], edx
  5085                                  
  5086                                  .no_rdtsc_supported@:
  5087 000035C3 8B15[78ED0000]                          mov     edx, [mp3_curr_channel]
  5088 000035C9 8B0495[D2B60000]                        mov     eax, [mp3_synth_index+edx*4]
  5089 000035D0 832C95[D2B60000]20                      sub     dword [mp3_synth_index+edx*4], 32
  5090 000035D8 C1E20A                                  shl     edx, 10
  5091 000035DB 25E0010000                              and     eax, 1E0h       ; 1FFh-1Fh
  5092 000035E0 09D0                                    or      eax, edx
  5093 000035E2 A3[B6960000]                            mov     [mp3_curr_syn_index], eax
  5094 000035E7 8B3D[B6960000]                          mov     edi, [mp3_curr_syn_index]
  5095 000035ED 8D3CBD[D2960000]                        lea     edi, [mp3_synth_buf+edi*4]
  5096 000035F4 E8A3EFFFFF                              call    mp3_dct32_shift_0
  5097 000035F9 F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
  5098 00003600 740E                                    jz      short .no_rdtsc_supported@@
  5099 00003602 0F31                                    rdtsc
  5100 00003604 0105[DC700000]                          add     [rdtsc_dct32], eax
  5101 0000360A 1115[E0700000]                          adc     [rdtsc_dct32+4], edx
  5102                                  
  5103                                  .no_rdtsc_supported@@:
  5104 00003610 F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
  5105 00003617 740E                                    jz      short .no_rdtsc_supported@@@
  5106 00003619 0F31                                    rdtsc
  5107 0000361B 2905[F4700000]                          sub     [rdtsc_synth], eax
  5108 00003621 1915[F8700000]                          sbb     [rdtsc_synth+4], edx
  5109                                  
  5110                                  .no_rdtsc_supported@@@:
  5111 00003627 E888000000                              call    mp3_synth_filter_this_16bit_shift_0_fast ;
  5112                                                                          ; mp3_synth_filter_this_&force_8bit&_&rate_shift&_&force_fast
  5113 0000362C F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
  5114 00003633 740E                                    jz      short .no_rdtsc_supported@@@@
  5115 00003635 0F31                                    rdtsc
  5116 00003637 0105[F4700000]                          add     [rdtsc_synth], eax
  5117 0000363D 1115[F8700000]                          adc     [rdtsc_synth+4], edx
  5118                                  
  5119                                  .no_rdtsc_supported@@@@:
  5120 00003643 5E                                      pop     esi
  5121 00003644 A1[74ED0000]                            mov     eax, [mp3_samples_dst_step]
  5122 00003649 C1E005                                  shl     eax, 5
  5123 0000364C 8A0D[486F0000]                          mov     cl, [option_rate_shift]
  5124 00003652 D3E8                                    shr     eax, cl
  5125 00003654 0105[BA960000]                          add     [mp3_curr_syn_dst], eax
  5126 0000365A 81C680000000                            add     esi, 128        ; SBLIMIT*4
  5127 00003660 FF05[80ED0000]                          inc     dword [mp3_curr_frame]
  5128 00003666 A1[80ED0000]                            mov     eax, [mp3_curr_frame]
  5129 0000366B 3B05[BE960000]                          cmp     eax, [mp3_nb_frames]
  5130 00003671 0F8234FFFFFF                            jb      .synth_frame_lop
  5131 00003677 5F                                      pop     edi
  5132 00003678 5E                                      pop     esi
  5133 00003679 033D[B2960000]                          add     edi, [mp3_bytes_per_sample]
  5134 0000367F 81C600120000                            add     esi, 4608       ; 36*SBLIMIT*4
  5135 00003685 FF05[78ED0000]                          inc     dword [mp3_curr_channel]
  5136 0000368B A1[78ED0000]                            mov     eax, [mp3_curr_channel]
  5137 00003690 3B05[AA960000]                          cmp     eax, [mp3_output_num_channels]
  5138 00003696 0F82FDFEFFFF                            jb      .synth_channel_lop
  5139 0000369C F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
  5140 000036A3 740E                                    jz      short .no_rdtsc_supported@@@@@
  5141 000036A5 0F31                                    rdtsc
  5142 000036A7 0105[C4700000]                          add     [rdtsc_synth_dct], eax
  5143 000036AD 1115[C8700000]                          adc     [rdtsc_synth_dct+4], edx
  5144                                  
  5145                                  .no_rdtsc_supported@@@@@:
  5146 000036B3 C3                                      retn
  5147                                  
  5148                                  
  5149                                  ; =============== S U B R O U T I N E =======================================
  5150                                  
  5151                                  
  5152                                  mp3_synth_filter_this_16bit_shift_0_fast:
  5153 000036B4 A1[B6960000]                            mov     eax, [mp3_curr_syn_index]
  5154 000036B9 A9E0010000                              test    eax, 1E0h       ; 1FFh-1Fh
  5155 000036BE 0F849C010000                            jz      .append_copy_to_window
  5156 000036C4 90                                      nop
  5157                                  
  5158                                  .append_copy_to_window_back:
  5159 000036C5 89C5                                    mov     ebp, eax
  5160 000036C7 81E5C0010000                            and     ebp, 1C0h       ; @win1,1FFh-1Fh-20h
  5161 000036CD 2520040000                              and     eax, 420h       ; and eax,20h+(1 shl 10) ; bit5 and channel
  5162 000036D2 8D7010                                  lea     esi, [eax+10h]  ; @@syn1,[eax+10h]
  5163 000036D5 8D7830                                  lea     edi, [eax+30h]  ; @@syn2,[eax+30h]
  5164 000036D8 F7DD                                    neg     ebp
  5165 000036DA 81E5C0010000                            and     ebp, 1C0h       ; @win1,1FFh-1Fh-20h
  5166 000036E0 8B0D[BA960000]                          mov     ecx, [mp3_curr_syn_dst] ; @@dst,dword ptr [mp3_curr_syn_dst]
  5167                                  
  5168                                  .samples_lop:
  5169 000036E6 BB00200020                              mov     ebx, 20002000h  ; mov @@sum,(8000h SHL (@@out_shift))+(1 SHL (@@out_shift-1))
  5170                                                                          ; @@out_shift equ (OUT_SHIFT_fast+(8*force_8bit))
  5171                                                                          ; out_shift = 14
  5172 000036EB 8B14B5[D2960000]                        mov     edx, [mp3_synth_buf+esi*4] ; @@SUM8 macro sum,win,ww,syn
  5173                                                                          ; @@SUM8 @@sum,@@win1,0,@@syn1
  5174                                                                          ; IRP nn,0,1,2,3,4,5,6,7
  5175                                                                          ; mov edx,dword ptr [mp3_synth_buf+syn*4+(nn*64*4)]
  5176                                                                          ; movsx eax,word ptr [mp3_synth_win+win*2+(nn*64*2)+ww*2]
  5177                                                                          ; imul eax,edx
  5178                                                                          ; add sum,eax
  5179 000036F2 0FBF842D[88E80400]                      movsx   eax, word [mp3_synth_win+ebp*2] ; nn=0, ww=0
  5180 000036FA 0FAFC2                                  imul    eax, edx
  5181 000036FD 01C3                                    add     ebx, eax
  5182 000036FF 8B14B5[D2970000]                        mov     edx, [(mp3_synth_buf+100h)+esi*4]
  5183 00003706 0FBF842D[08E90400]                      movsx   eax, word [(mp3_synth_win+80h)+ebp*2] ; nn=1, ww=0
  5184 0000370E 0FAFC2                                  imul    eax, edx
  5185 00003711 01C3                                    add     ebx, eax
  5186 00003713 8B14B5[D2980000]                        mov     edx, [(mp3_synth_buf+200h)+esi*4]
  5187 0000371A 0FBF842D[88E90400]                      movsx   eax, word [(mp3_synth_win+100h)+ebp*2] ; nn=2
  5188 00003722 0FAFC2                                  imul    eax, edx
  5189 00003725 01C3                                    add     ebx, eax
  5190 00003727 8B14B5[D2990000]                        mov     edx, [(mp3_synth_buf+300h)+esi*4]
  5191 0000372E 0FBF842D[08EA0400]                      movsx   eax, word [(mp3_synth_win+180h)+ebp*2] ; nn=3
  5192 00003736 0FAFC2                                  imul    eax, edx
  5193 00003739 01C3                                    add     ebx, eax
  5194 0000373B 8B14B5[D29A0000]                        mov     edx, [(mp3_synth_buf+400h)+esi*4]
  5195 00003742 0FBF842D[88EA0400]                      movsx   eax, word [(mp3_synth_win+200h)+ebp*2] ; nn=4
  5196 0000374A 0FAFC2                                  imul    eax, edx
  5197 0000374D 01C3                                    add     ebx, eax
  5198 0000374F 8B14B5[D29B0000]                        mov     edx, [(mp3_synth_buf+500h)+esi*4]
  5199 00003756 0FBF842D[08EB0400]                      movsx   eax, word [(mp3_synth_win+280h)+ebp*2] ; nn=5
  5200 0000375E 0FAFC2                                  imul    eax, edx
  5201 00003761 01C3                                    add     ebx, eax
  5202 00003763 8B14B5[D29C0000]                        mov     edx, [(mp3_synth_buf+600h)+esi*4]
  5203 0000376A 0FBF842D[88EB0400]                      movsx   eax, word [(mp3_synth_win+300h)+ebp*2] ; nn=6
  5204 00003772 0FAFC2                                  imul    eax, edx
  5205 00003775 01C3                                    add     ebx, eax
  5206 00003777 8B14B5[D29D0000]                        mov     edx, [(mp3_synth_buf+700h)+esi*4]
  5207 0000377E 0FBF842D[08EC0400]                      movsx   eax, word [(mp3_synth_win+380h)+ebp*2] ; nn=7
  5208 00003786 0FAFC2                                  imul    eax, edx
  5209 00003789 01C3                                    add     ebx, eax
  5210 0000378B 8B14BD[D2960000]                        mov     edx, [mp3_synth_buf+edi*4] ; @@SUM8 @@sum,@@win1,32, @@syn2
  5211 00003792 0FBF842D[C8E80400]                      movsx   eax, word [(mp3_synth_win+40h)+ebp*2] ; nn=0, ww=32
  5212 0000379A 0FAFC2                                  imul    eax, edx
  5213 0000379D 01C3                                    add     ebx, eax
  5214 0000379F 8B14BD[D2970000]                        mov     edx, [(mp3_synth_buf+100h)+edi*4]
  5215 000037A6 0FBF842D[48E90400]                      movsx   eax, word [(mp3_synth_win+0C0h)+ebp*2] ; nn=1, ww=32
  5216 000037AE 0FAFC2                                  imul    eax, edx
  5217 000037B1 01C3                                    add     ebx, eax
  5218 000037B3 8B14BD[D2980000]                        mov     edx, [(mp3_synth_buf+200h)+edi*4]
  5219 000037BA 0FBF842D[C8E90400]                      movsx   eax, word [(mp3_synth_win+140h)+ebp*2] ; nn=2
  5220 000037C2 0FAFC2                                  imul    eax, edx
  5221 000037C5 01C3                                    add     ebx, eax
  5222 000037C7 8B14BD[D2990000]                        mov     edx, [(mp3_synth_buf+300h)+edi*4]
  5223 000037CE 0FBF842D[48EA0400]                      movsx   eax, word [(mp3_synth_win+1C0h)+ebp*2] ; nn=3
  5224 000037D6 0FAFC2                                  imul    eax, edx
  5225 000037D9 01C3                                    add     ebx, eax
  5226 000037DB 8B14BD[D29A0000]                        mov     edx, [(mp3_synth_buf+400h)+edi*4]
  5227 000037E2 0FBF842D[C8EA0400]                      movsx   eax, word [(mp3_synth_win+240h)+ebp*2] ; nn=4
  5228 000037EA 0FAFC2                                  imul    eax, edx
  5229 000037ED 01C3                                    add     ebx, eax
  5230 000037EF 8B14BD[D29B0000]                        mov     edx, [(mp3_synth_buf+500h)+edi*4]
  5231 000037F6 0FBF842D[48EB0400]                      movsx   eax, word [(mp3_synth_win+2C0h)+ebp*2] ; nn=5
  5232 000037FE 0FAFC2                                  imul    eax, edx
  5233 00003801 01C3                                    add     ebx, eax
  5234 00003803 8B14BD[D29C0000]                        mov     edx, [(mp3_synth_buf+600h)+edi*4]
  5235 0000380A 0FBF842D[C8EB0400]                      movsx   eax, word [(mp3_synth_win+340h)+ebp*2] ; nn=6
  5236 00003812 0FAFC2                                  imul    eax, edx
  5237 00003815 01C3                                    add     ebx, eax
  5238 00003817 8B14BD[D29D0000]                        mov     edx, [(mp3_synth_buf+700h)+edi*4]
  5239 0000381E 0FBF842D[48EC0400]                      movsx   eax, word [(mp3_synth_win+3C0h)+ebp*2] ; nn=7
  5240 00003826 0FAFC2                                  imul    eax, edx
  5241 00003829 01C3                                    add     ebx, eax
  5242 0000382B 81FB00000040                            cmp     ebx, 40000000h  ; cmp @@sum,10000h SHL (@@out_shift) ; out_shift = 14
  5243 00003831 7322                                    jnb     short .sat
  5244 00003833 C1FB0E                                  sar     ebx, 14         ; sar @@sum,(@@out_shift)
  5245 00003836 81EB00800000                            sub     ebx, 8000h      ; sub @@sum,8000h ; make 16bit signed
  5246                                  
  5247                                  .sat_back:
  5248 0000383C 668919                                  mov     [ecx], bx       ; mov word ptr [@@dst],@@sum_16bit
  5249 0000383F 030D[74ED0000]                          add     ecx, [mp3_samples_dst_step]
  5250 00003845 46                                      inc     esi             ; inc @@syn1
  5251 00003846 4F                                      dec     edi             ; dec @@syn2
  5252 00003847 45                                      inc     ebp             ; inc @@win1
  5253 00003848 F7C51F000000                            test    ebp, 1Fh        ; IF LONG_WINDOW
  5254 0000384E 0F8592FEFFFF                            jnz     .samples_lop   ; test @@win1,1Fh
  5255 00003854 C3                                      retn
  5256                                  
  5257                                  .sat:
  5258 00003855 C1FB1F                                  sar     ebx, 31         ; sar @@sum,31 ; FFFFFFFFh,00000000h
  5259 00003858 81F3FF7F0000                            xor     ebx, 7FFFh      ; xor @@sum,7fffh ; FFFF8000h,00007FFFh (signed 16bit)
  5260 0000385E EBDC                                    jmp     short .sat_back
  5261                                  
  5262                                  .append_copy_to_window:
  5263 00003860 8D3485[D2960000]                        lea     esi, [mp3_synth_buf+eax*4] ; IF SYNTH32
  5264 00003867 8DBE00080000                            lea     edi, [esi+2048] ; [esi+512*4]
  5265 0000386D B912000000                              mov     ecx, 18         ; (12h*4)/4
  5266 00003872 F3A5                                    rep movsd
  5267 00003874 E94CFEFFFF                              jmp     .append_copy_to_window_back
  5268                                  
  5269                                  
  5270                                  ; =============== S U B R O U T I N E =======================================
  5271                                  
  5272                                  
  5273                                  synth_16bit_shift_1_fast:
  5274 00003879 F605[4C6F0000]10                        test    byte [cpuid_flags], 10h ; SYNTH_MACRO 0,1,1
  5275 00003880 740E                                    jz      short .no_rdtsc_supported
  5276 00003882 0F31                                    rdtsc
  5277 00003884 2905[C4700000]                          sub     [rdtsc_synth_dct], eax
  5278 0000388A 1915[C8700000]                          sbb     [rdtsc_synth_dct+4], edx
  5279                                  
  5280                                  .no_rdtsc_supported:
  5281 00003890 BE[DAB60000]                            mov	esi, mp3_sb_samples
  5282 00003895 8B3D[6CED0000]                          mov	edi, [mp3_samples_dst]
  5283 0000389B C705[78ED0000]0000-                     mov	dword [mp3_curr_channel], 0
  5283 000038A3 0000               
  5284                                  
  5285                                  .synth_channel_lop:
  5286 000038A5 56                                      push	esi
  5287 000038A6 57                                      push	edi
  5288 000038A7 893D[BA960000]                          mov	[mp3_curr_syn_dst], edi
  5289 000038AD C705[80ED0000]0000-                     mov	dword [mp3_curr_frame], 0
  5289 000038B5 0000               
  5290                                  
  5291                                  .synth_frame_lop:
  5292 000038B7 56                                      push    esi
  5293 000038B8 F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
  5294 000038BF 740E                                    jz      short .no_rdtsc_supported@
  5295 000038C1 0F31                                    rdtsc
  5296 000038C3 2905[DC700000]                          sub     [rdtsc_dct32], eax
  5297 000038C9 1915[E0700000]                          sbb     [rdtsc_dct32+4], edx
  5298                                  
  5299                                  .no_rdtsc_supported@:
  5300 000038CF 8B15[78ED0000]                          mov     edx, [mp3_curr_channel]
  5301 000038D5 8B0495[D2B60000]                        mov     eax, [mp3_synth_index+edx*4]
  5302 000038DC 832C95[D2B60000]20                      sub	dword [mp3_synth_index+edx*4], 32
  5303 000038E4 C1E20A                                  shl     edx, 10
  5304 000038E7 25E0010000                              and     eax, 1E0h       ; 1FFh-1Fh
  5305 000038EC 09D0                                    or      eax, edx
  5306 000038EE A3[B6960000]                            mov     [mp3_curr_syn_index], eax
  5307 000038F3 8B3D[B6960000]                          mov     edi, [mp3_curr_syn_index]
  5308 000038F9 8D3CBD[D2960000]                        lea     edi, [mp3_synth_buf+edi*4]
  5309 00003900 E877F5FFFF                              call    mp3_dct32_shift_1 ; mp3_dct32_shift_&rate_shift
  5310 00003905 F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
  5311 0000390C 740E                                    jz      short .no_rdtsc_supported@@
  5312 0000390E 0F31                                    rdtsc
  5313 00003910 0105[DC700000]                          add     [rdtsc_dct32], eax
  5314 00003916 1115[E0700000]                          adc     [rdtsc_dct32+4], edx
  5315                                  
  5316                                  .no_rdtsc_supported@@:
  5317 0000391C F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
  5318 00003923 740E                                    jz      short .no_rdtsc_supported@@@
  5319 00003925 0F31                                    rdtsc
  5320 00003927 2905[F4700000]                          sub     [rdtsc_synth], eax
  5321 0000392D 1915[F8700000]                          sbb     [rdtsc_synth+4], edx
  5322                                  
  5323                                  .no_rdtsc_supported@@@:
  5324 00003933 E888000000                              call    mp3_synth_filter_this_16bit_shift_1_fast ;
  5325                                                                          ; mp3_synth_filter_this_&force_8bit&_&rate_shift&_&force_fast
  5326 00003938 F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
  5327 0000393F 740E                                    jz      short .no_rdtsc_supported@@@@
  5328 00003941 0F31                                    rdtsc
  5329 00003943 0105[F4700000]                          add     [rdtsc_synth], eax
  5330 00003949 1115[F8700000]                          adc     [rdtsc_synth+4], edx
  5331                                  
  5332                                  .no_rdtsc_supported@@@@:
  5333 0000394F 5E                                      pop     esi
  5334 00003950 A1[74ED0000]                            mov     eax, [mp3_samples_dst_step]
  5335 00003955 C1E005                                  shl     eax, 5
  5336 00003958 8A0D[486F0000]                          mov     cl, [option_rate_shift]
  5337 0000395E D3E8                                    shr     eax, cl
  5338 00003960 0105[BA960000]                          add     [mp3_curr_syn_dst], eax
  5339 00003966 81C680000000                            add     esi, 128        ; SBLIMIT*4
  5340 0000396C FF05[80ED0000]                          inc     dword [mp3_curr_frame]
  5341 00003972 A1[80ED0000]                            mov     eax, [mp3_curr_frame]
  5342 00003977 3B05[BE960000]                          cmp     eax, [mp3_nb_frames]
  5343 0000397D 0F8234FFFFFF                            jb      .synth_frame_lop
  5344 00003983 5F                                      pop     edi
  5345 00003984 5E                                      pop     esi
  5346 00003985 033D[B2960000]                          add     edi, [mp3_bytes_per_sample]
  5347 0000398B 81C600120000                            add     esi, 4608       ; 36*SBLIMIT*4
  5348 00003991 FF05[78ED0000]                          inc     dword [mp3_curr_channel]
  5349 00003997 A1[78ED0000]                            mov     eax, [mp3_curr_channel]
  5350 0000399C 3B05[AA960000]                          cmp     eax, [mp3_output_num_channels]
  5351 000039A2 0F82FDFEFFFF                            jb      .synth_channel_lop
  5352 000039A8 F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
  5353 000039AF 740E                                    jz      short .no_rdtsc_supported@@@@@
  5354 000039B1 0F31                                    rdtsc
  5355 000039B3 0105[C4700000]                          add     [rdtsc_synth_dct], eax
  5356 000039B9 1115[C8700000]                          adc     [rdtsc_synth_dct+4], edx
  5357                                  
  5358                                  .no_rdtsc_supported@@@@@:
  5359 000039BF C3                                      retn
  5360                                  
  5361                                  
  5362                                  ; =============== S U B R O U T I N E =======================================
  5363                                  
  5364                                  
  5365                                  mp3_synth_filter_this_16bit_shift_1_fast:
  5366 000039C0 A1[B6960000]                            mov     eax, [mp3_curr_syn_index]
  5367 000039C5 A9E0010000                              test    eax, 1E0h       ; 1FFh-1Fh
  5368 000039CA 0F84A2010000                            jz      .append_copy_to_window
  5369 000039D0 90                                      nop
  5370                                  
  5371                                  .append_copy_to_window_back:
  5372 000039D1 89C5                                    mov     ebp, eax
  5373 000039D3 81E5C0010000                            and     ebp, 1C0h
  5374 000039D9 2520040000                              and     eax, 420h
  5375 000039DE 8D7010                                  lea     esi, [eax+10h]
  5376 000039E1 8D7830                                  lea     edi, [eax+30h]
  5377 000039E4 F7DD                                    neg     ebp
  5378 000039E6 81E5C0010000                            and     ebp, 1C0h
  5379 000039EC 8B0D[BA960000]                          mov     ecx, [mp3_curr_syn_dst]
  5380                                  
  5381                                  .samples_lop:
  5382 000039F2 BB00200020                              mov     ebx, 20002000h  ; mov @@sum,(8000h SHL (@@out_shift))+(1 SHL (@@out_shift-1))
  5383                                                                          ; @@out_shift equ (OUT_SHIFT_fast+(8*force_8bit))
  5384                                                                          ; out_shift = 14
  5385 000039F7 8B14B5[D2960000]                        mov     edx, [mp3_synth_buf+esi*4] ; @@SUM8 macro sum,win,ww,syn
  5386                                                                          ; @@SUM8 @@sum,@@win1,0,@@syn1
  5387                                                                          ; IRP nn,0,1,2,3,4,5,6,7
  5388                                                                          ; mov edx,dword ptr [mp3_synth_buf+syn*4+(nn*64*4)]
  5389                                                                          ; movsx eax,word ptr [mp3_synth_win+win*2+(nn*64*2)+ww*2]
  5390                                                                          ; imul eax,edx
  5391                                                                          ; add sum,eax
  5392 000039FE 0FBF842D[88E80400]                      movsx   eax, word [mp3_synth_win+ebp*2]
  5393 00003A06 0FAFC2                                  imul    eax, edx
  5394 00003A09 01C3                                    add     ebx, eax
  5395 00003A0B 8B14B5[D2970000]                        mov     edx, [(mp3_synth_buf+100h)+esi*4] ; nn=1
  5396 00003A12 0FBF842D[08E90400]                      movsx   eax, word [(mp3_synth_win+80h)+ebp*2] ; ww=0
  5397 00003A1A 0FAFC2                                  imul    eax, edx
  5398 00003A1D 01C3                                    add     ebx, eax
  5399 00003A1F 8B14B5[D2980000]                        mov     edx, [(mp3_synth_buf+200h)+esi*4]
  5400 00003A26 0FBF842D[88E90400]                      movsx   eax, word [(mp3_synth_win+100h)+ebp*2]
  5401 00003A2E 0FAFC2                                  imul    eax, edx
  5402 00003A31 01C3                                    add     ebx, eax
  5403 00003A33 8B14B5[D2990000]                        mov     edx, [(mp3_synth_buf+300h)+esi*4]
  5404 00003A3A 0FBF842D[08EA0400]                      movsx   eax, word [(mp3_synth_win+180h)+ebp*2]
  5405 00003A42 0FAFC2                                  imul    eax, edx
  5406 00003A45 01C3                                    add     ebx, eax
  5407 00003A47 8B14B5[D29A0000]                        mov     edx, [(mp3_synth_buf+400h)+esi*4] ; nn=4
  5408 00003A4E 0FBF842D[88EA0400]                      movsx   eax, word [(mp3_synth_win+200h)+ebp*2]
  5409 00003A56 0FAFC2                                  imul    eax, edx
  5410 00003A59 01C3                                    add     ebx, eax
  5411 00003A5B 8B14B5[D29B0000]                        mov     edx, [(mp3_synth_buf+500h)+esi*4]
  5412 00003A62 0FBF842D[08EB0400]                      movsx   eax, word [(mp3_synth_win+280h)+ebp*2]
  5413 00003A6A 0FAFC2                                  imul    eax, edx
  5414 00003A6D 01C3                                    add     ebx, eax
  5415 00003A6F 8B14B5[D29C0000]                        mov     edx, [(mp3_synth_buf+600h)+esi*4]
  5416 00003A76 0FBF842D[88EB0400]                      movsx   eax, word [(mp3_synth_win+300h)+ebp*2]
  5417 00003A7E 0FAFC2                                  imul    eax, edx
  5418 00003A81 01C3                                    add     ebx, eax
  5419 00003A83 8B14B5[D29D0000]                        mov     edx, [(mp3_synth_buf+700h)+esi*4] ; nn=7
  5420 00003A8A 0FBF842D[08EC0400]                      movsx   eax, word [(mp3_synth_win+380h)+ebp*2] ; ww=0
  5421 00003A92 0FAFC2                                  imul    eax, edx
  5422 00003A95 01C3                                    add     ebx, eax
  5423 00003A97 8B14BD[D2960000]                        mov     edx, [mp3_synth_buf+edi*4]
  5424 00003A9E 0FBF842D[C8E80400]                      movsx   eax, word [(mp3_synth_win+40h)+ebp*2]
  5425 00003AA6 0FAFC2                                  imul    eax, edx
  5426 00003AA9 01C3                                    add     ebx, eax
  5427 00003AAB 8B14BD[D2970000]                        mov     edx, [(mp3_synth_buf+100h)+edi*4]
  5428 00003AB2 0FBF842D[48E90400]                      movsx   eax, word [(mp3_synth_win+0C0h)+ebp*2]
  5429 00003ABA 0FAFC2                                  imul    eax, edx
  5430 00003ABD 01C3                                    add     ebx, eax
  5431 00003ABF 8B14BD[D2980000]                        mov     edx, [(mp3_synth_buf+200h)+edi*4] ; nn=2, ww=32
  5432 00003AC6 0FBF842D[C8E90400]                      movsx   eax, word [(mp3_synth_win+140h)+ebp*2]
  5433 00003ACE 0FAFC2                                  imul    eax, edx
  5434 00003AD1 01C3                                    add     ebx, eax
  5435 00003AD3 8B14BD[D2990000]                        mov     edx, [(mp3_synth_buf+300h)+edi*4]
  5436 00003ADA 0FBF842D[48EA0400]                      movsx   eax, word [(mp3_synth_win+1C0h)+ebp*2]
  5437 00003AE2 0FAFC2                                  imul    eax, edx
  5438 00003AE5 01C3                                    add     ebx, eax
  5439 00003AE7 8B14BD[D29A0000]                        mov     edx, [(mp3_synth_buf+400h)+edi*4]
  5440 00003AEE 0FBF842D[C8EA0400]                      movsx   eax, word [(mp3_synth_win+240h)+ebp*2]
  5441 00003AF6 0FAFC2                                  imul    eax, edx
  5442 00003AF9 01C3                                    add     ebx, eax
  5443 00003AFB 8B14BD[D29B0000]                        mov     edx, [(mp3_synth_buf+500h)+edi*4]
  5444 00003B02 0FBF842D[48EB0400]                      movsx   eax, word [(mp3_synth_win+2C0h)+ebp*2]
  5445 00003B0A 0FAFC2                                  imul    eax, edx
  5446 00003B0D 01C3                                    add     ebx, eax
  5447 00003B0F 8B14BD[D29C0000]                        mov     edx, [(mp3_synth_buf+600h)+edi*4] ; nn=6, ww=32
  5448 00003B16 0FBF842D[C8EB0400]                      movsx   eax, word [(mp3_synth_win+340h)+ebp*2]
  5449 00003B1E 0FAFC2                                  imul    eax, edx
  5450 00003B21 01C3                                    add     ebx, eax
  5451 00003B23 8B14BD[D29D0000]                        mov     edx, [(mp3_synth_buf+700h)+edi*4]
  5452 00003B2A 0FBF842D[48EC0400]                      movsx   eax, word [(mp3_synth_win+3C0h)+ebp*2]
  5453 00003B32 0FAFC2                                  imul    eax, edx
  5454 00003B35 01C3                                    add     ebx, eax
  5455 00003B37 81FB00000040                            cmp     ebx, 40000000h  ; cmp  @@sum,10000h SHL (@@out_shift)
  5456 00003B3D 7328                                    jnb     short .sat
  5457 00003B3F C1FB0E                                  sar     ebx, 14         ; sar @@sum,(@@out_shift)
  5458 00003B42 81EB00800000                            sub     ebx, 8000h      ; make 16bit signed
  5459                                  
  5460                                  .sat_back:
  5461 00003B48 668919                                  mov     [ecx], bx
  5462 00003B4B 030D[74ED0000]                          add     ecx, [mp3_samples_dst_step]
  5463 00003B51 83C602                                  add     esi, 2          ; IF rate_shift
  5464                                                                          ; add  @@syn1,1 shl rate_shift
  5465 00003B54 83EF02                                  sub     edi, 2          ; sub @@syn2,1 shl rate_shift
  5466 00003B57 83C502                                  add     ebp, 2          ; add @@win1,1 shl rate_shift
  5467 00003B5A F7C51F000000                            test    ebp, 1Fh        ; IF LONG_WINDOW
  5468 00003B60 0F858CFEFFFF                            jnz     .samples_lop   ; test @@win1,1fh
  5469 00003B66 C3                                      retn
  5470                                  
  5471                                  .sat:
  5472 00003B67 C1FB1F                                  sar     ebx, 31         ; sar @@sum,31 ; FFFFFFFFh,00000000h
  5473 00003B6A 81F3FF7F0000                            xor     ebx, 7FFFh      ; xor @@sum,7fffh ; FFFF8000h,00007FFFh (signed 16bit)
  5474 00003B70 EBD6                                    jmp     short .sat_back
  5475                                  
  5476                                  .append_copy_to_window:
  5477 00003B72 8D3485[D2960000]                        lea     esi, [mp3_synth_buf+eax*4]
  5478 00003B79 8DBE00080000                            lea     edi, [esi+2048] ; [esi+512*4]
  5479 00003B7F B912000000                              mov     ecx, 18         ; (12h*4)/4
  5480 00003B84 F3A5                                    rep movsd
  5481 00003B86 E946FEFFFF                              jmp     .append_copy_to_window_back
  5482                                  
  5483                                  
  5484                                  ; =============== S U B R O U T I N E =======================================
  5485                                  
  5486                                  
  5487                                  synth_16bit_shift_2_fast:
  5488 00003B8B F605[4C6F0000]10                        test    byte [cpuid_flags], 10h ; SYNTH_MACRO 0,2,1
  5489 00003B92 740E                                    jz      short .no_rdtsc_supported
  5490 00003B94 0F31                                    rdtsc
  5491 00003B96 2905[C4700000]                          sub     [rdtsc_synth_dct], eax
  5492 00003B9C 1915[C8700000]                          sbb     [rdtsc_synth_dct+4], edx
  5493                                  
  5494                                  .no_rdtsc_supported:
  5495 00003BA2 BE[DAB60000]                            mov	esi, mp3_sb_samples
  5496 00003BA7 8B3D[6CED0000]                          mov	edi, [mp3_samples_dst]
  5497 00003BAD C705[78ED0000]0000-                     mov	dword [mp3_curr_channel], 0
  5497 00003BB5 0000               
  5498                                  
  5499                                  .synth_channel_lop:
  5500 00003BB7 56                                      push	esi
  5501 00003BB8 57                                      push	edi
  5502 00003BB9 893D[BA960000]                          mov	[mp3_curr_syn_dst], edi
  5503 00003BBF C705[80ED0000]0000-                     mov	dword [mp3_curr_frame], 0
  5503 00003BC7 0000               
  5504                                  
  5505                                  .synth_frame_lop:
  5506 00003BC9 56                                      push    esi
  5507 00003BCA F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
  5508 00003BD1 740E                                    jz      short .no_rdtsc_supported@
  5509 00003BD3 0F31                                    rdtsc
  5510 00003BD5 2905[DC700000]                          sub     [rdtsc_dct32], eax
  5511 00003BDB 1915[E0700000]                          sbb     [rdtsc_dct32+4], edx
  5512                                  
  5513                                  .no_rdtsc_supported@:
  5514 00003BE1 8B15[78ED0000]                          mov     edx, [mp3_curr_channel]
  5515 00003BE7 8B0495[D2B60000]                        mov     eax, [mp3_synth_index+edx*4]
  5516 00003BEE 832C95[D2B60000]20                      sub     dword [mp3_synth_index+edx*4], 32
  5517 00003BF6 C1E20A                                  shl     edx, 10
  5518 00003BF9 25E0010000                              and     eax, 1E0h       ; 1FFh-1Fh
  5519 00003BFE 09D0                                    or      eax, edx
  5520 00003C00 A3[B6960000]                            mov     [mp3_curr_syn_index], eax
  5521 00003C05 8B3D[B6960000]                          mov     edi, [mp3_curr_syn_index]
  5522 00003C0B 8D3CBD[D2960000]                        lea     edi, [mp3_synth_buf+edi*4]
  5523 00003C12 E855F6FFFF                              call    mp3_dct32_shift_2 ; mp3_dct32_shift_&rate_shift
  5524 00003C17 F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
  5525 00003C1E 740E                                    jz      short .no_rdtsc_supported@@
  5526 00003C20 0F31                                    rdtsc
  5527 00003C22 0105[DC700000]                          add     [rdtsc_dct32], eax
  5528 00003C28 1115[E0700000]                          adc     [rdtsc_dct32+4], edx
  5529                                  
  5530                                  .no_rdtsc_supported@@:
  5531 00003C2E F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
  5532 00003C35 740E                                    jz      short .no_rdtsc_supported@@@
  5533 00003C37 0F31                                    rdtsc
  5534 00003C39 2905[F4700000]                          sub     [rdtsc_synth], eax
  5535 00003C3F 1915[F8700000]                          sbb     [rdtsc_synth+4], edx
  5536                                  
  5537                                  .no_rdtsc_supported@@@:
  5538 00003C45 E888000000                              call    mp3_synth_filter_this_16bit_shift_2_fast ;
  5539                                                                          ; mp3_synth_filter_this_&force_8bit&_&rate_shift&_&force_fas
  5540 00003C4A F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
  5541 00003C51 740E                                    jz      short .no_rdtsc_supported@@@@
  5542 00003C53 0F31                                    rdtsc
  5543 00003C55 0105[F4700000]                          add     [rdtsc_synth], eax
  5544 00003C5B 1115[F8700000]                          adc     [rdtsc_synth+4], edx
  5545                                  
  5546                                  .no_rdtsc_supported@@@@:
  5547 00003C61 5E                                      pop     esi
  5548 00003C62 A1[74ED0000]                            mov     eax, [mp3_samples_dst_step]
  5549 00003C67 C1E005                                  shl     eax, 5
  5550 00003C6A 8A0D[486F0000]                          mov     cl, [option_rate_shift]
  5551 00003C70 D3E8                                    shr     eax, cl
  5552 00003C72 0105[BA960000]                          add     [mp3_curr_syn_dst], eax
  5553 00003C78 81C680000000                            add     esi, 128        ; SBLIMIT*4
  5554 00003C7E FF05[80ED0000]                          inc     dword [mp3_curr_frame]
  5555 00003C84 A1[80ED0000]                            mov     eax, [mp3_curr_frame]
  5556 00003C89 3B05[BE960000]                          cmp     eax, [mp3_nb_frames]
  5557 00003C8F 0F8234FFFFFF                            jb      .synth_frame_lop
  5558 00003C95 5F                                      pop     edi
  5559 00003C96 5E                                      pop     esi
  5560 00003C97 033D[B2960000]                          add     edi, [mp3_bytes_per_sample]
  5561 00003C9D 81C600120000                            add     esi, 4608       ; 36*SBLIMIT*4
  5562 00003CA3 FF05[78ED0000]                          inc     dword [mp3_curr_channel]
  5563 00003CA9 A1[78ED0000]                            mov     eax, [mp3_curr_channel]
  5564 00003CAE 3B05[AA960000]                          cmp     eax, [mp3_output_num_channels]
  5565 00003CB4 0F82FDFEFFFF                            jb      .synth_channel_lop
  5566 00003CBA F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
  5567 00003CC1 740E                                    jz      short .no_rdtsc_supported@@@@@
  5568 00003CC3 0F31                                    rdtsc
  5569 00003CC5 0105[C4700000]                          add     [rdtsc_synth_dct], eax
  5570 00003CCB 1115[C8700000]                          adc     [rdtsc_synth_dct+4], edx
  5571                                  
  5572                                  .no_rdtsc_supported@@@@@:
  5573 00003CD1 C3                                      retn
  5574                                  
  5575                                  
  5576                                  ; =============== S U B R O U T I N E =======================================
  5577                                  
  5578                                  
  5579                                  mp3_synth_filter_this_16bit_shift_2_fast:
  5580 00003CD2 A1[B6960000]                            mov     eax, [mp3_curr_syn_index]
  5581 00003CD7 A9E0010000                              test    eax, 1E0h       ; 1FFh-1Fh
  5582 00003CDC 0F84A2010000                            jz      .append_copy_to_window
  5583 00003CE2 90                                      nop
  5584                                  
  5585                                  .append_copy_to_window_back:
  5586 00003CE3 89C5                                    mov     ebp, eax
  5587 00003CE5 81E5C0010000                            and     ebp, 1C0h       ; 1FFh-1Fh-20h
  5588 00003CEB 2520040000                              and     eax, 420h       ; 20h+(1 shl 10)
  5589 00003CF0 8D7010                                  lea     esi, [eax+10h]
  5590 00003CF3 8D7830                                  lea     edi, [eax+30h]
  5591 00003CF6 F7DD                                    neg     ebp
  5592 00003CF8 81E5C0010000                            and     ebp, 1C0h
  5593 00003CFE 8B0D[BA960000]                          mov     ecx, [mp3_curr_syn_dst]
  5594                                  
  5595                                  .samples_lop:
  5596 00003D04 BB00200020                              mov     ebx, 20002000h  ; mov @@sum,(8000h SHL (@@out_shift))+(1 SHL (@@out_shift-1))
  5597                                                                          ; @@out_shift equ (OUT_SHIFT_fast+(8*force_8bit))
  5598                                                                          ; out_shift = 14
  5599 00003D09 8B14B5[D2960000]                        mov     edx, [mp3_synth_buf+esi*4]
  5600 00003D10 0FBF842D[88E80400]                      movsx   eax, word [mp3_synth_win+ebp*2]
  5601 00003D18 0FAFC2                                  imul    eax, edx
  5602 00003D1B 01C3                                    add     ebx, eax
  5603 00003D1D 8B14B5[D2970000]                        mov     edx, [(mp3_synth_buf+100h)+esi*4]
  5604 00003D24 0FBF842D[08E90400]                      movsx   eax, word [(mp3_synth_win+80h)+ebp*2]
  5605 00003D2C 0FAFC2                                  imul    eax, edx
  5606 00003D2F 01C3                                    add     ebx, eax
  5607 00003D31 8B14B5[D2980000]                        mov     edx, [(mp3_synth_buf+200h)+esi*4]
  5608 00003D38 0FBF842D[88E90400]                      movsx   eax, word [(mp3_synth_win+100h)+ebp*2]
  5609 00003D40 0FAFC2                                  imul    eax, edx
  5610 00003D43 01C3                                    add     ebx, eax
  5611 00003D45 8B14B5[D2990000]                        mov     edx, [(mp3_synth_buf+300h)+esi*4]
  5612 00003D4C 0FBF842D[08EA0400]                      movsx   eax, word [(mp3_synth_win+180h)+ebp*2]
  5613 00003D54 0FAFC2                                  imul    eax, edx
  5614 00003D57 01C3                                    add     ebx, eax
  5615 00003D59 8B14B5[D29A0000]                        mov     edx, [(mp3_synth_buf+400h)+esi*4]
  5616 00003D60 0FBF842D[88EA0400]                      movsx   eax, word [(mp3_synth_win+200h)+ebp*2]
  5617 00003D68 0FAFC2                                  imul    eax, edx
  5618 00003D6B 01C3                                    add     ebx, eax
  5619 00003D6D 8B14B5[D29B0000]                        mov     edx, [(mp3_synth_buf+500h)+esi*4]
  5620 00003D74 0FBF842D[08EB0400]                      movsx   eax, word [(mp3_synth_win+280h)+ebp*2]
  5621 00003D7C 0FAFC2                                  imul    eax, edx
  5622 00003D7F 01C3                                    add     ebx, eax
  5623 00003D81 8B14B5[D29C0000]                        mov     edx, [(mp3_synth_buf+600h)+esi*4]
  5624 00003D88 0FBF842D[88EB0400]                      movsx   eax, word [(mp3_synth_win+300h)+ebp*2]
  5625 00003D90 0FAFC2                                  imul    eax, edx
  5626 00003D93 01C3                                    add     ebx, eax
  5627 00003D95 8B14B5[D29D0000]                        mov     edx, [(mp3_synth_buf+700h)+esi*4]
  5628 00003D9C 0FBF842D[08EC0400]                      movsx   eax, word [(mp3_synth_win+380h)+ebp*2]
  5629 00003DA4 0FAFC2                                  imul    eax, edx
  5630 00003DA7 01C3                                    add     ebx, eax
  5631 00003DA9 8B14BD[D2960000]                        mov     edx, [mp3_synth_buf+edi*4]
  5632 00003DB0 0FBF842D[C8E80400]                      movsx   eax, word [(mp3_synth_win+40h)+ebp*2]
  5633 00003DB8 0FAFC2                                  imul    eax, edx
  5634 00003DBB 01C3                                    add     ebx, eax
  5635 00003DBD 8B14BD[D2970000]                        mov     edx, [(mp3_synth_buf+100h)+edi*4]
  5636 00003DC4 0FBF842D[48E90400]                      movsx   eax, word [(mp3_synth_win+0C0h)+ebp*2]
  5637 00003DCC 0FAFC2                                  imul    eax, edx
  5638 00003DCF 01C3                                    add     ebx, eax
  5639 00003DD1 8B14BD[D2980000]                        mov     edx, [(mp3_synth_buf+200h)+edi*4]
  5640 00003DD8 0FBF842D[C8E90400]                      movsx   eax, word [(mp3_synth_win+140h)+ebp*2]
  5641 00003DE0 0FAFC2                                  imul    eax, edx
  5642 00003DE3 01C3                                    add     ebx, eax
  5643 00003DE5 8B14BD[D2990000]                        mov     edx, [(mp3_synth_buf+300h)+edi*4]
  5644 00003DEC 0FBF842D[48EA0400]                      movsx   eax, word [(mp3_synth_win+1C0h)+ebp*2]
  5645 00003DF4 0FAFC2                                  imul    eax, edx
  5646 00003DF7 01C3                                    add     ebx, eax
  5647 00003DF9 8B14BD[D29A0000]                        mov     edx, [(mp3_synth_buf+400h)+edi*4]
  5648 00003E00 0FBF842D[C8EA0400]                      movsx   eax, word [(mp3_synth_win+240h)+ebp*2]
  5649 00003E08 0FAFC2                                  imul    eax, edx
  5650 00003E0B 01C3                                    add     ebx, eax
  5651 00003E0D 8B14BD[D29B0000]                        mov     edx, [(mp3_synth_buf+500h)+edi*4]
  5652 00003E14 0FBF842D[48EB0400]                      movsx   eax, word [(mp3_synth_win+2C0h)+ebp*2]
  5653 00003E1C 0FAFC2                                  imul    eax, edx
  5654 00003E1F 01C3                                    add     ebx, eax
  5655 00003E21 8B14BD[D29C0000]                        mov     edx, [(mp3_synth_buf+600h)+edi*4]
  5656 00003E28 0FBF842D[C8EB0400]                      movsx   eax, word [(mp3_synth_win+340h)+ebp*2]
  5657 00003E30 0FAFC2                                  imul    eax, edx
  5658 00003E33 01C3                                    add     ebx, eax
  5659 00003E35 8B14BD[D29D0000]                        mov     edx, [(mp3_synth_buf+700h)+edi*4]
  5660 00003E3C 0FBF842D[48EC0400]                      movsx   eax, word [(mp3_synth_win+3C0h)+ebp*2]
  5661 00003E44 0FAFC2                                  imul    eax, edx
  5662 00003E47 01C3                                    add     ebx, eax
  5663 00003E49 81FB00000040                            cmp     ebx, 40000000h
  5664 00003E4F 7328                                    jnb     short .sat
  5665 00003E51 C1FB0E                                  sar     ebx, 14
  5666 00003E54 81EB00800000                            sub     ebx, 8000h      ; make 16bit signed
  5667                                  
  5668                                  .sat_back:
  5669 00003E5A 668919                                  mov     [ecx], bx
  5670 00003E5D 030D[74ED0000]                          add     ecx, [mp3_samples_dst_step]
  5671 00003E63 83C604                                  add     esi, 4
  5672 00003E66 83EF04                                  sub     edi, 4
  5673 00003E69 83C504                                  add     ebp, 4
  5674 00003E6C F7C51F000000                            test    ebp, 1Fh
  5675 00003E72 0F858CFEFFFF                            jnz     .samples_lop
  5676 00003E78 C3                                      retn
  5677                                  
  5678                                  .sat:
  5679 00003E79 C1FB1F                                  sar     ebx, 31
  5680 00003E7C 81F3FF7F0000                            xor     ebx, 7FFFh
  5681 00003E82 EBD6                                    jmp     short .sat_back
  5682                                  
  5683                                  .append_copy_to_window:
  5684 00003E84 8D3485[D2960000]                        lea     esi, [mp3_synth_buf+eax*4]
  5685 00003E8B 8DBE00080000                            lea     edi, [esi+2048]
  5686 00003E91 B912000000                              mov     ecx, 18
  5687 00003E96 F3A5                                    rep movsd
  5688 00003E98 E946FEFFFF                              jmp     .append_copy_to_window_back
  5689                                  
  5690                                  
  5691                                  ; =============== S U B R O U T I N E =======================================
  5692                                  
  5693                                  
  5694                                  synth_8bit_shift_0_fast:
  5695 00003E9D F605[4C6F0000]10                        test    byte [cpuid_flags], 10h ; SYNTH_MACRO 1,0,1
  5696 00003EA4 740E                                    jz      short .no_rdtsc_supported
  5697 00003EA6 0F31                                    rdtsc
  5698 00003EA8 2905[C4700000]                          sub     [rdtsc_synth_dct], eax
  5699 00003EAE 1915[C8700000]                          sbb     [rdtsc_synth_dct+4], edx
  5700                                  
  5701                                  .no_rdtsc_supported:
  5702 00003EB4 BE[DAB60000]                            mov	esi, mp3_sb_samples
  5703 00003EB9 8B3D[6CED0000]                          mov	edi, [mp3_samples_dst]
  5704 00003EBF C705[78ED0000]0000-                     mov	dword [mp3_curr_channel], 0
  5704 00003EC7 0000               
  5705                                  
  5706                                  .synth_channel_lop:
  5707 00003EC9 56                                      push	esi
  5708 00003ECA 57                                      push	edi
  5709 00003ECB 893D[BA960000]                          mov	[mp3_curr_syn_dst], edi
  5710 00003ED1 C705[80ED0000]0000-                     mov	dword [mp3_curr_frame], 0
  5710 00003ED9 0000               
  5711                                  
  5712                                  .synth_frame_lop:
  5713 00003EDB 56                                      push    esi
  5714 00003EDC F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
  5715 00003EE3 740E                                    jz      short .no_rdtsc_supported@
  5716 00003EE5 0F31                                    rdtsc
  5717 00003EE7 2905[DC700000]                          sub     [rdtsc_dct32], eax
  5718 00003EED 1915[E0700000]                          sbb     [rdtsc_dct32+4], edx
  5719                                  
  5720                                  .no_rdtsc_supported@:
  5721 00003EF3 8B15[78ED0000]                          mov     edx, [mp3_curr_channel]
  5722 00003EF9 8B0495[D2B60000]                        mov     eax, [mp3_synth_index+edx*4]
  5723 00003F00 832C95[D2B60000]20                      sub     dword [mp3_synth_index+edx*4], 32
  5724 00003F08 C1E20A                                  shl     edx, 10
  5725 00003F0B 25E0010000                              and     eax, 1E0h       ; 1FFh-1Fh
  5726 00003F10 09D0                                    or      eax, edx
  5727 00003F12 A3[B6960000]                            mov     [mp3_curr_syn_index], eax
  5728 00003F17 8B3D[B6960000]                          mov     edi, [mp3_curr_syn_index]
  5729 00003F1D 8D3CBD[D2960000]                        lea     edi, [mp3_synth_buf+edi*4]
  5730 00003F24 E873E6FFFF                              call    mp3_dct32_shift_0 ; mp3_dct32_shift_&rate_shift
  5731 00003F29 F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
  5732 00003F30 740E                                    jz      short .no_rdtsc_supported@@
  5733 00003F32 0F31                                    rdtsc
  5734 00003F34 0105[DC700000]                          add     [rdtsc_dct32], eax
  5735 00003F3A 1115[E0700000]                          adc     [rdtsc_dct32+4], edx
  5736                                  
  5737                                  .no_rdtsc_supported@@:
  5738 00003F40 F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
  5739 00003F47 740E                                    jz      short .no_rdtsc_supported@@@
  5740 00003F49 0F31                                    rdtsc
  5741 00003F4B 2905[F4700000]                          sub     [rdtsc_synth], eax
  5742 00003F51 1915[F8700000]                          sbb     [rdtsc_synth+4], edx
  5743                                  
  5744                                  .no_rdtsc_supported@@@:
  5745 00003F57 E888000000                              call    mp3_synth_filter_this_8bit_shift_0_fast ;
  5746                                                                          ; mp3_synth_filter_this_&force_8bit&_&rate_shift&_&force_fast
  5747 00003F5C F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
  5748 00003F63 740E                                    jz      short .no_rdtsc_supported@@@@
  5749 00003F65 0F31                                    rdtsc
  5750 00003F67 0105[F4700000]                          add     [rdtsc_synth], eax
  5751 00003F6D 1115[F8700000]                          adc     [rdtsc_synth+4], edx
  5752                                  
  5753                                  .no_rdtsc_supported@@@@:
  5754 00003F73 5E                                      pop     esi
  5755 00003F74 A1[74ED0000]                            mov     eax, [mp3_samples_dst_step]
  5756 00003F79 C1E005                                  shl     eax, 5
  5757 00003F7C 8A0D[486F0000]                          mov     cl, [option_rate_shift]
  5758 00003F82 D3E8                                    shr     eax, cl
  5759 00003F84 0105[BA960000]                          add     [mp3_curr_syn_dst], eax
  5760 00003F8A 81C680000000                            add     esi, 128        ; SBLIMIT*4
  5761 00003F90 FF05[80ED0000]                          inc     dword [mp3_curr_frame]
  5762 00003F96 A1[80ED0000]                            mov     eax, [mp3_curr_frame]
  5763 00003F9B 3B05[BE960000]                          cmp     eax, [mp3_nb_frames]
  5764 00003FA1 0F8234FFFFFF                            jb      .synth_frame_lop
  5765 00003FA7 5F                                      pop     edi
  5766 00003FA8 5E                                      pop     esi
  5767 00003FA9 033D[B2960000]                          add     edi, [mp3_bytes_per_sample]
  5768 00003FAF 81C600120000                            add     esi, 4608       ; 36*SBLIMIT*4
  5769 00003FB5 FF05[78ED0000]                          inc     dword [mp3_curr_channel]
  5770 00003FBB A1[78ED0000]                            mov     eax, [mp3_curr_channel]
  5771 00003FC0 3B05[AA960000]                          cmp     eax, [mp3_output_num_channels]
  5772 00003FC6 0F82FDFEFFFF                            jb      .synth_channel_lop
  5773 00003FCC F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
  5774 00003FD3 740E                                    jz      short .no_rdtsc_supported@@@@@
  5775 00003FD5 0F31                                    rdtsc
  5776 00003FD7 0105[C4700000]                          add     [rdtsc_synth_dct], eax
  5777 00003FDD 1115[C8700000]                          adc     [rdtsc_synth_dct+4], edx
  5778                                  
  5779                                  .no_rdtsc_supported@@@@@:
  5780 00003FE3 C3                                      retn
  5781                                  
  5782                                  
  5783                                  ; =============== S U B R O U T I N E =======================================
  5784                                  
  5785                                  
  5786                                  mp3_synth_filter_this_8bit_shift_0_fast:
  5787 00003FE4 A1[B6960000]                            mov     eax, [mp3_curr_syn_index]
  5788 00003FE9 A9E0010000                              test    eax, 1E0h       ; 1FFh-1Fh
  5789 00003FEE 0F8491010000                            jz      .append_copy_to_window
  5790 00003FF4 90                                      nop
  5791                                  
  5792                                  .append_copy_to_window_back:
  5793 00003FF5 89C5                                    mov     ebp, eax
  5794 00003FF7 81E5C0010000                            and     ebp, 1C0h       ; 1FFh-1Fh-20h
  5795 00003FFD 2520040000                              and     eax, 420h       ; 20h+(1 shl 10)
  5796 00004002 8D7010                                  lea     esi, [eax+10h]
  5797 00004005 8D7830                                  lea     edi, [eax+30h]
  5798 00004008 F7DD                                    neg     ebp
  5799 0000400A 81E5C0010000                            and     ebp, 1C0h
  5800 00004010 8B0D[BA960000]                          mov     ecx, [mp3_curr_syn_dst]
  5801                                  
  5802                                  .samples_lop:
  5803 00004016 BB00002020                              mov     ebx, 20200000h  ; mov @@sum,(80h SHL (@@out_shift))+(1 SHL (@@out_shift-1))
  5804                                                                          ; @@out_shift equ (OUT_SHIFT_fast(8*force_8bit))
  5805                                                                          ; @@out_shift = 22
  5806 0000401B 8B14B5[D2960000]                        mov     edx, [mp3_synth_buf+esi*4] ; @@SUM8 macro sum,win,ww,syn
  5807                                                                          ; @@SUM8 @@sum,@@win1,0,@@syn1
  5808                                                                          ; IRP nn,0,1,2,3,4,5,6,7
  5809                                                                          ; mov edx,dword ptr [mp3_synth_buf+syn*4+(nn*64*4)]
  5810                                                                          ; movsx eax,word ptr [mp3_synth_win+win*2+(nn*64*2)+ww*2]
  5811                                                                          ; imul eax,edx
  5812                                                                          ; add sum,eax
  5813 00004022 0FBF842D[88E80400]                      movsx   eax, word [mp3_synth_win+ebp*2]
  5814 0000402A 0FAFC2                                  imul    eax, edx
  5815 0000402D 01C3                                    add     ebx, eax
  5816 0000402F 8B14B5[D2970000]                        mov     edx, [(mp3_synth_buf+100h)+esi*4] ; nn=1
  5817 00004036 0FBF842D[08E90400]                      movsx   eax, word [(mp3_synth_win+80h)+ebp*2] ; ww=0
  5818 0000403E 0FAFC2                                  imul    eax, edx
  5819 00004041 01C3                                    add     ebx, eax
  5820 00004043 8B14B5[D2980000]                        mov     edx, [(mp3_synth_buf+200h)+esi*4]
  5821 0000404A 0FBF842D[88E90400]                      movsx   eax, word [(mp3_synth_win+100h)+ebp*2]
  5822 00004052 0FAFC2                                  imul    eax, edx
  5823 00004055 01C3                                    add     ebx, eax
  5824 00004057 8B14B5[D2990000]                        mov     edx, [(mp3_synth_buf+300h)+esi*4]
  5825 0000405E 0FBF842D[08EA0400]                      movsx   eax, word [(mp3_synth_win+180h)+ebp*2]
  5826 00004066 0FAFC2                                  imul    eax, edx
  5827 00004069 01C3                                    add     ebx, eax
  5828 0000406B 8B14B5[D29A0000]                        mov     edx, [(mp3_synth_buf+400h)+esi*4]
  5829 00004072 0FBF842D[88EA0400]                      movsx   eax, word [(mp3_synth_win+200h)+ebp*2]
  5830 0000407A 0FAFC2                                  imul    eax, edx
  5831 0000407D 01C3                                    add     ebx, eax
  5832 0000407F 8B14B5[D29B0000]                        mov     edx, [(mp3_synth_buf+500h)+esi*4]
  5833 00004086 0FBF842D[08EB0400]                      movsx   eax, word [(mp3_synth_win+280h)+ebp*2]
  5834 0000408E 0FAFC2                                  imul    eax, edx
  5835 00004091 01C3                                    add     ebx, eax
  5836 00004093 8B14B5[D29C0000]                        mov     edx, [(mp3_synth_buf+600h)+esi*4]
  5837 0000409A 0FBF842D[88EB0400]                      movsx   eax, word [(mp3_synth_win+300h)+ebp*2]
  5838 000040A2 0FAFC2                                  imul    eax, edx
  5839 000040A5 01C3                                    add     ebx, eax
  5840 000040A7 8B14B5[D29D0000]                        mov     edx, [(mp3_synth_buf+700h)+esi*4]
  5841 000040AE 0FBF842D[08EC0400]                      movsx   eax, word [(mp3_synth_win+380h)+ebp*2]
  5842 000040B6 0FAFC2                                  imul    eax, edx
  5843 000040B9 01C3                                    add     ebx, eax
  5844 000040BB 8B14BD[D2960000]                        mov     edx, [mp3_synth_buf+edi*4]
  5845 000040C2 0FBF842D[C8E80400]                      movsx   eax, word [(mp3_synth_win+40h)+ebp*2]
  5846 000040CA 0FAFC2                                  imul    eax, edx
  5847 000040CD 01C3                                    add     ebx, eax
  5848 000040CF 8B14BD[D2970000]                        mov     edx, [(mp3_synth_buf+100h)+edi*4]
  5849 000040D6 0FBF842D[48E90400]                      movsx   eax, word [(mp3_synth_win+0C0h)+ebp*2]
  5850 000040DE 0FAFC2                                  imul    eax, edx
  5851 000040E1 01C3                                    add     ebx, eax
  5852 000040E3 8B14BD[D2980000]                        mov     edx, [(mp3_synth_buf+200h)+edi*4] ; nn=2
  5853 000040EA 0FBF842D[C8E90400]                      movsx   eax, word [(mp3_synth_win+140h)+ebp*2] ; ww=32
  5854 000040F2 0FAFC2                                  imul    eax, edx
  5855 000040F5 01C3                                    add     ebx, eax
  5856 000040F7 8B14BD[D2990000]                        mov     edx, [(mp3_synth_buf+300h)+edi*4]
  5857 000040FE 0FBF842D[48EA0400]                      movsx   eax, word [(mp3_synth_win+1C0h)+ebp*2]
  5858 00004106 0FAFC2                                  imul    eax, edx
  5859 00004109 01C3                                    add     ebx, eax
  5860 0000410B 8B14BD[D29A0000]                        mov     edx, [(mp3_synth_buf+400h)+edi*4]
  5861 00004112 0FBF842D[C8EA0400]                      movsx   eax, word [(mp3_synth_win+240h)+ebp*2]
  5862 0000411A 0FAFC2                                  imul    eax, edx
  5863 0000411D 01C3                                    add     ebx, eax
  5864 0000411F 8B14BD[D29B0000]                        mov     edx, [(mp3_synth_buf+500h)+edi*4]
  5865 00004126 0FBF842D[48EB0400]                      movsx   eax, word [(mp3_synth_win+2C0h)+ebp*2]
  5866 0000412E 0FAFC2                                  imul    eax, edx
  5867 00004131 01C3                                    add     ebx, eax
  5868 00004133 8B14BD[D29C0000]                        mov     edx, [(mp3_synth_buf+600h)+edi*4]
  5869 0000413A 0FBF842D[C8EB0400]                      movsx   eax, word [(mp3_synth_win+340h)+ebp*2]
  5870 00004142 0FAFC2                                  imul    eax, edx
  5871 00004145 01C3                                    add     ebx, eax
  5872 00004147 8B14BD[D29D0000]                        mov     edx, [(mp3_synth_buf+700h)+edi*4]
  5873 0000414E 0FBF842D[48EC0400]                      movsx   eax, word [(mp3_synth_win+3C0h)+ebp*2]
  5874 00004156 0FAFC2                                  imul    eax, edx
  5875 00004159 01C3                                    add     ebx, eax
  5876 0000415B 81FB00000040                            cmp     ebx, 40000000h  ; cmp  @@sum,100h SHL (@@out_shift)
  5877 00004161 731B                                    jnb     short .sat
  5878 00004163 C1FB16                                  sar     ebx, 22         ; sar @@sum,(@@out_shift)
  5879                                  
  5880                                  .sat_back:
  5881 00004166 8819                                    mov     [ecx], bl       ; mov byte ptr [@@dst],@@sum_8bit
  5882 00004168 030D[74ED0000]                          add     ecx, [mp3_samples_dst_step]
  5883 0000416E 46                                      inc     esi             ; inc @@syn1
  5884 0000416F 4F                                      dec     edi             ; dec @@syn2
  5885 00004170 45                                      inc     ebp             ; inc @@win1
  5886 00004171 F7C51F000000                            test    ebp, 1Fh        ; IF LONG_WINDOW
  5887                                                                          ; test @@win1,1fh
  5888 00004177 0F8599FEFFFF                            jnz     .samples_lop
  5889 0000417D C3                                      retn
  5890                                  
  5891                                  .sat:                                 
  5892 0000417E C1FB1F                                  sar     ebx, 31         ; sar @@sum,31 ; FFFFFFFFh,00000000h
  5893 00004181 F7D3                                    not     ebx             ; IF force_8bit
  5894                                                                          ; not @@sum ; 00000000h,FFFFFFFFh (unsigned 8bit)
  5895 00004183 EBE1                                    jmp     short .sat_back
  5896                                  
  5897                                  .append_copy_to_window:
  5898 00004185 8D3485[D2960000]                        lea     esi, [mp3_synth_buf+eax*4]
  5899 0000418C 8DBE00080000                            lea     edi, [esi+2048] ; [esi+512*4]
  5900 00004192 B912000000                              mov     ecx, 18         ; (12h*4)/4
  5901 00004197 F3A5                                    rep movsd
  5902 00004199 E957FEFFFF                              jmp     .append_copy_to_window_back
  5903                                  
  5904                                  
  5905                                  ; =============== S U B R O U T I N E =======================================
  5906                                  
  5907                                  
  5908                                  synth_8bit_shift_1_fast:
  5909 0000419E F605[4C6F0000]10                        test    byte [cpuid_flags], 10h ; SYNTH_MACRO 1,1,1
  5910 000041A5 740E                                    jz      short .no_rdtsc_supported
  5911 000041A7 0F31                                    rdtsc
  5912 000041A9 2905[C4700000]                          sub     [rdtsc_synth_dct], eax
  5913 000041AF 1915[C8700000]                          sbb     [rdtsc_synth_dct+4], edx
  5914                                  
  5915                                  .no_rdtsc_supported:
  5916 000041B5 BE[DAB60000]                            mov	esi, mp3_sb_samples
  5917 000041BA 8B3D[6CED0000]                          mov	edi, [mp3_samples_dst]
  5918 000041C0 C705[78ED0000]0000-                     mov	dword [mp3_curr_channel], 0
  5918 000041C8 0000               
  5919                                  
  5920                                  .synth_channel_lop:
  5921 000041CA 56                                      push	esi
  5922 000041CB 57                                      push	edi
  5923 000041CC 893D[BA960000]                          mov	[mp3_curr_syn_dst], edi
  5924 000041D2 C705[80ED0000]0000-                     mov	dword [mp3_curr_frame], 0
  5924 000041DA 0000               
  5925                                  
  5926                                  .synth_frame_lop:
  5927 000041DC 56                                      push    esi
  5928 000041DD F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
  5929 000041E4 740E                                    jz      short .no_rdtsc_supported@
  5930 000041E6 0F31                                    rdtsc
  5931 000041E8 2905[DC700000]                          sub     [rdtsc_dct32], eax
  5932 000041EE 1915[E0700000]                          sbb     [rdtsc_dct32+4], edx
  5933                                  
  5934                                  .no_rdtsc_supported@:
  5935 000041F4 8B15[78ED0000]                          mov     edx, [mp3_curr_channel]
  5936 000041FA 8B0495[D2B60000]                        mov     eax, [mp3_synth_index+edx*4]
  5937 00004201 832C95[D2B60000]20                      sub     dword [mp3_synth_index+edx*4], 32
  5938 00004209 C1E20A                                  shl     edx, 10
  5939 0000420C 25E0010000                              and     eax, 1E0h       ; 1FFh-1Fh
  5940 00004211 09D0                                    or      eax, edx
  5941 00004213 A3[B6960000]                            mov     [mp3_curr_syn_index], eax
  5942 00004218 8B3D[B6960000]                          mov     edi, [mp3_curr_syn_index]
  5943 0000421E 8D3CBD[D2960000]                        lea     edi, [mp3_synth_buf+edi*4]
  5944 00004225 E852ECFFFF                              call    mp3_dct32_shift_1 ; mp3_dct32_shift_&rate_shift
  5945 0000422A F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
  5946 00004231 740E                                    jz      short .no_rdtsc_supported@@
  5947 00004233 0F31                                    rdtsc
  5948 00004235 0105[DC700000]                          add     [rdtsc_dct32], eax
  5949 0000423B 1115[E0700000]                          adc     [rdtsc_dct32+4], edx
  5950                                  
  5951                                  .no_rdtsc_supported@@:
  5952 00004241 F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
  5953 00004248 740E                                    jz      short .no_rdtsc_supported@@@
  5954 0000424A 0F31                                    rdtsc
  5955 0000424C 2905[F4700000]                          sub     [rdtsc_synth], eax
  5956 00004252 1915[F8700000]                          sbb     [rdtsc_synth+4], edx
  5957                                  
  5958                                  .no_rdtsc_supported@@@:
  5959 00004258 E888000000                              call    mp3_synth_filter_this_8bit_shift_1_fast ;
  5960                                                                          ; mp3_synth_filter_this_&force_8bit&_&rate_shift&_&force_fast
  5961 0000425D F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
  5962 00004264 740E                                    jz      short .no_rdtsc_supported@@@@
  5963 00004266 0F31                                    rdtsc
  5964 00004268 0105[F4700000]                          add     [rdtsc_synth], eax
  5965 0000426E 1115[F8700000]                          adc     [rdtsc_synth+4], edx
  5966                                  
  5967                                  .no_rdtsc_supported@@@@:
  5968 00004274 5E                                      pop     esi
  5969 00004275 A1[74ED0000]                            mov     eax, [mp3_samples_dst_step]
  5970 0000427A C1E005                                  shl     eax, 5
  5971 0000427D 8A0D[486F0000]                          mov     cl, [option_rate_shift]
  5972 00004283 D3E8                                    shr     eax, cl
  5973 00004285 0105[BA960000]                          add     [mp3_curr_syn_dst], eax
  5974 0000428B 81C680000000                            add     esi, 128        ; SBLIMIT*4
  5975 00004291 FF05[80ED0000]                          inc     dword [mp3_curr_frame]
  5976 00004297 A1[80ED0000]                            mov     eax, [mp3_curr_frame]
  5977 0000429C 3B05[BE960000]                          cmp     eax, [mp3_nb_frames]
  5978 000042A2 0F8234FFFFFF                            jb      .synth_frame_lop
  5979 000042A8 5F                                      pop     edi
  5980 000042A9 5E                                      pop     esi
  5981 000042AA 033D[B2960000]                          add     edi, [mp3_bytes_per_sample]
  5982 000042B0 81C600120000                            add     esi, 4608       ; 36*SBLIMIT*4
  5983 000042B6 FF05[78ED0000]                          inc     dword [mp3_curr_channel]
  5984 000042BC A1[78ED0000]                            mov     eax, [mp3_curr_channel]
  5985 000042C1 3B05[AA960000]                          cmp     eax, [mp3_output_num_channels]
  5986 000042C7 0F82FDFEFFFF                            jb      .synth_channel_lop
  5987 000042CD F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
  5988 000042D4 740E                                    jz      short .no_rdtsc_supported@@@@@
  5989 000042D6 0F31                                    rdtsc
  5990 000042D8 0105[C4700000]                          add     [rdtsc_synth_dct], eax
  5991 000042DE 1115[C8700000]                          adc     [rdtsc_synth_dct+4], edx
  5992                                  
  5993                                  .no_rdtsc_supported@@@@@:
  5994 000042E4 C3                                      retn
  5995                                  
  5996                                  
  5997                                  ; =============== S U B R O U T I N E =======================================
  5998                                  
  5999                                  
  6000                                  mp3_synth_filter_this_8bit_shift_1_fast:
  6001 000042E5 A1[B6960000]                            mov     eax, [mp3_curr_syn_index]
  6002 000042EA A9E0010000                              test    eax, 1E0h
  6003 000042EF 0F8497010000                            jz      .append_copy_to_window
  6004 000042F5 90                                      nop
  6005                                  
  6006                                  .append_copy_to_window_back:
  6007 000042F6 89C5                                    mov     ebp, eax
  6008 000042F8 81E5C0010000                            and     ebp, 1C0h
  6009 000042FE 2520040000                              and     eax, 420h
  6010 00004303 8D7010                                  lea     esi, [eax+10h]
  6011 00004306 8D7830                                  lea     edi, [eax+30h]
  6012 00004309 F7DD                                    neg     ebp
  6013 0000430B 81E5C0010000                            and     ebp, 1C0h
  6014 00004311 8B0D[BA960000]                          mov     ecx, [mp3_curr_syn_dst]
  6015                                  
  6016                                  .samples_lop:
  6017 00004317 BB00002020                              mov     ebx, 20200000h
  6018 0000431C 8B14B5[D2960000]                        mov     edx, [mp3_synth_buf+esi*4]
  6019 00004323 0FBF842D[88E80400]                      movsx   eax, word [mp3_synth_win+ebp*2]
  6020 0000432B 0FAFC2                                  imul    eax, edx
  6021 0000432E 01C3                                    add     ebx, eax
  6022 00004330 8B14B5[D2970000]                        mov     edx, [(mp3_synth_buf+100h)+esi*4]
  6023 00004337 0FBF842D[08E90400]                      movsx   eax, word [(mp3_synth_win+80h)+ebp*2]
  6024 0000433F 0FAFC2                                  imul    eax, edx
  6025 00004342 01C3                                    add     ebx, eax
  6026 00004344 8B14B5[D2980000]                        mov     edx, [(mp3_synth_buf+200h)+esi*4]
  6027 0000434B 0FBF842D[88E90400]                      movsx   eax, word [(mp3_synth_win+100h)+ebp*2]
  6028 00004353 0FAFC2                                  imul    eax, edx
  6029 00004356 01C3                                    add     ebx, eax
  6030 00004358 8B14B5[D2990000]                        mov     edx, [(mp3_synth_buf+300h)+esi*4]
  6031 0000435F 0FBF842D[08EA0400]                      movsx   eax, word [(mp3_synth_win+180h)+ebp*2]
  6032 00004367 0FAFC2                                  imul    eax, edx
  6033 0000436A 01C3                                    add     ebx, eax
  6034 0000436C 8B14B5[D29A0000]                        mov     edx, [(mp3_synth_buf+400h)+esi*4]
  6035 00004373 0FBF842D[88EA0400]                      movsx   eax, word [(mp3_synth_win+200h)+ebp*2]
  6036 0000437B 0FAFC2                                  imul    eax, edx
  6037 0000437E 01C3                                    add     ebx, eax
  6038 00004380 8B14B5[D29B0000]                        mov     edx, [(mp3_synth_buf+500h)+esi*4]
  6039 00004387 0FBF842D[08EB0400]                      movsx   eax, word [(mp3_synth_win+280h)+ebp*2]
  6040 0000438F 0FAFC2                                  imul    eax, edx
  6041 00004392 01C3                                    add     ebx, eax
  6042 00004394 8B14B5[D29C0000]                        mov     edx, [(mp3_synth_buf+600h)+esi*4]
  6043 0000439B 0FBF842D[88EB0400]                      movsx   eax, word [(mp3_synth_win+300h)+ebp*2]
  6044 000043A3 0FAFC2                                  imul    eax, edx
  6045 000043A6 01C3                                    add     ebx, eax
  6046 000043A8 8B14B5[D29D0000]                        mov     edx, [(mp3_synth_buf+700h)+esi*4]
  6047 000043AF 0FBF842D[08EC0400]                      movsx   eax, word [(mp3_synth_win+380h)+ebp*2]
  6048 000043B7 0FAFC2                                  imul    eax, edx
  6049 000043BA 01C3                                    add     ebx, eax
  6050 000043BC 8B14BD[D2960000]                        mov     edx, [mp3_synth_buf+edi*4]
  6051 000043C3 0FBF842D[C8E80400]                      movsx   eax, word [(mp3_synth_win+40h)+ebp*2]
  6052 000043CB 0FAFC2                                  imul    eax, edx
  6053 000043CE 01C3                                    add     ebx, eax
  6054 000043D0 8B14BD[D2970000]                        mov     edx, [(mp3_synth_buf+100h)+edi*4]
  6055 000043D7 0FBF842D[48E90400]                      movsx   eax, word [(mp3_synth_win+0C0h)+ebp*2]
  6056 000043DF 0FAFC2                                  imul    eax, edx
  6057 000043E2 01C3                                    add     ebx, eax
  6058 000043E4 8B14BD[D2980000]                        mov     edx, [(mp3_synth_buf+200h)+edi*4]
  6059 000043EB 0FBF842D[C8E90400]                      movsx   eax, word [(mp3_synth_win+140h)+ebp*2]
  6060 000043F3 0FAFC2                                  imul    eax, edx
  6061 000043F6 01C3                                    add     ebx, eax
  6062 000043F8 8B14BD[D2990000]                        mov     edx, [(mp3_synth_buf+300h)+edi*4]
  6063 000043FF 0FBF842D[48EA0400]                      movsx   eax, word [(mp3_synth_win+1C0h)+ebp*2]
  6064 00004407 0FAFC2                                  imul    eax, edx
  6065 0000440A 01C3                                    add     ebx, eax
  6066 0000440C 8B14BD[D29A0000]                        mov     edx, [(mp3_synth_buf+400h)+edi*4]
  6067 00004413 0FBF842D[C8EA0400]                      movsx   eax, word [(mp3_synth_win+240h)+ebp*2]
  6068 0000441B 0FAFC2                                  imul    eax, edx
  6069 0000441E 01C3                                    add     ebx, eax
  6070 00004420 8B14BD[D29B0000]                        mov     edx, [(mp3_synth_buf+500h)+edi*4]
  6071 00004427 0FBF842D[48EB0400]                      movsx   eax, word [(mp3_synth_win+2C0h)+ebp*2]
  6072 0000442F 0FAFC2                                  imul    eax, edx
  6073 00004432 01C3                                    add     ebx, eax
  6074 00004434 8B14BD[D29C0000]                        mov     edx, [(mp3_synth_buf+600h)+edi*4]
  6075 0000443B 0FBF842D[C8EB0400]                      movsx   eax, word [(mp3_synth_win+340h)+ebp*2]
  6076 00004443 0FAFC2                                  imul    eax, edx
  6077 00004446 01C3                                    add     ebx, eax
  6078 00004448 8B14BD[D29D0000]                        mov     edx, [(mp3_synth_buf+700h)+edi*4]
  6079 0000444F 0FBF842D[48EC0400]                      movsx   eax, word [(mp3_synth_win+3C0h)+ebp*2]
  6080 00004457 0FAFC2                                  imul    eax, edx
  6081 0000445A 01C3                                    add     ebx, eax
  6082 0000445C 81FB00000040                            cmp     ebx, 40000000h
  6083 00004462 7321                                    jnb     short .sat
  6084 00004464 C1FB16                                  sar     ebx, 22
  6085                                  
  6086                                  .sat_back:
  6087 00004467 8819                                    mov     [ecx], bl
  6088 00004469 030D[74ED0000]                          add     ecx, [mp3_samples_dst_step]
  6089 0000446F 83C602                                  add     esi, 2
  6090 00004472 83EF02                                  sub     edi, 2
  6091 00004475 83C502                                  add     ebp, 2
  6092 00004478 F7C51F000000                            test    ebp, 1Fh
  6093 0000447E 0F8593FEFFFF                            jnz     .samples_lop
  6094 00004484 C3                                      retn
  6095                                  
  6096                                  .sat:
  6097 00004485 C1FB1F                                  sar     ebx, 31
  6098 00004488 F7D3                                    not     ebx
  6099 0000448A EBDB                                    jmp     short .sat_back
  6100                                  
  6101                                  .append_copy_to_window:
  6102 0000448C 8D3485[D2960000]                        lea     esi, [mp3_synth_buf+eax*4]
  6103 00004493 8DBE00080000                            lea     edi, [esi+2048]
  6104 00004499 B912000000                              mov     ecx, 18
  6105 0000449E F3A5                                    rep movsd
  6106 000044A0 E951FEFFFF                              jmp     .append_copy_to_window_back
  6107                                  
  6108                                  
  6109                                  ; =============== S U B R O U T I N E =======================================
  6110                                  
  6111                                  
  6112                                  synth_8bit_shift_2_fast:
  6113 000044A5 F605[4C6F0000]10                        test    byte [cpuid_flags], 10h ; SYNTH_MACRO 1,2,1
  6114 000044AC 740E                                    jz      short .no_rdtsc_supported
  6115 000044AE 0F31                                    rdtsc
  6116 000044B0 2905[C4700000]                          sub     [rdtsc_synth_dct], eax
  6117 000044B6 1915[C8700000]                          sbb     [rdtsc_synth_dct+4], edx
  6118                                  
  6119                                  .no_rdtsc_supported:
  6120 000044BC BE[DAB60000]                            mov	esi, mp3_sb_samples
  6121 000044C1 8B3D[6CED0000]                          mov	edi, [mp3_samples_dst]
  6122 000044C7 C705[78ED0000]0000-                     mov	dword [mp3_curr_channel], 0
  6122 000044CF 0000               
  6123                                  
  6124                                  .synth_channel_lop:
  6125 000044D1 56                                      push	esi
  6126 000044D2 57                                      push	edi
  6127 000044D3 893D[BA960000]                          mov	[mp3_curr_syn_dst], edi
  6128 000044D9 C705[80ED0000]0000-                     mov	dword [mp3_curr_frame], 0
  6128 000044E1 0000               
  6129                                  
  6130                                  .synth_frame_lop:
  6131 000044E3 56                                      push    esi
  6132 000044E4 F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
  6133 000044EB 740E                                    jz      short .no_rdtsc_supported@
  6134 000044ED 0F31                                    rdtsc
  6135 000044EF 2905[DC700000]                          sub     [rdtsc_dct32], eax
  6136 000044F5 1915[E0700000]                          sbb     [rdtsc_dct32+4], edx
  6137                                  
  6138                                  .no_rdtsc_supported@:
  6139 000044FB 8B15[78ED0000]                          mov     edx, [mp3_curr_channel]
  6140 00004501 8B0495[D2B60000]                        mov     eax, [mp3_synth_index+edx*4]
  6141 00004508 832C95[D2B60000]20                      sub     dword [mp3_synth_index+edx*4], 32
  6142 00004510 C1E20A                                  shl     edx, 10
  6143 00004513 25E0010000                              and     eax, 1E0h       ; 1FFh-1Fh
  6144 00004518 09D0                                    or      eax, edx
  6145 0000451A A3[B6960000]                            mov     [mp3_curr_syn_index], eax
  6146 0000451F 8B3D[B6960000]                          mov     edi, [mp3_curr_syn_index]
  6147 00004525 8D3CBD[D2960000]                        lea     edi, [mp3_synth_buf+edi*4]
  6148 0000452C E83BEDFFFF                              call    mp3_dct32_shift_2 ; mp3_dct32_shift_&rate_shift
  6149 00004531 F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
  6150 00004538 740E                                    jz      short .no_rdtsc_supported@@
  6151 0000453A 0F31                                    rdtsc
  6152 0000453C 0105[DC700000]                          add     [rdtsc_dct32], eax
  6153 00004542 1115[E0700000]                          adc     [rdtsc_dct32+4], edx
  6154                                  
  6155                                  .no_rdtsc_supported@@:
  6156 00004548 F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
  6157 0000454F 740E                                    jz      short .no_rdtsc_supported@@@
  6158 00004551 0F31                                    rdtsc
  6159 00004553 2905[F4700000]                          sub     [rdtsc_synth], eax
  6160 00004559 1915[F8700000]                          sbb     [rdtsc_synth+4], edx
  6161                                  
  6162                                  .no_rdtsc_supported@@@:
  6163 0000455F E888000000                              call    mp3_synth_filter_this_8bit_shift_2_fast ;
  6164                                                                          ; mp3_synth_filter_this_&force_8bit&_&rate_shift&_&force_fast
  6165 00004564 F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
  6166 0000456B 740E                                    jz      short .no_rdtsc_supported@@@@
  6167 0000456D 0F31                                    rdtsc
  6168 0000456F 0105[F4700000]                          add     [rdtsc_synth], eax
  6169 00004575 1115[F8700000]                          adc     [rdtsc_synth+4], edx
  6170                                  
  6171                                  .no_rdtsc_supported@@@@:
  6172 0000457B 5E                                      pop     esi
  6173 0000457C A1[74ED0000]                            mov     eax, [mp3_samples_dst_step]
  6174 00004581 C1E005                                  shl     eax, 5
  6175 00004584 8A0D[486F0000]                          mov     cl, [option_rate_shift]
  6176 0000458A D3E8                                    shr     eax, cl
  6177 0000458C 0105[BA960000]                          add     [mp3_curr_syn_dst], eax
  6178 00004592 81C680000000                            add     esi, 128        ; SBLIMIT*4
  6179 00004598 FF05[80ED0000]                          inc     dword [mp3_curr_frame]
  6180 0000459E A1[80ED0000]                            mov     eax, [mp3_curr_frame]
  6181 000045A3 3B05[BE960000]                          cmp     eax, [mp3_nb_frames]
  6182 000045A9 0F8234FFFFFF                            jb      .synth_frame_lop
  6183 000045AF 5F                                      pop     edi
  6184 000045B0 5E                                      pop     esi
  6185 000045B1 033D[B2960000]                          add     edi, [mp3_bytes_per_sample]
  6186 000045B7 81C600120000                            add     esi, 4608       ; 36*SBLIMIT*4
  6187 000045BD FF05[78ED0000]                          inc     dword [mp3_curr_channel]
  6188 000045C3 A1[78ED0000]                            mov     eax, [mp3_curr_channel]
  6189 000045C8 3B05[AA960000]                          cmp     eax, [mp3_output_num_channels]
  6190 000045CE 0F82FDFEFFFF                            jb      .synth_channel_lop
  6191 000045D4 F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
  6192 000045DB 740E                                    jz      short .no_rdtsc_supported@@@@@
  6193 000045DD 0F31                                    rdtsc
  6194 000045DF 0105[C4700000]                          add     [rdtsc_synth_dct], eax
  6195 000045E5 1115[C8700000]                          adc     [rdtsc_synth_dct+4], edx
  6196                                  
  6197                                  .no_rdtsc_supported@@@@@:
  6198 000045EB C3                                      retn
  6199                                  
  6200                                  
  6201                                  ; =============== S U B R O U T I N E =======================================
  6202                                  
  6203                                  
  6204                                  mp3_synth_filter_this_8bit_shift_2_fast:
  6205 000045EC A1[B6960000]                            mov     eax, [mp3_curr_syn_index]
  6206 000045F1 A9E0010000                              test    eax, 1E0h
  6207 000045F6 0F8497010000                            jz      .append_copy_to_window
  6208 000045FC 90                                      nop
  6209                                  
  6210                                  .append_copy_to_window_back:
  6211 000045FD 89C5                                    mov     ebp, eax
  6212 000045FF 81E5C0010000                            and     ebp, 1C0h
  6213 00004605 2520040000                              and     eax, 420h
  6214 0000460A 8D7010                                  lea     esi, [eax+10h]
  6215 0000460D 8D7830                                  lea     edi, [eax+30h]
  6216 00004610 F7DD                                    neg     ebp
  6217 00004612 81E5C0010000                            and     ebp, 1C0h
  6218 00004618 8B0D[BA960000]                          mov     ecx, [mp3_curr_syn_dst]
  6219                                  
  6220                                  .samples_lop:
  6221 0000461E BB00002020                              mov     ebx, 20200000h
  6222 00004623 8B14B5[D2960000]                        mov     edx, [mp3_synth_buf+esi*4]
  6223 0000462A 0FBF842D[88E80400]                      movsx   eax, word [mp3_synth_win+ebp*2]
  6224 00004632 0FAFC2                                  imul    eax, edx
  6225 00004635 01C3                                    add     ebx, eax
  6226 00004637 8B14B5[D2970000]                        mov     edx, [(mp3_synth_buf+100h)+esi*4]
  6227 0000463E 0FBF842D[08E90400]                      movsx   eax, word [(mp3_synth_win+80h)+ebp*2]
  6228 00004646 0FAFC2                                  imul    eax, edx
  6229 00004649 01C3                                    add     ebx, eax
  6230 0000464B 8B14B5[D2980000]                        mov     edx, [(mp3_synth_buf+200h)+esi*4]
  6231 00004652 0FBF842D[88E90400]                      movsx   eax, word [(mp3_synth_win+100h)+ebp*2]
  6232 0000465A 0FAFC2                                  imul    eax, edx
  6233 0000465D 01C3                                    add     ebx, eax
  6234 0000465F 8B14B5[D2990000]                        mov     edx, [(mp3_synth_buf+300h)+esi*4]
  6235 00004666 0FBF842D[08EA0400]                      movsx   eax, word [(mp3_synth_win+180h)+ebp*2]
  6236 0000466E 0FAFC2                                  imul    eax, edx
  6237 00004671 01C3                                    add     ebx, eax
  6238 00004673 8B14B5[D29A0000]                        mov     edx, [(mp3_synth_buf+400h)+esi*4]
  6239 0000467A 0FBF842D[88EA0400]                      movsx   eax, word [(mp3_synth_win+200h)+ebp*2]
  6240 00004682 0FAFC2                                  imul    eax, edx
  6241 00004685 01C3                                    add     ebx, eax
  6242 00004687 8B14B5[D29B0000]                        mov     edx, [(mp3_synth_buf+500h)+esi*4]
  6243 0000468E 0FBF842D[08EB0400]                      movsx   eax, word [(mp3_synth_win+280h)+ebp*2]
  6244 00004696 0FAFC2                                  imul    eax, edx
  6245 00004699 01C3                                    add     ebx, eax
  6246 0000469B 8B14B5[D29C0000]                        mov     edx, [(mp3_synth_buf+600h)+esi*4]
  6247 000046A2 0FBF842D[88EB0400]                      movsx   eax, word [(mp3_synth_win+300h)+ebp*2]
  6248 000046AA 0FAFC2                                  imul    eax, edx
  6249 000046AD 01C3                                    add     ebx, eax
  6250 000046AF 8B14B5[D29D0000]                        mov     edx, [(mp3_synth_buf+700h)+esi*4]
  6251 000046B6 0FBF842D[08EC0400]                      movsx   eax, word [(mp3_synth_win+380h)+ebp*2]
  6252 000046BE 0FAFC2                                  imul    eax, edx
  6253 000046C1 01C3                                    add     ebx, eax
  6254 000046C3 8B14BD[D2960000]                        mov     edx, [mp3_synth_buf+edi*4]
  6255 000046CA 0FBF842D[C8E80400]                      movsx   eax, word [(mp3_synth_win+40h)+ebp*2]
  6256 000046D2 0FAFC2                                  imul    eax, edx
  6257 000046D5 01C3                                    add     ebx, eax
  6258 000046D7 8B14BD[D2970000]                        mov     edx, [(mp3_synth_buf+100h)+edi*4]
  6259 000046DE 0FBF842D[48E90400]                      movsx   eax, word [(mp3_synth_win+0C0h)+ebp*2]
  6260 000046E6 0FAFC2                                  imul    eax, edx
  6261 000046E9 01C3                                    add     ebx, eax
  6262 000046EB 8B14BD[D2980000]                        mov     edx, [(mp3_synth_buf+200h)+edi*4]
  6263 000046F2 0FBF842D[C8E90400]                      movsx   eax, word [(mp3_synth_win+140h)+ebp*2]
  6264 000046FA 0FAFC2                                  imul    eax, edx
  6265 000046FD 01C3                                    add     ebx, eax
  6266 000046FF 8B14BD[D2990000]                        mov     edx, [(mp3_synth_buf+300h)+edi*4]
  6267 00004706 0FBF842D[48EA0400]                      movsx   eax, word [(mp3_synth_win+1C0h)+ebp*2]
  6268 0000470E 0FAFC2                                  imul    eax, edx
  6269 00004711 01C3                                    add     ebx, eax
  6270 00004713 8B14BD[D29A0000]                        mov     edx, [(mp3_synth_buf+400h)+edi*4]
  6271 0000471A 0FBF842D[C8EA0400]                      movsx   eax, word [(mp3_synth_win+240h)+ebp*2]
  6272 00004722 0FAFC2                                  imul    eax, edx
  6273 00004725 01C3                                    add     ebx, eax
  6274 00004727 8B14BD[D29B0000]                        mov     edx, [(mp3_synth_buf+500h)+edi*4]
  6275 0000472E 0FBF842D[48EB0400]                      movsx   eax, word [(mp3_synth_win+2C0h)+ebp*2]
  6276 00004736 0FAFC2                                  imul    eax, edx
  6277 00004739 01C3                                    add     ebx, eax
  6278 0000473B 8B14BD[D29C0000]                        mov     edx, [(mp3_synth_buf+600h)+edi*4]
  6279 00004742 0FBF842D[C8EB0400]                      movsx   eax, word [(mp3_synth_win+340h)+ebp*2]
  6280 0000474A 0FAFC2                                  imul    eax, edx
  6281 0000474D 01C3                                    add     ebx, eax
  6282 0000474F 8B14BD[D29D0000]                        mov     edx, [(mp3_synth_buf+700h)+edi*4]
  6283 00004756 0FBF842D[48EC0400]                      movsx   eax, word [(mp3_synth_win+3C0h)+ebp*2]
  6284 0000475E 0FAFC2                                  imul    eax, edx
  6285 00004761 01C3                                    add     ebx, eax
  6286 00004763 81FB00000040                            cmp     ebx, 40000000h
  6287 00004769 7321                                    jnb     short .sat
  6288 0000476B C1FB16                                  sar     ebx, 22
  6289                                  
  6290                                  .sat_back:
  6291 0000476E 8819                                    mov     [ecx], bl
  6292 00004770 030D[74ED0000]                          add     ecx, [mp3_samples_dst_step]
  6293 00004776 83C604                                  add     esi, 4
  6294 00004779 83EF04                                  sub     edi, 4
  6295 0000477C 83C504                                  add     ebp, 4
  6296 0000477F F7C51F000000                            test    ebp, 1Fh
  6297 00004785 0F8593FEFFFF                            jnz     .samples_lop
  6298 0000478B C3                                      retn
  6299                                  
  6300                                  .sat:
  6301 0000478C C1FB1F                                  sar     ebx, 31
  6302 0000478F F7D3                                    not     ebx
  6303 00004791 EBDB                                    jmp     short .sat_back
  6304                                  
  6305                                  .append_copy_to_window:
  6306 00004793 8D3485[D2960000]                        lea     esi, [mp3_synth_buf+eax*4]
  6307 0000479A 8DBE00080000                            lea     edi, [esi+2048]
  6308 000047A0 B912000000                              mov     ecx, 18
  6309 000047A5 F3A5                                    rep movsd
  6310 000047A7 E951FEFFFF                              jmp     .append_copy_to_window_back
  6311                                  
  6312                                  
  6313                                  ; =============== S U B R O U T I N E =======================================
  6314                                  
  6315                                  
  6316                                  synth_16bit_shift_0_slow:
  6317 000047AC F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
  6318 000047B3 740E                                    jz      short .no_rdtsc_supported
  6319 000047B5 0F31                                    rdtsc
  6320 000047B7 2905[C4700000]                          sub     [rdtsc_synth_dct], eax
  6321 000047BD 1915[C8700000]                          sbb     [rdtsc_synth_dct+4], edx
  6322                                  
  6323                                  .no_rdtsc_supported:
  6324 000047C3 BE[DAB60000]                            mov	esi, mp3_sb_samples
  6325 000047C8 8B3D[6CED0000]                          mov	edi, [mp3_samples_dst]
  6326 000047CE C705[78ED0000]0000-                     mov	dword [mp3_curr_channel], 0
  6326 000047D6 0000               
  6327                                  
  6328                                  .synth_channel_lop:
  6329 000047D8 56                                      push	esi
  6330 000047D9 57                                      push	edi
  6331 000047DA 893D[BA960000]                          mov	[mp3_curr_syn_dst], edi
  6332 000047E0 C705[80ED0000]0000-                     mov	dword [mp3_curr_frame], 0
  6332 000047E8 0000               
  6333                                  
  6334                                  .synth_frame_lop:
  6335 000047EA 56                                      push    esi
  6336 000047EB F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
  6337 000047F2 740E                                    jz      short .no_rdtsc_supported@
  6338 000047F4 0F31                                    rdtsc
  6339 000047F6 2905[DC700000]                          sub     [rdtsc_dct32], eax
  6340 000047FC 1915[E0700000]                          sbb     [rdtsc_dct32+4], edx
  6341                                  
  6342                                  .no_rdtsc_supported@:
  6343 00004802 8B15[78ED0000]                          mov     edx, [mp3_curr_channel]
  6344 00004808 8B0495[D2B60000]                        mov     eax, [mp3_synth_index+edx*4]
  6345 0000480F 832C95[D2B60000]20                      sub     dword [mp3_synth_index+edx*4], 32
  6346 00004817 C1E20A                                  shl     edx, 10         ; channel*1024
  6347 0000481A 25E0010000                              and     eax, 1E0h       ; 1FFh-1Fh
  6348 0000481F 09D0                                    or      eax, edx
  6349 00004821 A3[B6960000]                            mov     [mp3_curr_syn_index], eax
  6350 00004826 8B3D[B6960000]                          mov     edi, [mp3_curr_syn_index]
  6351 0000482C 8D3CBD[D2960000]                        lea     edi, [mp3_synth_buf+edi*4]
  6352 00004833 E864DDFFFF                              call    mp3_dct32_shift_0 ; mp3_dct32_shift_&rate_shift
  6353 00004838 F605[4C6F0000]10                        test    byte [cpuid_flags], 10h ; timelog_end rdtsc_dct32
  6354 0000483F 740E                                    jz      short .no_rdtsc_supported@@
  6355 00004841 0F31                                    rdtsc
  6356 00004843 0105[DC700000]                          add     [rdtsc_dct32], eax
  6357 00004849 1115[E0700000]                          adc     [rdtsc_dct32+4], edx
  6358                                  
  6359                                  .no_rdtsc_supported@@:
  6360 0000484F F605[4C6F0000]10                        test    byte [cpuid_flags], 10h ; timelog_start rdtsc_synth
  6361 00004856 740E                                    jz      short .no_rdtsc_supported@@@
  6362 00004858 0F31                                    rdtsc
  6363 0000485A 2905[F4700000]                          sub     [rdtsc_synth], eax
  6364 00004860 1915[F8700000]                          sbb     [rdtsc_synth+4], edx
  6365                                  
  6366                                  .no_rdtsc_supported@@@:
  6367 00004866 E888000000                              call    mp3_synth_filter_this_16bit_shift_0_slow
  6368 0000486B F605[4C6F0000]10                        test    byte [cpuid_flags], 10h ; timelog_end rdtsc_synth
  6369 00004872 740E                                    jz      short .no_rdtsc_supported@@@@
  6370 00004874 0F31                                    rdtsc
  6371 00004876 0105[F4700000]                          add     [rdtsc_synth], eax
  6372 0000487C 1115[F8700000]                          adc     [rdtsc_synth+4], edx
  6373                                  
  6374                                  .no_rdtsc_supported@@@@:
  6375 00004882 5E                                      pop     esi
  6376 00004883 A1[74ED0000]                            mov     eax, [mp3_samples_dst_step]
  6377 00004888 C1E005                                  shl     eax, 5
  6378 0000488B 8A0D[486F0000]                          mov     cl, [option_rate_shift]
  6379 00004891 D3E8                                    shr     eax, cl
  6380 00004893 0105[BA960000]                          add     [mp3_curr_syn_dst], eax
  6381 00004899 81C680000000                            add     esi, 128        ; SBLIMIT*4
  6382 0000489F FF05[80ED0000]                          inc     dword [mp3_curr_frame]
  6383 000048A5 A1[80ED0000]                            mov     eax, [mp3_curr_frame]
  6384 000048AA 3B05[BE960000]                          cmp     eax, [mp3_nb_frames]
  6385 000048B0 0F8234FFFFFF                            jb      .synth_frame_lop
  6386 000048B6 5F                                      pop     edi
  6387 000048B7 5E                                      pop     esi
  6388 000048B8 033D[B2960000]                          add     edi, [mp3_bytes_per_sample]
  6389 000048BE 81C600120000                            add     esi, 4608       ; 36*SBLIMIT*4
  6390 000048C4 FF05[78ED0000]                          inc     dword [mp3_curr_channel]
  6391 000048CA A1[78ED0000]                            mov     eax, [mp3_curr_channel]
  6392 000048CF 3B05[AA960000]                          cmp     eax, [mp3_output_num_channels]
  6393 000048D5 0F82FDFEFFFF                            jb      .synth_channel_lop
  6394 000048DB F605[4C6F0000]10                        test    byte [cpuid_flags], 10h ; timelog_end rdtsc_synth_dct
  6395 000048E2 740E                                    jz      short .no_rdtsc_supported@@@@@
  6396 000048E4 0F31                                    rdtsc
  6397 000048E6 0105[C4700000]                          add     [rdtsc_synth_dct], eax
  6398 000048EC 1115[C8700000]                          adc     [rdtsc_synth_dct+4], edx
  6399                                  
  6400                                  .no_rdtsc_supported@@@@@:
  6401 000048F2 C3                                      retn
  6402                                  
  6403                                  
  6404                                  ; =============== S U B R O U T I N E =======================================
  6405                                  
  6406                                  
  6407                                  mp3_synth_filter_this_16bit_shift_0_slow:
  6408 000048F3 A1[B6960000]                            mov     eax, [mp3_curr_syn_index]
  6409 000048F8 A9E0010000                              test    eax, 1E0h       ; 1FFh-1Fh
  6410 000048FD 0F847C010000                            jz      .append_copy_to_window
  6411 00004903 90                                      nop
  6412                                  
  6413                                  .append_copy_to_window_back:
  6414 00004904 89C5                                    mov     ebp, eax        ; mov @@win1,eax
  6415 00004906 81E5C0010000                            and     ebp, 1C0h       ; and @@win1,1FFh-1Fh-20h
  6416 0000490C 2520040000                              and     eax, 420h       ; and eax,20h+(1 shl 10) ; bit5, and channel
  6417 00004911 8D7010                                  lea     esi, [eax+10h]  ; lea @@syn1,[eax+10h]
  6418 00004914 8D7830                                  lea     edi, [eax+30h]  ; lea @@syn2,[eax+30h]
  6419 00004917 F7DD                                    neg     ebp
  6420 00004919 81E5C0010000                            and     ebp, 1C0h       ; and @@win1,1FFh-1Fh-20h
  6421 0000491F 8B0D[BA960000]                          mov     ecx, [mp3_curr_syn_dst]
  6422                                  
  6423                                  .samples_lop:
  6424 00004925 BB10001000                              mov     ebx, 100010h    ; mov @@sum,(8000h SHL (@@out_shift))+(1 SHL (@@out_shift-1))
  6425                                                                          ; @@out_shift = 5
  6426                                  
  6427                                  .SUM8_@:                                ; @@SUM8 macro sum,win,ww,syn
  6428 0000492A 8B14B5[D2960000]                        mov     edx, [mp3_synth_buf+esi*4] ; IRP nn,0,1,2,3,4,5,6,7
  6429                                                                          ; @@SUM8 @@sum,@@win1,0, @@syn1
  6430 00004931 8B04AD[88E80400]                        mov     eax, [mp3_synth_win+ebp*4] ; [mp3_synth_buf+syn*4+(nn*64*4)]
  6431 00004938 F7EA                                    imul    edx             ; [mp3_synth_win+win*4+(nn*64*4)+ww*4]
  6432 0000493A 01D3                                    add     ebx, edx
  6433 0000493C 8B14B5[D2970000]                        mov     edx, [(mp3_synth_buf+100h)+esi*4]
  6434 00004943 8B04AD[88E90400]                        mov     eax, [(mp3_synth_win+100h)+ebp*4]
  6435 0000494A F7EA                                    imul    edx
  6436 0000494C 01D3                                    add     ebx, edx        ; add sum,edx
  6437 0000494E 8B14B5[D2980000]                        mov     edx, [(mp3_synth_buf+200h)+esi*4]
  6438 00004955 8B04AD[88EA0400]                        mov     eax, [(mp3_synth_win+200h)+ebp*4] ; [mp3_synth_win+win*4+(nn*64*4)+ww*4]
  6439 0000495C F7EA                                    imul    edx             ; 64bit = 32bit * 32bit
  6440 0000495E 01D3                                    add     ebx, edx
  6441 00004960 8B14B5[D2990000]                        mov     edx, [(mp3_synth_buf+300h)+esi*4]
  6442 00004967 8B04AD[88EB0400]                        mov     eax, [(mp3_synth_win+300h)+ebp*4]
  6443 0000496E F7EA                                    imul    edx
  6444 00004970 01D3                                    add     ebx, edx
  6445 00004972 8B14B5[D29A0000]                        mov     edx, [(mp3_synth_buf+400h)+esi*4]
  6446 00004979 8B04AD[88EC0400]                        mov     eax, [(mp3_synth_win+400h)+ebp*4]
  6447 00004980 F7EA                                    imul    edx
  6448 00004982 01D3                                    add     ebx, edx
  6449 00004984 8B14B5[D29B0000]                        mov     edx, [(mp3_synth_buf+500h)+esi*4]
  6450 0000498B 8B04AD[88ED0400]                        mov     eax, [(mp3_synth_win+500h)+ebp*4]
  6451 00004992 F7EA                                    imul    edx
  6452 00004994 01D3                                    add     ebx, edx
  6453 00004996 8B14B5[D29C0000]                        mov     edx, [(mp3_synth_buf+600h)+esi*4]
  6454 0000499D 8B04AD[88EE0400]                        mov     eax, [(mp3_synth_win+600h)+ebp*4]
  6455 000049A4 F7EA                                    imul    edx
  6456 000049A6 01D3                                    add     ebx, edx
  6457 000049A8 8B14B5[D29D0000]                        mov     edx, [(mp3_synth_buf+700h)+esi*4]
  6458 000049AF 8B04AD[88EF0400]                        mov     eax, [(mp3_synth_win+700h)+ebp*4]
  6459 000049B6 F7EA                                    imul    edx
  6460 000049B8 01D3                                    add     ebx, edx
  6461                                  
  6462                                  .skippp:                               ; @@SUM8 macro sum,win,ww,syn
  6463 000049BA 8B14BD[D2960000]                        mov     edx, [mp3_synth_buf+edi*4] ; @@SUM8 @@sum,@@win1,32,@@syn2
  6464                                                                          ; [mp3_synth_buf+syn*4+(nn*64*4)]
  6465 000049C1 8B04AD[08E90400]                        mov     eax, [(mp3_synth_win+80h)+ebp*4] ; [mp3_synth_win+win*4+(nn*64*4)+ww*4]
  6466 000049C8 F7EA                                    imul    edx
  6467 000049CA 01D3                                    add     ebx, edx
  6468 000049CC 8B14BD[D2970000]                        mov     edx, [(mp3_synth_buf+100h)+edi*4]
  6469 000049D3 8B04AD[08EA0400]                        mov     eax, [(mp3_synth_win+180h)+ebp*4]
  6470 000049DA F7EA                                    imul    edx
  6471 000049DC 01D3                                    add     ebx, edx
  6472 000049DE 8B14BD[D2980000]                        mov     edx, [(mp3_synth_buf+200h)+edi*4]
  6473 000049E5 8B04AD[08EB0400]                        mov     eax, [(mp3_synth_win+280h)+ebp*4]
  6474 000049EC F7EA                                    imul    edx
  6475 000049EE 01D3                                    add     ebx, edx
  6476 000049F0 8B14BD[D2990000]                        mov     edx, [(mp3_synth_buf+300h)+edi*4]
  6477 000049F7 8B04AD[08EC0400]                        mov     eax, [(mp3_synth_win+380h)+ebp*4]
  6478 000049FE F7EA                                    imul    edx
  6479 00004A00 01D3                                    add     ebx, edx
  6480 00004A02 8B14BD[D29A0000]                        mov     edx, [(mp3_synth_buf+400h)+edi*4]
  6481 00004A09 8B04AD[08ED0400]                        mov     eax, [(mp3_synth_win+480h)+ebp*4]
  6482 00004A10 F7EA                                    imul    edx
  6483 00004A12 01D3                                    add     ebx, edx
  6484 00004A14 8B14BD[D29B0000]                        mov     edx, [(mp3_synth_buf+500h)+edi*4]
  6485 00004A1B 8B04AD[08EE0400]                        mov     eax, [(mp3_synth_win+580h)+ebp*4]
  6486 00004A22 F7EA                                    imul    edx
  6487 00004A24 01D3                                    add     ebx, edx
  6488 00004A26 8B14BD[D29C0000]                        mov     edx, [(mp3_synth_buf+600h)+edi*4]
  6489 00004A2D 8B04AD[08EF0400]                        mov     eax, [(mp3_synth_win+680h)+ebp*4]
  6490 00004A34 F7EA                                    imul    edx
  6491 00004A36 01D3                                    add     ebx, edx
  6492 00004A38 8B14BD[D29D0000]                        mov     edx, [(mp3_synth_buf+700h)+edi*4]
  6493 00004A3F 8B04AD[08F00400]                        mov     eax, [(mp3_synth_win+780h)+ebp*4]
  6494 00004A46 F7EA                                    imul    edx
  6495 00004A48 01D3                                    add     ebx, edx
  6496 00004A4A 81FB00002000                            cmp     ebx, 200000h    ; cmp @@sum,10000h SHL (@@out_shift)
  6497 00004A50 7322                                    jnb     short .sat
  6498 00004A52 C1FB05                                  sar     ebx, 5          ; sar @@sum,(@@out_shift)
  6499 00004A55 81EB00800000                            sub     ebx, 8000h      ; make 16bit signed
  6500                                  
  6501                                  .sat_back:
  6502 00004A5B 668919                                  mov     [ecx], bx
  6503 00004A5E 030D[74ED0000]                          add     ecx, [mp3_samples_dst_step]
  6504 00004A64 46                                      inc     esi             ; inc @@syn1
  6505 00004A65 4F                                      dec     edi             ; dec @@syn2
  6506 00004A66 45                                      inc     ebp             ; inc @@win1
  6507 00004A67 F7C51F000000                            test    ebp, 1Fh        ; test @@win1,1Fh
  6508 00004A6D 0F85B2FEFFFF                            jnz     .samples_lop
  6509 00004A73 C3                                      retn
  6510                                  
  6511                                  .sat:
  6512 00004A74 C1FB1F                                  sar     ebx, 31         ; FFFFFFFFh,00000000h
  6513 00004A77 81F3FF7F0000                            xor     ebx, 7FFFh      ; FFFF8000h,00007FFFh (signed 16bit)
  6514 00004A7D EBDC                                    jmp     short .sat_back
  6515                                  
  6516                                  .append_copy_to_window:
  6517 00004A7F 8D3485[D2960000]                        lea     esi, [mp3_synth_buf+eax*4]
  6518 00004A86 8DBE00080000                            lea     edi, [esi+2048] ; [esi+512*4]
  6519 00004A8C B912000000                              mov     ecx, 18         ; (12h*4)/4
  6520 00004A91 F3A5                                    rep movsd
  6521 00004A93 E96CFEFFFF                              jmp     .append_copy_to_window_back
  6522                                  
  6523                                  
  6524                                  ; =============== S U B R O U T I N E =======================================
  6525                                  
  6526                                  
  6527                                  synth_16bit_shift_1_slow:
  6528 00004A98 F605[4C6F0000]10                        test    byte [cpuid_flags], 10h ; SYNTH_MACRO 0,1,0
  6529 00004A9F 740E                                    jz      short .no_rdtsc_supported
  6530 00004AA1 0F31                                    rdtsc
  6531 00004AA3 2905[C4700000]                          sub     [rdtsc_synth_dct], eax
  6532 00004AA9 1915[C8700000]                          sbb     [rdtsc_synth_dct+4], edx
  6533                                  
  6534                                  .no_rdtsc_supported:
  6535 00004AAF BE[DAB60000]                            mov	esi, mp3_sb_samples
  6536 00004AB4 8B3D[6CED0000]                          mov	edi, [mp3_samples_dst]
  6537 00004ABA C705[78ED0000]0000-                     mov	dword [mp3_curr_channel], 0
  6537 00004AC2 0000               
  6538                                  
  6539                                  .synth_channel_lop:
  6540 00004AC4 56                                      push	esi
  6541 00004AC5 57                                      push	edi
  6542 00004AC6 893D[BA960000]                          mov	[mp3_curr_syn_dst], edi
  6543 00004ACC C705[80ED0000]0000-                     mov	dword [mp3_curr_frame], 0
  6543 00004AD4 0000               
  6544                                  
  6545                                  .synth_frame_lop:
  6546 00004AD6 56                                      push    esi
  6547 00004AD7 F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
  6548 00004ADE 740E                                    jz      short .no_rdtsc_supported@
  6549 00004AE0 0F31                                    rdtsc
  6550 00004AE2 2905[DC700000]                          sub     [rdtsc_dct32], eax
  6551 00004AE8 1915[E0700000]                          sbb     [rdtsc_dct32+4], edx
  6552                                  
  6553                                  .no_rdtsc_supported@:
  6554 00004AEE 8B15[78ED0000]                          mov     edx, [mp3_curr_channel]
  6555 00004AF4 8B0495[D2B60000]                        mov     eax, [mp3_synth_index+edx*4]
  6556 00004AFB 832C95[D2B60000]20                      sub     dword [mp3_synth_index+edx*4], 32
  6557 00004B03 C1E20A                                  shl     edx, 10         ; channel*1024
  6558 00004B06 25E0010000                              and     eax, 1E0h       ; 1FFh-1Fh ; index(0..511), align 32
  6559 00004B0B 09D0                                    or      eax, edx
  6560 00004B0D A3[B6960000]                            mov     [mp3_curr_syn_index], eax
  6561 00004B12 8B3D[B6960000]                          mov     edi, [mp3_curr_syn_index]
  6562 00004B18 8D3CBD[D2960000]                        lea     edi, [mp3_synth_buf+edi*4]
  6563 00004B1F E858E3FFFF                              call    mp3_dct32_shift_1 ; call mp3_dct32_shift_&rate_shift
  6564 00004B24 F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
  6565 00004B2B 740E                                    jz      short .no_rdtsc_supported@@
  6566 00004B2D 0F31                                    rdtsc
  6567 00004B2F 0105[DC700000]                          add     [rdtsc_dct32], eax
  6568 00004B35 1115[E0700000]                          adc     [rdtsc_dct32+4], edx
  6569                                  
  6570                                  .no_rdtsc_supported@@:
  6571 00004B3B F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
  6572 00004B42 740E                                    jz      short .no_rdtsc_supported@@@
  6573 00004B44 0F31                                    rdtsc
  6574 00004B46 2905[F4700000]                          sub     [rdtsc_synth], eax
  6575 00004B4C 1915[F8700000]                          sbb     [rdtsc_synth+4], edx
  6576                                  
  6577                                  .no_rdtsc_supported@@@:
  6578 00004B52 E888000000                              call    mp3_synth_filter_this_16bit_shift_1_slow ;
  6579                                                                          ; mp3_synth_filter_this_&force_8bit&_&rate_shift&_&force_fast
  6580 00004B57 F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
  6581 00004B5E 740E                                    jz      short .no_rdtsc_supported@@@@
  6582 00004B60 0F31                                    rdtsc
  6583 00004B62 0105[F4700000]                          add     [rdtsc_synth], eax
  6584 00004B68 1115[F8700000]                          adc     [rdtsc_synth+4], edx
  6585                                  
  6586                                  .no_rdtsc_supported@@@@:
  6587 00004B6E 5E                                      pop     esi
  6588 00004B6F A1[74ED0000]                            mov     eax, [mp3_samples_dst_step]
  6589 00004B74 C1E005                                  shl     eax, 5
  6590 00004B77 8A0D[486F0000]                          mov     cl, [option_rate_shift] ; IF with_rate_shift
  6591 00004B7D D3E8                                    shr     eax, cl
  6592 00004B7F 0105[BA960000]                          add     [mp3_curr_syn_dst], eax
  6593 00004B85 81C680000000                            add     esi, 128        ; SBLIMIT*4  ; src+32*4
  6594 00004B8B FF05[80ED0000]                          inc	dword [mp3_curr_frame]
  6595 00004B91 A1[80ED0000]                            mov     eax, [mp3_curr_frame]
  6596 00004B96 3B05[BE960000]                          cmp     eax, [mp3_nb_frames]
  6597 00004B9C 0F8234FFFFFF                            jb      .synth_frame_lop
  6598 00004BA2 5F                                      pop     edi
  6599 00004BA3 5E                                      pop     esi
  6600 00004BA4 033D[B2960000]                          add     edi, [mp3_bytes_per_sample]
  6601 00004BAA 81C600120000                            add     esi, 4608       ; 36*SBLIMIT*4 ; src
  6602 00004BB0 FF05[78ED0000]                          inc	dword [mp3_curr_channel]
  6603 00004BB6 A1[78ED0000]                            mov     eax, [mp3_curr_channel]
  6604 00004BBB 3B05[AA960000]                          cmp     eax, [mp3_output_num_channels]
  6605 00004BC1 0F82FDFEFFFF                            jb      .synth_channel_lop
  6606 00004BC7 F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
  6607 00004BCE 740E                                    jz      short .no_rdtsc_supported@@@@@
  6608 00004BD0 0F31                                    rdtsc
  6609 00004BD2 0105[C4700000]                          add     [rdtsc_synth_dct], eax
  6610 00004BD8 1115[C8700000]                          adc     [rdtsc_synth_dct+4], edx
  6611                                  
  6612                                  .no_rdtsc_supported@@@@@:
  6613 00004BDE C3                                      retn
  6614                                  
  6615                                  
  6616                                  ; =============== S U B R O U T I N E =======================================
  6617                                  
  6618                                  
  6619                                  mp3_synth_filter_this_16bit_shift_1_slow:
  6620 00004BDF A1[B6960000]                            mov     eax, [mp3_curr_syn_index]
  6621 00004BE4 A9E0010000                              test    eax, 1E0h
  6622 00004BE9 0F8482010000                            jz      .append_copy_to_window
  6623 00004BEF 90                                      nop
  6624                                  
  6625                                  .append_copy_to_window_back:
  6626 00004BF0 89C5                                    mov     ebp, eax
  6627 00004BF2 81E5C0010000                            and     ebp, 1C0h
  6628 00004BF8 2520040000                              and     eax, 420h
  6629 00004BFD 8D7010                                  lea     esi, [eax+10h]
  6630 00004C00 8D7830                                  lea     edi, [eax+30h]
  6631 00004C03 F7DD                                    neg     ebp
  6632 00004C05 81E5C0010000                            and     ebp, 1C0h
  6633 00004C0B 8B0D[BA960000]                          mov     ecx, [mp3_curr_syn_dst]
  6634                                  
  6635                                  .samples_lop:
  6636 00004C11 BB10001000                              mov     ebx, 100010h
  6637 00004C16 8B14B5[D2960000]                        mov     edx, [mp3_synth_buf+esi*4]
  6638 00004C1D 8B04AD[88E80400]                        mov     eax, [mp3_synth_win+ebp*4]
  6639 00004C24 F7EA                                    imul    edx
  6640 00004C26 01D3                                    add     ebx, edx
  6641 00004C28 8B14B5[D2970000]                        mov     edx, [(mp3_synth_buf+100h)+esi*4]
  6642 00004C2F 8B04AD[88E90400]                        mov     eax, [(mp3_synth_win+100h)+ebp*4]
  6643 00004C36 F7EA                                    imul    edx
  6644 00004C38 01D3                                    add     ebx, edx
  6645 00004C3A 8B14B5[D2980000]                        mov     edx, [(mp3_synth_buf+200h)+esi*4]
  6646 00004C41 8B04AD[88EA0400]                        mov     eax, [(mp3_synth_win+200h)+ebp*4]
  6647 00004C48 F7EA                                    imul    edx
  6648 00004C4A 01D3                                    add     ebx, edx
  6649 00004C4C 8B14B5[D2990000]                        mov     edx, [(mp3_synth_buf+300h)+esi*4]
  6650 00004C53 8B04AD[88EB0400]                        mov     eax, [(mp3_synth_win+300h)+ebp*4]
  6651 00004C5A F7EA                                    imul    edx
  6652 00004C5C 01D3                                    add     ebx, edx
  6653 00004C5E 8B14B5[D29A0000]                        mov     edx, [(mp3_synth_buf+400h)+esi*4]
  6654 00004C65 8B04AD[88EC0400]                        mov     eax, [(mp3_synth_win+400h)+ebp*4]
  6655 00004C6C F7EA                                    imul    edx
  6656 00004C6E 01D3                                    add     ebx, edx
  6657 00004C70 8B14B5[D29B0000]                        mov     edx, [(mp3_synth_buf+500h)+esi*4]
  6658 00004C77 8B04AD[88ED0400]                        mov     eax, [(mp3_synth_win+500h)+ebp*4]
  6659 00004C7E F7EA                                    imul    edx
  6660 00004C80 01D3                                    add     ebx, edx
  6661 00004C82 8B14B5[D29C0000]                        mov     edx, [(mp3_synth_buf+600h)+esi*4]
  6662 00004C89 8B04AD[88EE0400]                        mov     eax, [(mp3_synth_win+600h)+ebp*4]
  6663 00004C90 F7EA                                    imul    edx
  6664 00004C92 01D3                                    add     ebx, edx
  6665 00004C94 8B14B5[D29D0000]                        mov     edx, [(mp3_synth_buf+700h)+esi*4]
  6666 00004C9B 8B04AD[88EF0400]                        mov     eax, [(mp3_synth_win+700h)+ebp*4]
  6667 00004CA2 F7EA                                    imul    edx
  6668 00004CA4 01D3                                    add     ebx, edx
  6669 00004CA6 8B14BD[D2960000]                        mov     edx, [mp3_synth_buf+edi*4]
  6670 00004CAD 8B04AD[08E90400]                        mov     eax, [(mp3_synth_win+80h)+ebp*4]
  6671 00004CB4 F7EA                                    imul    edx
  6672 00004CB6 01D3                                    add     ebx, edx
  6673 00004CB8 8B14BD[D2970000]                        mov     edx, [(mp3_synth_buf+100h)+edi*4]
  6674 00004CBF 8B04AD[08EA0400]                        mov     eax, [(mp3_synth_win+180h)+ebp*4]
  6675 00004CC6 F7EA                                    imul    edx
  6676 00004CC8 01D3                                    add     ebx, edx
  6677 00004CCA 8B14BD[D2980000]                        mov     edx, [(mp3_synth_buf+200h)+edi*4]
  6678 00004CD1 8B04AD[08EB0400]                        mov     eax, [(mp3_synth_win+280h)+ebp*4]
  6679 00004CD8 F7EA                                    imul    edx
  6680 00004CDA 01D3                                    add     ebx, edx
  6681 00004CDC 8B14BD[D2990000]                        mov     edx, [(mp3_synth_buf+300h)+edi*4]
  6682 00004CE3 8B04AD[08EC0400]                        mov     eax, [(mp3_synth_win+380h)+ebp*4]
  6683 00004CEA F7EA                                    imul    edx
  6684 00004CEC 01D3                                    add     ebx, edx
  6685 00004CEE 8B14BD[D29A0000]                        mov     edx, [(mp3_synth_buf+400h)+edi*4]
  6686 00004CF5 8B04AD[08ED0400]                        mov     eax, [(mp3_synth_win+480h)+ebp*4]
  6687 00004CFC F7EA                                    imul    edx
  6688 00004CFE 01D3                                    add     ebx, edx
  6689 00004D00 8B14BD[D29B0000]                        mov     edx, [(mp3_synth_buf+500h)+edi*4]
  6690 00004D07 8B04AD[08EE0400]                        mov     eax, [(mp3_synth_win+580h)+ebp*4]
  6691 00004D0E F7EA                                    imul    edx
  6692 00004D10 01D3                                    add     ebx, edx
  6693 00004D12 8B14BD[D29C0000]                        mov     edx, [(mp3_synth_buf+600h)+edi*4]
  6694 00004D19 8B04AD[08EF0400]                        mov     eax, [(mp3_synth_win+680h)+ebp*4]
  6695 00004D20 F7EA                                    imul    edx
  6696 00004D22 01D3                                    add     ebx, edx
  6697 00004D24 8B14BD[D29D0000]                        mov     edx, [(mp3_synth_buf+700h)+edi*4]
  6698 00004D2B 8B04AD[08F00400]                        mov     eax, [(mp3_synth_win+780h)+ebp*4]
  6699 00004D32 F7EA                                    imul    edx
  6700 00004D34 01D3                                    add     ebx, edx
  6701 00004D36 81FB00002000                            cmp     ebx, 200000h
  6702 00004D3C 7328                                    jnb     short .sat
  6703 00004D3E C1FB05                                  sar     ebx, 5
  6704 00004D41 81EB00800000                            sub     ebx, 8000h
  6705                                  
  6706                                  .sat_back:
  6707 00004D47 668919                                  mov     [ecx], bx
  6708 00004D4A 030D[74ED0000]                          add     ecx, [mp3_samples_dst_step]
  6709 00004D50 83C602                                  add     esi, 2
  6710 00004D53 83EF02                                  sub     edi, 2
  6711 00004D56 83C502                                  add     ebp, 2
  6712 00004D59 F7C51F000000                            test    ebp, 1Fh
  6713 00004D5F 0F85ACFEFFFF                            jnz     .samples_lop
  6714 00004D65 C3                                      retn
  6715                                  
  6716                                  .sat:
  6717 00004D66 C1FB1F                                  sar     ebx, 31
  6718 00004D69 81F3FF7F0000                            xor     ebx, 7FFFh
  6719 00004D6F EBD6                                    jmp     short .sat_back
  6720                                  
  6721                                  .append_copy_to_window:
  6722 00004D71 8D3485[D2960000]                        lea     esi, [mp3_synth_buf+eax*4]
  6723 00004D78 8DBE00080000                            lea     edi, [esi+2048]
  6724 00004D7E B912000000                              mov     ecx, 18
  6725 00004D83 F3A5                                    rep movsd
  6726 00004D85 E966FEFFFF                              jmp     .append_copy_to_window_back
  6727                                  
  6728                                  
  6729                                  ; =============== S U B R O U T I N E =======================================
  6730                                  
  6731                                  
  6732                                  synth_16bit_shift_2_slow:
  6733 00004D8A F605[4C6F0000]10                        test    byte [cpuid_flags], 10h ; SYNTH_MACRO 0,2,0
  6734 00004D91 740E                                    jz      short .no_rdtsc_supported
  6735 00004D93 0F31                                    rdtsc
  6736 00004D95 2905[C4700000]                          sub     [rdtsc_synth_dct], eax
  6737 00004D9B 1915[C8700000]                          sbb     [rdtsc_synth_dct+4], edx
  6738                                  
  6739                                  .no_rdtsc_supported:
  6740 00004DA1 BE[DAB60000]                            mov	esi, mp3_sb_samples
  6741 00004DA6 8B3D[6CED0000]                          mov	edi, [mp3_samples_dst]
  6742 00004DAC C705[78ED0000]0000-                     mov	dword [mp3_curr_channel], 0
  6742 00004DB4 0000               
  6743                                  
  6744                                  .synth_channel_lop:
  6745 00004DB6 56                                      push	esi
  6746 00004DB7 57                                      push	edi
  6747 00004DB8 893D[BA960000]                          mov	[mp3_curr_syn_dst], edi
  6748 00004DBE C705[80ED0000]0000-                     mov	dword [mp3_curr_frame], 0
  6748 00004DC6 0000               
  6749                                  
  6750                                  .synth_frame_lop:
  6751 00004DC8 56                                      push    esi
  6752 00004DC9 F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
  6753 00004DD0 740E                                    jz      short .no_rdtsc_supported@
  6754 00004DD2 0F31                                    rdtsc
  6755 00004DD4 2905[DC700000]                          sub     [rdtsc_dct32], eax
  6756 00004DDA 1915[E0700000]                          sbb     [rdtsc_dct32+4], edx
  6757                                  
  6758                                  .no_rdtsc_supported@:
  6759 00004DE0 8B15[78ED0000]                          mov     edx, [mp3_curr_channel]
  6760 00004DE6 8B0495[D2B60000]                        mov     eax, [mp3_synth_index+edx*4]
  6761 00004DED 832C95[D2B60000]20                      sub     dword [mp3_synth_index+edx*4], 32
  6762 00004DF5 C1E20A                                  shl     edx, 10
  6763 00004DF8 25E0010000                              and     eax, 1E0h       ; 1FFh-1Fh
  6764 00004DFD 09D0                                    or      eax, edx
  6765 00004DFF A3[B6960000]                            mov     [mp3_curr_syn_index], eax
  6766 00004E04 8B3D[B6960000]                          mov     edi, [mp3_curr_syn_index]
  6767 00004E0A 8D3CBD[D2960000]                        lea     edi, [mp3_synth_buf+edi*4]
  6768 00004E11 E856E4FFFF                              call    mp3_dct32_shift_2 ; call mp3_dct32_shift_&rate_shift
  6769 00004E16 F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
  6770 00004E1D 740E                                    jz      short .no_rdtsc_supported@@
  6771 00004E1F 0F31                                    rdtsc
  6772 00004E21 0105[DC700000]                          add     [rdtsc_dct32], eax
  6773 00004E27 1115[E0700000]                          adc     [rdtsc_dct32+4], edx
  6774                                  
  6775                                  .no_rdtsc_supported@@:
  6776 00004E2D F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
  6777 00004E34 740E                                    jz      short .no_rdtsc_supported@@@
  6778 00004E36 0F31                                    rdtsc
  6779 00004E38 2905[F4700000]                          sub     [rdtsc_synth], eax
  6780 00004E3E 1915[F8700000]                          sbb     [rdtsc_synth+4], edx
  6781                                  
  6782                                  .no_rdtsc_supported@@@:
  6783 00004E44 E888000000                              call    mp3_synth_filter_this_16bit_shift_2_slow ;
  6784                                                                          ; mp3_synth_filter_this_&force_8bit&_&rate_shift&_&force_fast
  6785 00004E49 F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
  6786 00004E50 740E                                    jz      short .no_rdtsc_supported@@@@
  6787 00004E52 0F31                                    rdtsc
  6788 00004E54 0105[F4700000]                          add     [rdtsc_synth], eax
  6789 00004E5A 1115[F8700000]                          adc     [rdtsc_synth+4], edx
  6790                                  
  6791                                  .no_rdtsc_supported@@@@:
  6792 00004E60 5E                                      pop     esi
  6793 00004E61 A1[74ED0000]                            mov     eax, [mp3_samples_dst_step]
  6794 00004E66 C1E005                                  shl     eax, 5
  6795 00004E69 8A0D[486F0000]                          mov     cl, [option_rate_shift]
  6796 00004E6F D3E8                                    shr     eax, cl
  6797 00004E71 0105[BA960000]                          add     [mp3_curr_syn_dst], eax
  6798 00004E77 81C680000000                            add     esi, 128        ; SBLIMIT*4
  6799 00004E7D FF05[80ED0000]                          inc     dword [mp3_curr_frame]
  6800 00004E83 A1[80ED0000]                            mov     eax, [mp3_curr_frame]
  6801 00004E88 3B05[BE960000]                          cmp     eax, [mp3_nb_frames]
  6802 00004E8E 0F8234FFFFFF                            jb      .synth_frame_lop
  6803 00004E94 5F                                      pop     edi
  6804 00004E95 5E                                      pop     esi
  6805 00004E96 033D[B2960000]                          add     edi, [mp3_bytes_per_sample]
  6806 00004E9C 81C600120000                            add     esi, 4608       ; 36*SBLIMIT*4
  6807 00004EA2 FF05[78ED0000]                          inc     dword [mp3_curr_channel]
  6808 00004EA8 A1[78ED0000]                            mov     eax, [mp3_curr_channel]
  6809 00004EAD 3B05[AA960000]                          cmp     eax, [mp3_output_num_channels]
  6810 00004EB3 0F82FDFEFFFF                            jb      .synth_channel_lop
  6811 00004EB9 F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
  6812 00004EC0 740E                                    jz      short .no_rdtsc_supported@@@@@
  6813 00004EC2 0F31                                    rdtsc
  6814 00004EC4 0105[C4700000]                          add     [rdtsc_synth_dct], eax
  6815 00004ECA 1115[C8700000]                          adc     [rdtsc_synth_dct+4], edx
  6816                                  
  6817                                  .no_rdtsc_supported@@@@@:
  6818 00004ED0 C3                                      retn
  6819                                  
  6820                                  
  6821                                  ; =============== S U B R O U T I N E =======================================
  6822                                  
  6823                                  
  6824                                  mp3_synth_filter_this_16bit_shift_2_slow:
  6825 00004ED1 A1[B6960000]                            mov     eax, [mp3_curr_syn_index]
  6826 00004ED6 A9E0010000                              test    eax, 1E0h
  6827 00004EDB 0F8482010000                            jz      .append_copy_to_window
  6828 00004EE1 90                                      nop
  6829                                  
  6830                                  .append_copy_to_window_back:
  6831 00004EE2 89C5                                    mov     ebp, eax
  6832 00004EE4 81E5C0010000                            and     ebp, 1C0h
  6833 00004EEA 2520040000                              and     eax, 420h
  6834 00004EEF 8D7010                                  lea     esi, [eax+10h]
  6835 00004EF2 8D7830                                  lea     edi, [eax+30h]
  6836 00004EF5 F7DD                                    neg     ebp
  6837 00004EF7 81E5C0010000                            and     ebp, 1C0h
  6838 00004EFD 8B0D[BA960000]                          mov     ecx, [mp3_curr_syn_dst]
  6839                                  
  6840                                  .samples_lop:
  6841 00004F03 BB10001000                              mov     ebx, 100010h
  6842 00004F08 8B14B5[D2960000]                        mov     edx, [mp3_synth_buf+esi*4]
  6843 00004F0F 8B04AD[88E80400]                        mov     eax, [mp3_synth_win+ebp*4]
  6844 00004F16 F7EA                                    imul    edx
  6845 00004F18 01D3                                    add     ebx, edx
  6846 00004F1A 8B14B5[D2970000]                        mov     edx, [(mp3_synth_buf+100h)+esi*4]
  6847 00004F21 8B04AD[88E90400]                        mov     eax, [(mp3_synth_win+100h)+ebp*4]
  6848 00004F28 F7EA                                    imul    edx
  6849 00004F2A 01D3                                    add     ebx, edx
  6850 00004F2C 8B14B5[D2980000]                        mov     edx, [(mp3_synth_buf+200h)+esi*4]
  6851 00004F33 8B04AD[88EA0400]                        mov     eax, [(mp3_synth_win+200h)+ebp*4]
  6852 00004F3A F7EA                                    imul    edx
  6853 00004F3C 01D3                                    add     ebx, edx
  6854 00004F3E 8B14B5[D2990000]                        mov     edx, [(mp3_synth_buf+300h)+esi*4]
  6855 00004F45 8B04AD[88EB0400]                        mov     eax, [(mp3_synth_win+300h)+ebp*4]
  6856 00004F4C F7EA                                    imul    edx
  6857 00004F4E 01D3                                    add     ebx, edx
  6858 00004F50 8B14B5[D29A0000]                        mov     edx, [(mp3_synth_buf+400h)+esi*4]
  6859 00004F57 8B04AD[88EC0400]                        mov     eax, [(mp3_synth_win+400h)+ebp*4]
  6860 00004F5E F7EA                                    imul    edx
  6861 00004F60 01D3                                    add     ebx, edx
  6862 00004F62 8B14B5[D29B0000]                        mov     edx, [(mp3_synth_buf+500h)+esi*4]
  6863 00004F69 8B04AD[88ED0400]                        mov     eax, [(mp3_synth_win+500h)+ebp*4]
  6864 00004F70 F7EA                                    imul    edx
  6865 00004F72 01D3                                    add     ebx, edx
  6866 00004F74 8B14B5[D29C0000]                        mov     edx, [(mp3_synth_buf+600h)+esi*4]
  6867 00004F7B 8B04AD[88EE0400]                        mov     eax, [(mp3_synth_win+600h)+ebp*4]
  6868 00004F82 F7EA                                    imul    edx
  6869 00004F84 01D3                                    add     ebx, edx
  6870 00004F86 8B14B5[D29D0000]                        mov     edx, [(mp3_synth_buf+700h)+esi*4]
  6871 00004F8D 8B04AD[88EF0400]                        mov     eax, [(mp3_synth_win+700h)+ebp*4]
  6872 00004F94 F7EA                                    imul    edx
  6873 00004F96 01D3                                    add     ebx, edx
  6874 00004F98 8B14BD[D2960000]                        mov     edx, [mp3_synth_buf+edi*4]
  6875 00004F9F 8B04AD[08E90400]                        mov     eax, [(mp3_synth_win+80h)+ebp*4]
  6876 00004FA6 F7EA                                    imul    edx
  6877 00004FA8 01D3                                    add     ebx, edx
  6878 00004FAA 8B14BD[D2970000]                        mov     edx, [(mp3_synth_buf+100h)+edi*4]
  6879 00004FB1 8B04AD[08EA0400]                        mov     eax, [(mp3_synth_win+180h)+ebp*4]
  6880 00004FB8 F7EA                                    imul    edx
  6881 00004FBA 01D3                                    add     ebx, edx
  6882 00004FBC 8B14BD[D2980000]                        mov     edx, [(mp3_synth_buf+200h)+edi*4]
  6883 00004FC3 8B04AD[08EB0400]                        mov     eax, [(mp3_synth_win+280h)+ebp*4]
  6884 00004FCA F7EA                                    imul    edx
  6885 00004FCC 01D3                                    add     ebx, edx
  6886 00004FCE 8B14BD[D2990000]                        mov     edx, [(mp3_synth_buf+300h)+edi*4]
  6887 00004FD5 8B04AD[08EC0400]                        mov     eax, [(mp3_synth_win+380h)+ebp*4]
  6888 00004FDC F7EA                                    imul    edx
  6889 00004FDE 01D3                                    add     ebx, edx
  6890 00004FE0 8B14BD[D29A0000]                        mov     edx, [(mp3_synth_buf+400h)+edi*4]
  6891 00004FE7 8B04AD[08ED0400]                        mov     eax, [(mp3_synth_win+480h)+ebp*4]
  6892 00004FEE F7EA                                    imul    edx
  6893 00004FF0 01D3                                    add     ebx, edx
  6894 00004FF2 8B14BD[D29B0000]                        mov     edx, [(mp3_synth_buf+500h)+edi*4]
  6895 00004FF9 8B04AD[08EE0400]                        mov     eax, [(mp3_synth_win+580h)+ebp*4]
  6896 00005000 F7EA                                    imul    edx
  6897 00005002 01D3                                    add     ebx, edx
  6898 00005004 8B14BD[D29C0000]                        mov     edx, [(mp3_synth_buf+600h)+edi*4]
  6899 0000500B 8B04AD[08EF0400]                        mov     eax, [(mp3_synth_win+680h)+ebp*4]
  6900 00005012 F7EA                                    imul    edx
  6901 00005014 01D3                                    add     ebx, edx
  6902 00005016 8B14BD[D29D0000]                        mov     edx, [(mp3_synth_buf+700h)+edi*4]
  6903 0000501D 8B04AD[08F00400]                        mov     eax, [(mp3_synth_win+780h)+ebp*4]
  6904 00005024 F7EA                                    imul    edx
  6905 00005026 01D3                                    add     ebx, edx
  6906 00005028 81FB00002000                            cmp     ebx, 200000h
  6907 0000502E 7328                                    jnb     short .sat
  6908 00005030 C1FB05                                  sar     ebx, 5
  6909 00005033 81EB00800000                            sub     ebx, 8000h
  6910                                  
  6911                                  .sat_back:
  6912 00005039 668919                                  mov     [ecx], bx
  6913 0000503C 030D[74ED0000]                          add     ecx, [mp3_samples_dst_step]
  6914 00005042 83C604                                  add     esi, 4
  6915 00005045 83EF04                                  sub     edi, 4
  6916 00005048 83C504                                  add     ebp, 4
  6917 0000504B F7C51F000000                            test    ebp, 1Fh
  6918 00005051 0F85ACFEFFFF                            jnz     .samples_lop
  6919 00005057 C3                                      retn
  6920                                  
  6921                                  .sat:
  6922 00005058 C1FB1F                                  sar     ebx, 31
  6923 0000505B 81F3FF7F0000                            xor     ebx, 7FFFh
  6924 00005061 EBD6                                    jmp     short .sat_back
  6925                                  
  6926                                  .append_copy_to_window:
  6927 00005063 8D3485[D2960000]                        lea     esi, [mp3_synth_buf+eax*4]
  6928 0000506A 8DBE00080000                            lea     edi, [esi+2048]
  6929 00005070 B912000000                              mov     ecx, 18
  6930 00005075 F3A5                                    rep movsd
  6931 00005077 E966FEFFFF                              jmp     .append_copy_to_window_back
  6932                                  
  6933                                  
  6934                                  ; =============== S U B R O U T I N E =======================================
  6935                                  
  6936                                  
  6937                                  synth_8bit_shift_0_slow:
  6938 0000507C F605[4C6F0000]10                        test    byte [cpuid_flags], 10h ; SYNTH_MACRO 1,0,0
  6939 00005083 740E                                    jz      short .no_rdtsc_supported
  6940 00005085 0F31                                    rdtsc
  6941 00005087 2905[C4700000]                          sub     [rdtsc_synth_dct], eax
  6942 0000508D 1915[C8700000]                          sbb     [rdtsc_synth_dct+4], edx
  6943                                  
  6944                                  .no_rdtsc_supported:
  6945 00005093 BE[DAB60000]                            mov	esi, mp3_sb_samples
  6946 00005098 8B3D[6CED0000]                          mov	edi, [mp3_samples_dst]
  6947 0000509E C705[78ED0000]0000-                     mov	dword [mp3_curr_channel], 0
  6947 000050A6 0000               
  6948                                  
  6949                                  .synth_channel_lop:
  6950 000050A8 56                                      push	esi
  6951 000050A9 57                                      push	edi
  6952 000050AA 893D[BA960000]                          mov	[mp3_curr_syn_dst], edi
  6953 000050B0 C705[80ED0000]0000-                     mov	dword [mp3_curr_frame], 0
  6953 000050B8 0000               
  6954                                  
  6955                                  .synth_frame_lop:
  6956 000050BA 56                                      push    esi
  6957 000050BB F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
  6958 000050C2 740E                                    jz      short .no_rdtsc_supported@
  6959 000050C4 0F31                                    rdtsc
  6960 000050C6 2905[DC700000]                          sub     [rdtsc_dct32], eax
  6961 000050CC 1915[E0700000]                          sbb     [rdtsc_dct32+4], edx
  6962                                  
  6963                                  .no_rdtsc_supported@:
  6964 000050D2 8B15[78ED0000]                          mov     edx, [mp3_curr_channel]
  6965 000050D8 8B0495[D2B60000]                        mov     eax, [mp3_synth_index+edx*4]
  6966 000050DF 832C95[D2B60000]20                      sub     dword [mp3_synth_index+edx*4], 32
  6967 000050E7 C1E20A                                  shl     edx, 10
  6968 000050EA 25E0010000                              and     eax, 1E0h       ; 1FFh-1Fh
  6969 000050EF 09D0                                    or      eax, edx
  6970 000050F1 A3[B6960000]                            mov     [mp3_curr_syn_index], eax
  6971 000050F6 8B3D[B6960000]                          mov     edi, [mp3_curr_syn_index]
  6972 000050FC 8D3CBD[D2960000]                        lea     edi, [mp3_synth_buf+edi*4]
  6973 00005103 E894D4FFFF                              call    mp3_dct32_shift_0
  6974 00005108 F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
  6975 0000510F 740E                                    jz      short .no_rdtsc_supported@@
  6976 00005111 0F31                                    rdtsc
  6977 00005113 0105[DC700000]                          add     [rdtsc_dct32], eax
  6978 00005119 1115[E0700000]                          adc     [rdtsc_dct32+4], edx
  6979                                  
  6980                                  .no_rdtsc_supported@@:
  6981 0000511F F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
  6982 00005126 740E                                    jz      short .no_rdtsc_supported@@@
  6983 00005128 0F31                                    rdtsc
  6984 0000512A 2905[F4700000]                          sub     [rdtsc_synth], eax
  6985 00005130 1915[F8700000]                          sbb     [rdtsc_synth+4], edx
  6986                                  
  6987                                  .no_rdtsc_supported@@@:
  6988 00005136 E888000000                              call    mp3_synth_filter_this_8bit_shift_0_slow ;
  6989                                                                          ; mp3_synth_filter_this_&force_8bit&_&rate_shift&_&force_fast
  6990 0000513B F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
  6991 00005142 740E                                    jz      short .no_rdtsc_supported@@@@
  6992 00005144 0F31                                    rdtsc
  6993 00005146 0105[F4700000]                          add     [rdtsc_synth], eax
  6994 0000514C 1115[F8700000]                          adc     [rdtsc_synth+4], edx
  6995                                  
  6996                                  .no_rdtsc_supported@@@@:
  6997 00005152 5E                                      pop     esi
  6998 00005153 A1[74ED0000]                            mov     eax, [mp3_samples_dst_step]
  6999 00005158 C1E005                                  shl     eax, 5
  7000 0000515B 8A0D[486F0000]                          mov     cl, [option_rate_shift]
  7001 00005161 D3E8                                    shr     eax, cl
  7002 00005163 0105[BA960000]                          add     [mp3_curr_syn_dst], eax
  7003 00005169 81C680000000                            add     esi, 128        ; SBLIMIT*4
  7004 0000516F FF05[80ED0000]                          inc     dword [mp3_curr_frame]
  7005 00005175 A1[80ED0000]                            mov     eax, [mp3_curr_frame]
  7006 0000517A 3B05[BE960000]                          cmp     eax, [mp3_nb_frames]
  7007 00005180 0F8234FFFFFF                            jb      .synth_frame_lop
  7008 00005186 5F                                      pop     edi
  7009 00005187 5E                                      pop     esi
  7010 00005188 033D[B2960000]                          add     edi, [mp3_bytes_per_sample]
  7011 0000518E 81C600120000                            add     esi, 4608       ; 36*SBLIMIT*4
  7012 00005194 FF05[78ED0000]                          inc     dword [mp3_curr_channel]
  7013 0000519A A1[78ED0000]                            mov     eax, [mp3_curr_channel]
  7014 0000519F 3B05[AA960000]                          cmp     eax, [mp3_output_num_channels]
  7015 000051A5 0F82FDFEFFFF                            jb      .synth_channel_lop
  7016 000051AB F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
  7017 000051B2 740E                                    jz      short .no_rdtsc_supported@@@@@
  7018 000051B4 0F31                                    rdtsc
  7019 000051B6 0105[C4700000]                          add     [rdtsc_synth_dct], eax
  7020 000051BC 1115[C8700000]                          adc     [rdtsc_synth_dct+4], edx
  7021                                  
  7022                                  .no_rdtsc_supported@@@@@:
  7023 000051C2 C3                                      retn
  7024                                  
  7025                                  
  7026                                  ; =============== S U B R O U T I N E =======================================
  7027                                  
  7028                                  
  7029                                  mp3_synth_filter_this_8bit_shift_0_slow:
  7030 000051C3 A1[B6960000]                            mov     eax, [mp3_curr_syn_index]
  7031 000051C8 A9E0010000                              test    eax, 1E0h
  7032 000051CD 0F8471010000                            jz      .append_copy_to_window
  7033 000051D3 90                                      nop
  7034                                  
  7035                                  .append_copy_to_window_back:
  7036 000051D4 89C5                                    mov     ebp, eax
  7037 000051D6 81E5C0010000                            and     ebp, 1C0h
  7038 000051DC 2520040000                              and     eax, 420h
  7039 000051E1 8D7010                                  lea     esi, [eax+10h]
  7040 000051E4 8D7830                                  lea     edi, [eax+30h]
  7041 000051E7 F7DD                                    neg     ebp
  7042 000051E9 81E5C0010000                            and     ebp, 1C0h
  7043 000051EF 8B0D[BA960000]                          mov     ecx, [mp3_curr_syn_dst]
  7044                                  
  7045                                  .samples_lop:
  7046 000051F5 BB00101000                              mov     ebx, 101000h
  7047 000051FA 8B14B5[D2960000]                        mov     edx, [mp3_synth_buf+esi*4]
  7048 00005201 8B04AD[88E80400]                        mov     eax, [mp3_synth_win+ebp*4]
  7049 00005208 F7EA                                    imul    edx
  7050 0000520A 01D3                                    add     ebx, edx
  7051 0000520C 8B14B5[D2970000]                        mov     edx, [(mp3_synth_buf+100h)+esi*4]
  7052 00005213 8B04AD[88E90400]                        mov     eax, [(mp3_synth_win+100h)+ebp*4]
  7053 0000521A F7EA                                    imul    edx
  7054 0000521C 01D3                                    add     ebx, edx
  7055 0000521E 8B14B5[D2980000]                        mov     edx, [(mp3_synth_buf+200h)+esi*4]
  7056 00005225 8B04AD[88EA0400]                        mov     eax, [(mp3_synth_win+200h)+ebp*4]
  7057 0000522C F7EA                                    imul    edx
  7058 0000522E 01D3                                    add     ebx, edx
  7059 00005230 8B14B5[D2990000]                        mov     edx, [(mp3_synth_buf+300h)+esi*4]
  7060 00005237 8B04AD[88EB0400]                        mov     eax, [(mp3_synth_win+300h)+ebp*4]
  7061 0000523E F7EA                                    imul    edx
  7062 00005240 01D3                                    add     ebx, edx
  7063 00005242 8B14B5[D29A0000]                        mov     edx, [(mp3_synth_buf+400h)+esi*4]
  7064 00005249 8B04AD[88EC0400]                        mov     eax, [(mp3_synth_win+400h)+ebp*4]
  7065 00005250 F7EA                                    imul    edx
  7066 00005252 01D3                                    add     ebx, edx
  7067 00005254 8B14B5[D29B0000]                        mov     edx, [(mp3_synth_buf+500h)+esi*4]
  7068 0000525B 8B04AD[88ED0400]                        mov     eax, [(mp3_synth_win+500h)+ebp*4]
  7069 00005262 F7EA                                    imul    edx
  7070 00005264 01D3                                    add     ebx, edx
  7071 00005266 8B14B5[D29C0000]                        mov     edx, [(mp3_synth_buf+600h)+esi*4]
  7072 0000526D 8B04AD[88EE0400]                        mov     eax, [(mp3_synth_win+600h)+ebp*4]
  7073 00005274 F7EA                                    imul    edx
  7074 00005276 01D3                                    add     ebx, edx
  7075 00005278 8B14B5[D29D0000]                        mov     edx, [(mp3_synth_buf+700h)+esi*4]
  7076 0000527F 8B04AD[88EF0400]                        mov     eax, [(mp3_synth_win+700h)+ebp*4]
  7077 00005286 F7EA                                    imul    edx
  7078 00005288 01D3                                    add     ebx, edx
  7079 0000528A 8B14BD[D2960000]                        mov     edx, [mp3_synth_buf+edi*4]
  7080 00005291 8B04AD[08E90400]                        mov     eax, [(mp3_synth_win+80h)+ebp*4]
  7081 00005298 F7EA                                    imul    edx
  7082 0000529A 01D3                                    add     ebx, edx
  7083 0000529C 8B14BD[D2970000]                        mov     edx, [(mp3_synth_buf+100h)+edi*4]
  7084 000052A3 8B04AD[08EA0400]                        mov     eax, [(mp3_synth_win+180h)+ebp*4]
  7085 000052AA F7EA                                    imul    edx
  7086 000052AC 01D3                                    add     ebx, edx
  7087 000052AE 8B14BD[D2980000]                        mov     edx, [(mp3_synth_buf+200h)+edi*4]
  7088 000052B5 8B04AD[08EB0400]                        mov     eax, [(mp3_synth_win+280h)+ebp*4]
  7089 000052BC F7EA                                    imul    edx
  7090 000052BE 01D3                                    add     ebx, edx
  7091 000052C0 8B14BD[D2990000]                        mov     edx, [(mp3_synth_buf+300h)+edi*4]
  7092 000052C7 8B04AD[08EC0400]                        mov     eax, [(mp3_synth_win+380h)+ebp*4]
  7093 000052CE F7EA                                    imul    edx
  7094 000052D0 01D3                                    add     ebx, edx
  7095 000052D2 8B14BD[D29A0000]                        mov     edx, [(mp3_synth_buf+400h)+edi*4]
  7096 000052D9 8B04AD[08ED0400]                        mov     eax, [(mp3_synth_win+480h)+ebp*4]
  7097 000052E0 F7EA                                    imul    edx
  7098 000052E2 01D3                                    add     ebx, edx
  7099 000052E4 8B14BD[D29B0000]                        mov     edx, [(mp3_synth_buf+500h)+edi*4]
  7100 000052EB 8B04AD[08EE0400]                        mov     eax, [(mp3_synth_win+580h)+ebp*4]
  7101 000052F2 F7EA                                    imul    edx
  7102 000052F4 01D3                                    add     ebx, edx
  7103 000052F6 8B14BD[D29C0000]                        mov     edx, [(mp3_synth_buf+600h)+edi*4]
  7104 000052FD 8B04AD[08EF0400]                        mov     eax, [(mp3_synth_win+680h)+ebp*4]
  7105 00005304 F7EA                                    imul    edx
  7106 00005306 01D3                                    add     ebx, edx
  7107 00005308 8B14BD[D29D0000]                        mov     edx, [(mp3_synth_buf+700h)+edi*4]
  7108 0000530F 8B04AD[08F00400]                        mov     eax, [(mp3_synth_win+780h)+ebp*4]
  7109 00005316 F7EA                                    imul    edx
  7110 00005318 01D3                                    add     ebx, edx
  7111 0000531A 81FB00002000                            cmp     ebx, 200000h
  7112 00005320 731B                                    jnb     short .sat
  7113 00005322 C1FB0D                                  sar     ebx, 13
  7114                                  
  7115                                  .sat_back:
  7116 00005325 8819                                    mov     [ecx], bl
  7117 00005327 030D[74ED0000]                          add     ecx, [mp3_samples_dst_step]
  7118 0000532D 46                                      inc     esi
  7119 0000532E 4F                                      dec     edi
  7120 0000532F 45                                      inc     ebp
  7121 00005330 F7C51F000000                            test    ebp, 1Fh
  7122 00005336 0F85B9FEFFFF                            jnz     .samples_lop
  7123 0000533C C3                                      retn
  7124                                  
  7125                                  .sat:
  7126 0000533D C1FB1F                                  sar     ebx, 31
  7127 00005340 F7D3                                    not     ebx
  7128 00005342 EBE1                                    jmp     short .sat_back
  7129                                  
  7130                                  .append_copy_to_window:
  7131 00005344 8D3485[D2960000]                        lea     esi, [mp3_synth_buf+eax*4]
  7132 0000534B 8DBE00080000                            lea     edi, [esi+2048]
  7133 00005351 B912000000                              mov     ecx, 18
  7134 00005356 F3A5                                    rep movsd
  7135 00005358 E977FEFFFF                              jmp     .append_copy_to_window_back
  7136                                  
  7137                                  
  7138                                  ; =============== S U B R O U T I N E =======================================
  7139                                  
  7140                                  
  7141                                  synth_8bit_shift_1_slow:
  7142 0000535D F605[4C6F0000]10                        test    byte [cpuid_flags], 10h ; SYNTH_MACRO 1,1,0
  7143                                                                          ; force_8bit, rate_shift=1, force_fast=0
  7144 00005364 740E                                    jz      short .no_rdtsc_supported
  7145 00005366 0F31                                    rdtsc
  7146 00005368 2905[C4700000]                          sub     [rdtsc_synth_dct], eax
  7147 0000536E 1915[C8700000]                          sbb     [rdtsc_synth_dct+4], edx
  7148                                  
  7149                                  .no_rdtsc_supported:
  7150 00005374 BE[DAB60000]                            mov	esi, mp3_sb_samples
  7151 00005379 8B3D[6CED0000]                          mov	edi, [mp3_samples_dst]
  7152 0000537F C705[78ED0000]0000-                     mov	dword [mp3_curr_channel], 0
  7152 00005387 0000               
  7153                                  
  7154                                  .synth_channel_lop:
  7155 00005389 56                                      push	esi
  7156 0000538A 57                                      push	edi
  7157 0000538B 893D[BA960000]                          mov	[mp3_curr_syn_dst], edi
  7158 00005391 C705[80ED0000]0000-                     mov	dword [mp3_curr_frame], 0
  7158 00005399 0000               
  7159                                  
  7160                                  .synth_frame_lop:
  7161 0000539B 56                                      push    esi
  7162 0000539C F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
  7163 000053A3 740E                                    jz      short .no_rdtsc_supported@
  7164 000053A5 0F31                                    rdtsc
  7165 000053A7 2905[DC700000]                          sub     [rdtsc_dct32], eax
  7166 000053AD 1915[E0700000]                          sbb     [rdtsc_dct32+4], edx
  7167                                  
  7168                                  .no_rdtsc_supported@:
  7169 000053B3 8B15[78ED0000]                          mov     edx, [mp3_curr_channel]
  7170 000053B9 8B0495[D2B60000]                        mov     eax, [mp3_synth_index+edx*4]
  7171 000053C0 832C95[D2B60000]20                      sub     dword [mp3_synth_index+edx*4], 32
  7172 000053C8 C1E20A                                  shl     edx, 10
  7173 000053CB 25E0010000                              and     eax, 1E0h       ; 1FFh-1Fh
  7174 000053D0 09D0                                    or      eax, edx
  7175 000053D2 A3[B6960000]                            mov     [mp3_curr_syn_index], eax
  7176 000053D7 8B3D[B6960000]                          mov     edi, [mp3_curr_syn_index]
  7177 000053DD 8D3CBD[D2960000]                        lea     edi, [mp3_synth_buf+edi*4]
  7178 000053E4 E893DAFFFF                              call    mp3_dct32_shift_1 ; mp3_dct32_shift_&rate_shift ; rate_shift = 1
  7179 000053E9 F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
  7180 000053F0 740E                                    jz      short .no_rdtsc_supported@@
  7181 000053F2 0F31                                    rdtsc
  7182 000053F4 0105[DC700000]                          add     [rdtsc_dct32], eax
  7183 000053FA 1115[E0700000]                          adc     [rdtsc_dct32+4], edx
  7184                                  
  7185                                  .no_rdtsc_supported@@:
  7186 00005400 F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
  7187 00005407 740E                                    jz      short .no_rdtsc_supported@@@
  7188 00005409 0F31                                    rdtsc
  7189 0000540B 2905[F4700000]                          sub     [rdtsc_synth], eax
  7190 00005411 1915[F8700000]                          sbb     [rdtsc_synth+4], edx
  7191                                  
  7192                                  .no_rdtsc_supported@@@:
  7193 00005417 E888000000                              call    mp3_synth_filter_this_8bit_shift_1_slow ;
  7194                                                                          ; mp3_synth_filter_this_&force_8bit&_&rate_shift&_&force_fast
  7195 0000541C F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
  7196 00005423 740E                                    jz      short .no_rdtsc_supported@@@@
  7197 00005425 0F31                                    rdtsc
  7198 00005427 0105[F4700000]                          add     [rdtsc_synth], eax
  7199 0000542D 1115[F8700000]                          adc     [rdtsc_synth+4], edx
  7200                                  
  7201                                  .no_rdtsc_supported@@@@:
  7202 00005433 5E                                      pop     esi
  7203 00005434 A1[74ED0000]                            mov     eax, [mp3_samples_dst_step]
  7204 00005439 C1E005                                  shl     eax, 5          ; mul32
  7205 0000543C 8A0D[486F0000]                          mov     cl, [option_rate_shift]
  7206 00005442 D3E8                                    shr     eax, cl
  7207 00005444 0105[BA960000]                          add     [mp3_curr_syn_dst], eax
  7208 0000544A 81C680000000                            add     esi, 128        ; SBLIMIT*4
  7209 00005450 FF05[80ED0000]                          inc	dword [mp3_curr_frame]
  7210 00005456 A1[80ED0000]                            mov     eax, [mp3_curr_frame]
  7211 0000545B 3B05[BE960000]                          cmp     eax, [mp3_nb_frames]
  7212 00005461 0F8234FFFFFF                            jb      .synth_frame_lop
  7213 00005467 5F                                      pop     edi
  7214 00005468 5E                                      pop     esi
  7215 00005469 033D[B2960000]                          add     edi, [mp3_bytes_per_sample]
  7216 0000546F 81C600120000                            add     esi, 4608       ; 36*SBLIMIT*4
  7217 00005475 FF05[78ED0000]                          inc	dword [mp3_curr_channel]
  7218 0000547B A1[78ED0000]                            mov     eax, [mp3_curr_channel]
  7219 00005480 3B05[AA960000]                          cmp     eax, [mp3_output_num_channels]
  7220 00005486 0F82FDFEFFFF                            jb      .synth_channel_lop
  7221 0000548C F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
  7222 00005493 740E                                    jz      short .no_rdtsc_supported@@@@@
  7223 00005495 0F31                                    rdtsc
  7224 00005497 0105[C4700000]                          add     [rdtsc_synth_dct], eax
  7225 0000549D 1115[C8700000]                          adc     [rdtsc_synth_dct+4], edx
  7226                                  
  7227                                  .no_rdtsc_supported@@@@@:
  7228 000054A3 C3                                      retn
  7229                                  
  7230                                  
  7231                                  ; =============== S U B R O U T I N E =======================================
  7232                                  
  7233                                  
  7234                                  mp3_synth_filter_this_8bit_shift_1_slow:
  7235 000054A4 A1[B6960000]                            mov     eax, [mp3_curr_syn_index] ; IF LONG_WINDOW
  7236 000054A9 A9E0010000                              test    eax, 1E0h       ; 1FFh-1Fh
  7237 000054AE 0F8477010000                            jz      .append_copy_to_window
  7238 000054B4 90                                      nop
  7239                                  
  7240                                  .append_copy_to_window_back:
  7241 000054B5 89C5                                    mov     ebp, eax
  7242 000054B7 81E5C0010000                            and     ebp, 1C0h       ; 1FFh-1Fh-20h
  7243 000054BD 2520040000                              and     eax, 420h       ; 20h+(1 shl 10)
  7244 000054C2 8D7010                                  lea     esi, [eax+10h]
  7245 000054C5 8D7830                                  lea     edi, [eax+30h]
  7246 000054C8 F7DD                                    neg     ebp
  7247 000054CA 81E5C0010000                            and     ebp, 1C0h
  7248 000054D0 8B0D[BA960000]                          mov     ecx, [mp3_curr_syn_dst]
  7249                                  
  7250                                  .samples_lop:
  7251 000054D6 BB00101000                              mov     ebx, 101000h    ; mov @@sum,(8000h SHL (@@out_shift))+(1 SHL (@@out_shift-1))
  7252                                                                          ; @@out_shift equ (OUT_SHIFT_slow+(8*force_8bit))
  7253                                                                          ; OUT_SHIFT_slow = 5 ; @@out_shift = 13
  7254 000054DB 8B14B5[D2960000]                        mov     edx, [mp3_synth_buf+esi*4] ; @@SUM8 @@sum,@@win1,0,@@syn1
  7255                                                                          ; @@SUM8 macro sum,win,ww,syn
  7256                                                                          ;   IRP nn,0,1,2,3,4,5,6,7
  7257 000054E2 8B04AD[88E80400]                        mov     eax, [mp3_synth_win+ebp*4]
  7258 000054E9 F7EA                                    imul    edx
  7259 000054EB 01D3                                    add     ebx, edx
  7260 000054ED 8B14B5[D2970000]                        mov     edx, [(mp3_synth_buf+100h)+esi*4] ; @@syn1 equ esi
  7261 000054F4 8B04AD[88E90400]                        mov     eax, [(mp3_synth_win+100h)+ebp*4] ; @@win1 equ ebp
  7262 000054FB F7EA                                    imul    edx
  7263 000054FD 01D3                                    add     ebx, edx
  7264 000054FF 8B14B5[D2980000]                        mov     edx, [(mp3_synth_buf+200h)+esi*4]
  7265 00005506 8B04AD[88EA0400]                        mov     eax, [(mp3_synth_win+200h)+ebp*4]
  7266 0000550D F7EA                                    imul    edx
  7267 0000550F 01D3                                    add     ebx, edx
  7268 00005511 8B14B5[D2990000]                        mov     edx, [(mp3_synth_buf+300h)+esi*4]
  7269 00005518 8B04AD[88EB0400]                        mov     eax, [(mp3_synth_win+300h)+ebp*4]
  7270 0000551F F7EA                                    imul    edx
  7271 00005521 01D3                                    add     ebx, edx
  7272 00005523 8B14B5[D29A0000]                        mov     edx, [(mp3_synth_buf+400h)+esi*4]
  7273 0000552A 8B04AD[88EC0400]                        mov     eax, [(mp3_synth_win+400h)+ebp*4]
  7274 00005531 F7EA                                    imul    edx
  7275 00005533 01D3                                    add     ebx, edx
  7276 00005535 8B14B5[D29B0000]                        mov     edx, [(mp3_synth_buf+500h)+esi*4]
  7277 0000553C 8B04AD[88ED0400]                        mov     eax, [(mp3_synth_win+500h)+ebp*4]
  7278 00005543 F7EA                                    imul    edx
  7279 00005545 01D3                                    add     ebx, edx
  7280 00005547 8B14B5[D29C0000]                        mov     edx, [(mp3_synth_buf+600h)+esi*4]
  7281 0000554E 8B04AD[88EE0400]                        mov     eax, [(mp3_synth_win+600h)+ebp*4]
  7282 00005555 F7EA                                    imul    edx
  7283 00005557 01D3                                    add     ebx, edx
  7284 00005559 8B14B5[D29D0000]                        mov     edx, [(mp3_synth_buf+700h)+esi*4]
  7285 00005560 8B04AD[88EF0400]                        mov     eax, [(mp3_synth_win+700h)+ebp*4]
  7286 00005567 F7EA                                    imul    edx
  7287 00005569 01D3                                    add     ebx, edx
  7288 0000556B 8B14BD[D2960000]                        mov     edx, [mp3_synth_buf+edi*4]
  7289 00005572 8B04AD[08E90400]                        mov     eax, [(mp3_synth_win+80h)+ebp*4]
  7290 00005579 F7EA                                    imul    edx
  7291 0000557B 01D3                                    add     ebx, edx
  7292 0000557D 8B14BD[D2970000]                        mov     edx, [(mp3_synth_buf+100h)+edi*4] ; @@SUM8 @@sum,@@win1,32,@@syn2
  7293                                                                          ; @@syn2 equ edi
  7294                                                                          ; @@win1 equ ebp
  7295 00005584 8B04AD[08EA0400]                        mov     eax, [(mp3_synth_win+180h)+ebp*4]
  7296 0000558B F7EA                                    imul    edx
  7297 0000558D 01D3                                    add     ebx, edx
  7298 0000558F 8B14BD[D2980000]                        mov     edx, [(mp3_synth_buf+200h)+edi*4]
  7299 00005596 8B04AD[08EB0400]                        mov     eax, [(mp3_synth_win+280h)+ebp*4]
  7300 0000559D F7EA                                    imul    edx
  7301 0000559F 01D3                                    add     ebx, edx
  7302 000055A1 8B14BD[D2990000]                        mov     edx, [(mp3_synth_buf+300h)+edi*4]
  7303 000055A8 8B04AD[08EC0400]                        mov     eax, [(mp3_synth_win+380h)+ebp*4]
  7304 000055AF F7EA                                    imul    edx
  7305 000055B1 01D3                                    add     ebx, edx
  7306 000055B3 8B14BD[D29A0000]                        mov     edx, [(mp3_synth_buf+400h)+edi*4]
  7307 000055BA 8B04AD[08ED0400]                        mov     eax, [(mp3_synth_win+480h)+ebp*4]
  7308 000055C1 F7EA                                    imul    edx
  7309 000055C3 01D3                                    add     ebx, edx
  7310 000055C5 8B14BD[D29B0000]                        mov     edx, [(mp3_synth_buf+500h)+edi*4]
  7311 000055CC 8B04AD[08EE0400]                        mov     eax, [(mp3_synth_win+580h)+ebp*4]
  7312 000055D3 F7EA                                    imul    edx
  7313 000055D5 01D3                                    add     ebx, edx
  7314 000055D7 8B14BD[D29C0000]                        mov     edx, [(mp3_synth_buf+600h)+edi*4]
  7315 000055DE 8B04AD[08EF0400]                        mov     eax, [(mp3_synth_win+680h)+ebp*4]
  7316 000055E5 F7EA                                    imul    edx
  7317 000055E7 01D3                                    add     ebx, edx
  7318 000055E9 8B14BD[D29D0000]                        mov     edx, [(mp3_synth_buf+700h)+edi*4]
  7319 000055F0 8B04AD[08F00400]                        mov     eax, [(mp3_synth_win+780h)+ebp*4]
  7320 000055F7 F7EA                                    imul    edx
  7321 000055F9 01D3                                    add     ebx, edx
  7322 000055FB 81FB00002000                            cmp     ebx, 200000h    ; cmp @@sum,100h SHL (@@out_shift)
  7323 00005601 7321                                    jnb     short .sat
  7324 00005603 C1FB0D                                  sar     ebx, 13         ; sar @@sum,(@@out_shift)
  7325                                  
  7326                                  .sat_back:
  7327 00005606 8819                                    mov     [ecx], bl
  7328 00005608 030D[74ED0000]                          add     ecx, [mp3_samples_dst_step]
  7329 0000560E 83C602                                  add     esi, 2
  7330 00005611 83EF02                                  sub     edi, 2
  7331 00005614 83C502                                  add     ebp, 2
  7332 00005617 F7C51F000000                            test    ebp, 1Fh
  7333 0000561D 0F85B3FEFFFF                            jnz     .samples_lop
  7334 00005623 C3                                      retn
  7335                                  
  7336                                  .sat:
  7337 00005624 C1FB1F                                  sar     ebx, 31         ; sar @@sum,31 ; FFFFFFFFh,00000000h
  7338 00005627 F7D3                                    not     ebx
  7339 00005629 EBDB                                    jmp     short .sat_back
  7340                                  
  7341                                  .append_copy_to_window:
  7342 0000562B 8D3485[D2960000]                        lea     esi, [mp3_synth_buf+eax*4]
  7343 00005632 8DBE00080000                            lea     edi, [esi+2048]
  7344 00005638 B912000000                              mov     ecx, 18
  7345 0000563D F3A5                                    rep movsd
  7346 0000563F E971FEFFFF                              jmp     .append_copy_to_window_back
  7347                                  
  7348                                  
  7349                                  ; =============== S U B R O U T I N E =======================================
  7350                                  
  7351                                  
  7352                                  synth_8bit_shift_2_slow:
  7353 00005644 F605[4C6F0000]10                        test    byte [cpuid_flags], 10h ; SYNTH_MACRO 1,2,0 ; 8bit, quarter rate
  7354                                                                          ; force_8bit, rate_shift=2, force_fast=0
  7355 0000564B 740E                                    jz      short .no_rdtsc_supported ; timelog_start rdtsc_synth_dct
  7356 0000564D 0F31                                    rdtsc
  7357 0000564F 2905[C4700000]                          sub     [rdtsc_synth_dct], eax
  7358 00005655 1915[C8700000]                          sbb     [rdtsc_synth_dct+4], edx
  7359                                  
  7360                                  .no_rdtsc_supported:
  7361 0000565B BE[DAB60000]                            mov	esi, mp3_sb_samples
  7362 00005660 8B3D[6CED0000]                          mov	edi, [mp3_samples_dst]
  7363 00005666 C705[78ED0000]0000-                     mov	dword [mp3_curr_channel], 0
  7363 0000566E 0000               
  7364                                  
  7365                                  .synth_channel_lop:
  7366 00005670 56                                      push	esi
  7367 00005671 57                                      push	edi
  7368 00005672 893D[BA960000]                          mov	[mp3_curr_syn_dst], edi
  7369 00005678 C705[80ED0000]0000-                     mov	dword [mp3_curr_frame], 0
  7369 00005680 0000               
  7370                                  
  7371                                  .synth_frame_lop:
  7372 00005682 56                                      push    esi             ; sb_samples[ch][i]
  7373 00005683 F605[4C6F0000]10                        test    byte [cpuid_flags], 10h ; timelog_start rdtsc_dct32
  7374 0000568A 740E                                    jz      short .no_rdtsc_supported@
  7375 0000568C 0F31                                    rdtsc
  7376 0000568E 2905[DC700000]                          sub     [rdtsc_dct32], eax
  7377 00005694 1915[E0700000]                          sbb     [rdtsc_dct32+4], edx
  7378                                  
  7379                                  .no_rdtsc_supported@:
  7380 0000569A 8B15[78ED0000]                          mov     edx, [mp3_curr_channel]
  7381 000056A0 8B0495[D2B60000]                        mov     eax, [mp3_synth_index+edx*4]
  7382 000056A7 832C95[D2B60000]20                      sub     dword [mp3_synth_index+edx*4], 32
  7383 000056AF C1E20A                                  shl     edx, 10         ; channel*1024
  7384 000056B2 25E0010000                              and     eax, 1E0h       ; 1FFh-1Fh ; index(0..511), align 32
  7385 000056B7 09D0                                    or      eax, edx
  7386 000056B9 A3[B6960000]                            mov     [mp3_curr_syn_index], eax
  7387 000056BE 8B3D[B6960000]                          mov     edi, [mp3_curr_syn_index]
  7388 000056C4 8D3CBD[D2960000]                        lea     edi, [mp3_synth_buf+edi*4] ; IF SYNTH32
  7389 000056CB E89CDBFFFF                              call    mp3_dct32_shift_2 ; mp3_dct32_shift_&rate_shift ; rate_shift=2
  7390 000056D0 F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
  7391 000056D7 740E                                    jz      short .no_rdtsc_supported@@ ; timelog_end rdtsc_dct32
  7392 000056D9 0F31                                    rdtsc
  7393 000056DB 0105[DC700000]                          add     [rdtsc_dct32], eax
  7394 000056E1 1115[E0700000]                          adc     [rdtsc_dct32+4], edx
  7395                                  
  7396                                  .no_rdtsc_supported@@:
  7397 000056E7 F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
  7398 000056EE 740E                                    jz      short .no_rdtsc_supported@@@ ; timelog_start rdtsc_synth
  7399 000056F0 0F31                                    rdtsc
  7400 000056F2 2905[F4700000]                          sub     [rdtsc_synth], eax
  7401 000056F8 1915[F8700000]                          sbb     [rdtsc_synth+4], edx
  7402                                  
  7403                                  .no_rdtsc_supported@@@:
  7404 000056FE E888000000                              call    mp3_synth_filter_this_8bit_shift_2_slow ;
  7405                                                                          ; mp3_synth_filter_this_&force_8bit&_&rate_shift&_&force_fast
  7406 00005703 F605[4C6F0000]10                        test    byte [cpuid_flags], 10h ; timelog_end rdtsc_synth
  7407 0000570A 740E                                    jz      short .no_rdtsc_supported@@@@
  7408 0000570C 0F31                                    rdtsc
  7409 0000570E 0105[F4700000]                          add     [rdtsc_synth], eax
  7410 00005714 1115[F8700000]                          adc     [rdtsc_synth+4], edx
  7411                                  
  7412                                  .no_rdtsc_supported@@@@:
  7413 0000571A 5E                                      pop     esi             ; src
  7414 0000571B A1[74ED0000]                            mov     eax, [mp3_samples_dst_step]
  7415 00005720 C1E005                                  shl     eax, 5          ; mul32
  7416 00005723 8A0D[486F0000]                          mov     cl, [option_rate_shift] ; IF with_rate_shift
  7417 00005729 D3E8                                    shr     eax, cl
  7418 0000572B 0105[BA960000]                          add     [mp3_curr_syn_dst], eax
  7419 00005731 81C680000000                            add     esi, 128        ; SBLIMIT*4 ; src+32*4
  7420 00005737 FF05[80ED0000]                          inc     dword [mp3_curr_frame]
  7421 0000573D A1[80ED0000]                            mov     eax, [mp3_curr_frame]
  7422 00005742 3B05[BE960000]                          cmp     eax, [mp3_nb_frames]
  7423 00005748 0F8234FFFFFF                            jb      .synth_frame_lop
  7424 0000574E 5F                                      pop     edi
  7425 0000574F 5E                                      pop     esi
  7426 00005750 033D[B2960000]                          add     edi, [mp3_bytes_per_sample]
  7427 00005756 81C600120000                            add     esi, 4608       ; 36*SBLIMIT*4 ; src
  7428 0000575C FF05[78ED0000]                          inc     dword [mp3_curr_channel]
  7429 00005762 A1[78ED0000]                            mov     eax, [mp3_curr_channel]
  7430 00005767 3B05[AA960000]                          cmp     eax, [mp3_output_num_channels]
  7431 0000576D 0F82FDFEFFFF                            jb      .synth_channel_lop
  7432 00005773 F605[4C6F0000]10                        test    byte [cpuid_flags], 10h ; timelog_end rdtsc_synth_dct
  7433 0000577A 740E                                    jz      short .no_rdtsc_supported@@@@@
  7434 0000577C 0F31                                    rdtsc
  7435 0000577E 0105[C4700000]                          add     [rdtsc_synth_dct], eax
  7436 00005784 1115[C8700000]                          adc     [rdtsc_synth_dct+4], edx
  7437                                  
  7438                                  .no_rdtsc_supported@@@@@:
  7439 0000578A C3                                      retn
  7440                                  
  7441                                  ; =============== S U B R O U T I N E =======================================
  7442                                  
  7443                                  
  7444                                  mp3_synth_filter_this_8bit_shift_2_slow:
  7445 0000578B A1[B6960000]                            mov     eax, [mp3_curr_syn_index]
  7446 00005790 A9E0010000                              test    eax, 1E0h       ; 1FFh-1Fh ; offset
  7447 00005795 0F8477010000                            jz      .append_copy_to_window
  7448 0000579B 90                                      nop
  7449                                  
  7450                                  .append_copy_to_window_back:
  7451 0000579C 89C5                                    mov     ebp, eax        ; @@win1
  7452 0000579E 81E5C0010000                            and     ebp, 1C0h       ; 1FFh-1Fh-20h
  7453 000057A4 2520040000                              and     eax, 420h       ; 20h+(1 shl 10) ; bit5 and channel
  7454 000057A9 8D7010                                  lea     esi, [eax+10h]  ; @@syn1
  7455 000057AC 8D7830                                  lea     edi, [eax+30h]  ; @@syn2
  7456 000057AF F7DD                                    neg     ebp
  7457 000057B1 81E5C0010000                            and     ebp, 1C0h       ; 1FFh-1Fh-20h
  7458 000057B7 8B0D[BA960000]                          mov     ecx, [mp3_curr_syn_dst] ; @@dst
  7459                                  
  7460                                  .samples_lop:
  7461 000057BD BB00101000                              mov     ebx, 101000h    ; mov @@sum,(80h SHL (@@out_shift))+(1 SHL (@@out_shift-1))
  7462                                                                          ; @@out_shift equ (OUT_SHIFT_slow+(8*force_8bit))
  7463                                                                          ; @@out_shift = 13 ; OUT_SHIFT_slow = 5
  7464 000057C2 8B14B5[D2960000]                        mov     edx, [mp3_synth_buf+esi*4] ; @@SUM8 @@sum,@@win1,0,@@syn1
  7465                                                                          ; @@SUM8 macro sum,win,ww, syn
  7466                                                                          ; IRP nn,0,1,2,3,4,5,6,7
  7467                                                                          ; [mp3_synth_buf+syn*4+(nn*64*4)]
  7468 000057C9 8B04AD[88E80400]                        mov     eax, [mp3_synth_win+ebp*4] ; [mp3_synth_win+win*4+(nn*64*4)+ww*4]
  7469 000057D0 F7EA                                    imul    edx             ; 64bit = 32bit * 32bit
  7470 000057D2 01D3                                    add     ebx, edx        ; add sum,edx ; sum from MSW of result
  7471 000057D4 8B14B5[D2970000]                        mov     edx, [(mp3_synth_buf+100h)+esi*4] ;
  7472                                                                          ; [mp3_synth_buf+syn*4+(nn*64*4)] ; nn=1
  7473 000057DB 8B04AD[88E90400]                        mov     eax, [(mp3_synth_win+100h)+ebp*4] ;
  7474                                                                          ; [mp3_synth_win+win*4+(nn*64*4)+ww*4] ; nn=1
  7475 000057E2 F7EA                                    imul    edx
  7476 000057E4 01D3                                    add     ebx, edx
  7477 000057E6 8B14B5[D2980000]                        mov     edx, [(mp3_synth_buf+200h)+esi*4]
  7478 000057ED 8B04AD[88EA0400]                        mov     eax, [(mp3_synth_win+200h)+ebp*4]
  7479 000057F4 F7EA                                    imul    edx
  7480 000057F6 01D3                                    add     ebx, edx
  7481 000057F8 8B14B5[D2990000]                        mov     edx, [(mp3_synth_buf+300h)+esi*4]
  7482 000057FF 8B04AD[88EB0400]                        mov     eax, [(mp3_synth_win+300h)+ebp*4]
  7483 00005806 F7EA                                    imul    edx
  7484 00005808 01D3                                    add     ebx, edx
  7485 0000580A 8B14B5[D29A0000]                        mov     edx, [(mp3_synth_buf+400h)+esi*4] ;
  7486                                                                          ; [mp3_synth_buf+syn*4+(nn*64*4)] ; nn=4
  7487 00005811 8B04AD[88EC0400]                        mov     eax, [(mp3_synth_win+400h)+ebp*4] ;
  7488                                                                          ; [mp3_synth_win+win*4+(nn*64*4)+ww*4] ; nn=4
  7489 00005818 F7EA                                    imul    edx
  7490 0000581A 01D3                                    add     ebx, edx
  7491 0000581C 8B14B5[D29B0000]                        mov     edx, [(mp3_synth_buf+500h)+esi*4]
  7492 00005823 8B04AD[88ED0400]                        mov     eax, [(mp3_synth_win+500h)+ebp*4]
  7493 0000582A F7EA                                    imul    edx
  7494 0000582C 01D3                                    add     ebx, edx
  7495 0000582E 8B14B5[D29C0000]                        mov     edx, [(mp3_synth_buf+600h)+esi*4]
  7496 00005835 8B04AD[88EE0400]                        mov     eax, [(mp3_synth_win+600h)+ebp*4]
  7497 0000583C F7EA                                    imul    edx
  7498 0000583E 01D3                                    add     ebx, edx
  7499 00005840 8B14B5[D29D0000]                        mov     edx, [(mp3_synth_buf+700h)+esi*4]
  7500 00005847 8B04AD[88EF0400]                        mov     eax, [(mp3_synth_win+700h)+ebp*4]
  7501 0000584E F7EA                                    imul    edx
  7502 00005850 01D3                                    add     ebx, edx
  7503 00005852 8B14BD[D2960000]                        mov     edx, [mp3_synth_buf+edi*4] ; @@SUM8 @@sum,@@win1,32,@@syn2
  7504 00005859 8B04AD[08E90400]                        mov     eax, [(mp3_synth_win+80h)+ebp*4]
  7505 00005860 F7EA                                    imul    edx
  7506 00005862 01D3                                    add     ebx, edx
  7507 00005864 8B14BD[D2970000]                        mov     edx, [(mp3_synth_buf+100h)+edi*4]
  7508 0000586B 8B04AD[08EA0400]                        mov     eax, [(mp3_synth_win+180h)+ebp*4]
  7509 00005872 F7EA                                    imul    edx
  7510 00005874 01D3                                    add     ebx, edx
  7511 00005876 8B14BD[D2980000]                        mov     edx, [(mp3_synth_buf+200h)+edi*4]
  7512 0000587D 8B04AD[08EB0400]                        mov     eax, [(mp3_synth_win+280h)+ebp*4]
  7513 00005884 F7EA                                    imul    edx
  7514 00005886 01D3                                    add     ebx, edx
  7515 00005888 8B14BD[D2990000]                        mov     edx, [(mp3_synth_buf+300h)+edi*4]
  7516 0000588F 8B04AD[08EC0400]                        mov     eax, [(mp3_synth_win+380h)+ebp*4]
  7517 00005896 F7EA                                    imul    edx
  7518 00005898 01D3                                    add     ebx, edx
  7519 0000589A 8B14BD[D29A0000]                        mov     edx, [(mp3_synth_buf+400h)+edi*4]
  7520 000058A1 8B04AD[08ED0400]                        mov     eax, [(mp3_synth_win+480h)+ebp*4]
  7521 000058A8 F7EA                                    imul    edx
  7522 000058AA 01D3                                    add     ebx, edx
  7523 000058AC 8B14BD[D29B0000]                        mov     edx, [(mp3_synth_buf+500h)+edi*4]
  7524 000058B3 8B04AD[08EE0400]                        mov     eax, [(mp3_synth_win+580h)+ebp*4]
  7525 000058BA F7EA                                    imul    edx
  7526 000058BC 01D3                                    add     ebx, edx
  7527 000058BE 8B14BD[D29C0000]                        mov     edx, [(mp3_synth_buf+600h)+edi*4]
  7528 000058C5 8B04AD[08EF0400]                        mov     eax, [(mp3_synth_win+680h)+ebp*4]
  7529 000058CC F7EA                                    imul    edx
  7530 000058CE 01D3                                    add     ebx, edx
  7531 000058D0 8B14BD[D29D0000]                        mov     edx, [(mp3_synth_buf+700h)+edi*4]
  7532                                                                          ; [mp3_synth_buf+syn*4+(nn*64*4)] ; nn=7
  7533 000058D7 8B04AD[08F00400]                        mov     eax, [(mp3_synth_win+780h)+ebp*4]
  7534                                                                          ; [mp3_synth_win+win*4+(nn*64*4)+ww*4] ; nn=7
  7535 000058DE F7EA                                    imul    edx
  7536 000058E0 01D3                                    add     ebx, edx
  7537 000058E2 81FB00002000                            cmp     ebx, 200000h    ; cmp @@sum,100h SHL (@@out_shift) ; out_shift=13
  7538 000058E8 7321                                    jnb     short .sat
  7539 000058EA C1FB0D                                  sar     ebx, 13         ; sar @@sum,(@@out_shift)
  7540                                  
  7541                                  .sat_back:
  7542 000058ED 8819                                    mov     [ecx], bl       ; mov byte ptr [@@dst],@@sum_8bit
  7543 000058EF 030D[74ED0000]                          add     ecx, [mp3_samples_dst_step]
  7544 000058F5 83C604                                  add     esi, 4          ; add @@syn1,1 shl rate_shift ; rate_shift=2
  7545 000058F8 83EF04                                  sub     edi, 4          ; add @@syn2,1 shl rate_shift
  7546 000058FB 83C504                                  add     ebp, 4          ; add @@win1,1 shl rate_shift
  7547 000058FE F7C51F000000                            test    ebp, 1Fh        ; test @@win1,1Fh
  7548 00005904 0F85B3FEFFFF                            jnz     .samples_lop
  7549 0000590A C3                                      retn
  7550                                  
  7551                                  .sat:
  7552 0000590B C1FB1F                                  sar     ebx, 31         ; sar  @@sum,31 ; FFFFFFFFh,00000000h
  7553 0000590E F7D3                                    not     ebx
  7554 00005910 EBDB                                    jmp     short .sat_back
  7555                                  
  7556                                  .append_copy_to_window:
  7557 00005912 8D3485[D2960000]                        lea     esi, [mp3_synth_buf+eax*4] ; IF SYNTH32
  7558 00005919 8DBE00080000                            lea     edi, [esi+2048] ; [esi+512*4]
  7559 0000591F B912000000                              mov     ecx, 18         ; (12h*4)/4
  7560 00005924 F3A5                                    rep movsd
  7561 00005926 E971FEFFFF                              jmp     .append_copy_to_window_back
  7562                                  
  7563                                  
  7564                                  ; =============== S U B R O U T I N E =======================================
  7565                                  
  7566                                  
  7567                                  mp3_any_init_synth_window:
  7568 0000592B 31D2                                    xor     edx, edx        ; index (0..100h)
  7569 0000592D 31C9                                    xor     ecx, ecx        ; delta.val
  7570 0000592F 898C12[88E80400]                        mov     [mp3_synth_win+edx*2], ecx
  7571                                  
  7572                                  .synth_lop:
  7573 00005936 0FBF9C12[9A710000]                      movsx   ebx, word [mp3_synth_win_src+edx*2]
  7574 0000593E 01D9                                    add     ecx, ebx
  7575 00005940 89C8                                    mov     eax, ecx
  7576 00005942 803D[496F0000]00                        cmp     byte [option_fast], 0
  7577 00005949 7403                                    jz      short .not_fast
  7578 0000594B C1F805                                  sar     eax, 5
  7579                                  
  7580                                  .not_fast:
  7581 0000594E 803D[496F0000]00                        cmp	byte [option_fast], 0
  7582 00005955 7503                                    jnz	short .not_slow
  7583 00005957 C1E00E                                  shl	eax, 14         ; (WFRAC_BITS_slow-WFRAC_BITS_default)
  7584                                  
  7585                                  .not_slow:
  7586 0000595A 42                                      inc     edx             ; index (1..100h)
  7587 0000595B BB00020000                              mov     ebx, 200h
  7588 00005960 29D3                                    sub     ebx, edx        ; 1FFh..100h
  7589 00005962 89049D[88E80400]                        mov     [mp3_synth_win+ebx*4], eax
  7590 00005969 F7C23F000000                            test    edx, 3Fh
  7591 0000596F 7402                                    jz      short .synth_keep_sign
  7592 00005971 F7D8                                    neg     eax
  7593                                  
  7594                                  .synth_keep_sign:
  7595 00005973 890495[88E80400]                        mov     [mp3_synth_win+edx*4], eax
  7596 0000597A 81FA00010000                            cmp     edx, 100h
  7597 00005980 72B4                                    jb      short .synth_lop
  7598 00005982 31D2                                    xor     edx, edx
  7599                                  
  7600                                  .synth_neg_lop:
  7601 00005984 F7C230000000                            test    edx, 30h        ; skip 0..0Fh (only negate 10h..3Fh)
  7602 0000598A 7407                                    jz      short .synth_neg_next
  7603 0000598C F71C95[88E80400]                        neg     dword [mp3_synth_win+edx*4]
  7604                                  
  7605                                  .synth_neg_next:
  7606 00005993 42                                      inc     edx
  7607 00005994 81FA00020000                            cmp     edx, 200h
  7608 0000599A 72E8                                    jb      short .synth_neg_lop
  7609 0000599C 31D2                                    xor     edx, edx
  7610                                  
  7611                                  .synth_swap_lop:
  7612 0000599E 89D0                                    mov     eax, edx
  7613 000059A0 83E03F                                  and     eax, 3Fh
  7614 000059A3 83E811                                  sub     eax, 17         ; swap win [(17..31)] with win[(17..31)+32)
  7615 000059A6 83F80E                                  cmp     eax, 14         ; 31-17
  7616 000059A9 7715                                    ja      short .synth_swap_next
  7617 000059AB 8B0495[88E80400]                        mov     eax, [mp3_synth_win+edx*4]
  7618 000059B2 870495[08E90400]                        xchg    eax, [(mp3_synth_win+80h)+edx*4]
  7619 000059B9 890495[88E80400]                        mov     [mp3_synth_win+edx*4], eax
  7620                                  
  7621                                  .synth_swap_next:
  7622 000059C0 42                                      inc     edx
  7623 000059C1 81FA00020000                            cmp     edx, 200h
  7624 000059C7 72D5                                    jb      short .synth_swap_lop
  7625 000059C9 31D2                                    xor     edx, edx
  7626                                  
  7627                                  .synth_zero_lop:
  7628 000059CB C70495[C8E80400]00-                     mov	dword [(mp3_synth_win+40h)+edx*4], 0
  7628 000059D3 000000             
  7629 000059D6 83C240                                  add	edx, 40h
  7630 000059D9 81FA00020000                            cmp	edx, 200h
  7631 000059DF 72EA                                    jb	short .synth_zero_lop
  7632 000059E1 BE[88E80400]                            mov	esi, mp3_synth_win
  7633 000059E6 8DBE00080000                            lea	edi, [esi+2048] ; [esi+512*4]
  7634 000059EC B900020000                              mov	ecx, 512        ; append another copy
  7635 000059F1 F3A5                                    rep movsd
  7636 000059F3 C3                                      retn
  7637                                  
  7638                                  
  7639                                  ; =============== S U B R O U T I N E =======================================
  7640                                  
  7641                                  
  7642                                  mp3_init_post_collapse:
  7643 000059F4 803D[496F0000]00                        cmp	byte [option_fast], 0
  7644 000059FB 7411                                    jz	short .not_fast
  7645 000059FD BE[88E80400]                            mov	esi, mp3_synth_win
  7646 00005A02 89F7                                    mov	edi, esi
  7647 00005A04 B900040000                              mov	ecx, 1024       ; 512*(1+LONG_WINDOW)
  7648                                  
  7649                                  .collapse_lop:
  7650 00005A09 AD                                      lodsd                   ; collapse 32bit to 16bit
  7651                                                                          ; (that's slightly faster due to better caching)
  7652 00005A0A 66AB                                    stosw
  7653 00005A0C E2FB                                    loop    .collapse_lop
  7654                                  
  7655                                  .not_fast:
  7656 00005A0E C3                                      retn
  7657                                  
  7658                                  
  7659                                  ; =============== S U B R O U T I N E =======================================
  7660                                  
  7661                                  
  7662                                  mp3_any_init_band_indices:
  7663 00005A0F BE[CC790000]                            mov     esi, mp3_band_size_long
  7664 00005A14 BF[9CD00100]                            mov     edi, mp3_band_index_long
  7665 00005A19 BB09000000                              mov     ebx, 9
  7666                                  
  7667                                  .band_index_lop_i:
  7668 00005A1E 31C0                                    xor     eax, eax
  7669 00005A20 B916000000                              mov     ecx, 22
  7670                                  
  7671                                  .band_index_lop_j:
  7672 00005A25 66AB                                    stosw
  7673 00005A27 0FB616                                  movzx   edx, byte [esi]
  7674 00005A2A 01D0                                    add     eax, edx
  7675 00005A2C 46                                      inc     esi
  7676 00005A2D E2F6                                    loop    .band_index_lop_j
  7677 00005A2F 83C10A                                  add     ecx, 10
  7678 00005A32 F366AB                                  rep stosw
  7679 00005A35 4B                                      dec     ebx
  7680 00005A36 75E6                                    jnz     short .band_index_lop_i
  7681 00005A38 C3                                      retn
  7682                                  
  7683                                  
  7684                                  ; =============== S U B R O U T I N E =======================================
  7685                                  
  7686                                  
  7687                                  mp3_any_init_lsf_sf_expand:
  7688 00005A39 BE[6A710000]                            mov     esi, mp3_lsf_sf_expand_init_table
  7689 00005A3E BF[88F80400]                            mov     edi, mp3_lsf_sf_expand_exploded_table
  7690 00005A43 31D2                                    xor     edx, edx        ; curr.index
  7691 00005A45 31DB                                    xor     ebx, ebx        ; curr.base
  7692                                  
  7693                                  .lop:
  7694 00005A47 663B5606                                cmp     dx, [esi+6]     ; nextbase
  7695 00005A4B 7207                                    jb      short .inrange
  7696 00005A4D 668B5E06                                mov     bx, [esi+6]
  7697 00005A51 83C608                                  add     esi, 8          ; next entry
  7698                                  
  7699                                  .inrange:
  7700 00005A54 89D0                                    mov     eax, edx
  7701 00005A56 29D8                                    sub     eax, ebx
  7702 00005A58 8A0E                                    mov     cl, [esi]
  7703 00005A5A D3E8                                    shr     eax, cl         ; div2
  7704 00005A5C F67603                                  div     byte [esi+3] ; mod3 ; [2]=slen[3]
  7705 00005A5F 886703                                  mov     [edi+3], ah
  7706 00005A62 B400                                    mov     ah, 0           ; eax=div.result
  7707 00005A64 F67602                                  div     byte [esi+2] ; mod2 ; [2]=slen[2]
  7708 00005A67 886702                                  mov     [edi+2], ah     ; remainder
  7709 00005A6A B400                                    mov     ah, 0
  7710 00005A6C F67601                                  div     byte [esi+1] ; mod1 ; [1]=slen[1]
  7711 00005A6F 668907                                  mov     [edi], ax       ; [0]=slen[0]
  7712 00005A72 668B4604                                mov     ax, [esi+4]     ; [4]=tindex2
  7713 00005A76 66894704                                mov     [edi+4], ax     ; [5]=force_preflag
  7714 00005A7A 83C708                                  add     edi, 8
  7715 00005A7D 42                                      inc     edx             ; curr.index ; next
  7716 00005A7E 81FA00040000                            cmp     edx, 1024       ; 512+512
  7717 00005A84 72C1                                    jb      short .lop
  7718 00005A86 C3                                      retn
  7719                                  
  7720                                  
  7721                                  ; =============== S U B R O U T I N E =======================================
  7722                                  
  7723                                  
  7724                                  mp3_any_init_huff_tables:
  7725 00005A87 BD[04740000]                            mov     ebp, huff_tree_list_data
  7726 00005A8C BE[847E0000]                            mov     esi, huff_tree_list_numbits
  7727 00005A91 BA01000000                              mov     edx, 1          ; idx (table 01h..11h)
  7728                                  
  7729                                  .huffman_table_lop:
  7730 00005A96 31C0                                    xor     eax, eax
  7731 00005A98 BF[B4220500]                            mov     edi, mp3_huff_tmp_bits
  7732 00005A9D B940000000                              mov     ecx, 40h        ; 100h/4 ; 100h x 8bit
  7733 00005AA2 F3AB                                    rep stosd
  7734 00005AA4 BF[B4230500]                            mov     edi, mp3_huff_tmp_codes
  7735 00005AA9 B980000000                              mov     ecx, 80h        ; 100h/2 ; 100h x 16bit
  7736 00005AAE F3AB                                    rep stosd
  7737 00005AB0 31DB                                    xor     ebx, ebx
  7738                                  
  7739                                  .huff_entry_lop:
  7740 00005AB2 0FB67D00                                movzx   edi, byte [ebp+0]
  7741 00005AB6 45                                      inc     ebp             ; dst=data
  7742 00005AB7 AC                                      lodsb                   ; numbits
  7743 00005AB8 8887[B4220500]                          mov     [mp3_huff_tmp_bits+edi], al
  7744 00005ABE B120                                    mov     cl, 32
  7745 00005AC0 28C1                                    sub     cl, al          ; 32-numbits
  7746 00005AC2 D3EB                                    shr     ebx, cl
  7747 00005AC4 66899C3F[B4230500]                      mov     word [mp3_huff_tmp_codes+edi*2], bx
  7748 00005ACC 43                                      inc     ebx             ; next.code
  7749 00005ACD D3E3                                    shl     ebx, cl         ; shift back to MSBs
  7750 00005ACF 75E1                                    jnz     short .huff_entry_lop
  7751 00005AD1 60                                      pusha
  7752 00005AD2 B800010000                              mov     eax, 100h       ; nb_codes
  7753 00005AD7 BB[B4220500]                            mov     ebx, mp3_huff_tmp_bits ; bits
  7754 00005ADC BE[B4230500]                            mov     esi, mp3_huff_tmp_codes ; codes
  7755 00005AE1 E837020000                              call    mp3_build_huff_table_root ; make table
  7756 00005AE6 61                                      popa
  7757 00005AE7 42                                      inc     edx             ; idx
  7758 00005AE8 83FA12                                  cmp     edx, 12h
  7759 00005AEB 75A9                                    jnz     short .huffman_table_lop ; next table
  7760 00005AED C3                                      retn
  7761                                  
  7762                                  
  7763                                  ; =============== S U B R O U T I N E =======================================
  7764                                  
  7765                                  
  7766                                  mp3_integer_init_is_stereo_lsf:
  7767 00005AEE 31FF                                    xor     edi, edi
  7768                                  
  7769                                  .lsf_lop:
  7770 00005AF0 89FE                                    mov     esi, edi
  7771 00005AF2 83E63F                                  and     esi, 3Fh
  7772 00005AF5 46                                      inc     esi
  7773 00005AF6 D1EE                                    shr     esi, 1
  7774 00005AF8 F7C740000000                            test    edi, 40h
  7775 00005AFE 7402                                    jz      short .lsf_no_shift
  7776 00005B00 D1E6                                    shl     esi, 1
  7777                                  
  7778                                  .lsf_no_shift:
  7779 00005B02 BA00000040                              mov     edx, 40000000h  ; aka mul 1.000
  7780 00005B07 83C604                                  add     esi, 4
  7781 00005B0A F7C780000000                            test    edi, 80h        ; 2*40h
  7782 00005B10 7408                                    jz      short .no_ms_stereo
  7783 00005B12 BA9A79825A                              mov     edx, 5A82799Ah  ; 2D413CCDh*2 ; aka mul 1.414
  7784 00005B17 83EE02                                  sub     esi, 2
  7785                                  
  7786                                  .no_ms_stereo:
  7787 00005B1A 89F1                                    mov     ecx, esi
  7788 00005B1C C1E902                                  shr     ecx, 2          ; msbs
  7789 00005B1F 83E603                                  and     esi, 3          ; lsbs
  7790 00005B22 8B04B5[C47D0000]                        mov     eax, [mp3_is_table_lsf_src+esi*4]
  7791 00005B29 D3E8                                    shr     eax, cl
  7792 00005B2B F7C701000000                            test    edi, 1
  7793 00005B31 7501                                    jnz     short .lsf_no_swap
  7794 00005B33 92                                      xchg    eax, edx
  7795                                  
  7796                                  .lsf_no_swap:
  7797 00005B34 8904FD[88E00400]                        mov     [mp3_is_table_lsf+edi*8], eax
  7798 00005B3B 8914FD[8CE00400]                        mov     [(mp3_is_table_lsf+4)+edi*8], edx
  7799 00005B42 47                                      inc     edi
  7800 00005B43 81FF00010000                            cmp     edi, 100h
  7801 00005B49 72A5                                    jb      short .lsf_lop
  7802 00005B4B C3                                      retn
  7803                                  
  7804                                  
  7805                                  ; =============== S U B R O U T I N E =======================================
  7806                                  
  7807                                  
  7808                                  mp3_integer_init_mdct_windows:
  7809 00005B4C BF[08DC0400]                            mov     edi, mp3_mdct_win
  7810 00005B51 BE[4C7B0000]                            mov     esi, mp3_mdct_win_src
  7811 00005B56 B990000000                              mov     ecx, 144        ; 36*4
  7812 00005B5B F3A5                                    rep movsd
  7813 00005B5D BE[08DC0400]                            mov     esi, mp3_mdct_win
  7814 00005B62 BF[48DE0400]                            mov     edi, (mp3_mdct_win+240h)
  7815 00005B67 B948000000                              mov     ecx, 72         ; 4*36/2 ; that is, 4*36 entry pairs
  7816                                  
  7817                                  .mdct_lop_dupe:                       
  7818 00005B6C A5                                      movsd                   ; copy normal, [4..7][even] = +[0..3][even
  7819 00005B6D AD                                      lodsd
  7820 00005B6E F7D8                                    neg     eax             ; copy negated, [4..7][odd] = -[0..3][odd]
  7821 00005B70 AB                                      stosd
  7822 00005B71 E2F9                                    loop    .mdct_lop_dupe
  7823 00005B73 C3                                      retn
  7824                                  
  7825                                  
  7826                                  ; =============== S U B R O U T I N E =======================================
  7827                                  
  7828                                  
  7829                                  mp3_integer_init_table_4_3:
  7830 00005B74 803D[496F0000]00                        cmp	byte [option_fast], 0
  7831 00005B7B B048                                    mov	al, 72          ; 100-6-VFRAC_BITS_slow
  7832 00005B7D 7402                                    jz	short .this_vfrac
  7833 00005B7F B04C                                    mov	al, 76          ; 100-6-VFRAC_BITS_fast
  7834                                  
  7835                                  .this_vfrac:
  7836 00005B81 A2[DEEC0000]                            mov     [mp3_curr_vfrac_bits], al
  7837 00005B86 31FF                                    xor     edi, edi
  7838                                  
  7839                                  .table_4_3_lop:
  7840 00005B88 57                                      push    edi             ; for i=1 to TABLE_4_3_SIZE-1
  7841 00005B89 89F8                                    mov     eax, edi
  7842 00005B8B C1E802                                  shr     eax, 2
  7843 00005B8E F7E0                                    mul     eax
  7844 00005B90 F7E0                                    mul     eax
  7845 00005B92 31DB                                    xor     ebx, ebx
  7846 00005B94 E8A2000000                              call    cbrt96
  7847 00005B99 020D[DEEC0000]                          add     cl, [mp3_curr_vfrac_bits]
  7848 00005B9F 5F                                      pop     edi
  7849                                  
  7850                                  .inner_lop:
  7851 00005BA0 89F8                                    mov     eax, edi
  7852 00005BA2 83E003                                  and     eax, 3
  7853 00005BA5 8B0485[D47D0000]                        mov     eax, [mp3_pow2_quarters+eax*4]
  7854 00005BAC F7E3                                    mul     ebx
  7855 00005BAE 88CD                                    mov     ch, cl
  7856 00005BB0 09D2                                    or      edx, edx
  7857 00005BB2 7904                                    jns     short .this
  7858 00005BB4 D1EA                                    shr     edx, 1
  7859 00005BB6 FECD                                    dec     ch
  7860                                  
  7861                                  .this:
  7862 00005BB8 8914BD[18530200]                        mov     [mp3_table_4_3_value+edi*4], edx
  7863 00005BBF 88AF[DCD20100]                          mov     [mp3_table_4_3_exp+edi], ch
  7864 00005BC5 47                                      inc     edi
  7865 00005BC6 F7C703000000                            test    edi, 3
  7866 00005BCC 75D2                                    jnz     short .inner_lop
  7867 00005BCE 81FF3C800000                            cmp     edi, 803Ch
  7868 00005BD4 72B2                                    jb      short .table_4_3_lop
  7869 00005BD6 C3                                      retn
  7870                                  
  7871                                  
  7872                                  ; =============== S U B R O U T I N E =======================================
  7873                                  
  7874                                  
  7875                                  mp3_integer_init_exponent:
  7876 00005BD7 BF[085C0400]                            mov     edi, mp3_expval_table
  7877 00005BDC 31D2                                    xor     edx, edx
  7878                                  
  7879                                  .exponent_lop:
  7880 00005BDE 89D0                                    mov     eax, edx        ; val=i
  7881 00005BE0 89D3                                    mov     ebx, edx
  7882 00005BE2 89D1                                    mov     ecx, edx
  7883 00005BE4 C1EB04                                  shr     ebx, 4
  7884 00005BE7 C1E906                                  shr     ecx, 6          ; 4+2
  7885 00005BEA 83E00F                                  and     eax, 0Fh        ; val=i AND 0Fh
  7886 00005BED 83E303                                  and     ebx, 3
  7887 00005BF0 8D1C83                                  lea     ebx, [ebx+eax*4] ; (0..0Fh)*4+(0..3)
  7888 00005BF3 8B049D[18530200]                        mov     eax, [mp3_table_4_3_value+ebx*4]
  7889 00005BFA 09C0                                    or      eax, eax
  7890 00005BFC 741A                                    jz      short .this
  7891 00005BFE 2A8B[DCD20100]                          sub     cl, [mp3_table_4_3_exp+ebx]
  7892 00005C04 770D                                    ja      short .left_shift
  7893 00005C06 F6D9                                    neg     cl
  7894 00005C08 D3E8                                    shr     eax, cl
  7895 00005C0A 80F91F                                  cmp     cl, 1Fh
  7896 00005C0D 7609                                    jbe     short .this
  7897 00005C0F 31C0                                    xor     eax, eax
  7898 00005C11 EB05                                    jmp     short .this
  7899                                  
  7900                                  .left_shift:
  7901 00005C13 B8FFFFFF7F                              mov     eax, 7FFFFFFFh
  7902                                  
  7903                                  .this:
  7904 00005C18 AB                                      stosd
  7905 00005C19 42                                      inc     edx
  7906 00005C1A 81FA00200000                            cmp     edx, 2000h
  7907 00005C20 72BC                                    jb      short .exponent_lop
  7908 00005C22 BE[085C0400]                            mov     esi, mp3_expval_table
  7909 00005C27 BF[08540400]                            mov     edi, mp3_exp_table
  7910 00005C2C B900020000                              mov     ecx, 200h
  7911                                  
  7912                                  .exponent_dupe_lop:
  7913 00005C31 8B4604                                  mov     eax, [esi+4]
  7914 00005C34 AB                                      stosd
  7915 00005C35 83C640                                  add     esi, 40h
  7916 00005C38 E2F7                                    loop    .exponent_dupe_lop
  7917 00005C3A C3                                      retn
  7918                                  
  7919                                  
  7920                                  ; =============== S U B R O U T I N E =======================================
  7921                                  
  7922                                  
  7923                                  cbrt96:
  7924 00005C3B 83EC18                                  sub     esp, 18h        ; cube root, val^(1/3), from https://gist.github.com/anonymous/729557
  7925                                                                          ; in:  ebx:edx:eax = unsigned 96bit input (integer)
  7926                                                                          ; out: ebx         = unsigned 32bit result (with fractional bits)
  7927                                                                          ; out: cl          = number of fractional bits
  7928 00005C3E 890424                                  mov     [esp], eax
  7929 00005C41 89542404                                mov     [esp+4], edx
  7930 00005C45 895C2408                                mov     [esp+8], ebx
  7931 00005C49 C744240C00000000                        mov     dword [esp+0Ch], 0
  7932 00005C51 C744241000000000                        mov     dword [esp+10h], 0
  7933 00005C59 C744241400000000                        mov     dword [esp+14h], 0
  7934 00005C61 31DB                                    xor     ebx, ebx        ; result.value
  7935 00005C63 B100                                    mov     cl, 0           ; result.fraction
  7936 00005C65 09D0                                    or      eax, edx        ; skip if zero
  7937 00005C67 742F                                    jz      short .pre_shift_done
  7938                                  
  7939                                  .pre_shift_lop:
  7940 00005C69 F7442408000000E0                        test    dword [esp+8], 0E0000000h
  7941 00005C71 7525                                    jnz     short .pre_shift_done
  7942 00005C73 D12424                                  shl     dword [esp], 1
  7943 00005C76 D1542404                                rcl     dword [esp+4], 1
  7944 00005C7A D1542408                                rcl     dword [esp+8], 1
  7945 00005C7E D12424                                  shl     dword [esp], 1
  7946 00005C81 D1542404                                rcl     dword [esp+4], 1
  7947 00005C85 D1542408                                rcl     dword [esp+8], 1
  7948 00005C89 D12424                                  shl     dword [esp], 1
  7949 00005C8C D1542404                                rcl     dword [esp+4], 1
  7950 00005C90 D1542408                                rcl     dword [esp+8], 1
  7951 00005C94 FEC1                                    inc     cl
  7952 00005C96 EBD1                                    jmp     short .pre_shift_lop
  7953                                  
  7954                                  .pre_shift_done:
  7955 00005C98 B520                                    mov     ch, 20h         ; loopcount
  7956                                  
  7957                                  .lop:
  7958 00005C9A 01DB                                    add     ebx, ebx        ; result*2
  7959 00005C9C 89D8                                    mov     eax, ebx        ; y
  7960 00005C9E 43                                      inc     ebx             ; result+1
  7961 00005C9F F7E3                                    mul     ebx             ; y*(y+1)
  7962 00005CA1 89C6                                    mov     esi, eax
  7963 00005CA3 89D7                                    mov     edi, edx
  7964 00005CA5 31ED                                    xor     ebp, ebp
  7965 00005CA7 F9                                      stc
  7966 00005CA8 11F6                                    adc     esi, esi        ; y*(y+1)*2+1
  7967 00005CAA 11FF                                    adc     edi, edi
  7968 00005CAC 11ED                                    adc     ebp, ebp
  7969 00005CAE 01C6                                    add     esi, eax
  7970 00005CB0 11D7                                    adc     edi, edx        ; y*(y+1)*3+1
  7971 00005CB2 83D500                                  adc     ebp, 0
  7972 00005CB5 D12424                                  shl     dword [esp], 1
  7973 00005CB8 D1542404                                rcl     dword [esp+4], 1
  7974 00005CBC D1542408                                rcl     dword [esp+8], 1 ; shl 3
  7975 00005CC0 D154240C                                rcl     dword [esp+0Ch], 1
  7976 00005CC4 D1542410                                rcl     dword [esp+10h], 1
  7977 00005CC8 D1542414                                rcl     dword [esp+14h], 1
  7978 00005CCC D12424                                  shl     dword [esp], 1
  7979 00005CCF D1542404                                rcl     dword [esp+4], 1
  7980 00005CD3 D1542408                                rcl     dword [esp+8], 1
  7981 00005CD7 D154240C                                rcl     dword [esp+0Ch], 1
  7982 00005CDB D1542410                                rcl     dword [esp+10h], 1
  7983 00005CDF D1542414                                rcl     dword [esp+14h], 1
  7984 00005CE3 D12424                                  shl     dword [esp], 1
  7985 00005CE6 D1542404                                rcl     dword [esp+4], 1
  7986 00005CEA D1542408                                rcl     dword [esp+8], 1
  7987 00005CEE D154240C                                rcl     dword [esp+0Ch], 1
  7988 00005CF2 D1542410                                rcl     dword [esp+10h], 1
  7989 00005CF6 D1542414                                rcl     dword [esp+14h], 1
  7990 00005CFA 2974240C                                sub     [esp+0Ch], esi
  7991 00005CFE 197C2410                                sbb     [esp+10h], edi  ; sub/compare
  7992 00005D02 196C2414                                sbb     [esp+14h], ebp
  7993 00005D06 730D                                    jnb     short .next
  7994 00005D08 4B                                      dec     ebx
  7995 00005D09 0174240C                                add     [esp+0Ch], esi
  7996 00005D0D 117C2410                                adc     [esp+10h], edi  ; undo
  7997 00005D11 116C2414                                adc     [esp+14h], ebp
  7998                                  
  7999                                  .next:
  8000 00005D15 FECD                                    dec     ch
  8001 00005D17 7581                                    jnz     short .lop
  8002 00005D19 83C418                                  add     esp, 18h
  8003                                  mp3_init_log_constants:
  8004 00005D1C C3                                      retn
  8005                                  
  8006                                  ;mp3_init_log_constants:
  8007                                  ;                retn
  8008                                  
  8009                                  ; =============== S U B R O U T I N E =======================================
  8010                                  
  8011                                  
  8012                                  mp3_build_huff_table_root:
  8013 00005D1D A3[B8250500]                            mov     [_@@nb_codes], eax ; "init_vlc"
  8014 00005D22 C705[BC250500]0000-                     mov     dword [_@@prefix_numbits], 0
  8014 00005D2A 0000               
  8015 00005D2C C705[C0250500]0000-                     mov     dword [_@@prefix_pattern], 0
  8015 00005D34 0000               
  8016 00005D36 60                                      pusha
  8017 00005D37 89C1                                    mov     ecx, eax
  8018 00005D39 31C0                                    xor     eax, eax
  8019                                  
  8020                                  .prescan_lop:
  8021 00005D3B 3A03                                    cmp     al, [ebx]
  8022 00005D3D 7702                                    ja      short .prescan_next
  8023 00005D3F 8A03                                    mov     al, [ebx]
  8024                                  
  8025                                  .prescan_next:
  8026 00005D41 43                                      inc     ebx
  8027 00005D42 E2F7                                    loop    .prescan_lop
  8028 00005D44 3C09                                    cmp     al, 9           ; CHILD_BITS
  8029 00005D46 7202                                    jb      short .prescan_this_limit
  8030 00005D48 B009                                    mov     al, 9
  8031                                  
  8032                                  .prescan_this_limit:
  8033 00005D4A A3[B4250500]                            mov     [_@@table_nb_bits], eax
  8034 00005D4F 61                                      popa
  8035                                  
  8036                                  mp3_build_huff_table_recursive_child:
  8037 00005D50 8B0D[B4250500]                          mov     ecx, [_@@table_nb_bits]
  8038 00005D56 B801000000                              mov     eax, 1
  8039 00005D5B D3E0                                    shl     eax, cl
  8040 00005D5D A3[C4250500]                            mov     [_@@curr_table_size], eax
  8041 00005D62 48                                      dec     eax
  8042 00005D63 A3[C8250500]                            mov     [_@@curr_table_mask], eax
  8043 00005D68 60                                      pusha
  8044 00005D69 8B1D[E87D0000]                          mov     ebx, [mp3_huff_num_entries]
  8045 00005D6F 891D[CC250500]                          mov     [_@@curr_table_index], ebx
  8046 00005D75 031D[C4250500]                          add     ebx, [_@@curr_table_size]
  8047 00005D7B 891D[E87D0000]                          mov     [mp3_huff_num_entries], ebx
  8048 00005D81 813D[E87D0000]002E-                     cmp     dword [mp3_huff_num_entries], 11776 ; HUFF_TREE_SIZE/4
  8048 00005D89 0000               
  8049 00005D8B 0F8781AFFFFF                            ja      fatalunexpected
  8050 00005D91 61                                      popa
  8051 00005D92 BF[9C180100]                            mov     edi, huff_tree_buf
  8052 00005D97 A1[CC250500]                            mov     eax, [_@@curr_table_index]
  8053 00005D9C 66890497                                mov     [edi+edx*4], ax
  8054 00005DA0 A1[B4250500]                            mov     eax, [_@@table_nb_bits]
  8055 00005DA5 F7D8                                    neg     eax
  8056 00005DA7 6689449702                              mov     [edi+edx*4+2], ax
  8057 00005DAC BF[9C180100]                            mov     edi, huff_tree_buf
  8058 00005DB1 8B15[CC250500]                          mov     edx, [_@@curr_table_index]
  8059 00005DB7 8B0D[C4250500]                          mov     ecx, [_@@curr_table_size]
  8060                                  
  8061                                  .clear_table_lop:
  8062 00005DBD 66C70497FFFF                            mov     word [edi+edx*4], 0FFFFh
  8063 00005DC3 66C74497020000                          mov     word [edi+edx*4+2], 0
  8064 00005DCA 42                                      inc     edx
  8065 00005DCB E2F0                                    loop    .clear_table_lop
  8066 00005DCD 53                                      push    ebx
  8067 00005DCE 56                                      push    esi
  8068 00005DCF 31D2                                    xor     edx, edx
  8069                                  
  8070                                  .make_table_lop:
  8071 00005DD1 0FB60B                                  movzx   ecx, byte [ebx]
  8072 00005DD4 0FB706                                  movzx   eax, word [esi]
  8073 00005DD7 2B0D[BC250500]                          sub     ecx, [_@@prefix_numbits]
  8074 00005DDD 7E74                                    jle     short .make_table_lop_next
  8075 00005DDF D3E8                                    shr     eax, cl
  8076 00005DE1 3B05[C0250500]                          cmp     eax, [_@@prefix_pattern]
  8077 00005DE7 756A                                    jnz     short .make_table_lop_next
  8078 00005DE9 BF[9C180100]                            mov     edi, huff_tree_buf
  8079 00005DEE 0FB706                                  movzx   eax, word [esi]
  8080 00005DF1 2B0D[B4250500]                          sub     ecx, [_@@table_nb_bits]
  8081 00005DF7 773E                                    ja      short .create_child_table
  8082 00005DF9 F7D9                                    neg     ecx
  8083 00005DFB D3E0                                    shl     eax, cl
  8084 00005DFD 2305[C8250500]                          and     eax, [_@@curr_table_mask]
  8085 00005E03 0305[CC250500]                          add     eax, [_@@curr_table_index]
  8086 00005E09 8D3C87                                  lea     edi, [edi+eax*4]
  8087 00005E0C B801000000                              mov     eax, 1
  8088 00005E11 D3E0                                    shl     eax, cl
  8089 00005E13 89C1                                    mov     ecx, eax
  8090 00005E15 0FB603                                  movzx   eax, byte [ebx]
  8091 00005E18 2B05[BC250500]                          sub     eax, [_@@prefix_numbits]
  8092                                  
  8093                                  .make_rept_lop:
  8094 00005E1E 66837F0200                              cmp     word [edi+2], 0
  8095 00005E23 0F85E9AEFFFF                            jnz     fatalunexpected
  8096 00005E29 668917                                  mov     [edi], dx
  8097 00005E2C 66894702                                mov     [edi+2], ax
  8098 00005E30 83C704                                  add     edi, 4
  8099 00005E33 E2E9                                    loop    .make_rept_lop
  8100 00005E35 EB1C                                    jmp     short .make_table_lop_next
  8101                                  
  8102                                  .create_child_table:
  8103 00005E37 D3E8                                    shr     eax, cl
  8104 00005E39 2305[C8250500]                          and     eax, [_@@curr_table_mask]
  8105 00005E3F 0305[CC250500]                          add     eax, [_@@curr_table_index]
  8106 00005E45 F7D9                                    neg     ecx
  8107 00005E47 66394C8702                              cmp     [edi+eax*4+2], cx
  8108 00005E4C 7C05                                    jl      short .make_table_lop_next
  8109 00005E4E 66894C8702                              mov     [edi+eax*4+2], cx
  8110                                  
  8111                                  .make_table_lop_next:
  8112 00005E53 83C602                                  add     esi, 2
  8113 00005E56 43                                      inc     ebx
  8114 00005E57 42                                      inc     edx
  8115 00005E58 3B15[B8250500]                          cmp     edx, [_@@nb_codes]
  8116 00005E5E 0F826DFFFFFF                            jb      .make_table_lop
  8117 00005E64 5E                                      pop     esi
  8118 00005E65 5B                                      pop     ebx
  8119 00005E66 8B0D[C4250500]                          mov     ecx, [_@@curr_table_size]
  8120 00005E6C 8B15[CC250500]                          mov     edx, [_@@curr_table_index]
  8121                                  
  8122                                  .make_child_tables_lop:
  8123 00005E72 BF[9C180100]                            mov     edi, huff_tree_buf
  8124 00005E77 0FBF449702                              movsx   eax, word [edi+edx*4+2]
  8125 00005E7C 83F800                                  cmp     eax, 0
  8126 00005E7F 796D                                    jns     short .make_child_tables_lop_next
  8127 00005E81 F7D8                                    neg     eax
  8128 00005E83 3B05[B4250500]                          cmp     eax, [_@@table_nb_bits]
  8129 00005E89 7605                                    jbe     short .make_child_tables_this
  8130 00005E8B A1[B4250500]                            mov     eax, [_@@table_nb_bits]
  8131                                  
  8132                                  .make_child_tables_this:
  8133 00005E90 51                                      push	ecx
  8134 00005E91 52                                      push	edx
  8135 00005E92 FF35[CC250500]                          push	dword [_@@curr_table_index]
  8136 00005E98 FF35[B4250500]                          push	dword [_@@table_nb_bits]
  8137 00005E9E FF35[BC250500]                          push	dword [_@@prefix_numbits]
  8138 00005EA4 FF35[C0250500]                          push	dword [_@@prefix_pattern]
  8139 00005EAA 8B0D[B4250500]                          mov	ecx, [_@@table_nb_bits]
  8140 00005EB0 A3[B4250500]                            mov	[_@@table_nb_bits], eax
  8141 00005EB5 010D[BC250500]                          add	[_@@prefix_numbits], ecx
  8142 00005EBB D325[C0250500]                          shl	dword [_@@prefix_pattern], cl
  8143 00005EC1 89D0                                    mov	eax, edx
  8144 00005EC3 2B05[CC250500]                          sub	eax, [_@@curr_table_index]
  8145 00005EC9 0905[C0250500]                          or	[_@@prefix_pattern], eax
  8146 00005ECF E87CFEFFFF                              call	mp3_build_huff_table_recursive_child
  8147 00005ED4 8F05[C0250500]                          pop	dword [_@@prefix_pattern]
  8148 00005EDA 8F05[BC250500]                          pop	dword [_@@prefix_numbits]
  8149 00005EE0 8F05[B4250500]                          pop	dword [_@@table_nb_bits]
  8150 00005EE6 8F05[CC250500]                          pop	dword [_@@curr_table_index]
  8151 00005EEC 5A                                      pop	edx
  8152 00005EED 59                                      pop	ecx
  8153                                  
  8154                                  .make_child_tables_lop_next:
  8155 00005EEE 42                                      inc	edx
  8156 00005EEF E281                                    loop	.make_child_tables_lop
  8157 00005EF1 C3                                      retn
  8158                                  
  8159                                  
  8160                                  ; =============== S U B R O U T I N E =======================================
  8161                                  
  8162                                  
  8163                                  mp3_exclude_id3_and_tag:
  8164 00005EF2 8B35[DC250500]                          mov     esi, [stream_pos]
  8165 00005EF8 8B0D[E0250500]                          mov     ecx, [bytes_left]
  8166 00005EFE 83F90A                                  cmp     ecx, 10
  8167 00005F01 7240                                    jb      short .no_id3
  8168 00005F03 8B06                                    mov     eax, [esi]
  8169 00005F05 25FFFFFF00                              and     eax, 0FFFFFFh
  8170                                                  ;cmp    eax, '3DI'     ; "ID3"
  8171                                                  ; 20/10/2024 
  8172 00005F0A 3D49443300                              cmp     eax, 'ID3'     ; FASM & NASM syntax
  8173 00005F0F 7532                                    jnz     short .no_id3
  8174 00005F11 8B4606                                  mov     eax, [esi+6]
  8175 00005F14 A980808080                              test    eax, 80808080h
  8176 00005F19 7528                                    jnz     short .no_id3
  8177                                  
  8178                                  .xlat_4x7bit_to_28bit:
  8179 00005F1B 86E0                                    xchg    al, ah
  8180 00005F1D D0E0                                    shl     al, 1
  8181 00005F1F 66D1E0                                  shl     ax, 1
  8182 00005F22 66C1E802                                shr     ax, 2
  8183 00005F26 C1C810                                  ror     eax, 16
  8184 00005F29 86E0                                    xchg    al, ah
  8185 00005F2B D0E0                                    shl     al, 1
  8186 00005F2D 66D1E0                                  shl     ax, 1
  8187 00005F30 C1E802                                  shr     eax, 2
  8188 00005F33 83C00A                                  add     eax, 10
  8189 00005F36 39C1                                    cmp     ecx, eax
  8190 00005F38 7209                                    jb      short .no_id3
  8191 00005F3A 01C6                                    add     esi, eax
  8192 00005F3C 29C1                                    sub     ecx, eax
  8193 00005F3E A3[5CED0000]                            mov     [mp3_id3_size], eax
  8194                                  
  8195                                  .no_id3:
  8196 00005F43 BA80000000                              mov     edx, 80h
  8197 00005F48 39D1                                    cmp     ecx, edx
  8198 00005F4A 721F                                    jb      short .no_tag_or_ext
  8199 00005F4C 8B440E80                                mov     eax, [esi+ecx-80h]
  8200 00005F50 25FFFFFF00                              and     eax, 0FFFFFFh
  8201                                                  ;cmp    eax, 'GAT'     ; "TAG"
  8202                                                  ; 20/10/2024
  8203 00005F55 3D54414700                              cmp     eax, 'TAG'     ; FASM & NASM syntax
  8204 00005F5A 0F8421010000                            jz      .got_tag_size_edx
  8205                                                  ;cmp    eax, 'TXE'
  8206 00005F60 3D45585400                              cmp     eax, 'EXT'
  8207 00005F65 0F8416010000                            jz      .got_tag_size_edx
  8208                                  
  8209                                  .no_tag_or_ext:
  8210 00005F6B BAE3000000                              mov     edx, 0E3h
  8211 00005F70 39D1                                    cmp     ecx, edx
  8212 00005F72 7211                                    jb      short .no_tagplus
  8213                                                  ;cmp    dword [esi+ecx-0E3h], '+GAT' ; "TAG+"
  8214                                                  ; 20/10/2024
  8215 00005F74 81BC0E1DFFFFFF5441-                     cmp     dword [esi+ecx-0E3h], 'TAG+'
  8215 00005F7D 472B               
  8216 00005F7F 0F84FC000000                            jz      .got_tag_size_edx
  8217                                  
  8218                                  .no_tagplus:
  8219 00005F85 BA14000000                              mov     edx, 20        ; 10+10
  8220 00005F8A 39D1                                    cmp     ecx, edx
  8221 00005F8C 723C                                    jb      short .no_3di  ; "3DI",04h
  8222 00005F8E 817C0EF633444904                        cmp     dword [esi+ecx-10], 4494433h ; 'ID3'+04000000h
  8223 00005F96 7532                                    jnz     short .no_3di
  8224 00005F98 F6440EFB10                              test    byte [esi+ecx-5], 10h ; bit 4
  8225 00005F9D 742B                                    jz      short .no_3di
  8226 00005F9F 8B440EFC                                mov     eax, [esi+ecx-4]
  8227 00005FA3 A980808080                              test    eax, 80808080h
  8228 00005FA8 7520                                    jnz     short .no_3di
  8229                                  
  8230                                  .@xlat_4x7bit_to_28bit:
  8231 00005FAA 86E0                                    xchg    al, ah
  8232 00005FAC D0E0                                    shl     al, 1
  8233 00005FAE 66D1E0                                  shl     ax, 1
  8234 00005FB1 66C1E802                                shr     ax, 2
  8235 00005FB5 C1C810                                  ror     eax, 10h
  8236 00005FB8 86E0                                    xchg    al, ah
  8237 00005FBA D0E0                                    shl     al, 1
  8238 00005FBC 66D1E0                                  shl     ax, 1
  8239 00005FBF C1E802                                  shr     eax, 2
  8240 00005FC2 8D5014                                  lea     edx, [eax+20]  ; [eax+10+10] ; hdr+footer siz
  8241 00005FC5 E9B7000000                              jmp     .got_tag_size_edx
  8242                                  
  8243                                  .no_3di:
  8244                                                  ;cmp    dword [esi+ecx-32], 'TEPA' ; [esi+ecx-32+0]
  8245                                                  ; 20/10/2024
  8246 00005FCA 817C0EE041504554                        cmp     dword [esi+ecx-32], 'APET'
  8247                                                                         ; check "APETAGEX"
  8248 00005FD2 7520                                    jnz     short .no_ape
  8249                                                  ;cmp    dword [esi+ecx-28], 'XEGA' ; [esi+ecx-32+4]
  8250 00005FD4 817C0EE441474558                        cmp     dword [esi+ecx-28], 'AGEX'
  8251 00005FDC 7516                                    jnz     short .no_ape
  8252 00005FDE 8B540EEC                                mov     edx, [esi+ecx-20] ; [esi+ecx-32+12] ; get size
  8253 00005FE2 F7440EF400000080                        test    dword [esi+ecx-12], 80000000h ; [esi+ecx-32+20],1 shl 31
  8254 00005FEA 7403                                    jz      short .no_ape_header
  8255 00005FEC 83C220                                  add     edx, 32        ; hdr.size
  8256                                  
  8257                                  .no_ape_header: 
  8258 00005FEF E98D000000                              jmp     .got_tag_size_edx
  8259                                  
  8260                                  .no_ape:
  8261 00005FF4 BA14000000                              mov     edx, 20        ; 11+9
  8262 00005FF9 39D1                                    cmp     ecx, edx       ; "LYRICSEND" or "LYRICS200"
  8263                                                                         ; (11+N+9 bytes each)
  8264 00005FFB 7258                                    jb      short .no_lyrics
  8265                                                  ;cmp    dword [esi+ecx-9], 'IRYL'
  8266                                                  ; 20/10/2024
  8267 00005FFD 817C0EF74C595249                        cmp     dword [esi+ecx-9], 'LYRI' ; FASM & NASM syntax
  8268 00006005 754E                                    jnz     short .no_lyrics
  8269 00006007 807C0EFB43                              cmp     byte [esi+ecx-5], 'C'
  8270 0000600C 7547                                    jnz     short .no_lyrics
  8271                                                  ;cmp    dword [esi+ecx-4], 'DNES'
  8272 0000600E 817C0EFC53454E44                        cmp     dword [esi+ecx-4], 'SEND'
  8273 00006016 740C                                    jz      short .lyrics3_v1
  8274                                                  ;cmp    dword [esi+ecx-4], '002S'
  8275 00006018 817C0EFC53323030                        cmp     dword [esi+ecx-4], 'S200'
  8276 00006020 7440                                    jz      short .lyrics3_v2
  8277 00006022 7531                                    jnz     short .no_lyrics
  8278                                  
  8279                                  .lyrics3_v1:
  8280 00006024 BA14000000                              mov     edx, 20        ; 11+9
  8281                                  
  8282                                  .lyrics3_v1_size_lop:
  8283 00006029 8D040E                                  lea     eax, [esi+ecx]
  8284 0000602C 29D0                                    sub     eax, edx
  8285                                                  ;cmp    dword [eax], 'IRYL' ; "LYRICSBEGIN"
  8286                                                  ; 20/10/2024
  8287 0000602E 81384C595249                            cmp     dword [eax], 'LYRI'
  8288 00006034 7512                                    jnz     short .lyrics3_v1_size_next
  8289                                                  ;cmp    dword [eax+4], 'EBSC'
  8290 00006036 81780443534245                          cmp     dword [eax+4], 'CSBE'
  8291 0000603D 7509                                    jnz     short .lyrics3_v1_size_next
  8292                                                  ;cmp    dword [eax+7], 'NIGE'
  8293 0000603F 8178074547494E                          cmp     dword [eax+7], 'EGIN'
  8294 00006046 7439                                    jz      short .got_tag_size_edx
  8295                                  
  8296                                  .lyrics3_v1_size_next:
  8297 00006048 42                                      inc     edx
  8298 00006049 81FA00140000                            cmp     edx, 5120
  8299 0000604F 7704                                    ja      short .no_lyrics
  8300 00006051 39CA                                    cmp     edx, ecx
  8301 00006053 76D4                                    jbe     short .lyrics3_v1_size_lop
  8302                                                  ;jmp     short .no_lyrics
  8303                                  
  8304                                  .no_lyrics:
  8305                                                  ;jmp    short .footer_tag_all_done
  8306                                  		; 22/10/2024
  8307                                  .footer_tag_all_done:
  8308 00006055 8935[DC250500]                          mov     [stream_pos], esi
  8309 0000605B 890D[E0250500]                          mov     [bytes_left], ecx
  8310 00006061 C3                                      retn
  8311                                  
  8312                                  .lyrics3_v2:
  8313 00006062 51                                      push    ecx
  8314 00006063 56                                      push    esi
  8315 00006064 8D740EF1                                lea     esi, [esi+ecx-15] ; [esi+ecx-6-9]
  8316 00006068 B906000000                              mov     ecx, 6
  8317 0000606D 31D2                                    xor     edx, edx
  8318                                  
  8319                                  .lyrics3_v2_size_lop:
  8320 0000606F 6BD20A                                  imul    edx, 10
  8321 00006072 0FB606                                  movzx   eax, byte [esi]
  8322 00006075 46                                      inc     esi
  8323 00006076 2C30                                    sub     al, 30h
  8324 00006078 01C2                                    add     edx, eax
  8325 0000607A E2F3                                    loop    .lyrics3_v2_size_lop
  8326 0000607C 5E                                      pop     esi
  8327 0000607D 59                                      pop     ecx
  8328 0000607E 83C20F                                  add     edx, 0Fh       ; 6+9
  8329                                                  ;jmp    short .got_tag_size_edx
  8330                                  
  8331                                  .got_tag_size_edx:
  8332                                  		;;;
  8333                                  		; 22/10/2024
  8334 00006081 29D1                                    sub    ecx, edx
  8335 00006083 7311                                    jnb    short .cont
  8336                                  		;;;
  8337 00006085 89D0                                    mov     eax, edx
  8338 00006087 E853050000                              call    wr_decimal_eax
  8339 0000608C E822050000                              call    wrcrlf
  8340                                                  ;;;
  8341                                  		;sub    ecx, edx
  8342                                                  ;jb     fatalunexpected
  8343 00006091 E97CACFFFF              		jmp	fatalunexpected
  8344                                  .cont:
  8345                                  		;;;
  8346 00006096 0115[60ED0000]                          add     [mp3_tag_size], edx
  8347 0000609C E9A2FEFFFF                              jmp     .no_id3
  8348                                  
  8349                                  
  8350                                  ; =============== S U B R O U T I N E =======================================
  8351                                  
  8352                                  
  8353                                  mp3_detect_free_format_block_size:
  8354 000060A1 833D[DAEC0000]00                        cmp     dword [mp3_free_format_frame_size], 0
  8355 000060A8 0F85A5000000                            jnz     .already_detected
  8356 000060AE 31D2                                    xor     edx, edx
  8357                                  
  8358                                  .find_distance_lop:
  8359 000060B0 3B15[88ED0000]                          cmp     edx, [mp3_src_remain]
  8360 000060B6 742B                                    jz      short .match_eof
  8361 000060B8 8D4204                                  lea     eax, [edx+4]
  8362 000060BB 3B05[88ED0000]                          cmp     eax, [mp3_src_remain]
  8363 000060C1 771E                                    ja      short .find_distance_failed
  8364 000060C3 8B0416                                  mov     eax, [esi+edx]
  8365 000060C6 E8EDA0FFFF                              call    bswap_eax
  8366 000060CB 3305[8A960000]                          xor     eax, [mp3_hdr_32bit_header]
  8367 000060D1 25000CFEFF                              and     eax, 0FFFE0C00h
  8368 000060D6 740B                                    jz      short .match_eof
  8369                                  
  8370                                  .find_distance_next:
  8371 000060D8 42                                      inc     edx
  8372 000060D9 81FA00100000                            cmp     edx, 1000h
  8373 000060DF 76CF                                    jbe     short .find_distance_lop
  8374                                  
  8375                                  .find_distance_failed:
  8376 000060E1 F9                                      stc
  8377 000060E2 C3                                      retn
  8378                                  
  8379                                  .match_eof:
  8380 000060E3 89D0                                    mov     eax, edx
  8381 000060E5 2B05[96960000]                          sub     eax, [mp3_hdr_flag_padding]
  8382 000060EB 83F804                                  cmp     eax, 4
  8383 000060EE 72E8                                    jb      short .find_distance_next
  8384 000060F0 A3[DAEC0000]                            mov     [mp3_free_format_frame_size], eax
  8385 000060F5 31DB                                    xor     ebx, ebx
  8386                                  
  8387                                  .confirm_distance_lop:
  8388 000060F7 8B041E                                  mov     eax, [esi+ebx]
  8389 000060FA E8B9A0FFFF                              call    bswap_eax
  8390 000060FF C1E80A                                  shr     eax, 10         ; 9+1
  8391 00006102 131D[DAEC0000]                          adc     ebx, [mp3_free_format_frame_size]
  8392 00006108 3B1D[88ED0000]                          cmp     ebx, [mp3_src_remain]
  8393 0000610E 7422                                    jz      short .confirm_distance_match_eof
  8394 00006110 8D4304                                  lea     eax, [ebx+4]
  8395 00006113 3B05[88ED0000]                          cmp     eax, [mp3_src_remain]
  8396 00006119 77BD                                    ja      short .find_distance_next
  8397 0000611B 8B041E                                  mov     eax, [esi+ebx]
  8398 0000611E E895A0FFFF                              call    bswap_eax
  8399 00006123 3305[8A960000]                          xor     eax, [mp3_hdr_32bit_header]
  8400 00006129 25000CFEFF                              and     eax, 0FFFE0C00h
  8401 0000612E 75A8                                    jnz     short .find_distance_next
  8402 00006130 EBC5                                    jmp     short .confirm_distance_lop
  8403                                  
  8404                                  .confirm_distance_match_eof:
  8405 00006132 A1[DAEC0000]                            mov     eax, [mp3_free_format_frame_size]
  8406 00006137 C1E003                                  shl     eax, 3
  8407 0000613A F725[9A960000]                          mul     dword [mp3_sample_rate]
  8408 00006140 8B0D[98ED0000]                          mov     ecx, [mp3_nb_granules]
  8409 00006146 69C940020000                            imul    ecx, 240h
  8410 0000614C F7F1                                    div     ecx
  8411 0000614E A3[A2960000]                            mov     [mp3_bit_rate], eax
  8412                                  
  8413                                  .already_detected:
  8414 00006153 F8                                      clc
  8415 00006154 C3                                      retn
  8416                                  
  8417                                  
  8418                                  ; =============== S U B R O U T I N E =======================================
  8419                                  
  8420                                  
  8421                                  mp3_check_xing_info:
  8422 00006155 C705[E0EC0000]0000-                     mov     dword [mp3_xing_id], 0
  8422 0000615D 0000               
  8423 0000615F C705[E8EC0000]0000-                     mov     dword [mp3_xing_frames], 0
  8423 00006167 0000               
  8424 00006169 C705[ECEC0000]0000-                     mov     dword [mp3_xing_filesize], 0
  8424 00006171 0000               
  8425 00006173 8B35[7E960000]                          mov     esi, [mp3_src_data_location]
  8426 00006179 AD                                      lodsd
  8427                                                  ;cmp    eax, 'gniX'
  8428                                  		; 20/10/2024
  8429 0000617A 3D58696E67              		cmp	eax, 'Xing'     ; FASM & NASM syntax
  8430 0000617F 7401                                    jz      short .xing
  8431 00006181 C3                                      retn
  8432                                  
  8433                                  .xing:
  8434 00006182 A3[E0EC0000]                            mov     [mp3_xing_id], eax
  8435 00006187 AD                                      lodsd
  8436 00006188 E82BA0FFFF                              call    bswap_eax
  8437 0000618D A3[E4EC0000]                            mov     [mp3_xing_flags], eax
  8438 00006192 89C2                                    mov     edx, eax
  8439 00006194 F7C201000000                            test    edx, 1
  8440 0000619A 740B                                    jz      short .no_xing_frames
  8441 0000619C AD                                      lodsd
  8442 0000619D E816A0FFFF                              call    bswap_eax
  8443 000061A2 A3[E8EC0000]                            mov     [mp3_xing_frames], eax
  8444                                  
  8445                                  .no_xing_frames:
  8446 000061A7 F7C202000000                            test    edx, 2          ; 1 shl 1
  8447 000061AD 740B                                    jz      short .no_xing_filesize
  8448 000061AF AD                                      lodsd
  8449 000061B0 E803A0FFFF                              call    bswap_eax
  8450 000061B5 A3[ECEC0000]                            mov     [mp3_xing_filesize], eax
  8451                                  
  8452                                  .no_xing_filesize:
  8453 000061BA F7C204000000                            test    edx, 4          ; 1 shl 2
  8454 000061C0 740C                                    jz      short .no_xing_toc
  8455 000061C2 B964000000                              mov     ecx, 100
  8456 000061C7 BF[F0EC0000]                            mov     edi, mp3_xing_toc
  8457 000061CC F3A4                                    rep movsb
  8458                                  
  8459                                  .no_xing_toc:
  8460 000061CE F7C208000000                            test    edx, 8          ; 1 shl 3
  8461 000061D4 740B                                    jz      short .no_xing_vbr_scale
  8462 000061D6 AD                                      lodsd
  8463 000061D7 E8DC9FFFFF                              call    bswap_eax
  8464 000061DC A3[54ED0000]                            mov     [mp3_xing_vbr_scale], eax
  8465                                  
  8466                                  .no_xing_vbr_scale:
  8467 000061E1 C705[A2960000]0000-                     mov	dword [mp3_bit_rate], 0
  8467 000061E9 0000               
  8468 000061EB A1[9A960000]                            mov	eax, [mp3_sample_rate]
  8469 000061F0 C1E003                                  shl	eax, 3
  8470 000061F3 F725[ECEC0000]                          mul	dword [mp3_xing_filesize]
  8471 000061F9 8B0D[E8EC0000]                          mov	ecx, [mp3_xing_frames]
  8472 000061FF 0FAF0D[98ED0000]                        imul	ecx, [mp3_nb_granules]
  8473 00006206 69C940020000                            imul	ecx, 576        ; 18*32
  8474 0000620C 39CA                                    cmp	edx, ecx
  8475 0000620E 7307                                    jnb	short .overflow
  8476 00006210 F7F1                                    div	ecx
  8477 00006212 A3[A2960000]                            mov	[mp3_bit_rate], eax
  8478                                  
  8479                                  .overflow:
  8480 00006217 C3                                      retn
  8481                                  
  8482                                  
  8483                                  ; =============== S U B R O U T I N E =======================================
  8484                                  
  8485                                  		; 20/10/2024
  8486                                  mp3_decode_frame:
  8487 00006218 890D[88ED0000]                          mov     [mp3_src_remain], ecx
  8488 0000621E 893D[6CED0000]                          mov     [mp3_samples_dst], edi
  8489 00006224 F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
  8490 0000622B 740E                                    jz      short .no_rdtsc_supported@@@@
  8491 0000622D 0F31                                    rdtsc
  8492 0000622F 2905[0C710000]                          sub     [rdtsc_total], eax
  8493 00006235 1915[10710000]                          sbb     [rdtsc_total+4], edx
  8494                                  
  8495                                  .no_rdtsc_supported@@@@:
  8496 0000623B E8DC9FFFFF                              call    mp3_search_get_header
  8497 00006240 0F8294010000                            jc      .error
  8498 00006246 A1[82960000]                            mov     eax, [mp3_src_frame_size]
  8499 0000624B 83F800                                  cmp     eax, 0
  8500 0000624E 0F8E86010000                            jle     .error
  8501 00006254 3B05[88ED0000]                          cmp     eax, [mp3_src_remain]
  8502 0000625A 0F877A010000                            ja      .error
  8503 00006260 8935[84ED0000]                          mov     [mp3_bitstream_start], esi
  8504                                  		; 11/01/2025
  8505                                  		;mov	eax, 32
  8506                                  
  8507                                  .mp3mac_bitstream_set_position:
  8508                                  		; 22/10/2024
  8509                                                  ;mov    esi, [mp3_bitstream_start]
  8510                                                  ;mov    cl, al
  8511                                                  ;shr    eax, 3
  8512                                                  ;and    cl, 7
  8513                                                  ;mov	eax, 4
  8514                                                  ;add    esi, eax
  8515 00006266 83C604                                  add     esi, 4
  8516 00006269 E8529FFFFF                              call    mp3_recollect_bits
  8517                                  
  8518                                  .mp3mac_get_n_bits:
  8519                                                  ;mov    eax, ebp        ; mp3_col32
  8520                                                  ;shl    ebp, cl
  8521                                                  ;rol    eax, cl
  8522                                                  ;xor    eax, ebp        ; mp3_col32
  8523                                                  ;sub    ch, cl          ; sub mp3_colNN,num
  8524                                                  ;jns    short .cont
  8525                                                  ;mov    cl, ch          ; mov cl,mp3_colNN
  8526                                                  ;add    ch, 16
  8527                                                  ;rol    ebp, cl         ; rol mp3_col32,cl
  8528                                                  ;mov    bp, [esi]       ; mov mp3_col16,word ptr [esi]
  8529                                                  ;add    esi, 2
  8530                                                  ;ror    bp, 8           ; endianess
  8531                                                  ;ror    ebp, cl         ; ror mp3_col32,cl
  8532                                  
  8533                                  .cont:
  8534 0000626E E8AFA1FFFF                              call	mp3_bitstream_read_header_extra
  8535 00006273 E839A3FFFF                              call	mp3_bitstream_read_granules
  8536 00006278 0F825C010000                            jc	.error
  8537 0000627E E88D9FFFFF                              call	mp3_uncollect_bits
  8538 00006283 8935[7E960000]                          mov	[mp3_src_data_location], esi
  8539 00006289 833D[6CED0000]00                        cmp	dword [mp3_samples_dst], 0
  8540 00006290 0F840F010000                            jz	.skip_decoding
  8541 00006296 E8ECA7FFFF                              call	mp3_bitstream_append_to_main_data_pool
  8542 0000629B 833D[70ED0000]00                        cmp	dword [mp3_samples_output_size], 0
  8543 000062A2 0F84FD000000                            jz	.skip_decoding
  8544                                  
  8545 000062A8 C705[7CED0000]0000-                     mov	dword [mp3_curr_granule], 0
  8545 000062B0 0000               
  8546 000062B2 BB[9CED0000]                            mov	ebx, mp3_granules
  8547                                  
  8548                                  .body_granule_lop:
  8549 000062B7 891D[D0250500]                          mov	[_@@granule_addr], ebx
  8550 000062BD C705[78ED0000]0000-                     mov	dword [mp3_curr_channel], 0
  8550 000062C5 0000               
  8551                                  
  8552                                  .body_channel_lop:
  8553 000062C7 8B4304                                  mov     eax, [ebx+4]    ; [ebx+$mp3gr_part2_3_start]
  8554 000062CA 8B35[84ED0000]                          mov     esi, [mp3_bitstream_start]
  8555 000062D0 88C1                                    mov     cl, al          ; mp3mac_bitstream_set_position
  8556 000062D2 C1E803                                  shr     eax, 3
  8557 000062D5 80E107                                  and     cl, 7
  8558 000062D8 01C6                                    add     esi, eax
  8559 000062DA E8E19EFFFF                              call    mp3_recollect_bits
  8560 000062DF 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits cl
  8561 000062E1 D3E5                                    shl     ebp, cl
  8562 000062E3 D3C0                                    rol     eax, cl
  8563 000062E5 31E8                                    xor     eax, ebp
  8564 000062E7 28CD                                    sub     ch, cl
  8565 000062E9 7913                                    jns     short .cont@
  8566 000062EB 88E9                                    mov     cl, ch          ; mp3mac_collect_more
  8567 000062ED 80C510                                  add     ch, 16
  8568 000062F0 D3C5                                    rol     ebp, cl
  8569 000062F2 668B2E                                  mov     bp, [esi]
  8570 000062F5 83C602                                  add     esi, 2
  8571 000062F8 66C1CD08                                ror     bp, 8
  8572 000062FC D3CD                                    ror     ebp, cl
  8573                                  
  8574                                  .cont@:
  8575 000062FE E81AA8FFFF                              call    mp3_bitstream_read_scalefacs
  8576 00006303 E812AAFFFF                              call    mp3_get_exponents_from_scale_factors
  8577 00006308 E856ABFFFF                              call    mp3_huffman_decode ; reads up to $mp3gr_part2_3_end
  8578 0000630D 0F82C7000000                            jc      .error
  8579                                  
  8580                                  .body_channel_next:
  8581 00006313 81C340130000                            add	ebx, 4928       ; $mp3gr_entrysiz*2
  8582 00006319 FF05[78ED0000]                          inc	dword [mp3_curr_channel]
  8583 0000631F A1[78ED0000]                            mov	eax, [mp3_curr_channel]
  8584 00006324 3B05[AA960000]                          cmp	eax, [mp3_output_num_channels]
  8585 0000632A 729B                                    jb	short .body_channel_lop
  8586 0000632C 8B1D[D0250500]                          mov	ebx, [_@@granule_addr]
  8587                                  
  8588                                  .mp3mac_push_bitstream:
  8589 00006332 51                                      push	ecx
  8590 00006333 55                                      push	ebp
  8591 00006334 56                                      push	esi
  8592 00006335 E827B0FFFF                              call	mp3_compute_stereo
  8593 0000633A C705[78ED0000]0000-                     mov	dword [mp3_curr_channel], 0
  8593 00006342 0000               
  8594                                  
  8595                                  .cast_channel_lop:
  8596 00006344 E8F0B2FFFF                              call    mp3_reorder_block
  8597 00006349 E885B3FFFF                              call    mp3_compute_antialias
  8598 0000634E E870BCFFFF                              call    mp3_compute_imdct
  8599 00006353 81C340130000                            add     ebx, 4928       ; $mp3gr_entrysiz*2
  8600 00006359 FF05[78ED0000]                          inc	dword [mp3_curr_channel]
  8601 0000635F A1[78ED0000]                            mov     eax, [mp3_curr_channel]
  8602 00006364 3B05[AA960000]                          cmp     eax, [mp3_output_num_channels]
  8603 0000636A 72D8                                    jc      short .cast_channel_lop
  8604                                  
  8605                                  .mp3mac_pop_bitstream:
  8606 0000636C 5E                                      pop	esi
  8607 0000636D 5D                                      pop	ebp
  8608 0000636E 59                                      pop	ecx
  8609 0000636F 8B1D[D0250500]                          mov	ebx, [_@@granule_addr]
  8610 00006375 81C3A0090000                            add	ebx, 2464       ; $mp3gr_entrysiz
  8611 0000637B FF05[7CED0000]                          inc	dword [mp3_curr_granule]
  8612 00006381 A1[7CED0000]                            mov	eax, [mp3_curr_granule]
  8613 00006386 3B05[98ED0000]                          cmp	eax, [mp3_nb_granules]
  8614 0000638C 0F8225FFFFFF                            jc	.body_granule_lop
  8615 00006392 E8799EFFFF                              call	mp3_uncollect_bits
  8616 00006397 3B35[7A960000]                          cmp	esi, [main_data_pool_wr_ptr]
  8617 0000639D 773B                                    ja	short .error
  8618 0000639F FF15[CE960000]                          call	dword [mp3_synth_filter_proc] ; synth maths
  8619                                  
  8620                                  .skip_decoding:
  8621 000063A5 A1[8CED0000]                            mov     eax, [mp3_extra_bytes]
  8622 000063AA 0105[82960000]                          add     [mp3_src_frame_size], eax
  8623 000063B0 A1[70ED0000]                            mov     eax, [mp3_samples_output_size]
  8624 000063B5 0105[68ED0000]                          add     [mp3_total_output_size], eax
  8625 000063BB FF05[64ED0000]                          inc     dword [mp3_num_frames_decoded]
  8626                                  
  8627                                  .timelog_end:                            ; timelog_end macro ttt
  8628 000063C1 F605[4C6F0000]10                        test    byte [cpuid_flags], 10h
  8629 000063C8 740F                                    jz      short .no_rdtsc_supported
  8630 000063CA 0F31                                    rdtsc                   ; read timestamp counter
  8631 000063CC 0105[0C710000]                          add     [rdtsc_total], eax
  8632 000063D2 1115[10710000]                          adc     [rdtsc_total+4], edx
  8633                                  		; 22/10/2024
  8634 000063D8 F8                      		clc	
  8635                                  		; 20/10/2024
  8636                                  .no_rdtsc_supported:
  8637                                                  ;clc
  8638 000063D9 C3                                      retn
  8639                                  
  8640                                  .error:
  8641 000063DA F605[4C6F0000]10                        test    byte [cpuid_flags], 10h ; timelog_end rdtsc_total
  8642 000063E1 740E                                    jz      short .no_rdtsc_supported@
  8643 000063E3 0F31                                    rdtsc
  8644 000063E5 0105[0C710000]                          add     [rdtsc_total], eax
  8645 000063EB 1115[10710000]                          adc     [rdtsc_total+4], edx
  8646                                  
  8647                                  		; 20/10/2024
  8648                                  .no_rdtsc_supported@:
  8649 000063F1 A1[8CED0000]                            mov     eax, [mp3_extra_bytes]
  8650 000063F6 0105[82960000]                          add     [mp3_src_frame_size], eax
  8651 000063FC F9                                      stc
  8652 000063FD C3                                      retn
  8653                                  
  8654                                  
  8655                                  ; =============== S U B R O U T I N E =======================================
  8656                                  
  8657                                  
  8658                                  mp3_init:
  8659 000063FE BF[7A860000]                            mov     edi, main_data_pool_start ; = mp3_context_start
  8660                                                  ;mov    ecx, 74916      ; (mp3_context_end-mp3_context_start)/4
  8661 00006403 B983240100                              mov     ecx, (mp3_context_end-mp3_context_start)/4
  8662 00006408 31C0                                    xor     eax, eax        ; ERRIF @@len AND 03h
  8663 0000640A F3AB                                    rep stosd               ; clear context
  8664 0000640C C705[7A960000]-                         mov	dword [main_data_pool_wr_ptr], main_data_pool_start
  8664 00006412 [7A860000]         
  8665 00006416 833D[E47D0000]00                        cmp     dword [mp3_initialized], 0
  8666 0000641D 753C                                    jnz     short .already_initialized
  8667 0000641F E8CAF6FFFF                              call    mp3_integer_init_is_stereo_lsf
  8668 00006424 E823F7FFFF                              call    mp3_integer_init_mdct_windows
  8669 00006429 E846F7FFFF                              call    mp3_integer_init_table_4_3
  8670 0000642E E8A4F7FFFF                              call    mp3_integer_init_exponent
  8671 00006433 E8F3F4FFFF                              call    mp3_any_init_synth_window
  8672 00006438 E8D2F5FFFF                              call    mp3_any_init_band_indices
  8673 0000643D E8F7F5FFFF                              call    mp3_any_init_lsf_sf_expand
  8674 00006442 E840F6FFFF                              call    mp3_any_init_huff_tables
  8675 00006447 E8D0F8FFFF                              call    mp3_init_log_constants
  8676 0000644C E8A3F5FFFF                              call    mp3_init_post_collapse
  8677 00006451 C705[E47D0000]0100-                     mov     dword [mp3_initialized], 1
  8677 00006459 0000               
  8678                                  
  8679                                  .already_initialized:
  8680 0000645B 0FB605[496F0000]                        movzx   eax, byte [option_fast]
  8681 00006462 C705[B2960000]0200-                     mov     dword [mp3_bytes_per_sample], 2
  8681 0000646A 0000               
  8682 0000646C D1E0                                    shl     eax, 1
  8683 0000646E 0205[476F0000]                          add     al, [option_8bit]
  8684 00006474 A801                                    test    al, 1
  8685 00006476 740A                                    jz      short .not_8bit
  8686 00006478 C705[B2960000]0100-                     mov     dword [mp3_bytes_per_sample], 1
  8686 00006480 0000               
  8687                                  .not_8bit:
  8688 00006482 6BC003                                  imul    eax, 3
  8689 00006485 0205[486F0000]                          add     al, [option_rate_shift]
  8690 0000648B 8B0485[0A840000]                        mov     eax, [mp3_synth_filter_procs+eax*4]
  8691 00006492 A3[CE960000]                            mov     [mp3_synth_filter_proc], eax
  8692 00006497 C3                                      retn
  8693                                  
  8694                                  
  8695                                  ; =============== S U B R O U T I N E =======================================
  8696                                  
  8697                                  
  8698                                  mp3_check_1st_frame:
  8699 00006498 E855FAFFFF                              call    mp3_exclude_id3_and_tag
  8700 0000649D 8B35[DC250500]                          mov     esi, [stream_pos]
  8701 000064A3 8B0D[E0250500]                          mov     ecx, [bytes_left]
  8702 000064A9 31FF                                    xor     edi, edi
  8703 000064AB 31ED                                    xor     ebp, ebp
  8704 000064AD E866FDFFFF                              call    mp3_decode_frame
  8705 000064B2 0F82E9000000                            jc     .error
  8706 000064B8 E898FCFFFF                              call    mp3_check_xing_info
  8707 000064BD BA[68840000]                            mov     edx, txt_file_size ; "file size: "
  8708 000064C2 E8DB000000                              call    wrstr_edx
  8709 000064C7 A1[58ED0000]                            mov     eax, [mp3_file_size]
  8710 000064CC E807010000                              call    wr_decimal_eax_with_thousands_seperator
  8711 000064D1 BA[74840000]                            mov     edx, txt_id3_size ; ", id3 size: "
  8712 000064D6 E8C7000000                              call    wrstr_edx
  8713 000064DB A1[5CED0000]                            mov     eax, [mp3_id3_size]
  8714 000064E0 E8F3000000                              call    wr_decimal_eax_with_thousands_seperator
  8715 000064E5 BA[81840000]                            mov     edx, txt_tag_size ; ", tag size: "
  8716 000064EA E8B3000000                              call    wrstr_edx
  8717 000064EF A1[60ED0000]                            mov     eax, [mp3_tag_size]
  8718 000064F4 E8DF000000                              call    wr_decimal_eax_with_thousands_seperator
  8719 000064F9 E8B5000000                              call    wrcrlf
  8720 000064FE BA[8E840000]                            mov     edx, txt_input ; "input: "
  8721 00006503 E89A000000                              call    wrstr_edx
  8722 00006508 A1[9A960000]                            mov     eax, [mp3_sample_rate]
  8723 0000650D E8CD000000                              call    wr_decimal_eax
  8724 00006512 BA[9F840000]                            mov     edx, txt_hz ; " hz, "
  8725 00006517 E886000000                              call    wrstr_edx
  8726 0000651C A1[A6960000]                            mov     eax, [mp3_src_num_channels]
  8727 00006521 E8B9000000                              call    wr_decimal_eax
  8728 00006526 BA[A5840000]                            mov     edx, txt_channels ; " channels, "
  8729 0000652B E872000000                              call    wrstr_edx
  8730 00006530 A1[A2960000]                            mov     eax, [mp3_bit_rate]
  8731 00006535 31D2                                    xor     edx, edx
  8732 00006537 B9E8030000                              mov     ecx, 1000
  8733 0000653C F7F1                                    div     ecx
  8734 0000653E E89C000000                              call    wr_decimal_eax
  8735 00006543 BA[B6840000]                            mov     edx, txt_kbit_s ; " kbit/s"
  8736 00006548 E855000000                              call    wrstr_edx
  8737 0000654D E861000000                              call    wrcrlf
  8738 00006552 BA[96840000]                            mov     edx, txt_output ; "output: "
  8739 00006557 E846000000                              call    wrstr_edx
  8740 0000655C A1[AE960000]                            mov     eax, [mp3_output_sample_rate]
  8741 00006561 E879000000                              call    wr_decimal_eax
  8742 00006566 BA[9F840000]                            mov     edx, txt_hz ; " hz, "
  8743 0000656B E832000000                              call    wrstr_edx
  8744 00006570 A1[AA960000]                            mov     eax, [mp3_output_num_channels]
  8745 00006575 E865000000                              call    wr_decimal_eax
  8746 0000657A BA[A5840000]                            mov     edx, txt_channels ; " channels, "
  8747 0000657F E81E000000                              call    wrstr_edx
  8748 00006584 A1[B2960000]                            mov     eax, [mp3_bytes_per_sample]
  8749 00006589 C1E003                                  shl     eax, 3
  8750 0000658C E84E000000                              call    wr_decimal_eax
  8751 00006591 BA[B1840000]                            mov     edx, txt_bit ; " bit"
  8752 00006596 E807000000                              call    wrstr_edx
  8753 0000659B E813000000                              call    wrcrlf
  8754 000065A0 F8                                      clc
  8755                                  .error:
  8756 000065A1 C3                                      retn
  8757                                  
  8758                                  ;.error:
  8759                                                  ;stc
  8760                                                  ;retn
  8761                                  
  8762                                  
  8763                                  ; =============== S U B R O U T I N E =======================================
  8764                                  
  8765                                  ;wrchr:
  8766                                                  ;pusha
  8767                                                  ;mov     [wrchr_buf], al
  8768                                                  ;push    0            ; lpOverlapped
  8769                                                  ;push    diskresult   ; lpNumberOfBytesWritten
  8770                                                  ;push    1            ; nNumberOfBytesToWrite
  8771                                                  ;push    wrchr_buf    ; lpBuffer
  8772                                                  ;push    [std_out]    ; hFile
  8773                                                  ;call    [WriteFile]
  8774                                                  ;popa
  8775                                                  ;retn
  8776                                  
  8777                                  
  8778                                  ; =============== S U B R O U T I N E =======================================
  8779                                  
  8780                                  
  8781                                  wrstr_edx:
  8782 000065A2 50                                      push    eax
  8783                                  .lop:
  8784 000065A3 8A02                                    mov     al, [edx]
  8785 000065A5 42                                      inc     edx
  8786 000065A6 3C00                                    cmp     al, 0
  8787 000065A8 7407                                    jz      short .done
  8788 000065AA E801040000                              call    wrchr
  8789 000065AF EBF2                                    jmp     short .lop
  8790                                  .done:
  8791 000065B1 58                                      pop     eax
  8792 000065B2 C3                                      retn
  8793                                  
  8794                                  ; =============== S U B R O U T I N E =======================================
  8795                                  
  8796                                  
  8797                                  wrcrlf:
  8798 000065B3 50                                      push    eax
  8799 000065B4 B00D                                    mov     al, 0Dh
  8800 000065B6 E8F5030000                              call    wrchr
  8801 000065BB B00A                                    mov     al, 0Ah
  8802 000065BD E8EE030000                              call    wrchr
  8803 000065C2 58                                      pop     eax
  8804 000065C3 C3                                      retn
  8805                                  
  8806                                  ; =============== S U B R O U T I N E =======================================
  8807                                  
  8808                                  
  8809                                  wrspc:
  8810 000065C4 50                                      push    eax
  8811 000065C5 B020                                    mov     al, 20h
  8812 000065C7 E8E4030000                              call    wrchr
  8813 000065CC 58                                      pop     eax
  8814 000065CD C3                                      retn
  8815                                  
  8816                                  ; =============== S U B R O U T I N E =======================================
  8817                                  
  8818                                  
  8819                                  wrcomma:
  8820 000065CE 50                                      push    eax
  8821 000065CF B02C                                    mov     al, ','
  8822 000065D1 E8DA030000                              call    wrchr
  8823 000065D6 58                                      pop     eax
  8824 000065D7 C3                                      retn
  8825                                  
  8826                                  ; =============== S U B R O U T I N E =======================================
  8827                                  
  8828                                  
  8829                                  wr_decimal_eax_with_thousands_seperator:
  8830 000065D8 51                                      push    ecx
  8831 000065D9 66B90200                                mov     cx, 2
  8832 000065DD EB03                                    jmp     short wr_decimal_eax_inj
  8833                                  
  8834                                  ; =============== S U B R O U T I N E =======================================
  8835                                  
  8836                                  
  8837                                  wr_decimal_eax:
  8838 000065DF 51                                      push    ecx
  8839 000065E0 31C9                                    xor     ecx, ecx
  8840                                  
  8841                                  wr_decimal_eax_inj:
  8842 000065E2 50                                      push    eax
  8843 000065E3 53                                      push    ebx
  8844 000065E4 52                                      push    edx
  8845 000065E5 BB00CA9A3B                              mov     ebx, 1000000000 ; nine zeroes (32bit max 4.294.967.296)
  8846                                  
  8847                                  .dezlop:
  8848 000065EA FEC9                                    dec     cl
  8849 000065EC 750C                                    jnz     short .no_thousands
  8850 000065EE B103                                    mov     cl, 3
  8851 000065F0 80FD00                                  cmp     ch, 0
  8852 000065F3 7405                                    jz      short .no_thousands
  8853 000065F5 E8D4FFFFFF                              call    wrcomma
  8854                                  
  8855                                  .no_thousands:
  8856 000065FA 31D2                                    xor     edx, edx
  8857 000065FC F7F3                                    div     ebx
  8858 000065FE 83FB01                                  cmp     ebx, 1
  8859 00006601 7404                                    jz      short .force_last_zero
  8860 00006603 08C5                                    or      ch, al
  8861 00006605 7407                                    jz      short .skip_lead_zero
  8862                                  
  8863                                  .force_last_zero:
  8864 00006607 0430                                    add     al, 30h
  8865 00006609 E8A2030000                              call    wrchr
  8866                                  
  8867                                  .skip_lead_zero:
  8868 0000660E 52                                      push    edx
  8869 0000660F 89D8                                    mov     eax, ebx
  8870 00006611 BB0A000000                              mov     ebx, 10
  8871 00006616 31D2                                    xor     edx, edx
  8872 00006618 F7F3                                    div     ebx
  8873 0000661A 83F800                                  cmp     eax, 0
  8874 0000661D 89C3                                    mov     ebx, eax
  8875 0000661F 58                                      pop     eax
  8876 00006620 75C8                                    jnz     short .dezlop
  8877 00006622 5A                                      pop     edx
  8878 00006623 5B                                      pop     ebx
  8879 00006624 58                                      pop     eax
  8880 00006625 59                                      pop     ecx
  8881 00006626 C3                                      retn
  8882                                  
  8883                                  ; =============== S U B R O U T I N E =======================================
  8884                                  
  8885                                  
  8886                                  wrdigital:
  8887 00006627 50                                      push    eax
  8888 00006628 240F                                    and     al, 0Fh
  8889 0000662A 3C09                                    cmp     al, 9
  8890 0000662C 7602                                    jbe     short .this
  8891 0000662E 0407                                    add     al, 7
  8892                                  
  8893                                  .this:
  8894 00006630 0430                                    add     al, 30h
  8895 00006632 E879030000                              call    wrchr
  8896 00006637 58                                      pop     eax
  8897 00006638 C3                                      retn
  8898                                  
  8899                                  ; =============== S U B R O U T I N E =======================================
  8900                                  
  8901                                  
  8902                                  wrhexal:
  8903 00006639 C0C804                                  ror     al, 4
  8904 0000663C E8E6FFFFFF                              call    wrdigital
  8905 00006641 C0C804                                  ror     al, 4
  8906 00006644 EBE1                                    jmp     short wrdigital
  8907                                  
  8908                                  ; =============== S U B R O U T I N E =======================================
  8909                                  
  8910                                  
  8911                                  wrhexax:
  8912 00006646 66C1C808                                ror     ax, 8
  8913 0000664A E8EAFFFFFF                              call    wrhexal
  8914 0000664F 66C1C808                                ror     ax, 8
  8915 00006653 EBE4                                    jmp     short wrhexal
  8916                                  
  8917                                  ; =============== S U B R O U T I N E =======================================
  8918                                  
  8919                                  
  8920                                  wrhexeax:
  8921 00006655 C1C810                                  ror     eax, 10h
  8922 00006658 E8E9FFFFFF                              call    wrhexax
  8923 0000665D C1C810                                  ror     eax, 10h
  8924 00006660 EBE4                                    jmp     short wrhexax
  8925                                  
  8926                                  ; =============== S U B R O U T I N E =======================================
  8927                                  
  8928                                  %if 0
  8929                                  
  8930                                  get_commandline:
  8931                                                  call    [GetCommandLineA]
  8932                                                  mov     esi, eax
  8933                                                  mov     edi, cmdline_buf
  8934                                                  mov     ecx, 1024       ; cmdline_max
  8935                                  
  8936                                  .get_cmdline_lop:
  8937                                                  lodsb
  8938                                                  cmp     al, 0
  8939                                                  stosb
  8940                                                  loopne  .get_cmdline_lop
  8941                                                  mov     byte [edi-1], 0
  8942                                                  mov     esi, cmdline_buf
  8943                                                  mov     edi, cmdline_buf
  8944                                                  call    _@@get_item     ; get/skip name of the executable itself
  8945                                  
  8946                                  .get_items_lop:
  8947                                                  call    _@@get_item
  8948                                                  mov     al, [ebx]
  8949                                                  cmp     al, 0
  8950                                                  jz      .done
  8951                                                  cmp     al, '/'
  8952                                                  jz      short .switch
  8953                                                  cmp     al, '-'
  8954                                                  jz      short .switch
  8955                                                  mov     eax, [edi-5]
  8956                                                  or      eax, 20202000h
  8957                                                  ;cmp    eax, 'vaw.'     ; ".wav"
  8958                                                  cmp     eax, '.wav'     ; FASM & NASM syntax
  8959                                                  jnz     short .not_wav_name
  8960                                                  mov     [mp3_dst_fname], ebx
  8961                                                  jmp     short .get_items_lop
  8962                                  
  8963                                  .not_wav_name:
  8964                                                  mov     eax, [edi-5]
  8965                                                  or      eax, 20202000h
  8966                                                  ;cmp    eax, 'mcp.'     ; ".pcm"
  8967                                                  cmp     eax, '.pcm'     ; FASM & NASM syntax
  8968                                                  jnz     short .not_pcm_name
  8969                                                  mov     [mp3_pcm_fname], ebx
  8970                                                  jmp     short .get_items_lop
  8971                                  
  8972                                  .not_pcm_name:
  8973                                                  mov     [mp3_src_fname], ebx
  8974                                                  jmp     short .get_items_lop
  8975                                  
  8976                                  .switch:
  8977                                                  ;cmp	dword [ebx+1], 'onom' ; "mono"
  8978                                                  cmp	dword [ebx+1], 'mono'
  8979                                                  jnz     short .not_switch_mono
  8980                                                  mov	byte [option_mono], 1
  8981                                                  jmp	short .get_items_lop
  8982                                  
  8983                                  .not_switch_mono:
  8984                                                  ;cmp	dword [ebx+1], 'tsaf' ; "fast"
  8985                                                  cmp	dword [ebx+1], 'fast' ; FASM & NASM syntax
  8986                                                  jnz	short .not_fast_option
  8987                                                  mov	byte [option_fast], 1
  8988                                                  jmp	short .get_items_lop
  8989                                  
  8990                                  .not_fast_option:
  8991                                                  ;cmp    dword [ebx+1], 'tib8' ; "8bit"
  8992                                                  cmp     dword [ebx+1], '8bit'
  8993                                                  jnz     short .not_switch_8bit
  8994                                                  mov     [option_8bit], 1
  8995                                                  jmp     .get_items_lop
  8996                                  
  8997                                  .not_switch_8bit:
  8998                                                  ;cmp    dword [ebx+1], 'flah' ; "half"
  8999                                                  cmp     dword [ebx+1], 'half'
  9000                                                  jnz     short .not_switch_half
  9001                                                  mov     [option_rate_shift], 1
  9002                                                  jmp     .get_items_lop
  9003                                  
  9004                                  .not_switch_half:
  9005                                                  ;cmp    dword [ebx+1], 'rauq' ; "quar"
  9006                                                  cmp     dword [ebx+1], 'quar'
  9007                                                  jnz     short .not_switch_quarter
  9008                                                  mov     [option_rate_shift], 2
  9009                                                  jmp     .get_items_lop
  9010                                  
  9011                                  .not_switch_quarter:
  9012                                                  ;cmp    dword [ebx+1], 'tset' ; "test"
  9013                                                  cmp     dword [ebx+1], 'test'
  9014                                                  jnz     short .not_switch_test
  9015                                                  mov     byte [option_test], 1
  9016                                                  jmp     .get_items_lop
  9017                                  
  9018                                  .not_switch_test:
  9019                                                  jmp     short .help
  9020                                  
  9021                                  .done:
  9022                                                  cmp	dword [mp3_src_fname], 0
  9023                                                  jz      short .help
  9024                                                  ;;; Erdogan Tan - 17/10/2024
  9025                                                  mov     edx, txt_ctrlc
  9026                                                  call    wrstr_edx
  9027                                                  ;;;
  9028                                                  mov     edx, txt_file ; "file: "
  9029                                                  call    wrstr_edx
  9030                                                  mov     edx, [mp3_src_fname]
  9031                                                  call    wrstr_edx
  9032                                                  call    wrcrlf
  9033                                                  clc
  9034                                                  retn
  9035                                  
  9036                                  .help:
  9037                                                  ;;; Erdogan Tan - 17/10/2024
  9038                                                  mov     edx, txt_about
  9039                                                  call    wrstr_edx
  9040                                                  ;;;
  9041                                                  mov     edx, txt_help ; "usage: mp3play input.mp3 [output.wav] ["...
  9042                                                  call    wrstr_edx
  9043                                                  stc
  9044                                                  retn
  9045                                  
  9046                                  %endif
  9047                                  
  9048                                  ; =============== S U B R O U T I N E =======================================
  9049                                  
  9050                                  %if 0
  9051                                  
  9052                                  _@@get_item:
  9053                                                  lodsb
  9054                                                  dec     al
  9055                                                  cmp     al, 1Fh         ; 20-1
  9056                                                  jbe     short _@@get_item ; _@@skip_spc_lop
  9057                                                  dec     esi
  9058                                                  mov     ebx, edi
  9059                                                  mov     ah, 0           ; flag initially not quoted
  9060                                  
  9061                                  .char_lop:
  9062                                                  lodsb
  9063                                                  cmp     al, '"'
  9064                                                  jnz     short .no_quote
  9065                                                  xor     ah, 1
  9066                                                  jmp     short .char_lop
  9067                                  
  9068                                  .no_quote:
  9069                                                  stosb
  9070                                                  cmp     al, 0
  9071                                                  jz      short .src_end
  9072                                                  cmp     al, 20h
  9073                                                  ja      short .char_lop
  9074                                                  cmp     ah, 0           ; ignore spaces if inside "quoted area"
  9075                                                  jnz     short .char_lop
  9076                                                  mov     byte [edi-1], 0 ; eol (replace space by 00h)
  9077                                                  retn
  9078                                  
  9079                                  .src_end:
  9080                                                  dec     esi
  9081                                                  retn
  9082                                  
  9083                                  %endif
  9084                                  
  9085                                  ; =============== S U B R O U T I N E =======================================
  9086                                  
  9087                                  
  9088                                  %if 0
  9089                                  
  9090                                  open_and_mmap_the_file:
  9091                                                  push    0               ; hTemplateFile
  9092                                                  push    0               ; dwFlagsAndAttributes
  9093                                                  push    3               ; dwCreationDisposition
  9094                                                  push    0               ; lpSecurityAttributes
  9095                                                  push    1               ; dwShareMode
  9096                                                  push    80000000h       ; dwDesiredAccess
  9097                                                  push    [mp3_src_fname] ; lpFileName
  9098                                                  call    [CreateFileA]
  9099                                                  mov     [hFile], eax
  9100                                                  cmp     eax, 0FFFFFFFFh ; INVALID_HANDLE_VALUE
  9101                                                  jz      short .not_found
  9102                                                  push    0               ; lpFileSizeHigh
  9103                                                  push    [hFile]      ; hFile
  9104                                                  call    [GetFileSize]
  9105                                                  mov     [mp3_file_size], eax
  9106                                                  mov     [bytes_left], eax
  9107                                                  push    0               ; lpName
  9108                                                  push    0               ; dwMaximumSizeLow
  9109                                                  push    0               ; dwMaximumSizeHigh
  9110                                                  push    2               ; flProtect
  9111                                                  push    0               ; lpFileMappingAttributes
  9112                                                  push    [hFile]      ; hFile
  9113                                                  call    [CreateFileMappingA]
  9114                                                  mov     [hMap], eax
  9115                                                  push    0               ; dwNumberOfBytesToMap
  9116                                                  push    0               ; dwFileOffsetLow
  9117                                                  push    0               ; dwFileOffsetHigh
  9118                                                  push    4               ; dwDesiredAccess
  9119                                                  push    [hMap]       ; hFileMappingObject
  9120                                                  call    [MapViewOfFile]
  9121                                                  mov     [stream_start], eax
  9122                                                  mov     [stream_pos], eax
  9123                                                  mov     esi, [stream_start]
  9124                                                  mov     ecx, [bytes_left]
  9125                                  
  9126                                  .lll:
  9127                                                  lodsb
  9128                                                  loop    .lll
  9129                                                  clc
  9130                                                  retn
  9131                                  
  9132                                  .not_found:
  9133                                                  mov     edx, txt_not_found ; "cannot open source file\r\n"
  9134                                                  call    wrstr_edx
  9135                                                  stc
  9136                                                  retn
  9137                                  
  9138                                  %endif
  9139                                  
  9140                                  
  9141                                  ; =============== S U B R O U T I N E =======================================
  9142                                  
  9143                                  
  9144                                  mp3_plain_test_without_output:
  9145 00006662 60                                      pusha
  9146 00006663 8B35[DC250500]                          mov     esi, [stream_pos]
  9147 00006669 8B0D[E0250500]                          mov     ecx, [bytes_left]
  9148 0000666F BF[00300500]                            mov     edi, sample_buffer
  9149 00006674 31ED                                    xor     ebp, ebp
  9150 00006676 E89DFBFFFF                              call    mp3_decode_frame
  9151 0000667B 61                                      popa
  9152 0000667C 7218                                    jc      short .exit
  9153 0000667E A1[82960000]                            mov     eax, [mp3_src_frame_size]
  9154 00006683 83F800                                  cmp     eax, 0
  9155 00006686 740E                                    jz      short .exit
  9156 00006688 0105[DC250500]                          add     [stream_pos], eax
  9157 0000668E 2905[E0250500]                          sub     [bytes_left], eax
  9158 00006694 EBCC                                    jmp     short mp3_plain_test_without_output
  9159                                  
  9160                                  .exit:
  9161 00006696 C3                                      retn
  9162                                  
  9163                                  
  9164                                  ; =============== S U B R O U T I N E =======================================
  9165                                  
  9166                                  		; 20/10/2024
  9167                                  mp3_cast_to_wav_file:
  9168 00006697 E86F000000                              call	mp3_create_wav_file
  9169                                  		; 20/10/2024
  9170 0000669C 730A                    		jnc	short .lop
  9171 0000669E BBFFFFFFFF              		mov	ebx, -1
  9172 000066A3 E91B050000              		jmp	ExitProcess
  9173                                  .lop:
  9174 000066A8 60                                      pusha
  9175 000066A9 8B35[DC250500]                          mov	esi, [stream_pos]
  9176 000066AF 8B0D[E0250500]                          mov	ecx, [bytes_left]
  9177 000066B5 BF[00300500]                            mov	edi, sample_buffer
  9178 000066BA 31ED                                    xor	ebp, ebp
  9179 000066BC E857FBFFFF                              call	mp3_decode_frame
  9180 000066C1 61                                      popa
  9181 000066C2 7241                                    jc	short .exit
  9182 000066C4 A1[82960000]                            mov	eax, [mp3_src_frame_size]
  9183 000066C9 83F800                                  cmp	eax, 0
  9184 000066CC 7437                                    jz	short .exit
  9185 000066CE 0105[DC250500]                          add	[stream_pos], eax
  9186 000066D4 2905[E0250500]                          sub	[bytes_left], eax
  9187                                                  ;push	0          ; lpOverlapped
  9188                                                  ;push	diskresult ; lpNumberOfBytesWritten
  9189 000066DA FF35[70ED0000]                          push	dword [mp3_samples_output_size] ; nNumberOfBytesToWrite
  9190 000066E0 68[00300500]                            push	sample_buffer ; lpBuffer
  9191 000066E5 FF35[64260500]                          push	dword [mp3_wav_handle] ; hFile
  9192                                                  ;call	[WriteFile]
  9193                                  		;;;
  9194                                  		; 20/10/2024
  9195 000066EB E8DC040000              		call	WriteFile
  9196 000066F0 7213                    		jc	short .exit
  9197                                  		;;;
  9198 000066F2 A1[70ED0000]                            mov	eax, [mp3_samples_output_size]
  9199 000066F7 0105[007E0000]                          add	dword [mp3_wav_header+4], eax
  9200 000066FD 0105[247E0000]                          add	dword [mp3_wav_header+28h], eax
  9201 00006703 EBA3                                    jmp	short .lop
  9202                                  
  9203                                  .exit:
  9204 00006705 E860000000                              call	mp3_close_wav_file
  9205 0000670A C3                                      retn
  9206                                  
  9207                                  
  9208                                  ; =============== S U B R O U T I N E =======================================
  9209                                  
  9210                                  		; 20/10/2024
  9211                                  
  9212                                  mp3_create_wav_file:
  9213 0000670B A1[AE960000]                            mov     eax, [mp3_output_sample_rate]
  9214 00006710 8B0D[AA960000]                          mov     ecx, [mp3_output_num_channels]
  9215 00006716 8B15[B2960000]                          mov     edx, [mp3_bytes_per_sample]
  9216 0000671C 66890D[127E0000]                        mov     word [mp3_wav_header+16h], cx
  9217 00006723 A3[147E0000]                            mov     dword [mp3_wav_header+18h], eax
  9218 00006728 0FAFCA                                  imul    ecx, edx
  9219 0000672B 0FAFC1                                  imul    eax, ecx
  9220 0000672E C1E203                                  shl     edx, 3
  9221 00006731 A3[187E0000]                            mov     dword [mp3_wav_header+1Ch], eax
  9222 00006736 66890D[1C7E0000]                        mov     word [mp3_wav_header+20h], cx
  9223 0000673D 668915[1E7E0000]                        mov     word [mp3_wav_header+22h], dx
  9224                                                  ;push   0               ; hTemplateFile
  9225                                                  ;push   80h             ; dwFlagsAndAttributes
  9226                                                  ;push   2               ; dwCreationDisposition
  9227                                                  ;push   0               ; lpSecurityAttributes
  9228                                                  ;push   0               ; dwShareMode
  9229                                                  ;push   0C0000000h      ; dwDesiredAccess
  9230 00006744 FF35[F47D0000]                          push    dword [mp3_dst_fname] ; lpFileName
  9231                                                  ;call   [CreateFileA]
  9232                                  		;;;
  9233                                  		; 20/10/2024
  9234 0000674A E8AF040000              		call	CreateFile
  9235 0000674F 7301                    		jnc	short .ok
  9236 00006751 C3                      		retn
  9237                                  .ok:
  9238                                  		;;;
  9239 00006752 A3[64260500]                            mov     [mp3_wav_handle], eax
  9240                                                  ; 20/10/2024
  9241                                  		;call   mp3_write_wav_header
  9242                                                  ;retn
  9243                                  
  9244                                  
  9245                                  ; =============== S U B R O U T I N E =======================================
  9246                                  
  9247                                  		; 20/10/2024
  9248                                  mp3_write_wav_header:
  9249                                                  ;push	0               ; lpOverlapped
  9250                                                  ;push	diskresult      ; lpNumberOfBytesWritten
  9251 00006757 6A2C                                    push	44 ; 2Ch        ; nNumberOfBytesToWrite
  9252 00006759 68[FC7D0000]                            push	mp3_wav_header  ; lpBuffer
  9253 0000675E FF35[64260500]                          push	dword [mp3_wav_handle] ; hFile
  9254                                                  ;call	[WriteFile]
  9255                                                  ;;;
  9256                                  		; 20/10/2024
  9257 00006764 E863040000                              call	WriteFile
  9258                                                  ;;;
  9259 00006769 C3                      		retn
  9260                                  
  9261                                  
  9262                                  ; =============== S U B R O U T I N E =======================================
  9263                                  
  9264                                  		; 20/10/2024
  9265                                  mp3_close_wav_file:
  9266 0000676A 6A00                                    push	0               ; dwMoveMethod
  9267                                                  ;push	0               ; lpDistanceToMoveHigh
  9268 0000676C 6A00                                    push	0               ; lDistanceToMove
  9269 0000676E FF35[64260500]                          push	dword [mp3_wav_handle] ; hFile
  9270                                                  ;call	[SetFilePointer]
  9271                                  		;;;
  9272                                  		; 20/10/2024
  9273 00006774 E8C1040000              		call	SetFilePointer
  9274                                  		;;;
  9275 00006779 E8D9FFFFFF                              call	mp3_write_wav_header
  9276 0000677E FF35[64260500]                          push	dword [mp3_wav_handle] ; hObject
  9277                                                  ;call	[CloseHandle]
  9278                                  		;;;
  9279                                  		; 20/10/2024
  9280 00006784 E8EF040000              		call	CloseFile
  9281                                  		;;;
  9282 00006789 C3                                      retn
  9283                                  
  9284                                  
  9285                                  ; =============== S U B R O U T I N E =======================================
  9286                                  
  9287                                  		; 20/10/2024
  9288                                  mp3_verify_pcm_file:
  9289 0000678A E804020000                              call    mp3_open_pcm_file
  9290                                  		;;;
  9291                                  		; 20/10/2024
  9292 0000678F 7301                    		jnc	short .verify
  9293 00006791 C3                      		retn	; nothing to do (return without error msg)
  9294                                  .verify:
  9295                                  		;;;
  9296 00006792 C705[6C260500]0000-                     mov	dword [_@@max_diff], 0
  9296 0000679A 0000               
  9297 0000679C C705[70260500]0000-                     mov	dword [_@@avg_diff], 0
  9297 000067A4 0000               
  9298 000067A6 C705[74260500]0000-                     mov	dword [_@@avg_diff+4], 0
  9298 000067AE 0000               
  9299 000067B0 C705[78260500]0000-                     mov	dword [pcm_filepos], 0
  9299 000067B8 0000               
  9300                                  
  9301                                  .lop:
  9302 000067BA 60                                      pusha
  9303 000067BB 8B35[DC250500]                          mov     esi, [stream_pos]
  9304 000067C1 8B0D[E0250500]                          mov     ecx, [bytes_left]
  9305 000067C7 BF[00300500]                            mov     edi, sample_buffer
  9306 000067CC 31ED                                    xor     ebp, ebp
  9307 000067CE E845FAFFFF                              call    mp3_decode_frame
  9308 000067D3 61                                      popa
  9309 000067D4 0F824D010000                            jb      .exit
  9310 000067DA A1[82960000]                            mov     eax, [mp3_src_frame_size]
  9311 000067DF 83F800                                  cmp     eax, 0
  9312 000067E2 0F843F010000                            jz      .exit
  9313 000067E8 31C0                                    xor     eax, eax
  9314 000067EA 833D[AA960000]02                        cmp     dword [mp3_output_num_channels], 2
  9315 000067F1 7207                                    jb      short .this_mono_convert
  9316 000067F3 0FB605[466F0000]                        movzx   eax, byte [option_mono]
  9317                                  
  9318                                  .this_mono_convert:
  9319 000067FA A3[7C260500]                            mov	[_@@mono_convert], eax
  9320 000067FF 8A0D[486F0000]                          mov	cl, [option_rate_shift]
  9321 00006805 B802000000                              mov	eax, 2
  9322 0000680A D3E0                                    shl	eax, cl
  9323 0000680C 66A3[80260500]                          mov	[_@@pcm_steps], ax
  9324 00006812 66A3[82260500]                          mov	[_@@pcm_steps+2], ax
  9325 00006818 833D[AA960000]02                        cmp	dword [mp3_output_num_channels], 2
  9326 0000681F 7213                                    jb	short .these_steps
  9327 00006821 66C705[80260500]02-                     mov	word [_@@pcm_steps], 2
  9327 00006829 00                 
  9328 0000682A 8D4400FE                                lea     eax, [eax*2-2] ; [0FFFFFFFEh+eax*2]
  9329 0000682E 66A3[82260500]                          mov     [_@@pcm_steps+2], ax
  9330                                  
  9331                                  .these_steps:
  9332 00006834 A1[70ED0000]                            mov     eax, [mp3_samples_output_size]
  9333 00006839 8A0D[486F0000]                          mov     cl, [option_rate_shift]
  9334 0000683F 020D[476F0000]                          add     cl, [option_8bit]
  9335 00006845 020D[7C260500]                          add     cl, byte [_@@mono_convert]
  9336 0000684B D3E0                                    shl     eax, cl
  9337                                                  ;push   0               ; lpOverlapped
  9338                                                  ;push   diskresult      ; lpNumberOfBytesRead
  9339 0000684D 50                                      push    eax             ; nNumberOfBytesToRead
  9340 0000684E 68[00420500]                            push    (sample_buffer+1200h) ; sample_buffer+MP3_MAX_OUTPUT_SIZE
  9341 00006853 FF35[68260500]                          push    dword [mp3_pcm_handle] ; hFile
  9342                                                  ;call   [ReadFile]
  9343                                                  ;;;
  9344                                  		; 20/10/2024
  9345 00006859 E8E9030000              		call	ReadFile
  9346 0000685E 7306                    		jnc	short .pcm_read_ok
  9347                                  		; Note: File read error msg has been displayed
  9348 00006860 E83F010000              		call	mp3_close_pcm_file
  9349 00006865 C3                      		retn
  9350                                  .pcm_read_ok:
  9351                                  		;;;
  9352 00006866 8B0D[70ED0000]          		mov     ecx, [mp3_samples_output_size]
  9353 0000686C D1E9                                    shr     ecx, 1
  9354 0000686E 0F849D000000                            jz      .compare_done
  9355 00006874 BE[00300500]                            mov     esi, sample_buffer ; decoded .mp3
  9356 00006879 BF[00420500]                            mov     edi, (sample_buffer+1200h) ; loaded .pcm
  9357                                  
  9358                                  .compare_lop:
  9359 0000687E 0FBF17                                  movsx   edx, word [edi]
  9360 00006881 833D[7C260500]00                        cmp     dword [_@@mono_convert], 0
  9361 00006888 7408                                    jz      short .no_mono_convert
  9362 0000688A 0FBF4702                                movsx   eax, word [edi+2]
  9363 0000688E 01C2                                    add     edx, eax
  9364 00006890 D1FA                                    sar     edx, 1
  9365                                  
  9366                                  .no_mono_convert:
  9367 00006892 803D[476F0000]00                        cmp	byte [option_8bit], 0
  9368 00006899 7508                                    jnz	short .compare_8bit
  9369 0000689B 0FBF06                                  movsx	eax, word [esi] ; get 16bit from decoded .mp3
  9370 0000689E 83C602                                  add	esi, 2
  9371 000068A1 EB13                                    jmp	short .compare_this
  9372                                  
  9373                                  .compare_8bit:
  9374 000068A3 0FB606                                  movzx   eax, byte [esi]
  9375 000068A6 46                                      inc     esi             ; convert .pcm
  9376 000068A7 81C200800000                            add     edx, 8000h      ; make unsigned
  9377 000068AD C1FA08                                  sar     edx, 8          ; div 100h
  9378 000068B0 80D200                                  adc     dl, 0           ; round up
  9379 000068B3 80DA00                                  sbb     dl, 0           ; undo on unsigned overflow
  9380                                  
  9381                                  .compare_this:
  9382 000068B6 29D0                                    sub     eax, edx
  9383 000068B8 7902                                    jns     short .compare_abs ; calc difference
  9384 000068BA F7D8                                    neg     eax
  9385                                  
  9386                                  .compare_abs:
  9387 000068BC 0105[70260500]                          add     [_@@avg_diff], eax
  9388 000068C2 8315[74260500]00                        adc     dword [_@@avg_diff+4], 0
  9389 000068C9 3B05[6C260500]                          cmp     eax, [_@@max_diff]
  9390 000068CF 7223                                    jb      short .not_max
  9391 000068D1 A3[6C260500]                            mov     [_@@max_diff], eax
  9392 000068D6 8B15[78260500]                          mov     edx, [pcm_filepos]
  9393 000068DC 8915[84260500]                          mov     [_@@worst_pcm_filepos], edx
  9394 000068E2 8B15[DC250500]                          mov     edx, [stream_pos]
  9395 000068E8 2B15[D8250500]                          sub     edx, [stream_start]
  9396 000068EE 8915[88260500]                          mov     [_@@worst_mp3_filepos], edx
  9397                                  
  9398                                  .not_max:
  9399 000068F4 0FB705[80260500]                        movzx   eax, word [_@@pcm_steps]
  9400 000068FB C10D[80260500]10                        ror     dword [_@@pcm_steps], 16 ; next .pcm addr
  9401 00006902 01C7                                    add     edi, eax
  9402 00006904 0105[78260500]                          add     [pcm_filepos], eax
  9403 0000690A 49                                      dec     ecx
  9404 0000690B 0F856DFFFFFF                            jnz    .compare_lop
  9405                                  
  9406                                  .compare_done:
  9407 00006911 A1[82960000]                            mov     eax, [mp3_src_frame_size]
  9408 00006916 0105[DC250500]                          add     [stream_pos], eax
  9409 0000691C 2905[E0250500]                          sub     [bytes_left], eax
  9410 00006922 E993FEFFFF                              jmp     .lop
  9411                                  
  9412                                  .exit:
  9413 00006927 E878000000                              call    mp3_close_pcm_file
  9414 0000692C BA[58850000]                            mov     edx, _@@txt_verify1 ; "verify max difference = "
  9415 00006931 E86CFCFFFF                              call    wrstr_edx
  9416 00006936 A1[6C260500]                            mov     eax, [_@@max_diff]
  9417 0000693B E89FFCFFFF                              call    wr_decimal_eax
  9418 00006940 BA[71850000]                            mov     edx, _@@txt_verify1_at_mp3 ; " at mp3:"
  9419 00006945 E858FCFFFF                              call    wrstr_edx
  9420 0000694A A1[88260500]                            mov     eax, [_@@worst_mp3_filepos]
  9421 0000694F E801FDFFFF                              call    wrhexeax
  9422 00006954 BA[7A850000]                            mov     edx, _@@txt_verify2 ; ", average difference = "
  9423 00006959 E844FCFFFF                              call    wrstr_edx
  9424 0000695E A1[70260500]                            mov     eax, [_@@avg_diff]
  9425 00006963 8B15[74260500]                          mov     edx, [_@@avg_diff+4]
  9426 00006969 8B0D[68ED0000]                          mov     ecx, [mp3_total_output_size]
  9427 0000696F D1E9                                    shr     ecx, 1
  9428 00006971 F7F1                                    div     ecx
  9429 00006973 E867FCFFFF                              call    wr_decimal_eax
  9430 00006978 B02E                                    mov     al, '.'
  9431 0000697A E831000000                              call    wrchr
  9432 0000697F B80A000000                              mov     eax, 10
  9433 00006984 F7E2                                    mul     edx             ; fraction*10
  9434 00006986 F7F1                                    div     ecx
  9435 00006988 E89AFCFFFF                              call    wrdigital       ; show fraction of average difference
  9436 0000698D E821FCFFFF                              call    wrcrlf
  9437 00006992 C3                                      retn
  9438                                  
  9439                                  
  9440                                  ; =============== S U B R O U T I N E =======================================
  9441                                  
  9442                                  		; 20/10/2024
  9443                                  mp3_open_pcm_file:
  9444                                                  ;push	0               ; hTemplateFile
  9445                                                  ;push	80h             ; dwFlagsAndAttributes
  9446                                                  ;push	3               ; dwCreationDisposition
  9447                                                  ;push	0               ; lpSecurityAttributes
  9448                                                  ;push	0               ; dwShareMode
  9449                                                  ;push	80000000h       ; dwDesiredAccess
  9450 00006993 FF35[F87D0000]                          push	dword [mp3_pcm_fname] ; lpFileName
  9451                                                  ;call	[CreateFileA]
  9452                                  		;;;
  9453                                  		; 20/10/2024
  9454 00006999 E88F020000              		call	OpenFile
  9455                                  		;jc	short .return
  9456                                  		;;;
  9457 0000699E A3[68260500]                            mov	[mp3_pcm_handle], eax
  9458                                  ;.return:
  9459 000069A3 C3                                      retn
  9460                                  
  9461                                  
  9462                                  ; =============== S U B R O U T I N E =======================================
  9463                                  
  9464                                  		; 20/10/2024
  9465                                  mp3_close_pcm_file:
  9466 000069A4 FF35[68260500]                          push	dword [mp3_pcm_handle] ; hObject
  9467                                                  ;call	[CloseHandle]
  9468                                                  ;retn
  9469                                  		;;;
  9470                                  		; 20/10/2024
  9471 000069AA E8C9020000              		call	CloseFile
  9472                                  		;;;
  9473 000069AF C3                      		retn
  9474                                  
  9475                                  
  9476                                  ; ===========================================================================
  9477                                  ;  TRDOS 386 Operating System Specific Procedures - Erdogan Tan - 20/10/2024
  9478                                  ; ===========================================================================
  9479                                  
  9480                                  ; 20/10/2024
  9481                                  ; 20/08/2024 ; TRDOS 386 v2.0.9
  9482                                  ; TRDOS 386 system calls
  9483                                  _ver 	equ 0
  9484                                  _exit 	equ 1
  9485                                  _fork 	equ 2
  9486                                  _read 	equ 3
  9487                                  _write	equ 4
  9488                                  _open	equ 5
  9489                                  _close 	equ 6
  9490                                  _wait 	equ 7
  9491                                  _creat 	equ 8
  9492                                  _rename equ 9
  9493                                  _delete equ 10
  9494                                  _exec	equ 11
  9495                                  _chdir	equ 12
  9496                                  _time 	equ 13
  9497                                  _mkdir 	equ 14
  9498                                  _chmod	equ 15
  9499                                  _rmdir	equ 16
  9500                                  _break	equ 17
  9501                                  _drive	equ 18
  9502                                  _seek	equ 19
  9503                                  _tell 	equ 20
  9504                                  _mem	equ 21
  9505                                  _prompt	equ 22
  9506                                  _path	equ 23
  9507                                  _env	equ 24
  9508                                  _stime	equ 25
  9509                                  _quit	equ 26
  9510                                  _intr	equ 27
  9511                                  _dir	equ 28
  9512                                  _emt 	equ 29
  9513                                  _ldvrt 	equ 30
  9514                                  _video 	equ 31
  9515                                  _audio	equ 32
  9516                                  _timer	equ 33
  9517                                  _sleep	equ 34
  9518                                  _msg    equ 35
  9519                                  _geterr	equ 36
  9520                                  _fpsave	equ 37
  9521                                  _pri	equ 38
  9522                                  _rele	equ 39
  9523                                  _fff	equ 40
  9524                                  _fnf	equ 41
  9525                                  _alloc	equ 42
  9526                                  _dalloc equ 43
  9527                                  _calbac equ 44
  9528                                  _dma	equ 45
  9529                                  _stdio  equ 46	;  TRDOS 386 v2.0.9
  9530                                  
  9531                                  ; ---------------------------------------------------------------------------
  9532                                  ; 'sys' macro in FASM format
  9533                                  ; ---------------------------------------------------------------------------
  9534                                  
  9535                                  %if 0
  9536                                  macro sys op1,op2,op3,op4
  9537                                  {
  9538                                      if op4 eq 
  9539                                      else
  9540                                          mov edx, op4
  9541                                      end if
  9542                                      if op3 eq
  9543                                      else
  9544                                          mov ecx, op3
  9545                                      end if
  9546                                      if op2 eq
  9547                                      else
  9548                                          mov ebx, op2
  9549                                      end if
  9550                                      mov eax, op1
  9551                                      int 40h
  9552                                  }
  9553                                  %endif
  9554                                  
  9555                                  ; ---------------------------------------------------------------------------
  9556                                  ; 'sys' macro in NASM format
  9557                                  ; ---------------------------------------------------------------------------
  9558                                  ; 09/01/2025
  9559                                  
  9560                                  %macro sys 1-4
  9561                                      ; 29/04/2016 - TRDOS 386 (TRDOS v2.0)
  9562                                      ; 03/09/2015
  9563                                      ; 13/04/2015
  9564                                      ; Retro UNIX 386 v1 system call.
  9565                                      %if %0 >= 2
  9566                                          mov ebx, %2
  9567                                          %if %0 >= 3
  9568                                              mov ecx, %3
  9569                                              %if %0 = 4
  9570                                                 mov edx, %4
  9571                                              %endif
  9572                                          %endif
  9573                                      %endif
  9574                                      mov eax, %1
  9575                                      ;int 30h
  9576                                      int 40h ; TRDOS 386 (TRDOS v2.0)
  9577                                  %endmacro
  9578                                  
  9579                                  ; ---------------------------------------------------------------------------
  9580                                  
  9581                                  ; =============== S U B R O U T I N E =======================================
  9582                                  
  9583                                  		; 20/10/2024
  9584                                  wrchr:
  9585                                  		; TRDOS 386 System Call
  9586                                  		; ebx = 2 -> write character onto STDOUT
  9587                                  		;push	ebx
  9588                                  		;push	ecx
  9589                                  		;push	eax
  9590 000069B0 60                      		pusha
  9591                                  		;;mov	dword [diskresult], 0
  9592                                  		sys	_stdio, 2, eax
  9561                              <1> 
  9562                              <1> 
  9563                              <1> 
  9564                              <1> 
  9565                              <1>  %if %0 >= 2
  9566 000069B1 BB02000000          <1>  mov ebx, %2
  9567                              <1>  %if %0 >= 3
  9568 000069B6 89C1                <1>  mov ecx, %3
  9569                              <1>  %if %0 = 4
  9570                              <1>  mov edx, %4
  9571                              <1>  %endif
  9572                              <1>  %endif
  9573                              <1>  %endif
  9574 000069B8 B82E000000          <1>  mov eax, %1
  9575                              <1> 
  9576 000069BD CD40                <1>  int 40h
  9593                                  		;jnc	short .ok ; if EOF, eax = 0
  9594                                  		;xor	eax, eax ; 0
  9595                                  ;.ok:
  9596                                  		;mov	[diskresult], eax ; written byte count
  9597 000069BF 61                      		popa
  9598                                  		;pop	eax
  9599                                  		;pop	ecx
  9600                                  		;pop	ebx
  9601 000069C0 C3                      		retn
  9602                                  
  9603                                  
  9604                                  ; =============== S U B R O U T I N E =======================================
  9605                                  
  9606                                  		; 20/10/2024
  9607                                  get_commandline:
  9608                                  		; 21/10/2024
  9609 000069C1 5D                      		pop	ebp ; near call return address
  9610                                                 	; esp = command line start address
  9611                                  		;mov	[command_line],esp
  9612 000069C2 59                      		pop	ecx	; argc  ; number of arguments
  9613                                  		; esp = pointer to argument 1 ; argv[0]
  9614 000069C3 49                      		dec	ecx
  9615 000069C4 0F8405010000            		jz	.help
  9616 000069CA 58                      		pop	eax ; argument 1 (PRG file name)
  9617 000069CB 5E                      		pop	esi ; argument 2 (must be input file name)
  9618 000069CC BF[E4250500]            		mov     edi, cmdline_buf
  9619                                  .get_item:
  9620 000069D1 89FB                    		mov	ebx, edi
  9621                                  .char_lop:
  9622 000069D3 AC                                      lodsb
  9623 000069D4 AA                      		stosb
  9624 000069D5 3C00                                    cmp     al, 0
  9625 000069D7 75FA                                    jnz 	short .char_lop
  9626                                  		
  9627 000069D9 8A03                                    mov     al, [ebx]
  9628 000069DB 3C2F                                    cmp     al, '/'
  9629 000069DD 7442                                    jz      short .switch
  9630 000069DF 3C2D                                    cmp     al, '-'
  9631 000069E1 743E                                    jz      short .switch
  9632 000069E3 8B47FB                                  mov     eax, [edi-5]
  9633 000069E6 0D00202020                              or      eax, 20202000h
  9634 000069EB 3D2E776176                              cmp     eax, '.wav'     ; FASM & NASM syntax
  9635 000069F0 7510                                    jnz     short .not_wav_name
  9636 000069F2 891D[F47D0000]                          mov     [mp3_dst_fname], ebx
  9637                                  .get_items_lop:
  9638 000069F8 49                      		dec	ecx
  9639 000069F9 0F8494000000            		jz	.done
  9640 000069FF 5E                      		pop	esi   ; next argument
  9641 00006A00 EBCF                    		jmp     short .get_item
  9642                                  
  9643                                  .not_wav_name:
  9644 00006A02 8B47FB                                  mov     eax, [edi-5]
  9645 00006A05 0D00202020                              or      eax, 20202000h
  9646 00006A0A 3D2E70636D                              cmp     eax, '.pcm'     ; FASM & NASM syntax
  9647 00006A0F 7508                                    jnz     short .not_pcm_name
  9648 00006A11 891D[F87D0000]                          mov     [mp3_pcm_fname], ebx
  9649 00006A17 EBDF                                    jmp     short .get_items_lop
  9650                                  
  9651                                  .not_pcm_name:
  9652 00006A19 891D[F07D0000]                          mov     [mp3_src_fname], ebx
  9653 00006A1F EBD7                                    jmp     short .get_items_lop
  9654                                  
  9655                                  .switch:
  9656 00006A21 817B016D6F6E6F                          cmp	dword [ebx+1], 'mono'
  9657 00006A28 7509                                    jnz	short .not_switch_mono
  9658 00006A2A C605[466F0000]01                        mov	byte [option_mono], 1
  9659 00006A31 EBC5                                    jmp	short .get_items_lop
  9660                                  
  9661                                  .not_switch_mono:
  9662 00006A33 817B0166617374                          cmp	dword [ebx+1], 'fast' ; FASM & NASM syntax
  9663 00006A3A 7509                                    jnz	short .not_fast_option
  9664 00006A3C C605[496F0000]01                        mov	byte [option_fast], 1
  9665 00006A43 EBB3                                    jmp	short .get_items_lop
  9666                                  
  9667                                  .not_fast_option:
  9668 00006A45 817B0138626974                          cmp	dword [ebx+1], '8bit'
  9669 00006A4C 7509                                    jnz	short .not_switch_8bit
  9670 00006A4E C605[476F0000]01                        mov	byte [option_8bit], 1
  9671 00006A55 EBA1                                    jmp	short .get_items_lop
  9672                                  
  9673                                  .not_switch_8bit:
  9674 00006A57 817B0168616C66                          cmp	dword [ebx+1], 'half'
  9675 00006A5E 7509                                    jnz	short .not_switch_half
  9676 00006A60 C605[486F0000]01                        mov	byte [option_rate_shift], 1
  9677 00006A67 EB8F                                    jmp	short .get_items_lop
  9678                                  
  9679                                  .not_switch_half:
  9680 00006A69 817B0171756172                          cmp	dword [ebx+1], 'quar'
  9681 00006A70 750C                                    jnz	short .not_switch_quarter
  9682 00006A72 C605[486F0000]02                        mov	byte [option_rate_shift], 2
  9683 00006A79 E97AFFFFFF                              jmp	.get_items_lop
  9684                                  
  9685                                  .not_switch_quarter:
  9686 00006A7E 817B0174657374                          cmp	dword [ebx+1], 'test'
  9687 00006A85 7548                                    jnz	short .not_switch_test
  9688 00006A87 C605[456F0000]01                        mov	byte [option_test], 1
  9689 00006A8E E965FFFFFF                              jmp	.get_items_lop
  9690                                  
  9691                                  .done:
  9692 00006A93 833D[F07D0000]00                        cmp	dword [mp3_src_fname], 0
  9693 00006A9A 7433                                    jz	short .help
  9694                                                  ;;; Erdogan Tan - 17/10/2024
  9695                                                  ;mov	edx, txt_ctrlc
  9696                                                  ;call	wrstr_edx
  9697                                  		; 20/10/2024
  9698                                  		sys	_msg, txt_ctrlc, txt_ctrlc_size, 0Fh ; white
  9561                              <1> 
  9562                              <1> 
  9563                              <1> 
  9564                              <1> 
  9565                              <1>  %if %0 >= 2
  9566 00006A9C BB[92850000]        <1>  mov ebx, %2
  9567                              <1>  %if %0 >= 3
  9568 00006AA1 B919000000          <1>  mov ecx, %3
  9569                              <1>  %if %0 = 4
  9570 00006AA6 BA0F000000          <1>  mov edx, %4
  9571                              <1>  %endif
  9572                              <1>  %endif
  9573                              <1>  %endif
  9574 00006AAB B823000000          <1>  mov eax, %1
  9575                              <1> 
  9576 00006AB0 CD40                <1>  int 40h
  9699                                                  ;;;
  9700 00006AB2 BA[61840000]                            mov	edx, txt_file ; "file: "
  9701 00006AB7 E8E6FAFFFF                              call	wrstr_edx
  9702 00006ABC 8B15[F07D0000]                          mov	edx, [mp3_src_fname]
  9703 00006AC2 E8DBFAFFFF                              call	wrstr_edx
  9704 00006AC7 E8E7FAFFFF                              call	wrcrlf
  9705 00006ACC F8                                      clc
  9706 00006ACD 55                      		push	ebp	; return address
  9707 00006ACE C3                                      retn
  9708                                  
  9709                                  .not_switch_test:
  9710                                  .help:
  9711                                                  ;;; Erdogan Tan - 17/10/2024
  9712 00006ACF BA[AB850000]                            mov	edx, txt_about
  9713 00006AD4 E8C9FAFFFF                              call	wrstr_edx
  9714                                                  ;;;
  9715 00006AD9 BA[D8840000]                            mov	edx, txt_help ; "usage: mp3play input.mp3 [output.wav] ["...
  9716 00006ADE E8BFFAFFFF                              call	wrstr_edx
  9717 00006AE3 F9                                      stc
  9718 00006AE4 55                      		push	ebp	; return address
  9719 00006AE5 C3                                      retn
  9720                                  
  9721                                  ; =============== S U B R O U T I N E =======================================
  9722                                  
  9723                                  		; 21/10/2024
  9724                                  set_break:
  9725                                  		; set [u.break] -end of bss- address to
  9726                                  		; end_of_bss at first (mp3 file will be loaded
  9727                                  		; at the end of bss)
  9728                                  		; ([u.break] initially points to the end of PRG file
  9729                                  		; -code and data- except BSS section)
  9730                                  		;
  9731                                  		; TRDOS 386 system call
  9732                                  		; Set break address
  9733                                  		; ebx = new [u.break]
  9734                                  		sys	_break, end_of_bss
  9561                              <1> 
  9562                              <1> 
  9563                              <1> 
  9564                              <1> 
  9565                              <1>  %if %0 >= 2
  9566 00006AE6 BB[00300600]        <1>  mov ebx, %2
  9567                              <1>  %if %0 >= 3
  9568                              <1>  mov ecx, %3
  9569                              <1>  %if %0 = 4
  9570                              <1>  mov edx, %4
  9571                              <1>  %endif
  9572                              <1>  %endif
  9573                              <1>  %endif
  9574 00006AEB B811000000          <1>  mov eax, %1
  9575                              <1> 
  9576 00006AF0 CD40                <1>  int 40h
  9735                                  		; eax = new break address (dword aligned)
  9736                                  
  9737 00006AF2 A3[D8250500]                            mov	[stream_start], eax
  9738 00006AF7 A3[DC250500]                            mov	[stream_pos], eax
  9739                                  
  9740 00006AFC C3                      		retn
  9741                                  
  9742                                  
  9743                                  ; =============== S U B R O U T I N E =======================================
  9744                                  
  9745                                  		; 20/10/2024
  9746                                  
  9747                                  open_and_mmap_the_file:
  9748                                  		; 21/10/2024
  9749                                  		; TRDOS 386 system call
  9750                                  		; Open File
  9751                                  		; ebx = pointer to filename
  9752                                  		; ecx = open mode, 0 = read
  9753                                               	sys	_open, [mp3_src_fname], 0
  9561                              <1> 
  9562                              <1> 
  9563                              <1> 
  9564                              <1> 
  9565                              <1>  %if %0 >= 2
  9566 00006AFD 8B1D[F07D0000]      <1>  mov ebx, %2
  9567                              <1>  %if %0 >= 3
  9568 00006B03 B900000000          <1>  mov ecx, %3
  9569                              <1>  %if %0 = 4
  9570                              <1>  mov edx, %4
  9571                              <1>  %endif
  9572                              <1>  %endif
  9573                              <1>  %endif
  9574 00006B08 B805000000          <1>  mov eax, %1
  9575                              <1> 
  9576 00006B0D CD40                <1>  int 40h
  9754 00006B0F 7270                    		jc	short .not_found
  9755                                  
  9756 00006B11 A3[D4250500]                            mov     [hFile], eax
  9757                                  
  9758                                                 	; get file size by using systell system call
  9759                                   		; (not applicable for TRDOS 386 Kernel v2.0.9 and earlier)
  9760                                  		; TRDOS 386 system call
  9761                                  		; Get current file (offset) pointer
  9762                                  		; ebx = file handle (file descriptor)
  9763                                  		; ecx = 0, offset
  9764                                  		; edx = 2, from the end of file
  9765                                  		;sys	_tell, eax, 0, 2
  9766                                                  ;mov     [mp3_file_size], eax
  9767                                  
  9768                                  		; *** get file size ***
  9769                                  		; TRDOS 386 system call
  9770                                  		; Set file (offset) pointer to file size 
  9771                                  		; (needed for TRDOS kernel v2.0.9 and earlier)
  9772                                  		; ebx = file handle (file descriptor)
  9773                                  		; ecx = 0, offset
  9774                                  		; edx = 2, from the end of file
  9775                                  		sys	_seek, eax, 0, 2
  9561                              <1> 
  9562                              <1> 
  9563                              <1> 
  9564                              <1> 
  9565                              <1>  %if %0 >= 2
  9566 00006B16 89C3                <1>  mov ebx, %2
  9567                              <1>  %if %0 >= 3
  9568 00006B18 B900000000          <1>  mov ecx, %3
  9569                              <1>  %if %0 = 4
  9570 00006B1D BA02000000          <1>  mov edx, %4
  9571                              <1>  %endif
  9572                              <1>  %endif
  9573                              <1>  %endif
  9574 00006B22 B813000000          <1>  mov eax, %1
  9575                              <1> 
  9576 00006B27 CD40                <1>  int 40h
  9776                                  		; TRDOS 386 system call
  9777                                  		; Get current file (offset) pointer
  9778                                  		; (needed for TRDOS 386 kernel version 2.0.9 and earlier)
  9779 00006B29 31D2                    		xor	edx, edx ; 0
  9780                                  		; ecx = 0
  9781                                  		; ebx = file handle
  9782                                  		sys	_tell
  9561                              <1> 
  9562                              <1> 
  9563                              <1> 
  9564                              <1> 
  9565                              <1>  %if %0 >= 2
  9566                              <1>  mov ebx, %2
  9567                              <1>  %if %0 >= 3
  9568                              <1>  mov ecx, %3
  9569                              <1>  %if %0 = 4
  9570                              <1>  mov edx, %4
  9571                              <1>  %endif
  9572                              <1>  %endif
  9573                              <1>  %endif
  9574 00006B2B B814000000          <1>  mov eax, %1
  9575                              <1> 
  9576 00006B30 CD40                <1>  int 40h
  9783 00006B32 A3[58ED0000]            		mov     [mp3_file_size], eax
  9784                                  
  9785                                  		; *** set file offset pointer to 0 again ***
  9786                                  		; TRDOS 386 system call
  9787                                  		; Set file (offset) pointer
  9788                                  		; ebx = file handle (file descriptor)
  9789                                  		; ecx = 0, offset
  9790                                  		; edx = 0, from the beginning/start of file
  9791 00006B37 50                      		push	eax
  9792                                  		sys	_seek
  9561                              <1> 
  9562                              <1> 
  9563                              <1> 
  9564                              <1> 
  9565                              <1>  %if %0 >= 2
  9566                              <1>  mov ebx, %2
  9567                              <1>  %if %0 >= 3
  9568                              <1>  mov ecx, %3
  9569                              <1>  %if %0 = 4
  9570                              <1>  mov edx, %4
  9571                              <1>  %endif
  9572                              <1>  %endif
  9573                              <1>  %endif
  9574 00006B38 B813000000          <1>  mov eax, %1
  9575                              <1> 
  9576 00006B3D CD40                <1>  int 40h
  9793 00006B3F 58                      		pop	eax
  9794                                  
  9795                                  		; now, set [u.break] address to the end of mp3 file
  9796                                  		; at memory -in BSS section-
  9797                                  		; (not necessary for TRDOS 386 PRG files)
  9798                                  		; (this system call will allocate user memory pages
  9799                                  		;  before sysread system call.. early)
  9800 00006B40 05[00300600]            		add	eax, end_of_bss
  9801                                  		; TRDOS 386 system call
  9802                                  		; Set break address
  9803                                  		; ebx = new [u.break]
  9804                                  		sys	_break, eax
  9561                              <1> 
  9562                              <1> 
  9563                              <1> 
  9564                              <1> 
  9565                              <1>  %if %0 >= 2
  9566 00006B45 89C3                <1>  mov ebx, %2
  9567                              <1>  %if %0 >= 3
  9568                              <1>  mov ecx, %3
  9569                              <1>  %if %0 = 4
  9570                              <1>  mov edx, %4
  9571                              <1>  %endif
  9572                              <1>  %endif
  9573                              <1>  %endif
  9574 00006B47 B811000000          <1>  mov eax, %1
  9575                              <1> 
  9576 00006B4C CD40                <1>  int 40h
  9805                                  
  9806                                  		; TRDOS 386 system call
  9807                                  		; Read file
  9808                                  		; ebx = file handle (file descriptor)
  9809                                  		; ecx = buffer address
  9810                                  		; edx = byte count
  9811                                  		sys	_read, [hFile], [stream_start], [mp3_file_size]
  9561                              <1> 
  9562                              <1> 
  9563                              <1> 
  9564                              <1> 
  9565                              <1>  %if %0 >= 2
  9566 00006B4E 8B1D[D4250500]      <1>  mov ebx, %2
  9567                              <1>  %if %0 >= 3
  9568 00006B54 8B0D[D8250500]      <1>  mov ecx, %3
  9569                              <1>  %if %0 = 4
  9570 00006B5A 8B15[58ED0000]      <1>  mov edx, %4
  9571                              <1>  %endif
  9572                              <1>  %endif
  9573                              <1>  %endif
  9574 00006B60 B803000000          <1>  mov eax, %1
  9575                              <1> 
  9576 00006B65 CD40                <1>  int 40h
  9812 00006B67 7204                    		jc	short .read_error
  9813 00006B69 39D0                    		cmp	eax, edx
  9814 00006B6B 730E                    		jnb	short .ok
  9815                                  		;or	eax, eax
  9816                                  		;jnz	short .ok
  9817                                  .read_error:		
  9818                                  		; TRDOS 386 system call
  9819                                  		; Close file
  9820                                  		; ebx = file handle (file descriptor)
  9821                                  		;sys	_close, [hFile]
  9822                                   		sys	_close
  9561                              <1> 
  9562                              <1> 
  9563                              <1> 
  9564                              <1> 
  9565                              <1>  %if %0 >= 2
  9566                              <1>  mov ebx, %2
  9567                              <1>  %if %0 >= 3
  9568                              <1>  mov ecx, %3
  9569                              <1>  %if %0 = 4
  9570                              <1>  mov edx, %4
  9571                              <1>  %endif
  9572                              <1>  %endif
  9573                              <1>  %endif
  9574 00006B6D B806000000          <1>  mov eax, %1
  9575                              <1> 
  9576 00006B72 CD40                <1>  int 40h
  9823                                  
  9824 00006B74 BA[656C0000]            		mov	edx, txt_read_err
  9825 00006B79 EB0B                    		jmp	short .r_err_msg
  9826                                  .ok:
  9827 00006B7B A3[E0250500]                            mov     [bytes_left], eax ; read count
  9828 00006B80 C3                      		retn
  9829                                  .not_found:
  9830 00006B81 BA[BE840000]                            mov     edx, txt_not_found ; "cannot open source file\r\n"
  9831                                  .r_err_msg:
  9832 00006B86 E817FAFFFF                              call    wrstr_edx
  9833 00006B8B F9                                      stc
  9834 00006B8C C3                                      retn
  9835                                  
  9836                                  ;txt_read_err	db 'File read error!',0Dh,0Ah,0
  9837                                  
  9838                                  
  9839                                  ; =============== S U B R O U T I N E =======================================
  9840                                  
  9841                                  		; 20/10/2024
  9842                                  print_msg:
  9843                                  		; TRDOS 386 system call
  9844                                  		; write/display message on screen
  9845                                  		; ebx = ASCIIZ message (text) address
  9846                                  		; ecx = max. message length (stop count before char zero)
  9847                                  		; edx = character color (CGA)
  9848 00006B8D B9FF000000              		mov	ecx, 255
  9849 00006B92 BA0B000000              		mov	edx, 0Bh ; DL ; cyan
  9850                                  		sys	_msg
  9561                              <1> 
  9562                              <1> 
  9563                              <1> 
  9564                              <1> 
  9565                              <1>  %if %0 >= 2
  9566                              <1>  mov ebx, %2
  9567                              <1>  %if %0 >= 3
  9568                              <1>  mov ecx, %3
  9569                              <1>  %if %0 = 4
  9570                              <1>  mov edx, %4
  9571                              <1>  %endif
  9572                              <1>  %endif
  9573                              <1>  %endif
  9574 00006B97 B823000000          <1>  mov eax, %1
  9575                              <1> 
  9576 00006B9C CD40                <1>  int 40h
  9851 00006B9E C3                      		retn
  9852                                  
  9853                                  
  9854                                  ; =============== S U B R O U T I N E =======================================
  9855                                  
  9856                                  		; 20/10/2024
  9857                                  GetTickCount:
  9858                                  		; TRDOS 386 system call
  9859                                  		; get current time, get tick count
  9860                                  		; ebx = 4 -> get count of system timer ticks
  9861                                  		sys	_time, 4
  9561                              <1> 
  9562                              <1> 
  9563                              <1> 
  9564                              <1> 
  9565                              <1>  %if %0 >= 2
  9566 00006B9F BB04000000          <1>  mov ebx, %2
  9567                              <1>  %if %0 >= 3
  9568                              <1>  mov ecx, %3
  9569                              <1>  %if %0 = 4
  9570                              <1>  mov edx, %4
  9571                              <1>  %endif
  9572                              <1>  %endif
  9573                              <1>  %endif
  9574 00006BA4 B80D000000          <1>  mov eax, %1
  9575                              <1> 
  9576 00006BA9 CD40                <1>  int 40h
  9862                                  		; eax = system timer ticks (18.2 ticks per second)
  9863 00006BAB BA15F4BC20              		mov	edx, 549254165	; 10^10/18.2
  9864 00006BB0 F7E2                    		mul	edx
  9865                                  		; edx:eax = milliseconds * 10^7
  9866 00006BB2 BB80969800              		mov	ebx, 10000000
  9867 00006BB7 F7F3                    		div	ebx		; 10^7
  9868                                  		; eax = milliseconds
  9869 00006BB9 81FA404B4C00            		cmp	edx, 5000000	; 10^7/2
  9870 00006BBF 7201                    		jb	short .ok
  9871 00006BC1 40                      		inc	eax		; round up
  9872                                  .ok:
  9873 00006BC2 C3                      		retn
  9874                                  
  9875                                  
  9876                                  ; =============== E X I T ===================================================
  9877                                  
  9878                                  		; 20/10/2024
  9879                                  ExitProcess:
  9880 00006BC3 31DB                    		xor	ebx, ebx  ; mov ebx, 0  ; exit code
  9881                                  		sys	_exit
  9561                              <1> 
  9562                              <1> 
  9563                              <1> 
  9564                              <1> 
  9565                              <1>  %if %0 >= 2
  9566                              <1>  mov ebx, %2
  9567                              <1>  %if %0 >= 3
  9568                              <1>  mov ecx, %3
  9569                              <1>  %if %0 = 4
  9570                              <1>  mov edx, %4
  9571                              <1>  %endif
  9572                              <1>  %endif
  9573                              <1>  %endif
  9574 00006BC5 B801000000          <1>  mov eax, %1
  9575                              <1> 
  9576 00006BCA CD40                <1>  int 40h
  9882                                  ;hang:
  9883                                  		;jmp	short hang
  9884                                  
  9885                                  
  9886                                  ; =============== S U B R O U T I N E =======================================
  9887                                  
  9888                                  		; 20/10/2024
  9889                                  WriteFile:
  9890 00006BCC 58                      		pop	eax ; near call return address
  9891 00006BCD 5B                      		pop	ebx
  9892 00006BCE 59                      		pop	ecx
  9893 00006BCF 5A                      		pop	edx
  9894 00006BD0 50                      		push	eax
  9895                                  		; TRDOS 386 system call
  9896                                  		; Write file
  9897                                  		; ebx = file handle (file descriptor)
  9898                                  		; ecx = buffer address
  9899                                  		; edx = byte count
  9900                                  		sys	_write
  9561                              <1> 
  9562                              <1> 
  9563                              <1> 
  9564                              <1> 
  9565                              <1>  %if %0 >= 2
  9566                              <1>  mov ebx, %2
  9567                              <1>  %if %0 >= 3
  9568                              <1>  mov ecx, %3
  9569                              <1>  %if %0 = 4
  9570                              <1>  mov edx, %4
  9571                              <1>  %endif
  9572                              <1>  %endif
  9573                              <1>  %endif
  9574 00006BD1 B804000000          <1>  mov eax, %1
  9575                              <1> 
  9576 00006BD6 CD40                <1>  int 40h
  9901 00006BD8 730F                    		jnc	short .ok
  9902 00006BDA 39D0                    		cmp	eax, edx
  9903 00006BDC 730B                    		jnb	short .ok
  9904                                  		;or	eax, eax
  9905                                  		;jnz	short .ok
  9906                                  
  9907 00006BDE BA[EA6B0000]            		mov	edx, txt_write_err
  9908 00006BE3 E8BAF9FFFF                              call    wrstr_edx
  9909 00006BE8 F9                                      stc
  9910                                  .ok:
  9911 00006BE9 C3                                      retn
  9912                                  
  9913 00006BEA 46696C652077726974-     txt_write_err	db 'File write error!',0Dh,0Ah,0
  9913 00006BF3 65206572726F72210D-
  9913 00006BFC 0A00               
  9914                                  
  9915                                  
  9916                                  ; =============== S U B R O U T I N E =======================================
  9917                                  
  9918                                  		; 20/10/2024
  9919                                  CreateFile:
  9920 00006BFE 58                      		pop	eax ; near call return address
  9921 00006BFF 5B                      		pop	ebx
  9922 00006C00 50                      		push	eax
  9923                                  		; TRDOS 386 system call
  9924                                  		; Create file
  9925                                  		; ebx = (ASCIIZ) file name address
  9926                                  		; ecx = mode
  9927 00006C01 31C9                    		xor	ecx, ecx ; CL ; mov ecx, 0 ; ordinary file
  9928                                  		sys	_creat
  9561                              <1> 
  9562                              <1> 
  9563                              <1> 
  9564                              <1> 
  9565                              <1>  %if %0 >= 2
  9566                              <1>  mov ebx, %2
  9567                              <1>  %if %0 >= 3
  9568                              <1>  mov ecx, %3
  9569                              <1>  %if %0 = 4
  9570                              <1>  mov edx, %4
  9571                              <1>  %endif
  9572                              <1>  %endif
  9573                              <1>  %endif
  9574 00006C03 B808000000          <1>  mov eax, %1
  9575                              <1> 
  9576 00006C08 CD40                <1>  int 40h
  9929 00006C0A 730B                    		jnc	short .ok ; eax = file handle
  9930                                  
  9931 00006C0C BA[186C0000]            		mov	edx, txt_create_err
  9932 00006C11 E88CF9FFFF                              call    wrstr_edx
  9933 00006C16 F9                                      stc
  9934                                  .ok:
  9935 00006C17 C3                      		retn
  9936                                  
  9937 00006C18 46696C652063726561-     txt_create_err	db 'File create error!',0Dh,0Ah,0
  9937 00006C21 7465206572726F7221-
  9937 00006C2A 0D0A00             
  9938                                  
  9939                                  
  9940                                  ; =============== S U B R O U T I N E =======================================
  9941                                  
  9942                                  		; 20/10/2024
  9943                                  OpenFile:
  9944 00006C2D 58                      		pop	eax ; near call return address
  9945 00006C2E 5B                      		pop	ebx
  9946 00006C2F 50                      		push	eax
  9947                                  		; TRDOS 386 system call
  9948                                  		; Open file
  9949                                  		; ebx = (ASCIIZ) file name address
  9950                                  		; ecx = mode
  9951 00006C30 31C9                    		xor	ecx, ecx ; CL ; mov ecx, 0 ; ordinary file
  9952                                  		sys	_open
  9561                              <1> 
  9562                              <1> 
  9563                              <1> 
  9564                              <1> 
  9565                              <1>  %if %0 >= 2
  9566                              <1>  mov ebx, %2
  9567                              <1>  %if %0 >= 3
  9568                              <1>  mov ecx, %3
  9569                              <1>  %if %0 = 4
  9570                              <1>  mov edx, %4
  9571                              <1>  %endif
  9572                              <1>  %endif
  9573                              <1>  %endif
  9574 00006C32 B805000000          <1>  mov eax, %1
  9575                              <1> 
  9576 00006C37 CD40                <1>  int 40h
  9953                                  		;jnc	short .ok ; eax = file handle
  9954                                  		;
  9955                                  		;mov	edx, txt_open_err
  9956                                                  ;call   wrstr_edx
  9957                                                  ;stc
  9958                                  ;.ok:
  9959 00006C39 C3                      		retn
  9960                                  
  9961                                  ;txt_open_err	db 'File not found!',0Dh,0Ah,0
  9962                                  		;db 'File open error!',ODh,0Ah,0
  9963                                  	 
  9964                                  
  9965                                  ; =============== S U B R O U T I N E =======================================
  9966                                  
  9967                                  		; 20/10/2024
  9968                                  SetFilePointer:
  9969 00006C3A 58                      		pop	eax ; near call return address
  9970 00006C3B 5B                      		pop	ebx
  9971 00006C3C 59                      		pop	ecx
  9972 00006C3D 5A                      		pop	edx
  9973 00006C3E 50                      		push	eax
  9974                                  		; TRDOS 386 system call
  9975                                  		; Set file offset pointer  ; sysseek
  9976                                  		; ebx = file handle (file descriptor)
  9977                                  		; ecx = offset
  9978                                  		; edx = switch, DL = 0 = from the start of file
  9979                                  		;		     1 = from the current offset
  9980                                  		;		     2 = from the end of file
  9981                                  		sys	_seek
  9561                              <1> 
  9562                              <1> 
  9563                              <1> 
  9564                              <1> 
  9565                              <1>  %if %0 >= 2
  9566                              <1>  mov ebx, %2
  9567                              <1>  %if %0 >= 3
  9568                              <1>  mov ecx, %3
  9569                              <1>  %if %0 = 4
  9570                              <1>  mov edx, %4
  9571                              <1>  %endif
  9572                              <1>  %endif
  9573                              <1>  %endif
  9574 00006C3F B813000000          <1>  mov eax, %1
  9575                              <1> 
  9576 00006C44 CD40                <1>  int 40h
  9982                                  		; eax = (value of) new offset pointer
  9983                                  
  9984 00006C46 C3                      		retn
  9985                                  
  9986                                  
  9987                                  ; =============== S U B R O U T I N E =======================================
  9988                                  
  9989                                  		; 20/10/2024
  9990                                  ReadFile:
  9991 00006C47 58                      		pop	eax ; near call return address
  9992 00006C48 5B                      		pop	ebx
  9993 00006C49 59                      		pop	ecx
  9994 00006C4A 5A                      		pop	edx
  9995 00006C4B 50                      		push	eax
  9996                                  		; TRDOS 386 system call
  9997                                  		; Read file
  9998                                  		; ebx = file handle (file descriptor)
  9999                                  		; ecx = buffer address
 10000                                  		; edx = byte count
 10001                                  		sys	_read
  9561                              <1> 
  9562                              <1> 
  9563                              <1> 
  9564                              <1> 
  9565                              <1>  %if %0 >= 2
  9566                              <1>  mov ebx, %2
  9567                              <1>  %if %0 >= 3
  9568                              <1>  mov ecx, %3
  9569                              <1>  %if %0 = 4
  9570                              <1>  mov edx, %4
  9571                              <1>  %endif
  9572                              <1>  %endif
  9573                              <1>  %endif
  9574 00006C4C B803000000          <1>  mov eax, %1
  9575                              <1> 
  9576 00006C51 CD40                <1>  int 40h
 10002 00006C53 730F                    		jnc	short .ok
 10003 00006C55 39D0                    		cmp	eax, edx
 10004 00006C57 730B                    		jnb	short .ok
 10005                                  		;or	eax, eax
 10006                                  		;jnz	short .ok
 10007                                  
 10008 00006C59 BA[656C0000]            		mov	edx, txt_read_err
 10009 00006C5E E83FF9FFFF                              call    wrstr_edx
 10010 00006C63 F9                                      stc
 10011                                  .ok:
 10012 00006C64 C3                                      retn
 10013                                  
 10014 00006C65 46696C652072656164-     txt_read_err	db 'File read error!',0Dh,0Ah,0
 10014 00006C6E 206572726F72210D0A-
 10014 00006C77 00                 
 10015                                  
 10016                                  
 10017                                  ; =============== S U B R O U T I N E =======================================
 10018                                  
 10019                                  		; 20/10/2024
 10020                                  CloseFile:
 10021 00006C78 58                      		pop	eax ; near call return address
 10022 00006C79 5B                      		pop	ebx
 10023 00006C7A 50                      		push	eax
 10024                                  		; TRDOS 386 system call
 10025                                  		; Close file
 10026                                  		; ebx = file handle (file descriptor)
 10027                                  		sys	_close
  9561                              <1> 
  9562                              <1> 
  9563                              <1> 
  9564                              <1> 
  9565                              <1>  %if %0 >= 2
  9566                              <1>  mov ebx, %2
  9567                              <1>  %if %0 >= 3
  9568                              <1>  mov ecx, %3
  9569                              <1>  %if %0 = 4
  9570                              <1>  mov edx, %4
  9571                              <1>  %endif
  9572                              <1>  %endif
  9573                              <1>  %endif
  9574 00006C7B B806000000          <1>  mov eax, %1
  9575                              <1> 
  9576 00006C80 CD40                <1>  int 40h
 10028                                  
 10029 00006C82 C3                      		retn
 10030                                  
 10031                                  
 10032                                  ; ---------------------------------------------------------------------------
 10033                                  ; TRDOS 386 Audio System Functions
 10034                                  ; ---------------------------------------------------------------------------
 10035                                  
 10036                                  ; =============== S U B R O U T I N E =======================================
 10037                                  
 10038                                  		; 10/01/2025
 10039                                  		; 20/10/2024
 10040                                  detect_enable_audio_device:
 10041 00006C83 66C705[70860000]80-     		mov	word [max_frequency], 48000
 10041 00006C8B BB                 
 10042                                  		; 10/01/2025
 10043                                  		;mov	byte [blocks], 8
 10044                                  
 10045                                  		; check AC'97 hardware at first
 10046                                  		; (48kHz support)
 10047                                  		; TRDOS 386 system call
 10048                                  		; sysaudio
 10049                                  		; Detect (BH=1) AC'97 (BL=2) Audio Device
 10050                                  .ac97:
 10051                                          	sys	_audio, 0102h
  9561                              <1> 
  9562                              <1> 
  9563                              <1> 
  9564                              <1> 
  9565                              <1>  %if %0 >= 2
  9566 00006C8C BB02010000          <1>  mov ebx, %2
  9567                              <1>  %if %0 >= 3
  9568                              <1>  mov ecx, %3
  9569                              <1>  %if %0 = 4
  9570                              <1>  mov edx, %4
  9571                              <1>  %endif
  9572                              <1>  %endif
  9573                              <1>  %endif
  9574 00006C91 B820000000          <1>  mov eax, %1
  9575                              <1> 
  9576 00006C96 CD40                <1>  int 40h
 10052 00006C98 721B                    		jc	short .sb16
 10053 00006C9A C605[6E860000]02        		mov	byte [audio_hardware], 2 ; AC97
 10054                                  		; TRDOS 386 system call
 10055                                  		; sysaudio
 10056                                  		; Get AC'97 Codec info
 10057                                  		; (Function 14, sub function 1)
 10058                                  		sys	_audio, 0E01h
  9561                              <1> 
  9562                              <1> 
  9563                              <1> 
  9564                              <1> 
  9565                              <1>  %if %0 >= 2
  9566 00006CA1 BB010E0000          <1>  mov ebx, %2
  9567                              <1>  %if %0 >= 3
  9568                              <1>  mov ecx, %3
  9569                              <1>  %if %0 = 4
  9570                              <1>  mov edx, %4
  9571                              <1>  %endif
  9572                              <1>  %endif
  9573                              <1>  %endif
  9574 00006CA6 B820000000          <1>  mov eax, %1
  9575                              <1> 
  9576 00006CAB CD40                <1>  int 40h
 10059                                  		; Save Variable Rate Audio support bit
 10060 00006CAD 2401                    		and	al, 1
 10061 00006CAF A2[6F860000]            		mov	[vra], al
 10062 00006CB4 C3                      		retn
 10063                                  .sb16:
 10064                                  		; check Sound Blaster 16 card at second
 10065                                  		; (44100Hz support, but 24kHz will be used)
 10066                                  		; TRDOS 386 system call
 10067                                  		; sysaudio
 10068                                  		; Detect (BH=1) SB16 (BL=1) Audio Card
 10069                                          	sys	_audio, 0101h
  9561                              <1> 
  9562                              <1> 
  9563                              <1> 
  9564                              <1> 
  9565                              <1>  %if %0 >= 2
  9566 00006CB5 BB01010000          <1>  mov ebx, %2
  9567                              <1>  %if %0 >= 3
  9568                              <1>  mov ecx, %3
  9569                              <1>  %if %0 = 4
  9570                              <1>  mov edx, %4
  9571                              <1>  %endif
  9572                              <1>  %endif
  9573                              <1>  %endif
  9574 00006CBA B820000000          <1>  mov eax, %1
  9575                              <1> 
  9576 00006CBF CD40                <1>  int 40h
 10070 00006CC1 7211                    		jc	short .vt8233
 10071 00006CC3 C605[6E860000]01        		mov	byte [audio_hardware], 1 ; SB16
 10072 00006CCA 66C705[70860000]44-     		mov	word [max_frequency], 44100
 10072 00006CD2 AC                 
 10073                                  		; 10/01/2025
 10074                                  		;;mov	byte [blocks], 7
 10075                                  		;dec	byte [blocks]
 10076 00006CD3 C3                      		retn
 10077                                  .vt8233:
 10078                                  		; check VIA VT3237R (VT8233) hardware at third
 10079                                  		; (48kHz support)
 10080                                  		; TRDOS 386 system call
 10081                                  		; sysaudio
 10082                                  		; Detect (BH=1) VT8237R (BL=3) Audio Device
 10083                                  		sys	_audio, 0103h
  9561                              <1> 
  9562                              <1> 
  9563                              <1> 
  9564                              <1> 
  9565                              <1>  %if %0 >= 2
  9566 00006CD4 BB03010000          <1>  mov ebx, %2
  9567                              <1>  %if %0 >= 3
  9568                              <1>  mov ecx, %3
  9569                              <1>  %if %0 = 4
  9570                              <1>  mov edx, %4
  9571                              <1>  %endif
  9572                              <1>  %endif
  9573                              <1>  %endif
  9574 00006CD9 B820000000          <1>  mov eax, %1
  9575                              <1> 
  9576 00006CDE CD40                <1>  int 40h
 10084 00006CE0 7208                    		jc	short .hda
 10085 00006CE2 C605[6E860000]03        		mov	byte [audio_hardware], 3 ; VT8237R
 10086 00006CE9 C3                      		retn
 10087                                  .hda:	
 10088                                  		; check Intel HDA hardware at last
 10089                                  		; (48kHz support)
 10090                                  		; TRDOS 386 system call
 10091                                  		; sysaudio
 10092                                  		; Detect (BH=1) Intel HDA (BL=4) Audio Device
 10093                                  		sys	_audio, 0104h
  9561                              <1> 
  9562                              <1> 
  9563                              <1> 
  9564                              <1> 
  9565                              <1>  %if %0 >= 2
  9566 00006CEA BB04010000          <1>  mov ebx, %2
  9567                              <1>  %if %0 >= 3
  9568                              <1>  mov ecx, %3
  9569                              <1>  %if %0 = 4
  9570                              <1>  mov edx, %4
  9571                              <1>  %endif
  9572                              <1>  %endif
  9573                              <1>  %endif
  9574 00006CEF B820000000          <1>  mov eax, %1
  9575                              <1> 
  9576 00006CF4 CD40                <1>  int 40h
 10094 00006CF6 7208                    		jc	short .err
 10095 00006CF8 C605[6E860000]04        		mov	byte [audio_hardware], 4 ; HDA
 10096 00006CFF C3                      		retn
 10097                                  .err:
 10098 00006D00 BA[0C6D0000]            		mov	edx, txt_audio_nf_err
 10099 00006D05 E898F8FFFF                              call    wrstr_edx
 10100 00006D0A F9                                      stc
 10101 00006D0B C3                      		retn
 10102                                  
 10103 00006D0C 50726F706572206175-     txt_audio_nf_err: db 'Proper audio hardware not found!',0Dh,0Ah,0
 10103 00006D15 64696F206861726477-
 10103 00006D1E 617265206E6F742066-
 10103 00006D27 6F756E64210D0A00   
 10104                                  
 10105                                  
 10106                                  ; =============== CONSTANT ==================================================
 10107                                  
 10108                                  		; 21/10/2024
 10109                                  MP3_MAX_OUTPUT_SIZE equ 2*2*18*32*2
 10110                                      ; = 1200h = 4608 decimal = 2 channels, 2 granules, 18*32, 2 byte(16bit)
 10111                                  
 10112                                  
 10113                                  ; =============== S U B R O U T I N E =======================================
 10114                                  
 10115                                  
 10116                                  audio_system_init:
 10117                                  		;mov	eax, sample_buffer_size
 10118                                  		; 10/01/2025
 10119                                  		;mov	byte [blocks], 16
 10120                                  		; 12/01/2025
 10121 00006D2F C605[74860000]08        		mov	byte [blocks], 8
 10122 00006D36 A1[70ED0000]            		mov	eax, [mp3_samples_output_size]
 10123 00006D3B C1E003                  		shl	eax, 3 ; * 8
 10124                                  		;shl	eax, 4 ; * 16
 10125                                  .asi@:		
 10126                                  		; 12/01/2025
 10127                                  		;cmp	eax, 65536
 10128                                  		;jna	short .asi@@
 10129                                  		;sub	eax, [mp3_samples_output_size]
 10130                                  		;dec	byte [blocks]
 10131                                  		;;;
 10132                                  		; 11/01/2025
 10133                                  		;test	byte [blocks], 1
 10134                                  		;jz	short .asi@
 10135                                  		;dec	byte [blocks] ; even number
 10136                                  		;sub	eax, [mp3_samples_output_size]
 10137                                  		;;;
 10138                                  		;jmp	short .asi@
 10139                                  .asi@@:
 10140 00006D3E 803D[6E860000]01        		cmp	byte [audio_hardware], 1 ; SB16
 10141 00006D45 7515                    		jne	short .bufaloc
 10142                                  .asi@@@:
 10143                                  		; 10/01/2025
 10144 00006D47 3D00800000              		cmp	eax, 32768
 10145 00006D4C 760E                    		jna	short .bufaloc
 10146                                  		; sample_buffer_size = 36864 bytes ; 8 blocks
 10147                                  		;sub	eax, MP3_MAX_OUTPUT_SIZE
 10148                                  		; eax = 32256 ; 7 blocks
 10149                                  		; 10/01/2025
 10150 00006D4E 2B05[70ED0000]          		sub	eax, [mp3_samples_output_size]
 10151 00006D54 FE0D[74860000]          		dec	byte [blocks]
 10152                                  		;;;
 10153                                  		; 11/01/2025
 10154                                  		;test	byte [blocks], 1
 10155                                  		;jz	short .asi@@@
 10156                                  		;dec	byte [blocks] ; even number
 10157                                  		;sub	eax, [mp3_samples_output_size]
 10158                                  		;;;
 10159 00006D5A EBEB                    		jmp	short .asi@@@
 10160                                  .bufaloc:
 10161                                  		; TRDOS 386 system call
 10162                                  		; sysaudio
 10163                                  		; Allocate audio buffer (for user)
 10164                                  		; ebx = 0200h (BH=2)
 10165                                  		; ecx = buffer size (in bytes)
 10166                                  		; edx = buffer address (virtual)
 10167 00006D5C A3[76860000]            		mov	[buffer_size], eax
 10168                                  		sys	_audio, 0200h, eax, sample_buffer
  9561                              <1> 
  9562                              <1> 
  9563                              <1> 
  9564                              <1> 
  9565                              <1>  %if %0 >= 2
  9566 00006D61 BB00020000          <1>  mov ebx, %2
  9567                              <1>  %if %0 >= 3
  9568 00006D66 89C1                <1>  mov ecx, %3
  9569                              <1>  %if %0 = 4
  9570 00006D68 BA[00300500]        <1>  mov edx, %4
  9571                              <1>  %endif
  9572                              <1>  %endif
  9573                              <1>  %endif
  9574 00006D6D B820000000          <1>  mov eax, %1
  9575                              <1> 
  9576 00006D72 CD40                <1>  int 40h
 10169 00006D74 7225                    		jc	short .init_err
 10170                                  
 10171                                  		; 12/01/2025
 10172                                  		; clear audio buffer (before playback)
 10173 00006D76 BF[00300500]            		mov	edi, sample_buffer
 10174                                  		; ecx = buffer size in bytes
 10175 00006D7B C1E902                  		shr	ecx, 2 ; double word
 10176 00006D7E 31C0                    		xor	eax, eax
 10177 00006D80 F3AB                    		rep	stosd
 10178                                  
 10179                                  		; TRDOS 386 system call
 10180                                  		; sysaudio
 10181                                  		; Initialize audio device (bh = 3)
 10182                                  		; bl = 01h -> CallBack method
 10183                                  		; edx = Callback service address (virtual)
 10184                                  		; ecx = 0 ; CL = srb value ; not used
 10185                                  		;sys	_audio, 0301h, 0, audio_callback
 10186                                  		; 12/01/2025
 10187                                  		; SRB method (faster than callback method)
 10188                                  		; bl = 0 -> Signal Response Byte method
 10189                                  		; cl = 1 -> SRB set value 
 10190                                  		;     (will be set by audio IRQ service of the kernel)
 10191                                  		; edx = SRB address -one byte data-
 10192                                  		sys	_audio, 0300h, 1, srb	
  9561                              <1> 
  9562                              <1> 
  9563                              <1> 
  9564                              <1> 
  9565                              <1>  %if %0 >= 2
  9566 00006D82 BB00030000          <1>  mov ebx, %2
  9567                              <1>  %if %0 >= 3
  9568 00006D87 B901000000          <1>  mov ecx, %3
  9569                              <1>  %if %0 = 4
  9570 00006D8C BA[72860000]        <1>  mov edx, %4
  9571                              <1>  %endif
  9572                              <1>  %endif
  9573                              <1>  %endif
  9574 00006D91 B820000000          <1>  mov eax, %1
  9575                              <1> 
  9576 00006D96 CD40                <1>  int 40h
 10193 00006D98 7201                    		jc	short .init_err
 10194 00006D9A C3                      		retn
 10195                                  .init_err:
 10196 00006D9B BA[A76D0000]            		mov	edx, txt_audio_init_err
 10197 00006DA0 E8FDF7FFFF                              call    wrstr_edx
 10198 00006DA5 F9                                      stc
 10199 00006DA6 C3                      		retn
 10200                                  
 10201 00006DA7 417564696F20686172-     txt_audio_init_err: db 'Audio hardware initialization error!',0Dh,0Ah,0
 10201 00006DB0 647761726520696E69-
 10201 00006DB9 7469616C697A617469-
 10201 00006DC2 6F6E206572726F7221-
 10201 00006DCB 0D0A00             
 10202                                  
 10203                                  
 10204                                  ; =============== S U B R O U T I N E =======================================
 10205                                  
 10206                                  ; 12/01/2025
 10207                                  %if 0
 10208                                  		; 21/10/2024
 10209                                  audio_callback:
 10210                                  		; Operating system has directed CPU here because of
 10211                                  		; user (2nd) stage of the audio hardware interrupt service.
 10212                                  		; This procedure must be short and return to operating
 10213                                  		; system again via sysrelease system call
 10214                                  		; (or any system call here will be handled as sysrelease).
 10215                                  
 10216                                  		mov	byte [srb], 1
 10217                                  
 10218                                  		sys	_rele ; return from callback service 
 10219                                  		
 10220                                  		; we must not come here !
 10221                                  		mov	ebx, -1
 10222                                  		sys	_exit
 10223                                  		;jmp	short audio_callback
 10224                                  %endif
 10225                                  
 10226                                  ; =============== S U B R O U T I N E =======================================
 10227                                  
 10228                                  		; 10/01/2025
 10229                                  		; 21/10/2024
 10230                                  mp3_cast_to_speaker:
 10231                                  		;call	try_enqueue_all_blocks
 10232                                  
 10233                                  		;cmp	dword [bytes_left],0
 10234                                  		;jz	short .playback
 10235                                  
 10236                                  		; 12/01/2025
 10237                                  		; (here audio buffer -sample_buffer- is empty)
 10238                                  		; (clear dma half buffer 1)
 10239                                  		sys	_audio, 1001h
  9561                              <1> 
  9562                              <1> 
  9563                              <1> 
  9564                              <1> 
  9565                              <1>  %if %0 >= 2
  9566 00006DCE BB01100000          <1>  mov ebx, %2
  9567                              <1>  %if %0 >= 3
  9568                              <1>  mov ecx, %3
  9569                              <1>  %if %0 = 4
  9570                              <1>  mov edx, %4
  9571                              <1>  %endif
  9572                              <1>  %endif
  9573                              <1>  %endif
  9574 00006DD3 B820000000          <1>  mov eax, %1
  9575                              <1> 
  9576 00006DD8 CD40                <1>  int 40h
 10240                                  		; (clear dma half buffer 2)
 10241                                  		;sys	_audio, 1002h
 10242                                  
 10243                                  		; TRDOS 386 system call
 10244                                  		; sysaudio
 10245                                  		; bh = 16 : update (current, first) dma half buffer
 10246                                  		; bl = 0  : then switch to the next (second) half buffer
 10247                                  		sys	_audio, 1000h
  9561                              <1> 
  9562                              <1> 
  9563                              <1> 
  9564                              <1> 
  9565                              <1>  %if %0 >= 2
  9566 00006DDA BB00100000          <1>  mov ebx, %2
  9567                              <1>  %if %0 >= 3
  9568                              <1>  mov ecx, %3
  9569                              <1>  %if %0 = 4
  9570                              <1>  mov edx, %4
  9571                              <1>  %endif
  9572                              <1>  %endif
  9573                              <1>  %endif
  9574 00006DDF B820000000          <1>  mov eax, %1
  9575                              <1> 
  9576 00006DE4 CD40                <1>  int 40h
 10248                                  
 10249                                  		; 22/10/2024
 10250                                  		;call	try_enqueue_all_blocks
 10251                                  .playback:
 10252                                  		; TRDOS 386 system call
 10253                                  		; sysaudio
 10254                                  		; Set Master Volume Level (BL=0 or 80h)
 10255                                  		; 	for next playing (BL>=80h)
 10256                                  		;sys	_audio, 0B80h, 1D1Dh
 10257                                  		sys	_audio, 0B00h, 1D1Dh
  9561                              <1> 
  9562                              <1> 
  9563                              <1> 
  9564                              <1> 
  9565                              <1>  %if %0 >= 2
  9566 00006DE6 BB000B0000          <1>  mov ebx, %2
  9567                              <1>  %if %0 >= 3
  9568 00006DEB B91D1D0000          <1>  mov ecx, %3
  9569                              <1>  %if %0 = 4
  9570                              <1>  mov edx, %4
  9571                              <1>  %endif
  9572                              <1>  %endif
  9573                              <1>  %endif
  9574 00006DF0 B820000000          <1>  mov eax, %1
  9575                              <1> 
  9576 00006DF5 CD40                <1>  int 40h
 10258                                  
 10259                                  		;mov	byte [volume_level], 1Dh
 10260 00006DF7 880D[73860000]          		mov	[volume_level], cl
 10261                                  
 10262                                  		; Start	to play
 10263 00006DFD A1[B2960000]            		mov	eax, [mp3_bytes_per_sample]
 10264                                  		;shr	al, 1 ; 8 -> 0, 16 -> 1
 10265                                  		;shl	al, 1 ; 16 -> 2, 8 -> 0
 10266 00006E02 2402                    		and	al, 2 ; 22/10/2024
 10267 00006E04 8B1D[AA960000]          		mov	ebx, [mp3_output_num_channels]
 10268 00006E0A 4B                      		dec	ebx
 10269 00006E0B 08C3                    		or	bl, al
 10270 00006E0D 8B0D[AE960000]          		mov	ecx, [mp3_output_sample_rate]
 10271 00006E13 B704                    		mov	bh, 4 ; start to play
 10272                                  
 10273                                  		; TRDOS 386 system call
 10274                                  		; sysaudio
 10275                                  		; bh = 4 -> start to play
 10276                                  		; bl = mode -> bit 0, 1 = stereo, 0 = mono
 10277                                  		;	       bit 1, 1 = 16 bit, 0 = 8 bit
 10278                                  		; cx = sample rate (hertz)
 10279                                  		sys	_audio
  9561                              <1> 
  9562                              <1> 
  9563                              <1> 
  9564                              <1> 
  9565                              <1>  %if %0 >= 2
  9566                              <1>  mov ebx, %2
  9567                              <1>  %if %0 >= 3
  9568                              <1>  mov ecx, %3
  9569                              <1>  %if %0 = 4
  9570                              <1>  mov edx, %4
  9571                              <1>  %endif
  9572                              <1>  %endif
  9573                              <1>  %endif
  9574 00006E15 B820000000          <1>  mov eax, %1
  9575                              <1> 
  9576 00006E1A CD40                <1>  int 40h
 10280                                  
 10281                                  		; 12/01/2025
 10282 00006E1C C605[72860000]00        		mov	byte [srb], 0
 10283                                  		;;;
 10284                                  
 10285                                  .playback_lop:
 10286 00006E23 31C0                    		xor	eax, eax
 10287 00006E25 3905[E0250500]          		cmp	[bytes_left], eax ; 0
 10288 00006E2B 7508                    		jnz	short .playback_next
 10289                                  .pb@@@:
 10290                                  		; 22/10/2024
 10291 00006E2D 3805[2C7E0000]          		cmp	byte [num_enqueued_frames], al ; 0
 10292 00006E33 741A                                    jz	short .playback_end
 10293                                  .playback_next:
 10294 00006E35 A2[2C7E0000]            		mov	[num_enqueued_frames], al ; 0
 10295 00006E3A 803D[72860000]01        		cmp	byte [srb], 1	; audio interrupt status
 10296 00006E41 723D                    		jb	short .getchar
 10297                                  		;mov	byte [srb], 0	; reset
 10298 00006E43 A2[72860000]            		mov	[srb], al ; 0
 10299 00006E48 E888000000              		call	try_enqueue_all_blocks
 10300 00006E4D EBD4                    		jmp	short .playback_lop
 10301                                  .playback_end:
 10302                                  		; TRDOS 386 system call
 10303                                  		; sysaudio
 10304                                  		; Stop playing
 10305                                  		sys	_audio, 0700h
  9561                              <1> 
  9562                              <1> 
  9563                              <1> 
  9564                              <1> 
  9565                              <1>  %if %0 >= 2
  9566 00006E4F BB00070000          <1>  mov ebx, %2
  9567                              <1>  %if %0 >= 3
  9568                              <1>  mov ecx, %3
  9569                              <1>  %if %0 = 4
  9570                              <1>  mov edx, %4
  9571                              <1>  %endif
  9572                              <1>  %endif
  9573                              <1>  %endif
  9574 00006E54 B820000000          <1>  mov eax, %1
  9575                              <1> 
  9576 00006E59 CD40                <1>  int 40h
 10306                                  		; Cancel callback service (for user)
 10307                                  		sys	_audio, 0900h
  9561                              <1> 
  9562                              <1> 
  9563                              <1> 
  9564                              <1> 
  9565                              <1>  %if %0 >= 2
  9566 00006E5B BB00090000          <1>  mov ebx, %2
  9567                              <1>  %if %0 >= 3
  9568                              <1>  mov ecx, %3
  9569                              <1>  %if %0 = 4
  9570                              <1>  mov edx, %4
  9571                              <1>  %endif
  9572                              <1>  %endif
  9573                              <1>  %endif
  9574 00006E60 B820000000          <1>  mov eax, %1
  9575                              <1> 
  9576 00006E65 CD40                <1>  int 40h
 10308                                  		; Deallocate audio buffer (for user)
 10309                                  		sys	_audio, 0A00h
  9561                              <1> 
  9562                              <1> 
  9563                              <1> 
  9564                              <1> 
  9565                              <1>  %if %0 >= 2
  9566 00006E67 BB000A0000          <1>  mov ebx, %2
  9567                              <1>  %if %0 >= 3
  9568                              <1>  mov ecx, %3
  9569                              <1>  %if %0 = 4
  9570                              <1>  mov edx, %4
  9571                              <1>  %endif
  9572                              <1>  %endif
  9573                              <1>  %endif
  9574 00006E6C B820000000          <1>  mov eax, %1
  9575                              <1> 
  9576 00006E71 CD40                <1>  int 40h
 10310                                  		; Disable audio device
 10311                                  		sys	_audio, 0C00h
  9561                              <1> 
  9562                              <1> 
  9563                              <1> 
  9564                              <1> 
  9565                              <1>  %if %0 >= 2
  9566 00006E73 BB000C0000          <1>  mov ebx, %2
  9567                              <1>  %if %0 >= 3
  9568                              <1>  mov ecx, %3
  9569                              <1>  %if %0 = 4
  9570                              <1>  mov edx, %4
  9571                              <1>  %endif
  9572                              <1>  %endif
  9573                              <1>  %endif
  9574 00006E78 B820000000          <1>  mov eax, %1
  9575                              <1> 
  9576 00006E7D CD40                <1>  int 40h
 10312 00006E7F C3                      		retn
 10313                                  
 10314                                  .getchar:
 10315                                  		; TRDOS 386 system call
 10316                                  		; sysstdio
 10317                                  		; BL = 1 -> read a character on stdin (no wait)
 10318                                  		;sys	_stdio, 1
 10319                                  		;and	eax, eax
 10320                                  		;jz	short .playback_next
 10321                                  
 10322                                  		; 11/01/2025
 10323 00006E80 B401                    		mov	ah, 1
 10324 00006E82 CD32                    		int	32h	;  (TRDOS 386 keyboard interrupt)
 10325 00006E84 74AF                    		jz	short .playback_next
 10326 00006E86 30E4                    		xor	ah, ah
 10327 00006E88 CD32                    		int	32h	; (TRDOS 386 keyboard interrupt)
 10328                                  
 10329 00006E8A 3C2B                    		cmp	al, '+' ; increase sound volume
 10330 00006E8C 740E                    		je	short .inc_volume
 10331 00006E8E 3C2D                    		cmp	al, '-'
 10332 00006E90 7430                    		je	short .dec_volume
 10333                                  
 10334                                  		;;;
 10335                                  		; 10/01/2025
 10336                                  		;cmp	ah, 01h
 10337 00006E92 3C1B                    		cmp	al, 1Bh	; ESC
 10338 00006E94 74B9                    		je	short .playback_end
 10339                                  		;cmp	ax, 2E03h
 10340 00006E96 3C03                    		cmp	al, 03h	; CTRL+C
 10341 00006E98 74B5                    		je	short .playback_end
 10342                                  		;;;
 10343                                  		; 13/01/2025
 10344 00006E9A EB99                    		jmp	.playback_next
 10345                                  
 10346                                  .inc_volume:
 10347 00006E9C 8A0D[73860000]          		mov	cl, [volume_level]
 10348 00006EA2 80F91F                  		cmp	cl, 1Fh ; 31
 10349 00006EA5 738E                    		jnb	.playback_next
 10350 00006EA7 FEC1                    		inc	cl
 10351                                  .chg_volume:
 10352 00006EA9 880D[73860000]          		mov	[volume_level], cl
 10353 00006EAF 88CD                    		mov	ch, cl
 10354                                  		; TRDOS 386 system call
 10355                                  		; sysstdio
 10356                                  		; Set master volume level
 10357                                  		; bh = 11
 10358                                  		; cl = left channel volume (0 to 31 max)
 10359                                  		; ch = right channel volume (0 to 31 max)
 10360                                  		sys	_audio, 0B00h
  9561                              <1> 
  9562                              <1> 
  9563                              <1> 
  9564                              <1> 
  9565                              <1>  %if %0 >= 2
  9566 00006EB1 BB000B0000          <1>  mov ebx, %2
  9567                              <1>  %if %0 >= 3
  9568                              <1>  mov ecx, %3
  9569                              <1>  %if %0 = 4
  9570                              <1>  mov edx, %4
  9571                              <1>  %endif
  9572                              <1>  %endif
  9573                              <1>  %endif
  9574 00006EB6 B820000000          <1>  mov eax, %1
  9575                              <1> 
  9576 00006EBB CD40                <1>  int 40h
 10361 00006EBD E973FFFFFF              		jmp	.playback_next
 10362                                  .dec_volume:
 10363 00006EC2 8A0D[73860000]          		mov	cl, [volume_level]
 10364 00006EC8 80F901                  		cmp	cl, 1 ; 1
 10365 00006ECB 0F8664FFFFFF            		jna	.playback_next
 10366 00006ED1 FEC9                    		dec	cl
 10367 00006ED3 EBD4                    		jmp	short .chg_volume
 10368                                  
 10369                                  
 10370                                  ; =============== S U B R O U T I N E =======================================
 10371                                  
 10372                                  		; 09/01/2025
 10373                                  		; 21/10/2024
 10374                                  try_enqueue_all_blocks:
 10375 00006ED5 BF[00300500]            		mov	edi, sample_buffer
 10376                                  		; 12/01/2025
 10377                                  		;mov	edi, decoding_buffer
 10378                                  		; 11/01/2025
 10379                                  		;cmp	dword [bytes_left], 0
 10380                                  		;jna	short .enqueue_done
 10381                                  		; 10/01/2025
 10382 00006EDA EB15                    		jmp	short .first_block
 10383                                  .next_block:
 10384 00006EDC 833D[E0250500]00        		cmp	dword [bytes_left], 0
 10385 00006EE3 7E55                    		jle	short .enqueue_done
 10386                                  		;
 10387 00006EE5 8B3D[6CED0000]          		mov	edi, [mp3_samples_dst]
 10388 00006EEB 033D[70ED0000]          		add	edi, [mp3_samples_output_size]
 10389                                  .first_block:
 10390                                  		;pusha
 10391 00006EF1 8B35[DC250500]          		mov	esi, [stream_pos]
 10392 00006EF7 8B0D[E0250500]          		mov	ecx, [bytes_left]
 10393 00006EFD 31ED                    		xor	ebp, ebp
 10394 00006EFF E814F3FFFF              		call	mp3_decode_frame
 10395                                  		;popa
 10396 00006F04 7234                    		jc	short .enqueue_done
 10397                                  
 10398 00006F06 A1[82960000]            		mov	eax, [mp3_src_frame_size]
 10399 00006F0B 83F800                  		cmp	eax, 0
 10400 00006F0E 742A                     		jz	short .enqueue_done
 10401 00006F10 0105[DC250500]          		add	[stream_pos], eax
 10402 00006F16 2905[E0250500]          		sub	[bytes_left], eax
 10403                                  
 10404 00006F1C A1[70ED0000]            		mov	eax, [mp3_samples_output_size]
 10405 00006F21 83F800                  		cmp	eax, 0
 10406 00006F24 74B6                    		jz	short .next_block
 10407                                  .no_error:
 10408 00006F26 FE05[2C7E0000]          		inc	byte [num_enqueued_frames]
 10409                                  		
 10410 00006F2C A0[2C7E0000]            		mov	al, [num_enqueued_frames]
 10411 00006F31 3A05[74860000]          		cmp	al, [blocks]
 10412 00006F37 72A3                    		jb	short .next_block
 10413 00006F39 C3                      		retn
 10414                                  .enqueue_done:
 10415 00006F3A C705[E0250500]0000-     		mov	dword [bytes_left], 0
 10415 00006F42 0000               
 10416 00006F44 C3                      		retn
 10417                                  
 10418                                  
 10419                                  ; ===========================================================================
 10420                                  ; end of TRDOS 386 specific procedures.
 10421                                  ; ---------------------------------------------------------------------------
 10422                                  
 10423                                  ; ===========================================================================
 10424                                  ; Initialized DATA
 10425                                  ; ===========================================================================
 10426                                  
 10427 00006F45 00                      option_test     db 0                   
 10428 00006F46 00                      option_mono     db 0                   
 10429 00006F47 00                      option_8bit     db 0                   
 10430 00006F48 00                      option_rate_shift db 0                 
 10431 00006F49 00                      option_fast     db 0                   
 10432 00006F4A 90<rep 2h>                              align 4
 10433 00006F4C 00000000                cpuid_flags     dd 0                   
 10434 00006F50 00                      cpuid_exists    db 0                   
 10435 00006F51 00                      detected_cpu    db 0                   
 10436 00006F52 90<rep 2h>                              align 4
 10437 00006F54 00000000                mp3_output_milliseconds dd 0           
 10438 00006F58 00000000                millisecond_count dd 0
 10439                                  
 10440                                  ; 20/10/2024                 
 10441                                  ; HANDLE hProcess
 10442                                  ;hProcess       dd 0                   
 10443                                  ; HANDLE hThread
 10444                                  ;hThread        dd 0                   
 10445                                  ; DWORD dwPriorityClass
 10446                                  ;dwPriorityClass dd 0                   
 10447                                  ; int nPriority
 10448                                  ;nPriority      dd 0
 10449                                                     
 10450 00006F5C 0000000000000000        ttt             dd 2 dup(0)            
 10451 00006F64 726561642068656164-     rdtsc_read_header db 'read header    ',0
 10451 00006F6D 65722020202000     
 10452 00006F74 0000000000000000        rdtsc_read_header_extra dd  0, 0       
 10453 00006F7C 726561642065787472-                     db 'read extra     ',0
 10453 00006F85 61202020202000     
 10454 00006F8C 0000000000000000        rdtsc_read_granule dd 0, 0             
 10455 00006F94 72656164206772616E-                     db 'read granule   ',0
 10455 00006F9D 756C6520202000     
 10456 00006FA4 0000000000000000        rdtsc_append_main dd 2 dup(0)          
 10457 00006FAC 617070656E64206D61-                     db 'append main    ',0
 10457 00006FB5 696E2020202000     
 10458 00006FBC 0000000000000000        rdtsc_read_scalefac dd 2 dup(0)        
 10459 00006FC4 72656164207363616C-                     db 'read scalefac  ',0
 10459 00006FCD 65666163202000     
 10460 00006FD4 0000000000000000        rdtsc_xlat_scalefac dd 2 dup(0)        
 10461 00006FDC 786C6174207363616C-                     db 'xlat scalefac  ',0
 10461 00006FE5 65666163202000     
 10462 00006FEC 0000000000000000        rdtsc_read_huffman dd 2 dup(0)         
 10463 00006FF4 726561642068756666-                     db 'read huffman   ',0
 10463 00006FFD 6D616E20202000     
 10464 00007004 0000000000000000        rdtsc_ms_stereo dd 2 dup(0)            
 10465 0000700C 6D732073746572656F-                     db 'ms stereo      ',0
 10465 00007015 20202020202000     
 10466 0000701C 0000000000000000        rdtsc_i_stereo  dd 2 dup(0)            
 10467 00007024 692073746572656F20-                     db 'i stereo       ',0
 10467 0000702D 20202020202000     
 10468 00007034 0000000000000000        rdtsc_reorder   dd 2 dup(0)            
 10469 0000703C 72656F726465722020-                     db 'reorder        ',0
 10469 00007045 20202020202000     
 10470 0000704C 0000000000000000        rdtsc_antialias dd 2 dup(0)            
 10471 00007054 616E7469616C696173-                     db 'antialias      ',0
 10471 0000705D 20202020202000     
 10472 00007064 0000000000000000        rdtsc_imdct     dd 2 dup(0)            
 10473 0000706C 696D64637420202020-                     db 'imdct          ',0
 10473 00007075 20202020202000     
 10474 0000707C 0000000000000000        rdtsc_imdct36   dd 2 dup(0)            
 10475 00007084 20696D646374333620-                     db ' imdct36       ',0
 10475 0000708D 20202020202000     
 10476 00007094 0000000000000000        rdtsc_imdct12   dd 2 dup(0)            
 10477 0000709C 20696D646374313220-                     db ' imdct12       ',0
 10477 000070A5 20202020202000     
 10478 000070AC 0000000000000000        rdtsc_imdct0    dd 2 dup(0)            
 10479 000070B4 20696D646374302020-                     db ' imdct0        ',0
 10479 000070BD 20202020202000     
 10480 000070C4 0000000000000000        rdtsc_synth_dct dd 2 dup(0)            
 10481 000070CC 73796E74682F646374-                     db 'synth/dct      ',0
 10481 000070D5 20202020202000     
 10482 000070DC 0000000000000000        rdtsc_dct32     dd 2 dup(0)            
 10483 000070E4 2073796E74682E6463-                     db ' synth.dct32   ',0
 10483 000070ED 74333220202000     
 10484 000070F4 0000000000000000        rdtsc_synth     dd 2 dup(0)            
 10485 000070FC 2073796E74682E6F75-                     db ' synth.output  ',0
 10485 00007105 74707574202000     
 10486 0000710C 0000000000000000        rdtsc_total     dd 2 dup(0)            
 10487 00007114 746F74616C20202020-                     db 'total          ',0
 10487 0000711D 20202020202000     
 10488 00007124 000020002800300038-     mp3_bitrate_tab dw  0,32,40,48,56,64,80,96,112,128,160,192,224,256,320, 0
 10488 0000712D 004000500060007000-
 10488 00007136 8000A000C000E00000-
 10488 0000713F 0140010000         
 10489 00007144 000008001000180020-                     dw  0, 8,16,24,32,40,48,56,64,80,96,112,128,144,160, 0
 10489 0000714D 002800300038004000-
 10489 00007156 500060007000800090-
 10489 0000715F 00A0000000         
 10490 00007164 44AC80BB007D            mp3_freq_tab    dw 44100,48000,32000   
 10491 0000716A 000504040000            mp3_lsf_sf_expand_init_table db 0, 5, 4, 4, 0, 0
 10492 00007170 9001                                    dw 400                  ; 0..399 ; normal case
 10493 00007172 000504010C00                            db 0, 5, 4, 1, 0Ch, 0
 10494 00007178 F401                                    dw 500                  ; 400..499
 10495 0000717A 000301011801                            db 0, 3, 1, 1, 18h, 1
 10496 00007180 0002                                    dw 512                  ; 500..511
 10497 00007182 010606012400                            db 1, 6, 6, 1, 24h, 0
 10498 00007188 6803                                    dw 872                  ; 512+360 ; 0..359 for 2nd channel of intensity stereo
 10499 0000718A 010404013000                            db 1, 4, 4, 1, 30h, 0
 10500 00007190 E803                                    dw 1000                 ; 512+488 ; 360..487
 10501 00007192 010301013C00                            db 1, 3, 1, 1, 3Ch, 0
 10502 00007198 0004                                    dw 1024                 ; 512+512 ; 488..511
 10503 0000719A 010000000000000000-     mp3_synth_win_src dw      1,     0,     0,     0,     0,     0,     1,     0
 10503 000071A3 00000001000000     
 10504 000071AA 000000000100000001-                     dw      0,     0,     1,     0,     1,     0,     1,     0
 10504 000071B3 00000001000000     
 10505 000071BA 010001000000010001-                     dw      1,     1,     0,     1,     1,     1,     1,     2
 10505 000071C3 00010001000200     
 10506 000071CA 010002000100020002-                     dw      1,     2,     1,     2,     2,     3,     2,     3
 10506 000071D3 00030002000300     
 10507 000071DA 020004000300030004-                     dw      2,     4,     3,     3,     4,     4,     4,     5
 10507 000071E3 00040004000500     
 10508 000071EA 050005000500060006-                     dw      5,     5,     5,     6,     6,     6,     6,     7
 10508 000071F3 00060006000700     
 10509 000071FA 070006000800070007-                     dw      7,     6,     8,     7,     7,     8,     7,     7
 10509 00007203 00080007000700     
 10510 0000720A 080007000700070006-                     dw      8,     7,     7,     7,     6,     6,     6,     5
 10510 00007213 00060006000500     
 10511 0000721A 51FEFCFFFDFFFEFFFF-                     dw 0FE51h,0FFFCh,0FFFDh,0FFFEh,0FFFFh,     0,     1,     3
 10511 00007223 FF000001000300     
 10512 0000722A 03000600070008000B-                     dw      3,     6,     7,     8,   0Bh,   0Ch,   0Eh,   11h
 10512 00007233 000C000E001100     
 10513 0000723A 1300150017001A001C-                     dw    13h,   15h,   17h,   1Ah,   1Ch,   1Fh,   22h,   24h
 10513 00007243 001F0022002400     
 10514 0000724A 27002A002C002F0032-                     dw    27h,   2Ah,   2Ch,   2Fh,   32h,   35h,   36h,   3Ah
 10514 00007253 00350036003A00     
 10515 0000725A 3C003E004000420044-                     dw    3Ch,   3Eh,   40h,   42h,   44h,   45h,   47h,   48h
 10515 00007263 00450047004800     
 10516 0000726A 490049004900490049-                     dw    49h,   49h,   49h,   49h,   49h,   48h,   46h,   45h
 10516 00007273 00480046004500     
 10517 0000727A 430040003D003A0035-                     dw    43h,   40h,   3Dh,   3Ah,   35h,   31h,   2Bh,   27h
 10517 00007283 0031002B002700     
 10518 0000728A 1F00190012000A0002-                     dw    1Fh,   19h,   12h,   0Ah,     2,0FFF9h,0FFEFh,0FFE6h
 10518 00007293 00F9FFEFFFE6FF     
 10519 0000729A 3BF030003B00470053-                     dw 0F03Bh,   30h,   3Bh,   47h,   53h,   5Fh,   6Dh,   79h
 10519 000072A3 005F006D007900     
 10520 000072AA 86009500A100B000BD-                     dw    86h,   95h,  0A1h,  0B0h,  0BDh,  0CBh,  0D9h,  0E6h
 10520 000072B3 00CB00D900E600     
 10521 000072BA F30001010D01190125-                     dw   0F3h,  101h,  10Dh,  119h,  125h,  130h,  13Ah,  144h
 10521 000072C3 0130013A014401     
 10522 000072CA 4D0155015B01620166-                     dw   14Dh,  155h,  15Bh,  162h,  166h,  16Ah,  16Bh,  16Dh
 10522 000072D3 016A016B016D01     
 10523 000072DA 6C016A01660160015A-                     dw   16Ch,  16Ah,  166h,  160h,  15Ah,  150h,  146h,  139h
 10523 000072E3 01500146013901     
 10524 000072EA 2B011A010801F300DD-                     dw   12Bh,  11Ah,  108h,  0F3h,  0DDh,  0C5h,  0A9h,   8Eh
 10524 000072F3 00C500A9008E00     
 10525 000072FA 6F004E002B000700E1-                     dw    6Fh,   4Eh,   2Bh,     7,0FFE1h,0FFB8h,0FF8Fh,0FF62h
 10525 00007303 FFB8FF8FFF62FF     
 10526 0000730A 35FF06FFD5FEA4FE70-                     dw 0FF35h,0FF06h,0FED5h,0FEA4h,0FE70h,0FE3Ch,0FE06h,0FDD0h
 10526 00007313 FE3CFE06FED0FD     
 10527 0000731A 0BCF9F02D702110349-                     dw 0CF0Bh,  29Fh,  2D7h,  311h,  349h,  382h,  3BBh,  3F4h
 10527 00007323 038203BB03F403     
 10528 0000732A 2C0464049A04D10405-                     dw   42Ch,  464h,  49Ah,  4D1h,  505h,  538h,  56Ah,  59Bh
 10528 00007333 0538056A059B05     
 10529 0000733A C805F505200647066C-                     dw   5C8h,  5F5h,  620h,  647h,  66Ch,  68Fh,  6AFh,  6CCh
 10529 00007343 068F06AF06CC06     
 10530 0000734A E506FC060F071F072B-                     dw   6E5h,  6FCh,  70Fh,  71Fh,  72Bh,  734h,  739h,  739h
 10530 00007353 07340739073907     
 10531 0000735A 370730072607170704-                     dw   737h,  730h,  726h,  717h,  704h,  6EDh,  6D3h,  6B4h
 10531 00007363 07ED06D306B406     
 10532 0000736A 91066C0640061306E1-                     dw   691h,  66Ch,  640h,  613h,  5E1h,  5ABh,  573h,  537h
 10532 00007373 05AB0573053705     
 10533 0000737A F704B4046F042704DB-                     dw   4F7h,  4B4h,  46Fh,  427h,  3DBh,  38Fh,  33Eh,  2EDh
 10533 00007383 038F033E03ED02     
 10534 0000738A 9A024402ED0195013D-                     dw   29Ah,  244h,  1EDh,  195h,  13Dh,  0E2h,   88h,   2Eh
 10534 00007393 01E20088002E00     
 10535 0000739A 00                                      db    0
 10536 0000739B 00                                      db    0
 10537 0000739C 000000010002000303-     mp3_slen_table  dw  0000h, 0100h, 0200h, 0300h, 0003h, 0101h, 0201h, 0301h
 10537 000073A5 00010101020103     
 10538 000073AC 020102020203030103-                     dw  0102h, 0202h, 0302h, 0103h, 0203h, 0303h, 0204h, 0304h
 10538 000073B5 02030304020403     
 10539 000073BC 060505050909090906-     mp3_lsf_nsf_table dd  05050506h, 09090909h, 09090906h
 10539 000073C5 090909             
 10540 000073C8 0605070309090C0606-                     dd  03070506h, 060C0909h, 060C0906h
 10540 000073D1 090C06             
 10541 000073D4 0B0A0000121200000F-                     dd  00000A0Bh, 00001212h, 0000120Fh
 10541 000073DD 120000             
 10542 000073E0 070707000C0C0C0006-                     dd  00070707h, 000C0C0Ch, 000C0F06h
 10542 000073E9 0F0C00             
 10543 000073EC 060606030C09090606-                     dd  03060606h, 0609090Ch, 06090C06h
 10543 000073F5 0C0906             
 10544 000073F8 080805000F0C090006-                     dd  00050808h, 00090C0Fh, 00091206h
 10544 00007401 120900             
 10545 00007404 1101100022021221        huff_tree_list_data db  11h,   1, 10h,   0, 22h,   2, 12h, 21h
 10546 0000740C 2011011000220212                        db  20h, 11h,   1, 10h,   0, 22h,   2, 12h
 10547 00007414 2120101101003323                        db  21h, 20h, 10h, 11h,   1,   0, 33h, 23h
 10548 0000741C 3231130330221221                        db  32h, 31h, 13h,   3, 30h, 22h, 12h, 21h
 10549 00007424 0220110110003303                        db    2, 20h, 11h,   1, 10h,   0, 33h,   3
 10550 0000742C 2332301331220212                        db  23h, 32h, 30h, 13h, 31h, 22h,   2, 12h
 10551 00007434 2120011110005545                        db  21h, 20h,   1, 11h, 10h,   0, 55h, 45h
 10552 0000743C 5453354425521551                        db  54h, 53h, 35h, 44h, 25h, 52h, 15h, 51h
 10553 00007444 0534504333244214                        db    5, 34h, 50h, 43h, 33h, 24h, 42h, 14h
 10554 0000744C 4140042332031331                        db  41h, 40h,   4, 23h, 32h,   3, 13h, 31h
 10555 00007454 3022122102201101                        db  30h, 22h, 12h, 21h,   2, 20h, 11h,   1
 10556 0000745C 1000555445533544                        db  10h,   0, 55h, 54h, 45h, 53h, 35h, 44h
 10557 00007464 2552051551344350                        db  25h, 52h,   5, 15h, 51h, 34h, 43h, 50h
 10558 0000746C 3324421441044023                        db  33h, 24h, 42h, 14h, 41h,   4, 40h, 23h
 10559 00007474 3213310330220220                        db  32h, 13h, 31h,   3, 30h, 22h,   2, 20h
 10560 0000747C 1221110110005545                        db  12h, 21h, 11h,   1, 10h,   0, 55h, 45h
 10561 00007484 3553540544255215                        db  35h, 53h, 54h,   5, 44h, 25h, 52h, 15h
 10562 0000748C 5134435004244233                        db  51h, 34h, 43h, 50h,   4, 24h, 42h, 33h
 10563 00007494 4014412332133103                        db  40h, 14h, 41h, 23h, 32h, 13h, 31h,   3
 10564 0000749C 3022021221201101                        db  30h, 22h,   2, 12h, 21h, 20h, 11h,   1
 10565 000074A4 1000776776577566                        db  10h,   0, 77h, 67h, 76h, 57h, 75h, 66h
 10566 000074AC 4774566537734655                        db  47h, 74h, 56h, 65h, 37h, 73h, 46h, 55h
 10567 000074B4 5463277264077062                        db  54h, 63h, 27h, 72h, 64h,   7, 70h, 62h
 10568 000074BC 4535065344177136                        db  45h, 35h,   6, 53h, 44h, 17h, 71h, 36h
 10569 000074C4 2625521551344316                        db  26h, 25h, 52h, 15h, 51h, 34h, 43h, 16h
 10570 000074CC 6160055024423304                        db  61h, 60h,   5, 50h, 24h, 42h, 33h,   4
 10571 000074D4 1441402332031331                        db  14h, 41h, 40h, 23h, 32h,   3, 13h, 31h
 10572 000074DC 3022122102201101                        db  30h, 22h, 12h, 21h,   2, 20h, 11h,   1
 10573 000074E4 1000776776756647                        db  10h,   0, 77h, 67h, 76h, 75h, 66h, 47h
 10574 000074EC 7457555665377346                        db  74h, 57h, 55h, 56h, 65h, 37h, 73h, 46h
 10575 000074F4 4554355327726407                        db  45h, 54h, 35h, 53h, 27h, 72h, 64h,   7
 10576 000074FC 7117703663604425                        db  71h, 17h, 70h, 36h, 63h, 60h, 44h, 25h
 10577 00007504 5205156226061661                        db  52h,   5, 15h, 62h, 26h,   6, 16h, 61h
 10578 0000750C 5134504333244214                        db  51h, 34h, 50h, 43h, 33h, 24h, 42h, 14h
 10579 00007514 4104402332133103                        db  41h,   4, 40h, 23h, 32h, 13h, 31h,   3
 10580 0000751C 3022211202201101                        db  30h, 22h, 21h, 12h,   2, 20h, 11h,   1
 10581 00007524 1000776776577566                        db  10h,   0, 77h, 67h, 76h, 57h, 75h, 66h
 10582 0000752C 4774655637735527                        db  47h, 74h, 65h, 56h, 37h, 73h, 55h, 27h
 10583 00007534 7246641771077036                        db  72h, 46h, 64h, 17h, 71h,   7, 70h, 36h
 10584 0000753C 6345544406052662                        db  63h, 45h, 54h, 44h,   6,   5, 26h, 62h
 10585 00007544 6116603553255215                        db  61h, 16h, 60h, 35h, 53h, 25h, 52h, 15h
 10586 0000754C 5134435004244214                        db  51h, 34h, 43h, 50h,   4, 24h, 42h, 14h
 10587 00007554 3341233240033013                        db  33h, 41h, 23h, 32h, 40h,   3, 30h, 13h
 10588 0000755C 3122122102200011                        db  31h, 22h, 12h, 21h,   2, 20h,   0, 11h
 10589 00007564 0110FEFCFDEDFFEF                        db    1, 10h,0FEh,0FCh,0FDh,0EDh,0FFh,0EFh
 10590 0000756C DFEECFDEBFFBCEDC                        db 0DFh,0EEh,0CFh,0DEh,0BFh,0FBh,0CEh,0DCh
 10591 00007574 AFE9ECDDFACDBEEB                        db 0AFh,0E9h,0ECh,0DDh,0FAh,0CDh,0BEh,0EBh
 10592 0000757C 9FF9EABDDB8FF8CC                        db  9Fh,0F9h,0EAh,0BDh,0DBh, 8Fh,0F8h,0CCh
 10593 00007584 AE9E8E7F7EF7DAAD                        db 0AEh, 9Eh, 8Eh, 7Fh, 7Eh,0F7h,0DAh,0ADh
 10594 0000758C BCCBF66FE85F9DD9                        db 0BCh,0CBh,0F6h, 6Fh,0E8h, 5Fh, 9Dh,0D9h
 10595 00007594 F5E7ACBB4FF4CAE6                        db 0F5h,0E7h,0ACh,0BBh, 4Fh,0F4h,0CAh,0E6h
 10596 0000759C F33F8DD82FF26E9C                        db 0F3h, 3Fh, 8Dh,0D8h, 2Fh,0F2h, 6Eh, 9Ch
 10597 000075A4 0FC95EAB7DD74EC8                        db  0Fh,0C9h, 5Eh,0ABh, 7Dh,0D7h, 4Eh,0C8h
 10598 000075AC D63EB99BAA1FF1F0                        db 0D6h, 3Eh,0B9h, 9Bh,0AAh, 1Fh,0F1h,0F0h
 10599 000075B4 BAE5E48C6DE3E22E                        db 0BAh,0E5h,0E4h, 8Ch, 6Dh,0E3h,0E2h, 2Eh
 10600 000075BC 0E1EE1E05DD57CC7                        db  0Eh, 1Eh,0E1h,0E0h, 5Dh,0D5h, 7Ch,0C7h
 10601 000075C4 4D8BB8D49AA96CC6                        db  4Dh, 8Bh,0B8h,0D4h, 9Ah,0A9h, 6Ch,0C6h
 10602 000075CC 3DD37B2DD21DB75C                        db  3Dh,0D3h, 7Bh, 2Dh,0D2h, 1Dh,0B7h, 5Ch
 10603 000075D4 C5997AC3A7974BD1                        db 0C5h, 99h, 7Ah,0C3h,0A7h, 97h, 4Bh,0D1h
 10604 000075DC 0DD08AA84CC46BB6                        db  0Dh,0D0h, 8Ah,0A8h, 4Ch,0C4h, 6Bh,0B6h
 10605 000075E4 3C2CC25BB5891CC1                        db  3Ch, 2Ch,0C2h, 5Bh,0B5h, 89h, 1Ch,0C1h
 10606 000075EC 980CC0B46AA6793B                        db  98h, 0Ch,0C0h,0B4h, 6Ah,0A6h, 79h, 3Bh
 10607 000075F4 B3885A2BA569A478                        db 0B3h, 88h, 5Ah, 2Bh,0A5h, 69h,0A4h, 78h
 10608 000075FC 87947776B21BB10B                        db  87h, 94h, 77h, 76h,0B2h, 1Bh,0B1h, 0Bh
 10609 00007604 B0964A3AA359952A                        db 0B0h, 96h, 4Ah, 3Ah,0A3h, 59h, 95h, 2Ah
 10610 0000760C A21AA10A68A08649                        db 0A2h, 1Ah,0A1h, 0Ah, 68h,0A0h, 86h, 49h
 10611 00007614 9339588567299257                        db  93h, 39h, 58h, 85h, 67h, 29h, 92h, 57h
 10612 0000761C 7538836647745665                        db  75h, 38h, 83h, 66h, 47h, 74h, 56h, 65h
 10613 00007624 7319910990488472                        db  73h, 19h, 91h,   9, 90h, 48h, 84h, 72h
 10614 0000762C 4664288218372717                        db  46h, 64h, 28h, 82h, 18h, 37h, 27h, 17h
 10615 00007634 7155077036634554                        db  71h, 55h,   7, 70h, 36h, 63h, 45h, 54h
 10616 0000763C 2662358108801661                        db  26h, 62h, 35h, 81h,   8, 80h, 16h, 61h
 10617 00007644 0660534425520515                        db    6, 60h, 53h, 44h, 25h, 52h,   5, 15h
 10618 0000764C 5134435024423314                        db  51h, 34h, 43h, 50h, 24h, 42h, 33h, 14h
 10619 00007654 4104402332133103                        db  41h,   4, 40h, 23h, 32h, 13h, 31h,   3
 10620 0000765C 3022122102201101                        db  30h, 22h, 12h, 21h,   2, 20h, 11h,   1
 10621 00007664 1000FFEFFEDFEEFD                        db  10h,   0,0FFh,0EFh,0FEh,0DFh,0EEh,0FDh
 10622 0000766C CFFCDEEDBFFBCEEC                        db 0CFh,0FCh,0DEh,0EDh,0BFh,0FBh,0CEh,0ECh
 10623 00007674 DDAFFABEEBCDDC9F                        db 0DDh,0AFh,0FAh,0BEh,0EBh,0CDh,0DCh, 9Fh
 10624 0000767C F9EABDDB8FF8CC9E                        db 0F9h,0EAh,0BDh,0DBh, 8Fh,0F8h,0CCh, 9Eh
 10625 00007684 E97FF7ADDABC6FAE                        db 0E9h, 7Fh,0F7h,0ADh,0DAh,0BCh, 6Fh,0AEh
 10626 0000768C 0FCBF68EE85F9DF5                        db  0Fh,0CBh,0F6h, 8Eh,0E8h, 5Fh, 9Dh,0F5h
 10627 00007694 7EE7ACCABBD98D4F                        db  7Eh,0E7h,0ACh,0CAh,0BBh,0D9h, 8Dh, 4Fh
 10628 0000769C F43FF3D8E62FF26E                        db 0F4h, 3Fh,0F3h,0D8h,0E6h, 2Fh,0F2h, 6Eh
 10629 000076A4 F01FF19CC95EABBA                        db 0F0h, 1Fh,0F1h, 9Ch,0C9h, 5Eh,0ABh,0BAh
 10630 000076AC E57DD74EE48CC83E                        db 0E5h, 7Dh,0D7h, 4Eh,0E4h, 8Ch,0C8h, 3Eh
 10631 000076B4 6DD6E39BB92EAAE2                        db  6Dh,0D6h,0E3h, 9Bh,0B9h, 2Eh,0AAh,0E2h
 10632 000076BC 1EE10EE05DD57CC7                        db  1Eh,0E1h, 0Eh,0E0h, 5Dh,0D5h, 7Ch,0C7h
 10633 000076C4 4D8BD4B89AA96CC6                        db  4Dh, 8Bh,0D4h,0B8h, 9Ah,0A9h, 6Ch,0C6h
 10634 000076CC 3DD3D22D0D1D7BB7                        db  3Dh,0D3h,0D2h, 2Dh, 0Dh, 1Dh, 7Bh,0B7h
 10635 000076D4 D15CD0C58AA84CC4                        db 0D1h, 5Ch,0D0h,0C5h, 8Ah,0A8h, 4Ch,0C4h
 10636 000076DC 6BB6990C3CC37AA7                        db  6Bh,0B6h, 99h, 0Ch, 3Ch,0C3h, 7Ah,0A7h
 10637 000076E4 A6C00BC22C5BB51C                        db 0A6h,0C0h, 0Bh,0C2h, 2Ch, 5Bh,0B5h, 1Ch
 10638 000076EC 8998C14BB46A3B79                        db  89h, 98h,0C1h, 4Bh,0B4h, 6Ah, 3Bh, 79h
 10639 000076F4 B397882B5AB2A51B                        db 0B3h, 97h, 88h, 2Bh, 5Ah,0B2h,0A5h, 1Bh
 10640 000076FC B1B069964AA47887                        db 0B1h,0B0h, 69h, 96h, 4Ah,0A4h, 78h, 87h
 10641 00007704 3AA359952AA21AA1                        db  3Ah,0A3h, 59h, 95h, 2Ah,0A2h, 1Ah,0A1h
 10642 0000770C 0AA0688649943993                        db  0Ah,0A0h, 68h, 86h, 49h, 94h, 39h, 93h
 10643 00007714 7709588529677692                        db  77h,   9, 58h, 85h, 29h, 67h, 76h, 92h
 10644 0000771C 9119904884577538                        db  91h, 19h, 90h, 48h, 84h, 57h, 75h, 38h
 10645 00007724 8366472882188174                        db  83h, 66h, 47h, 28h, 82h, 18h, 81h, 74h
 10646 0000772C 0880566537734627                        db    8, 80h, 56h, 65h, 37h, 73h, 46h, 27h
 10647 00007734 7264175571077036                        db  72h, 64h, 17h, 55h, 71h,   7, 70h, 36h
 10648 0000773C 6345542662160660                        db  63h, 45h, 54h, 26h, 62h, 16h,   6, 60h
 10649 00007744 3561534425521551                        db  35h, 61h, 53h, 44h, 25h, 52h, 15h, 51h
 10650 0000774C 0550344324423341                        db    5, 50h, 34h, 43h, 24h, 42h, 33h, 41h
 10651 00007754 1404233240031331                        db  14h,   4, 23h, 32h, 40h,   3, 13h, 31h
 10652 0000775C 3022122102201101                        db  30h, 22h, 12h, 21h,   2, 20h, 11h,   1
 10653 00007764 1000EFFEDFFDCFFC                        db  10h,   0,0EFh,0FEh,0DFh,0FDh,0CFh,0FCh
 10654 0000776C BFFBAFFA9FF9F88F                        db 0BFh,0FBh,0AFh,0FAh, 9Fh,0F9h,0F8h, 8Fh
 10655 00007774 7FF76FF6FF5FF54F                        db  7Fh,0F7h, 6Fh,0F6h,0FFh, 5Fh,0F5h, 4Fh
 10656 0000777C F4F3F03FCEECDDDE                        db 0F4h,0F3h,0F0h, 3Fh,0CEh,0ECh,0DDh,0DEh
 10657 00007784 E9EAD9EEEDEBBECD                        db 0E9h,0EAh,0D9h,0EEh,0EDh,0EBh,0BEh,0CDh
 10658 0000778C DCDBAECCADDA7EAC                        db 0DCh,0DBh,0AEh,0CCh,0ADh,0DAh, 7Eh,0ACh
 10659 00007794 CAC97D5EBDF22F0F                        db 0CAh,0C9h, 7Dh, 5Eh,0BDh,0F2h, 2Fh, 0Fh
 10660 0000779C 1FF19EBCCB8EE89D                        db  1Fh,0F1h, 9Eh,0BCh,0CBh, 8Eh,0E8h, 9Dh
 10661 000077A4 E7BB8DD86EE69CAB                        db 0E7h,0BBh, 8Dh,0D8h, 6Eh,0E6h, 9Ch,0ABh
 10662 000077AC BAE5D74EE48CC83E                        db 0BAh,0E5h,0D7h, 4Eh,0E4h, 8Ch,0C8h, 3Eh
 10663 000077B4 6DD69BB9AAE1D4B8                        db  6Dh,0D6h, 9Bh,0B9h,0AAh,0E1h,0D4h,0B8h
 10664 000077BC A97BB7D0E30EE05D                        db 0A9h, 7Bh,0B7h,0D0h,0E3h, 0Eh,0E0h, 5Dh
 10665 000077C4 D57CC74D8B9A6CC6                        db 0D5h, 7Ch,0C7h, 4Dh, 8Bh, 9Ah, 6Ch,0C6h
 10666 000077CC 3D5CC50D8AA8994C                        db  3Dh, 5Ch,0C5h, 0Dh, 8Ah,0A8h, 99h, 4Ch
 10667 000077D4 B67A3C5B891CC098                        db 0B6h, 7Ah, 3Ch, 5Bh, 89h, 1Ch,0C0h, 98h
 10668 000077DC 79E22E1ED32DD2D1                        db  79h,0E2h, 2Eh, 1Eh,0D3h, 2Dh,0D2h,0D1h
 10669 000077E4 3B97881DC46BC3A7                        db  3Bh, 97h, 88h, 1Dh,0C4h, 6Bh,0C3h,0A7h
 10670 000077EC 2CC2B5C10C4BB46A                        db  2Ch,0C2h,0B5h,0C1h, 0Ch, 4Bh,0B4h, 6Ah
 10671 000077F4 A6B35AA52BB21BB1                        db 0A6h,0B3h, 5Ah,0A5h, 2Bh,0B2h, 1Bh,0B1h
 10672 000077FC 0BB069964AA47887                        db  0Bh,0B0h, 69h, 96h, 4Ah,0A4h, 78h, 87h
 10673 00007804 A33A592A9568A186                        db 0A3h, 3Ah, 59h, 2Ah, 95h, 68h,0A1h, 86h
 10674 0000780C 7794495767A21A0A                        db  77h, 94h, 49h, 57h, 67h,0A2h, 1Ah, 0Ah
 10675 00007814 A039935885299276                        db 0A0h, 39h, 93h, 58h, 85h, 29h, 92h, 76h
 10676 0000781C 0919919048847538                        db    9, 19h, 91h, 90h, 48h, 84h, 75h, 38h
 10677 00007824 8366288247741881                        db  83h, 66h, 28h, 82h, 47h, 74h, 18h, 81h
 10678 0000782C 8008563773654627                        db  80h,   8, 56h, 37h, 73h, 65h, 46h, 27h
 10679 00007834 7264550717717036                        db  72h, 64h, 55h,   7, 17h, 71h, 70h, 36h
 10680 0000783C 6345542662166106                        db  63h, 45h, 54h, 26h, 62h, 16h, 61h,   6
 10681 00007844 6053354425525115                        db  60h, 53h, 35h, 44h, 25h, 52h, 51h, 15h
 10682 0000784C 0534435024423314                        db    5, 34h, 43h, 50h, 24h, 42h, 33h, 14h
 10683 00007854 4104402332133103                        db  41h,   4, 40h, 23h, 32h, 13h, 31h,   3
 10684 0000785C 3022122102201101                        db  30h, 22h, 12h, 21h,   2, 20h, 11h,   1
 10685 00007864 1000EFFEDFFDCFFC                        db  10h,   0,0EFh,0FEh,0DFh,0FDh,0CFh,0FCh
 10686 0000786C BFFBFAAF9FF9F88F                        db 0BFh,0FBh,0FAh,0AFh, 9Fh,0F9h,0F8h, 8Fh
 10687 00007874 7FF76FF65FF54FF4                        db  7Fh,0F7h, 6Fh,0F6h, 5Fh,0F5h, 4Fh,0F4h
 10688 0000787C 3FF32FF2F11FF00F                        db  3Fh,0F3h, 2Fh,0F2h,0F1h, 1Fh,0F0h, 0Fh
 10689 00007884 EEDEEDCEECDDBEEB                        db 0EEh,0DEh,0EDh,0CEh,0ECh,0DDh,0BEh,0EBh
 10690 0000788C CDDCAEEABDDBCC9E                        db 0CDh,0DCh,0AEh,0EAh,0BDh,0DBh,0CCh, 9Eh
 10691 00007894 E9ADDABCCB8EE89D                        db 0E9h,0ADh,0DAh,0BCh,0CBh, 8Eh,0E8h, 9Dh
 10692 0000789C D97EE7ACFFCABB8D                        db 0D9h, 7Eh,0E7h,0ACh,0FFh,0CAh,0BBh, 8Dh
 10693 000078A4 D80EE00DE66E9CC9                        db 0D8h, 0Eh,0E0h, 0Dh,0E6h, 6Eh, 9Ch,0C9h
 10694 000078AC 5EBAE5AB7DD7E48C                        db  5Eh,0BAh,0E5h,0ABh, 7Dh,0D7h,0E4h, 8Ch
 10695 000078B4 C84E2E3E6DD6E39B                        db 0C8h, 4Eh, 2Eh, 3Eh, 6Dh,0D6h,0E3h, 9Bh
 10696 000078BC B9AAE21EE15DD57C                        db 0B9h,0AAh,0E2h, 1Eh,0E1h, 5Dh,0D5h, 7Ch
 10697 000078C4 C74D8BB8D49AA96C                        db 0C7h, 4Dh, 8Bh,0B8h,0D4h, 9Ah,0A9h, 6Ch
 10698 000078CC C63DD32DD21D7BB7                        db 0C6h, 3Dh,0D3h, 2Dh,0D2h, 1Dh, 7Bh,0B7h
 10699 000078D4 D15CC58AA8994CC4                        db 0D1h, 5Ch,0C5h, 8Ah,0A8h, 99h, 4Ch,0C4h
 10700 000078DC 6BB6D00C3CC37AA7                        db  6Bh,0B6h,0D0h, 0Ch, 3Ch,0C3h, 7Ah,0A7h
 10701 000078E4 2CC25BB51C8998C1                        db  2Ch,0C2h, 5Bh,0B5h, 1Ch, 89h, 98h,0C1h
 10702 000078EC 4BC00B3BB00A1AB4                        db  4Bh,0C0h, 0Bh, 3Bh,0B0h, 0Ah, 1Ah,0B4h
 10703 000078F4 6AA67997A00990B3                        db  6Ah,0A6h, 79h, 97h,0A0h,   9, 90h,0B3h
 10704 000078FC 882B5AB2A51BB169                        db  88h, 2Bh, 5Ah,0B2h,0A5h, 1Bh,0B1h, 69h
 10705 00007904 96A44A78873AA359                        db  96h,0A4h, 4Ah, 78h, 87h, 3Ah,0A3h, 59h
 10706 0000790C 952AA2A168867749                        db  95h, 2Ah,0A2h,0A1h, 68h, 86h, 77h, 49h
 10707 00007914 9439935885296776                        db  94h, 39h, 93h, 58h, 85h, 29h, 67h, 76h
 10708 0000791C 9219914884577538                        db  92h, 19h, 91h, 48h, 84h, 57h, 75h, 38h
 10709 00007924 8366288218477481                        db  83h, 66h, 28h, 82h, 18h, 47h, 74h, 81h
 10710 0000792C 0880566517077073                        db    8, 80h, 56h, 65h, 17h,   7, 70h, 73h
 10711 00007934 3727724664557136                        db  37h, 27h, 72h, 46h, 64h, 55h, 71h, 36h
 10712 0000793C 6345542662166106                        db  63h, 45h, 54h, 26h, 62h, 16h, 61h,   6
 10713 00007944 6035534425521505                        db  60h, 35h, 53h, 44h, 25h, 52h, 15h,   5
 10714 0000794C 5051344324423314                        db  50h, 51h, 34h, 43h, 24h, 42h, 33h, 14h
 10715 00007954 4104402332133103                        db  41h,   4, 40h, 23h, 32h, 13h, 31h,   3
 10716 0000795C 3022122102201101                        db  30h, 22h, 12h, 21h,   2, 20h, 11h,   1
 10717 00007964 10000B0F0D0E0705                        db  10h,   0, 0Bh, 0Fh, 0Dh, 0Eh,   7,   5
 10718 0000796C 0906030A0C020104                        db    9,   6,   3, 0Ah, 0Ch,   2,   1,   4
 10719 00007974 08000F0E0D0C0B0A                        db    8,   0, 0Fh, 0Eh, 0Dh, 0Ch, 0Bh, 0Ah
 10720 0000797C 0908070605040302                        db    9,   8,   7,   6,   5,   4,   3,   2
 10721 00007984 0100                                    db    1,   0
 10722 00007986 000000000000                            db 6 dup(0)
 10723 0000798C 0000                    mp3_huff_data   db   0,  0             
 10724 0000798E 0100                                    db   1,  0              ; byte[32][2] ; table,linbits
 10725 00007990 0200                                    db   2,  0
 10726 00007992 0300                                    db   3,  0
 10727 00007994 0000                                    db   0,  0
 10728 00007996 0400                                    db   4,  0
 10729 00007998 0500                                    db   5,  0
 10730 0000799A 0600                                    db   6,  0
 10731 0000799C 0700                                    db   7,  0
 10732 0000799E 0800                                    db   8,  0
 10733 000079A0 0900                                    db   9,  0
 10734 000079A2 0A00                                    db  10,  0
 10735 000079A4 0B00                                    db  11,  0
 10736 000079A6 0C00                                    db  12,  0
 10737 000079A8 0000                                    db   0,  0
 10738 000079AA 0D00                                    db  13,  0
 10739 000079AC 0E01                                    db  14,  1
 10740 000079AE 0E02                                    db  14,  2
 10741 000079B0 0E03                                    db  14,  3
 10742 000079B2 0E04                                    db  14,  4
 10743 000079B4 0E06                                    db  14,  6
 10744 000079B6 0E08                                    db  14,  8
 10745 000079B8 0E0A                                    db  14, 10
 10746 000079BA 0E0D                                    db  14, 13
 10747 000079BC 0F04                                    db  15,  4
 10748 000079BE 0F05                                    db  15,  5
 10749 000079C0 0F06                                    db  15,  6
 10750 000079C2 0F07                                    db  15,  7
 10751 000079C4 0F08                                    db  15,  8
 10752 000079C6 0F09                                    db  15,  9
 10753 000079C8 0F0B                                    db  15, 11
 10754 000079CA 0F0D                                    db  15, 13
 10755 000079CC 040404040404060608-     mp3_band_size_long db    4,   4,   4,   4,   4,   4,   6,   6,   8,   8, 0Ah
 10755 000079D5 080A               
 10756 000079D7 0C1014181C222A3236-                     db  0Ch, 10h, 14h, 18h, 1Ch, 22h, 2Ah, 32h, 36h, 4Ch, 9Eh ; byte[9][22]
 10756 000079E0 4C9E               
 10757 000079E2 040404040404060606-                     db    4,   4,   4,   4,   4,   4,   6,   6,   6,   8, 0Ah
 10757 000079EB 080A               
 10758 000079ED 0C1012161C22282E36-                     db  0Ch, 10h, 12h, 16h, 1Ch, 22h, 28h, 2Eh, 36h, 36h,0C0h
 10758 000079F6 36C0               
 10759 000079F8 040404040404060608-                     db    4,   4,   4,   4,   4,   4,   6,   6,   8, 0Ah, 0Ch
 10759 00007A01 0A0C               
 10760 00007A03 1014181E262E384454-                     db  10h, 14h, 18h, 1Eh, 26h, 2Eh, 38h, 44h, 54h, 66h, 1Ah
 10760 00007A0C 661A               
 10761 00007A0E 060606060606080A0C-                     db    6,   6,   6,   6,   6,   6,   8, 0Ah, 0Ch, 0Eh, 10h
 10761 00007A17 0E10               
 10762 00007A19 14181C20262E343C44-                     db  14h, 18h, 1Ch, 20h, 26h, 2Eh, 34h, 3Ch, 44h, 3Ah, 36h
 10762 00007A22 3A36               
 10763 00007A24 060606060606080A0C-                     db    6,   6,   6,   6,   6,   6,   8, 0Ah, 0Ch, 0Eh, 10h
 10763 00007A2D 0E10               
 10764 00007A2F 12161A20262E344046-                     db  12h, 16h, 1Ah, 20h, 26h, 2Eh, 34h, 40h, 46h, 4Ch, 24h
 10764 00007A38 4C24               
 10765 00007A3A 060606060606080A0C-                     db    6,   6,   6,   6,   6,   6,   8, 0Ah, 0Ch, 0Eh, 10h
 10765 00007A43 0E10               
 10766 00007A45 14181C20262E343C44-                     db  14h, 18h, 1Ch, 20h, 26h, 2Eh, 34h, 3Ch, 44h, 3Ah, 36h
 10766 00007A4E 3A36               
 10767 00007A50 060606060606080A0C-                     db    6,   6,   6,   6,   6,   6,   8, 0Ah, 0Ch, 0Eh, 10h
 10767 00007A59 0E10               
 10768 00007A5B 14181C20262E343C44-                     db  14h, 18h, 1Ch, 20h, 26h, 2Eh, 34h, 3Ch, 44h, 3Ah, 36h
 10768 00007A64 3A36               
 10769 00007A66 060606060606080A0C-                     db    6,   6,   6,   6,   6,   6,   8, 0Ah, 0Ch, 0Eh, 10h
 10769 00007A6F 0E10               
 10770 00007A71 14181C20262E343C44-                     db  14h, 18h, 1Ch, 20h, 26h, 2Eh, 34h, 3Ch, 44h, 3Ah, 36h
 10770 00007A7A 3A36               
 10771 00007A7C 0C0C0C0C0C0C101418-                     db  0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 10h, 14h, 18h, 1Ch, 20h
 10771 00007A85 1C20               
 10772 00007A87 283038404C5A020202-                     db  28h, 30h, 38h, 40h, 4Ch, 5Ah,   2,   2,   2,   2,   2
 10772 00007A90 0202               
 10773 00007A92 000000000000000000-                     db 10 dup(0)            ; data align
 10773 00007A9B 00                 
 10774 00007A9C 0404040406080A0C0E-     mp3_band_size_short db    4,   4,   4,   4,   6,   8, 0Ah, 0Ch, 0Eh, 12h, 16h, 1Eh, 38h
 10774 00007AA5 12161E38           
 10775 00007AA9 0404040406060A0C0E-                     db    4,   4,   4,   4,   6,   6, 0Ah, 0Ch, 0Eh, 10h, 14h, 1Ah, 42h ; byte[9][16] ? ; byte [9][13]
 10775 00007AB2 10141A42           
 10776 00007AB6 0404040406080C1014-                     db    4,   4,   4,   4,   6,   8, 0Ch, 10h, 14h, 1Ah, 22h, 2Ah, 0Ch
 10776 00007ABF 1A222A0C           
 10777 00007AC3 0404040606080A0E12-                     db    4,   4,   4,   6,   6,   8, 0Ah, 0Eh, 12h, 1Ah, 20h, 2Ah, 12h
 10777 00007ACC 1A202A12           
 10778 00007AD0 04040406080A0C0E12-                     db    4,   4,   4,   6,   8, 0Ah, 0Ch, 0Eh, 12h, 18h, 20h, 2Ch, 0Ch
 10778 00007AD9 18202C0C           
 10779 00007ADD 04040406080A0C0E12-                     db    4,   4,   4,   6,   8, 0Ah, 0Ch, 0Eh, 12h, 18h, 1Eh, 28h, 12h
 10779 00007AE6 181E2812           
 10780 00007AEA 04040406080A0C0E12-                     db    4,   4,   4,   6,   8, 0Ah, 0Ch, 0Eh, 12h, 18h, 1Eh, 28h, 12h
 10780 00007AF3 181E2812           
 10781 00007AF7 04040406080A0C0E12-                     db    4,   4,   4,   6,   8, 0Ah, 0Ch, 0Eh, 12h, 18h, 1Eh, 28h, 12h
 10781 00007B00 181E2812           
 10782 00007B04 0808080C1014181C24-                     db    8,   8,   8, 0Ch, 10h, 14h, 18h, 1Ch, 24h,   2,   2,   2, 1Ah
 10782 00007B0D 0202021A           
 10783 00007B11 000000000000000000-                     db 11 dup(0)            ; data align
 10783 00007B1A 0000               
 10784 00007B1C 000000000000000000-     mp3_pretab      db    0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0
 10784 00007B25 0000               
 10785 00007B27 000000000000000000-                     db    0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0
 10785 00007B30 0000               
 10786 00007B32 000000000000000000-                     db    0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0
 10786 00007B3B 0000               
 10787 00007B3D 010101010202030303-                     db    1,   1,   1,   1,   2,   2,   3,   3,   3,   2,   0
 10787 00007B46 0200               
 10788 00007B48 00000000                                db 4 dup(0)             ; data align
 10789 00007B4C 4B1D4200028FDB0016-     mp3_mdct_win_src dd  00421D4Bh, 00DB8F02h, 019C7F16h, 029ADCC0h, 04000001h, 06246711h
 10789 00007B55 7F9C01C0DC9A020100-
 10789 00007B5E 000411672406       
 10790 00007B64 4506EE090CD6A71238-                     dd  09EE0645h, 12A7D60Ch, 3DF40538h,0BC63D32Fh,0E7B0025Bh,0F069D222h ; these are sine values divided by cosine values...
 10790 00007B6D 05F43D2FD363BC5B02-
 10790 00007B76 B0E722D269F0       
 10791 00007B7C 567133F467D857F6A8-                     dd 0F4337156h,0F657D867h,0F7BCFBA8h,0F8BB5952h,0F97C4965h,0FA15BB1Ch
 10791 00007B85 FBBCF75259BBF86549-
 10791 00007B8E 7CF91CBB15FA       
 10792 00007B94 936D94FA8E5100FB70-                     dd 0FA946D93h,0FB00518Eh,0FB5EA270h,0FBB2FDEAh,0FC000000h,0FC479F38h
 10792 00007B9D A25EFBEAFDB2FB0000-
 10792 00007BA6 00FC389F47FC       
 10793 00007BAC 09668BFC9898CCFC0B-                     dd 0FC8B6609h,0FCCC9898h,0FD0C4F0Bh,0FD4B895Ch,0FD8B3FCFh,0FDCC725Eh
 10793 00007BB5 4F0CFD5C894BFDCF3F-
 10793 00007BBE 8BFD5E72CCFD       
 10794 00007BC4 2F3910FE67D857FE7D-                     dd 0FE10392Fh,0FE57D867h,0FEA4DA7Dh,0FEF935F7h,0FF5786D9h,0FFC36AD5h
 10794 00007BCD DAA4FEF735F9FED986-
 10794 00007BD6 57FFD56AC3FF       
 10795 00007BDC 4B1D4200028FDB0016-                     dd  00421D4Bh, 00DB8F02h, 019C7F16h, 029ADCC0h, 04000001h, 06246711h
 10795 00007BE5 7F9C01C0DC9A020100-
 10795 00007BEE 000411672406       
 10796 00007BF4 4506EE090CD6A71238-                     dd  09EE0645h, 12A7D60Ch, 3DF40538h,0BC63D32Fh,0E7B0025Bh,0F069D222h
 10796 00007BFD 05F43D2FD363BC5B02-
 10796 00007C06 B0E722D269F0       
 10797 00007C0C 567133F467D857F6A8-                     dd 0F4337156h,0F657D867h,0F7BCFBA8h,0F8BB5952h,0F97C4965h,0FA15BB1Ch
 10797 00007C15 FBBCF75259BBF86549-
 10797 00007C1E 7CF91CBB15FA       
 10798 00007C24 291B93FAB946F5FABB-                     dd 0FA931B29h,0FAF546B9h,0FB41DABBh,0FB7D8F97h,0FBABA162h,0FBCE4E62h
 10798 00007C2D DA41FB978F7DFB62A1-
 10798 00007C36 ABFB624ECEFB       
 10799 00007C3C 671CF0FBAFC845FC0D-                     dd 0FBF01C67h,0FC45C8AFh,0FCD2D50Dh,0FD9008D0h,0FE74C032h,0FF771894h
 10799 00007C45 D5D2FCD00890FD32C0-
 10799 00007C4E 74FE941877FF       
 10800 00007C54 000000000000000000-                     dd  00000000h, 00000000h, 00000000h, 00000000h, 00000000h, 00000000h
 10800 00007C5D 000000000000000000-
 10800 00007C66 000000000000       
 10801 00007C6C 028FDB00010000040C-                     dd  00DB8F02h, 04000001h, 12A7D60Ch,0E7B0025Bh,0F657D867h,0F97C4965h
 10801 00007C75 D6A7125B02B0E767D8-
 10801 00007C7E 57F665497CF9       
 10802 00007C84 8E5100FB000000FC98-                     dd 0FB00518Eh,0FC000000h,0FCCC9898h,0FD8B3FCFh,0FE57D867h,0FF5786D9h
 10802 00007C8D 98CCFCCF3F8BFD67D8-
 10802 00007C96 57FED98657FF       
 10803 00007C9C 000000000000000000-                     dd  00000000h, 00000000h, 00000000h, 00000000h, 00000000h, 00000000h
 10803 00007CA5 000000000000000000-
 10803 00007CAE 000000000000       
 10804 00007CB4 000000000000000000-                     dd  00000000h, 00000000h, 00000000h, 00000000h, 00000000h, 00000000h
 10804 00007CBD 000000000000000000-
 10804 00007CC6 000000000000       
 10805 00007CCC 000000000000000000-                     dd  00000000h, 00000000h, 00000000h, 00000000h, 00000000h, 00000000h
 10805 00007CD5 000000000000000000-
 10805 00007CDE 000000000000       
 10806 00007CE4 000000000000000000-                     dd  00000000h, 00000000h, 00000000h, 00000000h, 00000000h, 00000000h
 10806 00007CED 000000000000000000-
 10806 00007CF6 000000000000       
 10807 00007CFC 000000000000000000-                     dd  00000000h, 00000000h, 00000000h, 00000000h, 00000000h, 00000000h
 10807 00007D05 000000000000000000-
 10807 00007D0E 000000000000       
 10808 00007D14 B58869025237BA0B4F-                     dd  026988B5h, 0BBA3752h, 37D3294Fh,0B73F655Bh,0E3B0025Bh,0EDAD5D13h
 10808 00007D1D 29D3375B653FB75B02-
 10808 00007D26 B0E3135DADED       
 10809 00007D2C A2ADB2F2B8288CF5D6-                     dd 0F2B2ADA2h,0F58C28B8h,0F75657D6h,0F88E2C57h,0F96DE565h,0FA1449CDh
 10809 00007D35 5756F7572C8EF865E5-
 10809 00007D3E 6DF9CD4914FA       
 10810 00007D44 936D94FA8E5100FB70-                     dd 0FA946D93h,0FB00518Eh,0FB5EA270h,0FBB2FDEAh,0FC000000h,0FC479F38h
 10810 00007D4D A25EFBEAFDB2FB0000-
 10810 00007D56 00FC389F47FC       
 10811 00007D5C 09668BFC9898CCFC0B-                     dd 0FC8B6609h,0FCCC9898h,0FD0C4F0Bh,0FD4B895Ch,0FD8B3FCFh,0FDCC725Eh
 10811 00007D65 4F0CFD5C894BFDCF3F-
 10811 00007D6E 8BFD5E72CCFD       
 10812 00007D74 2F3910FE67D857FE7D-                     dd 0FE10392Fh,0FE57D867h,0FEA4DA7Dh,0FEF935F7h,0FF5786D9h,0FFC36AD5h
 10812 00007D7D DAA4FEF735F9FED986-
 10812 00007D86 57FFD56AC3FF       
 10813 00007D8C 0000000000000040        mp3_is_table_normal dd  00000000h, 40000000h
 10814 00007D94 BB58860D46A77932                        dd  0D8658BBh, 3279A746h
 10815 00007D9C D1F56C17300A9328                        dd  176CF5D1h, 28930A30h
 10816 00007DA4 0000002000000020                        dd  20000000h, 20000000h
 10817 00007DAC 300A9328D1F56C17                        dd  28930A30h, 176CF5D1h
 10818 00007DB4 46A77932BB58860D                        dd  3279A746h, 0D8658BBh
 10819 00007DBC 0000004000000000                        dd  40000000h, 00000000h
 10820 00007DC4 00000080                mp3_is_table_lsf_src dd 80000000h      
 10821                                                                          ; sqrt based constants...
 10822                                                                          ; 40000000h*2 ; 2.0  (2^1.00) aka 2
 10823 00007DC8 667EA26B                                dd 6BA27E66h            ; 35D13F33h*2 ; 1.681 (2^0.75)
 10824 00007DCC 9A79825A                                dd 5A82799Ah            ; 2D413CCDh*2 ; 1.414 (2^0.50) aka sqrt(2)
 10825 00007DD0 2AF81B4C                                dd 4C1BF82Ah            ; 260DFC15h*2 ; 1.189 (2^0.25) aka sqrt(sqrt(2))
 10826 00007DD4 00000080                mp3_pow2_quarters dd 80000000h         
 10827                                                                          ; 40000000h*2 ; 2^(0/4)
 10828 00007DD8 52F03798                                dd 9837F052h            ; 4C1BF829h*2 ; 2^(1/4)
 10829 00007DDC 34F304B5                                dd 0B504F334h           ; 5A82799Ah*2 ; 2^(2/4)
 10830 00007DE0 CCFC44D7                                dd 0D744FCCCh           ; 6BA27E66h*2 ; 2^(3/4)
 10831 00007DE4 00000000                mp3_initialized dd 0                   
 10832 00007DE8 12000000                mp3_huff_num_entries dd 12h            
 10833 00007DEC 00                      wrchr_buf       db 0                   
 10834 00007DED 90<rep 3h>                              align 4
 10835                                  ; LPCSTR mp3_src_fname
 10836 00007DF0 00000000                mp3_src_fname   dd 0                   
 10837                                  ; LPCSTR mp3_dst_fname
 10838 00007DF4 00000000                mp3_dst_fname   dd 0                   
 10839                                  ; LPCSTR mp3_pcm_fname
 10840 00007DF8 00000000                mp3_pcm_fname   dd 0                   
 10841 00007DFC 524946462400000057-     mp3_wav_header  db 'RIFF$',0,0,0,'WAVEfmt ',10h,0,0,0,1,0,2,0,0,0,0,0,0,0,0,0,4,0,10h,0,'data',0,0,0,0
 10841 00007E05 415645666D74201000-
 10841 00007E0E 000001000200000000-
 10841 00007E17 000000000004001000-
 10841 00007E20 6461746100000000   
 10842                                  ; 21/10/2024                   
 10843 00007E28 00000000                zero		dd 0  
 10844 00007E2C 00                      num_enqueued_frames db 0
 10845 00007E2D 617564696F20647572-     txt_decode_timing1 db 'audio duration ',0
 10845 00007E36 6174696F6E2000     
 10846 00007E3D 206D696C6C69736563-     txt_decode_timing2 db ' milliseconds, decoded in ',0
 10846 00007E46 6F6E64732C20646563-
 10846 00007E4F 6F64656420696E2000 
 10847 00007E58 206D696C6C69736563-     txt_decode_timing3 db ' milliseconds',0Dh,0Ah,0
 10847 00007E61 6F6E64730D0A00     
 10848 00007E68 20636C6F636B206379-     txt_clks_per_second db ' clock cycles per second:',0Dh,0Ah,0
 10848 00007E71 636C65732070657220-
 10848 00007E7A 7365636F6E643A0D0A-
 10848 00007E83 00                 
 10849 00007E84 0303020106060505        huff_tree_list_numbits db    3,   3,   2,   1,   6,   6,   5,   5
 10850 00007E8C 0503030301060605                        db    5,   3,   3,   3,   1,   6,   6,   5
 10851 00007E94 0505030202020808                        db    5,   5,   3,   2,   2,   2,   8,   8
 10852 00007E9C 0706070707070606                        db    7,   6,   7,   7,   7,   7,   6,   6
 10853 00007EA4 0606030303010707                        db    6,   6,   3,   3,   3,   1,   7,   7
 10854 00007EAC 0606060505050504                        db    6,   6,   6,   5,   5,   5,   5,   4
 10855 00007EB4 0404030203030A0A                        db    4,   4,   3,   2,   3,   3, 0Ah, 0Ah
 10856 00007EBC 0A0A090909090808                        db  0Ah, 0Ah,   9,   9,   9,   9,   8,   8
 10857 00007EC4 0909080909080807                        db    9,   9,   8,   9,   9,   8,   8,   7
 10858 00007ECC 0707080808080707                        db    7,   7,   8,   8,   8,   8,   7,   7
 10859 00007ED4 0707060506060403                        db    7,   7,   6,   5,   6,   6,   4,   3
 10860 00007EDC 03010B0B0A090A0A                        db    3,   1, 0Bh, 0Bh, 0Ah,   9, 0Ah, 0Ah
 10861 00007EE4 0909090808090909                        db    9,   9,   9,   8,   8,   9,   9,   9
 10862 00007EEC 0908080807080808                        db    9,   8,   8,   8,   7,   8,   8,   8
 10863 00007EF4 0808080808060606                        db    8,   8,   8,   8,   8,   6,   6,   6
 10864 00007EFC 0404020303020909                        db    4,   4,   2,   3,   3,   2,   9,   9
 10865 00007F04 0808090908080808                        db    8,   8,   9,   9,   8,   8,   8,   8
 10866 00007F0C 0707070808070707                        db    7,   7,   7,   8,   8,   7,   7,   7
 10867 00007F14 0706060606050506                        db    7,   6,   6,   6,   6,   5,   5,   6
 10868 00007F1C 0605050404040303                        db    6,   5,   5,   4,   4,   4,   3,   3
 10869 00007F24 03030B0B0B0B0B0B                        db    3,   3, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh
 10870 00007F2C 0A0A0A0A0A0A0A0B                        db  0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Bh
 10871 00007F34 0B0A09090A0A0909                        db  0Bh, 0Ah,   9,   9, 0Ah, 0Ah,   9,   9
 10872 00007F3C 0A0A090A0A080809                        db  0Ah, 0Ah,   9, 0Ah, 0Ah,   8,   8,   9
 10873 00007F44 090A0A09090A0A08                        db    9, 0Ah, 0Ah,   9,   9, 0Ah, 0Ah,   8
 10874 00007F4C 0808090909090909                        db    8,   8,   9,   9,   9,   9,   9,   9
 10875 00007F54 0808080808080707                        db    8,   8,   8,   8,   8,   8,   7,   7
 10876 00007F5C 0707060606060403                        db    7,   7,   6,   6,   6,   6,   4,   3
 10877 00007F64 03010A0A0A0A0A0A                        db    3,   1, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah
 10878 00007F6C 0A0B0B0A0A090909                        db  0Ah, 0Bh, 0Bh, 0Ah, 0Ah,   9,   9,   9
 10879 00007F74 0A0A0A0A08080909                        db  0Ah, 0Ah, 0Ah, 0Ah,   8,   8,   9,   9
 10880 00007F7C 0708080808080909                        db    7,   8,   8,   8,   8,   8,   9,   9
 10881 00007F84 0909080708080707                        db    9,   9,   8,   7,   8,   8,   7,   7
 10882 00007F8C 0808080909080808                        db    8,   8,   8,   9,   9,   8,   8,   8
 10883 00007F94 0808080707060607                        db    8,   8,   8,   7,   7,   6,   6,   7
 10884 00007F9C 0706050405050303                        db    7,   6,   5,   4,   5,   5,   3,   3
 10885 00007FA4 03020A0A09090909                        db    3,   2, 0Ah, 0Ah,   9,   9,   9,   9
 10886 00007FAC 0909090808090908                        db    9,   9,   9,   8,   8,   9,   9,   8
 10887 00007FB4 0808080808090908                        db    8,   8,   8,   8,   8,   9,   9,   8
 10888 00007FBC 0808080809090707                        db    8,   8,   8,   8,   9,   9,   7,   7
 10889 00007FC4 0708080808080807                        db    7,   8,   8,   8,   8,   8,   8,   7
 10890 00007FCC 0707070808070707                        db    7,   7,   7,   8,   8,   7,   7,   7
 10891 00007FD4 0606060607070605                        db    6,   6,   6,   6,   7,   7,   6,   5
 10892 00007FDC 0505040405050403                        db    5,   5,   4,   4,   5,   5,   4,   3
 10893 00007FE4 0303131312111010                        db    3,   3, 13h, 13h, 12h, 11h, 10h, 10h
 10894 00007FEC 1010101010101010                        db  10h, 10h, 10h, 10h, 10h, 10h, 10h, 10h
 10895 00007FF4 11110F0F10100F0F                        db  11h, 11h, 0Fh, 0Fh, 10h, 10h, 0Fh, 0Fh
 10896 00007FFC 0F0F0F0F0F0F0F0F                        db  0Fh, 0Fh, 0Fh, 0Fh, 0Fh, 0Fh, 0Fh, 0Fh
 10897 00008004 10100F10100E0E0F                        db  10h, 10h, 0Fh, 10h, 10h, 0Eh, 0Eh, 0Fh
 10898 0000800C 0F0F0F0E0E0E0E0E                        db  0Fh, 0Fh, 0Fh, 0Eh, 0Eh, 0Eh, 0Eh, 0Eh
 10899 00008014 0E0E0E0E0E0E0F0F                        db  0Eh, 0Eh, 0Eh, 0Eh, 0Eh, 0Eh, 0Fh, 0Fh
 10900 0000801C 0E0D0E0E0D0D0E0E                        db  0Eh, 0Dh, 0Eh, 0Eh, 0Dh, 0Dh, 0Eh, 0Eh
 10901 00008024 0D0E0E0D0E0E0D0E                        db  0Dh, 0Eh, 0Eh, 0Dh, 0Eh, 0Eh, 0Dh, 0Eh
 10902 0000802C 0E0D0D0E0E0C0C0C                        db  0Eh, 0Dh, 0Dh, 0Eh, 0Eh, 0Ch, 0Ch, 0Ch
 10903 00008034 0D0D0D0D0D0D0C0D                        db  0Dh, 0Dh, 0Dh, 0Dh, 0Dh, 0Dh, 0Ch, 0Dh
 10904 0000803C 0D0C0C0D0D0D0D0D                        db  0Dh, 0Ch, 0Ch, 0Dh, 0Dh, 0Dh, 0Dh, 0Dh
 10905 00008044 0D0D0D0D0D0D0D0C                        db  0Dh, 0Dh, 0Dh, 0Dh, 0Dh, 0Dh, 0Dh, 0Ch
 10906 0000804C 0C0D0D0C0C0C0C0D                        db  0Ch, 0Dh, 0Dh, 0Ch, 0Ch, 0Ch, 0Ch, 0Dh
 10907 00008054 0D0D0D0C0D0D0C0B                        db  0Dh, 0Dh, 0Dh, 0Ch, 0Dh, 0Dh, 0Ch, 0Bh
 10908 0000805C 0C0C0C0C0C0C0C0C                        db  0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch
 10909 00008064 0B0B0B0B0C0C0B0B                        db  0Bh, 0Bh, 0Bh, 0Bh, 0Ch, 0Ch, 0Bh, 0Bh
 10910 0000806C 0C0C0B0C0C0C0C0B                        db  0Ch, 0Ch, 0Bh, 0Ch, 0Ch, 0Ch, 0Ch, 0Bh
 10911 00008074 0B0C0C0B0C0C0B0C                        db  0Bh, 0Ch, 0Ch, 0Bh, 0Ch, 0Ch, 0Bh, 0Ch
 10912 0000807C 0C0B0C0C0A0A0A0B                        db  0Ch, 0Bh, 0Ch, 0Ch, 0Ah, 0Ah, 0Ah, 0Bh
 10913 00008084 0B0B0B0B0B0B0B0A                        db  0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Ah
 10914 0000808C 0A0A0A0B0B0A0B0B                        db  0Ah, 0Ah, 0Ah, 0Bh, 0Bh, 0Ah, 0Bh, 0Bh
 10915 00008094 0A0B0B0B0B0A0A0B                        db  0Ah, 0Bh, 0Bh, 0Bh, 0Bh, 0Ah, 0Ah, 0Bh
 10916 0000809C 0B0A0A0B0B0B0B0B                        db  0Bh, 0Ah, 0Ah, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh
 10917 000080A4 0B09090A0A0A0A0A                        db  0Bh,   9,   9, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah
 10918 000080AC 0B0B0909090A0A09                        db  0Bh, 0Bh,   9,   9,   9, 0Ah, 0Ah,   9
 10919 000080B4 090A0A0A0A0A0A0A                        db    9, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah
 10920 000080BC 0A0A0A0809090909                        db  0Ah, 0Ah, 0Ah,   8,   9,   9,   9,   9
 10921 000080C4 09090A0A09090908                        db    9,   9, 0Ah, 0Ah,   9,   9,   9,   8
 10922 000080CC 0809090909090908                        db    8,   9,   9,   9,   9,   9,   9,   8
 10923 000080D4 0708080808070707                        db    7,   8,   8,   8,   8,   7,   7,   7
 10924 000080DC 0707060606060404                        db    7,   7,   6,   6,   6,   6,   4,   4
 10925 000080E4 03010D0D0D0D0C0D                        db    3,   1, 0Dh, 0Dh, 0Dh, 0Dh, 0Ch, 0Dh
 10926 000080EC 0D0D0D0D0D0C0D0D                        db  0Dh, 0Dh, 0Dh, 0Dh, 0Dh, 0Ch, 0Dh, 0Dh
 10927 000080F4 0C0C0C0C0C0C0C0C                        db  0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch
 10928 000080FC 0C0C0C0C0C0C0C0C                        db  0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch
 10929 00008104 0C0C0C0C0C0C0C0D                        db  0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Dh
 10930 0000810C 0D0B0B0C0C0C0C0B                        db  0Dh, 0Bh, 0Bh, 0Ch, 0Ch, 0Ch, 0Ch, 0Bh
 10931 00008114 0B0B0B0B0B0C0C0B                        db  0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Ch, 0Ch, 0Bh
 10932 0000811C 0B0B0B0B0B0B0B0C                        db  0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Ch
 10933 00008124 0C0B0B0B0B0B0B0B                        db  0Ch, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh
 10934 0000812C 0B0B0B0B0B0B0B0B                        db  0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh
 10935 00008134 0B0B0B0B0B0B0B0B                        db  0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh
 10936 0000813C 0B0B0C0C0B0B0B0B                        db  0Bh, 0Bh, 0Ch, 0Ch, 0Bh, 0Bh, 0Bh, 0Bh
 10937 00008144 0B0B0A0B0B0B0B0B                        db  0Bh, 0Bh, 0Ah, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh
 10938 0000814C 0B0A0A0B0B0A0A0A                        db  0Bh, 0Ah, 0Ah, 0Bh, 0Bh, 0Ah, 0Ah, 0Ah
 10939 00008154 0A0B0B0A0A0A0A0A                        db  0Ah, 0Bh, 0Bh, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah
 10940 0000815C 0A0A0B0B0A0A0A0A                        db  0Ah, 0Ah, 0Bh, 0Bh, 0Ah, 0Ah, 0Ah, 0Ah
 10941 00008164 0A0B0B090A0A0A0A                        db  0Ah, 0Bh, 0Bh,   9, 0Ah, 0Ah, 0Ah, 0Ah
 10942 0000816C 0A0A0A0A0A0A0A0A                        db  0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah
 10943 00008174 090A0A0A0A090A0A                        db    9, 0Ah, 0Ah, 0Ah, 0Ah,   9, 0Ah, 0Ah
 10944 0000817C 090A0A0A0A0A0A0A                        db    9, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah
 10945 00008184 0A09090909090909                        db  0Ah,   9,   9,   9,   9,   9,   9,   9
 10946 0000818C 0A0A090909090909                        db  0Ah, 0Ah,   9,   9,   9,   9,   9,   9
 10947 00008194 0A0A090909090909                        db  0Ah, 0Ah,   9,   9,   9,   9,   9,   9
 10948 0000819C 0809090909090909                        db    8,   9,   9,   9,   9,   9,   9,   9
 10949 000081A4 0909090808080809                        db    9,   9,   9,   8,   8,   8,   8,   9
 10950 000081AC 0909090909090908                        db    9,   9,   9,   9,   9,   9,   9,   8
 10951 000081B4 0808080808090908                        db    8,   8,   8,   8,   8,   9,   9,   8
 10952 000081BC 0808080808080909                        db    8,   8,   8,   8,   8,   8,   9,   9
 10953 000081C4 0807080807070707                        db    8,   7,   8,   8,   7,   7,   7,   7
 10954 000081CC 0808070707070706                        db    8,   8,   7,   7,   7,   7,   7,   6
 10955 000081D4 0707060607070606                        db    7,   7,   6,   6,   7,   7,   6,   6
 10956 000081DC 0605050505050304                        db    6,   5,   5,   5,   5,   5,   3,   4
 10957 000081E4 04030B0B0B0B0B0B                        db    4,   3, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh
 10958 000081EC 0B0B0A0B0B0B0B0A                        db  0Bh, 0Bh, 0Ah, 0Bh, 0Bh, 0Bh, 0Bh, 0Ah
 10959 000081F4 0A0A0A0A080A0A09                        db  0Ah, 0Ah, 0Ah, 0Ah,   8, 0Ah, 0Ah,   9
 10960 000081FC 0909090A1011110F                        db    9,   9,   9, 0Ah, 10h, 11h, 11h, 0Fh
 10961 00008204 0F10100E0F0F0E0E                        db  0Fh, 10h, 10h, 0Eh, 0Fh, 0Fh, 0Eh, 0Eh
 10962 0000820C 0F0F0E0E0F0F0F0F                        db  0Fh, 0Fh, 0Eh, 0Eh, 0Fh, 0Fh, 0Fh, 0Fh
 10963 00008214 0E0F0F0E0D080909                        db  0Eh, 0Fh, 0Fh, 0Eh, 0Dh,   8,   9,   9
 10964 0000821C 08080D0E0E0E0E0E                        db    8,   8, 0Dh, 0Eh, 0Eh, 0Eh, 0Eh, 0Eh
 10965 00008224 0E0E0E0E0E0D0D0E                        db  0Eh, 0Eh, 0Eh, 0Eh, 0Eh, 0Dh, 0Dh, 0Eh
 10966 0000822C 0E0E0E0D0E0E0D0D                        db  0Eh, 0Eh, 0Eh, 0Dh, 0Eh, 0Eh, 0Dh, 0Dh
 10967 00008234 0D0E0E0E0E0D0D0E                        db  0Dh, 0Eh, 0Eh, 0Eh, 0Eh, 0Dh, 0Dh, 0Eh
 10968 0000823C 0E0D0E0E0C0D0D0D                        db  0Eh, 0Dh, 0Eh, 0Eh, 0Ch, 0Dh, 0Dh, 0Dh
 10969 00008244 0D0D0D0D0D0D0D0D                        db  0Dh, 0Dh, 0Dh, 0Dh, 0Dh, 0Dh, 0Dh, 0Dh
 10970 0000824C 0D0D0D0C0D0D0D0D                        db  0Dh, 0Dh, 0Dh, 0Ch, 0Dh, 0Dh, 0Dh, 0Dh
 10971 00008254 0D0D0C0D0D0C0C0D                        db  0Dh, 0Dh, 0Ch, 0Dh, 0Dh, 0Ch, 0Ch, 0Dh
 10972 0000825C 0D0B0C0C0C0C0C0C                        db  0Dh, 0Bh, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch
 10973 00008264 0C0D0D0B0C0C0C0C                        db  0Ch, 0Dh, 0Dh, 0Bh, 0Ch, 0Ch, 0Ch, 0Ch
 10974 0000826C 0B0C0C0C0C0C0C0C                        db  0Bh, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch
 10975 00008274 0C0B0C0C0B0B0B0B                        db  0Ch, 0Bh, 0Ch, 0Ch, 0Bh, 0Bh, 0Bh, 0Bh
 10976 0000827C 0C0C0C0C0C0C0C0C                        db  0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch
 10977 00008284 0B0C0C0B0C0C0B0C                        db  0Bh, 0Ch, 0Ch, 0Bh, 0Ch, 0Ch, 0Bh, 0Ch
 10978 0000828C 0C0B0C0C0B0A0A0B                        db  0Ch, 0Bh, 0Ch, 0Ch, 0Bh, 0Ah, 0Ah, 0Bh
 10979 00008294 0B0B0B0B0B0A0A0B                        db  0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Ah, 0Ah, 0Bh
 10980 0000829C 0B0A0A0B0B0B0B0B                        db  0Bh, 0Ah, 0Ah, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh
 10981 000082A4 0B0B0B0A0B0B0A0A                        db  0Bh, 0Bh, 0Bh, 0Ah, 0Bh, 0Bh, 0Ah, 0Ah
 10982 000082AC 0A0B0B0A0A0B0B0A                        db  0Ah, 0Bh, 0Bh, 0Ah, 0Ah, 0Bh, 0Bh, 0Ah
 10983 000082B4 0A0B0B0A09090A0A                        db  0Ah, 0Bh, 0Bh, 0Ah,   9,   9, 0Ah, 0Ah
 10984 000082BC 0A0A0A0A0909090A                        db  0Ah, 0Ah, 0Ah, 0Ah,   9,   9,   9, 0Ah
 10985 000082C4 0A090A0A09090809                        db  0Ah,   9, 0Ah, 0Ah,   9,   9,   8,   9
 10986 000082CC 0909090909090908                        db    9,   9,   9,   9,   9,   9,   9,   8
 10987 000082D4 0809090808070708                        db    8,   9,   9,   8,   8,   7,   7,   8
 10988 000082DC 0807060606060404                        db    8,   7,   6,   6,   6,   6,   4,   4
 10989 000082E4 0301080808080808                        db    3,   1,   8,   8,   8,   8,   8,   8
 10990 000082EC 0808070808070708                        db    8,   8,   7,   8,   8,   7,   7,   8
 10991 000082F4 0807070707070707                        db    8,   7,   7,   7,   7,   7,   7,   7
 10992 000082FC 0707070707080809                        db    7,   7,   7,   7,   7,   8,   8,   9
 10993 00008304 0B0B0B0B0B0B0B0B                        db  0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh
 10994 0000830C 0B0B0B0B0B0B0B0B                        db  0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh
 10995 00008314 0B0B0B0B0B0B0B0B                        db  0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh
 10996 0000831C 0B0B0B0B040B0B0B                        db  0Bh, 0Bh, 0Bh, 0Bh,   4, 0Bh, 0Bh, 0Bh
 10997 00008324 0B0C0C0B0A0B0B0A                        db  0Bh, 0Ch, 0Ch, 0Bh, 0Ah, 0Bh, 0Bh, 0Ah
 10998 0000832C 0A0A0A0B0B0A0A0A                        db  0Ah, 0Ah, 0Ah, 0Bh, 0Bh, 0Ah, 0Ah, 0Ah
 10999 00008334 0A0B0B0A0A0A0A0A                        db  0Ah, 0Bh, 0Bh, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah
 11000 0000833C 0A0A0A0A0A0A0A0A                        db  0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah
 11001 00008344 0A0A0A0A0A0A0A0A                        db  0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah
 11002 0000834C 0A0A0A0A0A0A0A0A                        db  0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah
 11003 00008354 0A0A0A0A0A0A0A0A                        db  0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah
 11004 0000835C 0A0A0B0B0A0A0A0A                        db  0Ah, 0Ah, 0Bh, 0Bh, 0Ah, 0Ah, 0Ah, 0Ah
 11005 00008364 0A0A0A0A0A0A0A0A                        db  0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah
 11006 0000836C 0A0B0B0A0B0B0A09                        db  0Ah, 0Bh, 0Bh, 0Ah, 0Bh, 0Bh, 0Ah,   9
 11007 00008374 0A0A0A0A0B0B0A09                        db  0Ah, 0Ah, 0Ah, 0Ah, 0Bh, 0Bh, 0Ah,   9
 11008 0000837C 090A0A090A0A0A0A                        db    9, 0Ah, 0Ah,   9, 0Ah, 0Ah, 0Ah, 0Ah
 11009 00008384 09090A0A09090909                        db    9,   9, 0Ah, 0Ah,   9,   9,   9,   9
 11010 0000838C 0909090909090909                        db    9,   9,   9,   9,   9,   9,   9,   9
 11011 00008394 0909090909090909                        db    9,   9,   9,   9,   9,   9,   9,   9
 11012 0000839C 0909090909090909                        db    9,   9,   9,   9,   9,   9,   9,   9
 11013 000083A4 0909090909090909                        db    9,   9,   9,   9,   9,   9,   9,   9
 11014 000083AC 0A0A0909090A0A08                        db  0Ah, 0Ah,   9,   9,   9, 0Ah, 0Ah,   8
 11015 000083B4 0909080808080808                        db    9,   9,   8,   8,   8,   8,   8,   8
 11016 000083BC 0808080808080809                        db    8,   8,   8,   8,   8,   8,   8,   9
 11017 000083C4 0908080808080809                        db    9,   8,   8,   8,   8,   8,   8,   9
 11018 000083CC 0907080807070707                        db    9,   7,   8,   8,   7,   7,   7,   7
 11019 000083D4 0708080707060607                        db    7,   8,   8,   7,   7,   6,   6,   7
 11020 000083DC 0706050506060404                        db    7,   6,   5,   5,   6,   6,   4,   4
 11021 000083E4 0404060606060606                        db    4,   4,   6,   6,   6,   6,   6,   6
 11022 000083EC 0505050505040404                        db    5,   5,   5,   5,   5,   4,   4,   4
 11023 000083F4 0401040404040404                        db    4,   1,   4,   4,   4,   4,   4,   4
 11024 000083FC 0404040404040404                        db    4,   4,   4,   4,   4,   4,   4,   4
 11025 00008404 0404                                    db    4,   4
 11026 00008406 03                      _@@const_3      db 3                   
 11027 00008407 000000                                  db 3 dup(0)
 11028 0000840A [AC470000]              mp3_synth_filter_procs dd synth_16bit_shift_0_slow ; SYNTH_MACRO 0,0,0
 11029 0000840E [984A0000]                              dd synth_16bit_shift_1_slow ; SYNTH_MACRO 0,1,0
 11030 00008412 [8A4D0000]                              dd synth_16bit_shift_2_slow ; SYNTH_MACRO 0,2,0
 11031 00008416 [7C500000]                              dd synth_8bit_shift_0_slow ; SYNTH_MACRO 1,0,0
 11032 0000841A [5D530000]                              dd synth_8bit_shift_1_slow ; SYNTH_MACRO 1,1,0
 11033 0000841E [44560000]                              dd synth_8bit_shift_2_slow ; SYNTH_MACRO 1,2,0
 11034 00008422 [6D350000]                              dd synth_16bit_shift_0_fast ; SYNTH_MACRO 0,0,1
 11035 00008426 [79380000]                              dd synth_16bit_shift_1_fast ; SYNTH_MACRO 0,1,1
 11036 0000842A [8B3B0000]                              dd synth_16bit_shift_2_fast ; SYNTH_MACRO 0,2,1
 11037 0000842E [9D3E0000]                              dd synth_8bit_shift_0_fast ; SYNTH_MACRO 1,0,1
 11038 00008432 [9E410000]                              dd synth_8bit_shift_1_fast ; SYNTH_MACRO 1,1,1
 11039 00008436 [A5440000]                              dd synth_8bit_shift_2_fast ; SYNTH_MACRO 1,2,1
 11040                                  ;txt_hello      db 'nocash mp3 decoder v1.4, 2024 martin korth, press ctrl+c to quit,'
 11041                                  ;               db ' BDS now',0Dh,0Ah,0
 11042                                  ; Erdogan Tan - 17/10/2024
 11043 0000843A 0D0A                    txt_hello       db 13,10
 11044                                  		;db 'NOCASH MP3 PLAYER v1.4 for Windows ',0
 11045                                  		; 09/01/2025
 11046 0000843C 4E4F43415348204D50-     		db 'NOCASH MP3 PLAYER v1.0 for TRDOS386 ',0
 11046 00008445 3320504C4159455220-
 11046 0000844E 76312E3020666F7220-
 11046 00008457 5452444F5333383620-
 11046 00008460 00                 
 11047                                  		 
 11048 00008461 66696C653A2000          txt_file        db 'file: ',0          
 11049 00008468 66696C652073697A65-     txt_file_size   db 'file size: ',0     
 11049 00008471 3A2000             
 11050 00008474 2C206964332073697A-     txt_id3_size    db ', id3 size: ',0    
 11050 0000847D 653A2000           
 11051 00008481 2C207461672073697A-     txt_tag_size    db ', tag size: ',0    
 11051 0000848A 653A2000           
 11052 0000848E 696E7075743A2000        txt_input       db 'input: ',0         
 11053 00008496 6F75747075743A2000      txt_output      db 'output: ',0        
 11054 0000849F 20687A2C2000            txt_hz          db ' hz, ',0           
 11055 000084A5 206368616E6E656C73-     txt_channels    db ' channels, ',0     
 11055 000084AE 2C2000             
 11056 000084B1 2062697400              txt_bit         db ' bit',0            
 11057 000084B6 206B6269742F7300        txt_kbit_s      db ' kbit/s',0         
 11058 000084BE 63616E6E6F74206F70-     txt_not_found   db 'cannot open source file',0Dh,0Ah,0
 11058 000084C7 656E20736F75726365-
 11058 000084D0 2066696C650D0A00   
 11059 000084D8 75736167653A206D70-     txt_help        db 'usage: mp3play input.mp3 [output.wav] [verify.pcm] [/test]', 0Dh,0Ah
 11059 000084E1 33706C617920696E70-
 11059 000084EA 75742E6D7033205B6F-
 11059 000084F3 75747075742E776176-
 11059 000084FC 5D205B766572696679-
 11059 00008505 2E70636D5D205B2F74-
 11059 0000850E 6573745D0D0A       
 11060 00008514 202020202020202020-                     db '                         [/mono] [/8bit] [/fast] [/half|/quarter]',0Dh,0Ah,0
 11060 0000851D 202020202020202020-
 11060 00008526 202020202020205B2F-
 11060 0000852F 6D6F6E6F5D205B2F38-
 11060 00008538 6269745D205B2F6661-
 11060 00008541 73745D205B2F68616C-
 11060 0000854A 667C2F717561727465-
 11060 00008553 725D0D0A00         
 11061 00008558 766572696679206D61-     _@@txt_verify1  db 'verify max difference = ',0
 11061 00008561 782064696666657265-
 11061 0000856A 6E6365203D2000     
 11062 00008571 206174206D70333A00      _@@txt_verify1_at_mp3 db ' at mp3:',0  
 11063 0000857A 2C2061766572616765-     _@@txt_verify2  db ', average difference = ',0
 11063 00008583 20646966666572656E-
 11063 0000858C 6365203D2000       
 11064                                  
 11065                                  ; Erdogan Tan - 17/10/2024
 11066                                                 ;db 'NOCASH MP3 PLAYER v1.4 for Windows ',0
 11067 00008592 287072657373204354-     txt_ctrlc       db '(press CTRL+C to quit)', 13,10,0
 11067 0000859B 524C2B4320746F2071-
 11067 000085A4 756974290D0A00     
 11068                                  txt_ctrlc_size equ $ - txt_ctrlc
 11069 000085AB 0D0A                    txt_about       db 13,10
 11070                                                  ;db '----------------------------------',13,10
 11071 000085AD 2D2D2D2D2D2D2D2D2D-                     db '-----------------------------------',13,10
 11071 000085B6 2D2D2D2D2D2D2D2D2D-
 11071 000085BF 2D2D2D2D2D2D2D2D2D-
 11071 000085C8 2D2D2D2D2D2D2D2D0D-
 11071 000085D1 0A                 
 11072 000085D2 4572646F67616E2054-                     db 'Erdogan Tan - 13/01/2025 (Assembler: NASM)', 13,10
 11072 000085DB 616E202D2031332F30-
 11072 000085E4 312F32303235202841-
 11072 000085ED 7373656D626C65723A-
 11072 000085F6 204E41534D290D0A   
 11073 000085FE 4F726967696E616C20-                     db 'Original code: MP3PLAYER.EXE v1.4 (20/09/2024)', 13,10
 11073 00008607 636F64653A204D5033-
 11073 00008610 504C415945522E4558-
 11073 00008619 452076312E34202832-
 11073 00008622 302F30392F32303234-
 11073 0000862B 290D0A             
 11074 0000862E 202020202020202020-                     db '               by Martin Korth (TASM source code)'
 11074 00008637 202020202020627920-
 11074 00008640 4D617274696E204B6F-
 11074 00008649 72746820285441534D-
 11074 00008652 20736F757263652063-
 11074 0000865B 6F646529           
 11075 0000865F 0D0A0D0A00                              db 13,10,13,10,0
 11076 00008664 76312E342E3000                          db 'v1.4.0',0
 11077                                  
 11078                                  ; ===========================================================================
 11079                                  ; Uninitialized DATA (BSS)
 11080                                  ; ===========================================================================
 11081                                  
 11082 0000866B 90                      align 4
 11083                                  
 11084                                  bss_start:
 11085                                  
 11086                                  ; 10/01/2025
 11087                                  ABSOLUTE bss_start
 11088                                  
 11089                                  alignb 4
 11090 0000866C ????                    		resw 1	; 09/01/2025
 11091                                  ;;;
 11092                                  ; 20/10/2024 (TRDOS 386 specific parameters)
 11093 0000866E ??                      audio_hardware	resb 1
 11094 0000866F ??                      vra		resb 1
 11095 00008670 ????                    max_frequency	resw 1
 11096 00008672 ??                      srb		resb 1
 11097 00008673 ??                      volume_level	resb 1
 11098 00008674 ??                      blocks		resb 1
 11099 00008675 ??                      		resb 1
 11100 00008676 ????????                buffer_size	resd 1
 11101                                  ;;;	
 11102                                  
 11103                                  mp3_context_start:
 11104 0000867A <res 1000h>             main_data_pool_start	resb 4096
 11105 0000967A ????????                main_data_pool_wr_ptr	resd 1
 11106 0000967E ????????                mp3_src_data_location	resd 1
 11107 00009682 ????????                mp3_src_frame_size	resd 1
 11108 00009686 ????????                mp3_src_frame_end	resd 1
 11109 0000968A ????????                mp3_hdr_32bit_header	resd 1
 11110 0000968E ????????                mp3_hdr_flag_crc	resd 1
 11111 00009692 ????????                mp3_hdr_flag_mpeg25	resd 1
 11112 00009696 ????????                mp3_hdr_flag_padding	resd 1
 11113 0000969A ????????                mp3_sample_rate		resd 1
 11114 0000969E ????????                mp3_hdr_sample_rate_index resd 1
 11115 000096A2 ????????                mp3_bit_rate		resd 1
 11116 000096A6 ????????                mp3_src_num_channels	resd 1
 11117 000096AA ????????                mp3_output_num_channels resd 1
 11118 000096AE ????????                mp3_output_sample_rate	resd 1
 11119 000096B2 ????????                mp3_bytes_per_sample	resd 1
 11120 000096B6 ????????                mp3_curr_syn_index	resd 1
 11121 000096BA ????????                mp3_curr_syn_dst	resd 1
 11122 000096BE ????????                mp3_nb_frames		resd 1
 11123 000096C2 ????????                mp3_hdr_mode_val	resd 1
 11124 000096C6 ????????                mp3_hdr_mode_ext	resd 1
 11125 000096CA ????????                mp3_hdr_flag_lsf	resd 1
 11126 000096CE ????????                mp3_synth_filter_proc	resd 1
 11127                                  
 11128 000096D2 <res 2000h>             mp3_synth_buf   resd 2048
 11129 0000B6D2 ????????????????        mp3_synth_index resd 2
 11130 0000B6DA <res 2400h>             mp3_sb_samples  resd 2304
 11131                                  	                           ; MP3_MAX_CHANNELS*36*SBLIMIT
 11132 0000DADA <res 1200h>             mp3_mdct_buf    resd 1152
 11133                                                                     ; MP3_MAX_CHANNELS*SBLIMIT*18
 11134 0000ECDA ????????                mp3_free_format_frame_size resd 1
 11135                                  
 11136 0000ECDE ??                      mp3_curr_vfrac_bits resb 1
 11137                                  
 11138 0000ECDF ??                      alignb 4
 11139                                  
 11140 0000ECE0 ????????                mp3_xing_id     resd 1
 11141 0000ECE4 ????????                mp3_xing_flags  resd 1
 11142 0000ECE8 ????????                mp3_xing_frames resd 1
 11143 0000ECEC ????????                mp3_xing_filesize resd 1
 11144 0000ECF0 <res 64h>               mp3_xing_toc    resb 100
 11145 0000ED54 ????????                mp3_xing_vbr_scale resd 1
 11146 0000ED58 ????????                mp3_file_size   resd 1
 11147 0000ED5C ????????                mp3_id3_size    resd 1
 11148 0000ED60 ????????                mp3_tag_size    resd 1
 11149                                  
 11150 0000ED64 ????????                mp3_num_frames_decoded	resd 1
 11151 0000ED68 ????????                mp3_total_output_size	resd 1
 11152 0000ED6C ????????                mp3_samples_dst		resd 1
 11153                                  ; DWORD mp3_samples_output_size
 11154 0000ED70 ????????                mp3_samples_output_size	resd 1
 11155 0000ED74 ????????                mp3_samples_dst_step	resd 1
 11156                                  
 11157 0000ED78 ????????                mp3_curr_channel	resd 1
 11158 0000ED7C ????????                mp3_curr_granule	resd 1
 11159 0000ED80 ????????                mp3_curr_frame		resd 1
 11160                                  
 11161 0000ED84 ????????                mp3_bitstream_start	resd 1
 11162 0000ED88 ????????                mp3_src_remain		resd 1
 11163 0000ED8C ????????                mp3_extra_bytes		resd 1
 11164 0000ED90 ????????                mp3_main_data_begin	resd 1
 11165 0000ED94 ????????                mp3_num_compress_bits	resd 1
 11166                                  
 11167 0000ED98 ????????                mp3_nb_granules resd 1
 11168                                  
 11169 0000ED9C <res 2680h>             mp3_granules		resb 9856
 11170 0001141C <res 480h>              mp3_exponents		resw 576
 11171 0001189C <res B800h>             huff_tree_buf		resb 0B800h
 11172 0001D09C <res 240h>              mp3_band_index_long	resw 288
 11173 0001D2DC <res 803Ch>             mp3_table_4_3_exp	resb 32828
 11174                                  
 11175 00025318 <res 200F0h>            mp3_table_4_3_value	resd 32828
 11176 00045408 <res 800h>              mp3_exp_table		resd 512
 11177 00045C08 <res 8000h>             mp3_expval_table	resd 8192
 11178 0004DC08 <res 480h>              mp3_mdct_win		resd 288
 11179 0004E088 <res 800h>              mp3_is_table_lsf	resd 512
 11180 0004E888 <res 1000h>             mp3_synth_win		resd 1024
 11181 0004F888 <res 2000h>             mp3_lsf_sf_expand_exploded_table resb 8192
 11182                                  mp3_context_end:
 11183 00051888 ????????                _@@region_address0	resd 1
 11184 0005188C ????????                _@@region_address1	resd 1
 11185 00051890 ????????                _@@saved_sp		resd 1
 11186 00051894 ????????                mp3_main_data_siz	resd 1
 11187 00051898 ????????                _@@scfsi        resd 1
 11188 0005189C <res Ch>                _@@gains        resd 3
 11189 000518A8 ????????                _@@rle_point    resd 1
 11190 000518AC ????????                _@@III          resd 1
 11191 000518B0 ????????                _@@JJJ          resd 1
 11192 000518B4 ????????                _@@linbits      resd 1
 11193 000518B8 ????????                _@@vlc_table    resd 1
 11194 000518BC ????????                _@@coarse_end   resd 1
 11195                                  
 11196 000518C0 ????????                _@rle_point     resd 1
 11197 000518C4 ????????                _@@rle_ptr      resd 1
 11198 000518C8 ????????                _@@rle_val      resd 1
 11199 000518CC ????????                _@@rle_val_x_40h resd 1
 11200 000518D0 ????????                _@@max_bands    resb 4
 11201 000518D4 ????????                _@@max_blocks   resd 1
 11202 000518D8 ????????                _@@max_pos      resd 1
 11203 000518DC <res 28h>               _@@sfb_array    resb 40
 11204 00051904 ????????                _@@is_tab       resd 1
 11205 00051908 ????????                _@@n_long_sfb   resd 1
 11206 0005190C ????????                _@@n_short_sfb  resd 1
 11207 00051910 ????????                _@@n_sfb        resd 1
 11208 00051914 <res 900h>              _@@tmp          resb 2304
 11209 00052214 ????????                _@@s0           resd 1
 11210 00052218 ????????                _@@s2           resd 1
 11211 0005221C ????????                _@@s3           resd 1
 11212                                  
 11213 00052220 <res 48h>               _@@@tmp         resd 18 ; resb 72
 11214 00052268 ????????                _@@tmp0         resd 1
 11215 0005226C ????????                _@@tmp1         resd 1
 11216 00052270 ????????                _@@tmp2         resd 1
 11217 00052274 ????????                _@@tmp3         resd 1
 11218 00052278 ????????                _@@tmp4         resd 1
 11219 0005227C ????????                _@@tmp5         resd 1
 11220 00052280 ????????                mp3_out2_a0     resd 1
 11221 00052284 ????????                mp3_out2_a1     resd 1
 11222 00052288 ????????                mp3_out2_a2     resd 1
 11223 0005228C ????????                mp3_out2_b0     resd 1
 11224 00052290 ????????                mp3_out2_b1     resd 1
 11225 00052294 ????????                mp3_out2_b2     resd 1
 11226 00052298 ????????                                resd 1
 11227 0005229C ????????                                resd 1
 11228 000522A0 ????????                _@@@JJJ         resd 1
 11229 000522A4 ????????                _@@www          resd 1
 11230 000522A8 ????????                _@@mdct_long_end resd 1
 11231 000522AC ????????                _@@sblimit      resd 1
 11232 000522B0 ????????                _@@switch_point resd 1
 11233 000522B4 <res 100h>              mp3_huff_tmp_bits	resb 256
 11234 000523B4 <res 200h>              mp3_huff_tmp_codes	resb 512
 11235 000525B4 ????????                _@@table_nb_bits	resd 1
 11236 000525B8 ????????                _@@nb_codes		resd 1
 11237 000525BC ????????                _@@prefix_numbits	resd 1
 11238 000525C0 ????????                _@@prefix_pattern	resd 1
 11239 000525C4 ????????                _@@curr_table_size	resd 1
 11240 000525C8 ????????                _@@curr_table_mask	resd 1
 11241 000525CC ????????                _@@curr_table_index	resd 1
 11242 000525D0 ????????                _@@granule_addr		resd 1
 11243                                  ; HANDLE hFile
 11244 000525D4 ????????                hFile           resd 1
 11245                                  ; HANDLE hMap
 11246                                  ;hMap           resd 1
 11247 000525D8 ????????                stream_start    resd 1
 11248 000525DC ????????                stream_pos      resd 1
 11249 000525E0 ????????                bytes_left      resd 1
 11250                                  
 11251                                  ; 20/10/2024
 11252                                  ; DWORD diskresult
 11253                                  ;diskresult     resd 1
 11254                                  ; HANDLE std_out
 11255                                  ;std_out        resd 1
 11256                                  ;cmdline_buf    resb 1024
 11257 000525E4 <res 80h>               cmdline_buf	resb 128
 11258                                  ; HANDLE mp3_wav_handle
 11259 00052664 ????????                mp3_wav_handle  resd 1
 11260                                  ; HANDLE mp3_pcm_handle
 11261 00052668 ????????                mp3_pcm_handle  resd 1
 11262 0005266C ????????                _@@max_diff     resd 1
 11263 00052670 ????????????????        _@@avg_diff     resd 2
 11264 00052678 ????????                pcm_filepos     resd 1
 11265 0005267C ????????                _@@mono_convert resd 1
 11266 00052680 ????????                _@@pcm_steps    resw 2
 11267 00052684 ????????                _@@worst_pcm_filepos resd 1
 11268 00052688 ????????                _@@worst_mp3_filepos resd 1
 11269 0005268C ????????                		resd 1
 11270                                  ;alignb 4
 11271                                  
 11272                                  ; 10/01/2025
 11273 00052690 <res 970h>              alignb 4096
 11274                                  
 11275                                  ; 09/01/2025
 11276                                  ;sample_buffer  resb 36864
 11277                                  ;sample_buffer	resb 8*MP3_MAX_OUTPUT_SIZE
 11278                                  ;sample_buffer_size equ $-sample_buffer
 11279                                  
 11280                                  ; 10/01/2025
 11281 00053000 <res 10000h>            sample_buffer	resb 65536 ; max. 64512 bytes ; 11/01/2025
 11282                                  
 11283                                  end_of_bss:
 11284                                  
 11285                                  ; ===========================================================================
 11286                                  ; end
